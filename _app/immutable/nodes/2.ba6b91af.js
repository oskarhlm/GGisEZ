import{J as xo,K as Jm,L as Tb,M as Ib,S as gs,i as ys,s as ts,C as Ss,N as Ai,k as pn,l as mn,m as xn,h as Tt,O as Cr,b as pi,G as ln,P as Lr,D as Cs,E as Ls,F as Ds,Q as yr,R as As,g as Ot,d as jt,T as Al,U as hr,V as qo,W as Ks,I as Vu,o as ic,X as Qm,Y as ud,Z as Ho,w as Dr,e as rr,v as Vs,f as Gs,_ as Xs,x as Gu,y as Sn,z as Zn,A as Cn,$ as ms,B as Ln,H as ju,a0 as my,a1 as ly,a2 as cy,a3 as d1,a as ir,c as nr,n as tn,a4 as Px,a5 as Mb,a6 as _y,a7 as Ab,a8 as Sb,a9 as Cb,aa as Lb,ab as Db,ac as Pb,ad as Ob,q as co,r as uo,u as Sl,ae as gy,af as Rb,ag as $m,ah as e_,ai as kb,p as Hm,aj as Uv}from"../chunks/index.f81ab6e4.js";import{w as af}from"../chunks/index.2ba63786.js";var ru=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zb(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Lv={},Bb={get exports(){return Lv},set exports(s){Lv=s}};(function(s,a){(function(o,d){s.exports=d()})(ru,function(){var o,d,_;function v(r,I){if(!o)o=I;else if(!d)d=I;else{var R="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",U={};o(U),_=I(U),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_.workerUrl=window.URL.createObjectURL(new Blob([R],{type:"text/javascript"})))}}v(["exports"],function(r){var I=typeof self<"u"?self:{},R="2.13.0";let U;const V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(U==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{U={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{U=t}}return U},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Z={supported:!1,testSupport:function(t){!te&&W&&(ae?Ie(t):Y=t)}};let Y,W,te=!1,ae=!1;function Ie(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,W),t.isContextLost())return;Z.supported=!0}catch{}t.deleteTexture(e),te=!0}I.document&&(W=I.document.createElement("img"),W.onload=function(){Y&&Ie(Y),Y=null,ae=!0},W.onerror=function(){te=!0,Y=null},W.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ye="01";var Ue=je;function je(t,e,i,l){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=l}je.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,l=0;l<8;l++){var u=this.sampleCurveX(i)-t;if(Math.abs(u)<e)return i;var p=this.sampleCurveDerivativeX(i);if(Math.abs(p)<1e-6)break;i-=u/p}var g=0,b=1;for(i=t,l=0;l<20&&(u=this.sampleCurveX(i),!(Math.abs(u-t)<e));l++)t>u?g=i:b=i,i=.5*(b-g)+g;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var _e=ct;function ct(t,e){this.x=t,this.y=e}ct.prototype={clone:function(){return new ct(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),l=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=l,this},_rotateAround:function(t,e){var i=Math.cos(t),l=Math.sin(t),u=e.y+l*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-l*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ct.convert=function(t){return t instanceof ct?t:Array.isArray(t)?new ct(t[0],t[1]):t};const lt=Math.PI/180,St=180/Math.PI;function Bt(t){return t*lt}function et(t){return t*St}const ot=[[0,0],[1,0],[1,1],[0,1]];function Nt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function qt(t,e,i,l){const u=new Ue(t,e,i,l);return function(p){return u.solve(p)}}const _t=qt(.25,.1,.25,1);function dt(t,e,i){return Math.min(i,Math.max(e,t))}function ti(t,e,i){return(i=dt((i-t)/(e-t),0,1))*i*(3-2*i)}function Vi(t,e,i){const l=i-e,u=((t-e)%l+l)%l+e;return u===e?i:u}function Gt(t,e,i){if(!t.length)return i(null,[]);let l=t.length;const u=new Array(t.length);let p=null;t.forEach((g,b)=>{e(g,(T,M)=>{T&&(p=T),u[b]=M,--l==0&&i(p,u)})})}function Yi(t){const e=[];for(const i in t)e.push(t[i]);return e}function Gi(t,...e){for(const i of e)for(const l in i)t[l]=i[l];return t}let ki=1;function Ni(){return ki++}function Dn(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function bn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ui(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Wi(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Ei(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Wt(t,e,i){const l={};for(const u in t)l[u]=e.call(i||this,t[u],u,t);return l}function Vn(t,e,i){const l={};for(const u in t)e.call(i||this,t[u],u,t)&&(l[u]=t[u]);return l}function It(t){return Array.isArray(t)?t.map(It):typeof t=="object"&&t?Wt(t,It):t}const wt={};function Ii(t){wt[t]||(typeof console<"u"&&console.warn(t),wt[t]=!0)}function dn(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function $t(t){let e=0;for(let i,l,u=0,p=t.length,g=p-1;u<p;g=u++)i=t[u],l=t[g],e+=(l.x-i.x)*(i.y+l.y);return e}function gt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Si(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,l,u,p)=>{const g=u||p;return e[l]=!g||g.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Pi=null;function Pr(t){if(Pi==null){const e=t.navigator?t.navigator.userAgent:null;Pi=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Pi}function Ir(t){try{const e=I[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ji(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const jn="mapbox-tiles";let sr,Be,li=500,qi=50;function Ci(){try{return I.caches}catch{}}function Jt(){Ci()&&!sr&&(sr=I.caches.open(jn))}function nn(t){const e=t.indexOf("?");if(e<0)return t;const i=function(u){const p=u.indexOf("?");return p>0?u.slice(p+1).split("&"):[]}(t),l=i.filter(u=>{const p=u.split("=");return p[0]==="language"||p[0]==="worldview"});return l.length?`${t.slice(0,e)}?${l.join("&")}`:t.slice(0,e)}let vs=1/0;const yt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(yt);class fi extends Error{constructor(e,i,l){i===401&&ua(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xi=gt()?()=>self.worker&&self.worker.referrer:()=>(I.location.protocol==="blob:"?I.parent:I).location.href,yn=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(xi())&&!/^\w+:/.test(i))){if(I.fetch&&I.Request&&I.AbortController&&I.Request.prototype.hasOwnProperty("signal"))return function(l,u){const p=new I.AbortController,g=new I.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:xi(),signal:p.signal});let b=!1,T=!1;const M=(D=g.url).indexOf("sku=")>0&&ua(D);var D;l.type==="json"&&g.headers.set("Accept","application/json");const O=(G,j,X)=>{if(T)return;if(G&&G.message!=="SecurityError"&&Ii(G),j&&X)return z(j);const ie=Date.now();I.fetch(g).then(pe=>{if(pe.ok){const we=M?pe.clone():null;return z(pe,we,ie)}return u(new fi(pe.statusText,pe.status,l.url))}).catch(pe=>{pe.name!=="AbortError"&&u(new Error(`${pe.message} ${l.url}`))})},z=(G,j,X)=>{(l.type==="arrayBuffer"?G.arrayBuffer():l.type==="json"?G.json():G.text()).then(ie=>{T||(j&&X&&function(pe,we,de){if(Jt(),!sr)return;const be={status:we.status,statusText:we.statusText,headers:new I.Headers};we.headers.forEach(($e,Je)=>be.headers.set(Je,$e));const Se=Si(we.headers.get("Cache-Control")||"");if(Se["no-store"])return;Se["max-age"]&&be.headers.set("Expires",new Date(de+1e3*Se["max-age"]).toUTCString());const Me=be.headers.get("Expires");Me&&(new Date(Me).getTime()-de<42e4||function($e,Je){if(Be===void 0)try{new Response(new ReadableStream),Be=!0}catch{Be=!1}Be?Je($e.body):$e.blob().then(Je)}(we,$e=>{const Je=new I.Response($e,be);Jt(),sr&&sr.then(ht=>ht.put(nn(pe.url),Je)).catch(ht=>Ii(ht.message))}))}(g,j,X),b=!0,u(null,ie,G.headers.get("Cache-Control"),G.headers.get("Expires")))}).catch(ie=>{T||u(new Error(ie.message))})};return M?function(G,j){if(Jt(),!sr)return j(null);const X=nn(G.url);sr.then(ie=>{ie.match(X).then(pe=>{const we=function(de){if(!de)return!1;const be=new Date(de.headers.get("Expires")||0),Se=Si(de.headers.get("Cache-Control")||"");return be>Date.now()&&!Se["no-cache"]}(pe);ie.delete(X),we&&ie.put(X,pe.clone()),j(null,pe,we)}).catch(j)}).catch(j)}(g,O):O(null,null),{cancel:()=>{T=!0,b||p.abort()}}}(t,e);if(gt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(l,u){const p=new I.XMLHttpRequest;p.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const g in l.headers)p.setRequestHeader(g,l.headers[g]);return l.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=l.credentials==="include",p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let g=p.response;if(l.type==="json")try{g=JSON.parse(p.response)}catch(b){return u(b)}u(null,g,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else u(new fi(p.statusText,p.status,l.url))},p.send(l.body),{cancel:()=>p.abort()}}(t,e)},ls=function(t,e){return yn(Gi(t,{type:"arrayBuffer"}),e)};function js(t){const e=I.document.createElement("a");return e.href=t,e.protocol===I.document.location.protocol&&e.host===I.document.location.host}const Xo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let bo,cs;bo=[],cs=0;const ho=function(t,e){if(Z.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),cs>=V.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return bo.push(p),p}cs++;let i=!1;const l=()=>{if(!i)for(i=!0,cs--;bo.length&&cs<V.MAX_PARALLEL_IMAGE_REQUESTS;){const p=bo.shift(),{requestParameters:g,callback:b,cancelled:T}=p;T||(p.cancel=ho(g,b).cancel)}},u=ls(t,(p,g,b,T)=>{l(),p?e(p):g&&(I.createImageBitmap?function(M,D){const O=new I.Blob([new Uint8Array(M)],{type:"image/png"});I.createImageBitmap(O).then(z=>{D(null,z)}).catch(z=>{D(new Error(`Could not load image because of ${z.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(M,D)=>e(M,D,b,T)):function(M,D){const O=new I.Image,z=I.URL;O.onload=()=>{D(null,O),z.revokeObjectURL(O.src),O.onload=null,I.requestAnimationFrame(()=>{O.src=Xo})},O.onerror=()=>D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const G=new I.Blob([new Uint8Array(M)],{type:"image/png"});O.src=M.byteLength?z.createObjectURL(G):Xo}(g,(M,D)=>e(M,D,b,T)))});return{cancel:()=>{u.cancel(),l()}}},La="NO_ACCESS_TOKEN";function qs(t){return t.indexOf("mapbox:")===0}function ua(t){return V.API_URL_REGEX.test(t)}function Dl(t){return V.API_CDN_URL_REGEX.test(t)}function Da(t){return V.API_STYLE_REGEX.test(t)&&!Ko(t)}function Ko(t){return V.API_SPRITE_REGEX.test(t)}const Pa=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xs(t){const e=t.match(Pa);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ha(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function Ps(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(I.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class da{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Ps(V.ACCESS_TOKEN);let l="";return l=i&&i.u?I.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,p)=>String.fromCharCode(+("0x"+p)))):V.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const e=Ir("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{const u=I.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const p=I.localStorage.getItem(l);p&&(this.anonId=p)}catch{Ii("Unable to read from LocalStorage")}}saveEventData(){const e=Ir("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{I.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&I.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Ii("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,l,u){if(!V.EVENTS_URL)return;const p=xs(V.EVENTS_URL);p.params.push(`access_token=${u||V.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString()},b=i?Gi(g,i):g,T={url:ha(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};this.pendingRequest=function(M,D){return yn(Gi(M,{method:"POST"}),D)}(T,M=>{this.pendingRequest=null,l(M),this.saveEventData(),this.processRequests(u)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const he=new class extends da{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>qs(i)||ua(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ps(V.ACCESS_TOKEN),i=e?e.u:V.ACCESS_TOKEN;let l=i!==this.eventData.tokenU;ui(this.anonId)||(this.anonId=Dn(),l=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),g=new Date(u),b=(u-this.eventData.lastSuccess)/864e5;l=l||b>=1||b<-1||p.getDate()!==g.getDate()}else l=!0;l?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:ye,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},t):this.processRequests()}},q=he.postTurnstileEvent.bind(he),K=new class extends da{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,l){this.skuToken=e,this.errorCb=l,V.EVENTS_URL&&(i||V.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(La)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ui(this.anonId)||(this.anonId=Dn()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:ye,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},t))}},ue=K.postMapLoadEvent.bind(K),ve=new class extends da{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){V.EVENTS_URL&&(t||V.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),l=function(u){const p=I.performance.getEntriesByType("resource"),g=I.performance.getEntriesByType("mark"),b=function(z){const G={};if(z){for(const j in z)if(j!=="other")for(const X of z[j]){const ie=`${j}ResolveRangeMin`,pe=`${j}ResolveRangeMax`,we=`${j}RequestCount`,de=`${j}RequestCachedCount`;G[ie]=Math.min(G[ie]||1/0,X.startTime),G[pe]=Math.max(G[pe]||-1/0,X.responseEnd);const be=Se=>{G[Se]===void 0&&(G[Se]=0),++G[Se]};X.transferSize!==void 0&&X.transferSize===0&&be(de),be(we)}}return G}(function(z,G){const j={};if(z)for(const X of z){const ie=G(X);j[ie]===void 0&&(j[ie]=[]),j[ie].push(X)}return j}(p,Xt)),T=I.devicePixelRatio,M=I.navigator.connection||I.navigator.mozConnection||I.navigator.webkitConnection,D={counters:[],metadata:[],attributes:[]},O=(z,G,j)=>{j!=null&&z.push({name:G,value:j.toString()})};for(const z in b)O(D.counters,z,b[z]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(O(D.counters,"interactionRangeMin",u.interactionRange[0]),O(D.counters,"interactionRangeMax",u.interactionRange[1])),g)for(const z of Object.keys(Ke)){const G=Ke[z],j=g.find(X=>X.name===G);j&&O(D.counters,G,j.startTime)}return O(D.counters,"visibilityHidden",u.visibilityHidden),O(D.attributes,"style",function(z){if(z)for(const G of z){const j=G.name.split("?")[0];if(Da(j)){const X=j.split("/").slice(-2);if(X.length===2)return`mapbox://styles/${X[0]}/${X[1]}`}}}(p)),O(D.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),O(D.attributes,"fogEnabled",u.fogEnabled?"true":"false"),O(D.attributes,"projection",u.projection),O(D.attributes,"zoom",u.zoom),O(D.metadata,"devicePixelRatio",T),O(D.metadata,"connectionEffectiveType",M?M.effectiveType:void 0),O(D.metadata,"navigatorUserAgent",I.navigator.userAgent),O(D.metadata,"screenWidth",I.screen.width),O(D.metadata,"screenHeight",I.screen.height),O(D.metadata,"windowWidth",I.innerWidth),O(D.metadata,"windowHeight",I.innerHeight),O(D.metadata,"mapWidth",u.width/T),O(D.metadata,"mapHeight",u.height/T),O(D.metadata,"webglRenderer",u.renderer),O(D.metadata,"webglVendor",u.vendor),O(D.metadata,"sdkVersion",R),O(D.metadata,"sdkIdentifier","mapbox-gl-js"),D}(i);for(const u of l.metadata);for(const u of l.counters);for(const u of l.attributes);this.postEvent(e,l,()=>{},t)}},Ce=ve.postPerformanceEvent.bind(ve),qe=new class extends da{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,l){if(!V.API_URL||!V.SESSION_PATH)return;const u=xs(V.API_URL+V.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${l||V.ACCESS_TOKEN||""}`);const p={url:ha(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(g,b){return yn(Gi(g,{method:"GET"}),b)}(p,g=>{this.pendingRequest=null,i(g),this.saveEventData(),this.processRequests(l)})}getSessionAPI(t,e,i,l){this.skuToken=e,this.errorCb=l,V.SESSION_PATH&&V.API_URL&&(i||V.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(La)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},t)}},Fe=qe.getSessionAPI.bind(qe),Re=new Set,Ke={create:"create",load:"load",fullLoad:"fullLoad"},vt={mark(t){I.performance.mark(t)},measure(t,e,i){I.performance.measure(t,e,i)}};function Xt(t){const e=t.name.split("?")[0];return Dl(e)&&e.includes("mapbox-gl.js")?"javascript":Dl(e)&&e.includes("mapbox-gl.css")?"css":function(i){return V.API_FONTS_REGEX.test(i)}(e)?"fontRange":Ko(e)?"sprite":Da(e)?"style":function(i){return V.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const Dt=I.performance;function Mi(t){const e=t?t.url.toString():void 0;return Dt.getEntriesByName(e)}let gi,yi,Le,hi;const Pn={now:()=>Le!==void 0?Le:I.performance.now(),setNow(t){Le=t},restoreNow(){Le=void 0},frame(t){const e=I.requestAnimationFrame(t);return{cancel:()=>I.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:l}=t;hi||(hi=I.document.createElement("canvas"));const u=hi.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>hi.width||l>hi.height)&&(hi.width=i,hi.height=l),u.clearRect(-e,-e,i+2*e,l+2*e),u.drawImage(t,0,0,i,l),u.getImageData(-e,-e,i+2*e,l+2*e)},resolveURL:t=>(gi||(gi=I.document.createElement("a")),gi.href=t,gi.href),get devicePixelRatio(){return I.devicePixelRatio},get prefersReducedMotion(){return!!I.matchMedia&&(yi==null&&(yi=I.matchMedia("(prefers-reduced-motion: reduce)")),yi.matches)}};function Oi(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function wn(t,e,i){if(i&&i[t]){const l=i[t].indexOf(e);l!==-1&&i[t].splice(l,1)}}class In{constructor(e,i={}){Gi(this,i),this.type=e}}class Yo extends In{constructor(e,i={}){super("error",Gi({error:e},i))}}class Ys{on(e,i){return this._listeners=this._listeners||{},Oi(e,i,this._listeners),this}off(e,i){return wn(e,i,this._listeners),wn(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Oi(e,i,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,i){typeof e=="string"&&(e=new In(e,i||{}));const l=e.type;if(this.listens(l)){e.target=this;const u=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const b of u)b.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const b of p)wn(l,b,this._oneTimeListeners),b.call(this,e);const g=this._eventedParent;g&&(Gi(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof Yo&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var st=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Jo(t,...e){for(const i of e)for(const l in i)t[l]=i[l];return t}function qr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function nl(t){if(Array.isArray(t))return t.map(nl);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=nl(t[i]);return e}return qr(t)}class Dh extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var Qo=Dh;class Oa{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[l,u]of i)this.bindings[l]=u}concat(e){return new Oa(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Wu=Oa;const rl={kind:"null"},Ht={kind:"number"},_n={kind:"string"},vn={kind:"boolean"},fo={kind:"color"},C={kind:"object"},k={kind:"value"},$={kind:"collator"},xe={kind:"formatted"},Oe={kind:"resolvedImage"};function Pe(t,e){return{kind:"array",itemType:t,N:e}}function ze(t){if(t.kind==="array"){const e=ze(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Ft=[rl,Ht,_n,vn,fo,xe,C,Pe(k),Oe];function kt(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!kt(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of Ft)if(!kt(i,e))return null}}return`Expected ${ze(t)} but found ${ze(e)} instead.`}function ai(t,e){return e.some(i=>i.kind===t.kind)}function Zt(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}var Qt,Hi={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function vr(t){return(t=Math.round(t))<0?0:t>255?255:t}function Zi(t){return vr(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Mr(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Et(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{Qt={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in Hi)return Hi[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=i.indexOf("("),u=i.indexOf(")");if(l!==-1&&u+1===i.length){var p=i.substr(0,l),g=i.substr(l+1,u-(l+1)).split(","),b=1;switch(p){case"rgba":if(g.length!==4)return null;b=Mr(g.pop());case"rgb":return g.length!==3?null:[Zi(g[0]),Zi(g[1]),Zi(g[2]),b];case"hsla":if(g.length!==4)return null;b=Mr(g.pop());case"hsl":if(g.length!==3)return null;var T=(parseFloat(g[0])%360+360)%360/360,M=Mr(g[1]),D=Mr(g[2]),O=D<=.5?D*(M+1):D+M-D*M,z=2*D-O;return[vr(255*Et(z,O,T+1/3)),vr(255*Et(z,O,T)),vr(255*Et(z,O,T-1/3)),b];default:return null}}return null}}catch{}class ci{constructor(e,i,l,u=1){this.r=e,this.g=i,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof ci)return e;if(typeof e!="string")return;const i=Qt(e);return i?new ci(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,l,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(l)},${u})`}toArray(){const{r:e,g:i,b:l,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*i/u,255*l/u,u]}toArray01(){const{r:e,g:i,b:l,a:u}=this;return u===0?[0,0,0,0]:[e/u,i/u,l/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:l,a:u}=this;return[e,i,l,u]}}ci.black=new ci(0,0,0,1),ci.white=new ci(1,1,1,1),ci.transparent=new ci(0,0,0,0),ci.red=new ci(1,0,0,1),ci.blue=new ci(0,0,1,1);var Qi=ci;class Yr{constructor(e,i,l){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Br{constructor(e,i,l,u,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=l,this.fontStack=u,this.textColor=p}}class Os{constructor(e){this.sections=e}static fromString(e){return new Os([new Br(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Os?e:Os.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(l)}return e}}class Js{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Js({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ar(t,e,i,l){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[t,e,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[t,e,i,l]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function kc(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Qi||t instanceof Yr||t instanceof Os||t instanceof Js)return!0;if(Array.isArray(t)){for(const e of t)if(!kc(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!kc(t[e]))return!1;return!0}return!1}function is(t){if(t===null)return rl;if(typeof t=="string")return _n;if(typeof t=="boolean")return vn;if(typeof t=="number")return Ht;if(t instanceof Qi)return fo;if(t instanceof Yr)return $;if(t instanceof Os)return xe;if(t instanceof Js)return Oe;if(Array.isArray(t)){const e=t.length;let i;for(const l of t){const u=is(l);if(i){if(i===u)continue;i=k;break}i=u}return Pe(i||k,e)}return C}function Qs(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Qi||t instanceof Os||t instanceof Js?t.toString():JSON.stringify(t)}class uu{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!kc(e[1]))return i.error("invalid value");const l=e[1];let u=is(l);const p=i.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new uu(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Qi?["rgba"].concat(this.value.toArray()):this.value instanceof Os?this.value.serialize():this.value}}var nc=uu,bs=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const rc={string:_n,number:Ht,boolean:vn,object:C};class Pl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let l,u=1;const p=e[0];if(p==="array"){let b,T;if(e.length>2){const M=e[1];if(typeof M!="string"||!(M in rc)||M==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);b=rc[M],u++}else b=k;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);T=e[2],u++}l=Pe(b,T)}else l=rc[p];const g=[];for(;u<e.length;u++){const b=i.parse(e[u],u,k);if(!b)return null;g.push(b)}return new Pl(l,g)}evaluate(e){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(e);if(!kt(this.type,is(l)))return l;if(i===this.args.length-1)throw new bs(`Expected value to be of type ${ze(this.type)}, but found ${ze(is(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(l=>l.serialize()))}}var Xn=Pl;class ar{constructor(e){this.type=xe,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const u=[];let p=!1;for(let g=1;g<=e.length-1;++g){const b=e[g];if(p&&typeof b=="object"&&!Array.isArray(b)){p=!1;let T=null;if(b["font-scale"]&&(T=i.parse(b["font-scale"],1,Ht),!T))return null;let M=null;if(b["text-font"]&&(M=i.parse(b["text-font"],1,Pe(_n)),!M))return null;let D=null;if(b["text-color"]&&(D=i.parse(b["text-color"],1,fo),!D))return null;const O=u[u.length-1];O.scale=T,O.font=M,O.textColor=D}else{const T=i.parse(e[g],1,k);if(!T)return null;const M=T.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:T,scale:null,font:null,textColor:null})}}return new ar(u)}evaluate(e){return new Os(this.sections.map(i=>{const l=i.content.evaluate(e);return is(l)===Oe?new Br("",l,null,null,null):new Br(Qs(l),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),e.push(l)}return e}}class hu{constructor(e){this.type=Oe,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const l=i.parse(e[1],1,_n);return l?new hu(l):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),l=Js.fromString(i);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(i)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const dd={"to-boolean":vn,"to-color":fo,"to-number":Ht,"to-string":_n};class du{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[0];if((l==="to-boolean"||l==="to-string")&&e.length!==2)return i.error("Expected one argument.");const u=dd[l],p=[];for(let g=1;g<e.length;g++){const b=i.parse(e[g],g,k);if(!b)return null;p.push(b)}return new du(u,p)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,l;for(const u of this.args){if(i=u.evaluate(e),l=null,i instanceof Qi)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ar(i[0],i[1],i[2],i[3]),!l))return new Qi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new bs(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new bs(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Os.fromString(Qs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Js.fromString(Qs(this.args[0].evaluate(e))):Qs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ar([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new hu(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Ol=du;const Zu=["Unknown","Point","LineString","Polygon"];var zc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Zu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(l*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Qi.parse(t)),e}};class Rl{constructor(e,i,l,u){this.name=e,this.type=i,this._evaluate=l,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const l=e[0],u=Rl.definitions[l];if(!u)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,b=g.filter(([M])=>!Array.isArray(M)||M.length===e.length-1);let T=null;for(const[M,D]of b){T=new Ku(i.registry,i.path,null,i.scope);const O=[];let z=!1;for(let G=1;G<e.length;G++){const j=e[G],X=Array.isArray(M)?M[G-1]:M.type,ie=T.parse(j,1+O.length,X);if(!ie){z=!0;break}O.push(ie)}if(!z)if(Array.isArray(M)&&M.length!==O.length)T.error(`Expected ${M.length} arguments, but found ${O.length} instead.`);else{for(let G=0;G<O.length;G++){const j=Array.isArray(M)?M[G]:M.type,X=O[G];T.concat(G+1).checkSubtype(j,X.type)}if(T.errors.length===0)return new Rl(l,p,D,O)}}if(b.length===1)i.errors.push(...T.errors);else{const M=(b.length?b:g).map(([O])=>{return z=O,Array.isArray(z)?`(${z.map(ze).join(", ")})`:`(${ze(z.type)}...)`;var z}).join(" | "),D=[];for(let O=1;O<e.length;O++){const z=i.parse(e[O],1+D.length);if(!z)return null;D.push(ze(z.type))}i.error(`Expected arguments of type ${M}, but found (${D.join(", ")}) instead.`)}return null}static register(e,i){Rl.definitions=i;for(const l in i)e[l]=Rl}}var $o=Rl;class Hr{constructor(e,i,l){this.type=$,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const u=i.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,vn);if(!u)return null;const p=i.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,vn);if(!p)return null;let g=null;return l.locale&&(g=i.parse(l.locale,1,_n),!g)?null:new Hr(u,p,g)}evaluate(e){return new Yr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ea=8192;function xr(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function kl(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Bc(t,e){const i=(180+t[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*ea),Math.round(l*u*ea)]}function wo(t,e,i){const l=t[0]-e[0],u=t[1]-e[1],p=t[0]-i[0],g=t[1]-i[1];return l*g-p*u==0&&l*p<=0&&u*g<=0}function sc(t,e){let i=!1;for(let g=0,b=e.length;g<b;g++){const T=e[g];for(let M=0,D=T.length;M<D-1;M++){if(wo(t,T[M],T[M+1]))return!1;(u=T[M])[1]>(l=t)[1]!=(p=T[M+1])[1]>l[1]&&l[0]<(p[0]-u[0])*(l[1]-u[1])/(p[1]-u[1])+u[0]&&(i=!i)}}var l,u,p;return i}function oc(t,e){for(let i=0;i<e.length;i++)if(sc(t,e[i]))return!0;return!1}function Fc(t,e,i,l){const u=l[0]-i[0],p=l[1]-i[1],g=(t[0]-i[0])*p-u*(t[1]-i[1]),b=(e[0]-i[0])*p-u*(e[1]-i[1]);return g>0&&b<0||g<0&&b>0}function Nc(t,e,i){for(const M of i)for(let D=0;D<M.length-1;++D)if((b=[(g=M[D+1])[0]-(p=M[D])[0],g[1]-p[1]])[0]*(T=[(u=e)[0]-(l=t)[0],u[1]-l[1]])[1]-b[1]*T[0]!=0&&Fc(l,u,p,g)&&Fc(p,g,l,u))return!0;var l,u,p,g,b,T;return!1}function zl(t,e){for(let i=0;i<t.length;++i)if(!sc(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Nc(t[i],t[i+1],e))return!1;return!0}function Ra(t,e){for(let i=0;i<e.length;i++)if(zl(t,e[i]))return!0;return!1}function Rs(t,e,i){const l=[];for(let u=0;u<t.length;u++){const p=[];for(let g=0;g<t[u].length;g++){const b=Bc(t[u][g],i);xr(e,b),p.push(b)}l.push(p)}return l}function fu(t,e,i){const l=[];for(let u=0;u<t.length;u++){const p=Rs(t[u],e,i);l.push(p)}return l}function po(t,e,i,l){if(t[0]<i[0]||t[0]>i[2]){const u=.5*l;let p=t[0]-i[0]>u?-l:i[0]-t[0]>u?l:0;p===0&&(p=t[0]-i[2]>u?-l:i[2]-t[0]>u?l:0),t[0]+=p}xr(e,t)}function ka(t,e,i,l){const u=Math.pow(2,l.z)*ea,p=[l.x*ea,l.y*ea],g=[];if(!t)return g;for(const b of t)for(const T of b){const M=[T.x+p[0],T.y+p[1]];po(M,e,i,u),g.push(M)}return g}function On(t,e,i,l){const u=Math.pow(2,l.z)*ea,p=[l.x*ea,l.y*ea],g=[];if(!t)return g;for(const T of t){const M=[];for(const D of T){const O=[D.x+p[0],D.y+p[1]];xr(e,O),M.push(O)}g.push(M)}if(e[2]-e[0]<=u/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const T of g)for(const M of T)po(M,e,i,u)}var b;return g}class mo{constructor(e,i){this.type=vn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(kc(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let u=0;u<l.features.length;++u){const p=l.features[u].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new mo(l,l.features[u].geometry)}else if(l.type==="Feature"){const u=l.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new mo(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new mo(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,l){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const b=Rs(l.coordinates,p,g),T=ka(i.geometry(),u,p,g);if(!kl(u,p))return!1;for(const M of T)if(!sc(M,b))return!1}if(l.type==="MultiPolygon"){const b=fu(l.coordinates,p,g),T=ka(i.geometry(),u,p,g);if(!kl(u,p))return!1;for(const M of T)if(!oc(M,b))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,l){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],g=i.canonicalID();if(!g)return!1;if(l.type==="Polygon"){const b=Rs(l.coordinates,p,g),T=On(i.geometry(),u,p,g);if(!kl(u,p))return!1;for(const M of T)if(!zl(M,b))return!1}if(l.type==="MultiPolygon"){const b=fu(l.coordinates,p,g),T=On(i.geometry(),u,p,g);if(!kl(u,p))return!1;for(const M of T)if(!Ra(M,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var sl=mo;function za(t){if(t instanceof $o&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof sl)return!1;let e=!0;return t.eachChild(i=>{e&&!za(i)&&(e=!1)}),e}function Qn(t){if(t instanceof $o&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!Qn(i)&&(e=!1)}),e}function ta(t,e){if(t instanceof $o&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(l=>{i&&!ta(l,e)&&(i=!1)}),i}class ac{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=e[1];return i.scope.has(l)?new ac(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Xu=ac;class lc{constructor(e,i=[],l,u=new Wu,p=[]){this.registry=e,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=u,this.errors=p,this.expectedType=l}parse(e,i,l,u,p={}){return i?this.concat(i,l,u)._parse(e,p):this._parse(e,p)}_parse(e,i){function l(u,p,g){return g==="assert"?new Xn(p,[u]):g==="coerce"?new Ol(p,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[u];if(p){let g=p.parse(e,this);if(!g)return null;if(this.expectedType){const b=this.expectedType,T=g.type;if(b.kind!=="string"&&b.kind!=="number"&&b.kind!=="boolean"&&b.kind!=="object"&&b.kind!=="array"||T.kind!=="value")if(b.kind!=="color"&&b.kind!=="formatted"&&b.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string"){if(this.checkSubtype(b,T))return null}else g=l(g,b,i.typeAnnotation||"coerce");else g=l(g,b,i.typeAnnotation||"assert")}if(!(g instanceof nc)&&g.type.kind!=="resolvedImage"&&Ba(g)){const b=new zc;try{g=new nc(g.type,g.evaluate(b))}catch(T){return this.error(T.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,l){const u=typeof e=="number"?this.path.concat(e):this.path,p=l?this.scope.concat(l):this.scope;return new lc(this.registry,u,i||null,p,this.errors)}error(e,...i){const l=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new Qo(l,e))}checkSubtype(e,i){const l=kt(e,i);return l&&this.error(l),l}}var Ku=lc;function Ba(t){if(t instanceof Xu)return Ba(t.boundExpression);if(t instanceof $o&&t.name==="error"||t instanceof Hr||t instanceof sl)return!1;const e=t instanceof Ol||t instanceof Xn;let i=!0;return t.eachChild(l=>{i=e?i&&Ba(l):i&&l instanceof nc}),!!i&&za(t)&&ta(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Fa(t,e){const i=t.length-1;let l,u,p=0,g=i,b=0;for(;p<=g;)if(b=Math.floor((p+g)/2),l=t[b],u=t[b+1],l<=e){if(b===i||e<u)return b;p=b+1}else{if(!(l>e))throw new bs("Input is not a number.");g=b-1}return 0}class ia{constructor(e,i,l){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,p]of l)this.labels.push(u),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(e[1],1,Ht);if(!l)return null;const u=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let g=1;g<e.length;g+=2){const b=g===1?-1/0:e[g],T=e[g+1],M=g,D=g+1;if(typeof b!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(u.length&&u[u.length-1][0]>=b)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const O=i.parse(T,D,p);if(!O)return null;p=p||O.type,u.push([b,O])}return new ia(p,l,u)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return l[0].evaluate(e);const p=i.length;return u>=i[p-1]?l[p-1].evaluate(e):l[Fa(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var _o=ia;function $i(t,e,i){return t*(1-i)+e*i}var ol=Object.freeze({__proto__:null,number:$i,color:function(t,e,i){return new Qi($i(t.r,e.r,i),$i(t.g,e.g,i),$i(t.b,e.b,i),$i(t.a,e.a,i))},array:function(t,e,i){return t.map((l,u)=>$i(l,e[u],i))}});const fa=.95047,Yu=1.08883,al=4/29,Na=6/29,Uc=3*Na*Na,Ju=Math.PI/180,Qu=180/Math.PI;function cc(t){return t>.008856451679035631?Math.pow(t,1/3):t/Uc+al}function pu(t){return t>Na?t*t*t:Uc*(t-al)}function uc(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function us(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ua(t){const e=us(t.r),i=us(t.g),l=us(t.b),u=cc((.4124564*e+.3575761*i+.1804375*l)/fa),p=cc((.2126729*e+.7151522*i+.072175*l)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-cc((.0193339*e+.119192*i+.9503041*l)/Yu)),alpha:t.a}}function hc(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,l=isNaN(t.b)?e:e-t.b/200;return e=1*pu(e),i=fa*pu(i),l=Yu*pu(l),new Qi(uc(3.2404542*i-1.5371385*e-.4985314*l),uc(-.969266*i+1.8760108*e+.041556*l),uc(.0556434*i-.2040259*e+1.0572252*l),t.alpha)}function Va(t,e,i){const l=e-t;return t+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const dc={forward:Ua,reverse:hc,interpolate:function(t,e,i){return{l:$i(t.l,e.l,i),a:$i(t.a,e.a,i),b:$i(t.b,e.b,i),alpha:$i(t.alpha,e.alpha,i)}}},na={forward:function(t){const{l:e,a:i,b:l}=Ua(t),u=Math.atan2(l,i)*Qu;return{h:u<0?u+360:u,c:Math.sqrt(i*i+l*l),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Ju,i=t.c;return hc({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Va(t.h,e.h,i),c:$i(t.c,e.c,i),l:$i(t.l,e.l,i),alpha:$i(t.alpha,e.alpha,i)}}};var $u=Object.freeze({__proto__:null,lab:dc,hcl:na});class Vc{constructor(e,i,l,u,p){this.type=e,this.operator=i,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[g,b]of p)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(e,i,l,u){let p=0;if(e.name==="exponential")p=fc(i,e.base,l,u);else if(e.name==="linear")p=fc(i,1,l,u);else if(e.name==="cubic-bezier"){const g=e.controlPoints;p=new Ue(g[0],g[1],g[2],g[3]).solve(fc(i,1,l,u))}return p}static parse(e,i){let[l,u,p,...g]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const M=u[1];if(typeof M!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:M}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const M=u.slice(1);if(M.length!==4||M.some(D=>typeof D!="number"||D<0||D>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:M}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,Ht),!p)return null;const b=[];let T=null;l==="interpolate-hcl"||l==="interpolate-lab"?T=fo:i.expectedType&&i.expectedType.kind!=="value"&&(T=i.expectedType);for(let M=0;M<g.length;M+=2){const D=g[M],O=g[M+1],z=M+3,G=M+4;if(typeof D!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(b.length&&b[b.length-1][0]>=D)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const j=i.parse(O,G,T);if(!j)return null;T=T||j.type,b.push([D,j])}return T.kind==="number"||T.kind==="color"||T.kind==="array"&&T.itemType.kind==="number"&&typeof T.N=="number"?new Vc(T,l,u,p,b):i.error(`Type ${ze(T)} is not interpolatable.`)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return l[0].evaluate(e);const p=i.length;if(u>=i[p-1])return l[p-1].evaluate(e);const g=Fa(i,u),b=Vc.interpolationFactor(this.interpolation,u,i[g],i[g+1]),T=l[g].evaluate(e),M=l[g+1].evaluate(e);return this.operator==="interpolate"?ol[this.type.kind.toLowerCase()](T,M,b):this.operator==="interpolate-hcl"?na.reverse(na.interpolate(na.forward(T),na.forward(M),b)):dc.reverse(dc.interpolate(dc.forward(T),dc.forward(M),b))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function fc(t,e,i,l){const u=l-i,p=t-i;return u===0?0:e===1?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}var Fo=Vc;class Ga{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let l=null;const u=i.expectedType;u&&u.kind!=="value"&&(l=u);const p=[];for(const b of e.slice(1)){const T=i.parse(b,1+p.length,l,void 0,{typeAnnotation:"omit"});if(!T)return null;l=l||T.type,p.push(T)}const g=u&&p.some(b=>kt(u,b.type));return new Ga(g?k:l,p)}evaluate(e){let i,l=null,u=0;for(const p of this.args){if(u++,l=p.evaluate(e),l&&l instanceof Js&&!l.available&&(i||(i=l),l=null,u===this.args.length))return i;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var eh=Ga;class Gc{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let p=1;p<e.length-1;p+=2){const g=e[p];if(typeof g!="string")return i.error(`Expected string, but found ${typeof g} instead.`,p);if(/[^a-zA-Z0-9_]/.test(g))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const b=i.parse(e[p+1],p+1);if(!b)return null;l.push([g,b])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,l);return u?new Gc(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,l]of this.bindings)e.push(i,l.serialize());return e.push(this.result.serialize()),e}}var ja=Gc;class pc{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ht),u=i.parse(e[2],2,Pe(i.expectedType||k));return l&&u?new pc(u.type.itemType,l,u):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new bs(`Array index out of bounds: ${i} < 0.`);if(i>=l.length)throw new bs(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i!==Math.floor(i))throw new bs(`Array index must be an integer, but found ${i} instead.`);return l[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var ll=pc;class Ve{constructor(e,i){this.type=vn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,k),u=i.parse(e[2],2,k);return l&&u?ai(l.type,[vn,_n,Ht,rl,k])?new Ve(l,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ze(l.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Zt(i,["boolean","string","number","null"]))throw new bs(`Expected first argument to be of type boolean, string, number or null, but found ${ze(is(i))} instead.`);if(!Zt(l,["string","array"]))throw new bs(`Expected second argument to be of type array or string, but found ${ze(is(l))} instead.`);return l.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ut=Ve;class ii{constructor(e,i,l){this.type=Ht,this.needle=e,this.haystack=i,this.fromIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,k),u=i.parse(e[2],2,k);if(!l||!u)return null;if(!ai(l.type,[vn,_n,Ht,rl,k]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ze(l.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,Ht);return p?new ii(l,u,p):null}return new ii(l,u)}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Zt(i,["boolean","string","number","null"]))throw new bs(`Expected first argument to be of type boolean, string, number or null, but found ${ze(is(i))} instead.`);if(!Zt(l,["string","array"]))throw new bs(`Expected second argument to be of type array or string, but found ${ze(is(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return l.indexOf(i,u)}return l.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ri=ii;class $n{constructor(e,i,l,u,p,g){this.inputType=e,this.type=i,this.input=l,this.cases=u,this.outputs=p,this.otherwise=g}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let l,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const p={},g=[];for(let M=2;M<e.length-1;M+=2){let D=e[M];const O=e[M+1];Array.isArray(D)||(D=[D]);const z=i.concat(M);if(D.length===0)return z.error("Expected at least one branch label.");for(const j of D){if(typeof j!="number"&&typeof j!="string")return z.error("Branch labels must be numbers or strings.");if(typeof j=="number"&&Math.abs(j)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof j=="number"&&Math.floor(j)!==j)return z.error("Numeric branch labels must be integer values.");if(l){if(z.checkSubtype(l,is(j)))return null}else l=is(j);if(p[String(j)]!==void 0)return z.error("Branch labels must be unique.");p[String(j)]=g.length}const G=i.parse(O,M,u);if(!G)return null;u=u||G.type,g.push(G)}const b=i.parse(e[1],1,k);if(!b)return null;const T=i.parse(e[e.length-1],e.length-1,u);return T?b.type.kind!=="value"&&i.concat(1).checkSubtype(l,b.type)?null:new $n(l,u,b,p,g,T):null}evaluate(e){const i=this.input.evaluate(e);return(is(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],u={};for(const g of i){const b=u[this.cases[g]];b===void 0?(u[this.cases[g]]=l.length,l.push([this.cases[g],[g]])):l[b][1].push(g)}const p=g=>this.inputType.kind==="number"?Number(g):g;for(const[g,b]of l)e.push(b.length===1?p(b[0]):b.map(p)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}var cn=$n;class Or{constructor(e,i,l){this.type=e,this.branches=i,this.otherwise=l}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const b=i.parse(e[g],g,vn);if(!b)return null;const T=i.parse(e[g+1],g+1,l);if(!T)return null;u.push([b,T]),l=l||T.type}const p=i.parse(e[e.length-1],e.length-1,l);return p?new Or(l,u,p):null}evaluate(e){for(const[i,l]of this.branches)if(i.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,l]of this.branches)e(i),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ns=Or;class ks{constructor(e,i,l,u){this.type=e,this.input=i,this.beginIndex=l,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,k),u=i.parse(e[2],2,Ht);if(!l||!u)return null;if(!ai(l.type,[Pe(k),_n,k]))return i.error(`Expected first argument to be of type array or string, but found ${ze(l.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,Ht);return p?new ks(l.type,l,u,p):null}return new ks(l.type,l,u)}evaluate(e){const i=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Zt(i,["string","array"]))throw new bs(`Expected first argument to be of type array or string, but found ${ze(is(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(l,u)}return i.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var rs=ks;function Jr(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ra(t,e,i,l){return l.compare(e,i)===0}function hs(t,e,i){const l=t!=="=="&&t!=="!=";return class Ox{constructor(p,g,b){this.type=vn,this.lhs=p,this.rhs=g,this.collator=b,this.hasUntypedArgument=p.type.kind==="value"||g.type.kind==="value"}static parse(p,g){if(p.length!==3&&p.length!==4)return g.error("Expected two or three arguments.");const b=p[0];let T=g.parse(p[1],1,k);if(!T)return null;if(!Jr(b,T.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${ze(T.type)}'.`);let M=g.parse(p[2],2,k);if(!M)return null;if(!Jr(b,M.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${ze(M.type)}'.`);if(T.type.kind!==M.type.kind&&T.type.kind!=="value"&&M.type.kind!=="value")return g.error(`Cannot compare types '${ze(T.type)}' and '${ze(M.type)}'.`);l&&(T.type.kind==="value"&&M.type.kind!=="value"?T=new Xn(M.type,[T]):T.type.kind!=="value"&&M.type.kind==="value"&&(M=new Xn(T.type,[M])));let D=null;if(p.length===4){if(T.type.kind!=="string"&&M.type.kind!=="string"&&T.type.kind!=="value"&&M.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(D=g.parse(p[3],3,$),!D)return null}return new Ox(T,M,D)}evaluate(p){const g=this.lhs.evaluate(p),b=this.rhs.evaluate(p);if(l&&this.hasUntypedArgument){const T=is(g),M=is(b);if(T.kind!==M.kind||T.kind!=="string"&&T.kind!=="number")throw new bs(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${T.kind}, ${M.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const T=is(g),M=is(b);if(T.kind!=="string"||M.kind!=="string")return e(p,g,b)}return this.collator?i(p,g,b,this.collator.evaluate(p)):e(p,g,b)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[t];return this.eachChild(g=>{p.push(g.serialize())}),p}}}const Ne=hs("==",function(t,e,i){return e===i},ra),ft=hs("!=",function(t,e,i){return e!==i},function(t,e,i,l){return!ra(0,e,i,l)}),at=hs("<",function(t,e,i){return e<i},function(t,e,i,l){return l.compare(e,i)<0}),_i=hs(">",function(t,e,i){return e>i},function(t,e,i,l){return l.compare(e,i)>0}),Xi=hs("<=",function(t,e,i){return e<=i},function(t,e,i,l){return l.compare(e,i)<=0}),qn=hs(">=",function(t,e,i){return e>=i},function(t,e,i,l){return l.compare(e,i)>=0});class Wr{constructor(e,i,l,u,p,g){this.type=_n,this.number=e,this.locale=i,this.currency=l,this.unit=u,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const l=i.parse(e[1],1,Ht);if(!l)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=i.parse(u.locale,1,_n),!p))return null;let g=null;if(u.currency&&(g=i.parse(u.currency,1,_n),!g))return null;let b=null;if(u.unit&&(b=i.parse(u.unit,1,_n),!b))return null;let T=null;if(u["min-fraction-digits"]&&(T=i.parse(u["min-fraction-digits"],1,Ht),!T))return null;let M=null;return u["max-fraction-digits"]&&(M=i.parse(u["max-fraction-digits"],1,Ht),!M)?null:new Wr(l,p,g,b,T,M)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class dr{constructor(e){this.type=Ht,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=i.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ze(l.type)} instead.`):new dr(l):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new bs(`Expected value to be of type string or array, but found ${ze(is(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const mu={"==":Ne,"!=":ft,">":_i,"<":at,">=":qn,"<=":Xi,array:Xn,at:ll,boolean:Xn,case:ns,coalesce:eh,collator:Hr,format:ar,image:hu,in:ut,"index-of":Ri,interpolate:Fo,"interpolate-hcl":Fo,"interpolate-lab":Fo,length:dr,let:ja,literal:nc,match:cn,number:Xn,"number-format":Wr,object:Xn,slice:rs,step:_o,string:Xn,"to-boolean":Ol,"to-color":Ol,"to-number":Ol,"to-string":Ol,var:Xu,within:sl};function mr(t,[e,i,l,u]){e=e.evaluate(t),i=i.evaluate(t),l=l.evaluate(t);const p=u?u.evaluate(t):1,g=Ar(e,i,l,p);if(g)throw new bs(g);return new Qi(e/255*p,i/255*p,l/255*p,p)}function En(t,e){return t in e}function qa(t,e){const i=e[t];return i===void 0?null:i}function $s(t){return{type:t}}$o.register(mu,{error:[{kind:"error"},[_n],(t,[e])=>{throw new bs(e.evaluate(t))}],typeof:[_n,[k],(t,[e])=>ze(is(e.evaluate(t)))],"to-rgba":[Pe(Ht,4),[fo],(t,[e])=>e.evaluate(t).toArray()],rgb:[fo,[Ht,Ht,Ht],mr],rgba:[fo,[Ht,Ht,Ht,Ht],mr],has:{type:vn,overloads:[[[_n],(t,[e])=>En(e.evaluate(t),t.properties())],[[_n,C],(t,[e,i])=>En(e.evaluate(t),i.evaluate(t))]]},get:{type:k,overloads:[[[_n],(t,[e])=>qa(e.evaluate(t),t.properties())],[[_n,C],(t,[e,i])=>qa(e.evaluate(t),i.evaluate(t))]]},"feature-state":[k,[_n],(t,[e])=>qa(e.evaluate(t),t.featureState||{})],properties:[C,[],t=>t.properties()],"geometry-type":[_n,[],t=>t.geometryType()],id:[k,[],t=>t.id()],zoom:[Ht,[],t=>t.globals.zoom],pitch:[Ht,[],t=>t.globals.pitch||0],"distance-from-center":[Ht,[],t=>t.distanceFromCenter()],"heatmap-density":[Ht,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ht,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Ht,[],t=>t.globals.skyRadialProgress||0],accumulated:[k,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Ht,$s(Ht),(t,e)=>{let i=0;for(const l of e)i+=l.evaluate(t);return i}],"*":[Ht,$s(Ht),(t,e)=>{let i=1;for(const l of e)i*=l.evaluate(t);return i}],"-":{type:Ht,overloads:[[[Ht,Ht],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Ht],(t,[e])=>-e.evaluate(t)]]},"/":[Ht,[Ht,Ht],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Ht,[Ht,Ht],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Ht,[Ht],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ht,[Ht],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ht,[Ht],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ht,[Ht],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ht,[Ht],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ht,[Ht],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ht,[Ht],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ht,$s(Ht),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Ht,$s(Ht),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Ht,[Ht],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ht,[Ht],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ht,[Ht],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ht,[Ht],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[vn,[_n,k],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[vn,[k],(t,[e])=>t.id()===e.value],"filter-type-==":[vn,[_n],(t,[e])=>t.geometryType()===e.value],"filter-<":[vn,[_n,k],(t,[e,i])=>{const l=t.properties()[e.value],u=i.value;return typeof l==typeof u&&l<u}],"filter-id-<":[vn,[k],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i<l}],"filter->":[vn,[_n,k],(t,[e,i])=>{const l=t.properties()[e.value],u=i.value;return typeof l==typeof u&&l>u}],"filter-id->":[vn,[k],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i>l}],"filter-<=":[vn,[_n,k],(t,[e,i])=>{const l=t.properties()[e.value],u=i.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[vn,[k],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i<=l}],"filter->=":[vn,[_n,k],(t,[e,i])=>{const l=t.properties()[e.value],u=i.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[vn,[k],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i>=l}],"filter-has":[vn,[k],(t,[e])=>e.value in t.properties()],"filter-has-id":[vn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[vn,[Pe(_n)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[vn,[Pe(k)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[vn,[_n,Pe(k)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[vn,[_n,Pe(k)],(t,[e,i])=>function(l,u,p,g){for(;p<=g;){const b=p+g>>1;if(u[b]===l)return!0;u[b]>l?g=b-1:p=b+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:vn,overloads:[[[vn,vn],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[$s(vn),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:vn,overloads:[[[vn,vn],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[$s(vn),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[vn,[vn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[vn,[_n],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[_n,[_n],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[_n,[_n],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[_n,$s(k),(t,e)=>e.map(i=>Qs(i.evaluate(t))).join("")],"resolved-locale":[_n,[$],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Eo=mu;function ds(t){return{result:"success",value:t}}function zs(t){return{result:"error",value:t}}function Tn(t){return t["property-type"]==="data-driven"}function To(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function cl(t){return!!t.expression&&t.expression.interpolated}function on(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function pa(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Ph(t){return t}function mc(t,e){const i=e.type==="color",l=t.stops&&typeof t.stops[0][0]=="object",u=l||!(l||t.property!==void 0),p=t.type||(cl(e)?"exponential":"interval");if(i&&((t=Jo({},t)).stops&&(t.stops=t.stops.map(M=>[M[0],Qi.parse(M[1])])),t.default=Qi.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!$u[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let g,b,T;if(p==="exponential")g=_c;else if(p==="interval")g=ul;else if(p==="categorical"){g=Io,b=Object.create(null);for(const M of t.stops)b[M[0]]=M[1];T=typeof t.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);g=hl}if(l){const M={},D=[];for(let G=0;G<t.stops.length;G++){const j=t.stops[G],X=j[0].zoom;M[X]===void 0&&(M[X]={zoom:X,type:t.type,property:t.property,default:t.default,stops:[]},D.push(X)),M[X].stops.push([j[0].value,j[1]])}const O=[];for(const G of D)O.push([M[G].zoom,mc(M[G],e)]);const z={name:"linear"};return{kind:"composite",interpolationType:z,interpolationFactor:Fo.interpolationFactor.bind(void 0,z),zoomStops:O.map(G=>G[0]),evaluate:({zoom:G},j)=>_c({stops:O,base:t.base},e,G).evaluate(G,j)}}if(u){const M=p==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:Fo.interpolationFactor.bind(void 0,M),zoomStops:t.stops.map(D=>D[0]),evaluate:({zoom:D})=>g(t,e,D,b,T)}}return{kind:"source",evaluate(M,D){const O=D&&D.properties?D.properties[t.property]:void 0;return O===void 0?ma(t.default,e.default):g(t,e,O,b,T)}}}function ma(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function Io(t,e,i,l,u){return ma(typeof i===u?l[i]:void 0,t.default,e.default)}function ul(t,e,i){if(on(i)!=="number")return ma(t.default,e.default);const l=t.stops.length;if(l===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[l-1][0])return t.stops[l-1][1];const u=Fa(t.stops.map(p=>p[0]),i);return t.stops[u][1]}function _c(t,e,i){const l=t.base!==void 0?t.base:1;if(on(i)!=="number")return ma(t.default,e.default);const u=t.stops.length;if(u===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[u-1][0])return t.stops[u-1][1];const p=Fa(t.stops.map(D=>D[0]),i),g=function(D,O,z,G){const j=G-z,X=D-z;return j===0?0:O===1?X/j:(Math.pow(O,X)-1)/(Math.pow(O,j)-1)}(i,l,t.stops[p][0],t.stops[p+1][0]),b=t.stops[p][1],T=t.stops[p+1][1];let M=ol[e.type]||Ph;if(t.colorSpace&&t.colorSpace!=="rgb"){const D=$u[t.colorSpace];M=(O,z)=>D.reverse(D.interpolate(D.forward(O),D.forward(z),g))}return typeof b.evaluate=="function"?{evaluate(...D){const O=b.evaluate.apply(void 0,D),z=T.evaluate.apply(void 0,D);if(O!==void 0&&z!==void 0)return M(O,z,g)}}:M(b,T,g)}function hl(t,e,i){return e.type==="color"?i=Qi.parse(i):e.type==="formatted"?i=Os.fromString(i.toString()):e.type==="resolvedImage"?i=Js.fromString(i.toString()):on(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ma(i,t.default,e.default)}class dl{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new zc,this._defaultValue=i?function(l){return l.type==="color"&&(pa(l.default)||Array.isArray(l.default))?new Qi(0,0,0,0):l.type==="color"?Qi.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,l,u,p,g,b,T){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,l,u,p,g,b,T){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=T||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new bs(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function jc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Eo}function Bl(t,e){const i=new Ku(Eo,[],e?function(u){const p={color:fo,string:_n,number:Ht,enum:_n,boolean:vn,formatted:xe,resolvedImage:Oe};return u.type==="array"?Pe(p[u.value]||k,u.length):p[u.type]}(e):void 0),l=i.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?ds(new dl(l,e)):zs(i.errors)}class th{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Qn(i.expression)}evaluateWithoutErrorHandling(e,i,l,u,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,u,p,g)}evaluate(e,i,l,u,p,g){return this._styleExpression.evaluate(e,i,l,u,p,g)}}class Ha{constructor(e,i,l,u){this.kind=e,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Qn(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,l,u,p,g){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,u,p,g)}evaluate(e,i,l,u,p,g){return this._styleExpression.evaluate(e,i,l,u,p,g)}interpolationFactor(e,i,l){return this.interpolationType?Fo.interpolationFactor(this.interpolationType,e,i,l):0}}function sa(t,e){if((t=Bl(t,e)).result==="error")return t;const i=t.value.expression,l=za(i);if(!l&&!Tn(e))return zs([new Qo("","data expressions not supported")]);const u=ta(i,["zoom","pitch","distance-from-center"]);if(!u&&!To(e))return zs([new Qo("","zoom expressions not supported")]);const p=ih(i);return p||u?p instanceof Qo?zs([p]):p instanceof Fo&&!cl(e)?zs([new Qo("",'"interpolate" expressions cannot be used with this property')]):ds(p?new Ha(l?"camera":"composite",t.value,p.labels,p instanceof Fo?p.interpolation:void 0):new th(l?"constant":"source",t.value)):zs([new Qo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class gc{constructor(e,i){this._parameters=e,this._specification=i,Jo(this,mc(this._parameters,this._specification))}static deserialize(e){return new gc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ih(t){let e=null;if(t instanceof ja)e=ih(t.result);else if(t instanceof eh){for(const i of t.args)if(e=ih(i),e)break}else(t instanceof _o||t instanceof Fo)&&t.input instanceof $o&&t.input.name==="zoom"&&(e=t);return e instanceof Qo||t.eachChild(i=>{const l=ih(i);l instanceof Qo?e=l:!e&&l?e=new Qo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new Qo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ni{constructor(e,i,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function _a(t){const e=t.key,i=t.value,l=t.valueSpec||{},u=t.objectElementValidators||{},p=t.style,g=t.styleSpec;let b=[];const T=on(i);if(T!=="object")return[new ni(e,i,`object expected, ${T} found`)];for(const M in i){const D=M.split(".")[0],O=l[D]||l["*"];let z;u[D]?z=u[D]:l[D]?z=en:u["*"]?z=u["*"]:l["*"]&&(z=en),z?b=b.concat(z({key:(e&&`${e}.`)+M,value:i[M],valueSpec:O,style:p,styleSpec:g,object:i,objectKey:M},i)):b.push(new ni(e,i[M],`unknown property "${M}"`))}for(const M in l)u[M]||l[M].required&&l[M].default===void 0&&i[M]===void 0&&b.push(new ni(e,i,`missing required property "${M}"`));return b}function nh(t){const e=t.value,i=t.valueSpec,l=t.style,u=t.styleSpec,p=t.key,g=t.arrayElementValidator||en;if(on(e)!=="array")return[new ni(p,e,`array expected, ${on(e)} found`)];if(i.length&&e.length!==i.length)return[new ni(p,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new ni(p,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let b={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};u.$version<7&&(b.function=i.function),on(i.value)==="object"&&(b=i.value);let T=[];for(let M=0;M<e.length;M++)T=T.concat(g({array:e,arrayIndex:M,value:e[M],valueSpec:b,style:l,styleSpec:u,key:`${p}[${M}]`}));return T}function _u(t){const e=t.key,i=t.value,l=t.valueSpec;let u=on(i);if(u==="number"&&i!=i&&(u="NaN"),u!=="number")return[new ni(e,i,`number expected, ${u} found`)];if("minimum"in l){let p=l.minimum;if(on(l.minimum)==="array"&&(p=l.minimum[t.arrayIndex]),i<p)return[new ni(e,i,`${i} is less than the minimum value ${p}`)]}if("maximum"in l){let p=l.maximum;if(on(l.maximum)==="array"&&(p=l.maximum[t.arrayIndex]),i>p)return[new ni(e,i,`${i} is greater than the maximum value ${p}`)]}return[]}function qc(t){const e=t.valueSpec,i=qr(t.value.type);let l,u,p,g={};const b=i!=="categorical"&&t.value.property===void 0,T=!b,M=on(t.value.stops)==="array"&&on(t.value.stops[0])==="array"&&on(t.value.stops[0][0])==="object",D=_a({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(G){if(i==="identity")return[new ni(G.key,G.value,'identity function may not have a "stops" property')];let j=[];const X=G.value;return j=j.concat(nh({key:G.key,value:X,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:O})),on(X)==="array"&&X.length===0&&j.push(new ni(G.key,X,"array must have at least one stop")),j},default:function(G){return en({key:G.key,value:G.value,valueSpec:e,style:G.style,styleSpec:G.styleSpec})}}});return i==="identity"&&b&&D.push(new ni(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||D.push(new ni(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!cl(t.valueSpec)&&D.push(new ni(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(T&&!Tn(t.valueSpec)?D.push(new ni(t.key,t.value,"property functions not supported")):b&&!To(t.valueSpec)&&D.push(new ni(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!M||t.value.property!==void 0||D.push(new ni(t.key,t.value,'"property" property is required')),D;function O(G){let j=[];const X=G.value,ie=G.key;if(on(X)!=="array")return[new ni(ie,X,`array expected, ${on(X)} found`)];if(X.length!==2)return[new ni(ie,X,`array length 2 expected, length ${X.length} found`)];if(M){if(on(X[0])!=="object")return[new ni(ie,X,`object expected, ${on(X[0])} found`)];if(X[0].zoom===void 0)return[new ni(ie,X,"object stop key must have zoom")];if(X[0].value===void 0)return[new ni(ie,X,"object stop key must have value")];const pe=qr(X[0].zoom);if(typeof pe!="number")return[new ni(ie,X[0].zoom,"stop zoom values must be numbers")];if(p&&p>pe)return[new ni(ie,X[0].zoom,"stop zoom values must appear in ascending order")];pe!==p&&(p=pe,u=void 0,g={}),j=j.concat(_a({key:`${ie}[0]`,value:X[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:_u,value:z}}))}else j=j.concat(z({key:`${ie}[0]`,value:X[0],valueSpec:{},style:G.style,styleSpec:G.styleSpec},X));return jc(nl(X[1]))?j.concat([new ni(`${ie}[1]`,X[1],"expressions are not allowed in function stops.")]):j.concat(en({key:`${ie}[1]`,value:X[1],valueSpec:e,style:G.style,styleSpec:G.styleSpec}))}function z(G,j){const X=on(G.value),ie=qr(G.value),pe=G.value!==null?G.value:j;if(l){if(X!==l)return[new ni(G.key,pe,`${X} stop domain type must match previous stop domain type ${l}`)]}else l=X;if(X!=="number"&&X!=="string"&&X!=="boolean"&&typeof ie!="number"&&typeof ie!="string"&&typeof ie!="boolean")return[new ni(G.key,pe,"stop domain value must be a number, string, or boolean")];if(X!=="number"&&i!=="categorical"){let we=`number expected, ${X} found`;return Tn(e)&&i===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ni(G.key,pe,we)]}return i!=="categorical"||X!=="number"||typeof ie=="number"&&isFinite(ie)&&Math.floor(ie)===ie?i!=="categorical"&&X==="number"&&typeof ie=="number"&&typeof u=="number"&&u!==void 0&&ie<u?[new ni(G.key,pe,"stop domain values must appear in ascending order")]:(u=ie,i==="categorical"&&ie in g?[new ni(G.key,pe,"stop domain values must be unique")]:(g[ie]=!0,[])):[new ni(G.key,pe,`integer expected, found ${String(ie)}`)]}}function gu(t){const e=(t.expressionContext==="property"?sa:Bl)(nl(t.value),t.valueSpec);if(e.result==="error")return e.value.map(l=>new ni(`${t.key}${l.key}`,t.value,l.message));const i=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!i.outputDefined())return[new ni(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Qn(i))return[new ni(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return fd(i,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ta(i,["zoom","feature-state"]))return[new ni(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!za(i))return[new ni(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fd(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)i.delete(u);if(i.size===0)return[];const l=[];return t instanceof $o&&i.has(t.name)?[new ni(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(u=>{l.push(...fd(u,e))}),l)}function Oh(t){const e=t.key,i=t.value,l=t.valueSpec,u=[];return Array.isArray(l.values)?l.values.indexOf(qr(i))===-1&&u.push(new ni(e,i,`expected one of [${l.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(l.values).indexOf(qr(i))===-1&&u.push(new ni(e,i,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function pd(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!pd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ss(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};pd(t)||(t=yc(t));const i=t;let l=!0;try{l=function(M){if(!Hs(M))return M;let D=nl(M);return rh(D),D=ws(D),D}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const u=st[`filter_${e}`],p=Bl(l,u);let g=null;if(p.result==="error")throw new Error(p.value.map(M=>`${M.key}: ${M.message}`).join(", "));g=(M,D,O)=>p.value.evaluate(M,D,{},O);let b=null,T=null;if(l!==i){const M=Bl(i,u);if(M.result==="error")throw new Error(M.value.map(D=>`${D.key}: ${D.message}`).join(", "));b=(D,O,z,G,j)=>M.value.evaluate(D,O,{},z,void 0,void 0,G,j),T=!za(M.value.expression)}return{filter:g,dynamicFilter:b||void 0,needGeometry:Rh(l),needFeature:!!T}}function ws(t){if(!Array.isArray(t))return t;const e=function(i){if(sh.has(i[0])){for(let l=1;l<i.length;l++)if(Hs(i[l]))return!0}return i}(t);return e===!0?e:e.map(i=>ws(i))}function rh(t){let e=!1;const i=[];if(t[0]==="case"){for(let l=1;l<t.length-1;l+=2)e=e||Hs(t[l]),i.push(t[l+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||Hs(t[1]);for(let l=2;l<t.length-1;l+=2)i.push(t[l+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||Hs(t[1]);for(let l=1;l<t.length-1;l+=2)i.push(t[l+1])}e&&(t.length=0,t.push("any",...i));for(let l=1;l<t.length;l++)rh(t[l])}function Hs(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(Hs(t[i]))return!0;return!1}const sh=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function zp(t,e){return t<e?-1:t>e?1:0}function Rh(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(Rh(t[e]))return!0;return!1}function yc(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?oh(t[1],t[2],"=="):e==="!="?fl(oh(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?oh(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(yc))):e==="all"?["all"].concat(t.slice(1).map(yc)):e==="none"?["all"].concat(t.slice(1).map(yc).map(fl)):e==="in"?Fl(t[1],t.slice(2)):e==="!in"?fl(Fl(t[1],t.slice(2))):e==="has"?yu(t[1]):e==="!has"?fl(yu(t[1])):e!=="within"||t;var i}function oh(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Fl(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(zp)]]:["filter-in-small",t,["literal",e]]}}function yu(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function fl(t){return["!",t]}function vu(t){return pd(nl(t.value))?gu(Jo({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Hc(t)}function Hc(t){const e=t.value,i=t.key;if(on(e)!=="array")return[new ni(i,e,`array expected, ${on(e)} found`)];const l=t.styleSpec;let u,p=[];if(e.length<1)return[new ni(i,e,"filter array must have at least 1 element")];switch(p=p.concat(Oh({key:`${i}[0]`,value:e[0],valueSpec:l.filter_operator,style:t.style,styleSpec:t.styleSpec})),qr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&qr(e[1])==="$type"&&p.push(new ni(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new ni(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=on(e[1]),u!=="string"&&p.push(new ni(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=on(e[g]),qr(e[1])==="$type"?p=p.concat(Oh({key:`${i}[${g}]`,value:e[g],valueSpec:l.geometry_type,style:t.style,styleSpec:t.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&p.push(new ni(`${i}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)p=p.concat(Hc({key:`${i}[${g}]`,value:e[g],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":u=on(e[1]),e.length!==2?p.push(new ni(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&p.push(new ni(`${i}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=on(e[1]),e.length!==2?p.push(new ni(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&p.push(new ni(`${i}[1]`,e[1],`object expected, ${u} found`))}return p}function kh(t,e){const i=t.key,l=t.style,u=t.styleSpec,p=t.value,g=t.objectKey,b=u[`${e}_${t.layerType}`];if(!b)return[];const T=g.match(/^(.*)-transition$/);if(e==="paint"&&T&&b[T[1]]&&b[T[1]].transition)return en({key:i,value:p,valueSpec:u.transition,style:l,styleSpec:u});const M=t.valueSpec||b[g];if(!M)return[new ni(i,p,`unknown property "${g}"`)];let D;if(on(p)==="string"&&Tn(M)&&!M.tokens&&(D=/^{([^}]+)}$/.exec(p)))return[new ni(i,p,`"${g}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const O=[];return t.layerType==="symbol"&&(g==="text-field"&&l&&!l.glyphs&&O.push(new ni(i,p,'use of "text-field" requires a style "glyphs" property')),g==="text-font"&&pa(nl(p))&&qr(p.type)==="identity"&&O.push(new ni(i,p,'"text-font" does not support identity functions'))),O.concat(en({key:t.key,value:p,valueSpec:M,style:l,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:g}))}function uf(t){return kh(t,"paint")}function md(t){return kh(t,"layout")}function _d(t){let e=[];const i=t.value,l=t.key,u=t.style,p=t.styleSpec;i.type||i.ref||e.push(new ni(l,i,'either "type" or "ref" is required'));let g=qr(i.type);const b=qr(i.ref);if(i.id){const T=qr(i.id);for(let M=0;M<t.arrayIndex;M++){const D=u.layers[M];qr(D.id)===T&&e.push(new ni(l,i.id,`duplicate layer id "${i.id}", previously used at line ${D.id.__line__}`))}}if("ref"in i){let T;["type","source","source-layer","filter","layout"].forEach(M=>{M in i&&e.push(new ni(l,i[M],`"${M}" is prohibited for ref layers`))}),u.layers.forEach(M=>{qr(M.id)===b&&(T=M)}),T?T.ref?e.push(new ni(l,i.ref,"ref cannot reference another ref layer")):g=qr(T.type):typeof b=="string"&&e.push(new ni(l,i.ref,`ref layer "${b}" not found`))}else if(g!=="background"&&g!=="sky")if(i.source){const T=u.sources&&u.sources[i.source],M=T&&qr(T.type);T?M==="vector"&&g==="raster"?e.push(new ni(l,i.source,`layer "${i.id}" requires a raster source`)):M==="raster"&&g!=="raster"?e.push(new ni(l,i.source,`layer "${i.id}" requires a vector source`)):M!=="vector"||i["source-layer"]?M==="raster-dem"&&g!=="hillshade"?e.push(new ni(l,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):g!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||M==="geojson"&&T.lineMetrics||e.push(new ni(l,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ni(l,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new ni(l,i.source,`source "${i.source}" not found`))}else e.push(new ni(l,i,'missing required property "source"'));return e=e.concat(_a({key:l,value:i,valueSpec:p.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>en({key:`${l}.type`,value:i.type,valueSpec:p.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:T=>vu(Jo({layerType:g},T)),layout:T=>_a({layer:i,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":M=>md(Jo({layerType:g},M))}}),paint:T=>_a({layer:i,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":M=>uf(Jo({layerType:g},M))}})}})),e}function xu(t){const e=t.value,i=t.key,l=on(e);return l!=="string"?[new ni(i,e,`string expected, ${l} found`)]:[]}const Wc={promoteId:function({key:t,value:e}){if(on(e)==="string")return xu({key:t,value:e});{const i=[];for(const l in e)i.push(...xu({key:`${t}.${l}`,value:e[l]}));return i}}};function Nl(t){const e=t.value,i=t.key,l=t.styleSpec,u=t.style;if(!e.type)return[new ni(i,e,'"type" is required')];const p=qr(e.type);let g;switch(p){case"vector":case"raster":case"raster-dem":return g=_a({key:i,value:e,valueSpec:l[`source_${p.replace("-","_")}`],style:t.style,styleSpec:l,objectElementValidators:Wc}),g;case"geojson":if(g=_a({key:i,value:e,valueSpec:l.source_geojson,style:u,styleSpec:l,objectElementValidators:Wc}),e.cluster)for(const b in e.clusterProperties){const[T,M]=e.clusterProperties[b],D=typeof T=="string"?[T,["accumulated"],["get",b]]:T;g.push(...gu({key:`${i}.${b}.map`,value:M,expressionContext:"cluster-map"})),g.push(...gu({key:`${i}.${b}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return g;case"video":return _a({key:i,value:e,valueSpec:l.source_video,style:u,styleSpec:l});case"image":return _a({key:i,value:e,valueSpec:l.source_image,style:u,styleSpec:l});case"canvas":return[new ni(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Oh({key:`${i}.type`,value:e.type,valueSpec:{values:gd(l)},style:u,styleSpec:l})}}function gd(t){return t.source.reduce((e,i)=>{const l=t[i];return l.type.type==="enum"&&(e=e.concat(Object.keys(l.type.values))),e},[])}function ne(t){const e=t.value,i=t.styleSpec,l=i.light,u=t.style;let p=[];const g=on(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new ni("light",e,`object expected, ${g} found`)]),p;for(const b in e){const T=b.match(/^(.*)-transition$/);p=p.concat(T&&l[T[1]]&&l[T[1]].transition?en({key:b,value:e[b],valueSpec:i.transition,style:u,styleSpec:i}):l[b]?en({key:b,value:e[b],valueSpec:l[b],style:u,styleSpec:i}):[new ni(b,e[b],`unknown property "${b}"`)])}return p}function vc(t){const e=t.value,i=t.key,l=t.style,u=t.styleSpec,p=u.terrain;let g=[];const b=on(e);if(e===void 0)return g;if(b!=="object")return g=g.concat([new ni("terrain",e,`object expected, ${b} found`)]),g;for(const T in e){const M=T.match(/^(.*)-transition$/);g=g.concat(M&&p[M[1]]&&p[M[1]].transition?en({key:T,value:e[T],valueSpec:u.transition,style:l,styleSpec:u}):p[T]?en({key:T,value:e[T],valueSpec:p[T],style:l,styleSpec:u}):[new ni(T,e[T],`unknown property "${T}"`)])}if(e.source){const T=l.sources&&l.sources[e.source],M=T&&qr(T.type);T?M!=="raster-dem"&&g.push(new ni(i,e.source,`terrain cannot be used with a source of type ${String(M)}, it only be used with a "raster-dem" source type`)):g.push(new ni(i,e.source,`source "${e.source}" not found`))}else g.push(new ni(i,e,'terrain is missing required property "source"'));return g}function ah(t){const e=t.value,i=t.style,l=t.styleSpec,u=l.fog;let p=[];const g=on(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new ni("fog",e,`object expected, ${g} found`)]),p;for(const b in e){const T=b.match(/^(.*)-transition$/);p=p.concat(T&&u[T[1]]&&u[T[1]].transition?en({key:b,value:e[b],valueSpec:l.transition,style:i,styleSpec:l}):u[b]?en({key:b,value:e[b],valueSpec:u[b],style:i,styleSpec:l}):[new ni(b,e[b],`unknown property "${b}"`)])}return p}const Mo={"*":()=>[],array:nh,boolean:function(t){const e=t.value,i=t.key,l=on(e);return l!=="boolean"?[new ni(i,e,`boolean expected, ${l} found`)]:[]},number:_u,color:function(t){const e=t.key,i=t.value,l=on(i);return l!=="string"?[new ni(e,i,`color expected, ${l} found`)]:Qt(i)===null?[new ni(e,i,`color expected, "${i}" found`)]:[]},enum:Oh,filter:vu,function:qc,layer:_d,object:_a,source:Nl,light:ne,terrain:vc,fog:ah,string:xu,formatted:function(t){return xu(t).length===0?[]:gu(t)},resolvedImage:function(t){return xu(t).length===0?[]:gu(t)},projection:function(t){const e=t.value,i=t.styleSpec,l=i.projection,u=t.style;let p=[];const g=on(e);if(g==="object")for(const b in e)p=p.concat(en({key:b,value:e[b],valueSpec:l[b],style:u,styleSpec:i}));else g!=="string"&&(p=p.concat([new ni("projection",e,`object or string expected, ${g} found`)]));return p}};function en(t){const e=t.value,i=t.valueSpec,l=t.styleSpec;return i.expression&&pa(qr(e))?qc(t):i.expression&&jc(nl(e))?gu(t):i.type&&Mo[i.type]?Mo[i.type](t):_a(Jo({},t,{valueSpec:i.type?l[i.type]:i}))}function Bp(t){const e=t.value,i=t.key,l=xu(t);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new ni(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new ni(i,e,'"glyphs" url must include a "{range}" token'))),l}function hf(t,e=st){return Ul(en({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Bp,"*":()=>[]}}))}const Fp=t=>Ul(uf(t)),xc=t=>Ul(md(t));function Ul(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function df(t,e){let i=!1;if(e&&e.length)for(const l of e)t.fire(new Yo(new Error(l.message))),i=!0;return i}var bu=pl;function pl(t,e,i){var l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(i=u[2]);for(var p=0;p<this.d*this.d;p++){var g=u[3+p],b=u[3+p+1];l.push(g===b?null:u.subarray(g,b))}var T=u[3+l.length+1];this.keys=u.subarray(u[3+l.length],T),this.bboxes=u.subarray(T),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var M=0;M<this.d*this.d;M++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var D=i/e*t;this.min=-D,this.max=t+D}pl.prototype.insert=function(t,e,i,l,u){this._forEachCell(e,i,l,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(u)},pl.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},pl.prototype._insertCell=function(t,e,i,l,u,p){this.cells[u].push(p)},pl.prototype.query=function(t,e,i,l,u){var p=this.min,g=this.max;if(t<=p&&e<=p&&g<=i&&g<=l&&!u)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(t,e,i,l,this._queryCell,b,{},u),b},pl.prototype._queryCell=function(t,e,i,l,u,p,g,b){var T=this.cells[u];if(T!==null)for(var M=this.keys,D=this.bboxes,O=0;O<T.length;O++){var z=T[O];if(g[z]===void 0){var G=4*z;(b?b(D[G+0],D[G+1],D[G+2],D[G+3]):t<=D[G+2]&&e<=D[G+3]&&i>=D[G+0]&&l>=D[G+1])?(g[z]=!0,p.push(M[z])):g[z]=!1}}},pl.prototype._forEachCell=function(t,e,i,l,u,p,g,b){for(var T=this._convertToCellCoord(t),M=this._convertToCellCoord(e),D=this._convertToCellCoord(i),O=this._convertToCellCoord(l),z=T;z<=D;z++)for(var G=M;G<=O;G++){var j=this.d*G+z;if((!b||b(this._convertFromCellCoord(z),this._convertFromCellCoord(G),this._convertFromCellCoord(z+1),this._convertFromCellCoord(G+1)))&&u.call(this,t,e,i,l,j,p,g,b))return}},pl.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},pl.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},pl.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,l=0;l<this.cells.length;l++)i+=this.cells[l].length;var u=new Int32Array(e+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var p=e,g=0;g<t.length;g++){var b=t[g];u[3+g]=p,u.set(b,p),p+=b.length}return u[3+t.length]=p,u.set(this.keys,p),u[3+t.length+1]=p+=this.keys.length,u.set(this.bboxes,p),p+=this.bboxes.length,u.buffer};const zh={};function ri(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),zh[e]={klass:t,omit:i.omit||[]}}ri(Object,"Object"),bu.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},bu.deserialize=function(t){return new bu(t.buffer)},Object.defineProperty(bu,"name",{value:"Grid"}),ri(bu,"Grid"),ri(Qi,"Color"),ri(Error,"Error"),ri(fi,"AJAXError"),ri(Js,"ResolvedImage"),ri(gc,"StylePropertyFunction"),ri(dl,"StyleExpression",{omit:["_evaluator"]}),ri(Ha,"ZoomDependentExpression"),ri(th,"ZoomConstantExpression"),ri($o,"CompoundExpression",{omit:["_evaluate"]});for(const t in Eo)zh[Eo[t]._classRegistryKey]||ri(Eo[t],`Expression${t}`);function ff(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function lh(t){return I.ImageBitmap&&t instanceof I.ImageBitmap}function ch(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ff(t)||lh(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof I.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const l of t)i.push(ch(l,e));return i}if(typeof t=="object"){const i=t.constructor,l=i._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const u=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const p in t)t.hasOwnProperty(p)&&(zh[l].omit.indexOf(p)>=0||(u[p]=ch(t[p],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof t)}function uh(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ff(t)||lh(t)||ArrayBuffer.isView(t)||t instanceof I.ImageData)return t;if(Array.isArray(t))return t.map(uh);if(typeof t=="object"){const e=t.$name||"Object",{klass:i}=zh[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const l=Object.create(i.prototype);for(const u of Object.keys(t))u!=="$name"&&(l[u]=uh(t[u]));return l}throw new Error("can't deserialize object of type "+typeof t)}const hh=t=>t>=1536&&t<=1791,ml=t=>t>=1872&&t<=1919,yd=t=>t>=2208&&t<=2303,pf=t=>t>=11904&&t<=12031,vd=t=>t>=12032&&t<=12255,xd=t=>t>=12272&&t<=12287,dh=t=>t>=12288&&t<=12351,_l=t=>t>=12352&&t<=12447,wu=t=>t>=12448&&t<=12543,Bh=t=>t>=12544&&t<=12591,ga=t=>t>=12704&&t<=12735,mf=t=>t>=12736&&t<=12783,bd=t=>t>=12784&&t<=12799,_f=t=>t>=12800&&t<=13055,gf=t=>t>=13056&&t<=13311,yf=t=>t>=13312&&t<=19903,Fh=t=>t>=19968&&t<=40959,wd=t=>t>=40960&&t<=42127,vf=t=>t>=42128&&t<=42191,xf=t=>t>=44032&&t<=55215,Nh=t=>t>=63744&&t<=64255,bc=t=>t>=64336&&t<=65023,wc=t=>t>=65040&&t<=65055,f=t=>t>=65072&&t<=65103,n=t=>t>=65104&&t<=65135,c=t=>t>=65136&&t<=65279,m=t=>t>=65280&&t<=65519;function x(t){for(const e of t)if(L(e.charCodeAt(0)))return!0;return!1}function w(t){for(const e of t)if(!A(e.charCodeAt(0)))return!1;return!0}function A(t){return!(hh(t)||ml(t)||yd(t)||bc(t)||c(t))}function L(t){return!(t!==746&&t!==747&&(t<4352||!(ga(t)||Bh(t)||f(t)&&!(t>=65097&&t<=65103)||Nh(t)||gf(t)||pf(t)||mf(t)||!(!dh(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||yf(t)||Fh(t)||_f(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||xf(t)||_l(t)||xd(t)||(e=>e>=12688&&e<=12703)(t)||vd(t)||bd(t)||wu(t)&&t!==12540||!(!m(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!n(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||wc(t)||(e=>e>=19904&&e<=19967)(t)||wd(t)||vf(t))))}function P(t){return!(L(t)||function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||dh(e)||wu(e)||(i=>i>=57344&&i<=63743)(e)||f(e)||n(e)||m(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function B(t){return t>=1424&&t<=2303||bc(t)||c(t)}function F(t,e){return!(!e&&B(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(i=>i>=6016&&i<=6143)(t))}function H(t){for(const e of t)if(B(e.charCodeAt(0)))return!0;return!1}const ee="deferred",se="loading",re="loaded";let oe=null,le="unavailable",J=null;const me=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(le="error"),oe&&oe(t)};function fe(){ge.fire(new In("pluginStateChange",{pluginStatus:le,pluginURL:J}))}const ge=new Ys,Ae=function(){return le},Te=function(){if(le!==ee||!J)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");le=se,fe(),J&&ls({url:J},t=>{t?me(t):(le=re,fe())})},De={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>le===re||De.applyArabicShaping!=null,isLoading:()=>le===se,setState(t){le=t.pluginStatus,J=t.pluginURL},isParsed:()=>De.applyArabicShaping!=null&&De.processBidirectionalText!=null&&De.processStyledBidirectionalText!=null,getPluginURL:()=>J};class He{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,l){for(const u of i)if(!F(u.charCodeAt(0),l))return!1;return!0}(e,De.isLoaded())}}class We{constructor(e,i){this.property=e,this.value=i,this.expression=function(l,u){if(pa(l))return new gc(l,u);if(jc(l)){const p=sa(l,u);if(p.result==="error")throw new Error(p.value.map(g=>`${g.key}: ${g.message}`).join(", "));return p.value}{let p=l;return typeof l=="string"&&u.type==="color"&&(p=Qi.parse(l)),{kind:"constant",evaluate:()=>p}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,l){return this.property.possiblyEvaluate(this,e,i,l)}}class Qe{constructor(e){this.property=e,this.value=new We(e,void 0)}transitioned(e,i){return new Xe(this.property,this.value,i,Gi({},e.transition,this.transition),e.now)}untransitioned(){return new Xe(this.property,this.value,null,{},0)}}class Ut{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return It(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Qe(this._values[e].property)),this._values[e].value=new We(this._values[e].property,i===null?void 0:It(i))}getTransition(e){return It(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Qe(this._values[e].property)),this._values[e].transition=It(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const l=new pt(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,i._values[u]);return l}untransitioned(){const e=new pt(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Xe{constructor(e,i,l,u,p){const g=u.delay||0,b=u.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+g,this.end=this.begin+b,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,i,l){const u=e.now||0,p=this.value.possiblyEvaluate(e,i,l),g=this.prior;if(g){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return g.possiblyEvaluate(e,i,l);{const b=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,i,l),p,Nt(b))}}return p}}class pt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,l){const u=new Ye(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,l);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class it{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return It(this._values[e].value)}setValue(e,i){this._values[e]=new We(this._values[e].property,i===null?void 0:It(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l)}return e}possiblyEvaluate(e,i,l){const u=new Ye(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,l);return u}}class Ct{constructor(e,i,l){this.property=e,this.value=i,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,l,u){return this.property.evaluate(this.value,this.parameters,e,i,l,u)}}class Ye{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ge{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,l){const u=ol[this.specification.type];return u?u(e,i,l):e}}class tt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,l,u){return new Ct(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},l,u)}:e.expression,i)}interpolate(e,i,l){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Ct(this,{kind:"constant",value:void 0},e.parameters);const u=ol[this.specification.type];return u?new Ct(this,{kind:"constant",value:u(e.value.value,i.value.value,l)},e.parameters):e}evaluate(e,i,l,u,p,g){return e.kind==="constant"?e.value:e.evaluate(i,l,u,p,g)}}class bt{constructor(e){this.specification=e}possiblyEvaluate(e,i,l,u){return!!e.expression.evaluate(i,null,{},l,u)}interpolate(){return!1}}class At{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new He(0,{});for(const l in e){const u=e[l];u.specification.overridable&&this.overridableProperties.push(l);const p=this.defaultPropertyValues[l]=new We(u,void 0),g=this.defaultTransitionablePropertyValues[l]=new Qe(u);this.defaultTransitioningPropertyValues[l]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=p.possiblyEvaluate(i)}}}function bi(t,e){return 256*(t=dt(Math.floor(t),0,255))+dt(Math.floor(e),0,255)}ri(tt,"DataDrivenProperty"),ri(Ge,"DataConstantProperty"),ri(bt,"ColorRampProperty");const fn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class di{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class si{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ti(t,e=1){let i=0,l=0;return{members:t.map(u=>{const p=fn[u.type].BYTES_PER_ELEMENT,g=i=Mn(i,Math.max(e,p)),b=u.components||1;return l=Math.max(l,p),i+=p*b,{name:u.name,type:u.type,components:b,offset:g}}),size:Mn(i,Math.max(l,e)),alignment:e}}function Mn(t,e){return Math.ceil(t/e)*e}class Li extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=l,e}}Li.prototype.bytesPerElement=4,ri(Li,"StructArrayLayout2i4");class Jn extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=l,this.int16[p+2]=u,e}}Jn.prototype.bytesPerElement=6,ri(Jn,"StructArrayLayout3i6");class or extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,u)}emplace(e,i,l,u,p){const g=4*e;return this.int16[g+0]=i,this.int16[g+1]=l,this.int16[g+2]=u,this.int16[g+3]=p,e}}or.prototype.bytesPerElement=8,ri(or,"StructArrayLayout4i8");class br extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,p,g,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,l,u,p,g,b)}emplace(e,i,l,u,p,g,b,T){const M=6*e,D=12*e,O=3*e;return this.int16[M+0]=i,this.int16[M+1]=l,this.uint8[D+4]=u,this.uint8[D+5]=p,this.uint8[D+6]=g,this.uint8[D+7]=b,this.float32[O+2]=T,e}}br.prototype.bytesPerElement=12,ri(br,"StructArrayLayout2i4ub1f12");class lr extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,u)}emplace(e,i,l,u,p){const g=4*e;return this.float32[g+0]=i,this.float32[g+1]=l,this.float32[g+2]=u,this.float32[g+3]=p,e}}lr.prototype.bytesPerElement=16,ri(lr,"StructArrayLayout4f16");class os extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,l,u,p)}emplace(e,i,l,u,p,g){const b=6*e,T=3*e;return this.uint16[b+0]=i,this.uint16[b+1]=l,this.uint16[b+2]=u,this.uint16[b+3]=p,this.float32[T+2]=g,e}}os.prototype.bytesPerElement=12,ri(os,"StructArrayLayout4ui1f12");class Ao extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,u)}emplace(e,i,l,u,p){const g=4*e;return this.uint16[g+0]=i,this.uint16[g+1]=l,this.uint16[g+2]=u,this.uint16[g+3]=p,e}}Ao.prototype.bytesPerElement=8,ri(Ao,"StructArrayLayout4ui8");class ya extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,p,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,l,u,p,g)}emplace(e,i,l,u,p,g,b){const T=6*e;return this.int16[T+0]=i,this.int16[T+1]=l,this.int16[T+2]=u,this.int16[T+3]=p,this.int16[T+4]=g,this.int16[T+5]=b,e}}ya.prototype.bytesPerElement=12,ri(ya,"StructArrayLayout6i12");class va extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,p,g,b,T,M,D,O,z){const G=this.length;return this.resize(G+1),this.emplace(G,e,i,l,u,p,g,b,T,M,D,O,z)}emplace(e,i,l,u,p,g,b,T,M,D,O,z,G){const j=12*e;return this.int16[j+0]=i,this.int16[j+1]=l,this.int16[j+2]=u,this.int16[j+3]=p,this.uint16[j+4]=g,this.uint16[j+5]=b,this.uint16[j+6]=T,this.uint16[j+7]=M,this.int16[j+8]=D,this.int16[j+9]=O,this.int16[j+10]=z,this.int16[j+11]=G,e}}va.prototype.bytesPerElement=24,ri(va,"StructArrayLayout4i4ui4i24");class Rr extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,p,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,l,u,p,g)}emplace(e,i,l,u,p,g,b){const T=10*e,M=5*e;return this.int16[T+0]=i,this.int16[T+1]=l,this.int16[T+2]=u,this.float32[M+2]=p,this.float32[M+3]=g,this.float32[M+4]=b,e}}Rr.prototype.bytesPerElement=20,ri(Rr,"StructArrayLayout3i3f20");class fr extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}fr.prototype.bytesPerElement=4,ri(fr,"StructArrayLayout1ul4");class Hn extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,p,g,b,T,M,D,O,z,G){const j=this.length;return this.resize(j+1),this.emplace(j,e,i,l,u,p,g,b,T,M,D,O,z,G)}emplace(e,i,l,u,p,g,b,T,M,D,O,z,G,j){const X=20*e,ie=10*e;return this.int16[X+0]=i,this.int16[X+1]=l,this.int16[X+2]=u,this.int16[X+3]=p,this.int16[X+4]=g,this.float32[ie+3]=b,this.float32[ie+4]=T,this.float32[ie+5]=M,this.float32[ie+6]=D,this.int16[X+14]=O,this.uint32[ie+8]=z,this.uint16[X+18]=G,this.uint16[X+19]=j,e}}Hn.prototype.bytesPerElement=40,ri(Hn,"StructArrayLayout5i4f1i1ul2ui40");class Qr extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,p,g,b){const T=this.length;return this.resize(T+1),this.emplace(T,e,i,l,u,p,g,b)}emplace(e,i,l,u,p,g,b,T){const M=8*e;return this.int16[M+0]=i,this.int16[M+1]=l,this.int16[M+2]=u,this.int16[M+4]=p,this.int16[M+5]=g,this.int16[M+6]=b,this.int16[M+7]=T,e}}Qr.prototype.bytesPerElement=16,ri(Qr,"StructArrayLayout3i2i2i16");class eo extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,l,u,p)}emplace(e,i,l,u,p,g){const b=4*e,T=8*e;return this.float32[b+0]=i,this.float32[b+1]=l,this.float32[b+2]=u,this.int16[T+6]=p,this.int16[T+7]=g,e}}eo.prototype.bytesPerElement=16,ri(eo,"StructArrayLayout2f1f2i16");class Sr extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,u)}emplace(e,i,l,u,p){const g=12*e,b=3*e;return this.uint8[g+0]=i,this.uint8[g+1]=l,this.float32[b+1]=u,this.float32[b+2]=p,e}}Sr.prototype.bytesPerElement=12,ri(Sr,"StructArrayLayout2ub2f12");class Ws extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=l,this.float32[p+2]=u,e}}Ws.prototype.bytesPerElement=12,ri(Ws,"StructArrayLayout3f12");class to extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=l,this.uint16[p+2]=u,e}}to.prototype.bytesPerElement=6,ri(to,"StructArrayLayout3ui6");class gl extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,p,g,b,T,M,D,O,z,G,j,X,ie,pe,we,de,be,Se){const Me=this.length;return this.resize(Me+1),this.emplace(Me,e,i,l,u,p,g,b,T,M,D,O,z,G,j,X,ie,pe,we,de,be,Se)}emplace(e,i,l,u,p,g,b,T,M,D,O,z,G,j,X,ie,pe,we,de,be,Se,Me){const $e=30*e,Je=15*e,ht=60*e;return this.int16[$e+0]=i,this.int16[$e+1]=l,this.int16[$e+2]=u,this.float32[Je+2]=p,this.float32[Je+3]=g,this.uint16[$e+8]=b,this.uint16[$e+9]=T,this.uint32[Je+5]=M,this.uint32[Je+6]=D,this.uint32[Je+7]=O,this.uint16[$e+16]=z,this.uint16[$e+17]=G,this.uint16[$e+18]=j,this.float32[Je+10]=X,this.float32[Je+11]=ie,this.uint8[ht+48]=pe,this.uint8[ht+49]=we,this.uint8[ht+50]=de,this.uint32[Je+13]=be,this.int16[$e+28]=Se,this.uint8[ht+58]=Me,e}}gl.prototype.bytesPerElement=60,ri(gl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Eu extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,p,g,b,T,M,D,O,z,G,j,X,ie,pe,we,de,be,Se,Me,$e,Je,ht,Rt,nt,mt,xt,Pt){const zt=this.length;return this.resize(zt+1),this.emplace(zt,e,i,l,u,p,g,b,T,M,D,O,z,G,j,X,ie,pe,we,de,be,Se,Me,$e,Je,ht,Rt,nt,mt,xt,Pt)}emplace(e,i,l,u,p,g,b,T,M,D,O,z,G,j,X,ie,pe,we,de,be,Se,Me,$e,Je,ht,Rt,nt,mt,xt,Pt,zt){const rt=38*e,Kt=19*e;return this.int16[rt+0]=i,this.int16[rt+1]=l,this.int16[rt+2]=u,this.float32[Kt+2]=p,this.float32[Kt+3]=g,this.int16[rt+8]=b,this.int16[rt+9]=T,this.int16[rt+10]=M,this.int16[rt+11]=D,this.int16[rt+12]=O,this.int16[rt+13]=z,this.uint16[rt+14]=G,this.uint16[rt+15]=j,this.uint16[rt+16]=X,this.uint16[rt+17]=ie,this.uint16[rt+18]=pe,this.uint16[rt+19]=we,this.uint16[rt+20]=de,this.uint16[rt+21]=be,this.uint16[rt+22]=Se,this.uint16[rt+23]=Me,this.uint16[rt+24]=$e,this.uint16[rt+25]=Je,this.uint16[rt+26]=ht,this.uint16[rt+27]=Rt,this.uint16[rt+28]=nt,this.uint32[Kt+15]=mt,this.float32[Kt+16]=xt,this.float32[Kt+17]=Pt,this.float32[Kt+18]=zt,e}}Eu.prototype.bytesPerElement=76,ri(Eu,"StructArrayLayout3i2f6i15ui1ul3f76");class So extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}So.prototype.bytesPerElement=4,ri(So,"StructArrayLayout1f4");class rn extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,p){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,l,u,p)}emplace(e,i,l,u,p,g){const b=5*e;return this.float32[b+0]=i,this.float32[b+1]=l,this.float32[b+2]=u,this.float32[b+3]=p,this.float32[b+4]=g,e}}rn.prototype.bytesPerElement=20,ri(rn,"StructArrayLayout5f20");class Vl extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,u)}emplace(e,i,l,u,p){const g=6*e;return this.uint32[3*e+0]=i,this.uint16[g+2]=l,this.uint16[g+3]=u,this.uint16[g+4]=p,e}}Vl.prototype.bytesPerElement=12,ri(Vl,"StructArrayLayout1ul3ui12");class Ec extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=l,e}}Ec.prototype.bytesPerElement=4,ri(Ec,"StructArrayLayout2ui4");class xa extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}xa.prototype.bytesPerElement=2,ri(xa,"StructArrayLayout1ui2");class Zc extends si{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=l,e}}Zc.prototype.bytesPerElement=8,ri(Zc,"StructArrayLayout2f8");class f_ extends di{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}f_.prototype.size=40;class Np extends Hn{get(e){return new f_(this,e)}}ri(Np,"CollisionBoxArray");class Wa extends di{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Wa.prototype.size=60;class p_ extends gl{get(e){return new Wa(this,e)}}ri(p_,"PlacedSymbolArray");class Ed extends di{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ed.prototype.size=76;class bf extends Eu{get(e){return new Ed(this,e)}}ri(bf,"SymbolInstanceArray");class Up extends So{getoffsetX(e){return this.float32[1*e+0]}}ri(Up,"GlyphOffsetArray");class Vp extends Li{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ri(Vp,"SymbolLineVertexArray");class ba extends di{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ba.prototype.size=12;class Xc extends Vl{get(e){return new ba(this,e)}}ri(Xc,"FeatureIndexArray");class wf extends Ec{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ri(wf,"FillExtrusionCentroidArray");const m_=Ti([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ef=Ti([{name:"a_dash",components:4,type:"Uint16"}]);var Tu={},Gp={get exports(){return Tu},set exports(t){Tu=t}},Tf={};({get exports(){return Tf},set exports(t){Tf=t}}).exports=function(t,e){var i,l,u,p,g,b,T,M;for(l=t.length-(i=3&t.length),u=e,g=3432918353,b=461845907,M=0;M<l;)T=255&t.charCodeAt(M)|(255&t.charCodeAt(++M))<<8|(255&t.charCodeAt(++M))<<16|(255&t.charCodeAt(++M))<<24,++M,u=27492+(65535&(p=5*(65535&(u=(u^=T=(65535&(T=(T=(65535&T)*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(T=0,i){case 3:T^=(255&t.charCodeAt(M+2))<<16;case 2:T^=(255&t.charCodeAt(M+1))<<8;case 1:u^=T=(65535&(T=(T=(65535&(T^=255&t.charCodeAt(M)))*g+(((T>>>16)*g&65535)<<16)&4294967295)<<15|T>>>17))*b+(((T>>>16)*b&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var Td={};({get exports(){return Td},set exports(t){Td=t}}).exports=function(t,e){for(var i,l=t.length,u=e^l,p=0;l>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(p)|(255&t.charCodeAt(++p))<<8|(255&t.charCodeAt(++p))<<16|(255&t.charCodeAt(++p))<<24))+((1540483477*(i>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),l-=4,++p;switch(l){case 3:u^=(255&t.charCodeAt(p+2))<<16;case 2:u^=(255&t.charCodeAt(p+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(p)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var If=Tf,Iu=Td;Gp.exports=If,Tu.murmur3=If,Tu.murmur2=Iu;class Mf{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,l,u){this.ids.push(Kc(e)),this.positions.push(i,l,u)}getPositions(e){const i=Kc(e);let l=0,u=this.ids.length-1;for(;l<u;){const g=l+u>>1;this.ids[g]>=i?u=g:l=g+1}const p=[];for(;this.ids[l]===i;)p.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return p}static serialize(e,i){const l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Af(l,u,0,l.length-1),i&&i.push(l.buffer,u.buffer),{ids:l,positions:u}}static deserialize(e){const i=new Mf;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Kc(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Tu(String(t))}function Af(t,e,i,l){for(;i<l;){const u=t[i+l>>1];let p=i-1,g=l+1;for(;;){do p++;while(t[p]<u);do g--;while(t[g]>u);if(p>=g)break;Id(t,p,g),Id(e,3*p,3*g),Id(e,3*p+1,3*g+1),Id(e,3*p+2,3*g+2)}g-i<l-g?(Af(t,e,i,g),i=g+1):(Af(t,e,g+1,l),l=g)}}function Id(t,e,i){const l=t[e];t[e]=t[i],t[i]=l}ri(Mf,"FeaturePositionMap");class Gl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Sf extends Gl{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class __ extends Gl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class g_ extends Gl{constructor(e){super(e),this.current=Qi.transparent}set(e,i,l){this.fetchUniformLocation(e,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const y_=new Float32Array(16),v_=new Float32Array(9),Dy=new Float32Array(4);function Cf(t){return[bi(255*t.r,255*t.g),bi(255*t.b,255*t.a)]}class Uh{constructor(e,i,l){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=l}setUniform(e,i,l,u,p){i.set(e,p,u.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new g_(e):new Sf(e)}}class io{constructor(e,i){this.uniformNames=i.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,l,u,p){const g=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;g&&i.set(e,p,g)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new __(e):new Sf(e)}}class go{constructor(e,i,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,l,u,p,g){const b=this.paintVertexArray.length,T=this.expression.evaluate(new He(0),i,{},p,u,g);this.paintVertexArray.resize(e),this._setPaintValue(b,e,T)}updatePaintArray(e,i,l,u,p){const g=this.expression.evaluate({zoom:0},l,u,void 0,p);this._setPaintValue(e,i,g)}_setPaintValue(e,i,l){if(this.type==="color"){const u=Cf(l);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jl{constructor(e,i,l,u,p,g){this.expression=e,this.uniformNames=i.map(b=>`u_${b}_t`),this.type=l,this.useIntegerZoom=u,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=i.map(b=>({name:`a_${b}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,i,l,u,p,g){const b=this.expression.evaluate(new He(this.zoom),i,{},p,u,g),T=this.expression.evaluate(new He(this.zoom+1),i,{},p,u,g),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,b,T)}updatePaintArray(e,i,l,u,p){const g=this.expression.evaluate({zoom:this.zoom},l,u,void 0,p),b=this.expression.evaluate({zoom:this.zoom+1},l,u,void 0,p);this._setPaintValue(e,i,g,b)}_setPaintValue(e,i,l,u){if(this.type==="color"){const p=Cf(l),g=Cf(u);for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,p[0],p[1],g[0],g[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,l,u,p){const g=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,b=dt(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);i.set(e,p,b)}getBinding(e,i){return new Sf(e)}}class Mu{constructor(e,i,l,u,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(l==="array"?Ef:m_).members;for(let g=0;g<i.length;++g);this.paintVertexArray=new u}populatePaintArray(e,i,l){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(e,i,l,u,p,g){this._setPaintValues(e,i,l.patterns&&l.patterns[this.layerId],g)}_setPaintValues(e,i,l,u){if(!u||!l)return;const p=u[l];if(!p)return;const{tl:g,br:b,pixelRatio:T}=p;for(let M=e;M<i;M++)this.paintVertexArray.emplace(M,g[0],g[1],b[0],b[1],T)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ql{constructor(e,i,l=()=>!0){this.binders={},this._buffers=[];const u=[];for(const p in e.paint._values){if(!l(p))continue;const g=e.paint.get(p);if(!(g instanceof Ct&&Tn(g.property.specification)))continue;const b=b_(p,e.type),T=g.value,M=g.property.specification.type,D=g.property.useIntegerZoom,O=p==="line-dasharray"||p.endsWith("pattern"),z=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(T.kind!=="constant"||z)if(T.kind==="source"||z||O){const G=fh(p,M,"source");this.binders[p]=O?new Mu(T,b,M,G,e.id):new go(T,b,M,G),u.push(`/a_${p}`)}else{const G=fh(p,M,"composite");this.binders[p]=new jl(T,b,M,D,i,G),u.push(`/z_${p}`)}else this.binders[p]=O?new io(T.value,b):new Uh(T.value,b,M),u.push(`/u_${p}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof go||i instanceof jl?i.maxValue:0}populatePaintArrays(e,i,l,u,p,g){for(const b in this.binders){const T=this.binders[b];(T instanceof go||T instanceof jl||T instanceof Mu)&&T.populatePaintArray(e,i,l,u,p,g)}}setConstantPatternPositions(e){for(const i in this.binders){const l=this.binders[i];l instanceof io&&l.setConstantPatternPositions(e)}}updatePaintArrays(e,i,l,u,p,g){let b=!1;for(const T in e){const M=i.getPositions(T);for(const D of M){const O=l.feature(D.index);for(const z in this.binders){const G=this.binders[z];if((G instanceof go||G instanceof jl||G instanceof Mu)&&G.expression.isStateDependent===!0){const j=u.paint.get(z);G.expression=j.value,G.updatePaintArray(D.start,D.end,O,e[T],p,g),b=!0}}}}return b}defines(){const e=[];for(const i in this.binders){const l=this.binders[i];(l instanceof Uh||l instanceof io)&&e.push(...l.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof go||l instanceof jl||l instanceof Mu)for(let u=0;u<l.paintVertexAttributes.length;u++)e.push(l.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof Uh||l instanceof io||l instanceof jl)for(const u of l.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof Uh||u instanceof io||u instanceof jl)for(const p of u.uniformNames)i.push({name:p,property:l,binding:u.getBinding(e,p)})}return i}setUniforms(e,i,l,u,p){for(const{name:g,property:b,binding:T}of l)this.binders[b].setUniform(e,T,p,u.get(b),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof go||i instanceof jl||i instanceof Mu)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const l=this.binders[i];(l instanceof go||l instanceof jl||l instanceof Mu)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof go||i instanceof jl||i instanceof Mu)&&i.destroy()}}}class yl{constructor(e,i,l=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new ql(u,i,l);this.needsUpload=!1,this._featureMap=new Mf,this._bufferOffset=0}populatePaintArrays(e,i,l,u,p,g,b){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,i,u,p,g,b);i.id!==void 0&&this._featureMap.add(i.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,l,u,p){for(const g of l)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,i,g,u,p)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const x_={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function b_(t,e){return x_[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Py={"line-pattern":{source:os,composite:os},"fill-pattern":{source:os,composite:os},"fill-extrusion-pattern":{source:os,composite:os},"line-dasharray":{source:Ao,composite:Ao}},w_={color:{source:Zc,composite:lr},number:{source:So,composite:Zc}};function fh(t,e,i){const l=Py[t];return l&&l[i]||w_[e][i]}ri(Uh,"ConstantBinder"),ri(io,"PatternConstantBinder"),ri(go,"SourceExpressionBinder"),ri(Mu,"PatternCompositeBinder"),ri(jl,"CompositeExpressionBinder"),ri(ql,"ProgramConfiguration",{omit:["_buffers"]}),ri(yl,"ProgramConfigurationSet");const Au="-transition";class Hl extends Ys{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new it(i.layout)),i.paint)){this._transitionablePaint=new Ut(i.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ye(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,l={}){i!=null&&this._validate(xc,`layers.${this.id}.layout.${e}`,e,i,l)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return Ei(e,Au)?this._transitionablePaint.getTransition(e.slice(0,-Au.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,l={}){if(i!=null&&this._validate(Fp,`layers.${this.id}.paint.${e}`,e,i,l))return!1;if(Ei(e,Au))return this._transitionablePaint.setTransition(e.slice(0,-Au.length),i||void 0),!1;{const u=this._transitionablePaint._values[e],p=u.value.isDataDriven(),g=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value,T=b.isDataDriven(),M=Ei(e,"pattern")||e==="line-dasharray";return T||p||M||this._handleOverridablePaintPropertyUpdate(e,g,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Vn(e,(i,l)=>!(i===void 0||l==="layout"&&!Object.keys(i).length||l==="paint"&&!Object.keys(i).length))}_validate(e,i,l,u,p={}){return(!p||p.validate!==!1)&&df(this,e.call(hf,{key:i,layerType:this.type,objectKey:l,value:u,styleSpec:st,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Ct&&Tn(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ss(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const E_=Ti([{name:"a_pos",components:2,type:"Int16"}],4),T_=Ti([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Zr{constructor(e=[]){this.segments=e}prepareSegment(e,i,l,u){let p=this.segments[this.segments.length-1];return e>Zr.MAX_VERTEX_ARRAY_LENGTH&&Ii(`Max vertices per segment is ${Zr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Zr.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:i.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},u!==void 0&&(p.sortKey=u),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,l,u){return new Zr([{vertexOffset:e,primitiveOffset:i,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}Zr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ri(Zr,"SegmentVector");var Fi=8192;class Wl{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Wn?new Wn(e.lng,e.lat):Wn.convert(e),this}setSouthWest(e){return this._sw=e instanceof Wn?new Wn(e.lng,e.lat):Wn.convert(e),this}extend(e){const i=this._sw,l=this._ne;let u,p;if(e instanceof Wn)u=e,p=e;else{if(!(e instanceof Wl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Wl.convert(e)):this.extend(Wn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(Wn.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return i||l?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),l.lng=Math.max(p.lng,l.lng),l.lat=Math.max(p.lat,l.lat)):(this._sw=new Wn(u.lng,u.lat),this._ne=new Wn(p.lng,p.lat)),this}getCenter(){return new Wn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Wn(this.getWest(),this.getNorth())}getSouthEast(){return new Wn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=Wn.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return!e||e instanceof Wl?e:new Wl(e)}}var Vh=1e-6,Co=typeof Float32Array<"u"?Float32Array:Array;function I_(){var t=new Co(9);return Co!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function jp(t,e,i){var l=e[0],u=e[1],p=e[2],g=e[3],b=e[4],T=e[5],M=e[6],D=e[7],O=e[8],z=i[0],G=i[1],j=i[2],X=i[3],ie=i[4],pe=i[5],we=i[6],de=i[7],be=i[8];return t[0]=z*l+G*g+j*M,t[1]=z*u+G*b+j*D,t[2]=z*p+G*T+j*O,t[3]=X*l+ie*g+pe*M,t[4]=X*u+ie*b+pe*D,t[5]=X*p+ie*T+pe*O,t[6]=we*l+de*g+be*M,t[7]=we*u+de*b+be*D,t[8]=we*p+de*T+be*O,t}function wa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Lf(t,e){var i=e[0],l=e[1],u=e[2],p=e[3],g=e[4],b=e[5],T=e[6],M=e[7],D=e[8],O=e[9],z=e[10],G=e[11],j=e[12],X=e[13],ie=e[14],pe=e[15],we=i*b-l*g,de=i*T-u*g,be=i*M-p*g,Se=l*T-u*b,Me=l*M-p*b,$e=u*M-p*T,Je=D*X-O*j,ht=D*ie-z*j,Rt=D*pe-G*j,nt=O*ie-z*X,mt=O*pe-G*X,xt=z*pe-G*ie,Pt=we*xt-de*mt+be*nt+Se*Rt-Me*ht+$e*Je;return Pt?(t[0]=(b*xt-T*mt+M*nt)*(Pt=1/Pt),t[1]=(u*mt-l*xt-p*nt)*Pt,t[2]=(X*$e-ie*Me+pe*Se)*Pt,t[3]=(z*Me-O*$e-G*Se)*Pt,t[4]=(T*Rt-g*xt-M*ht)*Pt,t[5]=(i*xt-u*Rt+p*ht)*Pt,t[6]=(ie*be-j*$e-pe*de)*Pt,t[7]=(D*$e-z*be+G*de)*Pt,t[8]=(g*mt-b*Rt+M*Je)*Pt,t[9]=(l*Rt-i*mt-p*Je)*Pt,t[10]=(j*Me-X*be+pe*we)*Pt,t[11]=(O*be-D*Me-G*we)*Pt,t[12]=(b*ht-g*nt-T*Je)*Pt,t[13]=(i*nt-l*ht+u*Je)*Pt,t[14]=(X*de-j*Se-ie*we)*Pt,t[15]=(D*Se-O*de+z*we)*Pt,t):null}function Yc(t,e,i){var l=e[0],u=e[1],p=e[2],g=e[3],b=e[4],T=e[5],M=e[6],D=e[7],O=e[8],z=e[9],G=e[10],j=e[11],X=e[12],ie=e[13],pe=e[14],we=e[15],de=i[0],be=i[1],Se=i[2],Me=i[3];return t[0]=de*l+be*b+Se*O+Me*X,t[1]=de*u+be*T+Se*z+Me*ie,t[2]=de*p+be*M+Se*G+Me*pe,t[3]=de*g+be*D+Se*j+Me*we,t[4]=(de=i[4])*l+(be=i[5])*b+(Se=i[6])*O+(Me=i[7])*X,t[5]=de*u+be*T+Se*z+Me*ie,t[6]=de*p+be*M+Se*G+Me*pe,t[7]=de*g+be*D+Se*j+Me*we,t[8]=(de=i[8])*l+(be=i[9])*b+(Se=i[10])*O+(Me=i[11])*X,t[9]=de*u+be*T+Se*z+Me*ie,t[10]=de*p+be*M+Se*G+Me*pe,t[11]=de*g+be*D+Se*j+Me*we,t[12]=(de=i[12])*l+(be=i[13])*b+(Se=i[14])*O+(Me=i[15])*X,t[13]=de*u+be*T+Se*z+Me*ie,t[14]=de*p+be*M+Se*G+Me*pe,t[15]=de*g+be*D+Se*j+Me*we,t}function Md(t,e,i){var l,u,p,g,b,T,M,D,O,z,G,j,X=i[0],ie=i[1],pe=i[2];return e===t?(t[12]=e[0]*X+e[4]*ie+e[8]*pe+e[12],t[13]=e[1]*X+e[5]*ie+e[9]*pe+e[13],t[14]=e[2]*X+e[6]*ie+e[10]*pe+e[14],t[15]=e[3]*X+e[7]*ie+e[11]*pe+e[15]):(u=e[1],p=e[2],g=e[3],b=e[4],T=e[5],M=e[6],D=e[7],O=e[8],z=e[9],G=e[10],j=e[11],t[0]=l=e[0],t[1]=u,t[2]=p,t[3]=g,t[4]=b,t[5]=T,t[6]=M,t[7]=D,t[8]=O,t[9]=z,t[10]=G,t[11]=j,t[12]=l*X+b*ie+O*pe+e[12],t[13]=u*X+T*ie+z*pe+e[13],t[14]=p*X+M*ie+G*pe+e[14],t[15]=g*X+D*ie+j*pe+e[15]),t}function Su(t,e,i){var l=i[0],u=i[1],p=i[2];return t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t[3]=e[3]*l,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*p,t[9]=e[9]*p,t[10]=e[10]*p,t[11]=e[11]*p,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Zl(t,e,i){var l=Math.sin(i),u=Math.cos(i),p=e[4],g=e[5],b=e[6],T=e[7],M=e[8],D=e[9],O=e[10],z=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=p*u+M*l,t[5]=g*u+D*l,t[6]=b*u+O*l,t[7]=T*u+z*l,t[8]=M*u-p*l,t[9]=D*u-g*l,t[10]=O*u-b*l,t[11]=z*u-T*l,t}function Ad(t,e,i){var l=Math.sin(i),u=Math.cos(i),p=e[0],g=e[1],b=e[2],T=e[3],M=e[8],D=e[9],O=e[10],z=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=p*u-M*l,t[1]=g*u-D*l,t[2]=b*u-O*l,t[3]=T*u-z*l,t[8]=p*l+M*u,t[9]=g*l+D*u,t[10]=b*l+O*u,t[11]=T*l+z*u,t}function qp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function M_(t,e,i){var l,u,p,g=i[0],b=i[1],T=i[2],M=Math.hypot(g,b,T);return M<Vh?null:(g*=M=1/M,b*=M,T*=M,l=Math.sin(e),u=Math.cos(e),t[0]=g*g*(p=1-u)+u,t[1]=b*g*p+T*l,t[2]=T*g*p-b*l,t[3]=0,t[4]=g*b*p-T*l,t[5]=b*b*p+u,t[6]=T*b*p+g*l,t[7]=0,t[8]=g*T*p+b*l,t[9]=b*T*p-g*l,t[10]=T*T*p+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var A_=Yc;function Hp(){var t=new Co(3);return Co!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function S_(t){var e=new Co(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Za(t){return Math.hypot(t[0],t[1],t[2])}function Cu(t,e,i){var l=new Co(3);return l[0]=t,l[1]=e,l[2]=i,l}function Xl(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Sd(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Cd(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Tc(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function Ki(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function No(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ph(t,e,i,l){return t[0]=e[0]+i[0]*l,t[1]=e[1]+i[1]*l,t[2]=e[2]+i[2]*l,t}function Es(t,e){var i=e[0],l=e[1],u=e[2],p=i*i+l*l+u*u;return p>0&&(p=1/Math.sqrt(p)),t[0]=e[0]*p,t[1]=e[1]*p,t[2]=e[2]*p,t}function vl(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Ld(t,e,i){var l=e[0],u=e[1],p=e[2],g=i[0],b=i[1],T=i[2];return t[0]=u*T-p*b,t[1]=p*g-l*T,t[2]=l*b-u*g,t}function $r(t,e,i){var l=e[0],u=e[1],p=e[2],g=i[3]*l+i[7]*u+i[11]*p+i[15];return t[0]=(i[0]*l+i[4]*u+i[8]*p+i[12])/(g=g||1),t[1]=(i[1]*l+i[5]*u+i[9]*p+i[13])/g,t[2]=(i[2]*l+i[6]*u+i[10]*p+i[14])/g,t}function Lo(t,e,i){var l=i[0],u=i[1],p=i[2],g=e[0],b=e[1],T=e[2],M=u*T-p*b,D=p*g-l*T,O=l*b-u*g,z=u*O-p*D,G=p*M-l*O,j=l*D-u*M,X=2*i[3];return D*=X,O*=X,G*=2,j*=2,t[0]=g+(M*=X)+(z*=2),t[1]=b+D+G,t[2]=T+O+j,t}var Dd,Kl=Sd,C_=Cd,Oy=Za;function Wp(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function L_(t,e){var i=e[0],l=e[1],u=e[2],p=e[3],g=i*i+l*l+u*u+p*p;return g>0&&(g=1/Math.sqrt(g)),t[0]=i*g,t[1]=l*g,t[2]=u*g,t[3]=p*g,t}function mh(t,e,i){var l=e[0],u=e[1],p=e[2],g=e[3];return t[0]=i[0]*l+i[4]*u+i[8]*p+i[12]*g,t[1]=i[1]*l+i[5]*u+i[9]*p+i[13]*g,t[2]=i[2]*l+i[6]*u+i[10]*p+i[14]*g,t[3]=i[3]*l+i[7]*u+i[11]*p+i[15]*g,t}function D_(){var t=new Co(4);return Co!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ic(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Uo(t,e,i){i*=.5;var l=e[0],u=e[1],p=e[2],g=e[3],b=Math.sin(i),T=Math.cos(i);return t[0]=l*T+g*b,t[1]=u*T+p*b,t[2]=p*T-u*b,t[3]=g*T-l*b,t}function Df(t,e,i){i*=.5;var l=e[0],u=e[1],p=e[2],g=e[3],b=Math.sin(i),T=Math.cos(i);return t[0]=l*T-p*b,t[1]=u*T+g*b,t[2]=p*T+l*b,t[3]=g*T-u*b,t}Hp(),Dd=new Co(4),Co!=Float32Array&&(Dd[0]=0,Dd[1]=0,Dd[2]=0,Dd[3]=0);var Ry=L_;Hp(),Cu(1,0,0),Cu(0,1,0),D_(),D_(),I_();const Zp=Ti([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:P_}=Zp,O_=Ti([{name:"a_pos_3",components:3,type:"Int16"}]);var Jc=Ti([{name:"a_pos",type:"Int16",components:2}]);class Pf{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const u=vl(i,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return l[0]=this.pos[0]+this.dir[0]*p,l[1]=this.pos[1]+this.dir[1]*p,l[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,l){if(function(G,j){var X=G[0],ie=G[1],pe=G[2],we=j[0],de=j[1],be=j[2];return Math.abs(X-we)<=Vh*Math.max(1,Math.abs(X),Math.abs(we))&&Math.abs(ie-de)<=Vh*Math.max(1,Math.abs(ie),Math.abs(de))&&Math.abs(pe-be)<=Vh*Math.max(1,Math.abs(pe),Math.abs(be))}(this.pos,e)||i===0)return l[0]=l[1]=l[2]=0,!1;const[u,p,g]=this.dir,b=this.pos[0]-e[0],T=this.pos[1]-e[1],M=this.pos[2]-e[2],D=u*u+p*p+g*g,O=2*(b*u+T*p+M*g),z=O*O-4*D*(b*b+T*T+M*M-i*i);if(z<0){const G=Math.max(-O/2,0),j=b+u*G,X=T+p*G,ie=M+g*G,pe=Math.hypot(j,X,ie);return l[0]=j*i/pe,l[1]=X*i/pe,l[2]=ie*i/pe,!1}{const G=(-O-Math.sqrt(z))/(2*D);if(G<0){const j=Math.hypot(b,T,M);return l[0]=b*i/j,l[1]=T*i/j,l[2]=M*i/j,!1}return l[0]=b+u*G,l[1]=T+p*G,l[2]=M+g*G,!0}}}class Of{constructor(e,i,l,u,p){this.TL=e,this.TR=i,this.BR=l,this.BL=u,this.horizon=p}static fromInvProjectionMatrix(e,i,l){const u=[-1,1,1],p=[1,1,1],g=[1,-1,1],b=[-1,-1,1],T=$r(u,u,e),M=$r(p,p,e),D=$r(g,g,e),O=$r(b,b,e);return new Of(T,M,D,O,i/l)}}class Xp{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,l,u){const p=Math.pow(2,l),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const M=mh([],T,e),D=1/M[3]/i*p;return function(O,z,G){return O[0]=z[0]*G[0],O[1]=z[1]*G[1],O[2]=z[2]*G[2],O[3]=z[3]*G[3],O}(M,M,[D,D,u?1/M[3]:D,D])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const M=Es([],Ld([],Kl([],g[T[0]],g[T[1]]),Kl([],g[T[2]],g[T[1]]))),D=-vl(M,g[T[1]]);return M.concat(D)});return new Xp(g,b)}}class Vo{static fromPoints(e){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const u of e)Tc(i,i,u),Ki(l,l,u);return new Vo(i,l)}static applyTransform(e,i){const l=e.getCorners();for(let u=0;u<l.length;++u)$r(l[u],l[u],i);return Vo.fromPoints(l)}constructor(e,i){this.min=e,this.max=i,this.center=No([],Xl([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=S_(this.min),u=S_(this.max);for(let p=0;p<i.length;p++)l[p]=i[p]?this.min[p]:this.center[p],u[p]=i[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new Vo(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let l=!0;for(let u=0;u<e.planes.length;u++){const p=e.planes[u];let g=0;for(let b=0;b<i.length;b++)g+=vl(p,i[b])+p[3]>=0;if(g===0)return 0;g!==i.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let p=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const T=e.points[b][u]-this.min[u];p=Math.min(p,T),g=Math.max(g,T)}if(g<0||p>this.max[u]-this.min[u])return 0}return 1}}const Mc=Fi/Math.PI/2,_h=64,Gh=[_h,32,16],Xa=-Mc,xl=Mc,Kp=[new Vo([Xa,Xa,Xa],[xl,xl,xl]),new Vo([Xa,Xa,Xa],[0,0,xl]),new Vo([0,Xa,Xa],[xl,0,xl]),new Vo([Xa,0,Xa],[0,xl,xl]),new Vo([0,0,Xa],[xl,xl,xl])];function Pd(t){return t*Mc/kd}function jh(t,e,i,l=!0){const u=No([],t._camera.position,t.worldSize),p=[e,i,1,1];mh(p,p,t.pixelMatrixInverse),Wp(p,p,1/p[3]);const g=Es([],Kl([],p,u)),b=t.globeMatrix,T=[b[12],b[13],b[14]],M=Kl([],T,u),D=Za(M),O=Es([],M),z=t.worldSize/(2*Math.PI),G=vl(O,g),j=Math.asin(z/D);if(j<Math.acos(G)){if(!l)return null;const Rt=[],nt=[];No(Rt,g,D/G),Es(nt,Kl(nt,Rt,M)),Es(g,Xl(g,M,No(g,nt,Math.tan(j)*D)))}const X=[];new Pf(u,g).closestPointOnSphere(T,z,X);const ie=Es([],Ji(b,0)),pe=Es([],Ji(b,1)),we=Es([],Ji(b,2)),de=vl(ie,X),be=vl(pe,X),Se=vl(we,X),Me=et(Math.asin(-be/z));let $e=et(Math.atan2(de,Se));$e=t.center.lng+function(Rt,nt){const mt=(nt-Rt+180)%360-180;return mt<-180?mt+360:mt}(t.center.lng,$e);const Je=Sc($e),ht=dt(Cc(Me),0,1);return new Zh(Je,ht)}class Yp{constructor(e,i,l){this.a=Kl([],e,l),this.b=Kl([],i,l),this.center=l;const u=Es([],this.a),p=Es([],this.b);this.angle=Math.acos(vl(u,p))}}function Rf(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(l,u,p,g){const b=Math.sin(p);return l*(Math.sin((1-g)*p)/b)+u*(Math.sin(g*p)/b)}(t.a[e],t.b[e],t.angle,dt(i,0,1))+t.center[e]}function Yl(t){if(t.z<=1)return Kp[t.z+2*t.y+t.x];const e=zf(kf(t));return Vo.fromPoints(e)}function Ac(t,e,i){return No(t,t,1-i),ph(t,t,e,i)}function Jp(t,e){const i=Wh(e.zoom);if(i===0)return Yl(t);const l=kf(t),u=zf(l),p=Sc(l.getWest())*e.worldSize,g=Sc(l.getEast())*e.worldSize,b=Cc(l.getNorth())*e.worldSize,T=Cc(l.getSouth())*e.worldSize,M=[p,b,0],D=[g,b,0],O=[p,T,0],z=[g,T,0],G=Lf([],e.globeMatrix);return $r(M,M,G),$r(D,D,G),$r(O,O,G),$r(z,z,G),u[0]=Ac(u[0],O,i),u[1]=Ac(u[1],z,i),u[2]=Ac(u[2],D,i),u[3]=Ac(u[3],M,i),Vo.fromPoints(u)}function Jl(t,e,i){for(const l of t)$r(l,l,e),No(l,l,i)}function gh(t,e,i){const l=e/t.worldSize,u=t.globeMatrix;if(i.z<=1){const Je=Yl(i).getCorners();return Jl(Je,u,l),Vo.fromPoints(Je)}const p=kf(i),g=zf(p);Jl(g,u,l);const b=Number.MAX_VALUE,T=[-b,-b,-b],M=[b,b,b];if(p.contains(t.center)){for(const Rt of g)Tc(M,M,Rt),Ki(T,T,Rt);T[2]=0;const Je=t.point,ht=[Je.x*l,Je.y*l,0];return Tc(M,M,ht),Ki(T,T,ht),new Vo(M,T)}const D=[u[12]*l,u[13]*l,u[14]*l],O=p.getCenter(),z=dt(t.center.lat,-kr,kr),G=dt(O.lat,-kr,kr),j=Sc(t.center.lng),X=Cc(z);let ie=j-Sc(O.lng);const pe=X-Cc(G);ie>.5?ie-=1:ie<-.5&&(ie+=1);let we=0;Math.abs(ie)>Math.abs(pe)?we=ie>=0?1:3:(we=pe>=0?0:2,ph(D,D,[u[4]*l,u[5]*l,u[6]*l],-Math.sin(Bt(pe>=0?p.getSouth():p.getNorth()))*Mc));const de=g[we],be=g[(we+1)%4],Se=new Yp(de,be,D),Me=[Rf(Se,0)||de[0],Rf(Se,1)||de[1],Rf(Se,2)||de[2]],$e=Wh(t.zoom);if($e>0){const Je=function({x:Rt,y:nt,z:mt},xt,Pt,zt,rt){const Kt=1/(1<<mt);let Bi=Rt*Kt,oi=Bi+Kt,vi=nt*Kt,Yt=vi+Kt,Ui=0;const Fn=(Bi+oi)/2-zt;return Fn>.5?Ui=-1:Fn<-.5&&(Ui=1),Bi=((Bi+Ui)*xt-(zt*=xt))*Pt+zt,oi=((oi+Ui)*xt-zt)*Pt+zt,vi=(vi*xt-(rt*=xt))*Pt+rt,Yt=(Yt*xt-rt)*Pt+rt,[[Bi,Yt,0],[oi,Yt,0],[oi,vi,0],[Bi,vi,0]]}(i,e,t._pixelsPerMercatorPixel,j,X);for(let Rt=0;Rt<g.length;Rt++)Ac(g[Rt],Je[Rt],$e);const ht=Xl([],Je[we],Je[(we+1)%4]);No(ht,ht,.5),Ac(Me,ht,$e)}for(const Je of g)Tc(M,M,Je),Ki(T,T,Je);return M[2]=Math.min(de[2],be[2]),Tc(M,M,Me),Ki(T,T,Me),new Vo(M,T)}function kf({x:t,y:e,z:i}){const l=1/(1<<i),u=new Wn(Ka(t*l),yo((e+1)*l)),p=new Wn(Ka((t+1)*l),yo(e*l));return new Wl(u,p)}function zf(t){const e=Bt(t.getNorth()),i=Bt(t.getSouth()),l=Math.cos(e),u=Math.cos(i),p=Math.sin(e),g=Math.sin(i),b=t.getWest(),T=t.getEast();return[qh(u,g,b),qh(u,g,T),qh(l,p,T),qh(l,p,b)]}function qh(t,e,i,l=Mc){return i=Bt(i),[t*Math.sin(i)*l,-e*l,t*Math.cos(i)*l]}function Hh(t,e,i){return qh(Math.cos(Bt(t)),Math.sin(Bt(t)),e,i)}function Od(t,e,i,l){const u=1<<i.z,p=(t/Fi+i.x)/u;return Hh(yo((e/Fi+i.y)/u),Ka(p),l)}function Bf({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const R_=new Float64Array(16);function Rd(t){const e=Bf(t),i=qp(R_,[e,e,e]);return Md(i,i,((l=[])[0]=-(u=t.min)[0],l[1]=-u[1],l[2]=-u[2],l));var l,u}function Qp(t){const e=(l=t.min,(i=R_)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=l[0],i[13]=l[1],i[14]=l[2],i[15]=1,i);var i,l;const u=1/Bf(t);return Su(e,e,[u,u,u])}function k_(t,e,i,l,u){const p=function(T){const M=Fi/(2*Math.PI);return T/(2*Math.PI)/M}(i),g=[t,e,-i/(2*Math.PI)],b=wa(new Float64Array(16));return Md(b,b,g),Su(b,b,[p,p,p]),Zl(b,b,Bt(-u)),Ad(b,b,Bt(-l)),b}function Wh(t){return ti(5,6,t)}function z_(t,e){const i=Hh(e.lat,e.lng),l=function(j){const X=Hh(j._center.lat,j._center.lng);let ie=Ld([],Cu(0,1,0),X);const pe=M_([],-j.angle,X);ie=$r(ie,ie,pe),M_(pe,-j._pitch,ie);const we=Es([],X);return No(we,we,Pd(j.cameraToCenterDistance/j.pixelsPerMeter)),$r(we,we,pe),Xl([],X,we)}(t);return g=(u=Sd([],l,i))[0],b=u[1],T=u[2],M=(p=i)[0],D=p[1],O=p[2],G=(z=Math.sqrt(g*g+b*b+T*T)*Math.sqrt(M*M+D*D+O*O))&&vl(u,p)/z,Math.acos(Math.min(Math.max(G,-1),1));var u,p,g,b,T,M,D,O,z,G}function $p(t,e){return z_(t,e)>Math.PI/2*1.01}const em=Bt(85),B_=Math.cos(em),F_=Math.sin(em),kd=63710088e-1,N_=2*Math.PI*kd;class Wn{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Wn(Vi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,l=this.lat*i,u=e.lat*i,p=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return kd*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new Wl(new Wn(this.lng-l,this.lat-i),new Wn(this.lng+l,this.lat+i))}toEcef(e){const i=Pd(e);return Hh(this.lat,this.lng,Mc+i)}static convert(e){if(e instanceof Wn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Wn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Wn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function Ff(t){return N_*Math.cos(t*Math.PI/180)}function Sc(t){return(180+t)/360}function Cc(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Ql(t,e){return t/Ff(e)}function Ka(t){return 360*t-180}function yo(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function U_(t,e){return t*Ff(yo(e))}const kr=85.051129;function V_(t){return 1/Math.cos(t*Math.PI/180)}class Zh{constructor(e,i,l=0){this.x=+e,this.y=+i,this.z=+l}static fromLngLat(e,i=0){const l=Wn.convert(e);return new Zh(Sc(l.lng),Cc(l.lat),Ql(i,l.lat))}toLngLat(){return new Wn(Ka(this.x),yo(this.y))}toAltitude(){return U_(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/N_*V_(yo(this.y))}}function tm(t,e,i,l,u,p,g,b,T){const M=(e+l)/2,D=(i+u)/2,O=new _e(M,D);b(O),function(z,G,j,X,ie,pe){const we=j-ie,de=X-pe;return Math.abs((X-G)*we-(j-z)*de)/Math.hypot(we,de)}(O.x,O.y,p.x,p.y,g.x,g.y)>=T?(tm(t,e,i,M,D,p,O,b,T),tm(t,M,D,l,u,O,g,b,T)):t.push(g)}function im(t,e,i){let l=t[0],u=l.x,p=l.y;e(l);const g=[l];for(let b=1;b<t.length;b++){const T=t[b],{x:M,y:D}=T;e(T),tm(g,u,p,M,D,l,T,e,i),u=M,p=D,l=T}return g}function nm(t,e,i,l){if(l(e,i)){const u=e.add(i)._mult(.5);nm(t,e,u,l),nm(t,u,i,l)}else t.push(i)}function ky(t,e){let i=t[0];const l=[i];for(let u=1;u<t.length;u++){const p=t[u];nm(l,i,p,e),i=p}return l}const rm=Math.pow(2,14)-1,G_=-rm-1;function sm(t,e){const i=Math.round(t.x*e),l=Math.round(t.y*e);return t.x=dt(i,G_,rm),t.y=dt(l,G_,rm),(i<t.x||i>t.x+1||l<t.y||l>t.y+1)&&Ii("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Qc(t,e,i){const l=t.loadGeometry(),u=t.extent,p=Fi/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:b,x:T,y:M,projection:D}=i,O=z=>{const G=Ka((e.x+z.x/u)/g),j=yo((e.y+z.y/u)/g),X=D.project(G,j);z.x=(X.x*b-T)*u,z.y=(X.y*b-M)*u};for(let z=0;z<l.length;z++)if(t.type!==1)l[z]=im(l[z],O,1);else{const G=[];for(const j of l[z])j.x<0||j.x>=u||j.y<0||j.y>=u||(O(j),G.push(j));l[z]=G}}for(const g of l)for(const b of g)sm(b,p);return l}function yh(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Qc(t):[]}}function Nf(t,e,i,l,u){t.emplaceBack(2*e+(l+1)/2,2*i+(u+1)/2)}function Uf(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class om{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Li,this.indexArray=new to,this.segments=new Zr,this.programConfigurations=new yl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,l,u){const p=this.layers[0],g=[];let b=null;p.type==="circle"&&(b=p.layout.get("circle-sort-key"));for(const{feature:M,id:D,index:O,sourceLayerIndex:z}of e){const G=this.layers[0]._featureFilter.needGeometry,j=yh(M,G);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),j,l))continue;const X=b?b.evaluate(j,{},l):void 0,ie={id:D,properties:M.properties,type:M.type,sourceLayerIndex:z,index:O,geometry:G?j.geometry:Qc(M,l,u),patterns:{},sortKey:X};g.push(ie)}b&&g.sort((M,D)=>M.sortKey-D.sortKey);let T=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new ya,T=u.projection);for(const M of g){const{geometry:D,index:O,sourceLayerIndex:z}=M,G=e[O].feature;this.addFeature(M,D,O,i.availableImages,l,T),i.featureIndex.insert(G,D,O,z,this.index)}}update(e,i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,E_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,T_.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,l,u,p,g){for(const b of i)for(const T of b){const M=T.x,D=T.y;if(M<0||M>=Fi||D<0||D>=Fi)continue;if(g){const G=g.projectTilePoint(M,D,p),j=g.upVector(p,M,D),X=this.globeExtVertexArray;Uf(X,G,j),Uf(X,G,j),Uf(X,G,j),Uf(X,G,j)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),z=O.vertexLength;Nf(this.layoutVertexArray,M,D,-1,-1),Nf(this.layoutVertexArray,M,D,1,-1),Nf(this.layoutVertexArray,M,D,1,1),Nf(this.layoutVertexArray,M,D,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+2,z+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,p)}}function j_(t,e){for(let i=0;i<t.length;i++)if(vh(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(vh(t,e[i]))return!0;return!!am(t,e)}function zy(t,e,i){return!!vh(t,e)||!!lm(e,t,i)}function q_(t,e){if(t.length===1)return W_(e,t[0]);for(let i=0;i<e.length;i++){const l=e[i];for(let u=0;u<l.length;u++)if(vh(t,l[u]))return!0}for(let i=0;i<t.length;i++)if(W_(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(am(t,e[i]))return!0;return!1}function By(t,e,i){if(t.length>1){if(am(t,e))return!0;for(let l=0;l<e.length;l++)if(lm(e[l],t,i))return!0}for(let l=0;l<t.length;l++)if(lm(t[l],e,i))return!0;return!1}function am(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const l=t[i],u=t[i+1];for(let p=0;p<e.length-1;p++)if(Fy(l,u,e[p],e[p+1]))return!0}return!1}function Fy(t,e,i,l){return dn(t,i,l)!==dn(e,i,l)&&dn(t,e,i)!==dn(t,e,l)}function lm(t,e,i){const l=i*i;if(e.length===1)return t.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(H_(t,e[u-1],e[u])<l)return!0;return!1}function H_(t,e,i){const l=e.distSqr(i);if(l===0)return t.distSqr(e);const u=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/l;return t.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function W_(t,e){let i,l,u,p=!1;for(let g=0;g<t.length;g++){i=t[g];for(let b=0,T=i.length-1;b<i.length;T=b++)l=i[b],u=i[T],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(p=!p)}return p}function vh(t,e){let i=!1;for(let l=0,u=t.length-1;l<t.length;u=l++){const p=t[l],g=t[u];p.y>e.y!=g.y>e.y&&e.x<(g.x-p.x)*(e.y-p.y)/(g.y-p.y)+p.x&&(i=!i)}return i}function Z_(t,e,i,l,u){for(const g of t)if(e<=g.x&&i<=g.y&&l>=g.x&&u>=g.y)return!0;const p=[new _e(e,i),new _e(e,u),new _e(l,u),new _e(l,i)];if(t.length>2){for(const g of p)if(vh(t,g))return!0}for(let g=0;g<t.length-1;g++)if(Ny(t[g],t[g+1],p))return!0;return!1}function Ny(t,e,i){const l=i[0],u=i[2];if(t.x<l.x&&e.x<l.x||t.x>u.x&&e.x>u.x||t.y<l.y&&e.y<l.y||t.y>u.y&&e.y>u.y)return!1;const p=dn(t,e,i[0]);return p!==dn(t,e,i[1])||p!==dn(t,e,i[2])||p!==dn(t,e,i[3])}function Xh(t,e,i){const l=e.paint.get(t).value;return l.kind==="constant"?l.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Vf(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function X_(t,e,i,l,u){if(!e[0]&&!e[1])return t;const p=_e.convert(e)._mult(u);i==="viewport"&&p._rotate(-l);const g=[];for(let b=0;b<t.length;b++)g.push(t[b].sub(p));return g}function Gf(t,e,i,l){const u=_e.convert(t)._mult(l);return e==="viewport"&&u._rotate(-i),u}ri(om,"CircleBucket",{omit:["layers"]});const K_=new At({"circle-sort-key":new tt(st.layout_circle["circle-sort-key"])});var Uy={paint:new At({"circle-radius":new tt(st.paint_circle["circle-radius"]),"circle-color":new tt(st.paint_circle["circle-color"]),"circle-blur":new tt(st.paint_circle["circle-blur"]),"circle-opacity":new tt(st.paint_circle["circle-opacity"]),"circle-translate":new Ge(st.paint_circle["circle-translate"]),"circle-translate-anchor":new Ge(st.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ge(st.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ge(st.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new tt(st.paint_circle["circle-stroke-width"]),"circle-stroke-color":new tt(st.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new tt(st.paint_circle["circle-stroke-opacity"])}),layout:K_};function Y_(t,e,i,l,u,p,g,b,T){if(p&&t.queryGeometry.isAboveHorizon)return!1;p&&(T*=t.pixelToTileUnitsFactor);const M=t.tileID.canonical,D=i.projection.upVectorScale(M,i.center.lat,i.worldSize).metersToTile;for(const O of e)for(const z of O){const G=z.add(b),j=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(G.x,G.y,!0):0,X=i.projection.projectTilePoint(G.x,G.y,M);if(j>0){const de=i.projection.upVector(M,G.x,G.y);X.x+=de[0]*D*j,X.y+=de[1]*D*j,X.z+=de[2]*D*j}const ie=p?G:Vy(X.x,X.y,X.z,l),pe=p?t.tilespaceRays.map(de=>jy(de,j)):t.queryGeometry.screenGeometry,we=mh([],[X.x,X.y,X.z,1],l);if(!g&&p?T*=we[3]/i.cameraToCenterDistance:g&&!p&&(T*=i.cameraToCenterDistance/we[3]),p){const de=yo((z.y/Fi+M.y)/(1<<M.z));T/=i.projection.pixelsPerMeter(de,1)/Ql(1,de)}if(zy(pe,ie,T))return!0}return!1}function Vy(t,e,i,l){const u=mh([],[t,e,i,1],l);return new _e(u[0]/u[3],u[1]/u[3])}const J_=Cu(0,0,0),Gy=Cu(0,0,1);function jy(t,e){const i=Hp();return J_[2]=e,t.intersectsPlane(J_,Gy,i),new _e(i[0],i[1])}class Q_ extends om{}function $_(t,{width:e,height:i},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*l);return t.width=e,t.height=i,t.data=u,t}function cm(t,e,i){const{width:l,height:u}=e;l===t.width&&u===t.height||(um(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,l),height:Math.min(t.height,u)},i),t.width=l,t.height=u,t.data=e.data)}function um(t,e,i,l,u,p){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||i.x>t.width-u.width||i.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=t.data,b=e.data;for(let T=0;T<u.height;T++){const M=((i.y+T)*t.width+i.x)*p,D=((l.y+T)*e.width+l.x)*p;for(let O=0;O<u.width*p;O++)b[D+O]=g[M+O]}return e}ri(Q_,"HeatmapBucket",{omit:["layers"]});class bl{constructor(e,i){$_(this,e,1,i)}resize(e){cm(this,new bl(e),1)}clone(){return new bl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,u,p){um(e,i,l,u,p,1)}}class Ea{constructor(e,i){$_(this,e,4,i)}resize(e){cm(this,new Ea(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ea({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,u,p){um(e,i,l,u,p,4)}}ri(bl,"AlphaImage"),ri(Ea,"RGBAImage");var qy={paint:new At({"heatmap-radius":new tt(st.paint_heatmap["heatmap-radius"]),"heatmap-weight":new tt(st.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ge(st.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bt(st.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ge(st.paint_heatmap["heatmap-opacity"])})};function hm(t){const e={},i=t.resolution||256,l=t.clips?t.clips.length:1,u=t.image||new Ea({width:i,height:l}),p=(g,b,T)=>{e[t.evaluationKey]=T;const M=t.expression.evaluate(e);u.data[g+b+0]=Math.floor(255*M.r/M.a),u.data[g+b+1]=Math.floor(255*M.g/M.a),u.data[g+b+2]=Math.floor(255*M.b/M.a),u.data[g+b+3]=Math.floor(255*M.a)};if(t.clips)for(let g=0,b=0;g<l;++g,b+=4*i)for(let T=0,M=0;T<i;T++,M+=4){const D=T/(i-1),{start:O,end:z}=t.clips[g];p(b,M,O*(1-D)+z*D)}else for(let g=0,b=0;g<i;g++,b+=4)p(0,b,g/(i-1));return u}var Hy={paint:new At({"hillshade-illumination-direction":new Ge(st.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ge(st.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ge(st.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ge(st.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ge(st.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ge(st.paint_hillshade["hillshade-accent-color"])})};const Wy=Ti([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zy}=Wy;var Kh={};function jf(t,e,i){i=i||2;var l,u,p,g,b,T,M,D=e&&e.length,O=D?e[0]*i:t.length,z=eg(t,0,O,i,!0),G=[];if(!z||z.next===z.prev)return G;if(D&&(z=function(X,ie,pe,we){var de,be,Se,Me=[];for(de=0,be=ie.length;de<be;de++)(Se=eg(X,ie[de]*we,de<be-1?ie[de+1]*we:X.length,we,!1))===Se.next&&(Se.steiner=!0),Me.push($y(Se));for(Me.sort(Qy),de=0;de<Me.length;de++)pe=tg(Me[de],pe);return pe}(t,e,z,i)),t.length>80*i){l=p=t[0],u=g=t[1];for(var j=i;j<O;j+=i)(b=t[j])<l&&(l=b),(T=t[j+1])<u&&(u=T),b>p&&(p=b),T>g&&(g=T);M=(M=Math.max(p-l,g-u))!==0?32767/M:0}return zd(z,G,i,l,u,M,0),G}function eg(t,e,i,l,u){var p,g;if(u===pm(t,e,i,l)>0)for(p=e;p<i;p+=l)g=sg(p,t[p],t[p+1],g);else for(p=i-l;p>=e;p-=l)g=sg(p,t[p],t[p+1],g);return g&&qf(g,g.next)&&(Fd(g),g=g.next),g}function xh(t,e){if(!t)return t;e||(e=t);var i,l=t;do if(i=!1,l.steiner||!qf(l,l.next)&&Xr(l.prev,l,l.next)!==0)l=l.next;else{if(Fd(l),(l=e=l.prev)===l.next)break;i=!0}while(i||l!==e);return e}function zd(t,e,i,l,u,p,g){if(t){!g&&p&&function(D,O,z,G){var j=D;do j.z===0&&(j.z=dm(j.x,j.y,O,z,G)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==D);j.prevZ.nextZ=null,j.prevZ=null,function(X){var ie,pe,we,de,be,Se,Me,$e,Je=1;do{for(pe=X,X=null,be=null,Se=0;pe;){for(Se++,we=pe,Me=0,ie=0;ie<Je&&(Me++,we=we.nextZ);ie++);for($e=Je;Me>0||$e>0&&we;)Me!==0&&($e===0||!we||pe.z<=we.z)?(de=pe,pe=pe.nextZ,Me--):(de=we,we=we.nextZ,$e--),be?be.nextZ=de:X=de,de.prevZ=be,be=de;pe=we}be.nextZ=null,Je*=2}while(Se>1)}(j)}(t,l,u,p);for(var b,T,M=t;t.prev!==t.next;)if(b=t.prev,T=t.next,p?Ky(t,l,u,p):Xy(t))e.push(b.i/i|0),e.push(t.i/i|0),e.push(T.i/i|0),Fd(t),t=T.next,M=T.next;else if((t=T)===M){g?g===1?zd(t=Yy(xh(t),e,i),e,i,l,u,p,2):g===2&&Jy(t,e,i,l,u,p):zd(xh(t),e,i,l,u,p,1);break}}}function Xy(t){var e=t.prev,i=t,l=t.next;if(Xr(e,i,l)>=0)return!1;for(var u=e.x,p=i.x,g=l.x,b=e.y,T=i.y,M=l.y,D=u<p?u<g?u:g:p<g?p:g,O=b<T?b<M?b:M:T<M?T:M,z=u>p?u>g?u:g:p>g?p:g,G=b>T?b>M?b:M:T>M?T:M,j=l.next;j!==e;){if(j.x>=D&&j.x<=z&&j.y>=O&&j.y<=G&&Yh(u,b,p,T,g,M,j.x,j.y)&&Xr(j.prev,j,j.next)>=0)return!1;j=j.next}return!0}function Ky(t,e,i,l){var u=t.prev,p=t,g=t.next;if(Xr(u,p,g)>=0)return!1;for(var b=u.x,T=p.x,M=g.x,D=u.y,O=p.y,z=g.y,G=b<T?b<M?b:M:T<M?T:M,j=D<O?D<z?D:z:O<z?O:z,X=b>T?b>M?b:M:T>M?T:M,ie=D>O?D>z?D:z:O>z?O:z,pe=dm(G,j,e,i,l),we=dm(X,ie,e,i,l),de=t.prevZ,be=t.nextZ;de&&de.z>=pe&&be&&be.z<=we;){if(de.x>=G&&de.x<=X&&de.y>=j&&de.y<=ie&&de!==u&&de!==g&&Yh(b,D,T,O,M,z,de.x,de.y)&&Xr(de.prev,de,de.next)>=0||(de=de.prevZ,be.x>=G&&be.x<=X&&be.y>=j&&be.y<=ie&&be!==u&&be!==g&&Yh(b,D,T,O,M,z,be.x,be.y)&&Xr(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;de&&de.z>=pe;){if(de.x>=G&&de.x<=X&&de.y>=j&&de.y<=ie&&de!==u&&de!==g&&Yh(b,D,T,O,M,z,de.x,de.y)&&Xr(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;be&&be.z<=we;){if(be.x>=G&&be.x<=X&&be.y>=j&&be.y<=ie&&be!==u&&be!==g&&Yh(b,D,T,O,M,z,be.x,be.y)&&Xr(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function Yy(t,e,i){var l=t;do{var u=l.prev,p=l.next.next;!qf(u,p)&&ng(u,l,l.next,p)&&Bd(u,p)&&Bd(p,u)&&(e.push(u.i/i|0),e.push(l.i/i|0),e.push(p.i/i|0),Fd(l),Fd(l.next),l=t=p),l=l.next}while(l!==t);return xh(l)}function Jy(t,e,i,l,u,p){var g=t;do{for(var b=g.next.next;b!==g.prev;){if(g.i!==b.i&&e0(g,b)){var T=rg(g,b);return g=xh(g,g.next),T=xh(T,T.next),zd(g,e,i,l,u,p,0),void zd(T,e,i,l,u,p,0)}b=b.next}g=g.next}while(g!==t)}function Qy(t,e){return t.x-e.x}function tg(t,e){var i=function(u,p){var g,b=p,T=u.x,M=u.y,D=-1/0;do{if(M<=b.y&&M>=b.next.y&&b.next.y!==b.y){var O=b.x+(M-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(O<=T&&O>D&&(D=O,g=b.x<b.next.x?b:b.next,O===T))return g}b=b.next}while(b!==p);if(!g)return null;var z,G=g,j=g.x,X=g.y,ie=1/0;b=g;do T>=b.x&&b.x>=j&&T!==b.x&&Yh(M<X?T:D,M,j,X,M<X?D:T,M,b.x,b.y)&&(z=Math.abs(M-b.y)/(T-b.x),Bd(b,u)&&(z<ie||z===ie&&(b.x>g.x||b.x===g.x&&ig(g,b)))&&(g=b,ie=z)),b=b.next;while(b!==G);return g}(t,e);if(!i)return e;var l=rg(i,t);return xh(l,l.next),xh(i,i.next)}function ig(t,e){return Xr(t.prev,t,e.prev)<0&&Xr(e.next,t,t.next)<0}function dm(t,e,i,l,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $y(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Yh(t,e,i,l,u,p,g,b){return(u-g)*(e-b)>=(t-g)*(p-b)&&(t-g)*(l-b)>=(i-g)*(e-b)&&(i-g)*(p-b)>=(u-g)*(l-b)}function e0(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,l){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==l.i&&u.next.i!==l.i&&ng(u,u.next,i,l))return!0;u=u.next}while(u!==i);return!1}(t,e)&&(Bd(t,e)&&Bd(e,t)&&function(i,l){var u=i,p=!1,g=(i.x+l.x)/2,b=(i.y+l.y)/2;do u.y>b!=u.next.y>b&&u.next.y!==u.y&&g<(u.next.x-u.x)*(b-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==i);return p}(t,e)&&(Xr(t.prev,t,e.prev)||Xr(t,e.prev,e))||qf(t,e)&&Xr(t.prev,t,t.next)>0&&Xr(e.prev,e,e.next)>0)}function Xr(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function qf(t,e){return t.x===e.x&&t.y===e.y}function ng(t,e,i,l){var u=Wf(Xr(t,e,i)),p=Wf(Xr(t,e,l)),g=Wf(Xr(i,l,t)),b=Wf(Xr(i,l,e));return u!==p&&g!==b||!(u!==0||!Hf(t,i,e))||!(p!==0||!Hf(t,l,e))||!(g!==0||!Hf(i,t,l))||!(b!==0||!Hf(i,e,l))}function Hf(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Wf(t){return t>0?1:t<0?-1:0}function Bd(t,e){return Xr(t.prev,t,t.next)<0?Xr(t,e,t.next)>=0&&Xr(t,t.prev,e)>=0:Xr(t,e,t.prev)<0||Xr(t,t.next,e)<0}function rg(t,e){var i=new fm(t.i,t.x,t.y),l=new fm(e.i,e.x,e.y),u=t.next,p=e.prev;return t.next=e,e.prev=t,i.next=u,u.prev=i,l.next=i,i.prev=l,p.next=l,l.prev=p,l}function sg(t,e,i,l){var u=new fm(t,e,i);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function Fd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function fm(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function pm(t,e,i,l){for(var u=0,p=e,g=i-l;p<i;p+=l)u+=(t[g]-t[p])*(t[p+1]+t[g+1]),g=p;return u}function t0(t,e,i,l,u){Nd(t,e,i||0,l||t.length-1,u||og)}function Nd(t,e,i,l,u){for(;l>i;){if(l-i>600){var p=l-i+1,g=e-i+1,b=Math.log(p),T=.5*Math.exp(2*b/3),M=.5*Math.sqrt(b*T*(p-T)/p)*(g-p/2<0?-1:1);Nd(t,e,Math.max(i,Math.floor(e-g*T/p+M)),Math.min(l,Math.floor(e+(p-g)*T/p+M)),u)}var D=t[e],O=i,z=l;for(Ud(t,i,e),u(t[l],D)>0&&Ud(t,i,l);O<z;){for(Ud(t,O,z),O++,z--;u(t[O],D)<0;)O++;for(;u(t[z],D)>0;)z--}u(t[i],D)===0?Ud(t,i,z):Ud(t,++z,l),z<=e&&(i=z+1),e<=z&&(l=z-1)}}function Ud(t,e,i){var l=t[e];t[e]=t[i],t[i]=l}function og(t,e){return t<e?-1:t>e?1:0}function Zf(t,e){const i=t.length;if(i<=1)return[t];const l=[];let u,p;for(let g=0;g<i;g++){const b=$t(t[g]);b!==0&&(t[g].area=Math.abs(b),p===void 0&&(p=b<0),p===b<0?(u&&l.push(u),u=[t[g]]):u.push(t[g]))}if(u&&l.push(u),e>1)for(let g=0;g<l.length;g++)l[g].length<=e||(t0(l[g],e,1,l[g].length-1,mm),l[g]=l[g].slice(0,e));return l}function mm(t,e){return e.area-t.area}function Xf(t,e,i){const l=i.patternDependencies;let u=!1;for(const p of e){const g=p.paint.get(`${t}-pattern`);g.isConstant()||(u=!0);const b=g.constantOr(null);b&&(u=!0,l[b]=!0)}return u}function Kf(t,e,i,l,u){const p=u.patternDependencies;for(const g of e){const b=g.paint.get(`${t}-pattern`).value;if(b.kind!=="constant"){let T=b.evaluate({zoom:l},i,{},u.availableImages);T=T&&T.name?T.name:T,p[T]=!0,i.patterns[g.id]=T}}return i}({get exports(){return Kh},set exports(t){Kh=t}}).exports=jf,Kh.default=jf,jf.deviation=function(t,e,i,l){var u=e&&e.length,p=Math.abs(pm(t,0,u?e[0]*i:t.length,i));if(u)for(var g=0,b=e.length;g<b;g++)p-=Math.abs(pm(t,e[g]*i,g<b-1?e[g+1]*i:t.length,i));var T=0;for(g=0;g<l.length;g+=3){var M=l[g]*i,D=l[g+1]*i,O=l[g+2]*i;T+=Math.abs((t[M]-t[O])*(t[D+1]-t[M+1])-(t[M]-t[D])*(t[O+1]-t[M+1]))}return p===0&&T===0?0:Math.abs((T-p)/p)},jf.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},l=0,u=0;u<t.length;u++){for(var p=0;p<t[u].length;p++)for(var g=0;g<e;g++)i.vertices.push(t[u][p][g]);u>0&&i.holes.push(l+=t[u-1].length)}return i};class Vd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Li,this.indexArray=new to,this.indexArray2=new Ec,this.programConfigurations=new yl(e.layers,e.zoom),this.segments=new Zr,this.segments2=new Zr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,l,u){this.hasPattern=Xf("fill",this.layers,i);const p=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:b,id:T,index:M,sourceLayerIndex:D}of e){const O=this.layers[0]._featureFilter.needGeometry,z=yh(b,O);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),z,l))continue;const G=p?p.evaluate(z,{},l,i.availableImages):void 0,j={id:T,properties:b.properties,type:b.type,sourceLayerIndex:D,index:M,geometry:O?z.geometry:Qc(b,l,u),patterns:{},sortKey:G};g.push(j)}p&&g.sort((b,T)=>b.sortKey-T.sortKey);for(const b of g){const{geometry:T,index:M,sourceLayerIndex:D}=b;if(this.hasPattern){const O=Kf("fill",this.layers,b,this.zoom,i);this.patternFeatures.push(O)}else this.addFeature(b,T,M,l,{},i.availableImages);i.featureIndex.insert(e[M].feature,T,M,D,this.index)}}update(e,i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,u)}addFeatures(e,i,l,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zy),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,l,u,p,g=[]){for(const b of Zf(i,500)){let T=0;for(const j of b)T+=j.length;const M=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),D=M.vertexLength,O=[],z=[];for(const j of b){if(j.length===0)continue;j!==b[0]&&z.push(O.length/2);const X=this.segments2.prepareSegment(j.length,this.layoutVertexArray,this.indexArray2),ie=X.vertexLength;this.layoutVertexArray.emplaceBack(j[0].x,j[0].y),this.indexArray2.emplaceBack(ie+j.length-1,ie),O.push(j[0].x),O.push(j[0].y);for(let pe=1;pe<j.length;pe++)this.layoutVertexArray.emplaceBack(j[pe].x,j[pe].y),this.indexArray2.emplaceBack(ie+pe-1,ie+pe),O.push(j[pe].x),O.push(j[pe].y);X.vertexLength+=j.length,X.primitiveLength+=j.length}const G=Kh(O,z);for(let j=0;j<G.length;j+=3)this.indexArray.emplaceBack(D+G[j],D+G[j+1],D+G[j+2]);M.vertexLength+=T,M.primitiveLength+=G.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,g,u)}}ri(Vd,"FillBucket",{omit:["layers","patternFeatures"]});const ag=new At({"fill-sort-key":new tt(st.layout_fill["fill-sort-key"])});var i0={paint:new At({"fill-antialias":new Ge(st.paint_fill["fill-antialias"]),"fill-opacity":new tt(st.paint_fill["fill-opacity"]),"fill-color":new tt(st.paint_fill["fill-color"]),"fill-outline-color":new tt(st.paint_fill["fill-outline-color"]),"fill-translate":new Ge(st.paint_fill["fill-translate"]),"fill-translate-anchor":new Ge(st.paint_fill["fill-translate-anchor"]),"fill-pattern":new tt(st.paint_fill["fill-pattern"])}),layout:ag};const n0=Ti([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),r0=Ti([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Yf=Ti([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Jf}=n0;var Qf={},s0=_e,$f=bh;function bh(t,e,i,l,u){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=l,this._values=u,t.readFields(o0,this,e)}function o0(t,e,i){t==1?e.id=i.readVarint():t==2?function(l,u){for(var p=l.readVarint()+l.pos;l.pos<p;){var g=u._keys[l.readVarint()],b=u._values[l.readVarint()];u.properties[g]=b}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function a0(t){for(var e,i,l=0,u=0,p=t.length,g=p-1;u<p;g=u++)l+=((i=t[g]).x-(e=t[u]).x)*(e.y+i.y);return l}bh.types=["Unknown","Point","LineString","Polygon"],bh.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,l=1,u=0,p=0,g=0,b=[];t.pos<i;){if(u<=0){var T=t.readVarint();l=7&T,u=T>>3}if(u--,l===1||l===2)p+=t.readSVarint(),g+=t.readSVarint(),l===1&&(e&&b.push(e),e=[]),e.push(new s0(p,g));else{if(l!==7)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&b.push(e),b},bh.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,l=0,u=0,p=0,g=1/0,b=-1/0,T=1/0,M=-1/0;t.pos<e;){if(l<=0){var D=t.readVarint();i=7&D,l=D>>3}if(l--,i===1||i===2)(u+=t.readSVarint())<g&&(g=u),u>b&&(b=u),(p+=t.readSVarint())<T&&(T=p),p>M&&(M=p);else if(i!==7)throw new Error("unknown command "+i)}return[g,T,b,M]},bh.prototype.toGeoJSON=function(t,e,i){var l,u,p=this.extent*Math.pow(2,i),g=this.extent*t,b=this.extent*e,T=this.loadGeometry(),M=bh.types[this.type];function D(G){for(var j=0;j<G.length;j++){var X=G[j];G[j]=[360*(X.x+g)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(X.y+b)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(l=0;l<T.length;l++)O[l]=T[l][0];D(T=O);break;case 2:for(l=0;l<T.length;l++)D(T[l]);break;case 3:for(T=function(G){var j=G.length;if(j<=1)return[G];for(var X,ie,pe=[],we=0;we<j;we++){var de=a0(G[we]);de!==0&&(ie===void 0&&(ie=de<0),ie===de<0?(X&&pe.push(X),X=[G[we]]):X.push(G[we]))}return X&&pe.push(X),pe}(T),l=0;l<T.length;l++)for(u=0;u<T[l].length;u++)D(T[l][u])}T.length===1?T=T[0]:M="Multi"+M;var z={type:"Feature",geometry:{type:M,coordinates:T},properties:this.properties};return"id"in this&&(z.id=this.id),z};var l0=$f,lg=cg;function cg(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(c0,this,e),this.length=this._features.length}function c0(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(l){for(var u=null,p=l.readVarint()+l.pos;l.pos<p;){var g=l.readVarint()>>3;u=g===1?l.readString():g===2?l.readFloat():g===3?l.readDouble():g===4?l.readVarint64():g===5?l.readVarint():g===6?l.readSVarint():g===7?l.readBoolean():null}return u}(i))}cg.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new l0(this._pbf,e,this.extent,this._keys,this._values)};var u0=lg;function h0(t,e,i){if(t===3){var l=new u0(i,i.readVarint()+i.pos);l.length&&(e[l.name]=l)}}var _m=Qf.VectorTile=function(t,e){this.layers=t.readFields(h0,{},e)},ep=Qf.VectorTileFeature=$f;function tp(t,e,i,l){const u=[],p=l===0?(g,b,T,M,D,O)=>{g.push(new _e(O,T+(O-b)/(M-b)*(D-T)))}:(g,b,T,M,D,O)=>{g.push(new _e(b+(O-T)/(D-T)*(M-b),O))};for(const g of t){const b=[];for(const T of g){if(T.length<=2)continue;const M=[];for(let z=0;z<T.length-1;z++){const G=T[z].x,j=T[z].y,X=T[z+1].x,ie=T[z+1].y,pe=l===0?G:j,we=l===0?X:ie;pe<e?we>e&&p(M,G,j,X,ie,e):pe>i?we<i&&p(M,G,j,X,ie,i):M.push(T[z]),we<e&&pe>=e&&p(M,G,j,X,ie,e),we>i&&pe<=i&&p(M,G,j,X,ie,i)}let D=T[T.length-1];const O=l===0?D.x:D.y;O>=e&&O<=i&&M.push(D),M.length&&(D=M[M.length-1],M[0].x===D.x&&M[0].y===D.y||M.push(M[0]),b.push(M))}b.length&&u.push(b)}return u}Qf.VectorTileLayer=lg;const d0=ep.types,$l=Math.pow(2,13);function Gd(t,e,i,l,u,p,g,b){t.emplaceBack((e<<1)+g,(i<<1)+p,(Math.floor(l*$l)<<1)+u,Math.round(b))}function jd(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Lu{constructor(){this.acc=new _e(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new _e(e.x,e.y),this.max=new _e(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const l=this.min,u=this.max;e.x<l.x?l.x=e.x:e.x>u.x&&(u.x=e.x),e.y<l.y?l.y=e.y:e.y>u.y&&(u.y=e.y),((e.x===0||e.x===Fi)&&e.x===i.x)!=((e.y===0||e.y===Fi)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,$i(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>Fi!=e.x>Fi&&this.addBorderIntersection(1,$i(i.y,e.y,(Fi-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,$i(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>Fi!=e.y>Fi&&this.addBorderIntersection(3,$i(i.x,e.x,(Fi-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,e.x)}}centroid(){const e=this.polyCount.reduce((i,l)=>i+l.edges,0);return e!==0?this.acc.div(e)._round():new _e(0,0)}span(){return new _e(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class gn{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new or,this.centroidVertexArray=new wf,this.indexArray=new to,this.programConfigurations=new yl(e.layers,e.zoom),this.segments=new Zr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,l,u){this.features=[],this.hasPattern=Xf("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const g=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*g/(g*g+1)/Fi/(1<<p.z)}(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:g,index:b,sourceLayerIndex:T}of e){const M=this.layers[0]._featureFilter.needGeometry,D=yh(p,M);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),D,l))continue;const O={id:g,sourceLayerIndex:T,index:b,geometry:M?D.geometry:Qc(p,l,u),properties:p.properties,type:p.type,patterns:{}},z=this.layoutVertexArray.length;this.hasPattern?this.features.push(Kf("fill-extrusion",this.layers,O,this.zoom,i)):this.addFeature(O,O.geometry,b,l,{},i.availableImages,u),i.featureIndex.insert(p,O.geometry,b,T,this.index,z)}this.sortBorders()}addFeatures(e,i,l,u,p){for(const g of this.features){const{geometry:b}=g;this.addFeature(g,b,g.index,i,l,u,p)}this.sortBorders()}update(e,i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Yf.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,r0.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,l,u,p,g,b){const T=[new _e(0,0),new _e(Fi,Fi)],M=b.projection,D=M.name==="globe",O=this.enableTerrain&&!D?new Lu:null,z=d0[e.type]==="Polygon";D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ya);const G=Zf(i,500);for(let pe=G.length-1;pe>=0;pe--){const we=G[pe];(we.length===0||(j=we[0]).every(de=>de.x<=0)||j.every(de=>de.x>=Fi)||j.every(de=>de.y<=0)||j.every(de=>de.y>=Fi))&&G.splice(pe,1)}var j;let X;if(D)X=pg(G,T,u);else{X=[];for(const pe of G)X.push({polygon:pe,bounds:T})}const ie=z?this.edgeRadius:0;for(const{polygon:pe,bounds:we}of X){let de=0,be=0;for(const Me of pe)z&&!Me[0].equals(Me[Me.length-1])&&Me.push(Me[0]),be+=z?Me.length-1:Me.length;const Se=this.segments.prepareSegment((z?5:4)*be,this.layoutVertexArray,this.indexArray);if(z){const Me=[],$e=[];de=Se.vertexLength;for(const ht of pe){let Rt,nt;ht.length&&ht!==pe[0]&&$e.push(Me.length/2),Rt=ht[1].sub(ht[0])._perp()._unit();for(let mt=1;mt<ht.length;mt++){const xt=ht[mt],Pt=ht[mt===ht.length-1?1:mt+1];let{x:zt,y:rt}=xt;if(ie){nt=Pt.sub(xt)._perp()._unit();const Kt=Rt.add(nt)._unit(),Bi=ie*Math.min(4,1/(Rt.x*Kt.x+Rt.y*Kt.y));zt+=Bi*Kt.x,rt+=Bi*Kt.y,Rt=nt}Gd(this.layoutVertexArray,zt,rt,0,0,1,1,0),Se.vertexLength++,Me.push(xt.x,xt.y),D&&jd(this.layoutVertexExtArray,M.projectTilePoint(zt,rt,u),M.upVector(u,zt,rt))}}const Je=Kh(Me,$e);for(let ht=0;ht<Je.length;ht+=3)this.indexArray.emplaceBack(de+Je[ht],de+Je[ht+2],de+Je[ht+1]),Se.primitiveLength++}for(const Me of pe){O&&Me.length&&O.startRing(Me[0]);let $e,Je,ht,Rt=Me.length>4&&$c(Me[Me.length-2],Me[0],Me[1]),nt=ie?Ta(Me[Me.length-2],Me[0],Me[1],ie):0;Je=Me[1].sub(Me[0])._perp()._unit();let mt=!0;for(let xt=1,Pt=0;xt<Me.length;xt++){let zt=Me[xt-1],rt=Me[xt];const Kt=Me[xt===Me.length-1?1:xt+1];if(O&&z&&O.currentPolyCount.top++,hg(rt,zt,we)){ie&&(Je=Kt.sub(rt)._perp()._unit(),mt=!mt);continue}O&&O.append(rt,zt);const Bi=rt.sub(zt)._perp(),oi=Bi.x/(Math.abs(Bi.x)+Math.abs(Bi.y)),vi=Bi.y>0?1:0,Yt=zt.dist(rt);if(Pt+Yt>32768&&(Pt=0),ie){ht=Kt.sub(rt)._perp()._unit();let An=Ts(zt,rt,Kt,ug(Je,ht),ie);isNaN(An)&&(An=0);const ji=rt.sub(zt)._unit();zt=zt.add(ji.mult(nt))._round(),rt=rt.add(ji.mult(-An))._round(),nt=An,Je=ht}const Ui=Se.vertexLength,Fn=Me.length>4&&$c(zt,rt,Kt);let kn=dg(Pt,Rt,mt);if(Gd(this.layoutVertexArray,zt.x,zt.y,oi,vi,0,0,kn),Gd(this.layoutVertexArray,zt.x,zt.y,oi,vi,0,1,kn),Pt+=Yt,kn=dg(Pt,Fn,!mt),Rt=Fn,Gd(this.layoutVertexArray,rt.x,rt.y,oi,vi,0,0,kn),Gd(this.layoutVertexArray,rt.x,rt.y,oi,vi,0,1,kn),Se.vertexLength+=4,this.indexArray.emplaceBack(Ui+0,Ui+1,Ui+2),this.indexArray.emplaceBack(Ui+1,Ui+3,Ui+2),Se.primitiveLength+=2,ie){const An=de+(xt===1?Me.length-2:xt-2),ji=xt===1?de:An+1;if(this.indexArray.emplaceBack(Ui+1,An,Ui+3),this.indexArray.emplaceBack(An,ji,Ui+3),Se.primitiveLength+=2,$e===void 0&&($e=Ui),!hg(Kt,Me[xt],we)){const _r=xt===Me.length-1?$e:Se.vertexLength;this.indexArray.emplaceBack(Ui+2,Ui+3,_r),this.indexArray.emplaceBack(Ui+3,_r+1,_r),this.indexArray.emplaceBack(Ui+3,ji,_r+1),Se.primitiveLength+=3}mt=!mt}if(D){const An=this.layoutVertexExtArray,ji=M.projectTilePoint(zt.x,zt.y,u),_r=M.projectTilePoint(rt.x,rt.y,u),sn=M.upVector(u,zt.x,zt.y),Nn=M.upVector(u,rt.x,rt.y);jd(An,ji,sn),jd(An,ji,sn),jd(An,_r,Nn),jd(An,_r,Nn)}}z&&(de+=Me.length-1)}}if(O&&O.polyCount.length>0){if(O.borders){O.vertexArrayOffset=this.centroidVertexArray.length;const pe=O.borders,we=this.featuresOnBorder.push(O)-1;for(let de=0;de<4;de++)pe[de][0]!==Number.MAX_VALUE&&this.borders[de].push(we)}this.encodeCentroid(O.borders?void 0:O.centroid(),O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,g,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,l)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}encodeCentroid(e,i,l=!0){let u,p;if(e)if(e.y!==0){const b=i.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(b.x/10)),p=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else u=Math.ceil(7*(e.x+450)),p=0;else u=0,p=+l;let g=l?this.centroidVertexArray.length:i.vertexArrayOffset;for(const b of i.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let T=0;T<b.top;T++)this.centroidVertexArray.emplace(g++,u,p);for(let T=0;T<2*b.edges;T++)this.centroidVertexArray.emplace(g++,0,p),this.centroidVertexArray.emplace(g++,u,p)}}}function ug(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function Ta(t,e,i,l){const u=e.sub(t)._perp()._unit(),p=i.sub(e)._perp()._unit();return Ts(t,e,i,ug(u,p),l)}function Ts(t,e,i,l,u){const p=Math.sqrt(1-l*l);return Math.min(t.dist(e)/3,e.dist(i)/3,u*p/l)}function hg(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function $c(t,e,i){if(t.x<0||t.x>=Fi||e.x<0||e.x>=Fi||i.x<0||i.x>=Fi)return!1;const l=i.sub(e),u=l.perp(),p=t.sub(e);return(l.x*p.x+l.y*p.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(p.x*p.x+p.y*p.y))>-.866&&u.x*p.x+u.y*p.y<0}function dg(t,e,i){const l=e?2|t:-3&t;return i?1|l:-2&l}function fg(){const t=Math.PI/32,e=Math.tan(t),i=kd;return i*Math.sqrt(1+2*e*e)-i}function pg(t,e,i){const l=1<<i.z,u=Ka(i.x/l),p=Ka((i.x+1)/l),g=yo(i.y/l),b=yo((i.y+1)/l);return function(T,M,D,O,z=0,G){const j=[];if(!T.length||!D||!O)return j;const X=(Me,$e)=>{for(const Je of Me)j.push({polygon:Je,bounds:$e})},ie=Math.ceil(Math.log2(D)),pe=Math.ceil(Math.log2(O)),we=ie-pe,de=[];for(let Me=0;Me<Math.abs(we);Me++)de.push(we>0?0:1);for(let Me=0;Me<Math.min(ie,pe);Me++)de.push(0),de.push(1);let be=T;if(be=tp(be,M[0].y-z,M[1].y+z,1),be=tp(be,M[0].x-z,M[1].x+z,0),!be.length)return j;const Se=[];for(de.length?Se.push({polygons:be,bounds:M,depth:0}):X(be,M);Se.length;){const Me=Se.pop(),$e=Me.depth,Je=de[$e],ht=Me.bounds[0],Rt=Me.bounds[1],nt=Je===0?ht.x:ht.y,mt=Je===0?Rt.x:Rt.y,xt=G?G(Je,nt,mt):.5*(nt+mt),Pt=tp(Me.polygons,nt-z,xt+z,Je),zt=tp(Me.polygons,xt-z,mt+z,Je);if(Pt.length){const rt=[ht,new _e(Je===0?xt:Rt.x,Je===1?xt:Rt.y)];de.length>$e+1?Se.push({polygons:Pt,bounds:rt,depth:$e+1}):X(Pt,rt)}if(zt.length){const rt=[new _e(Je===0?xt:ht.x,Je===1?xt:ht.y),Rt];de.length>$e+1?Se.push({polygons:zt,bounds:rt,depth:$e+1}):X(zt,rt)}}return j}(t,e,Math.ceil((p-u)/11.25),Math.ceil((g-b)/11.25),1,(T,M,D)=>{if(T===0)return .5*(M+D);{const O=yo((i.y+M/Fi)/l);return(Cc(.5*(yo((i.y+D/Fi)/l)+O))*l-i.y)*Fi}})}ri(gn,"FillExtrusionBucket",{omit:["layers","features"]}),ri(Lu,"PartMetadata");const f0=new At({"fill-extrusion-edge-radius":new Ge(st["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var p0={paint:new At({"fill-extrusion-opacity":new Ge(st["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new tt(st["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ge(st["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ge(st["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new tt(st["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new tt(st["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new tt(st["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ge(st["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ge(st["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ge(st["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:f0};function ip(t,e,i){var l=2*Math.PI*6378137/256/Math.pow(2,i);return[t*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class np{constructor(e,i,l){this.z=e,this.x=i,this.y=l,this.key=Du(0,e,e,i,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const l=function(p,g,b){var T=ip(256*p,256*(g=Math.pow(2,b)-g-1),b),M=ip(256*(p+1),256*(g+1),b);return T[0]+","+T[1]+","+M[0]+","+M[1]}(this.x,this.y,this.z),u=function(p,g,b){let T,M="";for(let D=p;D>0;D--)T=1<<D-1,M+=(g&T?1:0)+(b&T?2:0);return M}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Lc{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Du(e,i.z,i.z,i.x,i.y)}}class Do{constructor(e,i,l,u,p){this.overscaledZ=e,this.wrap=i,this.canonical=new np(l,+u,+p),this.key=i===0&&e===l?this.canonical.key:Du(i,e,l,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Do(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Do(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Du(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return Du(this.wrap*+i,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Do(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new Do(i,this.wrap,i,l,u),new Do(i,this.wrap,i,l+1,u),new Do(i,this.wrap,i,l,u+1),new Do(i,this.wrap,i,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Do(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Do(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Lc(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Du(t,e,i,l,u){const p=1<<Math.min(i,22);let g=p*(u%p)+l%p;return t&&i<22&&(g+=p*p*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*g+i)+(e-i)}ri(np,"CanonicalTileID"),ri(Do,"OverscaledTileID",{omit:["projMatrix"]});class Fr extends _e{constructor(e,i,l){super(e,i),this.z=l}}function Kr(t,e){return t.x*e.x+t.y*e.y}function gm(t,e){if(t.length===1){let i=0;const l=e[i++];let u;for(;!u||l.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const p=e[i],g=t[0],b=u.sub(l),T=p.sub(l),M=g.sub(l),D=Kr(b,b),O=Kr(b,T),z=Kr(T,T),G=Kr(M,b),j=Kr(M,T),X=D*z-O*O,ie=(z*G-O*j)/X,pe=(D*j-O*G)/X,we=l.z*(1-ie-pe)+u.z*ie+p.z*pe;if(isFinite(we))return we}return 1/0}{let i=1/0;for(const l of e)i=Math.min(i,l.z);return i}}function mg(t,e,i,l,u,p,g,b){const T=g*u.getElevationAt(t,e,!0,!0),M=p[0]!==0,D=M?p[1]===0?g*(p[0]/7-450):g*function(O,z,G){const j=Math.floor(z[0]/8),X=Math.floor(z[1]/8),ie=10*(z[0]-8*j),pe=10*(z[1]-8*X),we=O.getElevationAt(j,X,!0,!0),de=O.getMeterToDEM(G),be=Math.floor(.5*(ie*de-1)),Se=Math.floor(.5*(pe*de-1)),Me=O.tileCoordToPixel(j,X),$e=2*be+1,Je=2*Se+1,ht=function(zt,rt,Kt,Bi,oi){return[zt.getElevationAtPixel(rt,Kt,!0),zt.getElevationAtPixel(rt+oi,Kt,!0),zt.getElevationAtPixel(rt,Kt+oi,!0),zt.getElevationAtPixel(rt+Bi,Kt+oi,!0)]}(O,Me.x-be,Me.y-Se,$e,Je),Rt=Math.abs(ht[0]-ht[1]),nt=Math.abs(ht[2]-ht[3]),mt=Math.abs(ht[0]-ht[2])+Math.abs(ht[1]-ht[3]),xt=Math.min(.25,.5*de*(Rt+nt)/$e),Pt=Math.min(.25,.5*de*mt/Je);return we+Math.max(xt*ie,Pt*pe)}(u,p,b):T;return{base:T+(i===0)?-1:i,top:M?Math.max(D+l,T+i+2):T+l}}const m0=Ti([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:_0}=m0,g0=Ti([{name:"a_packed",components:4,type:"Float32"}]),{members:y0}=g0,v0=ep.types,_g=Math.cos(Math.PI/180*37.5);class Pu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new br,this.layoutVertexArray2=new lr,this.indexArray=new to,this.programConfigurations=new yl(e.layers,e.zoom),this.segments=new Zr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,l,u){this.hasPattern=Xf("line",this.layers,i);const p=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:D,id:O,index:z,sourceLayerIndex:G}of e){const j=this.layers[0]._featureFilter.needGeometry,X=yh(D,j);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),X,l))continue;const ie=p?p.evaluate(X,{},l):void 0,pe={id:O,properties:D.properties,type:D.type,sourceLayerIndex:G,index:z,geometry:j?X.geometry:Qc(D,l,u),patterns:{},sortKey:ie};g.push(pe)}p&&g.sort((D,O)=>D.sortKey-O.sortKey);const{lineAtlas:b,featureIndex:T}=i,M=this.addConstantDashes(b);for(const D of g){const{geometry:O,index:z,sourceLayerIndex:G}=D;if(M&&this.addFeatureDashes(D,b),this.hasPattern){const j=Kf("line",this.layers,D,this.zoom,i);this.patternFeatures.push(j)}else this.addFeature(D,O,z,l,b.positions,i.availableImages);T.insert(e[z].feature,O,z,G,this.index)}}addConstantDashes(e){let i=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,p=l.layout.get("line-cap").value;if(u.kind!=="constant"||p.kind!=="constant")i=!0;else{const g=p.value,b=u.value;if(!b)continue;e.addDash(b,g)}}return i}addFeatureDashes(e,i){const l=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(p.kind==="constant"&&g.kind==="constant")continue;let b,T;if(p.kind==="constant"){if(b=p.value,!b)continue}else b=p.evaluate({zoom:l},e);T=g.kind==="constant"?g.value:g.evaluate({zoom:l},e),i.addDash(b,T),e.patterns[u.id]=i.getKey(b,T)}}update(e,i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,u)}addFeatures(e,i,l,u,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,y0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,l,u,p,g){const b=this.layers[0].layout,T=b.get("line-join").evaluate(e,{}),M=b.get("line-cap").evaluate(e,{}),D=b.get("line-miter-limit"),O=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of i)this.addLine(z,e,T,M,D,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,p,g,u)}addLine(e,i,l,u,p,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let pe=0;pe<e.length-1;pe++)this.totalDistance+=e[pe].dist(e[pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b=v0[i.type]==="Polygon";let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let M=0;for(;M<T-1&&e[M].equals(e[M+1]);)M++;if(T<(b?3:2))return;l==="bevel"&&(p=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let z,G,j,X,ie;this.e1=this.e2=-1,b&&(z=e[T-2],ie=e[M].sub(z)._unit()._perp());for(let pe=M;pe<T;pe++){if(j=pe===T-1?b?e[M+1]:void 0:e[pe+1],j&&e[pe].equals(j))continue;ie&&(X=ie),z&&(G=z),z=e[pe],ie=j?j.sub(z)._unit()._perp():X,X=X||ie;let we=X.add(ie);we.x===0&&we.y===0||we._unit();const de=X.x*ie.x+X.y*ie.y,be=we.x*ie.x+we.y*ie.y,Se=be!==0?1/be:1/0,Me=2*Math.sqrt(2-2*be),$e=be<_g&&G&&j,Je=X.x*ie.y-X.y*ie.x>0;if($e&&pe>M){const nt=z.dist(G);if(nt>2*D){const mt=z.sub(z.sub(G)._mult(D/nt)._round());this.updateDistance(G,mt),this.addCurrentVertex(mt,X,0,0,O),G=mt}}const ht=G&&j;let Rt=ht?l:b?"butt":u;if(ht&&Rt==="round"&&(Se<g?Rt="miter":Se<=2&&(Rt="fakeround")),Rt==="miter"&&Se>p&&(Rt="bevel"),Rt==="bevel"&&(Se>2&&(Rt="flipbevel"),Se<p&&(Rt="miter")),G&&this.updateDistance(G,z),Rt==="miter")we._mult(Se),this.addCurrentVertex(z,we,0,0,O);else if(Rt==="flipbevel"){if(Se>100)we=ie.mult(-1);else{const nt=Se*X.add(ie).mag()/X.sub(ie).mag();we._perp()._mult(nt*(Je?-1:1))}this.addCurrentVertex(z,we,0,0,O),this.addCurrentVertex(z,we.mult(-1),0,0,O)}else if(Rt==="bevel"||Rt==="fakeround"){const nt=-Math.sqrt(Se*Se-1),mt=Je?nt:0,xt=Je?0:nt;if(G&&this.addCurrentVertex(z,X,mt,xt,O),Rt==="fakeround"){const Pt=Math.round(180*Me/Math.PI/20);for(let zt=1;zt<Pt;zt++){let rt=zt/Pt;if(rt!==.5){const Bi=rt-.5;rt+=rt*Bi*(rt-1)*((1.0904+de*(de*(3.55645-1.43519*de)-3.2452))*Bi*Bi+(.848013+de*(.215638*de-1.06021)))}const Kt=ie.sub(X)._mult(rt)._add(X)._unit()._mult(Je?-1:1);this.addHalfVertex(z,Kt.x,Kt.y,!1,Je,0,O)}}j&&this.addCurrentVertex(z,ie,-mt,-xt,O)}else if(Rt==="butt")this.addCurrentVertex(z,we,0,0,O);else if(Rt==="square"){const nt=G?1:-1;G||this.addCurrentVertex(z,we,nt,nt,O),this.addCurrentVertex(z,we,0,0,O),G&&this.addCurrentVertex(z,we,nt,nt,O)}else Rt==="round"&&(G&&(this.addCurrentVertex(z,X,0,0,O),this.addCurrentVertex(z,X,1,1,O,!0)),j&&(this.addCurrentVertex(z,ie,-1,-1,O,!0),this.addCurrentVertex(z,ie,0,0,O)));if($e&&pe<T-1){const nt=z.dist(j);if(nt>2*D){const mt=z.add(j.sub(z)._mult(D/nt)._round());this.updateDistance(z,mt),this.addCurrentVertex(mt,ie,0,0,O),z=mt}}}}addCurrentVertex(e,i,l,u,p,g=!1){const b=i.y*u-i.x,T=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*l,i.y-i.x*l,g,!1,l,p),this.addHalfVertex(e,b,T,g,!0,-u,p)}addHalfVertex({x:e,y:i},l,u,p,g,b,T){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(g?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const M=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,M),T.primitiveLength++),g?this.e2=M:this.e1=M}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}ri(Pu,"LineBucket",{omit:["layers","patternFeatures"]});const ym=new At({"line-cap":new tt(st.layout_line["line-cap"]),"line-join":new tt(st.layout_line["line-join"]),"line-miter-limit":new Ge(st.layout_line["line-miter-limit"]),"line-round-limit":new Ge(st.layout_line["line-round-limit"]),"line-sort-key":new tt(st.layout_line["line-sort-key"])});var gg={paint:new At({"line-opacity":new tt(st.paint_line["line-opacity"]),"line-color":new tt(st.paint_line["line-color"]),"line-translate":new Ge(st.paint_line["line-translate"]),"line-translate-anchor":new Ge(st.paint_line["line-translate-anchor"]),"line-width":new tt(st.paint_line["line-width"]),"line-gap-width":new tt(st.paint_line["line-gap-width"]),"line-offset":new tt(st.paint_line["line-offset"]),"line-blur":new tt(st.paint_line["line-blur"]),"line-dasharray":new tt(st.paint_line["line-dasharray"]),"line-pattern":new tt(st.paint_line["line-pattern"]),"line-gradient":new bt(st.paint_line["line-gradient"]),"line-trim-offset":new Ge(st.paint_line["line-trim-offset"])}),layout:ym};const vm=new class extends tt{possiblyEvaluate(t,e){return e=new He(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,l){return e=Gi({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,l)}}(gg.paint.properties["line-width"].specification);function qd(t,e){return e>0?e+2*t:t}vm.useIntegerZoom=!0;const Ya=Ti([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Jh=Ti([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),x0=Ti([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ti([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const b0=Ti([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),w0=Ti([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Ti([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yg=Ti([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),E0=Ti([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ti([{name:"triangle",components:3,type:"Uint16"}]),Ti([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ti([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ti([{type:"Float32",name:"offsetX"}]),Ti([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var no=24;const vo=128;function Rn(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new He(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:u}=i;let p=0;for(;p<l.length&&l[p]<=t;)p++;p=Math.max(0,p-1);let g=p;for(;g<l.length&&l[g]<t+1;)g++;g=Math.min(l.length-1,g);const b=l[p],T=l[g];return i.kind==="composite"?{kind:"composite",minZoom:b,maxZoom:T,interpolationType:u}:{kind:"camera",minZoom:b,maxZoom:T,minSize:i.evaluate(new He(b)),maxSize:i.evaluate(new He(T)),interpolationType:u}}}function Hd(t,{uSize:e,uSizeT:i},{lowerSize:l,upperSize:u}){return t.kind==="source"?l/vo:t.kind==="composite"?$i(l/vo,u/vo,i):e}function Po(t,e){let i=0,l=0;if(t.kind==="constant")l=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:u,minZoom:p,maxZoom:g}=t,b=u?dt(Fo.interpolationFactor(u,e,p,g),0,1):0;t.kind==="camera"?l=$i(t.minSize,t.maxSize,b):i=b}return{uSizeT:i,uSize:l}}var vg=Object.freeze({__proto__:null,getSizeData:Rn,evaluateSizeForFeature:Hd,evaluateSizeForZoom:Po,SIZE_PACK_FACTOR:vo});function T0(t,e,i){return t.sections.forEach(l=>{l.text=function(u,p,g){const b=p.layout.get("text-transform").evaluate(g,{});return b==="uppercase"?u=u.toLocaleUpperCase():b==="lowercase"&&(u=u.toLocaleLowerCase()),De.applyArabicShaping&&(u=De.applyArabicShaping(u)),u}(l.text,e,i)}),t}const cr={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function I0(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function xg(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var Ou=wr,bg=function(t,e,i,l,u){var p,g,b=8*u-l-1,T=(1<<b)-1,M=T>>1,D=-7,O=i?u-1:0,z=i?-1:1,G=t[e+O];for(O+=z,p=G&(1<<-D)-1,G>>=-D,D+=b;D>0;p=256*p+t[e+O],O+=z,D-=8);for(g=p&(1<<-D)-1,p>>=-D,D+=l;D>0;g=256*g+t[e+O],O+=z,D-=8);if(p===0)p=1-M;else{if(p===T)return g?NaN:1/0*(G?-1:1);g+=Math.pow(2,l),p-=M}return(G?-1:1)*g*Math.pow(2,p-l)},wg=function(t,e,i,l,u,p){var g,b,T,M=8*p-u-1,D=(1<<M)-1,O=D>>1,z=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,G=l?0:p-1,j=l?1:-1,X=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,g=D):(g=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-g))<1&&(g--,T*=2),(e+=g+O>=1?z/T:z*Math.pow(2,1-O))*T>=2&&(g++,T/=2),g+O>=D?(b=0,g=D):g+O>=1?(b=(e*T-1)*Math.pow(2,u),g+=O):(b=e*Math.pow(2,O-1)*Math.pow(2,u),g=0));u>=8;t[i+G]=255&b,G+=j,b/=256,u-=8);for(g=g<<u|b,M+=u;M>0;t[i+G]=255&g,G+=j,g/=256,M-=8);t[i+G-j]|=128*X};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function wr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}wr.Varint=0,wr.Fixed64=1,wr.Bytes=2,wr.Fixed32=5;var xm=4294967296,Eg=1/xm,Tg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function eu(t){return t.type===wr.Bytes?t.readVarint()+t.pos:t.pos+1}function Qh(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Ig(t,e,i){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(l);for(var u=i.pos-1;u>=t;u--)i.buf[u+l]=i.buf[u]}function M0(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function A0(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function S0(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function C0(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function bm(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function L0(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function wm(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function D0(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function P0(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function rp(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function fs(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function oa(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function O0(t,e,i){e.glyphs=[],t===1&&i.readMessage(R0,e)}function R0(t,e,i){if(t===3){const{id:l,bitmap:u,width:p,height:g,left:b,top:T,advance:M}=i.readMessage(k0,{});e.glyphs.push({id:l,bitmap:new bl({width:p+6,height:g+6},u),metrics:{width:p,height:g,left:b,top:T,advance:M}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function k0(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}function sp(t){let e=0,i=0;for(const g of t)e+=g.w*g.h,i=Math.max(i,g.w);t.sort((g,b)=>b.h-g.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,p=0;for(const g of t)for(let b=l.length-1;b>=0;b--){const T=l[b];if(!(g.w>T.w||g.h>T.h)){if(g.x=T.x,g.y=T.y,p=Math.max(p,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===T.w&&g.h===T.h){const M=l.pop();b<l.length&&(l[b]=M)}else g.h===T.h?(T.x+=g.w,T.w-=g.w):g.w===T.w?(T.y+=g.h,T.h-=g.h):(l.push({x:T.x+g.w,y:T.y,w:T.w-g.w,h:g.h}),T.y+=g.h,T.h-=g.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}wr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var l=this.readVarint(),u=l>>3,p=this.pos;this.type=7&l,t(u,e,this),this.pos===p&&this.skip(l)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=rp(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=oa(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=rp(this.buf,this.pos)+rp(this.buf,this.pos+4)*xm;return this.pos+=8,t},readSFixed64:function(){var t=rp(this.buf,this.pos)+oa(this.buf,this.pos+4)*xm;return this.pos+=8,t},readFloat:function(){var t=bg(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=bg(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,l=this.buf;return e=127&(i=l[this.pos++]),i<128?e:(e|=(127&(i=l[this.pos++]))<<7,i<128?e:(e|=(127&(i=l[this.pos++]))<<14,i<128?e:(e|=(127&(i=l[this.pos++]))<<21,i<128?e:function(u,p,g){var b,T,M=g.buf;if(b=(112&(T=M[g.pos++]))>>4,T<128||(b|=(127&(T=M[g.pos++]))<<3,T<128)||(b|=(127&(T=M[g.pos++]))<<10,T<128)||(b|=(127&(T=M[g.pos++]))<<17,T<128)||(b|=(127&(T=M[g.pos++]))<<24,T<128)||(b|=(1&(T=M[g.pos++]))<<31,T<128))return Qh(u,b,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=l[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Tg?function(i,l,u){return Tg.decode(i.subarray(l,u))}(this.buf,e,t):function(i,l,u){for(var p="",g=l;g<u;){var b,T,M,D=i[g],O=null,z=D>239?4:D>223?3:D>191?2:1;if(g+z>u)break;z===1?D<128&&(O=D):z===2?(192&(b=i[g+1]))==128&&(O=(31&D)<<6|63&b)<=127&&(O=null):z===3?(T=i[g+2],(192&(b=i[g+1]))==128&&(192&T)==128&&((O=(15&D)<<12|(63&b)<<6|63&T)<=2047||O>=55296&&O<=57343)&&(O=null)):z===4&&(T=i[g+2],M=i[g+3],(192&(b=i[g+1]))==128&&(192&T)==128&&(192&M)==128&&((O=(15&D)<<18|(63&b)<<12|(63&T)<<6|63&M)<=65535||O>=1114112)&&(O=null)),O===null?(O=65533,z=1):O>65535&&(O-=65536,p+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),p+=String.fromCharCode(O),g+=z}return p}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==wr.Bytes)return t.push(this.readVarint(e));var i=eu(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==wr.Bytes)return t.push(this.readSVarint());var e=eu(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==wr.Bytes)return t.push(this.readBoolean());var e=eu(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==wr.Bytes)return t.push(this.readFloat());var e=eu(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==wr.Bytes)return t.push(this.readDouble());var e=eu(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==wr.Bytes)return t.push(this.readFixed32());var e=eu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==wr.Bytes)return t.push(this.readSFixed32());var e=eu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==wr.Bytes)return t.push(this.readFixed64());var e=eu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==wr.Bytes)return t.push(this.readSFixed64());var e=eu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===wr.Varint)for(;this.buf[this.pos++]>127;);else if(e===wr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===wr.Fixed32)this.pos+=4;else{if(e!==wr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),fs(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),fs(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),fs(this.buf,-1&t,this.pos),fs(this.buf,Math.floor(t*Eg),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),fs(this.buf,-1&t,this.pos),fs(this.buf,Math.floor(t*Eg),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var l,u;if(e>=0?(l=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(p,g,b){b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,p>>>=7,b.buf[b.pos++]=127&p|128,b.buf[b.pos]=127&(p>>>=7)}(l,0,i),function(p,g){var b=(7&p)<<4;g.buf[g.pos++]|=b|((p>>>=3)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p|((p>>>=7)?128:0),p&&(g.buf[g.pos++]=127&p)))))}(u,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(l,u,p){for(var g,b,T=0;T<u.length;T++){if((g=u.charCodeAt(T))>55295&&g<57344){if(!b){g>56319||T+1===u.length?(l[p++]=239,l[p++]=191,l[p++]=189):b=g;continue}if(g<56320){l[p++]=239,l[p++]=191,l[p++]=189,b=g;continue}g=b-55296<<10|g-56320|65536,b=null}else b&&(l[p++]=239,l[p++]=191,l[p++]=189,b=null);g<128?l[p++]=g:(g<2048?l[p++]=g>>6|192:(g<65536?l[p++]=g>>12|224:(l[p++]=g>>18|240,l[p++]=g>>12&63|128),l[p++]=g>>6&63|128),l[p++]=63&g|128)}return p}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Ig(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),wg(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),wg(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var l=this.pos-i;l>=128&&Ig(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeMessage:function(t,e,i){this.writeTag(t,wr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,M0,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,A0,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,bm,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,S0,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,C0,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,L0,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,wm,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,D0,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,P0,e)},writeBytesField:function(t,e){this.writeTag(t,wr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,wr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,wr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,wr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,wr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,wr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,wr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,wr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,wr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,wr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};class Em{constructor(e,{pixelRatio:i,version:l,stretchX:u,stretchY:p,content:g}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=p,this.content=g,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Mg{constructor(e,i){const l={},u={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,l,p),this.addImages(i,u,p);const{w:g,h:b}=sp(p),T=new Ea({width:g||1,height:b||1});for(const M in e){const D=e[M],O=l[M].paddedRect;Ea.copy(D.data,T,{x:0,y:0},{x:O.x+1,y:O.y+1},D.data)}for(const M in i){const D=i[M],O=u[M].paddedRect,z=O.x+1,G=O.y+1,j=D.data.width,X=D.data.height;Ea.copy(D.data,T,{x:0,y:0},{x:z,y:G},D.data),Ea.copy(D.data,T,{x:0,y:X-1},{x:z,y:G-1},{width:j,height:1}),Ea.copy(D.data,T,{x:0,y:0},{x:z,y:G+X},{width:j,height:1}),Ea.copy(D.data,T,{x:j-1,y:0},{x:z-1,y:G},{width:1,height:X}),Ea.copy(D.data,T,{x:0,y:0},{x:z+j,y:G},{width:1,height:X})}this.image=T,this.iconPositions=l,this.patternPositions=u}addImages(e,i,l){for(const u in e){const p=e[u],g={x:0,y:0,w:p.data.width+2,h:p.data.height+2};l.push(g),i[u]=new Em(g,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),i),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),i)}patchUpdatedImage(e,i,l){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,p]=e.tl;l.update(i.data,void 0,{x:u,y:p})}}ri(Em,"ImagePosition"),ri(Mg,"ImageAtlas");const Ja={horizontal:1,vertical:2,horizontalOnly:3};class $h{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const l=new $h;return l.scale=e||1,l.fontStack=i,l}static forImage(e){const i=new $h;return i.imageName=e,i}}class ed{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const l=new ed;for(let u=0;u<e.sections.length;u++){const p=e.sections[u];p.image?l.addImageSection(p):l.addTextSection(p,i)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,l){let u="";for(let p=0;p<i.length;p++){const g=i.charCodeAt(p+1)||null,b=i.charCodeAt(p-1)||null;u+=!l&&(g&&P(g)&&!cr[i[p+1]]||b&&P(b)&&!cr[i[p-1]])||!cr[i[p]]?i[p]:cr[i[p]]}return u}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&op[this.text.charCodeAt(l)];l++)e++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&op[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const l=new ed;return l.text=this.text.substring(e,i),l.sectionIndex=this.sectionIndex.slice(e,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push($h.forText(e.scale,e.fontStack||i));const l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Ii("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push($h.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Ii("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Tm(t,e,i,l,u,p,g,b,T,M,D,O,z,G,j){const X=ed.fromFeature(t,u);O===Ja.vertical&&X.verticalizePunctuation(z);let ie=[];const pe=function(Me,$e,Je,ht,Rt,nt){if(!Me)return[];const mt=[],xt=function(Kt,Bi,oi,vi,Yt,Ui){let Fn=0;for(let kn=0;kn<Kt.length();kn++){const An=Kt.getSection(kn);Fn+=Im(Kt.getCharCode(kn),An,vi,Yt,Bi,Ui)}return Fn/Math.max(1,Math.ceil(Fn/oi))}(Me,$e,Je,ht,Rt,nt),Pt=Me.text.indexOf("​")>=0;let zt=0;for(let Kt=0;Kt<Me.length();Kt++){const Bi=Me.getSection(Kt),oi=Me.getCharCode(Kt);if(op[oi]||(zt+=Im(oi,Bi,ht,Rt,$e,nt)),Kt<Me.length()-1){const vi=!((rt=oi)<11904||!(ga(rt)||Bh(rt)||f(rt)||Nh(rt)||gf(rt)||pf(rt)||mf(rt)||dh(rt)||yf(rt)||Fh(rt)||_f(rt)||m(rt)||_l(rt)||xd(rt)||vd(rt)||bd(rt)||wu(rt)||wc(rt)||vf(rt)||wd(rt)));(Ag[oi]||vi||Bi.imageName)&&mt.push(Cg(Kt+1,zt,xt,mt,z0(oi,Me.getCharCode(Kt+1),vi&&Pt),!1))}}var rt;return Lg(Cg(Me.length(),zt,xt,mt,0,!0))}(X,M,p,e,l,G),{processBidirectionalText:we,processStyledBidirectionalText:de}=De;if(we&&X.sections.length===1){const Me=we(X.toString(),pe);for(const $e of Me){const Je=new ed;Je.text=$e,Je.sections=X.sections;for(let ht=0;ht<$e.length;ht++)Je.sectionIndex.push(0);ie.push(Je)}}else if(de){const Me=de(X.text,X.sectionIndex,pe);for(const $e of Me){const Je=new ed;Je.text=$e[0],Je.sectionIndex=$e[1],Je.sections=X.sections,ie.push(Je)}}else ie=function(Me,$e){const Je=[],ht=Me.text;let Rt=0;for(const nt of $e)Je.push(Me.substring(Rt,nt)),Rt=nt;return Rt<ht.length&&Je.push(Me.substring(Rt,ht.length)),Je}(X,pe);const be=[],Se={positionedLines:be,text:X.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Me,$e,Je,ht,Rt,nt,mt,xt,Pt,zt,rt,Kt){let Bi=0,oi=0,vi=0;const Yt=xt==="right"?1:xt==="left"?0:.5;let Ui=!1;for(const sn of Rt){const Nn=sn.getSections();for(const Er of Nn){if(Er.imageName)continue;const Nr=$e[Er.fontStack];if(Nr&&(Ui=Nr.ascender!==void 0&&Nr.descender!==void 0,!Ui))break}if(!Ui)break}let Fn=0;for(const sn of Rt){sn.trim();const Nn=sn.getMaxScale(),Er=(Nn-1)*no,Nr={positionedGlyphs:[],lineOffset:0};Me.positionedLines[Fn]=Nr;const zr=Nr.positionedGlyphs;let Ur=0;if(!sn.length()){oi+=nt,++Fn;continue}let jr=0,ps=0;for(let gr=0;gr<sn.length();gr++){const Zs=sn.getSection(gr),Bs=sn.getSectionIndex(gr),tr=sn.getCharCode(gr);let es=Zs.scale,ro=null,Tr=null,Ms=null,aa=no,Ro=0;const ko=!(Pt===Ja.horizontal||!rt&&!L(tr)||rt&&(op[tr]||(kn=tr,hh(kn)||ml(kn)||yd(kn)||bc(kn)||c(kn))));if(Zs.imageName){const Sa=ht[Zs.imageName];if(!Sa)continue;Ms=Zs.imageName,Me.iconsInText=Me.iconsInText||!0,Tr=Sa.paddedRect;const zo=Sa.displaySize;es=es*no/Kt,ro={width:zo[0],height:zo[1],left:1,top:-3,advance:ko?zo[1]:zo[0],localGlyph:!1},Ro=Ui?-ro.height*es:Nn*no-17-zo[1]*es,aa=ro.advance;const Th=(ko?zo[0]:zo[1])*es-no*Nn;Th>0&&Th>Ur&&(Ur=Th)}else{const Sa=Je[Zs.fontStack];if(!Sa)continue;Sa[tr]&&(Tr=Sa[tr]);const zo=$e[Zs.fontStack];if(!zo)continue;const Th=zo.glyphs[tr];if(!Th)continue;if(ro=Th.metrics,aa=tr!==8203?no:0,Ui){const vp=zo.ascender!==void 0?Math.abs(zo.ascender):0,Nm=zo.descender!==void 0?Math.abs(zo.descender):0,Um=(vp+Nm)*es;jr<Um&&(jr=Um,ps=(vp-Nm)/2*es),Ro=-vp*es}else Ro=(Nn-es)*no-17}ko?(Me.verticalizable=!0,zr.push({glyph:tr,imageName:Ms,x:Bi,y:oi+Ro,vertical:ko,scale:es,localGlyph:ro.localGlyph,fontStack:Zs.fontStack,sectionIndex:Bs,metrics:ro,rect:Tr}),Bi+=aa*es+zt):(zr.push({glyph:tr,imageName:Ms,x:Bi,y:oi+Ro,vertical:ko,scale:es,localGlyph:ro.localGlyph,fontStack:Zs.fontStack,sectionIndex:Bs,metrics:ro,rect:Tr}),Bi+=ro.advance*es+zt)}zr.length!==0&&(vi=Math.max(Bi-zt,vi),Ui?Dg(zr,Yt,Ur,ps,nt*Nn/2):Dg(zr,Yt,Ur,0,nt/2)),Bi=0;const Oo=nt*Nn+Ur;Nr.lineOffset=Math.max(Ur,Er),oi+=Oo,++Fn}var kn;const An=oi,{horizontalAlign:ji,verticalAlign:_r}=Ru(mt);(function(sn,Nn,Er,Nr,zr,Ur){const jr=(Nn-Er)*zr,ps=-Ur*Nr;for(const Oo of sn)for(const gr of Oo.positionedGlyphs)gr.x+=jr,gr.y+=ps})(Me.positionedLines,Yt,ji,_r,vi,An),Me.top+=-_r*An,Me.bottom=Me.top+An,Me.left+=-ji*vi,Me.right=Me.left+vi,Me.hasBaseline=Ui}(Se,e,i,l,ie,g,b,T,O,M,z,j),!function(Me){for(const $e of Me)if($e.positionedGlyphs.length!==0)return!1;return!0}(be)&&Se}const op={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ag={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Im(t,e,i,l,u,p){if(e.imageName){const g=l[e.imageName];return g?g.displaySize[0]*e.scale*no/p+u:0}{const g=i[e.fontStack],b=g&&g.glyphs[t];return b?b.metrics.advance*e.scale+u:0}}function Sg(t,e,i,l){const u=Math.pow(t-e,2);return l?t<e?u/2:2*u:u+Math.abs(i)*i}function z0(t,e,i){let l=0;return t===10&&(l-=1e4),i&&(l+=150),t!==40&&t!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function Cg(t,e,i,l,u,p){let g=null,b=Sg(e,i,u,p);for(const T of l){const M=Sg(e-T.x,i,u,p)+T.badness;M<=b&&(g=T,b=M)}return{index:t,x:e,priorBreak:g,badness:b}}function Lg(t){return t?Lg(t.priorBreak).concat(t.index):[]}function Ru(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Dg(t,e,i,l,u){if(!(e||i||l||u))return;const p=t.length-1,g=t[p],b=(g.x+g.metrics.advance*g.scale)*e;for(let T=0;T<=p;T++)t[T].x-=b,t[T].y+=i+l+u}function B0(t,e,i){const{horizontalAlign:l,verticalAlign:u}=Ru(i),p=e[0]-t.displaySize[0]*l,g=e[1]-t.displaySize[1]*u;return{image:t,top:g,bottom:g+t.displaySize[1],left:p,right:p+t.displaySize[0]}}function Pg(t,e,i,l,u,p){const g=t.image;let b;if(g.content){const ie=g.content,pe=g.pixelRatio||1;b=[ie[0]/pe,ie[1]/pe,g.displaySize[0]-ie[2]/pe,g.displaySize[1]-ie[3]/pe]}const T=e.left*p,M=e.right*p;let D,O,z,G;i==="width"||i==="both"?(G=u[0]+T-l[3],O=u[0]+M+l[1]):(G=u[0]+(T+M-g.displaySize[0])/2,O=G+g.displaySize[0]);const j=e.top*p,X=e.bottom*p;return i==="height"||i==="both"?(D=u[1]+j-l[0],z=u[1]+X+l[2]):(D=u[1]+(j+X-g.displaySize[1])/2,z=D+g.displaySize[1]),{image:g,top:D,right:O,bottom:z,left:G,collisionPadding:b}}class tu extends _e{constructor(e,i,l,u,p){super(e,i),this.angle=u,this.z=l,p!==void 0&&(this.segment=p)}clone(){return new tu(this.x,this.y,this.z,this.angle,this.segment)}}function Og(t,e,i,l,u){if(e.segment===void 0)return!0;let p=e,g=e.segment+1,b=0;for(;b>-i/2;){if(g--,g<0)return!1;b-=t[g].dist(p),p=t[g]}b+=t[g].dist(t[g+1]),g++;const T=[];let M=0;for(;b<i/2;){const D=t[g],O=t[g+1];if(!O)return!1;let z=t[g-1].angleTo(D)-D.angleTo(O);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:b,angleDelta:z}),M+=z;b-T[0].distance>l;)M-=T.shift().angleDelta;if(M>u)return!1;g++,b+=D.dist(O)}return!0}function Mm(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Am(t,e,i){return t?.6*e*i:0}function Rg(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function F0(t,e,i,l,u,p){const g=Am(i,u,p),b=Rg(i,l)*p;let T=0;const M=Mm(t)/2;for(let D=0;D<t.length-1;D++){const O=t[D],z=t[D+1],G=O.dist(z);if(T+G>M){const j=(M-T)/G,X=$i(O.x,z.x,j),ie=$i(O.y,z.y,j),pe=new tu(X,ie,0,z.angleTo(O),D);return!g||Og(t,pe,b,g,e)?pe:void 0}T+=G}}function N0(t,e,i,l,u,p,g,b,T){const M=Am(l,p,g),D=Rg(l,u),O=D*g,z=t[0].x===0||t[0].x===T||t[0].y===0||t[0].y===T;return e-O<e/4&&(e=O+e/4),kg(t,z?e/2*b%e:(D/2+2*p)*g*b%e,e,M,i,O,z,!1,T)}function kg(t,e,i,l,u,p,g,b,T){const M=p/2,D=Mm(t);let O=0,z=e-i,G=[];for(let j=0;j<t.length-1;j++){const X=t[j],ie=t[j+1],pe=X.dist(ie),we=ie.angleTo(X);for(;z+i<O+pe;){z+=i;const de=(z-O)/pe,be=$i(X.x,ie.x,de),Se=$i(X.y,ie.y,de);if(be>=0&&be<T&&Se>=0&&Se<T&&z-M>=0&&z+M<=D){const Me=new tu(be,Se,0,we,j);Me._round(),l&&!Og(t,Me,p,l,u)||G.push(Me)}}O+=pe}return b||G.length||g||(G=kg(t,O/2,i,l,u,p,g,!0,T)),G}function zg(t,e,i,l,u){const p=[];for(let g=0;g<t.length;g++){const b=t[g];let T;for(let M=0;M<b.length-1;M++){let D=b[M],O=b[M+1];D.x<e&&O.x<e||(D.x<e?D=new _e(e,D.y+(e-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x<e&&(O=new _e(e,D.y+(e-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y<i&&O.y<i||(D.y<i?D=new _e(D.x+(i-D.y)/(O.y-D.y)*(O.x-D.x),i)._round():O.y<i&&(O=new _e(D.x+(i-D.y)/(O.y-D.y)*(O.x-D.x),i)._round()),D.x>=l&&O.x>=l||(D.x>=l?D=new _e(l,D.y+(l-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x>=l&&(O=new _e(l,D.y+(l-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y>=u&&O.y>=u||(D.y>=u?D=new _e(D.x+(u-D.y)/(O.y-D.y)*(O.x-D.x),u)._round():O.y>=u&&(O=new _e(D.x+(u-D.y)/(O.y-D.y)*(O.x-D.x),u)._round()),T&&D.equals(T[T.length-1])||(T=[D],p.push(T)),T.push(O)))))}}return p}ri(tu,"Anchor");const Wd=1e20;function Bg(t,e,i,l,u,p,g,b,T){for(let M=e;M<e+l;M++)Fg(t,i*p+M,p,u,g,b,T);for(let M=i;M<i+u;M++)Fg(t,M*p+e,1,l,g,b,T)}function Fg(t,e,i,l,u,p,g){p[0]=0,g[0]=-Wd,g[1]=Wd,u[0]=t[e];for(let b=1,T=0,M=0;b<l;b++){u[b]=t[e+b*i];const D=b*b;do{const O=p[T];M=(u[b]-u[O]+D-O*O)/(b-O)/2}while(M<=g[T]&&--T>-1);T++,p[T]=b,g[T]=M,g[T+1]=Wd}for(let b=0,T=0;b<l;b++){for(;g[T+1]<b;)T++;const M=p[T],D=b-M;t[e+b*i]=u[M]+D*D}}const Sm={none:0,ideographs:1,all:2};class td{constructor(e,i,l){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const l=[];for(const u in e)for(const p of e[u])l.push({stack:u,id:p});Gt(l,({stack:u,id:p},g)=>{let b=this.entries[u];b||(b=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=b.glyphs[p];if(T!==void 0)return void g(null,{stack:u,id:p,glyph:T});if(T=this._tinySDF(b,u,p),T)return b.glyphs[p]=T,void g(null,{stack:u,id:p,glyph:T});const M=Math.floor(p/256);if(256*M>65535)return void g(new Error("glyphs > 65535 not supported"));if(b.ranges[M])return void g(null,{stack:u,id:p,glyph:T});let D=b.requests[M];D||(D=b.requests[M]=[],td.loadGlyphRange(u,M,this.url,this.requestManager,(O,z)=>{if(z){b.ascender=z.ascender,b.descender=z.descender;for(const G in z.glyphs)this._doesCharSupportLocalGlyph(+G)||(b.glyphs[+G]=z.glyphs[+G]);b.ranges[M]=!0}for(const G of D)G(O,z);delete b.requests[M]})),D.push((O,z)=>{O?g(O):z&&g(null,{stack:u,id:p,glyph:z.glyphs[p]||null})})},(u,p)=>{if(u)i(u);else if(p){const g={};for(const{stack:b,id:T,glyph:M}of p)g[b]===void 0&&(g[b]={}),g[b].glyphs===void 0&&(g[b].glyphs={}),g[b].glyphs[T]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},g[b].ascender=this.entries[b].ascender,g[b].descender=this.entries[b].descender;i(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Sm.none&&(this.localGlyphMode===Sm.all?!!this.localFontFamily:!!this.localFontFamily&&(Fh(e)||xf(e)||_l(e)||wu(e)||dh(e)))}_tinySDF(e,i,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let p=e.tinySDF;if(!p){let X="400";/bold/i.test(i)?X="900":/medium/i.test(i)?X="500":/light/i.test(i)&&(X="200"),p=e.tinySDF=new td.TinySDF({fontFamily:u,fontWeight:X,fontSize:48,buffer:6,radius:16}),p.fontWeight=X}if(this.localGlyphs[p.fontWeight][l])return this.localGlyphs[p.fontWeight][l];const g=String.fromCharCode(l),{data:b,width:T,height:M,glyphWidth:D,glyphHeight:O,glyphLeft:z,glyphTop:G,glyphAdvance:j}=p.draw(g);return this.localGlyphs[p.fontWeight][l]={id:l,bitmap:new bl({width:T,height:M},b),metrics:{width:D/2,height:O/2,left:z/2,top:G/2-27,advance:j/2,localGlyph:!0}}}}function Ng(t,e,i,l){const u=[],p=t.image,g=p.pixelRatio,b=p.paddedRect.w-2,T=p.paddedRect.h-2,M=t.right-t.left,D=t.bottom-t.top,O=p.stretchX||[[0,b]],z=p.stretchY||[[0,T]],G=(nt,mt)=>nt+mt[1]-mt[0],j=O.reduce(G,0),X=z.reduce(G,0),ie=b-j,pe=T-X;let we=0,de=j,be=0,Se=X,Me=0,$e=ie,Je=0,ht=pe;if(p.content&&l){const nt=p.content;we=ap(O,0,nt[0]),be=ap(z,0,nt[1]),de=ap(O,nt[0],nt[2]),Se=ap(z,nt[1],nt[3]),Me=nt[0]-we,Je=nt[1]-be,$e=nt[2]-nt[0]-de,ht=nt[3]-nt[1]-Se}const Rt=(nt,mt,xt,Pt)=>{const zt=lp(nt.stretch-we,de,M,t.left),rt=cp(nt.fixed-Me,$e,nt.stretch,j),Kt=lp(mt.stretch-be,Se,D,t.top),Bi=cp(mt.fixed-Je,ht,mt.stretch,X),oi=lp(xt.stretch-we,de,M,t.left),vi=cp(xt.fixed-Me,$e,xt.stretch,j),Yt=lp(Pt.stretch-be,Se,D,t.top),Ui=cp(Pt.fixed-Je,ht,Pt.stretch,X),Fn=new _e(zt,Kt),kn=new _e(oi,Kt),An=new _e(oi,Yt),ji=new _e(zt,Yt),_r=new _e(rt/g,Bi/g),sn=new _e(vi/g,Ui/g),Nn=e*Math.PI/180;if(Nn){const zr=Math.sin(Nn),Ur=Math.cos(Nn),jr=[Ur,-zr,zr,Ur];Fn._matMult(jr),kn._matMult(jr),ji._matMult(jr),An._matMult(jr)}const Er=nt.stretch+nt.fixed,Nr=mt.stretch+mt.fixed;return{tl:Fn,tr:kn,bl:ji,br:An,tex:{x:p.paddedRect.x+1+Er,y:p.paddedRect.y+1+Nr,w:xt.stretch+xt.fixed-Er,h:Pt.stretch+Pt.fixed-Nr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:_r,pixelOffsetBR:sn,minFontScaleX:$e/g/M,minFontScaleY:ht/g/D,isSDF:i}};if(l&&(p.stretchX||p.stretchY)){const nt=Ug(O,ie,j),mt=Ug(z,pe,X);for(let xt=0;xt<nt.length-1;xt++){const Pt=nt[xt],zt=nt[xt+1];for(let rt=0;rt<mt.length-1;rt++)u.push(Rt(Pt,mt[rt],zt,mt[rt+1]))}}else u.push(Rt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:T+1}));return u}function ap(t,e,i){let l=0;for(const u of t)l+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return l}function Ug(t,e,i){const l=[{fixed:-1,stretch:0}];for(const[u,p]of t){const g=l[l.length-1];l.push({fixed:u-g.stretch,stretch:g.stretch}),l.push({fixed:u-g.stretch,stretch:g.stretch+(p-u)})}return l.push({fixed:e+1,stretch:i}),l}function lp(t,e,i,l){return t/e*i+l}function cp(t,e,i,l){return t-e*i/l}function U0(t,e,i,l){const u=e+t.positionedLines[l].lineOffset;return l===0?i+u/2:i+(u+(e+t.positionedLines[l-1].lineOffset))/2}td.loadGlyphRange=function(t,e,i,l,u){const p=256*e,g=p+255,b=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${p}-${g}`),yt.Glyphs);ls(b,(T,M)=>{if(T)u(T);else if(M){const D={},O=function(z){return new Ou(z).readFields(O0,{})}(M);for(const z of O.glyphs)D[z.id]=z;u(null,{glyphs:D,ascender:O.ascender,descender:O.descender})}})},td.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=i;const b=this.size=t+4*e,T=this._createCanvas(b),M=this.ctx=T.getContext("2d",{willReadFrequently:!0});M.font=`${g} ${p} ${t}px ${u}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(t),g=Math.ceil(i),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),T=Math.min(this.size-this.buffer,g+Math.ceil(l)),M=b+2*this.buffer,D=T+2*this.buffer,O=Math.max(M*D,0),z=new Uint8ClampedArray(O),G={data:z,width:M,height:D,glyphWidth:b,glyphHeight:T,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(b===0||T===0)return G;const{ctx:j,buffer:X,gridInner:ie,gridOuter:pe}=this;j.clearRect(X,X,b,T),j.fillText(t,X,X+g);const we=j.getImageData(X,X,b,T);pe.fill(Wd,0,O),ie.fill(0,0,O);for(let de=0;de<T;de++)for(let be=0;be<b;be++){const Se=we.data[4*(de*b+be)+3]/255;if(Se===0)continue;const Me=(de+X)*M+be+X;if(Se===1)pe[Me]=0,ie[Me]=Wd;else{const $e=.5-Se;pe[Me]=$e>0?$e*$e:0,ie[Me]=$e<0?$e*$e:0}}Bg(pe,0,0,M,D,M,this.f,this.v,this.z),Bg(ie,X,X,b,T,M,this.f,this.v,this.z);for(let de=0;de<O;de++){const be=Math.sqrt(pe[de])-Math.sqrt(ie[de]);z[de]=Math.round(255-255*(be/this.radius+this.cutoff))}return G}};class V0{constructor(e=[],i=G0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:l}=this,u=i[e];for(;e>0;){const p=e-1>>1,g=i[p];if(l(u,g)>=0)break;i[e]=g,e=p}i[e]=u}_down(e){const{data:i,compare:l}=this,u=this.length>>1,p=i[e];for(;e<u;){let g=1+(e<<1),b=i[g];const T=g+1;if(T<this.length&&l(i[T],b)<0&&(g=T,b=i[T]),l(b,p)>=0)break;i[e]=b,e=g}i[e]=p}}function G0(t,e){return t<e?-1:t>e?1:0}function j0(t,e=1,i=!1){let l=1/0,u=1/0,p=-1/0,g=-1/0;const b=t[0];for(let G=0;G<b.length;G++){const j=b[G];(!G||j.x<l)&&(l=j.x),(!G||j.y<u)&&(u=j.y),(!G||j.x>p)&&(p=j.x),(!G||j.y>g)&&(g=j.y)}const T=Math.min(p-l,g-u);let M=T/2;const D=new V0([],q0);if(T===0)return new _e(l,u);for(let G=l;G<p;G+=T)for(let j=u;j<g;j+=T)D.push(new id(G+M,j+M,M,t));let O=function(G){let j=0,X=0,ie=0;const pe=G[0];for(let we=0,de=pe.length,be=de-1;we<de;be=we++){const Se=pe[we],Me=pe[be],$e=Se.x*Me.y-Me.x*Se.y;X+=(Se.x+Me.x)*$e,ie+=(Se.y+Me.y)*$e,j+=3*$e}return new id(X/j,ie/j,0,G)}(t),z=D.length;for(;D.length;){const G=D.pop();(G.d>O.d||!O.d)&&(O=G,i&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,z)),G.max-O.d<=e||(M=G.h/2,D.push(new id(G.p.x-M,G.p.y-M,M,t)),D.push(new id(G.p.x+M,G.p.y-M,M,t)),D.push(new id(G.p.x-M,G.p.y+M,M,t)),D.push(new id(G.p.x+M,G.p.y+M,M,t)),z+=4)}return i&&(console.log(`num probes: ${z}`),console.log(`best distance: ${O.d}`)),O.p}function q0(t,e){return e.max-t.max}function id(t,e,i,l){this.p=new _e(t,e),this.h=i,this.d=function(u,p){let g=!1,b=1/0;for(let T=0;T<p.length;T++){const M=p[T];for(let D=0,O=M.length,z=O-1;D<O;z=D++){const G=M[D],j=M[z];G.y>u.y!=j.y>u.y&&u.x<(j.x-G.x)*(u.y-G.y)/(j.y-G.y)+G.x&&(g=!g),b=Math.min(b,H_(u,G,j))}}return(g?1:-1)*Math.sqrt(b)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const Cm=Number.POSITIVE_INFINITY,H0=Math.sqrt(2);function Vg(t,[e,i]){let l=0,u=0;if(i===Cm){e<0&&(e=0);const p=e/H0;switch(t){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(t){case"top-right":case"bottom-right":l=-p;break;case"top-left":case"bottom-left":l=p;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":u=i-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-i}switch(t){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,u]}function W0(t,e,i,l,u,p,g,b,T,M){t.createArrays(),t.tilePixelRatio=Fi/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const D=t.layers[0].layout,O=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){const{minZoom:X,maxZoom:ie}=t.textSizeData;z.compositeTextSizes=[O["text-size"].possiblyEvaluate(new He(X),b),O["text-size"].possiblyEvaluate(new He(ie),b)]}if(t.iconSizeData.kind==="composite"){const{minZoom:X,maxZoom:ie}=t.iconSizeData;z.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new He(X),b),O["icon-size"].possiblyEvaluate(new He(ie),b)]}z.layoutTextSize=O["text-size"].possiblyEvaluate(new He(T+1),b),z.layoutIconSize=O["icon-size"].possiblyEvaluate(new He(T+1),b),z.textMaxSize=O["text-size"].possiblyEvaluate(new He(18),b);const G=D.get("text-rotation-alignment")==="map"&&D.get("symbol-placement")!=="point",j=D.get("text-size");for(const X of t.features){const ie=D.get("text-font").evaluate(X,{},b).join(","),pe=j.evaluate(X,{},b),we=z.layoutTextSize.evaluate(X,{},b),de=(z.layoutIconSize.evaluate(X,{},b),{horizontal:{},vertical:void 0}),be=X.text;let Se,Me=[0,0];if(be){const ht=be.toString(),Rt=D.get("text-letter-spacing").evaluate(X,{},b)*no,nt=D.get("text-line-height").evaluate(X,{},b)*no,mt=w(ht)?Rt:0,xt=D.get("text-anchor").evaluate(X,{},b),Pt=D.get("text-variable-anchor");if(!Pt){const oi=D.get("text-radial-offset").evaluate(X,{},b);Me=oi?Vg(xt,[oi*no,Cm]):D.get("text-offset").evaluate(X,{},b).map(vi=>vi*no)}let zt=G?"center":D.get("text-justify").evaluate(X,{},b);const rt=D.get("symbol-placement")==="point",Kt=rt?D.get("text-max-width").evaluate(X,{},b)*no:1/0,Bi=oi=>{t.allowVerticalPlacement&&x(ht)&&(de.vertical=Tm(be,e,i,u,ie,Kt,nt,xt,oi,mt,Me,Ja.vertical,!0,we,pe))};if(!G&&Pt){const oi=zt==="auto"?Pt.map(Yt=>Zd(Yt)):[zt];let vi=!1;for(let Yt=0;Yt<oi.length;Yt++){const Ui=oi[Yt];if(!de.horizontal[Ui])if(vi)de.horizontal[Ui]=de.horizontal[0];else{const Fn=Tm(be,e,i,u,ie,Kt,nt,"center",Ui,mt,Me,Ja.horizontal,!1,we,pe);Fn&&(de.horizontal[Ui]=Fn,vi=Fn.positionedLines.length===1)}}Bi("left")}else{if(zt==="auto"&&(zt=Zd(xt)),rt||D.get("text-writing-mode").indexOf("horizontal")>=0||!x(ht)){const oi=Tm(be,e,i,u,ie,Kt,nt,xt,zt,mt,Me,Ja.horizontal,!1,we,pe);oi&&(de.horizontal[zt]=oi)}Bi(rt?"left":zt)}}let $e=!1;if(X.icon&&X.icon.name){const ht=l[X.icon.name];ht&&(Se=B0(u[X.icon.name],D.get("icon-offset").evaluate(X,{},b),D.get("icon-anchor").evaluate(X,{},b)),$e=ht.sdf,t.sdfIcons===void 0?t.sdfIcons=ht.sdf:t.sdfIcons!==ht.sdf&&Ii("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ht.pixelRatio!==t.pixelRatio||D.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Je=qg(de.horizontal)||de.vertical;t.iconsInText||(t.iconsInText=!!Je&&Je.iconsInText),(Je||Se)&&Gg(t,X,de,Se,l,z,we,0,Me,$e,g,b,M)}p&&t.generateCollisionDebugBuffers(T,t.collisionBoxArray)}function Zd(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gg(t,e,i,l,u,p,g,b,T,M,D,O,z){let G=p.textMaxSize.evaluate(e,{},O);G===void 0&&(G=g);const j=t.layers[0].layout,X=j.get("icon-offset").evaluate(e,{},O),ie=qg(i.horizontal)||i.vertical,pe=z.name==="globe",we=g/24,de=t.tilePixelRatio*G/24,be=(mt=t.overscaling,t.zoom>18&&mt>2&&(mt>>=1),Math.max(Fi/(512*mt),1)*j.get("symbol-spacing")),Se=j.get("text-padding")*t.tilePixelRatio,Me=j.get("icon-padding")*t.tilePixelRatio,$e=Bt(j.get("text-max-angle")),Je=j.get("text-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",ht=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Rt=j.get("symbol-placement"),nt=be/2;var mt;const xt=j.get("icon-text-fit");let Pt;l&&xt!=="none"&&(t.allowVerticalPlacement&&i.vertical&&(Pt=Pg(l,i.vertical,xt,j.get("icon-text-fit-padding"),X,we)),ie&&(l=Pg(l,ie,xt,j.get("icon-text-fit-padding"),X,we)));const zt=(rt,Kt,Bi)=>{if(Kt.x<0||Kt.x>=Fi||Kt.y<0||Kt.y>=Fi)return;let oi=null;if(pe){const{x:vi,y:Yt,z:Ui}=z.projectTilePoint(Kt.x,Kt.y,Bi);oi={anchor:new tu(vi,Yt,Ui,0,void 0),up:z.upVector(Bi,Kt.x,Kt.y)}}(function(vi,Yt,Ui,Fn,kn,An,ji,_r,sn,Nn,Er,Nr,zr,Ur,jr,ps,Oo,gr,Zs,Bs,tr,es,ro,Tr,Ms){const aa=vi.addToLineVertexArray(Yt,Fn);let Ro,ko,Sa,zo,Th,vp,Nm,Um=0,a1=0,l1=0,c1=0,fv=-1,pv=-1;const Bu={};let u1=Tu("");const $d=Ui?Ui.anchor:Yt;let mv=0,_v=0;if(sn._unevaluatedLayout.getValue("text-radial-offset")===void 0?[mv,_v]=sn.layout.get("text-offset").evaluate(tr,{},Ms).map(El=>El*no):(mv=sn.layout.get("text-radial-offset").evaluate(tr,{},Ms)*no,_v=Cm),vi.allowVerticalPlacement&&kn.vertical){const El=kn.vertical;if(jr)vp=Xd(El),_r&&(Nm=Xd(_r));else{const Tl=sn.layout.get("text-rotate").evaluate(tr,{},Ms)+90;Sa=up(Nn,$d,Yt,Er,Nr,zr,El,Ur,Tl,ps),_r&&(zo=up(Nn,$d,Yt,Er,Nr,zr,_r,gr,Tl))}}if(An){const El=sn.layout.get("icon-rotate").evaluate(tr,{},Ms),Tl=sn.layout.get("icon-text-fit")!=="none",Vm=Ng(An,El,ro,Tl),yv=_r?Ng(_r,El,ro,Tl):void 0;ko=up(Nn,$d,Yt,Er,Nr,zr,An,gr,El),Um=4*Vm.length;const h1=vi.iconSizeData;let ef=null;h1.kind==="source"?(ef=[vo*sn.layout.get("icon-size").evaluate(tr,{},Ms)],ef[0]>iu&&Ii(`${vi.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):h1.kind==="composite"&&(ef=[vo*es.compositeIconSizes[0].evaluate(tr,{},Ms),vo*es.compositeIconSizes[1].evaluate(tr,{},Ms)],(ef[0]>iu||ef[1]>iu)&&Ii(`${vi.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),vi.addSymbols(vi.icon,Vm,ef,Bs,Zs,tr,!1,Ui,Yt,aa.lineStartIndex,aa.lineLength,-1,Tr,Ms),fv=vi.icon.placedSymbolArray.length-1,yv&&(a1=4*yv.length,vi.addSymbols(vi.icon,yv,ef,Bs,Zs,tr,Ja.vertical,Ui,Yt,aa.lineStartIndex,aa.lineLength,-1,Tr,Ms),pv=vi.icon.placedSymbolArray.length-1)}for(const El in kn.horizontal){const Tl=kn.horizontal[El];Ro||(u1=Tu(Tl.text),jr?Th=Xd(Tl):Ro=up(Nn,$d,Yt,Er,Nr,zr,Tl,Ur,sn.layout.get("text-rotate").evaluate(tr,{},Ms),ps));const Vm=Tl.positionedLines.length===1;if(l1+=jg(vi,Ui,Yt,Tl,ji,sn,jr,tr,ps,aa,kn.vertical?Ja.horizontal:Ja.horizontalOnly,Vm?Object.keys(kn.horizontal):[El],Bu,fv,es,Tr,Ms),Vm)break}kn.vertical&&(c1+=jg(vi,Ui,Yt,kn.vertical,ji,sn,jr,tr,ps,aa,Ja.vertical,["vertical"],Bu,pv,es,Tr,Ms));let rd=-1;const gv=(El,Tl)=>El?Math.max(El,Tl):Tl;rd=gv(Th,rd),rd=gv(vp,rd),rd=gv(Nm,rd);const Eb=rd>-1?1:0;vi.glyphOffsetArray.length>=ku.MAX_GLYPHS&&Ii("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tr.sortKey!==void 0&&vi.addToSortKeyRanges(vi.symbolInstances.length,tr.sortKey),vi.symbolInstances.emplaceBack($d.x,$d.y,$d.z,Yt.x,Yt.y,Bu.right>=0?Bu.right:-1,Bu.center>=0?Bu.center:-1,Bu.left>=0?Bu.left:-1,Bu.vertical>=0?Bu.vertical:-1,fv,pv,u1,Ro!==void 0?Ro:vi.collisionBoxArray.length,Ro!==void 0?Ro+1:vi.collisionBoxArray.length,Sa!==void 0?Sa:vi.collisionBoxArray.length,Sa!==void 0?Sa+1:vi.collisionBoxArray.length,ko!==void 0?ko:vi.collisionBoxArray.length,ko!==void 0?ko+1:vi.collisionBoxArray.length,zo||vi.collisionBoxArray.length,zo?zo+1:vi.collisionBoxArray.length,Er,l1,c1,Um,a1,Eb,0,mv,_v,rd)})(t,Kt,oi,rt,i,l,u,Pt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Se,Je,T,0,Me,ht,X,e,p,M,D,O)};if(Rt==="line")for(const rt of zg(e.geometry,0,0,Fi,Fi)){const Kt=N0(rt,be,$e,i.vertical||ie,l,24,de,t.overscaling,Fi);for(const Bi of Kt){const oi=ie;oi&&Z0(t,oi.text,nt,Bi)||zt(rt,Bi,O)}}else if(Rt==="line-center"){for(const rt of e.geometry)if(rt.length>1){const Kt=F0(rt,$e,i.vertical||ie,l,24,de);Kt&&zt(rt,Kt,O)}}else if(e.type==="Polygon")for(const rt of Zf(e.geometry,0)){const Kt=j0(rt,16);zt(rt[0],new tu(Kt.x,Kt.y,0,0,void 0),O)}else if(e.type==="LineString")for(const rt of e.geometry)zt(rt,new tu(rt[0].x,rt[0].y,0,0,void 0),O);else if(e.type==="Point")for(const rt of e.geometry)for(const Kt of rt)zt([Kt],new tu(Kt.x,Kt.y,0,0,void 0),O)}const iu=32640;function jg(t,e,i,l,u,p,g,b,T,M,D,O,z,G,j,X,ie){const pe=function(be,Se,Me,$e,Je,ht,Rt,nt){const mt=[];if(Se.positionedLines.length===0)return mt;const xt=$e.layout.get("text-rotate").evaluate(ht,{})*Math.PI/180,Pt=function(oi){const vi=oi[0],Yt=oi[1],Ui=vi*Yt;return Ui>0?[vi,-Yt]:Ui<0?[-vi,Yt]:vi===0?[Yt,vi]:[Yt,-vi]}(Me);let zt=Math.abs(Se.top-Se.bottom);for(const oi of Se.positionedLines)zt-=oi.lineOffset;const rt=Se.positionedLines.length,Kt=zt/rt;let Bi=Se.top-Me[1];for(let oi=0;oi<rt;++oi){const vi=Se.positionedLines[oi];Bi=U0(Se,Kt,Bi,oi);for(const Yt of vi.positionedGlyphs){if(!Yt.rect)continue;const Ui=Yt.rect||{};let Fn=4,kn=!0,An=1,ji=0;if(Yt.imageName){const Tr=Rt[Yt.imageName];if(!Tr)continue;if(Tr.sdf){Ii("SDF images are not supported in formatted text and will be ignored.");continue}kn=!1,An=Tr.pixelRatio,Fn=1/An}const _r=(Je||nt)&&Yt.vertical,sn=Yt.metrics.advance*Yt.scale/2,Nn=Yt.metrics,Er=Yt.rect;if(Er===null)continue;nt&&Se.verticalizable&&(ji=Yt.imageName?sn-Yt.metrics.width*Yt.scale/2:0);const Nr=Je?[Yt.x+sn,Yt.y]:[0,0];let zr=[0,0],Ur=[0,0],jr=!1;Je||(_r?(Ur=[Yt.x+sn+Pt[0],Yt.y+Pt[1]-ji],jr=!0):zr=[Yt.x+sn+Me[0],Yt.y+Me[1]-ji]);const ps=Er.w*Yt.scale/(An*(Yt.localGlyph?2:1)),Oo=Er.h*Yt.scale/(An*(Yt.localGlyph?2:1));let gr,Zs,Bs,tr;if(_r){const Tr=Yt.y-Bi,Ms=new _e(-sn,sn-Tr),aa=-Math.PI/2,Ro=new _e(...Ur);gr=new _e(-sn+zr[0],zr[1]),gr._rotateAround(aa,Ms)._add(Ro),gr.x+=-Tr+sn,gr.y-=(Nn.left-Fn)*Yt.scale;const ko=Yt.imageName?Nn.advance*Yt.scale:no*Yt.scale,Sa=String.fromCharCode(Yt.glyph);I0(Sa)?gr.x+=(1-Fn)*Yt.scale:xg(Sa)?gr.x+=ko-Nn.height*Yt.scale+(-Fn-1)*Yt.scale:gr.x+=Yt.imageName||Nn.width+2*Fn===Er.w&&Nn.height+2*Fn===Er.h?(ko-Oo)/2:(ko-(Nn.height+2*Fn)*Yt.scale)/2,Zs=new _e(gr.x,gr.y-ps),Bs=new _e(gr.x+Oo,gr.y),tr=new _e(gr.x+Oo,gr.y-ps)}else{const Tr=(Nn.left-Fn)*Yt.scale-sn+zr[0],Ms=(-Nn.top-Fn)*Yt.scale+zr[1],aa=Tr+ps,Ro=Ms+Oo;gr=new _e(Tr,Ms),Zs=new _e(aa,Ms),Bs=new _e(Tr,Ro),tr=new _e(aa,Ro)}if(xt){let Tr;Tr=Je?new _e(0,0):jr?new _e(Pt[0],Pt[1]):new _e(Me[0],Me[1]),gr._rotateAround(xt,Tr),Zs._rotateAround(xt,Tr),Bs._rotateAround(xt,Tr),tr._rotateAround(xt,Tr)}const es=new _e(0,0),ro=new _e(0,0);mt.push({tl:gr,tr:Zs,bl:Bs,br:tr,tex:Ui,writingMode:Se.writingMode,glyphOffset:Nr,sectionIndex:Yt.sectionIndex,isSDF:kn,pixelOffsetTL:es,pixelOffsetBR:ro,minFontScaleX:0,minFontScaleY:0})}}return mt}(0,l,T,p,g,b,u,t.allowVerticalPlacement),we=t.textSizeData;let de=null;we.kind==="source"?(de=[vo*p.layout.get("text-size").evaluate(b,{},ie)],de[0]>iu&&Ii(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):we.kind==="composite"&&(de=[vo*j.compositeTextSizes[0].evaluate(b,{},ie),vo*j.compositeTextSizes[1].evaluate(b,{},ie)],(de[0]>iu||de[1]>iu)&&Ii(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,pe,de,T,g,b,D,e,i,M.lineStartIndex,M.lineLength,G,X,ie);for(const be of O)z[be]=t.text.placedSymbolArray.length-1;return 4*pe.length}function qg(t){for(const e in t)return t[e];return null}function up(t,e,i,l,u,p,g,b,T,M){let D=g.top,O=g.bottom,z=g.left,G=g.right;const j=g.collisionPadding;if(j&&(z-=j[0],D-=j[1],G+=j[2],O+=j[3]),T){const X=new _e(z,D),ie=new _e(G,D),pe=new _e(z,O),we=new _e(G,O),de=Bt(T);let be=new _e(0,0);M&&(be=new _e(M[0],M[1])),X._rotateAround(de,be),ie._rotateAround(de,be),pe._rotateAround(de,be),we._rotateAround(de,be),z=Math.min(X.x,ie.x,pe.x,we.x),G=Math.max(X.x,ie.x,pe.x,we.x),D=Math.min(X.y,ie.y,pe.y,we.y),O=Math.max(X.y,ie.y,pe.y,we.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,z,D,G,O,b,l,u,p),t.length-1}function Xd(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Z0(t,e,i,l){const u=t.compareText;if(e in u){const p=u[e];for(let g=p.length-1;g>=0;g--)if(l.dist(p[g])<i)return!0}else u[e]=[];return u[e].push(l),!1}function Hg(t,e){const i=t.fovAboveCenter,l=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-l)/Math.cos(t._pitch),p=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),g=Math.sin(t._pitch)*p+u;return Math.min(1.01*g,u*(1/t._horizonShift))}function wh(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),l=t.x*i,u=(t.x+1)*i,p=t.y*i,g=(t.y+1)*i,b=Ka(l),T=Ka(u),M=yo(p),D=yo(g),O=e.project(b,M),z=e.project(T,M),G=e.project(T,D),j=e.project(b,D);let X=Math.min(O.x,z.x,G.x,j.x),ie=Math.min(O.y,z.y,G.y,j.y),pe=Math.max(O.x,z.x,G.x,j.x),we=Math.max(O.y,z.y,G.y,j.y);const de=i/16;function be(Me,$e,Je,ht,Rt,nt){const mt=(Je+Rt)/2,xt=(ht+nt)/2,Pt=e.project(Ka(mt),yo(xt)),zt=Math.max(0,X-Pt.x,ie-Pt.y,Pt.x-pe,Pt.y-we);X=Math.min(X,Pt.x),pe=Math.max(pe,Pt.x),ie=Math.min(ie,Pt.y),we=Math.max(we,Pt.y),zt>de&&(be(Me,Pt,Je,ht,mt,xt),be(Pt,$e,mt,xt,Rt,nt))}be(O,z,l,p,u,p),be(z,G,u,p,u,g),be(G,j,u,g,l,g),be(j,O,l,g,l,p),X-=de,ie-=de,pe+=de,we+=de;const Se=1/Math.max(pe-X,we-ie);return{scale:Se,x:X*Se,y:ie*Se,x2:pe*Se,y2:we*Se,projection:e}}const Ia=wa(new Float32Array(16));class Dc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new Wn(0,0)}projectTilePoint(e,i,l){return{x:e,y:i,z:0}}locationPoint(e,i,l=!0){return e._coordinatePoint(e.locationCoordinate(i),l)}pixelsPerMeter(e,i){return Ql(1,e)*i}pixelSpaceConversion(e,i,l){return 1}farthestPixelDistance(e){return Hg(e,e.pixelsPerMeter)}pointCoordinate(e,i,l,u){const p=e.horizonLineFromTop(!1),g=new _e(i,Math.max(p,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,u))}pointCoordinate3D(e,i,l){const u=new _e(i,l);if(e.elevation)return e.elevation.pointCoordinate(u);{const p=this.pointCoordinate(e,u.x,u.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const l=e.horizonLineFromTop();return i.y<l}createInversionMatrix(e,i){return Ia}createTileMatrix(e,i,l){let u,p,g;const b=l.canonical,T=wa(new Float64Array(16));if(this.isReprojectedInTileSpace){const M=wh(b,this);u=1,p=M.x+l.wrap*M.scale,g=M.y,Su(T,T,[u/M.scale,u/M.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(b.z),p=(b.x+Math.pow(2,b.z)*l.wrap)*u,g=b.y*u;return Md(T,T,[p,g,0]),Su(T,T,[u/Fi,u/Fi,1]),T}upVector(e,i,l){return[0,0,1]}upVectorScale(e,i,l){return{metersToTile:1}}}class X0 extends Dc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,l]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Bt(i));this.n=(u+Math.sin(Bt(l)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:l,c:u,r0:p}=this,g=Bt(e-this.center[0]),b=Bt(i),T=Math.sqrt(u-2*l*Math.sin(b))/l;return{x:T*Math.sin(g*l),y:T*Math.cos(g*l)-p,z:0}}unproject(e,i){const{n:l,c:u,r0:p}=this,g=p+i;let b=Math.atan2(e,Math.abs(g))*Math.sign(g);g*l<0&&(b-=Math.PI*Math.sign(e)*Math.sign(g));const T=Bt(this.center[0])*l;b=Vi(b,-Math.PI-T,Math.PI-T);const M=dt(et(b/l)+this.center[0],-180,180),D=Math.asin(dt((u-(e*e+g*g)*l*l)/(2*l),-1,1)),O=dt(et(D),-kr,kr);return new Wn(M,O)}}const Kd=1.340264,Yd=-.081106,Jd=893e-6,Eh=.003796,hp=Math.sqrt(3)/2;class Lm extends Dc{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(hp*Math.sin(i)),u=l*l,p=u*u*u;return{x:.5*(e*Math.cos(l)/(hp*(Kd+3*Yd*u+p*(7*Jd+9*Eh*u)))/Math.PI+.5),y:1-.5*(l*(Kd+Yd*u+p*(Jd+Eh*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,u=l*l,p=u*u*u;for(let D,O,z,G=0;G<12&&(O=l*(Kd+Yd*u+p*(Jd+Eh*u))-i,z=Kd+3*Yd*u+p*(7*Jd+9*Eh*u),D=O/z,l=dt(l-D,-Math.PI/3,Math.PI/3),u=l*l,p=u*u*u,!(Math.abs(D)<1e-12));++G);const g=hp*e*(Kd+3*Yd*u+p*(7*Jd+9*Eh*u))/Math.cos(l),b=Math.asin(Math.sin(l)/hp),T=dt(180*g/Math.PI,-180,180),M=dt(180*b/Math.PI,-kr,kr);return new Wn(T,M)}}class K0 extends Dc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const l=360*(e-.5),u=dt(360*(.5-i),-kr,kr);return new Wn(l,u)}}const nd=Math.PI/2;function dp(t){return Math.tan((nd+t)/2)}class Y0 extends Dc{constructor(e){super(e),this.center=e.center||[0,30];const[i,l]=this.parallels=e.parallels||[30,30];let u=Bt(i),p=Bt(l);this.southernCenter=u+p<0,this.southernCenter&&(u=-u,p=-p);const g=Math.cos(u),b=dp(u);this.n=u===p?Math.sin(u):Math.log(g/Math.cos(p))/Math.log(dp(p)/b),this.f=g*Math.pow(dp(u),this.n)/this.n}project(e,i){i=Bt(i),this.southernCenter&&(i=-i),e=Bt(e-this.center[0]);const l=1e-6,{n:u,f:p}=this;p>0?i<-nd+l&&(i=-nd+l):i>nd-l&&(i=nd-l);const g=p/Math.pow(dp(i),u);let b=g*Math.sin(u*e),T=p-g*Math.cos(u*e);return b=.5*(b/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:b,y:this.southernCenter?T:1-T,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:u}=this,p=u-i,g=Math.sign(p),b=Math.sign(l)*Math.sqrt(e*e+p*p);let T=Math.atan2(e,Math.abs(p))*g;p*l<0&&(T-=Math.PI*Math.sign(e)*g);const M=dt(et(T/l)+this.center[0],-180,180),D=dt(et(2*Math.atan(Math.pow(u/b,1/l))-nd),-kr,kr);return new Wn(M,this.southernCenter?-D:D)}}class Dm extends Dc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Sc(e),y:Cc(i),z:0}}unproject(e,i){const l=Ka(e),u=yo(i);return new Wn(l,u)}}const Wg=Bt(kr);class J0 extends Dc{project(e,i){const l=(i=Bt(i))*i,u=l*l;return{x:.5*((e=Bt(e))*(.8707-.131979*l+u*(u*(.003971*l-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+u*(.028874*l-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,u=25,p=0,g=l*l;do{g=l*l;const M=g*g;p=(l*(1.007226+g*(.015085+M*(.028874*g-.044475-.005916*M)))-i)/(1.007226+g*(.045255+M*(.259866*g-.311325-.005916*11*M))),l=dt(l-p,-Wg,Wg)}while(Math.abs(p)>1e-6&&--u>0);g=l*l;const b=dt(et(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),T=et(l);return new Wn(b,T)}}const Zg=Bt(kr);class Pm extends Dc{project(e,i){i=Bt(i),e=Bt(e);const l=Math.cos(i),u=2/Math.PI,p=Math.acos(l*Math.cos(e/2)),g=Math.sin(p)/p,b=.5*(e*u+2*l*Math.sin(e/2)/g)||0,T=.5*(i+Math.sin(i)/g)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,i){let l=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,p=25;const g=1e-6;let b=0,T=0;do{const M=Math.cos(u),D=Math.sin(u),O=2*D*M,z=D*D,G=M*M,j=Math.cos(l/2),X=Math.sin(l/2),ie=2*j*X,pe=X*X,we=1-G*j*j,de=we?1/we:0,be=we?Math.acos(M*j)*Math.sqrt(1/we):0,Se=.5*(2*be*M*X+2*l/Math.PI)-e,Me=.5*(be*D+u)-i,$e=.5*de*(G*pe+be*M*j*z)+1/Math.PI,Je=de*(ie*O/4-be*D*X),ht=.125*de*(O*X-be*D*G*ie),Rt=.5*de*(z*j+be*pe*M)+.5,nt=Je*ht-Rt*$e;b=(Me*Je-Se*Rt)/nt,T=(Se*ht-Me*$e)/nt,l=dt(l-b,-Math.PI,Math.PI),u=dt(u-T,-Zg,Zg)}while((Math.abs(b)>g||Math.abs(T)>g)&&--p>0);return new Wn(et(l),et(u))}}class fp extends Dc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Bt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:l,cosPhi:u}=this;return{x:Bt(e)*u*l+.5,y:-Math.sin(Bt(i))/u*l+.5,z:0}}unproject(e,i){const{scale:l,cosPhi:u}=this,p=-(i-.5)/l,g=dt(et((e-.5)/l)/u,-180,180),b=Math.asin(dt(p*u,-1,1)),T=dt(et(b),-kr,kr);return new Wn(g,T)}}class Q0 extends Dm{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,l){const u=Od(e,i,l);return $r(u,u,Rd(Yl(l))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i){const l=Hh(i.lat,i.lng),u=Es([],l),p=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;ph(l,l,u,Ql(1,0)*Fi*p);const g=wa(new Float64Array(16));return Yc(g,e.pixelMatrix,e.globeMatrix),$r(l,l,g),new _e(l[0],l[1])}pixelsPerMeter(e,i){return Ql(1,0)*i}pixelSpaceConversion(e,i,l){const u=Ql(1,e)*i,p=$i(Ql(1,45)*i,u,l);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,l){const u=Qp(Yl(l.canonical));return Yc(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:l}=e,u=Rd(Yl(i));return Ad(u,u,Bt(l.lng)),Zl(u,u,Bt(l.lat)),Su(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,l,u){return jh(e,i,l,!0)||new Zh(0,0)}pointCoordinate3D(e,i,l){const u=this.pointCoordinate(e,i,l,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!jh(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(u,p){const g=u.cameraToCenterDistance,b=u._centerAltitude*p,T=u._camera,M=u._camera.forward(),D=Xl([],No([],M,-g),[0,0,b]),O=u.worldSize/(2*Math.PI),z=[0,0,-O],G=u.width/u.height,j=Math.tan(u.fovAboveCenter),X=No([],T.up(),j),ie=No([],T.right(),j*G),pe=Es([],Xl([],Xl([],M,X),ie)),we=[];let de;if(new Pf(D,pe).closestPointOnSphere(z,O,we)){const be=Xl([],we,z),Se=Kl([],be,D);de=Math.cos(u.fovAboveCenter)*Za(Se)}else{const be=Kl([],D,z),Se=Kl([],z,D);Es(Se,Se);const Me=Za(be)-O;de=Math.sqrt(Me*(Me+2*O));const $e=Math.acos(de/(O+Me))-Math.acos(vl(M,Se));de*=Math.cos($e)}return 1.01*de}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Wh(e.zoom);if(l>0){const u=Hg(e,Ql(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return $i(i,u+p*(1-Math.cos(g)),Math.pow(l,10))}return i}upVector(e,i,l){return Od(i,l,e,1)}upVectorScale(e){return{metersToTile:Pd(Bf(Yl(e)))}}}function Xg(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Dm(t);case"equirectangular":return new K0(t);case"naturalEarth":return new J0(t);case"equalEarth":return new Lm(t);case"winkelTripel":return new Pm(t);case"albers":return i?new fp(t):new X0(t);case"lambertConformalConic":return i?new fp(t):new Y0(t);case"globe":return new Q0(t)}throw new Error(`Invalid projection name: ${t.name}`)}const $0=ep.types,ev=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function pp(t,e,i,l,u,p,g,b,T,M,D,O,z){const G=b?Math.min(iu,Math.round(b[0])):0,j=b?Math.min(iu,Math.round(b[1])):0;t.emplaceBack(e,i,Math.round(32*l),Math.round(32*u),p,g,(G<<1)+(T?1:0),j,16*M,16*D,256*O,256*z)}function mp(t,e,i,l,u,p,g){t.emplaceBack(e,i,l,u,p,g)}function _p(t,e,i,l,u){t.emplaceBack(e,i,l,u),t.emplaceBack(e,i,l,u),t.emplaceBack(e,i,l,u),t.emplaceBack(e,i,l,u)}function tv(t){for(const e of t.sections)if(H(e.text))return!0;return!1}class Om{constructor(e){this.layoutVertexArray=new va,this.indexArray=new to,this.programConfigurations=e,this.segments=new Zr,this.dynamicLayoutVertexArray=new lr,this.opacityVertexArray=new fr,this.placedSymbolArray=new p_,this.globeExtVertexArray=new Rr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,l,u){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ya.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,x0.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ev,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Jh.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}ri(Om,"SymbolBuffers");class Rm{constructor(e,i,l){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new l,this.segments=new Zr,this.collisionVertexArray=new Sr,this.collisionVertexArrayExt=new Ws}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,b0.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,w0.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ri(Rm,"CollisionBuffers");class ku{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=wa([]),this.placementViewportMatrix=wa([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Rn(this.zoom,i["text-size"]),this.iconSizeData=Rn(this.zoom,i["icon-size"]);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),p=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(g=>Ja[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Om(new yl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Om(new yl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Up,this.lineVertexArray=new Vp,this.symbolInstances=new bf}calculateGlyphDependencies(e,i,l,u,p){for(let g=0;g<e.length;g++)if(i[e.charCodeAt(g)]=!0,u&&p){const b=cr[e.charAt(g)];b&&(i[b.charCodeAt(0)]=!0)}}populate(e,i,l,u){const p=this.layers[0],g=p.layout,b=this.projection.name==="globe",T=g.get("text-font"),M=g.get("text-field"),D=g.get("icon-image"),O=(M.value.kind!=="constant"||M.value.value instanceof Os&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),z=D.value.kind!=="constant"||!!D.value.value||Object.keys(D.parameters).length>0,G=g.get("symbol-sort-key");if(this.features=[],!O&&!z)return;const j=i.iconDependencies,X=i.glyphDependencies,ie=i.availableImages,pe=new He(this.zoom);for(const{feature:we,id:de,index:be,sourceLayerIndex:Se}of e){const Me=p._featureFilter.needGeometry,$e=yh(we,Me);if(!p._featureFilter.filter(pe,$e,l))continue;if(Me||($e.geometry=Qc(we,l,u)),b&&we.type!==1&&l.z<=5){const nt=$e.geometry,mt=.98078528056,xt=(Pt,zt)=>vl(Od(Pt.x,Pt.y,l,1),Od(zt.x,zt.y,l,1))<mt;for(let Pt=0;Pt<nt.length;Pt++)nt[Pt]=ky(nt[Pt],xt)}let Je,ht;if(O){const nt=p.getValueAndResolveTokens("text-field",$e,l,ie),mt=Os.factory(nt);tv(mt)&&(this.hasRTLText=!0),(!this.hasRTLText||Ae()==="unavailable"||this.hasRTLText&&De.isParsed())&&(Je=T0(mt,p,$e))}if(z){const nt=p.getValueAndResolveTokens("icon-image",$e,l,ie);ht=nt instanceof Js?nt:Js.fromString(nt)}if(!Je&&!ht)continue;const Rt=this.sortFeaturesByKey?G.evaluate($e,{},l):void 0;if(this.features.push({id:de,text:Je,icon:ht,index:be,sourceLayerIndex:Se,geometry:$e.geometry,properties:we.properties,type:$0[we.type],sortKey:Rt}),ht&&(j[ht.name]=!0),Je){const nt=T.evaluate($e,{},l).join(","),mt=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ja.vertical)>=0;for(const xt of Je.sections)if(xt.image)j[xt.image.name]=!0;else{const Pt=x(Je.toString()),zt=xt.fontStack||nt,rt=X[zt]=X[zt]||{};this.calculateGlyphDependencies(xt.text,rt,mt,this.allowVerticalPlacement,Pt)}}}g.get("symbol-placement")==="line"&&(this.features=function(we){const de={},be={},Se=[];let Me=0;function $e(nt){Se.push(we[nt]),Me++}function Je(nt,mt,xt){const Pt=be[nt];return delete be[nt],be[mt]=Pt,Se[Pt].geometry[0].pop(),Se[Pt].geometry[0]=Se[Pt].geometry[0].concat(xt[0]),Pt}function ht(nt,mt,xt){const Pt=de[mt];return delete de[mt],de[nt]=Pt,Se[Pt].geometry[0].shift(),Se[Pt].geometry[0]=xt[0].concat(Se[Pt].geometry[0]),Pt}function Rt(nt,mt,xt){const Pt=xt?mt[0][mt[0].length-1]:mt[0][0];return`${nt}:${Pt.x}:${Pt.y}`}for(let nt=0;nt<we.length;nt++){const mt=we[nt],xt=mt.geometry,Pt=mt.text?mt.text.toString():null;if(!Pt){$e(nt);continue}const zt=Rt(Pt,xt),rt=Rt(Pt,xt,!0);if(zt in be&&rt in de&&be[zt]!==de[rt]){const Kt=ht(zt,rt,xt),Bi=Je(zt,rt,Se[Kt].geometry);delete de[zt],delete be[rt],be[Rt(Pt,Se[Bi].geometry,!0)]=Bi,Se[Kt].geometry=null}else zt in be?Je(zt,rt,xt):rt in de?ht(zt,rt,xt):($e(nt),de[zt]=Me-1,be[rt]=Me-1)}return Se.filter(nt=>nt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((we,de)=>we.sortKey-de.sortKey)}update(e,i,l,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,l,u),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,l,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Xg(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:p}of i)this.lineVertexArray.emplaceBack(u,p);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,i,l,u,p,g,b,T,M,D,O,z,G,j){const X=e.indexArray,ie=e.layoutVertexArray,pe=e.globeExtVertexArray,we=e.segments.prepareSegment(4*i.length,ie,X,this.canOverlap?g.sortKey:void 0),de=this.glyphOffsetArray.length,be=we.vertexLength,Se=this.allowVerticalPlacement&&b===Ja.vertical?Math.PI/2:0,Me=g.text&&g.text.sections;for(let Je=0;Je<i.length;Je++){const{tl:ht,tr:Rt,bl:nt,br:mt,tex:xt,pixelOffsetTL:Pt,pixelOffsetBR:zt,minFontScaleX:rt,minFontScaleY:Kt,glyphOffset:Bi,isSDF:oi,sectionIndex:vi}=i[Je],Yt=we.vertexLength,Ui=Bi[1];if(pp(ie,M.x,M.y,ht.x,Ui+ht.y,xt.x,xt.y,l,oi,Pt.x,Pt.y,rt,Kt),pp(ie,M.x,M.y,Rt.x,Ui+Rt.y,xt.x+xt.w,xt.y,l,oi,zt.x,Pt.y,rt,Kt),pp(ie,M.x,M.y,nt.x,Ui+nt.y,xt.x,xt.y+xt.h,l,oi,Pt.x,zt.y,rt,Kt),pp(ie,M.x,M.y,mt.x,Ui+mt.y,xt.x+xt.w,xt.y+xt.h,l,oi,zt.x,zt.y,rt,Kt),T){const{x:Fn,y:kn,z:An}=T.anchor,[ji,_r,sn]=T.up;mp(pe,Fn,kn,An,ji,_r,sn),mp(pe,Fn,kn,An,ji,_r,sn),mp(pe,Fn,kn,An,ji,_r,sn),mp(pe,Fn,kn,An,ji,_r,sn),_p(e.dynamicLayoutVertexArray,Fn,kn,An,Se)}else _p(e.dynamicLayoutVertexArray,M.x,M.y,M.z,Se);X.emplaceBack(Yt,Yt+1,Yt+2),X.emplaceBack(Yt+1,Yt+2,Yt+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Bi[0]),Je!==i.length-1&&vi===i[Je+1].sectionIndex||e.programConfigurations.populatePaintArrays(ie.length,g,g.index,{},G,j,Me&&Me[vi])}const $e=T?T.anchor:M;e.placedSymbolArray.emplaceBack($e.x,$e.y,$e.z,M.x,M.y,de,this.glyphOffsetArray.length-de,be,D,O,M.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],b,0,!1,0,z,0)}_commitLayoutVertex(e,i,l,u,p,g,b){e.emplaceBack(i,l,u,p,g,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,i,l,u,p,g,b){const T=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),M=T.vertexLength,D=b.tileAnchorX,O=b.tileAnchorY;for(let G=0;G<4;G++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),l.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(l.layoutVertexArray,u,p,g,D,O,new _e(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,p,g,D,O,new _e(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,p,g,D,O,new _e(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,p,g,D,O,new _e(e.x1,e.y2)),T.vertexLength+=4;const z=l.indexArray;z.emplaceBack(M,M+1),z.emplaceBack(M+1,M+2),z.emplaceBack(M+2,M+3),z.emplaceBack(M+3,M),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,l,u,p,g){for(let b=u;b<p;b++){const T=l.get(b),M=this.getSymbolInstanceTextSize(e,g,i,b);this._addCollisionDebugVertices(T,M,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,i,l,u,p,g){for(let b=u;b<p;b++){const T=l.get(b),M=this.getSymbolInstanceIconSize(e,i,g.placedIconSymbolIndex);this._addCollisionDebugVertices(T,M,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rm(Qr,yg.members,Ec),this.iconCollisionBox=new Rm(Qr,yg.members,Ec);const l=Po(this.iconSizeData,e),u=Po(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,l,u){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),g=Hd(this.textSizeData,e,p)/no;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,i,l){const u=this.icon.placedSymbolArray.get(l),p=Hd(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,l){e.emplaceBack(i,-l,-l),e.emplaceBack(i,l,-l),e.emplaceBack(i,l,l),e.emplaceBack(i,-l,l)}_updateTextDebugCollisionBoxes(e,i,l,u,p,g){for(let b=u;b<p;b++){const T=l.get(b),M=this.getSymbolInstanceTextSize(e,g,i,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,M,T.padding)}}_updateIconDebugCollisionBoxes(e,i,l,u,p,g){for(let b=u;b<p;b++){const T=l.get(b),M=this.getSymbolInstanceIconSize(e,i,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,M,T.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Po(this.iconSizeData,e),u=Po(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const g=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(u,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(u,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(l,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(l,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,l,u,p,g,b,T,M){const D={};if(i<l){const{x1:O,y1:z,x2:G,y2:j,padding:X,projectedAnchorX:ie,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:be,featureIndex:Se}=e.get(i);D.textBox={x1:O,y1:z,x2:G,y2:j,padding:X,projectedAnchorX:ie,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:be},D.textFeatureIndex=Se}if(u<p){const{x1:O,y1:z,x2:G,y2:j,padding:X,projectedAnchorX:ie,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:be,featureIndex:Se}=e.get(u);D.verticalTextBox={x1:O,y1:z,x2:G,y2:j,padding:X,projectedAnchorX:ie,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:be},D.verticalTextFeatureIndex=Se}if(g<b){const{x1:O,y1:z,x2:G,y2:j,padding:X,projectedAnchorX:ie,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:be,featureIndex:Se}=e.get(g);D.iconBox={x1:O,y1:z,x2:G,y2:j,padding:X,projectedAnchorX:ie,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:be},D.iconFeatureIndex=Se}if(T<M){const{x1:O,y1:z,x2:G,y2:j,padding:X,projectedAnchorX:ie,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:be,featureIndex:Se}=e.get(T);D.verticalIconBox={x1:O,y1:z,x2:G,y2:j,padding:X,projectedAnchorX:ie,projectedAnchorY:pe,projectedAnchorZ:we,tileAnchorX:de,tileAnchorY:be},D.verticalIconFeatureIndex=Se}return D}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const l=e.placedSymbolArray.get(i),u=l.vertexStartIndex+4*l.numGlyphs;for(let p=l.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),l=Math.cos(e),u=[],p=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const T=this.symbolInstances.get(b);u.push(0|Math.round(i*T.tileAnchorX+l*T.tileAnchorY)),p.push(T.featureIndex)}return g.sort((b,T)=>u[b]-u[T]||p[T]-p[b]),g}addToSortKeyRanges(e,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:M}=l;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),g>=0&&g!==p&&g!==u&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),M>=0&&this.addIndicesForPlacedSymbol(this.icon,M)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ri(ku,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ku.MAX_GLYPHS=65535,ku.addDynamicAttributes=_p;const iv=new At({"symbol-placement":new Ge(st.layout_symbol["symbol-placement"]),"symbol-spacing":new Ge(st.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ge(st.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new tt(st.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ge(st.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ge(st.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ge(st.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ge(st.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ge(st.layout_symbol["icon-rotation-alignment"]),"icon-size":new tt(st.layout_symbol["icon-size"]),"icon-text-fit":new Ge(st.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ge(st.layout_symbol["icon-text-fit-padding"]),"icon-image":new tt(st.layout_symbol["icon-image"]),"icon-rotate":new tt(st.layout_symbol["icon-rotate"]),"icon-padding":new Ge(st.layout_symbol["icon-padding"]),"icon-keep-upright":new Ge(st.layout_symbol["icon-keep-upright"]),"icon-offset":new tt(st.layout_symbol["icon-offset"]),"icon-anchor":new tt(st.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ge(st.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ge(st.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ge(st.layout_symbol["text-rotation-alignment"]),"text-field":new tt(st.layout_symbol["text-field"]),"text-font":new tt(st.layout_symbol["text-font"]),"text-size":new tt(st.layout_symbol["text-size"]),"text-max-width":new tt(st.layout_symbol["text-max-width"]),"text-line-height":new tt(st.layout_symbol["text-line-height"]),"text-letter-spacing":new tt(st.layout_symbol["text-letter-spacing"]),"text-justify":new tt(st.layout_symbol["text-justify"]),"text-radial-offset":new tt(st.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ge(st.layout_symbol["text-variable-anchor"]),"text-anchor":new tt(st.layout_symbol["text-anchor"]),"text-max-angle":new Ge(st.layout_symbol["text-max-angle"]),"text-writing-mode":new Ge(st.layout_symbol["text-writing-mode"]),"text-rotate":new tt(st.layout_symbol["text-rotate"]),"text-padding":new Ge(st.layout_symbol["text-padding"]),"text-keep-upright":new Ge(st.layout_symbol["text-keep-upright"]),"text-transform":new tt(st.layout_symbol["text-transform"]),"text-offset":new tt(st.layout_symbol["text-offset"]),"text-allow-overlap":new Ge(st.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ge(st.layout_symbol["text-ignore-placement"]),"text-optional":new Ge(st.layout_symbol["text-optional"])});var km={paint:new At({"icon-opacity":new tt(st.paint_symbol["icon-opacity"]),"icon-color":new tt(st.paint_symbol["icon-color"]),"icon-halo-color":new tt(st.paint_symbol["icon-halo-color"]),"icon-halo-width":new tt(st.paint_symbol["icon-halo-width"]),"icon-halo-blur":new tt(st.paint_symbol["icon-halo-blur"]),"icon-translate":new Ge(st.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ge(st.paint_symbol["icon-translate-anchor"]),"text-opacity":new tt(st.paint_symbol["text-opacity"]),"text-color":new tt(st.paint_symbol["text-color"],{runtimeType:fo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new tt(st.paint_symbol["text-halo-color"]),"text-halo-width":new tt(st.paint_symbol["text-halo-width"]),"text-halo-blur":new tt(st.paint_symbol["text-halo-blur"]),"text-translate":new Ge(st.paint_symbol["text-translate"]),"text-translate-anchor":new Ge(st.paint_symbol["text-translate-anchor"])}),layout:iv};class Kg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:rl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ri(Kg,"FormatSectionOverride",{omit:["defaultValue"]});class gp extends Hl{constructor(e){super(e,km)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const p of l)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,l,u){const p=this.layout.get(e).evaluate(i,{},l,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||jc(g.value)||!p?p:function(b,T){return T.replace(/{([^{}]+)}/g,(M,D)=>D in b?String(b[D]):"")}(i.properties,p)}createBucket(e){return new ku(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of km.paint.overridableProperties){if(!gp.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),l=new Kg(i),u=new dl(l,i.property.specification);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new th("source",u):new Ha("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Ct(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&gp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const l=e.get("text-field"),u=km.paint.properties[i];let p=!1;const g=b=>{for(const T of b)if(u.overrides&&u.overrides.hasOverride(T))return void(p=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Os)g(l.value.value.sections);else if(l.value.kind==="source"){const b=M=>{p||(M instanceof nc&&is(M.value)===xe?g(M.value.sections):M instanceof ar?g(M.sections):M.eachChild(b))},T=l.value;T._styleExpression&&b(T._styleExpression.expression)}return p}getProgramConfiguration(e){return new ql(this,e)}}var nv={paint:new At({"background-color":new Ge(st.paint_background["background-color"]),"background-pattern":new Ge(st.paint_background["background-pattern"]),"background-opacity":new Ge(st.paint_background["background-opacity"])})},rv={paint:new At({"raster-opacity":new Ge(st.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ge(st.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ge(st.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ge(st.paint_raster["raster-brightness-max"]),"raster-saturation":new Ge(st.paint_raster["raster-saturation"]),"raster-contrast":new Ge(st.paint_raster["raster-contrast"]),"raster-resampling":new Ge(st.paint_raster["raster-resampling"]),"raster-fade-duration":new Ge(st.paint_raster["raster-fade-duration"])})};class sv extends Hl{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var ov={paint:new At({"sky-type":new Ge(st.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ge(st.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ge(st.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ge(st.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ge(st.paint_sky["sky-gradient-radius"]),"sky-gradient":new bt(st.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ge(st.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ge(st.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ge(st.paint_sky["sky-opacity"])})};function zm(t,e,i){const l=[0,0,1],u=Ic([]);return Df(u,u,i?-Bt(t)+Math.PI:Bt(t)),Uo(u,u,-Bt(e)),Lo(l,l,u),Es(l,l)}const av={circle:class extends Hl{constructor(t){super(t,Uy)}createBucket(t){return new om(t)}queryRadius(t){const e=t;return Xh("circle-radius",this,e)+Xh("circle-stroke-width",this,e)+Vf(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,l,u,p,g,b){const T=Gf(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),M=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Y_(t,l,p,g,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",T,M)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new ql(this,t)}},heatmap:class extends Hl{createBucket(t){return new Q_(t)}constructor(t){super(t,qy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Xh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,l,u,p,g,b){const T=this.paint.get("heatmap-radius").evaluate(e,i);return Y_(t,l,p,g,b,!0,!0,new _e(0,0),T)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new ql(this,t)}},hillshade:class extends Hl{constructor(t){super(t,Hy)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Hl{constructor(t){super(t,i0)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new ql(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Vd(t)}queryRadius(){return Vf(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,l,u,p){return!t.queryGeometry.isAboveHorizon&&q_(X_(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Hl{constructor(t){super(t,p0)}createBucket(t){return new gn(t)}queryRadius(){return Vf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new ql(this,t)}queryIntersectsFeature(t,e,i,l,u,p,g,b,T){const M=Gf(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),D=this.paint.get("fill-extrusion-height").evaluate(e,i),O=this.paint.get("fill-extrusion-base").evaluate(e,i),z=[0,0],G=b&&p.elevation,j=p.elevation?p.elevation.exaggeration():1,X=t.tile.getBucket(this);if(G&&X instanceof gn){const be=X.centroidVertexArray,Se=T+1;Se<be.length&&(z[0]=be.geta_centroid_pos0(Se),z[1]=be.geta_centroid_pos1(Se))}if(z[0]===0&&z[1]===1)return!1;p.projection.name==="globe"&&(l=pg([l],[new _e(0,0),new _e(Fi,Fi)],t.tileID.canonical).map(be=>be.polygon).flat());const ie=G?b:null,[pe,we]=function(be,Se,Me,$e,Je,ht,Rt,nt,mt,xt,Pt){return be.projection.name==="globe"?function(zt,rt,Kt,Bi,oi,vi,Yt,Ui,Fn,kn,An){const ji=[],_r=[],sn=zt.projection.upVectorScale(An,zt.center.lat,zt.worldSize).metersToTile,Nn=[0,0,0,1],Er=[0,0,0,1],Nr=(Ur,jr,ps,Oo)=>{Ur[0]=jr,Ur[1]=ps,Ur[2]=Oo,Ur[3]=1},zr=fg();Kt>0&&(Kt+=zr),Bi+=zr;for(const Ur of rt){const jr=[],ps=[];for(const Oo of Ur){const gr=Oo.x+oi.x,Zs=Oo.y+oi.y,Bs=zt.projection.projectTilePoint(gr,Zs,An),tr=zt.projection.upVector(An,Oo.x,Oo.y);let es=Kt,ro=Bi;if(Yt){const Tr=mg(gr,Zs,Kt,Bi,Yt,Ui,Fn,kn);es+=Tr.base,ro+=Tr.top}Kt!==0?Nr(Nn,Bs.x+tr[0]*sn*es,Bs.y+tr[1]*sn*es,Bs.z+tr[2]*sn*es):Nr(Nn,Bs.x,Bs.y,Bs.z),Nr(Er,Bs.x+tr[0]*sn*ro,Bs.y+tr[1]*sn*ro,Bs.z+tr[2]*sn*ro),$r(Nn,Nn,vi),$r(Er,Er,vi),jr.push(new Fr(Nn[0],Nn[1],Nn[2])),ps.push(new Fr(Er[0],Er[1],Er[2]))}ji.push(jr),_r.push(ps)}return[ji,_r]}(be,Se,Me,$e,Je,ht,Rt,nt,mt,xt,Pt):Rt?function(zt,rt,Kt,Bi,oi,vi,Yt,Ui,Fn){const kn=[],An=[],ji=[0,0,0,1];for(const _r of zt){const sn=[],Nn=[];for(const Er of _r){const Nr=Er.x+Bi.x,zr=Er.y+Bi.y,Ur=mg(Nr,zr,rt,Kt,vi,Yt,Ui,Fn);ji[0]=Nr,ji[1]=zr,ji[2]=Ur.base,ji[3]=1,mh(ji,ji,oi),ji[3]=Math.max(ji[3],1e-5);const jr=new Fr(ji[0]/ji[3],ji[1]/ji[3],ji[2]/ji[3]);ji[0]=Nr,ji[1]=zr,ji[2]=Ur.top,ji[3]=1,mh(ji,ji,oi),ji[3]=Math.max(ji[3],1e-5);const ps=new Fr(ji[0]/ji[3],ji[1]/ji[3],ji[2]/ji[3]);sn.push(jr),Nn.push(ps)}kn.push(sn),An.push(Nn)}return[kn,An]}(Se,Me,$e,Je,ht,Rt,nt,mt,xt):function(zt,rt,Kt,Bi,oi){const vi=[],Yt=[],Ui=oi[8]*rt,Fn=oi[9]*rt,kn=oi[10]*rt,An=oi[11]*rt,ji=oi[8]*Kt,_r=oi[9]*Kt,sn=oi[10]*Kt,Nn=oi[11]*Kt;for(const Er of zt){const Nr=[],zr=[];for(const Ur of Er){const jr=Ur.x+Bi.x,ps=Ur.y+Bi.y,Oo=oi[0]*jr+oi[4]*ps+oi[12],gr=oi[1]*jr+oi[5]*ps+oi[13],Zs=oi[2]*jr+oi[6]*ps+oi[14],Bs=oi[3]*jr+oi[7]*ps+oi[15],tr=Oo+Ui,es=gr+Fn,ro=Zs+kn,Tr=Math.max(Bs+An,1e-5),Ms=Oo+ji,aa=gr+_r,Ro=Zs+sn,ko=Math.max(Bs+Nn,1e-5);Nr.push(new Fr(tr/Tr,es/Tr,ro/Tr)),zr.push(new Fr(Ms/ko,aa/ko,Ro/ko))}vi.push(Nr),Yt.push(zr)}return[vi,Yt]}(Se,Me,$e,Je,ht)}(p,l,O,D,M,g,ie,z,j,p.center.lat,t.tileID.canonical),de=t.queryGeometry;return function(be,Se,Me){let $e=1/0;q_(Me,Se)&&($e=gm(Me,Se[0]));for(let Je=0;Je<Se.length;Je++){const ht=Se[Je],Rt=be[Je];for(let nt=0;nt<ht.length-1;nt++){const mt=ht[nt],xt=[mt,ht[nt+1],Rt[nt+1],Rt[nt],mt];j_(Me,xt)&&($e=Math.min($e,gm(Me,xt)))}}return $e!==1/0&&$e}(pe,we,de.isPointQuery()?de.screenBounds:de.screenGeometry)}},line:class extends Hl{constructor(t){super(t,gg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof _o,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=vm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Pu(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new ql(this,t)}queryRadius(t){const e=t,i=qd(Xh("line-width",this,e),Xh("line-gap-width",this,e)),l=Xh("line-offset",this,e);return i/2+Math.abs(l)+Vf(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,l,u,p){if(t.queryGeometry.isAboveHorizon)return!1;const g=X_(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,t.pixelToTileUnitsFactor),b=t.pixelToTileUnitsFactor/2*qd(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),T=this.paint.get("line-offset").evaluate(e,i);return T&&(l=function(M,D){const O=[],z=new _e(0,0);for(let G=0;G<M.length;G++){const j=M[G],X=[];for(let ie=0;ie<j.length;ie++){const pe=j[ie-1],we=j[ie],de=j[ie+1],be=ie===0?z:we.sub(pe)._unit()._perp(),Se=ie===j.length-1?z:de.sub(we)._unit()._perp(),Me=be._add(Se)._unit();Me._mult(1/(Me.x*Se.x+Me.y*Se.y)),X.push(Me._mult(D)._add(we))}O.push(X)}return O}(l,T*t.pixelToTileUnitsFactor)),function(M,D,O){for(let z=0;z<D.length;z++){const G=D[z];if(M.length>=3){for(let j=0;j<G.length;j++)if(vh(M,G[j]))return!0}if(By(M,G,O))return!0}return!1}(g,l,b)}isTileClipped(){return!0}},symbol:gp,background:class extends Hl{constructor(t){super(t,nv)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Hl{constructor(t){super(t,rv)}getProgramIds(){return["raster"]}},sky:class extends Hl{constructor(t){super(t,ov),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=hm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),u=!l,p=t.style.light,g=p.properties.get("position");return u&&p.properties.get("anchor")==="viewport"&&Ii("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?zm(g.azimuthal,90-g.polar,e):zm(l[0],90-l[1],e)}const i=this.paint.get("sky-gradient-center");return zm(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class h{constructor(e,i,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,l){const{width:u,height:p}=e,{context:g}=this,{gl:b}=g,{HTMLImageElement:T,HTMLCanvasElement:M,HTMLVideoElement:D,ImageData:O,ImageBitmap:z}=I;if(b.bindTexture(b.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!i||i.premultiply!==!1)),l||this.size&&this.size[0]===u&&this.size[1]===p){const{x:G,y:j}=l||{x:0,y:0};e instanceof T||e instanceof M||e instanceof D||e instanceof O||z&&e instanceof z?b.texSubImage2D(b.TEXTURE_2D,0,G,j,b.RGBA,b.UNSIGNED_BYTE,e):b.texSubImage2D(b.TEXTURE_2D,0,G,j,u,p,b.RGBA,b.UNSIGNED_BYTE,e.data)}else this.size=[u,p],e instanceof T||e instanceof M||e instanceof D||e instanceof O||z&&e instanceof z?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,e):b.texImage2D(b.TEXTURE_2D,0,this.format,u,p,0,this.format,b.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,i){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class y{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class S{constructor(){this.tasks={},this.taskQueue=[],Wi(["process"],this),this.invoker=new y(this.process),this.nextId=0}add(e,i){const l=this.nextId++,u=function({type:p,isSymbolTile:g,zoom:b}){return b=b||0,p==="message"?0:p!=="maybePrepare"||g?p!=="parseTile"||g?p==="parseTile"&&g?300-b:p==="maybePrepare"&&g?400-b:500:200-b:100-b}(i);if(u===0){gt();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:e,metadata:i,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){gt();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<i&&(i=p.priority,e=u)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class N{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const l=e[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Q=["tile","layer","source","sourceLayer","state"];class ce{constructor(e,i,l,u,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=l,this._y=u,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of Q)this[i]!==void 0&&(e[i]=this[i]);return e}}const Ee=32,ke=33,Ze=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,l=0,u=0,p=0,g=0,b=0;for(1&e?u=p=g=Ee:i=l=b=Ee;(e>>=1)>1;){const M=i+u>>1,D=l+p>>1;1&e?(u=i,p=l,i=g,l=b):(i=u,l=p,u=g,p=b),g=M,b=D}const T=4*t;Ze[T+0]=i,Ze[T+1]=l,Ze[T+2]=u,Ze[T+3]=p}const Mt=new Uint16Array(2178),Lt=new Uint8Array(1089),Vt=new Uint16Array(1089);function mi(t){return t===0?-.03125:t===32?.03125:0}var zi=Ti([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const an={type:2,extent:Fi,loadGeometry:()=>[[new _e(0,0),new _e(8193,0),new _e(8193,8193),new _e(0,8193),new _e(0,0)]]};class Bn{constructor(e,i,l,u,p){this.tileID=e,this.uid=Ni(),this.uses=0,this.tileSize=i,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Pn.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=wh(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,l){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,p){const g={};if(!p)return g;for(const b of u){const T=b.layerIds.map(M=>p.getLayer(M)).filter(Boolean);if(T.length!==0){b.layers=T,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(M=>T.filter(D=>D.id===M)[0]));for(const M of T)g[M.id]=b}}return g}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const p=this.buckets[u];if(p instanceof ku){if(this.hasSymbolBuckets=!0,!l)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const p=this.buckets[u];if(p instanceof ku&&p.hasRTLText){this.hasRTLText=!0,De.isLoading()||De.isLoaded()||Ae()!=="deferred"||Te();break}}this.queryPadding=0;for(const u in this.buckets){const p=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Np}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new h(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new h(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new h(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,l,u,p,g,b,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:b,transform:g,params:p,tileTransform:this.tileTransform},e,i,l):{}}querySourceFeatures(e,i){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),p=i?i.sourceLayer:"",g=u._geojsonTileLayer||u[p];if(!g)return;const b=ss(i&&i.filter),{z:T,x:M,y:D}=this.tileID.canonical,O={z:T,x:M,y:D};for(let z=0;z<g.length;z++){const G=g.feature(z);if(b.needGeometry){const ie=yh(G,!0);if(!b.filter(new He(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!b.filter(new He(this.tileID.overscaledZ),G))continue;const j=l.getId(G,p),X=new ce(G,T,M,D,j);X.tile=O,e.push(X)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const l=Si(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const p=this.expirationTime-i;p?this.expirationTime=l+Math.max(p,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const l=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const p in this.buckets){if(!i.style.hasLayer(p))continue;const g=this.buckets[p],b=g.layers[0].sourceLayer||"_geojsonTileLayer",T=l[b],M=e[b];if(!T||!M||Object.keys(M).length===0)continue;if(g.update(M,T,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof Pu||g instanceof Vd){const O=i.style._getSourceCache(g.layers[0].source);i._terrain&&i._terrain.enabled&&O&&g.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(O.id,this.tileID)}const D=i&&i.style&&i.style.getLayer(p);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Pn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Pn.now()+e}setTexture(e,i){const l=i.context,u=l.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new h(l,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),l.extTextureFilterAnisotropic&&u.texParameterf(u.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax))}setDependencies(e,i){const l={};for(const u of i)l[u]=!0;this.dependencies[e]=l}hasDependency(e,i){for(const l of e){const u=this.dependencies[l];if(u){for(const p of i)if(u[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const l=Qc(an,this.tileID.canonical,this.tileTransform)[0],u=new Li,p=new xa;for(let g=0;g<l.length;g++){const{x:b,y:T}=l[g];u.emplaceBack(b,T),p.emplaceBack(g)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(u,Jc.members),this._tileDebugSegments=Zr.simpleSegment(0,0,u.length,p.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const l=Qc(an,this.tileID.canonical,this.tileTransform)[0];let u,p;if(this.isRaster){const g=function(b,T){const M=wh(b,T),D=Math.pow(2,b.z);for(let ie=0;ie<ke;ie++)for(let pe=0;pe<ke;pe++){const we=Ka((b.x+(pe+mi(pe))/Ee)/D),de=yo((b.y+(ie+mi(ie))/Ee)/D),be=T.project(we,de),Se=ie*ke+pe;Mt[2*Se+0]=Math.round((be.x*M.scale-M.x)*Fi),Mt[2*Se+1]=Math.round((be.y*M.scale-M.y)*Fi)}Lt.fill(0),Vt.fill(0);for(let ie=2045;ie>=0;ie--){const pe=4*ie,we=Ze[pe+0],de=Ze[pe+1],be=Ze[pe+2],Se=Ze[pe+3],Me=we+be>>1,$e=de+Se>>1,Je=Me+$e-de,ht=$e+we-Me,Rt=de*ke+we,nt=Se*ke+be,mt=$e*ke+Me,xt=Math.hypot((Mt[2*Rt+0]+Mt[2*nt+0])/2-Mt[2*mt+0],(Mt[2*Rt+1]+Mt[2*nt+1])/2-Mt[2*mt+1])>=16;if(Lt[mt]=Lt[mt]||(xt?1:0),ie<1022){const Pt=(de+ht>>1)*ke+(we+Je>>1),zt=(Se+ht>>1)*ke+(be+Je>>1);Lt[mt]=Lt[mt]||Lt[Pt]||Lt[zt]}}const O=new or,z=new to;let G=0;function j(ie,pe){const we=pe*ke+ie;return Vt[we]===0&&(O.emplaceBack(Mt[2*we+0],Mt[2*we+1],ie*Fi/Ee,pe*Fi/Ee),Vt[we]=++G),Vt[we]-1}function X(ie,pe,we,de,be,Se){const Me=ie+we>>1,$e=pe+de>>1;if(Math.abs(ie-be)+Math.abs(pe-Se)>1&&Lt[$e*ke+Me])X(be,Se,ie,pe,Me,$e),X(we,de,be,Se,Me,$e);else{const Je=j(ie,pe),ht=j(we,de),Rt=j(be,Se);z.emplaceBack(Je,ht,Rt)}}return X(0,0,Ee,Ee,Ee,0),X(Ee,Ee,0,0,0,Ee),{vertices:O,indices:z}}(this.tileID.canonical,i);u=g.vertices,p=g.indices}else{u=new or,p=new to;for(const{x:b,y:T}of l)u.emplaceBack(b,T,0,0);const g=Kh(u.int16,void 0,4);for(let b=0;b<g.length;b+=3)p.emplaceBack(g[b],g[b+1],g[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,zi.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=Zr.simpleSegment(0,0,u.length,p.length)}_makeGlobeTileDebugBuffers(e,i){const l=i.projection;if(!l||l.name!=="globe"||i.freezeTileCoverage)return;const u=this.tileID.canonical,p=Rd(Jp(u,i)),g=Wh(i.zoom);let b;g>0&&(b=Lf(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,i,p,b,g),this._makeGlobeTileDebugTextBuffer(e,u,i,p,b,g)}_globePoint(e,i,l,u,p,g,b){let T=Od(e,i,l);if(g){const M=1<<l.z,D=Sc(u.center.lng),O=Cc(u.center.lat),z=(l.x+.5)/M-D;let G=0;z>.5?G=-1:z<-.5&&(G=1);let j=(e/Fi+l.x)/M+G,X=(i/Fi+l.y)/M;j=(j-D)*u._pixelsPerMercatorPixel+D,X=(X-O)*u._pixelsPerMercatorPixel+O;const ie=[j*u.worldSize,X*u.worldSize,0];$r(ie,ie,g),T=Ac(T,ie,b)}return $r(T,T,p)}_makeGlobeTileDebugBorderBuffer(e,i,l,u,p,g){const b=new Li,T=new xa,M=new Jn,D=(z,G,j,X,ie)=>{const pe=(j-z)/(ie-1),we=(X-G)/(ie-1),de=b.length;for(let be=0;be<ie;be++){const Se=z+be*pe,Me=G+be*we;b.emplaceBack(Se,Me);const $e=this._globePoint(Se,Me,i,l,u,p,g);M.emplaceBack($e[0],$e[1],$e[2]),T.emplaceBack(de+be)}},O=Fi;D(0,0,O,0,16),D(O,0,O,O,16),D(O,O,0,O,16),D(0,O,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(T),this._tileDebugBuffer=e.createVertexBuffer(b,Jc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(M,O_.members),this._tileDebugSegments=Zr.simpleSegment(0,0,b.length,T.length)}_makeGlobeTileDebugTextBuffer(e,i,l,u,p,g){const b=new Li,T=new to,M=new Jn,D=25;T.reserve(32),b.reserve(D),M.reserve(D);const O=(z,G)=>D*z+G;for(let z=0;z<D;z++){const G=2048*z;for(let j=0;j<D;j++){const X=2048*j;b.emplaceBack(X,G);const ie=this._globePoint(X,G,i,l,u,p,g);M.emplaceBack(ie[0],ie[1],ie[2])}}for(let z=0;z<4;z++)for(let G=0;G<4;G++){const j=O(z,G),X=O(z,G+1),ie=O(z+1,G),pe=O(z+1,G+1);T.emplaceBack(j,X,ie),T.emplaceBack(ie,X,pe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(T),this._tileDebugTextBuffer=e.createVertexBuffer(b,Jc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(M,O_.members),this._tileDebugTextSegments=Zr.simpleSegment(0,0,D,32)}}class un{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,l){const u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Gi(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==u&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const p in this.state[e][u])l[p]||(this.deletedStates[e][u][p]=null)}else for(const p in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][p]===null&&delete this.deletedStates[e][u][p]}removeFeatureState(e,i,l){if(this.deletedStates[e]===null)return;const u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&i!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){const l=String(i),u=Gi({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][i];if(p===null)return{};for(const g in p)delete u[g]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const p={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),Gi(this.state[u][g],this.stateChanges[u][g]),p[g]=this.state[u][g];l[u]=p}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const p={};if(this.deletedStates[u]===null)for(const g in this.state[u])p[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(this.deletedStates[u][g]===null)this.state[u][g]={};else if(this.state[u][g])for(const b of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][b];p[g]=this.state[u][g]}l[u]=l[u]||{},Gi(l[u],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,i)}}class Kn{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const l=this.toIdx(e,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function er(t,e,i,l){let u=0,p=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(l[g])<1e-15){if(i[g]<t[g]||i[g]>e[g])return null}else{const b=1/l[g];let T=(t[g]-i[g])*b,M=(e[g]-i[g])*b;if(T>M){const D=T;T=M,M=D}if(T>u&&(u=T),M<p&&(p=M),u>p)return null}return u}function Ma(t,e,i,l,u,p,g,b,T,M,D){const O=l-t,z=u-e,G=p-i,j=g-t,X=b-e,ie=T-i,pe=D[1]*ie-D[2]*X,we=D[2]*j-D[0]*ie,de=D[0]*X-D[1]*j,be=O*pe+z*we+G*de;if(Math.abs(be)<1e-15)return null;const Se=1/be,Me=M[0]-t,$e=M[1]-e,Je=M[2]-i,ht=(Me*pe+$e*we+Je*de)*Se;if(ht<0||ht>1)return null;const Rt=$e*G-Je*z,nt=Je*O-Me*G,mt=Me*z-$e*O,xt=(D[0]*Rt+D[1]*nt+D[2]*mt)*Se;return xt<0||ht+xt>1?null:(j*Rt+X*nt+ie*mt)*Se}function Go(t,e,i){return(t-e)/(i-e)}function Aa(t,e,i,l,u,p,g,b,T){const M=1<<i,D=p-l,O=g-u,z=(t+1)/M*D+l,G=(e+0)/M*O+u,j=(e+1)/M*O+u;b[0]=(t+0)/M*D+l,b[1]=G,T[0]=z,T[1]=j}class Is{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const g=Math.ceil(Math.log2(p.dim/8)),b=[];let T=Math.ceil(Math.pow(2,g));const M=1/T,D=(G,j,X,ie,pe)=>{const we=ie?1:0,de=(G+1)*X-we,be=j*X,Se=(j+1)*X-we;pe[0]=G*X,pe[1]=be,pe[2]=de,pe[3]=Se};let O=new Kn(T);const z=[];for(let G=0;G<T*T;G++){D(G%T,Math.floor(G/T),M,!1,z);const j=jo(z[0],z[1],p),X=jo(z[2],z[1],p),ie=jo(z[2],z[3],p),pe=jo(z[0],z[3],p);O.minimums.push(Math.min(j,X,ie,pe)),O.maximums.push(Math.max(j,X,ie,pe)),O.leaves.push(1)}for(b.push(O),T/=2;T>=1;T/=2){const G=b[b.length-1];O=new Kn(T);for(let j=0;j<T*T;j++){D(j%T,Math.floor(j/T),2,!0,z);const X=G.getElevation(z[0],z[1]),ie=G.getElevation(z[2],z[1]),pe=G.getElevation(z[2],z[3]),we=G.getElevation(z[0],z[3]),de=G.isLeaf(z[0],z[1]),be=G.isLeaf(z[2],z[1]),Se=G.isLeaf(z[2],z[3]),Me=G.isLeaf(z[0],z[3]),$e=Math.min(X.min,ie.min,pe.min,we.min),Je=Math.max(X.max,ie.max,pe.max,we.max),ht=de&&be&&Se&&Me;O.maximums.push(Je),O.minimums.push($e),O.leaves.push(Je-$e<=5&&ht?1:0)}b.push(O)}return b}(this.dem),l=i.length-1,u=i[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(e,i,l,u,p,g,b=1){return er([e,i,-100],[l,u,this.maximums[0]*b],p,g)}raycast(e,i,l,u,p,g,b=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,i,l,u,p,g,b);if(T==null)return null;const M=[],D=[],O=[],z=[],G=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;G.length>0;){const{idx:j,t:X,nodex:ie,nodey:pe,depth:we}=G.pop();if(this.leaves[j]){Aa(ie,pe,we,e,i,l,u,O,z);const be=1<<we,Se=(ie+0)/be,Me=(ie+1)/be,$e=(pe+0)/be,Je=(pe+1)/be,ht=jo(Se,$e,this.dem)*b,Rt=jo(Me,$e,this.dem)*b,nt=jo(Me,Je,this.dem)*b,mt=jo(Se,Je,this.dem)*b,xt=Ma(O[0],O[1],ht,z[0],O[1],Rt,z[0],z[1],nt,p,g),Pt=Ma(z[0],z[1],nt,O[0],z[1],mt,O[0],O[1],ht,p,g),zt=Math.min(xt!==null?xt:Number.MAX_VALUE,Pt!==null?Pt:Number.MAX_VALUE);if(zt!==Number.MAX_VALUE)return zt;{const rt=ph([],p,g,X);if(wl(ht,Rt,mt,nt,Go(rt[0],O[0],z[0]),Go(rt[1],O[1],z[1]))>=rt[2])return X}continue}let de=0;for(let be=0;be<this._siblingOffset.length;be++){Aa((ie<<1)+this._siblingOffset[be][0],(pe<<1)+this._siblingOffset[be][1],we+1,e,i,l,u,O,z),O[2]=-100,z[2]=this.maximums[this.childOffsets[j]+be]*b;const Se=er(O,z,p,g);if(Se!=null){const Me=Se;M[be]=Me;let $e=!1;for(let Je=0;Je<de&&!$e;Je++)Me>=M[D[Je]]&&(D.splice(Je,0,be),$e=!0);$e||(D[de]=be),de++}}for(let be=0;be<de;be++){const Se=D[be];G.push({idx:this.childOffsets[j]+Se,t:M[Se],nodex:(ie<<1)+this._siblingOffset[Se][0],nodey:(pe<<1)+this._siblingOffset[Se][1],depth:we+1})}}return null}_addNode(e,i,l){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,l,u,p){if(e[u].isLeaf(i,l)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const g=u-1,b=e[g];let T=0,M=0;for(let D=0;D<this._siblingOffset.length;D++){const O=2*i+this._siblingOffset[D][0],z=2*l+this._siblingOffset[D][1],G=b.getElevation(O,z),j=b.isLeaf(O,z),X=this._addNode(G.min,G.max,j);j&&(T|=1<<D),M||(M=X)}for(let D=0;D<this._siblingOffset.length;D++)T&1<<D||this._construct(e,2*i+this._siblingOffset[D][0],2*l+this._siblingOffset[D][1],g,M+D)}}function wl(t,e,i,l,u,p){return $i($i(t,i,p),$i(e,l,p),u)}function jo(t,e,i){const l=i.dim,u=dt(t*l-.5,0,l-1),p=dt(e*l-.5,0,l-1),g=Math.floor(u),b=Math.floor(p),T=Math.min(g+1,l-1),M=Math.min(b+1,l-1);return wl(i.get(g,b),i.get(T,b),i.get(g,M),i.get(T,M),u-g,p-b)}const Bm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Yg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,l,u=!1,p=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return Ii(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,b=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=l||"mapbox",this.borderReady=u,!u){for(let T=0;T<g;T++)b[this._idx(-1,T)]=b[this._idx(0,T)],b[this._idx(g,T)]=b[this._idx(g-1,T)],b[this._idx(T,-1)]=b[this._idx(T,0)],b[this._idx(T,g)]=b[this._idx(T,g-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(g,-1)]=b[this._idx(g-1,0)],b[this._idx(-1,g)]=b[this._idx(0,g-1)],b[this._idx(g,g)]=b[this._idx(g-1,g-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Is(this)}get(e,i,l=!1){l&&(e=dt(e,-1,this.dim),i=dt(i,-1,this.dim));const u=4*this._idx(e,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return Bm[e]}get unpackVector(){return Bm[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,l){return(256*e*256+256*i+l)/10-1e4}_unpackTerrarium(e,i,l){return 256*e+i+l/256-32768}static pack(e,i){const l=[0,0,0,0],u=Yg.getUnpackVector(i);let p=Math.floor((e+u[3])/u[2]);return l[2]=p%256,p=Math.floor(p/256),l[1]=p%256,p=Math.floor(p/256),l[0]=p,l}getPixels(){return new Ea({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,p=i*this.dim+this.dim,g=l*this.dim,b=l*this.dim+this.dim;switch(i){case-1:u=p-1;break;case 1:p=u+1}switch(l){case-1:g=b-1;break;case 1:b=g+1}const T=-i*this.dim,M=-l*this.dim;for(let D=g;D<b;D++)for(let O=u;O<p;O++){const z=4*this._idx(O,D),G=4*this._idx(O+T,D+M);this.pixels[z+0]=e.pixels[G+0],this.pixels[z+1]=e.pixels[G+1],this.pixels[z+2]=e.pixels[G+2],this.pixels[z+3]=e.pixels[G+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ri(Yg,"DEMData"),ri(Is,"DemMinMaxQuadTree",{omit:["dem"]});class xb{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const p={value:i,timeout:void 0};if(l!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},l)),this.data[u].push(p),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const l=e.wrapped().key,u=i===void 0?0:this.data[l].indexOf(i),p=this.data[l][u];return this.data[l].splice(u,1),p.timeout&&clearTimeout(p.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(p.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||i.push(u);for(const l of i)this.remove(l.value.tileID,l)}}class yp{constructor(e,i,l){this.func=e,this.mask=i,this.range=l}}yp.ReadOnly=!1,yp.ReadWrite=!0,yp.disabled=new yp(519,yp.ReadOnly,[0,1]);const lv=7680;class cv{constructor(e,i,l,u,p,g){this.test=e,this.ref=i,this.mask=l,this.fail=u,this.depthFail=p,this.pass=g}}cv.disabled=new cv({func:519,mask:0},0,0,lv,lv,lv);class zu{constructor(e,i,l){this.blendFunction=e,this.blendColor=i,this.mask=l}}zu.Replace=[1,0],zu.disabled=new zu(zu.Replace,Qi.transparent,[!1,!1,!1,!1]),zu.unblended=new zu(zu.Replace,Qi.transparent,[!0,!0,!0,!0]),zu.alphaBlended=new zu([1,771],Qi.transparent,[!0,!0,!0,!0]);const uv=1029,hv=2305;class nu{constructor(e,i,l){this.enable=e,this.mode=i,this.frontFace=l}}nu.disabled=new nu(!1,uv,hv),nu.backCCW=new nu(!0,uv,hv),nu.backCW=new nu(!0,uv,2304),nu.frontCW=new nu(!0,1028,2304),nu.frontCCW=new nu(!0,1028,hv);class Qd extends Ys{constructor(e,i,l){super(),this.id=e,this._onlySymbols=l,i.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new xb(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new un,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const l=this._tiles[i];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Yi(this._tiles).map(e=>e.tileID).sort($v).map(e=>e.key)}getRenderableIds(e){const i=[];for(const l in this._tiles)this._isIdRenderable(+l,e)&&i.push(this._tiles[l]);return e?i.sort((l,u)=>{const p=l.tileID,g=u.tileID,b=new _e(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),T=new _e(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-g.overscaledZ||T.y-b.y||T.x-b.x}).map(l=>l.tileID.key):i.map(l=>l.tileID).sort($v).map(l=>l.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=i),this._loadTile(l,this._tileLoaded.bind(this,l,e,i)))}_tileLoaded(e,i,l,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new Yo(u,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Pn.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new In("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const p=i[u];if(e.neighboringTiles&&e.neighboringTiles[p]){const g=this.getTileByID(p);l(e,g),l(g,e)}}function l(u,p){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let g=p.tileID.canonical.x-u.tileID.canonical.x;const b=p.tileID.canonical.y-u.tileID.canonical.y,T=Math.pow(2,u.tileID.canonical.z),M=p.tileID.key;g===0&&b===0||Math.abs(b)>1||(Math.abs(g)>1&&(Math.abs(g+T)===1?g+=T:Math.abs(g-T)===1&&(g-=T)),p.dem&&u.dem&&(u.dem.backfillBorder(p.dem,g,b),u.neighboringTiles&&u.neighboringTiles[M]&&(u.neighboringTiles[M].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,l,u){for(const p in this._tiles){let g=this._tiles[p];if(u[p]||!g.hasData()||g.tileID.overscaledZ<=i||g.tileID.overscaledZ>l)continue;let b=g.tileID;for(;g&&g.tileID.overscaledZ>i+1;){const M=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[M.key],g&&g.hasData()&&(b=M)}let T=b;for(;T.overscaledZ>i;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){u[b.key]=b;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=i?l:null}for(let l=e.overscaledZ-1;l>=i;l--){const u=e.scaledTo(l),p=this._getLoadedTile(u);if(p)return p}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const l=Math.ceil(e.width/i)+1,u=Math.ceil(e.height/i)+1,p=Math.floor(l*u*5),g=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const l={};for(const u in this._tiles){const p=this._tiles[u];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+i),l[p.tileID.key]=p}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,i,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let u;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new Do(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(u=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(b=>this._source.hasTile(b)))):u=[];const p=this._updateRetainedTiles(u);if(e1(this._source.type)&&u.length!==0){const b={},T={},M=Object.keys(p);for(const O of M){const z=p[O],G=this._tiles[O];if(!G||G.fadeEndTime&&G.fadeEndTime<=Pn.now())continue;const j=this.findLoadedParent(z,Math.max(z.overscaledZ-Qd.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),b[j.tileID.key]=j.tileID),T[O]=z}const D=u[u.length-1].overscaledZ;for(const O in this._tiles){const z=this._tiles[O];if(p[O]||!z.hasData())continue;let G=z.tileID;for(;G.overscaledZ>D;){G=G.scaledTo(G.overscaledZ-1);const j=this._tiles[G.key];if(j&&j.hasData()&&T[G.key]){p[O]=z.tileID;break}}}for(const O in b)p[O]||(this._coveredTiles[O]=!0,p[O]=b[O])}for(const b in p)this._tiles[b].clearFadeHold();const g=function(b,T){const M=[];for(const D in b)D in T||M.push(D);return M}(this._tiles,p);for(const b of g){const T=this._tiles[b];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const l={},u=e.reduce((M,D)=>Math.min(M,D.overscaledZ),1/0),p=e[0].overscaledZ,g=Math.max(p-Qd.maxOverzooming,this._source.minzoom),b=Math.max(p+Qd.maxUnderzooming,this._source.minzoom),T={};for(const M of e){const D=this._addTile(M);i[M.key]=M,D.hasData()||u<this._source.maxzoom&&(T[M.key]=M)}this._retainLoadedChildren(T,u,b,i);for(const M of e){let D=this._tiles[M.key];if(D.hasData())continue;if(M.canonical.z>=this._source.maxzoom){const z=M.children(this._source.maxzoom)[0],G=this.getTile(z);if(G&&G.hasData()){i[z.key]=z;continue}}else{const z=M.children(this._source.maxzoom);if(i[z[0].key]&&i[z[1].key]&&i[z[2].key]&&i[z[3].key])continue}let O=D.wasRequested();for(let z=M.overscaledZ-1;z>=g;--z){const G=M.scaledTo(z);if(l[G.key]||(l[G.key]=!0,D=this.getTile(G),!D&&O&&(D=this._addTile(G)),D&&(i[G.key]=G,O=D.wasRequested(),D.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}i.push(u.key);const p=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(p),l)break;u=p}for(const p of i)this._loadedParentTiles[p]=l}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const l=!!i;if(!l){const u=this.map?this.map.painter:null;i=new Bn(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,l||this._source.fire(new In("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=i.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,l){const u=[],p=this.transform;if(!p)return u;const g=p.projection.name==="globe",b=Sc(p.center.lng);for(const T in this._tiles){const M=this._tiles[T];if(l&&M.clearQueryDebugViz(),M.holdingForFade())continue;let D;if(g){const O=M.tileID.canonical;if(O.z===0){const z=[Math.abs(dt(b,...Fm(O,-1))-b),Math.abs(dt(b,...Fm(O,1))-b)];D=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(dt(b,...Fm(O,-1))-b),Math.abs(dt(b,...Fm(O,0))-b),Math.abs(dt(b,...Fm(O,1))-b)];D=[z.indexOf(Math.min(...z))-1]}}else D=[0];for(const O of D){const z=e.containsTile(M,p,i,O);z&&u.push(z)}}return u}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of i)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(e1(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Pn.now())return!0}return!1}setFeatureState(e,i,l){this._state.updateState(e=e||"_geojsonTileLayer",i,l)}removeFeatureState(e,i,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,l)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,l){const u=this._tiles[e];u&&u.setDependencies(i,l)}reloadTilesForDependencies(e,i){for(const l in this._tiles)this._tiles[l].hasDependency(e,i)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,i))}_preloadTiles(e,i){const l=new Map,u=Array.isArray(e)?e:[e],p=this.map.painter.terrain,g=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const b of u){const T=b.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const M of T)l.set(M.key,M);this.usedForTerrain&&b.updateElevation(!1)}Gt(Array.from(l.values()),(b,T)=>{const M=new Bn(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(M,D=>{this._source.type==="raster-dem"&&M.dem&&this._backfillDEM(M),T(D,M)})},i)}}function $v(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||l-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function e1(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Fm(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Qd.maxOverzooming=10,Qd.maxUnderzooming=3;class Jg{constructor(e,i,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(e,i,l){const u=l||e.findDEMTileFor(i);if(!u||!u.dem)return;const p=u.dem,g=u.tileID,b=1<<i.canonical.z-g.canonical.z;return new Jg(u,u.tileSize/Fi/b,[(i.canonical.x/b-g.canonical.x)*p.dim,(i.canonical.y/b-g.canonical.y)*p.dim])}tileCoordToPixel(e,i){const l=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(l);return new _e(u,p)}getElevationAt(e,i,l,u){const p=e*this._scale+this._offset[0],g=i*this._scale+this._offset[1],b=Math.floor(p),T=Math.floor(g),M=this._dem;return u=!!u,l?$i($i(M.get(b,T,u),M.get(b,T+1,u),g-T),$i(M.get(b+1,T,u),M.get(b+1,T+1,u),g-T),p-b):M.get(b,T,u)}getElevationAtPixel(e,i,l){return this._dem.get(e,i,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Ql(1,e)*this._dem.stride}}class t1{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new bu(Fi,16,0),this.featureIndexArray=new Xc,this.promoteId=i}insert(e,i,l,u,p,g=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,p,g);const T=this.grid;for(let M=0;M<i.length;M++){const D=i[M],O=[1/0,1/0,-1/0,-1/0];for(let z=0;z<D.length;z++){const G=D[z];O[0]=Math.min(O[0],G.x),O[1]=Math.min(O[1],G.y),O[2]=Math.max(O[2],G.x),O[3]=Math.max(O[3],G.y)}O[0]<Fi&&O[1]<Fi&&O[2]>=0&&O[3]>=0&&T.insert(b,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new _m(new Ou(this.rawTileData)).layers,this.sourceLayerCoder=new N(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,l,u){this.loadVTLayers();const p=e.params||{},g=ss(p.filter),b=e.tileResult,T=e.transform,M=b.bufferedTilespaceBounds,D=this.grid.query(M.min.x,M.min.y,M.max.x,M.max.y,(j,X,ie,pe)=>Z_(b.bufferedTilespaceGeometry,j,X,ie,pe));D.sort(bb);let O=null;T.elevation&&D.length>0&&(O=Jg.create(T.elevation,this.tileID));const z={};let G;for(let j=0;j<D.length;j++){const X=D[j];if(X===G)continue;G=X;const ie=this.featureIndexArray.get(X);let pe=null;this.loadMatchingFeature(z,ie,g,p.layers,p.availableImages,i,l,u,(we,de,be,Se=0)=>(pe||(pe=Qc(we,this.tileID.canonical,e.tileTransform)),de.queryIntersectsFeature(b,we,be,pe,this.z,e.transform,e.pixelPosMatrix,O,Se)))}return z}loadMatchingFeature(e,i,l,u,p,g,b,T,M){const{featureIndex:D,bucketIndex:O,sourceLayerIndex:z,layoutVertexArrayOffset:G}=i,j=this.bucketLayerIDs[O];if(u&&!function(we,de){for(let be=0;be<we.length;be++)if(de.indexOf(we[be])>=0)return!0;return!1}(u,j))return;const X=this.sourceLayerCoder.decode(z),ie=this.vtLayers[X].feature(D);if(l.needGeometry){const we=yh(ie,!0);if(!l.filter(new He(this.tileID.overscaledZ),we,this.tileID.canonical))return}else if(!l.filter(new He(this.tileID.overscaledZ),ie))return;const pe=this.getId(ie,X);for(let we=0;we<j.length;we++){const de=j[we];if(u&&u.indexOf(de)<0)continue;const be=g[de];if(!be)continue;let Se={};pe!==void 0&&T&&(Se=T.getState(be.sourceLayer||"_geojsonTileLayer",pe));const Me=Gi({},b[de]);Me.paint=i1(Me.paint,be.paint,ie,Se,p),Me.layout=i1(Me.layout,be.layout,ie,Se,p);const $e=!M||M(ie,be,Se,G);if(!$e)continue;const Je=new ce(ie,this.z,this.x,this.y,pe);Je.layer=Me;let ht=e[de];ht===void 0&&(ht=e[de]=[]),ht.push({featureIndex:D,feature:Je,intersectionZ:$e})}}lookupSymbolFeatures(e,i,l,u,p,g,b,T){const M={};this.loadVTLayers();const D=ss(p);for(const O of e)this.loadMatchingFeature(M,{bucketIndex:l,sourceLayerIndex:u,featureIndex:O,layoutVertexArrayOffset:0},D,g,b,T,i);return M}loadFeature(e){const{featureIndex:i,sourceLayerIndex:l}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(l),p=this.vtFeatures[u];if(p[i])return p[i];const g=this.vtLayers[u].feature(i);return p[i]=g,g}hasLayer(e){for(const i of this.bucketLayerIDs)for(const l of i)if(e===l)return!0;return!1}getId(e,i){let l=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];u!=null&&(l=e.properties[u]),typeof l=="boolean"&&(l=Number(l))}return l}}function i1(t,e,i,l,u){return Wt(t,(p,g)=>{const b=e instanceof Ye?e.get(g):null;return b&&b.evaluate?b.evaluate(i,l,u):b})}function bb(t,e){return e-t}ri(t1,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class n1{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new bl({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const l=this.getKey(e,i);return this.positions[l]}trim(){const e=this.width,i=this.height=bn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,l){const u=[];let p=e.length%2==1?-e[e.length-1]*l:0,g=e[0]*l,b=!0;u.push({left:p,right:g,isDash:b,zeroLength:e[0]===0});let T=e[0];for(let M=1;M<e.length;M++){b=!b;const D=e[M];p=T*l,T+=D,g=T*l,u.push({left:p,right:g,isDash:b,zeroLength:D===0})}return u}addRoundDash(e,i,l){const u=i/2;for(let p=-l;p<=l;p++){const g=this.width*(this.nextRow+l+p);let b=0,T=e[b];for(let M=0;M<this.width;M++){M/T.right>1&&(T=e[++b]);const D=Math.abs(M-T.left),O=Math.abs(M-T.right),z=Math.min(D,O);let G;const j=p/l*(u+1);if(T.isDash){const X=u-Math.abs(j);G=Math.sqrt(z*z+X*X)}else G=u-Math.sqrt(z*z+j*j);this.image.data[g+M]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(e,i){for(let T=e.length-1;T>=0;--T){const M=e[T],D=e[T+1];M.zeroLength?e.splice(T,1):D&&D.isDash===M.isDash&&(D.left=M.left,e.splice(T,1))}const l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const p=this.width*this.nextRow;let g=0,b=e[g];for(let T=0;T<this.width;T++){T/b.right>1&&(b=e[++g]);const M=Math.abs(T-b.left),D=Math.abs(T-b.right),O=Math.min(M,D);this.image.data[p+T]=Math.max(0,Math.min(255,(b.isDash?O:-O)+i+128))}}addDash(e,i){const l=this.getKey(e,i);if(this.positions[l])return this.positions[l];const u=i==="round",p=u?7:0,g=2*p+1;if(this.nextRow+g>this.height)return Ii("LineAtlas out of space"),null;e.length===0&&e.push(1);let b=0;for(let D=0;D<e.length;D++)e[D]<0&&(Ii("Negative value is found in line dasharray, replacing values with 0"),e[D]=0),b+=e[D];if(b!==0){const D=this.width/b,O=this.getDashRanges(e,this.width,D);u?this.addRoundDash(O,D,p):this.addRegularDash(O,i==="square"?.5*D:0)}const T=this.nextRow+p;this.nextRow+=g;const M={tl:[T,p],br:[b,0]};return this.positions[l]=M,M}}ri(n1,"LineAtlas");class r1{constructor(e){const i={},l=[];for(const b in e){const T=e[b],M=i[b]={};for(const D in T.glyphs){const O=T.glyphs[+D];if(!O||O.bitmap.width===0||O.bitmap.height===0)continue;const z=O.metrics.localGlyph?2:1,G={x:0,y:0,w:O.bitmap.width+2*z,h:O.bitmap.height+2*z};l.push(G),M[D]=G}}const{w:u,h:p}=sp(l),g=new bl({width:u||1,height:p||1});for(const b in e){const T=e[b];for(const M in T.glyphs){const D=T.glyphs[+M];if(!D||D.bitmap.width===0||D.bitmap.height===0)continue;const O=i[b][M],z=D.metrics.localGlyph?2:1;bl.copy(D.bitmap,g,{x:0,y:0},{x:O.x+z,y:O.y+z},D.bitmap)}}this.image=g,this.positions=i}}ri(r1,"GlyphAtlas");class wb{constructor(e){this.tileID=new Do(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=wh(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,l,u,p){this.status="parsing",this.data=e,this.collisionBoxArray=new Np;const g=new N(Object.keys(e.layers).sort()),b=new t1(this.tileID,this.promoteId);b.bucketLayerIDs=[];const T={},M=new n1(256,256),D={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:M,availableImages:l},O=i.familiesBySource[this.source];for(const Se in O){const Me=e.layers[Se];if(!Me)continue;let $e=!1,Je=!1;for(const nt of O[Se])nt[0].type==="symbol"?$e=!0:Je=!0;if(this.isSymbolTile===!0&&!$e||this.isSymbolTile===!1&&!Je)continue;Me.version===1&&Ii(`Vector tile source "${this.source}" layer "${Se}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ht=g.encode(Se),Rt=[];for(let nt=0;nt<Me.length;nt++){const mt=Me.feature(nt),xt=b.getId(mt,Se);Rt.push({feature:mt,id:xt,index:nt,sourceLayerIndex:ht})}for(const nt of O[Se]){const mt=nt[0];this.isSymbolTile!==void 0&&mt.type==="symbol"!==this.isSymbolTile||mt.minzoom&&this.zoom<Math.floor(mt.minzoom)||mt.maxzoom&&this.zoom>=mt.maxzoom||mt.visibility!=="none"&&(dv(nt,this.zoom,l),(T[mt.id]=mt.createBucket({index:b.bucketLayerIDs.length,layers:nt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ht,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:l})).populate(Rt,D,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(nt.map(xt=>xt.id)))}}let z,G,j,X;M.trim();const ie={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},pe=Wt(D.glyphDependencies,Se=>Object.keys(Se).map(Number));Object.keys(pe).length?u.send("getGlyphs",{uid:this.uid,stacks:pe},(Se,Me)=>{z||(z=Se,G=Me,be.call(this))},void 0,!1,ie):G={};const we=Object.keys(D.iconDependencies);we.length?u.send("getImages",{icons:we,source:this.source,tileID:this.tileID,type:"icons"},(Se,Me)=>{z||(z=Se,j=Me,be.call(this))},void 0,!1,ie):j={};const de=Object.keys(D.patternDependencies);function be(){if(z)return p(z);if(G&&j&&X){const Se=new r1(G),Me=new Mg(j,X);for(const $e in T){const Je=T[$e];Je instanceof ku?(dv(Je.layers,this.zoom,l),W0(Je,G,Se.positions,j,Me.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection)):Je.hasPattern&&(Je instanceof Pu||Je instanceof Vd||Je instanceof gn)&&(dv(Je.layers,this.zoom,l),Je.addFeatures(D,this.tileID.canonical,Me.patternPositions,l,this.tileTransform))}this.status="done",p(null,{buckets:Yi(T).filter($e=>!$e.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Se.image,lineAtlas:M,imageAtlas:Me,glyphMap:this.returnDependencies?G:null,iconMap:this.returnDependencies?j:null,glyphPositions:this.returnDependencies?Se.positions:null})}}de.length?u.send("getImages",{icons:de,source:this.source,tileID:this.tileID,type:"patterns"},(Se,Me)=>{z||(z=Se,X=Me,be.call(this))},void 0,!1,ie):X={},be.call(this)}}function dv(t,e,i){const l=new He(e);for(const u of t)u.recalculate(l,i)}class s1{constructor(e){this.entries={},this.scheduler=e}request(e,i,l,u){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[g,b]=p.result;return this.scheduler?this.scheduler.add(()=>{u(g,b)},i):u(g,b),()=>{}}return p.callbacks.push(u),p.cancel||(p.cancel=l((g,b)=>{p.result=[g,b];for(const T of p.callbacks)this.scheduler?this.scheduler.add(()=>{T(g,b)},i):T(g,b);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(g=>g!==u),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function o1(t,e,i){const l=JSON.stringify(t.request);return t.data&&(this.deduped.entries[l]={result:[null,t.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const p=ls(t.request,(g,b,T,M)=>{g?u(g):b&&u(null,{vectorTile:i?void 0:new _m(new Ou(b)),rawData:b,cacheControl:T,expires:M})});return()=>{p.cancel(),u()}},e)}r.ARRAY_TYPE=Co,r.AUTH_ERR_MSG=La,r.Aabb=Vo,r.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Wi(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=gt()?t:I,this.scheduler=new S}send(t,e,i,l,u=!1,p){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=p,this.callbacks[g]=i);const b=Pr(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:t,hasCallback:!!i,targetMapId:l,mustQueue:u,sourceMapId:this.mapId,data:ch(e,b)},b),{cancel:()=>{i&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const l=this.cancelCallbacks[i];delete this.cancelCallbacks[i],l&&l.cancel()}else if(e.mustQueue||gt()){const l=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),l&&l.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if(e.type==="<response>"){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(uh(e.error)):i(null,uh(e.data)))}else{const i=Pr(this.globalScope)?void 0:[],l=e.hasCallback?(p,g)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:p?ch(p):null,data:ch(g,i)},i)}:p=>{},u=uh(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,l);else if(this.parent.getWorkerSource){const p=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,p[0],u.source)[p[1]](u,l)}else l(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},r.CanonicalTileID=np,r.Color=Qi,r.ColorMode=zu,r.CullFaceMode=nu,r.DEMData=Yg,r.DataConstantProperty=Ge,r.DedupedRequest=s1,r.DepthMode=yp,r.EXTENT=Fi,r.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,l=1<<i,u=Math.floor(t.x),p=Math.floor((t.x-u)*l),g=Math.floor(t.y*l),b=this.findDEMTileFor(new Do(i,u,i,p,g));return!(!b||!b.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||t.y<0||t.y>1)return e;const u=l.getSource().maxzoom,p=1<<u,g=Math.floor(t.x),b=t.x-g,T=new Do(u,g,u,Math.floor(b*p),Math.floor(t.y*p)),M=this.findDEMTileFor(T);if(!M||!M.dem)return e;const D=M.dem,O=1<<M.tileID.canonical.z,z=(b*O-M.tileID.canonical.x)*D.dim,G=(t.y*O-M.tileID.canonical.y)*D.dim,j=Math.floor(z),X=Math.floor(G);return(i?this.exaggeration():1)*$i($i(D.get(j,X),D.get(j,X+1),G-X),$i(D.get(j+1,X),D.get(j+1,X+1),G-X),z-j)}getAtTileOffset(t,e,i){const l=1<<t.canonical.z;return this.getAtPointOrZero(new Zh(t.wrap+(t.canonical.x+e/Fi)/l,(t.canonical.y+i/Fi)/l))}getAtTileOffsetFunc(t,e,i,l){return u=>{const p=this.getAtTileOffset(t,u.x,u.y),g=l.upVector(t.canonical,u.x,u.y);return No(g,g,p*l.upVectorScale(t.canonical,e,i).metersToTile),g}}getForTilePoints(t,e,i,l){if(this.isUsingMockSource())return!1;const u=Jg.create(this,t,l);return!!u&&(e.forEach(p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,l=e.tileID,u=1<<t.canonical.z-l.canonical.z;let p=t.canonical.x/u-l.canonical.x,g=t.canonical.y/u-l.canonical.y,b=0;for(let T=0;T<t.canonical.z-l.canonical.z&&!i.leaves[b];T++){p*=2,g*=2;const M=2*Math.floor(g)+Math.floor(p);b=i.childOffsets[b]+M,p%=1,g%=1}return{min:this.exaggeration()*i.minimums[b],max:this.exaggeration()*i.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},r.ErrorEvent=Yo,r.EvaluationParameters=He,r.Event=In,r.Evented=Ys,r.FillExtrusionBucket=gn,r.Frustum=Xp,r.FrustumCorners=Of,r.GLOBE_RADIUS=Mc,r.GLOBE_SCALE_MATCH_LATITUDE=45,r.GLOBE_ZOOM_THRESHOLD_MAX=6,r.GLOBE_ZOOM_THRESHOLD_MIN=5,r.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const i=new Li,l=new to,u=[],p=t+1+2,g=e[0]+1,b=e[0]+1+(1+e.length),T=(M,D,O)=>{let z=M===p-1?M-2:M===0?M:M-1;return z+=O?24575:0,[z,D]};for(let M=0;M<p;++M)i.emplaceBack(...T(M,0,!0));for(let M=0;M<g;++M)for(let D=0;D<p;++D)i.emplaceBack(...T(D,M,(D===0||D===p-1)&&!0));for(let M=0;M<e.length;++M){const D=e[M];for(let O=0;O<p;++O)i.emplaceBack(...T(O,D,!0))}for(let M=0;M<e.length;++M){const D=l.length,O=e[M]+1+2,z=new to;for(let X=0;X<O-1;X++){const ie=X===O-2,pe=ie?p*(b-e.length+M-X):p;for(let we=0;we<p-1;we++){const de=X*p+we;X===0||ie||we===0||we===p-2?(z.emplaceBack(de+1,de,de+pe),z.emplaceBack(de+pe,de+pe+1,de+1)):(l.emplaceBack(de+1,de,de+pe),l.emplaceBack(de+pe,de+pe+1,de+1))}}const G=Zr.simpleSegment(0,D,i.length,l.length-D);for(let X=0;X<z.uint16.length;X+=3)l.emplaceBack(z.uint16[X],z.uint16[X+1],z.uint16[X+2]);const j=Zr.simpleSegment(0,D,i.length,l.length-D);u.push({withoutSkirts:G,withSkirts:j})}return{vertices:i,indices:l,segments:u}}_createGrid(t){const e=this._fillGridMeshWithLods(_h,Gh);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Jc.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new to;for(let u=0;u<=_h;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new rn,l=new rn;this._poleSegments=[];for(let u=0,p=0;u<5;u++){const g=360/(1<<u);i.emplaceBack(0,-Mc,0,.5,0),l.emplaceBack(0,-Mc,0,.5,1);for(let b=0;b<=_h;b++){const T=b/_h,M=$i(0,g,T),[D,O,z]=qh(B_,F_,M,Mc);i.emplaceBack(D,O,z,T,0),l.emplaceBack(D,O,z,T,1)}this._poleSegments.push(Zr.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,P_,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(l,P_,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new Ec,l=_h,u=l+1+2,p=1;this._wireframeSegments=[];for(let g=0,b=0;g<Gh.length;g++){const T=Gh[g];for(let D=p;D<T+p;D++)for(let O=p;O<l+p;O++){const z=D*u+O;i.emplaceBack(z,z+1),i.emplaceBack(z,z+u),i.emplaceBack(z,z+u+1)}const M=T*l*3;this._wireframeSegments.push(Zr.simpleSegment(0,b,(T+1)*u,M)),b+=M}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},r.GlyphManager=td,r.ImagePosition=Em,r.LivePerformanceUtils=vt,r.LngLat=Wn,r.LngLatBounds=Wl,r.LocalGlyphMode=Sm,r.MAX_MERCATOR_LATITUDE=kr,r.MercatorCoordinate=Zh,r.ONE_EM=no,r.OverscaledTileID=Do,r.PerformanceMarkers=Ke,r.Properties=At,r.RGBAImage=Ea,r.Ray=Pf,r.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ye,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!qs(t))return t;const i=xs(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!qs(t))return t;const i=xs(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,l){if(!qs(t))return t;const u=xs(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),i&&u.params.push(`language=${i}`),l&&u.params.push(`worldview=${l}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,l){const u=xs(t);return qs(t)?(u.path=`/styles/v1${u.path}/sprite${e}${i}`,this._makeAPIURL(u,this._customAccessToken||l)):(u.path+=`${e}${i}`,ha(u))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!qs(t))return t;const l=xs(t);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&l.authority!=="raster"&&i===512?"@2x":""}${Z.supported?".webp":"$1"}`),l.authority==="raster"?l.path=`/${V.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${V.TILE_URL_VERSION}${l.path}`);const u=this._customAccessToken||function(p){for(const g of p){const b=g.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(l.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,u)}canonicalizeTileURL(t,e){const i=xs(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let l="mapbox://";i.path.match(/^\/raster\/v1\//)?l+=`raster/${i.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${i.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let u=i.params;return e&&(u=u.filter(p=>!p.match(/^access_token=/))),u.length&&(l+=`?${u.join("&")}`),l}canonicalizeTileset(t,e){const i=!!e&&qs(e),l=[];for(const u of t.tiles||[])ua(u)?l.push(this.canonicalizeTileURL(u,i)):l.push(u);return l}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=xs(V.API_URL);if(t.protocol=l.protocol,t.authority=l.authority,t.protocol==="http"){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(l.path!=="/"&&(t.path=`${l.path}${t.path}`),!V.REQUIRE_ACCESS_TOKEN)return ha(t);if(e=e||V.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),ha(t)}},r.ResourceType=yt,r.SegmentVector=Zr,r.SourceCache=Qd,r.StencilMode=cv,r.StructArrayLayout1ui2=xa,r.StructArrayLayout2f1f2i16=eo,r.StructArrayLayout2i4=Li,r.StructArrayLayout2ui4=Ec,r.StructArrayLayout3f12=Ws,r.StructArrayLayout3ui6=to,r.StructArrayLayout4i8=or,r.StructArrayLayout5f20=rn,r.Texture=h,r.Tile=Bn,r.Transitionable=Ut,r.Uniform1f=Sf,r.Uniform1i=class extends Gl{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},r.Uniform2f=class extends Gl{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},r.Uniform3f=class extends Gl{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},r.Uniform4f=__,r.UniformColor=g_,r.UniformMatrix2f=class extends Gl{constructor(t){super(t),this.current=Dy}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let l=0;l<4;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},r.UniformMatrix3f=class extends Gl{constructor(t){super(t),this.current=v_}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.UniformMatrix4f=class extends Gl{constructor(t){super(t),this.current=y_}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let l=1;l<16;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},r.UnwrappedTileID=Lc,r.ValidationError=ni,r.VectorTileFeature=ep,r.VectorTileWorkerSource=class extends Ys{constructor(t,e,i,l,u){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=u||o1,this.loading={},this.loaded={},this.deduped=new s1(t.scheduler),this.isSpriteLoaded=l,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,l=t&&t.request,u=l&&l.collectResourceTiming,p=this.loading[i]=new wb(t);p.abort=this.loadVectorData(t,(g,b)=>{const T=!this.loading[i];if(delete this.loading[i],T||g||!b)return p.status="done",T||(this.loaded[i]=p),e(g);const M=b.rawData,D={};b.expires&&(D.expires=b.expires),b.cacheControl&&(D.cacheControl=b.cacheControl),p.vectorTile=b.vectorTile||new _m(new Ou(M));const O=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(z,G)=>{if(z||!G)return e(z);const j={};if(u){const X=Mi(l);X.length>0&&(j.resourceTiming=JSON.parse(JSON.stringify(X)))}e(null,Gi({rawTileData:M.slice(0)},G,D,j))})};this.isSpriteLoaded?O():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(O,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):O()}),this.loaded=this.loaded||{},this.loaded[i]=p})}reloadTile(t,e){const i=this.loaded,l=t.uid,u=this;if(i&&i[l]){const p=i[l];p.showCollisionBoxes=t.showCollisionBoxes,p.enableTerrain=!!t.enableTerrain,p.projection=t.projection,p.tileTransform=wh(t.tileID.canonical,t.projection);const g=(b,T)=>{const M=p.reloadCallback;M&&(delete p.reloadCallback,p.parse(p.vectorTile,u.layerIndex,this.availableImages,u.actor,M)),e(b,T)};p.status==="parsing"?p.reloadCallback=g:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(t,e){const i=t.uid,l=this.loading[i];l&&(l.abort&&l.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,l=t.uid;i&&i[l]&&delete i[l],e()}},r.WritingMode=Ja,r.ZoomDependentExpression=Ha,r.add=Xl,r.addDynamicAttributes=_p,r.adjoint=function(t,e){var i=e[0],l=e[1],u=e[2],p=e[3],g=e[4],b=e[5],T=e[6],M=e[7],D=e[8];return t[0]=g*D-b*M,t[1]=u*M-l*D,t[2]=l*b-u*g,t[3]=b*T-p*D,t[4]=i*D-u*T,t[5]=u*p-i*b,t[6]=p*M-g*T,t[7]=l*T-i*M,t[8]=i*g-l*p,t},r.asyncAll=Gt,r.bezier=qt,r.bindAll=Wi,r.boundsAttributes=zi,r.bufferConvexPolygon=function(t,e){const i=[];for(let l=0;l<t.length;l++){const u=Vi(l-1,-1,t.length-1),p=Vi(l+1,-1,t.length-1),g=t[l],b=t[p],T=t[u].sub(g).unit(),M=b.sub(g).unit(),D=M.angleWithSep(T.x,T.y),O=T.add(M).unit().mult(-1*e/Math.sin(D/2));i.push(g.add(O))}return i},r.cacheEntryPossiblyAdded=function(t){vs++,vs>qi&&(t.getActor().send("enforceCacheSizeLimit",li),vs=0)},r.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:l}=t.point,u=k_(i,l,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Yc(u,u,Qp(Yl(e)))},r.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:l,lat:u}=t._center;return k_(e,i,t.worldSize,l,u)},r.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/Ql(1,t.center.lat),l=wa(new Float64Array(16));return Md(l,l,[t.point.x,t.point.y,0]),Su(l,l,[i,i,e]),Float32Array.from(l)},r.circumferenceAtLatitude=Ff,r.clamp=dt,r.clearTileCache=function(t){if(!Ci())return;const e=I.caches.delete(jn);t&&e.catch(t).then(()=>t())},r.clipLine=zg,r.clone=function(t){var e=new Co(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},r.clone$1=It,r.collisionCircleLayout=E0,r.config=V,r.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},r.create=function(){var t=new Co(16);return Co!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},r.create$1=I_,r.createExpression=Bl,r.createLayout=Ti,r.createStyleLayer=function(t){return t.type==="custom"?new sv(t):new av[t.type](t)},r.cross=Ld,r.degToRad=Bt,r.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},r.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},r.dot=vl,r.earthRadius=kd,r.ease=_t,r.easeCubicInOut=Nt,r.ecefToLatLng=function([t,e,i]){const l=Math.hypot(t,e,i),u=Math.atan2(t,i),p=.5*Math.PI-Math.acos(-e/l);return new Wn(et(u),et(p))},r.emitValidationErrors=df,r.endsWith=Ei,r.enforceCacheSizeLimit=function(t){Jt(),sr&&sr.then(e=>{e.keys().then(i=>{for(let l=0;l<i.length-t;l++)e.delete(i[l])})})},r.evaluateSizeForFeature=Hd,r.evaluateSizeForZoom=Po,r.evaluateVariableOffset=Vg,r.evented=ge,r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},r.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},r.exported=Pn,r.exported$1=Z,r.extend=Gi,r.extend$1=Jo,r.fillExtrusionHeightLift=fg,r.filterObject=Vn,r.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},r.fromQuat=function(t,e){var i=e[0],l=e[1],u=e[2],p=e[3],g=i+i,b=l+l,T=u+u,M=i*g,D=l*g,O=l*b,z=u*g,G=u*b,j=u*T,X=p*g,ie=p*b,pe=p*T;return t[0]=1-O-j,t[1]=D+pe,t[2]=z-ie,t[3]=0,t[4]=D-pe,t[5]=1-M-j,t[6]=G+X,t[7]=0,t[8]=z+ie,t[9]=G-X,t[10]=1-M-O,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromRotation=function(t,e){var i=Math.sin(e),l=Math.cos(e);return t[0]=l,t[1]=i,t[2]=0,t[3]=-i,t[4]=l,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromScaling=qp,r.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return ot[e]},r.getAABBPointSquareDist=function(t,e,i){let l=0;for(let u=0;u<2;++u){const p=i?i[u]:0;t[u]>p&&(l+=(t[u]-p)*(t[u]-p)),e[u]<p&&(l+=(p-e[u])*(p-e[u]))}return l},r.getAnchorAlignment=Ru,r.getAnchorJustification=Zd,r.getBounds=function(t){let e=1/0,i=1/0,l=-1/0,u=-1/0;for(const p of t)e=Math.min(e,p.x),i=Math.min(i,p.y),l=Math.max(l,p.x),u=Math.max(u,p.y);return{min:new _e(e,i),max:new _e(l,u)}},r.getColumn=Ji,r.getGridMatrix=function(t,e,i,l){const u=e.getNorth(),p=e.getSouth(),g=e.getWest(),b=e.getEast(),T=1<<t.z,M=b-g,D=u-p,O=M/_h,z=-D/Gh[i],G=[0,O,0,z,0,0,u,g,0];if(t.z>0){const j=180/l;jp(G,G,[j/M+1,0,0,0,j/D+1,0,-.5*j/O,.5*j/z,1])}return G[2]=T,G[5]=t.x,G[8]=t.y,G},r.getImage=ho,r.getJSON=function(t,e){return yn(Gi(t,{type:"json"}),e)},r.getLatitudinalLod=function(t){const e=kr-5;t=dt(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Bt(t))),3);return Math.round(i*(Gh.length-1))},r.getMapSessionAPI=Fe,r.getPerformanceMeasurement=Mi,r.getProjection=Xg,r.getRTLTextPluginStatus=Ae,r.getReferrer=xi,r.getTilePoint=function(t,{x:e,y:i},l=0){return new _e(((e-l)*t.scale-t.x)*Fi,(i*t.scale-t.y)*Fi)},r.getTileVec3=function(t,e,i=0){return Cu(((e.x-i)*t.scale-t.x)*Fi,(e.y*t.scale-t.y)*Fi,U_(e.z,e.y))},r.getVideo=function(t,e){const i=I.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let l=0;l<t.length;l++){const u=I.document.createElement("source");js(t[l])||(i.crossOrigin="Anonymous"),u.src=t[l],i.appendChild(u)}return{cancel:()=>{}}},r.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=wa(new Float64Array(16));return Yc(i,t.pixelMatrix,t.globeMatrix),$r(e,e,i),new _e(e[0],e[1])},r.globeDenormalizeECEF=Qp,r.globeECEFOrigin=function(t,e){const i=[0,0,0];return $r(i,i,Rd(Yl(e.canonical))),$r(i,i,t),i},r.globeMetersToEcef=Pd,r.globeNormalizeECEF=Rd,r.globePixelsToTileUnits=function(t,e){return Fi/(512*Math.pow(2,t))*Bf(Yl(e))},r.globePoleMatrixForTile=function(t,e,i){const l=wa(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return Ad(l,i.globeMatrix,u),Float32Array.from(l)},r.globeTileBounds=Yl,r.globeTiltAtLngLat=z_,r.globeToMercatorTransition=Wh,r.globeUseCustomAntiAliasing=function(t,e,i){const l=Wh(i.zoom),u=t.style.map._antialias,p=!!e.extStandardDerivatives,g=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return l===0&&!u&&!g&&p},r.identity=wa,r.identity$1=Ic,r.invert=Lf,r.isFullscreen=function(){return!!I.document.fullscreenElement||!!I.document.webkitFullscreenElement},r.isLngLatBehindGlobe=$p,r.isMapAuthenticated=function(t){return Re.has(t)},r.isMapboxURL=qs,r.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Pr(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.latFromMercatorY=yo,r.latLngToECEF=Hh,r.len=Oy,r.length=Za,r.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},r.lngFromMercatorX=Ka,r.loadVectorTile=o1,r.makeRequest=yn,r.mapValue=function(t,e,i,l,u){return dt((t-e)/(i-e)*(u-l)+l,l,u)},r.mercatorScale=V_,r.mercatorXfromLng=Sc,r.mercatorYfromLat=Cc,r.mercatorZfromAltitude=Ql,r.mul=A_,r.mul$1=C_,r.multiply=Yc,r.multiply$1=jp,r.multiply$2=Cd,r.nextPowerOfTwo=bn,r.normalize=Es,r.normalize$1=Ry,r.normalize$2=L_,r.number=$i,r.ortho=function(t,e,i,l,u,p,g){var b=1/(e-i),T=1/(l-u),M=1/(p-g);return t[0]=-2*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*T,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*M,t[11]=0,t[12]=(e+i)*b,t[13]=(u+l)*T,t[14]=(g+p)*M,t[15]=1,t},r.pbf=Ou,r.perspective=function(t,e,i,l,u){var p,g=1/Math.tan(e/2);return t[0]=g/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+l)*(p=1/(l-u)),t[14]=2*u*l*p):(t[10]=-1,t[14]=-2*l),t},r.pick=function(t,e){const i={};for(let l=0;l<e.length;l++){const u=e[l];u in t&&(i[u]=t[u])}return i},r.plugin=De,r.pointGeometry=_e,r.polesInViewport=function(t){const e=wa(new Float64Array(16));Yc(e,t.pixelMatrix,t.globeMatrix);const i=[0,Xa,0],l=[0,xl,0];return $r(i,i,e),$r(l,l,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!$p(t,new Wn(t.center.lat,90)),l[0]>0&&l[0]<=t.width&&l[1]>0&&l[1]<=t.height&&!$p(t,new Wn(t.center.lat,-90))]},r.polygonContainsPoint=vh,r.polygonIntersectsBox=Z_,r.polygonIntersectsPolygon=j_,r.polygonizeBounds=function(t,e,i=0,l=!0){const u=new _e(i,i),p=t.sub(u),g=e.add(u),b=[p,new _e(g.x,p.y),g,new _e(p.x,g.y)];return l&&b.push(p.clone()),b},r.posAttributes=Jc,r.postMapLoadEvent=ue,r.postPerformanceEvent=Ce,r.postTurnstileEvent=q,r.potpack=sp,r.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.radToDeg=et,r.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.registerForPluginStateChange=function(t){return t({pluginStatus:le,pluginURL:J}),ge.on("pluginStateChange",t),t},r.removeAuthState=function(t){Re.delete(t)},r.renderColorRamp=hm,r.resample=im,r.rotateX=Zl,r.rotateX$1=Uo,r.rotateY=Ad,r.rotateY$1=Df,r.rotateZ=function(t,e,i){var l=Math.sin(i),u=Math.cos(i),p=e[0],g=e[1],b=e[2],T=e[3],M=e[4],D=e[5],O=e[6],z=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=p*u+M*l,t[1]=g*u+D*l,t[2]=b*u+O*l,t[3]=T*u+z*l,t[4]=M*u-p*l,t[5]=D*u-g*l,t[6]=O*u-b*l,t[7]=z*u-T*l,t},r.rotateZ$1=function(t,e,i){i*=.5;var l=e[0],u=e[1],p=e[2],g=e[3],b=Math.sin(i),T=Math.cos(i);return t[0]=l*T+u*b,t[1]=u*T-l*b,t[2]=p*T+g*b,t[3]=g*T-p*b,t},r.scale=Su,r.scale$1=Wp,r.scale$2=No,r.scaleAndAdd=ph,r.set=function(t,e,i,l){return t[0]=e,t[1]=i,t[2]=l,t},r.setCacheLimits=function(t,e){li=t,qi=e},r.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},r.setRTLTextPlugin=function(t,e,i=!1){if(le===ee||le===se||le===re)throw new Error("setRTLTextPlugin cannot be called multiple times.");J=Pn.resolveURL(t),le=ee,oe=e,fe(),i||Te()},r.smoothstep=ti,r.spec=st,r.squaredLength=function(t){var e=t[0],i=t[1],l=t[2];return e*e+i*i+l*l},r.storeAuthState=function(t,e){e?Re.add(t):Re.delete(t)},r.sub=Kl,r.subtract=Sd,r.symbolSize=vg,r.tileAABB=function(t,e,i,l,u,p,g,b,T){if(T.name==="globe")return gh(t,e,new np(i,l,u));const M=wh({z:i,x:l,y:u},T);return new Vo([(p+M.x/M.scale)*e,e*(M.y/M.scale),g],[(p+M.x2/M.scale)*e,e*(M.y2/M.scale),b])},r.tileCornersToBounds=kf,r.tileTransform=wh,r.transformMat3=function(t,e,i){var l=e[0],u=e[1],p=e[2];return t[0]=l*i[0]+u*i[3]+p*i[6],t[1]=l*i[1]+u*i[4]+p*i[7],t[2]=l*i[2]+u*i[5]+p*i[8],t},r.transformMat4=$r,r.transformMat4$1=mh,r.transformQuat=Lo,r.transitionTileAABBinECEF=Jp,r.translate=Md,r.transpose=function(t,e){if(t===e){var i=e[1],l=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=l,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},r.triggerPluginCompletionEvent=me,r.uniqueId=Ni,r.updateGlobeVertexNormal=function(t,e,i,l,u){const p=5*e+2;t.float32[p+0]=i,t.float32[p+1]=l,t.float32[p+2]=u},r.validateCustomStyleLayer=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.validateFilter=t=>Ul(vu(t)),r.validateFog=t=>Ul(ah(t)),r.validateLayer=t=>Ul(_d(t)),r.validateLight=t=>Ul(ne(t)),r.validateSource=t=>Ul(Nl(t)),r.validateStyle=hf,r.validateTerrain=t=>Ul(vc(t)),r.values=Yi,r.vectorTile=Qf,r.version=R,r.warnOnce=Ii,r.window=I,r.wrap=Vi}),v(["./shared"],function(r){function I(he){if(typeof he=="number"||typeof he=="boolean"||typeof he=="string"||he==null)return JSON.stringify(he);if(Array.isArray(he)){let K="[";for(const ue of he)K+=`${I(ue)},`;return`${K}]`}let q="{";for(const K of Object.keys(he).sort())q+=`${K}:${I(he[K])},`;return`${q}}`}function R(he){let q="";for(const K of r.refProperties)q+=`/${I(he[K])}`;return q}class U{constructor(q){this.keyCache={},q&&this.replace(q)}replace(q){this._layerConfigs={},this._layers={},this.update(q,[])}update(q,K){for(const ve of q)this._layerConfigs[ve.id]=ve,(this._layers[ve.id]=r.createStyleLayer(ve)).compileFilter(),this.keyCache[ve.id]&&delete this.keyCache[ve.id];for(const ve of K)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};const ue=function(ve,Ce){const qe={};for(let Re=0;Re<ve.length;Re++){const Ke=Ce&&Ce[ve[Re].id]||R(ve[Re]);Ce&&(Ce[ve[Re].id]=Ke);let vt=qe[Ke];vt||(vt=qe[Ke]=[]),vt.push(ve[Re])}const Fe=[];for(const Re in qe)Fe.push(qe[Re]);return Fe}(r.values(this._layerConfigs),this.keyCache);for(const ve of ue){const Ce=ve.map(Xt=>this._layers[Xt.id]),qe=Ce[0];if(qe.visibility==="none")continue;const Fe=qe.source||"";let Re=this.familiesBySource[Fe];Re||(Re=this.familiesBySource[Fe]={});const Ke=qe.sourceLayer||"_geojsonTileLayer";let vt=Re[Ke];vt||(vt=Re[Ke]=[]),vt.push(Ce)}}}class V{loadTile(q,K){const{uid:ue,encoding:ve,rawImageData:Ce,padding:qe,buildQuadTree:Fe}=q,Re=r.window.ImageBitmap&&Ce instanceof r.window.ImageBitmap?this.getImageData(Ce,qe):Ce;K(null,new r.DEMData(ue,Re,ve,qe<1,Fe))}getImageData(q,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const ue=this.offscreenCanvasContext.getImageData(-K,-K,q.width+2*K,q.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}var Z=function he(q,K){var ue,ve=q&&q.type;if(ve==="FeatureCollection")for(ue=0;ue<q.features.length;ue++)he(q.features[ue],K);else if(ve==="GeometryCollection")for(ue=0;ue<q.geometries.length;ue++)he(q.geometries[ue],K);else if(ve==="Feature")he(q.geometry,K);else if(ve==="Polygon")Y(q.coordinates,K);else if(ve==="MultiPolygon")for(ue=0;ue<q.coordinates.length;ue++)Y(q.coordinates[ue],K);return q};function Y(he,q){if(he.length!==0){W(he[0],q);for(var K=1;K<he.length;K++)W(he[K],!q)}}function W(he,q){for(var K=0,ue=0,ve=0,Ce=he.length,qe=Ce-1;ve<Ce;qe=ve++){var Fe=(he[ve][0]-he[qe][0])*(he[qe][1]+he[ve][1]),Re=K+Fe;ue+=Math.abs(K)>=Math.abs(Fe)?K-Re+Fe:Fe-Re+K,K=Re}K+ue>=0!=!!q&&he.reverse()}const te=r.VectorTileFeature.prototype.toGeoJSON;class ae{constructor(q){this._feature=q,this.extent=r.EXTENT,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))}loadGeometry(){if(this._feature.type===1){const q=[];for(const K of this._feature.geometry)q.push([new r.pointGeometry(K[0],K[1])]);return q}{const q=[];for(const K of this._feature.geometry){const ue=[];for(const ve of K)ue.push(new r.pointGeometry(ve[0],ve[1]));q.push(ue)}return q}}toGeoJSON(q,K,ue){return te.call(this,q,K,ue)}}class Ie{constructor(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.EXTENT,this.length=q.length,this._features=q}feature(q){return new ae(this._features[q])}}var ye={},Ue={get exports(){return ye},set exports(he){ye=he}},je=r.pointGeometry,_e=r.vectorTile.VectorTileFeature,ct=lt;function lt(he,q){this.options=q||{},this.features=he,this.length=he.length}function St(he,q){this.id=typeof he.id=="number"?he.id:void 0,this.type=he.type,this.rawGeometry=he.type===1?[he.geometry]:he.geometry,this.properties=he.tags,this.extent=q||4096}lt.prototype.feature=function(he){return new St(this.features[he],this.options.extent)},St.prototype.loadGeometry=function(){var he=this.rawGeometry;this.geometry=[];for(var q=0;q<he.length;q++){for(var K=he[q],ue=[],ve=0;ve<K.length;ve++)ue.push(new je(K[ve][0],K[ve][1]));this.geometry.push(ue)}return this.geometry},St.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var he=this.geometry,q=1/0,K=-1/0,ue=1/0,ve=-1/0,Ce=0;Ce<he.length;Ce++)for(var qe=he[Ce],Fe=0;Fe<qe.length;Fe++){var Re=qe[Fe];q=Math.min(q,Re.x),K=Math.max(K,Re.x),ue=Math.min(ue,Re.y),ve=Math.max(ve,Re.y)}return[q,ue,K,ve]},St.prototype.toGeoJSON=_e.prototype.toGeoJSON;var Bt=r.pbf,et=ct;function ot(he){var q=new Bt;return function(K,ue){for(var ve in K.layers)ue.writeMessage(3,Nt,K.layers[ve])}(he,q),q.finish()}function Nt(he,q){var K;q.writeVarintField(15,he.version||1),q.writeStringField(1,he.name||""),q.writeVarintField(5,he.extent||4096);var ue={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<he.length;K++)ue.feature=he.feature(K),q.writeMessage(2,qt,ue);var ve=ue.keys;for(K=0;K<ve.length;K++)q.writeStringField(3,ve[K]);var Ce=ue.values;for(K=0;K<Ce.length;K++)q.writeMessage(4,Gt,Ce[K])}function qt(he,q){var K=he.feature;K.id!==void 0&&q.writeVarintField(1,K.id),q.writeMessage(2,_t,he),q.writeVarintField(3,K.type),q.writeMessage(4,Vi,K)}function _t(he,q){var K=he.feature,ue=he.keys,ve=he.values,Ce=he.keycache,qe=he.valuecache;for(var Fe in K.properties){var Re=K.properties[Fe],Ke=Ce[Fe];if(Re!==null){Ke===void 0&&(ue.push(Fe),Ce[Fe]=Ke=ue.length-1),q.writeVarint(Ke);var vt=typeof Re;vt!=="string"&&vt!=="boolean"&&vt!=="number"&&(Re=JSON.stringify(Re));var Xt=vt+":"+Re,Dt=qe[Xt];Dt===void 0&&(ve.push(Re),qe[Xt]=Dt=ve.length-1),q.writeVarint(Dt)}}}function dt(he,q){return(q<<3)+(7&he)}function ti(he){return he<<1^he>>31}function Vi(he,q){for(var K=he.loadGeometry(),ue=he.type,ve=0,Ce=0,qe=K.length,Fe=0;Fe<qe;Fe++){var Re=K[Fe],Ke=1;ue===1&&(Ke=Re.length),q.writeVarint(dt(1,Ke));for(var vt=ue===3?Re.length-1:Re.length,Xt=0;Xt<vt;Xt++){Xt===1&&ue!==1&&q.writeVarint(dt(2,vt-1));var Dt=Re[Xt].x-ve,Mi=Re[Xt].y-Ce;q.writeVarint(ti(Dt)),q.writeVarint(ti(Mi)),ve+=Dt,Ce+=Mi}ue===3&&q.writeVarint(dt(7,1))}}function Gt(he,q){var K=typeof he;K==="string"?q.writeStringField(1,he):K==="boolean"?q.writeBooleanField(7,he):K==="number"&&(he%1!=0?q.writeDoubleField(3,he):he<0?q.writeSVarintField(6,he):q.writeVarintField(5,he))}function Yi(he,q,K,ue,ve,Ce){if(ve-ue<=K)return;const qe=ue+ve>>1;Gi(he,q,qe,ue,ve,Ce%2),Yi(he,q,K,ue,qe-1,Ce+1),Yi(he,q,K,qe+1,ve,Ce+1)}function Gi(he,q,K,ue,ve,Ce){for(;ve>ue;){if(ve-ue>600){const Ke=ve-ue+1,vt=K-ue+1,Xt=Math.log(Ke),Dt=.5*Math.exp(2*Xt/3),Mi=.5*Math.sqrt(Xt*Dt*(Ke-Dt)/Ke)*(vt-Ke/2<0?-1:1);Gi(he,q,K,Math.max(ue,Math.floor(K-vt*Dt/Ke+Mi)),Math.min(ve,Math.floor(K+(Ke-vt)*Dt/Ke+Mi)),Ce)}const qe=q[2*K+Ce];let Fe=ue,Re=ve;for(ki(he,q,ue,K),q[2*ve+Ce]>qe&&ki(he,q,ue,ve);Fe<Re;){for(ki(he,q,Fe,Re),Fe++,Re--;q[2*Fe+Ce]<qe;)Fe++;for(;q[2*Re+Ce]>qe;)Re--}q[2*ue+Ce]===qe?ki(he,q,ue,Re):(Re++,ki(he,q,Re,ve)),Re<=K&&(ue=Re+1),K<=Re&&(ve=Re-1)}}function ki(he,q,K,ue){Ni(he,K,ue),Ni(q,2*K,2*ue),Ni(q,2*K+1,2*ue+1)}function Ni(he,q,K){const ue=he[q];he[q]=he[K],he[K]=ue}function Dn(he,q,K,ue){const ve=he-K,Ce=q-ue;return ve*ve+Ce*Ce}Ue.exports=ot,ye.fromVectorTileJs=ot,ye.fromGeojsonVt=function(he,q){q=q||{};var K={};for(var ue in he)K[ue]=new et(he[ue].features,q),K[ue].name=ue,K[ue].version=q.version,K[ue].extent=q.extent;return ot({layers:K})},ye.GeoJSONWrapper=et;const bn=he=>he[0],ui=he=>he[1];class Wi{constructor(q,K=bn,ue=ui,ve=64,Ce=Float64Array){this.nodeSize=ve,this.points=q;const qe=q.length<65536?Uint16Array:Uint32Array,Fe=this.ids=new qe(q.length),Re=this.coords=new Ce(2*q.length);for(let Ke=0;Ke<q.length;Ke++)Fe[Ke]=Ke,Re[2*Ke]=K(q[Ke]),Re[2*Ke+1]=ue(q[Ke]);Yi(Fe,Re,ve,0,Fe.length-1,0)}range(q,K,ue,ve){return function(Ce,qe,Fe,Re,Ke,vt,Xt){const Dt=[0,Ce.length-1,0],Mi=[];let gi,yi;for(;Dt.length;){const Le=Dt.pop(),hi=Dt.pop(),Pn=Dt.pop();if(hi-Pn<=Xt){for(let In=Pn;In<=hi;In++)gi=qe[2*In],yi=qe[2*In+1],gi>=Fe&&gi<=Ke&&yi>=Re&&yi<=vt&&Mi.push(Ce[In]);continue}const Oi=Math.floor((Pn+hi)/2);gi=qe[2*Oi],yi=qe[2*Oi+1],gi>=Fe&&gi<=Ke&&yi>=Re&&yi<=vt&&Mi.push(Ce[Oi]);const wn=(Le+1)%2;(Le===0?Fe<=gi:Re<=yi)&&(Dt.push(Pn),Dt.push(Oi-1),Dt.push(wn)),(Le===0?Ke>=gi:vt>=yi)&&(Dt.push(Oi+1),Dt.push(hi),Dt.push(wn))}return Mi}(this.ids,this.coords,q,K,ue,ve,this.nodeSize)}within(q,K,ue){return function(ve,Ce,qe,Fe,Re,Ke){const vt=[0,ve.length-1,0],Xt=[],Dt=Re*Re;for(;vt.length;){const Mi=vt.pop(),gi=vt.pop(),yi=vt.pop();if(gi-yi<=Ke){for(let wn=yi;wn<=gi;wn++)Dn(Ce[2*wn],Ce[2*wn+1],qe,Fe)<=Dt&&Xt.push(ve[wn]);continue}const Le=Math.floor((yi+gi)/2),hi=Ce[2*Le],Pn=Ce[2*Le+1];Dn(hi,Pn,qe,Fe)<=Dt&&Xt.push(ve[Le]);const Oi=(Mi+1)%2;(Mi===0?qe-Re<=hi:Fe-Re<=Pn)&&(vt.push(yi),vt.push(Le-1),vt.push(Oi)),(Mi===0?qe+Re>=hi:Fe+Re>=Pn)&&(vt.push(Le+1),vt.push(gi),vt.push(Oi))}return Xt}(this.ids,this.coords,q,K,ue,this.nodeSize)}}const Ei={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:he=>he},Wt=Math.fround||(Vn=new Float32Array(1),he=>(Vn[0]=+he,Vn[0]));var Vn;class It{constructor(q){this.options=Pr(Object.create(Ei),q),this.trees=new Array(this.options.maxZoom+1)}load(q){const{log:K,minZoom:ue,maxZoom:ve,nodeSize:Ce}=this.options;K&&console.time("total time");const qe=`prepare ${q.length} points`;K&&console.time(qe),this.points=q;let Fe=[];for(let Re=0;Re<q.length;Re++)q[Re].geometry&&Fe.push(Ii(q[Re],Re));this.trees[ve+1]=new Wi(Fe,Ir,Ji,Ce,Float32Array),K&&console.timeEnd(qe);for(let Re=ve;Re>=ue;Re--){const Ke=+Date.now();Fe=this._cluster(Fe,Re),this.trees[Re]=new Wi(Fe,Ir,Ji,Ce,Float32Array),K&&console.log("z%d: %d clusters in %dms",Re,Fe.length,+Date.now()-Ke)}return K&&console.timeEnd("total time"),this}getClusters(q,K){let ue=((q[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,q[1]));let Ce=q[2]===180?180:((q[2]+180)%360+360)%360-180;const qe=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)ue=-180,Ce=180;else if(ue>Ce){const vt=this.getClusters([ue,ve,180,qe],K),Xt=this.getClusters([-180,ve,Ce,qe],K);return vt.concat(Xt)}const Fe=this.trees[this._limitZoom(K)],Re=Fe.range(gt(ue),Si(qe),gt(Ce),Si(ve)),Ke=[];for(const vt of Re){const Xt=Fe.points[vt];Ke.push(Xt.numPoints?dn(Xt):this.points[Xt.index])}return Ke}getChildren(q){const K=this._getOriginId(q),ue=this._getOriginZoom(q),ve="No cluster with the specified id.",Ce=this.trees[ue];if(!Ce)throw new Error(ve);const qe=Ce.points[K];if(!qe)throw new Error(ve);const Fe=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),Re=Ce.within(qe.x,qe.y,Fe),Ke=[];for(const vt of Re){const Xt=Ce.points[vt];Xt.parentId===q&&Ke.push(Xt.numPoints?dn(Xt):this.points[Xt.index])}if(Ke.length===0)throw new Error(ve);return Ke}getLeaves(q,K,ue){const ve=[];return this._appendLeaves(ve,q,K=K||10,ue=ue||0,0),ve}getTile(q,K,ue){const ve=this.trees[this._limitZoom(q)],Ce=Math.pow(2,q),{extent:qe,radius:Fe}=this.options,Re=Fe/qe,Ke=(ue-Re)/Ce,vt=(ue+1+Re)/Ce,Xt={features:[]};return this._addTileFeatures(ve.range((K-Re)/Ce,Ke,(K+1+Re)/Ce,vt),ve.points,K,ue,Ce,Xt),K===0&&this._addTileFeatures(ve.range(1-Re/Ce,Ke,1,vt),ve.points,Ce,ue,Ce,Xt),K===Ce-1&&this._addTileFeatures(ve.range(0,Ke,Re/Ce,vt),ve.points,-1,ue,Ce,Xt),Xt.features.length?Xt:null}getClusterExpansionZoom(q){let K=this._getOriginZoom(q)-1;for(;K<=this.options.maxZoom;){const ue=this.getChildren(q);if(K++,ue.length!==1)break;q=ue[0].properties.cluster_id}return K}_appendLeaves(q,K,ue,ve,Ce){const qe=this.getChildren(K);for(const Fe of qe){const Re=Fe.properties;if(Re&&Re.cluster?Ce+Re.point_count<=ve?Ce+=Re.point_count:Ce=this._appendLeaves(q,Re.cluster_id,ue,ve,Ce):Ce<ve?Ce++:q.push(Fe),q.length===ue)break}return Ce}_addTileFeatures(q,K,ue,ve,Ce,qe){for(const Fe of q){const Re=K[Fe],Ke=Re.numPoints;let vt,Xt,Dt;if(Ke)vt=$t(Re),Xt=Re.x,Dt=Re.y;else{const yi=this.points[Re.index];vt=yi.properties,Xt=gt(yi.geometry.coordinates[0]),Dt=Si(yi.geometry.coordinates[1])}const Mi={type:1,geometry:[[Math.round(this.options.extent*(Xt*Ce-ue)),Math.round(this.options.extent*(Dt*Ce-ve))]],tags:vt};let gi;Ke?gi=Re.id:this.options.generateId?gi=Re.index:this.points[Re.index].id&&(gi=this.points[Re.index].id),gi!==void 0&&(Mi.id=gi),qe.features.push(Mi)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,K){const ue=[],{radius:ve,extent:Ce,reduce:qe,minPoints:Fe}=this.options,Re=ve/(Ce*Math.pow(2,K));for(let Ke=0;Ke<q.length;Ke++){const vt=q[Ke];if(vt.zoom<=K)continue;vt.zoom=K;const Xt=this.trees[K+1],Dt=Xt.within(vt.x,vt.y,Re),Mi=vt.numPoints||1;let gi=Mi;for(const yi of Dt){const Le=Xt.points[yi];Le.zoom>K&&(gi+=Le.numPoints||1)}if(gi>Mi&&gi>=Fe){let yi=vt.x*Mi,Le=vt.y*Mi,hi=qe&&Mi>1?this._map(vt,!0):null;const Pn=(Ke<<5)+(K+1)+this.points.length;for(const Oi of Dt){const wn=Xt.points[Oi];if(wn.zoom<=K)continue;wn.zoom=K;const In=wn.numPoints||1;yi+=wn.x*In,Le+=wn.y*In,wn.parentId=Pn,qe&&(hi||(hi=this._map(vt,!0)),qe(hi,this._map(wn)))}vt.parentId=Pn,ue.push(wt(yi/gi,Le/gi,Pn,gi,hi))}else if(ue.push(vt),gi>1)for(const yi of Dt){const Le=Xt.points[yi];Le.zoom<=K||(Le.zoom=K,ue.push(Le))}}return ue}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,K){if(q.numPoints)return K?Pr({},q.properties):q.properties;const ue=this.points[q.index].properties,ve=this.options.map(ue);return K&&ve===ue?Pr({},ve):ve}}function wt(he,q,K,ue,ve){return{x:Wt(he),y:Wt(q),zoom:1/0,id:K,parentId:-1,numPoints:ue,properties:ve}}function Ii(he,q){const[K,ue]=he.geometry.coordinates;return{x:Wt(gt(K)),y:Wt(Si(ue)),zoom:1/0,index:q,parentId:-1}}function dn(he){return{type:"Feature",id:he.id,properties:$t(he),geometry:{type:"Point",coordinates:[(q=he.x,360*(q-.5)),Pi(he.y)]}};var q}function $t(he){const q=he.numPoints,K=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q;return Pr(Pr({},he.properties),{cluster:!0,cluster_id:he.id,point_count:q,point_count_abbreviated:K})}function gt(he){return he/360+.5}function Si(he){const q=Math.sin(he*Math.PI/180),K=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return K<0?0:K>1?1:K}function Pi(he){const q=(180-360*he)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function Pr(he,q){for(const K in q)he[K]=q[K];return he}function Ir(he){return he.x}function Ji(he){return he.y}function jn(he,q,K,ue){for(var ve,Ce=ue,qe=K-q>>1,Fe=K-q,Re=he[q],Ke=he[q+1],vt=he[K],Xt=he[K+1],Dt=q+3;Dt<K;Dt+=3){var Mi=sr(he[Dt],he[Dt+1],Re,Ke,vt,Xt);if(Mi>Ce)ve=Dt,Ce=Mi;else if(Mi===Ce){var gi=Math.abs(Dt-qe);gi<Fe&&(ve=Dt,Fe=gi)}}Ce>ue&&(ve-q>3&&jn(he,q,ve,ue),he[ve+2]=Ce,K-ve>3&&jn(he,ve,K,ue))}function sr(he,q,K,ue,ve,Ce){var qe=ve-K,Fe=Ce-ue;if(qe!==0||Fe!==0){var Re=((he-K)*qe+(q-ue)*Fe)/(qe*qe+Fe*Fe);Re>1?(K=ve,ue=Ce):Re>0&&(K+=qe*Re,ue+=Fe*Re)}return(qe=he-K)*qe+(Fe=q-ue)*Fe}function Be(he,q,K,ue){var ve={id:he===void 0?null:he,type:q,geometry:K,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ce){var qe=Ce.geometry,Fe=Ce.type;if(Fe==="Point"||Fe==="MultiPoint"||Fe==="LineString")li(Ce,qe);else if(Fe==="Polygon"||Fe==="MultiLineString")for(var Re=0;Re<qe.length;Re++)li(Ce,qe[Re]);else if(Fe==="MultiPolygon")for(Re=0;Re<qe.length;Re++)for(var Ke=0;Ke<qe[Re].length;Ke++)li(Ce,qe[Re][Ke])}(ve),ve}function li(he,q){for(var K=0;K<q.length;K+=3)he.minX=Math.min(he.minX,q[K]),he.minY=Math.min(he.minY,q[K+1]),he.maxX=Math.max(he.maxX,q[K]),he.maxY=Math.max(he.maxY,q[K+1])}function qi(he,q,K,ue){if(q.geometry){var ve=q.geometry.coordinates,Ce=q.geometry.type,qe=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),Fe=[],Re=q.id;if(K.promoteId?Re=q.properties[K.promoteId]:K.generateId&&(Re=ue||0),Ce==="Point")Ci(ve,Fe);else if(Ce==="MultiPoint")for(var Ke=0;Ke<ve.length;Ke++)Ci(ve[Ke],Fe);else if(Ce==="LineString")Jt(ve,Fe,qe,!1);else if(Ce==="MultiLineString"){if(K.lineMetrics){for(Ke=0;Ke<ve.length;Ke++)Jt(ve[Ke],Fe=[],qe,!1),he.push(Be(Re,"LineString",Fe,q.properties));return}nn(ve,Fe,qe,!1)}else if(Ce==="Polygon")nn(ve,Fe,qe,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(Ke=0;Ke<q.geometry.geometries.length;Ke++)qi(he,{id:Re,geometry:q.geometry.geometries[Ke],properties:q.properties},K,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ke=0;Ke<ve.length;Ke++){var vt=[];nn(ve[Ke],vt,qe,!0),Fe.push(vt)}}he.push(Be(Re,Ce,Fe,q.properties))}}function Ci(he,q){q.push(vs(he[0])),q.push(yt(he[1])),q.push(0)}function Jt(he,q,K,ue){for(var ve,Ce,qe=0,Fe=0;Fe<he.length;Fe++){var Re=vs(he[Fe][0]),Ke=yt(he[Fe][1]);q.push(Re),q.push(Ke),q.push(0),Fe>0&&(qe+=ue?(ve*Ke-Re*Ce)/2:Math.sqrt(Math.pow(Re-ve,2)+Math.pow(Ke-Ce,2))),ve=Re,Ce=Ke}var vt=q.length-3;q[2]=1,jn(q,0,vt,K),q[vt+2]=1,q.size=Math.abs(qe),q.start=0,q.end=q.size}function nn(he,q,K,ue){for(var ve=0;ve<he.length;ve++){var Ce=[];Jt(he[ve],Ce,K,ue),q.push(Ce)}}function vs(he){return he/360+.5}function yt(he){var q=Math.sin(he*Math.PI/180),K=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return K<0?0:K>1?1:K}function fi(he,q,K,ue,ve,Ce,qe,Fe){if(ue/=q,Ce>=(K/=q)&&qe<ue)return he;if(qe<K||Ce>=ue)return null;for(var Re=[],Ke=0;Ke<he.length;Ke++){var vt=he[Ke],Xt=vt.geometry,Dt=vt.type,Mi=ve===0?vt.minX:vt.minY,gi=ve===0?vt.maxX:vt.maxY;if(Mi>=K&&gi<ue)Re.push(vt);else if(!(gi<K||Mi>=ue)){var yi=[];if(Dt==="Point"||Dt==="MultiPoint")xi(Xt,yi,K,ue,ve);else if(Dt==="LineString")yn(Xt,yi,K,ue,ve,!1,Fe.lineMetrics);else if(Dt==="MultiLineString")js(Xt,yi,K,ue,ve,!1);else if(Dt==="Polygon")js(Xt,yi,K,ue,ve,!0);else if(Dt==="MultiPolygon")for(var Le=0;Le<Xt.length;Le++){var hi=[];js(Xt[Le],hi,K,ue,ve,!0),hi.length&&yi.push(hi)}if(yi.length){if(Fe.lineMetrics&&Dt==="LineString"){for(Le=0;Le<yi.length;Le++)Re.push(Be(vt.id,Dt,yi[Le],vt.tags));continue}Dt!=="LineString"&&Dt!=="MultiLineString"||(yi.length===1?(Dt="LineString",yi=yi[0]):Dt="MultiLineString"),Dt!=="Point"&&Dt!=="MultiPoint"||(Dt=yi.length===3?"Point":"MultiPoint"),Re.push(Be(vt.id,Dt,yi,vt.tags))}}}return Re.length?Re:null}function xi(he,q,K,ue,ve){for(var Ce=0;Ce<he.length;Ce+=3){var qe=he[Ce+ve];qe>=K&&qe<=ue&&(q.push(he[Ce]),q.push(he[Ce+1]),q.push(he[Ce+2]))}}function yn(he,q,K,ue,ve,Ce,qe){for(var Fe,Re,Ke=ls(he),vt=ve===0?bo:cs,Xt=he.start,Dt=0;Dt<he.length-3;Dt+=3){var Mi=he[Dt],gi=he[Dt+1],yi=he[Dt+2],Le=he[Dt+3],hi=he[Dt+4],Pn=ve===0?Mi:gi,Oi=ve===0?Le:hi,wn=!1;qe&&(Fe=Math.sqrt(Math.pow(Mi-Le,2)+Math.pow(gi-hi,2))),Pn<K?Oi>K&&(Re=vt(Ke,Mi,gi,Le,hi,K),qe&&(Ke.start=Xt+Fe*Re)):Pn>ue?Oi<ue&&(Re=vt(Ke,Mi,gi,Le,hi,ue),qe&&(Ke.start=Xt+Fe*Re)):Xo(Ke,Mi,gi,yi),Oi<K&&Pn>=K&&(Re=vt(Ke,Mi,gi,Le,hi,K),wn=!0),Oi>ue&&Pn<=ue&&(Re=vt(Ke,Mi,gi,Le,hi,ue),wn=!0),!Ce&&wn&&(qe&&(Ke.end=Xt+Fe*Re),q.push(Ke),Ke=ls(he)),qe&&(Xt+=Fe)}var In=he.length-3;Mi=he[In],gi=he[In+1],yi=he[In+2],(Pn=ve===0?Mi:gi)>=K&&Pn<=ue&&Xo(Ke,Mi,gi,yi),In=Ke.length-3,Ce&&In>=3&&(Ke[In]!==Ke[0]||Ke[In+1]!==Ke[1])&&Xo(Ke,Ke[0],Ke[1],Ke[2]),Ke.length&&q.push(Ke)}function ls(he){var q=[];return q.size=he.size,q.start=he.start,q.end=he.end,q}function js(he,q,K,ue,ve,Ce){for(var qe=0;qe<he.length;qe++)yn(he[qe],q,K,ue,ve,Ce,!1)}function Xo(he,q,K,ue){he.push(q),he.push(K),he.push(ue)}function bo(he,q,K,ue,ve,Ce){var qe=(Ce-q)/(ue-q);return he.push(Ce),he.push(K+(ve-K)*qe),he.push(1),qe}function cs(he,q,K,ue,ve,Ce){var qe=(Ce-K)/(ve-K);return he.push(q+(ue-q)*qe),he.push(Ce),he.push(1),qe}function ho(he,q){for(var K=[],ue=0;ue<he.length;ue++){var ve,Ce=he[ue],qe=Ce.type;if(qe==="Point"||qe==="MultiPoint"||qe==="LineString")ve=La(Ce.geometry,q);else if(qe==="MultiLineString"||qe==="Polygon"){ve=[];for(var Fe=0;Fe<Ce.geometry.length;Fe++)ve.push(La(Ce.geometry[Fe],q))}else if(qe==="MultiPolygon")for(ve=[],Fe=0;Fe<Ce.geometry.length;Fe++){for(var Re=[],Ke=0;Ke<Ce.geometry[Fe].length;Ke++)Re.push(La(Ce.geometry[Fe][Ke],q));ve.push(Re)}K.push(Be(Ce.id,qe,ve,Ce.tags))}return K}function La(he,q){var K=[];K.size=he.size,he.start!==void 0&&(K.start=he.start,K.end=he.end);for(var ue=0;ue<he.length;ue+=3)K.push(he[ue]+q,he[ue+1],he[ue+2]);return K}function qs(he,q){if(he.transformed)return he;var K,ue,ve,Ce=1<<he.z,qe=he.x,Fe=he.y;for(K=0;K<he.features.length;K++){var Re=he.features[K],Ke=Re.geometry,vt=Re.type;if(Re.geometry=[],vt===1)for(ue=0;ue<Ke.length;ue+=2)Re.geometry.push(ua(Ke[ue],Ke[ue+1],q,Ce,qe,Fe));else for(ue=0;ue<Ke.length;ue++){var Xt=[];for(ve=0;ve<Ke[ue].length;ve+=2)Xt.push(ua(Ke[ue][ve],Ke[ue][ve+1],q,Ce,qe,Fe));Re.geometry.push(Xt)}}return he.transformed=!0,he}function ua(he,q,K,ue,ve,Ce){return[Math.round(K*(he*ue-ve)),Math.round(K*(q*ue-Ce))]}function Dl(he,q,K,ue,ve){for(var Ce=q===ve.maxZoom?0:ve.tolerance/((1<<q)*ve.extent),qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:K,y:ue,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Fe=0;Fe<he.length;Fe++){qe.numFeatures++,Da(qe,he[Fe],Ce,ve);var Re=he[Fe].minX,Ke=he[Fe].minY,vt=he[Fe].maxX,Xt=he[Fe].maxY;Re<qe.minX&&(qe.minX=Re),Ke<qe.minY&&(qe.minY=Ke),vt>qe.maxX&&(qe.maxX=vt),Xt>qe.maxY&&(qe.maxY=Xt)}return qe}function Da(he,q,K,ue){var ve=q.geometry,Ce=q.type,qe=[];if(Ce==="Point"||Ce==="MultiPoint")for(var Fe=0;Fe<ve.length;Fe+=3)qe.push(ve[Fe]),qe.push(ve[Fe+1]),he.numPoints++,he.numSimplified++;else if(Ce==="LineString")Ko(qe,ve,he,K,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(Fe=0;Fe<ve.length;Fe++)Ko(qe,ve[Fe],he,K,Ce==="Polygon",Fe===0);else if(Ce==="MultiPolygon")for(var Re=0;Re<ve.length;Re++){var Ke=ve[Re];for(Fe=0;Fe<Ke.length;Fe++)Ko(qe,Ke[Fe],he,K,!0,Fe===0)}if(qe.length){var vt=q.tags||null;if(Ce==="LineString"&&ue.lineMetrics){for(var Xt in vt={},q.tags)vt[Xt]=q.tags[Xt];vt.mapbox_clip_start=ve.start/ve.size,vt.mapbox_clip_end=ve.end/ve.size}var Dt={geometry:qe,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:vt};q.id!==null&&(Dt.id=q.id),he.features.push(Dt)}}function Ko(he,q,K,ue,ve,Ce){var qe=ue*ue;if(ue>0&&q.size<(ve?qe:ue))K.numPoints+=q.length/3;else{for(var Fe=[],Re=0;Re<q.length;Re+=3)(ue===0||q[Re+2]>qe)&&(K.numSimplified++,Fe.push(q[Re]),Fe.push(q[Re+1])),K.numPoints++;ve&&function(Ke,vt){for(var Xt=0,Dt=0,Mi=Ke.length,gi=Mi-2;Dt<Mi;gi=Dt,Dt+=2)Xt+=(Ke[Dt]-Ke[gi])*(Ke[Dt+1]+Ke[gi+1]);if(Xt>0===vt)for(Dt=0,Mi=Ke.length;Dt<Mi/2;Dt+=2){var yi=Ke[Dt],Le=Ke[Dt+1];Ke[Dt]=Ke[Mi-2-Dt],Ke[Dt+1]=Ke[Mi-1-Dt],Ke[Mi-2-Dt]=yi,Ke[Mi-1-Dt]=Le}}(Fe,Ce),he.push(Fe)}}function Pa(he,q){var K=(q=this.options=function(ve,Ce){for(var qe in Ce)ve[qe]=Ce[qe];return ve}(Object.create(this.options),q)).debug;if(K&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");var ue=function(ve,Ce){var qe=[];if(ve.type==="FeatureCollection")for(var Fe=0;Fe<ve.features.length;Fe++)qi(qe,ve.features[Fe],Ce,Fe);else qi(qe,ve.type==="Feature"?ve:{geometry:ve},Ce);return qe}(he,q);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ue=function(ve,Ce){var qe=Ce.buffer/Ce.extent,Fe=ve,Re=fi(ve,1,-1-qe,qe,0,-1,2,Ce),Ke=fi(ve,1,1-qe,2+qe,0,-1,2,Ce);return(Re||Ke)&&(Fe=fi(ve,1,-qe,1+qe,0,-1,2,Ce)||[],Re&&(Fe=ho(Re,1).concat(Fe)),Ke&&(Fe=Fe.concat(ho(Ke,-1)))),Fe}(ue,q),ue.length&&this.splitTile(ue,0,0,0),K&&(ue.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function xs(he,q,K){return 32*((1<<he)*K+q)+he}function ha(he,q){const K=he.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);const ue=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!ue)return q(null,null);const ve=new Ie(ue.features);let Ce=ye(ve);Ce.byteOffset===0&&Ce.byteLength===Ce.buffer.byteLength||(Ce=new Uint8Array(Ce)),q(null,{vectorTile:ve,rawData:Ce.buffer})}Pa.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Pa.prototype.splitTile=function(he,q,K,ue,ve,Ce,qe){for(var Fe=[he,q,K,ue],Re=this.options,Ke=Re.debug;Fe.length;){ue=Fe.pop(),K=Fe.pop(),q=Fe.pop(),he=Fe.pop();var vt=1<<q,Xt=xs(q,K,ue),Dt=this.tiles[Xt];if(!Dt&&(Ke>1&&console.time("creation"),Dt=this.tiles[Xt]=Dl(he,q,K,ue,Re),this.tileCoords.push({z:q,x:K,y:ue}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,K,ue,Dt.numFeatures,Dt.numPoints,Dt.numSimplified),console.timeEnd("creation"));var Mi="z"+q;this.stats[Mi]=(this.stats[Mi]||0)+1,this.total++}if(Dt.source=he,ve){if(q===Re.maxZoom||q===ve)continue;var gi=1<<ve-q;if(K!==Math.floor(Ce/gi)||ue!==Math.floor(qe/gi))continue}else if(q===Re.indexMaxZoom||Dt.numPoints<=Re.indexMaxPoints)continue;if(Dt.source=null,he.length!==0){Ke>1&&console.time("clipping");var yi,Le,hi,Pn,Oi,wn,In=.5*Re.buffer/Re.extent,Yo=.5-In,Ys=.5+In,st=1+In;yi=Le=hi=Pn=null,Oi=fi(he,vt,K-In,K+Ys,0,Dt.minX,Dt.maxX,Re),wn=fi(he,vt,K+Yo,K+st,0,Dt.minX,Dt.maxX,Re),he=null,Oi&&(yi=fi(Oi,vt,ue-In,ue+Ys,1,Dt.minY,Dt.maxY,Re),Le=fi(Oi,vt,ue+Yo,ue+st,1,Dt.minY,Dt.maxY,Re),Oi=null),wn&&(hi=fi(wn,vt,ue-In,ue+Ys,1,Dt.minY,Dt.maxY,Re),Pn=fi(wn,vt,ue+Yo,ue+st,1,Dt.minY,Dt.maxY,Re),wn=null),Ke>1&&console.timeEnd("clipping"),Fe.push(yi||[],q+1,2*K,2*ue),Fe.push(Le||[],q+1,2*K,2*ue+1),Fe.push(hi||[],q+1,2*K+1,2*ue),Fe.push(Pn||[],q+1,2*K+1,2*ue+1)}}},Pa.prototype.getTile=function(he,q,K){var ue=this.options,ve=ue.extent,Ce=ue.debug;if(he<0||he>24)return null;var qe=1<<he,Fe=xs(he,q=(q%qe+qe)%qe,K);if(this.tiles[Fe])return qs(this.tiles[Fe],ve);Ce>1&&console.log("drilling down to z%d-%d-%d",he,q,K);for(var Re,Ke=he,vt=q,Xt=K;!Re&&Ke>0;)Ke--,vt=Math.floor(vt/2),Xt=Math.floor(Xt/2),Re=this.tiles[xs(Ke,vt,Xt)];return Re&&Re.source?(Ce>1&&console.log("found parent tile z%d-%d-%d",Ke,vt,Xt),Ce>1&&console.time("drilling down"),this.splitTile(Re.source,Ke,vt,Xt,he,q,K),Ce>1&&console.timeEnd("drilling down"),this.tiles[Fe]?qs(this.tiles[Fe],ve):null):null};class Ps extends r.VectorTileWorkerSource{constructor(q,K,ue,ve,Ce){super(q,K,ue,ve,ha),Ce&&(this.loadGeoJSON=Ce)}loadData(q,K){const ue=q&&q.request,ve=ue&&ue.collectResourceTiming;this.loadGeoJSON(q,(Ce,qe)=>{if(Ce||!qe)return K(Ce);if(typeof qe!="object")return K(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{Z(qe,!0);try{if(q.filter){const Re=r.createExpression(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Re.result==="error")throw new Error(Re.value.map(vt=>`${vt.key}: ${vt.message}`).join(", "));qe={type:"FeatureCollection",features:qe.features.filter(vt=>Re.value.evaluate({zoom:0},vt))}}this._geoJSONIndex=q.cluster?new It(function({superclusterOptions:Re,clusterProperties:Ke}){if(!Ke||!Re)return Re;const vt={},Xt={},Dt={accumulated:null,zoom:0},Mi={properties:null},gi=Object.keys(Ke);for(const yi of gi){const[Le,hi]=Ke[yi],Pn=r.createExpression(hi),Oi=r.createExpression(typeof Le=="string"?[Le,["accumulated"],["get",yi]]:Le);vt[yi]=Pn.value,Xt[yi]=Oi.value}return Re.map=yi=>{Mi.properties=yi;const Le={};for(const hi of gi)Le[hi]=vt[hi].evaluate(Dt,Mi);return Le},Re.reduce=(yi,Le)=>{Mi.properties=Le;for(const hi of gi)Dt.accumulated=yi[hi],yi[hi]=Xt[hi].evaluate(Dt,Mi)},Re}(q)).load(qe.features):function(Re,Ke){return new Pa(Re,Ke)}(qe,q.geojsonVtOptions)}catch(Re){return K(Re)}this.loaded={};const Fe={};if(ve){const Re=r.getPerformanceMeasurement(ue);Re&&(Fe.resourceTiming={},Fe.resourceTiming[q.source]=JSON.parse(JSON.stringify(Re)))}K(null,Fe)}})}reloadTile(q,K){const ue=this.loaded;return ue&&ue[q.uid]?super.reloadTile(q,K):this.loadTile(q,K)}loadGeoJSON(q,K){if(q.request)r.getJSON(q.request,K);else{if(typeof q.data!="string")return K(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(q.data))}catch{return K(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(q,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(ue){K(ue)}}getClusterChildren(q,K){try{K(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(ue){K(ue)}}getClusterLeaves(q,K){try{K(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(ue){K(ue)}}}class da{constructor(q){this.self=q,this.actor=new r.Actor(q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.getProjection({name:"mercator"}),this.workerSourceTypes={vector:r.VectorTileWorkerSource,geojson:Ps},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,ue)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=ue},this.self.registerRTLTextPlugin=K=>{if(r.plugin.isParsed())throw new Error("RTL text plugin already registered.");r.plugin.applyArabicShaping=K.applyArabicShaping,r.plugin.processBidirectionalText=K.processBidirectionalText,r.plugin.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(q,K,ue){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q],ue()}checkIfReady(q,K,ue){ue()}setReferrer(q,K){this.referrer=K}spriteLoaded(q,K){this.isSpriteLoaded[q]=K;for(const ue in this.workerSources[q]){const ve=this.workerSources[q][ue];for(const Ce in ve)ve[Ce]instanceof r.VectorTileWorkerSource&&(ve[Ce].isSpriteLoaded=K,ve[Ce].fire(new r.Event("isSpriteLoaded")))}}setImages(q,K,ue){this.availableImages[q]=K;for(const ve in this.workerSources[q]){const Ce=this.workerSources[q][ve];for(const qe in Ce)Ce[qe].availableImages=K}ue()}enableTerrain(q,K,ue){this.terrain=K,ue()}setProjection(q,K){this.projections[q]=r.getProjection(K)}setLayers(q,K,ue){this.getLayerIndex(q).replace(K),ue()}updateLayers(q,K,ue){this.getLayerIndex(q).update(K.layers,K.removedIds),ue()}loadTile(q,K,ue){const ve=this.enableTerrain?r.extend({enableTerrain:this.terrain},K):K;ve.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,K.type,K.source).loadTile(ve,ue)}loadDEMTile(q,K,ue){const ve=this.enableTerrain?r.extend({buildQuadTree:this.terrain},K):K;this.getDEMWorkerSource(q,K.source).loadTile(ve,ue)}reloadTile(q,K,ue){const ve=this.enableTerrain?r.extend({enableTerrain:this.terrain},K):K;ve.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,K.type,K.source).reloadTile(ve,ue)}abortTile(q,K,ue){this.getWorkerSource(q,K.type,K.source).abortTile(K,ue)}removeTile(q,K,ue){this.getWorkerSource(q,K.type,K.source).removeTile(K,ue)}removeSource(q,K,ue){if(!this.workerSources[q]||!this.workerSources[q][K.type]||!this.workerSources[q][K.type][K.source])return;const ve=this.workerSources[q][K.type][K.source];delete this.workerSources[q][K.type][K.source],ve.removeSource!==void 0?ve.removeSource(K,ue):ue()}loadWorkerSource(q,K,ue){try{this.self.importScripts(K.url),ue()}catch(ve){ue(ve.toString())}}syncRTLPluginState(q,K,ue){try{r.plugin.setState(K);const ve=r.plugin.getPluginURL();if(r.plugin.isLoaded()&&!r.plugin.isParsed()&&ve!=null){this.self.importScripts(ve);const Ce=r.plugin.isParsed();ue(Ce?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ve}`),Ce)}}catch(ve){ue(ve.toString())}}getAvailableImages(q){let K=this.availableImages[q];return K||(K=[]),K}getLayerIndex(q){let K=this.layerIndexes[q];return K||(K=this.layerIndexes[q]=new U),K}getWorkerSource(q,K,ue){if(this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][K]||(this.workerSources[q][K]={}),!this.workerSources[q][K][ue]){const ve={send:(Ce,qe,Fe,Re,Ke,vt)=>{this.actor.send(Ce,qe,Fe,q,Ke,vt)},scheduler:this.actor.scheduler};this.workerSources[q][K][ue]=new this.workerSourceTypes[K](ve,this.getLayerIndex(q),this.getAvailableImages(q),this.isSpriteLoaded[q])}return this.workerSources[q][K][ue]}getDEMWorkerSource(q,K){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][K]||(this.demWorkerSources[q][K]=new V),this.demWorkerSources[q][K]}enforceCacheSizeLimit(q,K){r.enforceCacheSizeLimit(K)}getWorkerPerformanceMetrics(q,K,ue){ue(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new da(self)),da}),v(["./shared"],function(r){function I(f,n){if(Array.isArray(f)){if(!Array.isArray(n)||f.length!==n.length)return!1;for(let c=0;c<f.length;c++)if(!I(f[c],n[c]))return!1;return!0}if(typeof f=="object"&&f!==null&&n!==null){if(typeof n!="object"||Object.keys(f).length!==Object.keys(n).length)return!1;for(const c in f)if(!I(f[c],n[c]))return!1;return!0}return f===n}var R=U;function U(f){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,x,w=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(w);try{x=new Worker(A),m=!0}catch{m=!1}return x&&x.terminate(),URL.revokeObjectURL(A),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var x=m.getContext("2d");if(!x)return!1;var w=x.getImageData(0,0,1,1);return w&&w.width===m.width}()?(V[c=n&&n.failIfMajorPerformanceCaveat]===void 0&&(V[c]=function(m){var x,w=function(A){var L=document.createElement("canvas"),P=Object.create(U.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=A,L.getContext("webgl",P)||L.getContext("experimental-webgl",P)}(m);if(!w)return!1;try{x=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!x||w.isContextLost())&&(w.shaderSource(x,"void main() {}"),w.compileShader(x),w.getShaderParameter(x,w.COMPILE_STATUS)===!0)}(c)),V[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(f)}var V={};function Z(f,n,c){const m=r.window.document.createElement(f);return n!==void 0&&(m.className=n),c&&c.appendChild(m),m}function Y(f,n,c){const m=r.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const x of Object.keys(n))m.setAttributeNS(null,x,n[x]);return c&&c.appendChild(m),m}U.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const W=r.window.document&&r.window.document.documentElement.style,te=W&&W.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ae;function Ie(){W&&te&&(ae=W[te],W[te]="none")}function ye(){W&&te&&(W[te]=ae)}function Ue(f){f.preventDefault(),f.stopPropagation(),r.window.removeEventListener("click",Ue,!0)}function je(){r.window.addEventListener("click",Ue,!0),r.window.setTimeout(()=>{r.window.removeEventListener("click",Ue,!0)},0)}function _e(f,n){const c=f.getBoundingClientRect();return St(f,c,n)}function ct(f,n){const c=f.getBoundingClientRect(),m=[];for(let x=0;x<n.length;x++)m.push(St(f,c,n[x]));return m}function lt(f){return r.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&r.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function St(f,n,c){const m=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new r.pointGeometry((c.clientX-n.left)*m,(c.clientY-n.top)*m)}function Bt(f,n){var c=n[0],m=n[1],x=n[2],w=n[3],A=c*w-x*m;return A?(f[0]=w*(A=1/A),f[1]=-m*A,f[2]=-x*A,f[3]=c*A,f):null}function et(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}class ot extends r.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new r.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:c,callback:m}of this.requestors)this._notify(c,m);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,c){this._validate(n,c)&&(this.images[n]=c)}_validate(n,c){let m=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new r.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),m=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new r.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),m=!1),this._validateContent(c.content,c)||(this.fire(new r.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),m=!1),m}_validateStretch(n,c){if(!n)return!0;let m=0;for(const x of n){if(x[0]<m||x[1]<x[0]||c<x[1])return!1;m=x[1]}return!0}_validateContent(n,c){return!(n&&(n.length!==4||n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,c){c.version=this.images[n].version+1,this.images[n]=c,this.updatedImages[n]=!0}removeImage(n){const c=this.images[n];delete this.images[n],delete this.patterns[n],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,c){let m=!0;if(!this.isLoaded())for(const x of n)this.images[x]||(m=!1);this.isLoaded()||m?this._notify(n,c):this.requestors.push({ids:n,callback:c})}_notify(n,c){const m={};for(const x of n){this.images[x]||this.fire(new r.Event("styleimagemissing",{id:x}));const w=this.images[x];w?m[x]={data:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)}:r.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,m)}getPixelSize(){const{width:n,height:c}=this.atlasImage;return{width:n,height:c}}getPattern(n){const c=this.patterns[n],m=this.getImage(n);if(!m)return null;if(c&&c.position.version===m.version)return c.position;if(c)c.position.version=m.version;else{const x={w:m.data.width+2,h:m.data.height+2,x:0,y:0},w=new r.ImagePosition(x,m);this.patterns[n]={bin:x,position:w}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const c=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new r.Texture(n,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const w in this.patterns)n.push(this.patterns[w].bin);const{w:c,h:m}=r.potpack(n),x=this.atlasImage;x.resize({width:c||1,height:m||1});for(const w in this.patterns){const{bin:A}=this.patterns[w],L=A.x+1,P=A.y+1,B=this.images[w].data,F=B.width,H=B.height;r.RGBAImage.copy(B,x,{x:0,y:0},{x:L,y:P},{width:F,height:H}),r.RGBAImage.copy(B,x,{x:0,y:H-1},{x:L,y:P-1},{width:F,height:1}),r.RGBAImage.copy(B,x,{x:0,y:0},{x:L,y:P+H},{width:F,height:1}),r.RGBAImage.copy(B,x,{x:F-1,y:0},{x:L-1,y:P},{width:1,height:H}),r.RGBAImage.copy(B,x,{x:0,y:0},{x:L+F,y:P},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const c of n){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const m=this.images[c];et(m)&&this.updateImage(c,m)}}}const Nt=new r.Properties({anchor:new r.DataConstantProperty(r.spec.light.anchor),position:new class{constructor(){this.specification=r.spec.light.position}possiblyEvaluate(f,n){return function([c,m,x]){const w=r.degToRad(m+90),A=r.degToRad(x);return{x:c*Math.cos(w)*Math.sin(A),y:c*Math.sin(w)*Math.sin(A),z:c*Math.cos(A),azimuthal:m,polar:x}}(f.expression.evaluate(n))}interpolate(f,n,c){return{x:r.number(f.x,n.x,c),y:r.number(f.y,n.y,c),z:r.number(f.z,n.z,c),azimuthal:r.number(f.azimuthal,n.azimuthal,c),polar:r.number(f.polar,n.polar,c)}}},color:new r.DataConstantProperty(r.spec.light.color),intensity:new r.DataConstantProperty(r.spec.light.intensity)}),qt="-transition";class _t extends r.Evented{constructor(n){super(),this._transitionable=new r.Transitionable(Nt),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c={}){if(!this._validate(r.validateLight,n,c))for(const m in n){const x=n[m];r.endsWith(m,qt)?this._transitionable.setTransition(m.slice(0,-qt.length),x):this._transitionable.setValue(m,x)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,m){return(!m||m.validate!==!1)&&r.emitValidationErrors(this,n.call(r.validateStyle,r.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}const dt=new r.Properties({source:new r.DataConstantProperty(r.spec.terrain.source),exaggeration:new r.DataConstantProperty(r.spec.terrain.exaggeration)}),ti="-transition";class Vi extends r.Evented{constructor(n,c){super(),this._transitionable=new r.Transitionable(dt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(n){for(const c in n){const m=n[c];r.endsWith(c,ti)?this._transitionable.setTransition(c.slice(0,-ti.length),m):this._transitionable.setValue(c,m)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function Gt(f,n,c,m){const x=r.smoothstep(45,65,c),[w,A]=Yi(f,m),L=r.length(n);let P=1-Math.min(1,Math.exp((L-w)/(A-w)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*x*f.alpha}function Yi(f,n){const c=.5/Math.tan(.5*n);return[f.range[0]+c,f.range[1]+c]}const Gi=new r.Properties({range:new r.DataConstantProperty(r.spec.fog.range),color:new r.DataConstantProperty(r.spec.fog.color),"high-color":new r.DataConstantProperty(r.spec.fog["high-color"]),"space-color":new r.DataConstantProperty(r.spec.fog["space-color"]),"horizon-blend":new r.DataConstantProperty(r.spec.fog["horizon-blend"]),"star-intensity":new r.DataConstantProperty(r.spec.fog["star-intensity"])}),ki="-transition";class Ni extends r.Evented{constructor(n,c){super(),this._transitionable=new r.Transitionable(Gi),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const n=this._transform,c=n.projection.name==="globe",m=r.globeToMercatorTransition(n.zoom),x=this.properties.get("range"),w=[.5,3];return{range:c?[r.number(w[0],x[0],m),r.number(w[1],x[1],m)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c={}){if(!this._validate(r.validateFog,n,c)){for(const m of Object.keys(r.spec.fog))n&&n[m]===void 0&&(n[m]=r.spec.fog[m].default);for(const m in n){const x=n[m];r.endsWith(m,ki)?this._transitionable.setTransition(m.slice(0,-ki.length),x):this._transitionable.setValue(m,x)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.smoothstep(45,65,n))*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?function(m,x,w){const A=r.MercatorCoordinate.fromLngLat(x),L=w.elevation?w.elevation.getAtPointOrZero(A):0,P=[A.x,A.y,L];return r.transformMat4(P,P,w.mercatorFogMatrix),Gt(m,P,w.pitch,w._fov)}(this.state,n,c):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Yi(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,m){return(!m||m.validate!==!1)&&r.emitValidationErrors(this,n.call(r.validateStyle,r.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}class Dn{constructor(n,c){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=r.uniqueId();const m=this.workerPool.acquire(this.id);for(let x=0;x<m.length;x++){const w=new Dn.Actor(m[x],c,this.id);w.name=`Worker ${x}`,this.actors.push(w)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,c,m){r.asyncAll(this.actors,(x,w)=>{x.send(n,c,w)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function bn(f,n,c){return n*(r.EXTENT/(f.tileSize*Math.pow(2,c-f.tileID.overscaledZ)))}Dn.Actor=r.Actor;class ui{constructor(n,c,m,x){this.screenBounds=n,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,x)}static createFromScreenPoints(n,c){let m,x;if(n instanceof r.pointGeometry||typeof n[0]=="number"){const w=r.pointGeometry.convert(n);m=[w],x=c.isPointAboveHorizon(w)}else{const w=r.pointGeometry.convert(n[0]),A=r.pointGeometry.convert(n[1]);m=[w,A],x=r.polygonizeBounds(w,A).every(L=>c.isPointAboveHorizon(L))}return new ui(m,c.getCameraPoint(),x,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return r.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new r.pointGeometry(1,1)):this.screenBounds[1],x=r.polygonizeBounds(c,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<m.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),r.bufferConvexPolygon(x,n)}bufferedCameraGeometryGlobe(n){const c=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new r.pointGeometry(1,1)):this.screenBounds[1],x=r.polygonizeBounds(c,m,n),w=this.cameraPoint.clone();switch(3*((w.y>c.y)+(w.y>m.y))+((w.x>c.x)+(w.x>m.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(n,c,m,x=0){const w=n.queryPadding/c._pixelsPerMercatorPixel+1,A=m?this._bufferedCameraMercator(w,c):this._bufferedScreenMercator(w,c);let L=n.tileID.wrap+(A.unwrapped?x:0);const P=A.polygon.map(le=>r.getTilePoint(n.tileTransform,le,L));if(!r.polygonIntersectsBox(P,0,0,r.EXTENT,r.EXTENT))return;L=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const B=this.screenGeometryMercator.polygon.map(le=>r.getTileVec3(n.tileTransform,le,L)),F=B.map(le=>new r.pointGeometry(le[0],le[1])),H=c.getFreeCameraOptions().position||new r.MercatorCoordinate(0,0,0),ee=r.getTileVec3(n.tileTransform,H,L),se=B.map(le=>{const J=r.sub(le,le,ee);return r.normalize(J,J),new r.Ray(ee,J)}),re=bn(n,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:se,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(oe=r.getBounds(P),oe.min.x=r.clamp(oe.min.x,0,r.EXTENT),oe.min.y=r.clamp(oe.min.y,0,r.EXTENT),oe.max.x=r.clamp(oe.max.x,0,r.EXTENT),oe.max.y=r.clamp(oe.max.y,0,r.EXTENT),oe),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:re};var oe}_bufferedScreenMercator(n,c){const m=Wt(n);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),c):{polygon:this.bufferedScreenGeometry(n).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[m]=x,x}}_bufferedCameraMercator(n,c){const m=Wt(n);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),c):{polygon:this.bufferedCameraGeometry(n).map(w=>c.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[m]=x,x}}_projectAndResample(n,c){const m=function(w,A){const L=r.multiply([],A.pixelMatrix,A.globeMatrix),P=[0,-r.GLOBE_RADIUS,0,1],B=[0,r.GLOBE_RADIUS,0,1],F=[0,0,0,1];r.transformMat4$1(P,P,L),r.transformMat4$1(B,B,L),r.transformMat4$1(F,F,L);const H=new r.pointGeometry(P[0]/P[3],P[1]/P[3]),ee=new r.pointGeometry(B[0]/B[3],B[1]/B[3]),se=r.polygonContainsPoint(w,H)&&P[3]<F[3],re=r.polygonContainsPoint(w,ee)&&B[3]<F[3];if(!se&&!re)return null;const oe=function(De,He,We){for(let Qe=1;Qe<De.length;Qe++){const Ut=Ei(He.pointCoordinate3D(De[Qe-1]).x),Xe=Ei(He.pointCoordinate3D(De[Qe]).x);if(We<0){if(Ut<Xe)return{idx:Qe,t:-Ut/(Xe-1-Ut)}}else if(Xe<Ut)return{idx:Qe,t:(1-Ut)/(Xe+1-Ut)}}return null}(w,A,se?-1:1);if(!oe)return null;const{idx:le,t:J}=oe;let me=le>1?Wi(w.slice(0,le),A):[],fe=le<w.length?Wi(w.slice(le),A):[];me=me.map(De=>new r.pointGeometry(Ei(De.x),De.y)),fe=fe.map(De=>new r.pointGeometry(Ei(De.x),De.y));const ge=[...me];ge.length===0&&ge.push(fe[fe.length-1]);const Ae=r.number(ge[ge.length-1].y,(fe.length===0?me[0]:fe[0]).y,J);let Te;return Te=se?[new r.pointGeometry(0,Ae),new r.pointGeometry(0,0),new r.pointGeometry(1,0),new r.pointGeometry(1,Ae)]:[new r.pointGeometry(1,Ae),new r.pointGeometry(1,1),new r.pointGeometry(0,1),new r.pointGeometry(0,Ae)],ge.push(...Te),fe.length===0?ge.push(me[0]):ge.push(...fe),{polygon:ge.map(De=>new r.MercatorCoordinate(De.x,De.y)),unwrapped:!1}}(n,c);if(m)return m;const x=function(w,A){let L=!1,P=-1/0,B=0;for(let H=0;H<w.length-1;H++)w[H].x>P&&(P=w[H].x,B=H);for(let H=0;H<w.length-1;H++){const ee=(B+H)%(w.length-1),se=w[ee],re=w[ee+1];Math.abs(se.x-re.x)>.5&&(se.x<re.x?(se.x+=1,ee===0&&(w[w.length-1].x+=1)):(re.x+=1,ee+1===w.length-1&&(w[0].x+=1)),L=!0)}const F=r.mercatorXfromLng(A.center.lng);return L&&F<Math.abs(F-1)&&w.forEach(H=>{H.x-=1}),{polygon:w,unwrapped:L}}(Wi(n,c).map(w=>new r.pointGeometry(Ei(w.x),w.y)),c);return{polygon:x.polygon.map(w=>new r.MercatorCoordinate(w.x,w.y)),unwrapped:x.unwrapped}}}function Wi(f,n){return r.resample(f,c=>{const m=n.pointCoordinate3D(c);c.x=m.x,c.y=m.y},1/256)}function Ei(f){return f<0?1+f%1:f%1}function Wt(f){return 100*f|0}function Vn(f,n,c,m,x){const w=function(A,L){if(A)return x(A);if(L){f.url&&L.tiles&&f.tiles&&delete f.tiles;const P=r.pick(r.extend(L,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);L.vector_layers&&(P.vectorLayers=L.vector_layers,P.vectorLayerIds=P.vectorLayers.map(B=>B.id)),P.tiles=n.canonicalizeTileset(P,f.url),x(null,P)}};return f.url?r.getJSON(n.transformRequest(n.normalizeSourceURL(f.url,null,c,m),r.ResourceType.Source),w):r.exported.frame(()=>w(null,f))}class It{constructor(n,c,m){this.bounds=r.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=c||0,this.maxzoom=m||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const c=Math.pow(2,n.z),m=Math.floor(r.mercatorXfromLng(this.bounds.getWest())*c),x=Math.floor(r.mercatorYfromLat(this.bounds.getNorth())*c),w=Math.ceil(r.mercatorXfromLng(this.bounds.getEast())*c),A=Math.ceil(r.mercatorYfromLat(this.bounds.getSouth())*c);return n.x>=m&&n.x<w&&n.y>=x&&n.y<A}}class wt{constructor(n,c,m){this.context=n;const x=n.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ii={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class dn{constructor(n,c,m,x){this.length=c.length,this.attributes=m,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.context=n;const w=n.gl;this.buffer=w.createBuffer(),n.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let m=0;m<this.attributes.length;m++){const x=c.attributes[this.attributes[m].name];x!==void 0&&n.enableVertexAttribArray(x)}}setVertexAttribPointers(n,c,m){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],A=c.attributes[w.name];A!==void 0&&n.vertexAttribPointer(A,w.components,n[Ii[w.type]],!1,this.itemSize,w.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $t{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class gt extends $t{getDefault(){return r.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Si extends $t{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Pi extends $t{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Pr extends $t{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Ir extends $t{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ji extends $t{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class jn extends $t{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class sr extends $t{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Be extends $t{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class li extends $t{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class qi extends $t{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class Ci extends $t{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Jt extends $t{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class nn extends $t{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class vs extends $t{getDefault(){return r.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class yt extends $t{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class fi extends $t{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class xi extends $t{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class yn extends $t{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class ls extends $t{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class js extends $t{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Xo extends $t{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class bo extends $t{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class cs extends $t{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class ho extends $t{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class La extends $t{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class qs extends $t{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ua extends $t{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class Dl extends $t{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class Da extends $t{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Ko extends $t{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Pa extends $t{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class xs extends Pa{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class ha extends Pa{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Ps extends ha{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class da{constructor(n,c,m,x){this.context=n,this.width=c,this.height=m;const w=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new xs(n,w),x&&(this.depthAttachment=new ha(n,w))}destroy(){const n=this.context.gl,c=this.colorAttachment.get();if(c&&n.deleteTexture(c),this.depthAttachment){const m=this.depthAttachment.get();m&&n.deleteRenderbuffer(m)}n.deleteFramebuffer(this.framebuffer)}}class he{constructor(n,c=!1){if(this.gl=n,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const m=n;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(n),deleteVertexArrayOES:m.deleteVertexArray.bind(n),bindVertexArrayOES:m.bindVertexArray.bind(n)}}this.clearColor=new gt(this),this.clearDepth=new Si(this),this.clearStencil=new Pi(this),this.colorMask=new Pr(this),this.depthMask=new Ir(this),this.stencilMask=new Ji(this),this.stencilFunc=new jn(this),this.stencilOp=new sr(this),this.stencilTest=new Be(this),this.depthRange=new li(this),this.depthTest=new qi(this),this.depthFunc=new Ci(this),this.blend=new Jt(this),this.blendFunc=new nn(this),this.blendColor=new vs(this),this.blendEquation=new yt(this),this.cullFace=new fi(this),this.cullFaceSide=new xi(this),this.frontFace=new yn(this),this.program=new ls(this),this.activeTexture=new js(this),this.viewport=new Xo(this),this.bindFramebuffer=new bo(this),this.bindRenderbuffer=new cs(this),this.bindTexture=new ho(this),this.bindVertexBuffer=new La(this),this.bindElementBuffer=new qs(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ua(this),this.pixelStoreUnpack=new Dl(this),this.pixelStoreUnpackPremultiplyAlpha=new Da(this),this.pixelStoreUnpackFlipY=new Ko(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c){return new wt(this,n,c)}createVertexBuffer(n,c,m){return new dn(this,n,c,m)}createRenderbuffer(n,c,m){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,n,c,m),this.bindRenderbuffer.set(null),w}createFramebuffer(n,c,m){return new da(this,n,c,m)}clear({color:n,depth:c,stencil:m}){const x=this.gl;let w=0;n&&(w|=x.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(w|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),m!==void 0&&(w|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),x.clear(w)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){I(n.blendFunction,r.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class q extends r.Evented{constructor(n,c,m,x){if(super(),this.id=n,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.extend(this,r.pick(c,["url","scheme","tileSize","promoteId"])),this._options=r.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new r.DedupedRequest}load(n){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=Vn(this._options,this.map._requestManager,c,m,(x,w)=>{this._tileJSONRequest=null,this._loaded=!0,x?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new r.ErrorEvent(x))):w&&(r.extend(this,w),w.bounds&&(this.tileBounds=new It(w.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(w.tiles,this.map._requestManager._customAccessToken),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(x)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.extend({},this._options)}loadTile(n,c){const m=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),x={request:this.map._requestManager.transformRequest(m,r.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(x.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=c:n.request=n.actor.send("reloadTile",x,w.bind(this));else if(n.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",x,w.bind(this),void 0,!0);else{const A=r.loadVectorTile.call({deduped:this._deduped},x,(L,P)=>{L||!P?w.call(this,L):(x.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},n.actor&&n.actor.send("loadTile",x,w.bind(this),void 0,!0))},!0);n.request={cancel:A}}function w(A,L){return delete n.request,n.aborted?c(null):A&&A.status!==404?c(A):(L&&L.resourceTiming&&(n.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&n.setExpiryData(L),n.loadVectorData(L,this.map.painter),r.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class K extends r.Evented{constructor(n,c,m,x){super(),this.id=n,this.dispatcher=m,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.extend({type:"raster"},c),r.extend(this,r.pick(c,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Vn(this._options,this.map._requestManager,null,null,(c,m)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new r.ErrorEvent(c)):m&&(r.extend(this,m),m.bounds&&(this.tileBounds=new It(m.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(m.tiles),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(c)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const m=r.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);n.request=r.getImage(this.map._requestManager.transformRequest(x,r.ResourceType.Tile),(w,A,L,P)=>(delete n.request,n.aborted?(n.state="unloaded",c(null)):w?(n.state="errored",c(w)):A?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:L,expires:P}),n.setTexture(A,this.map.painter),n.state="loaded",r.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(n,c,m){n.setTexture(c,m)}static unloadTileData(n,c){n.texture&&c.saveTileTexture(n.texture)}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c()}unloadTile(n,c){n.texture&&this.map.painter.saveTileTexture(n.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let ue;function ve(f,n,c,m,x,w,A,L){const P=[f,c,x,n,m,w,1,1,1],B=[A,L,1],F=r.adjoint([],P),[H,ee,se]=r.transformMat3(B,B,r.transpose(F,F));return r.multiply$1(P,[H,0,0,0,ee,0,0,0,se],P)}class Ce extends r.Evented{constructor(n,c,m,x){super(),this.id=n,this.dispatcher=m,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=c,this._dirty=!1}load(n,c){this._loaded=c||!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=r.getImage(this.map._requestManager.transformRequest(this.url,r.ResourceType.Image),(m,x)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new r.ErrorEvent(m));else if(x){const{HTMLImageElement:w}=r.window;this.image=x instanceof w?r.exported.getImageData(x):x,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const c=n.map(r.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let x=1/0,w=1/0,A=-1/0,L=-1/0;for(const H of m)x=Math.min(x,H.x),w=Math.min(w,H.y),A=Math.max(A,H.x),L=Math.max(L,H.y);const P=Math.max(A-x,L-w),B=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),F=Math.pow(2,B);return new r.CanonicalTileID(B,Math.floor((x+A)/2*F),Math.floor((w+L)/2*F))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const P in this.tiles){const B=this.tiles[P];B.state!=="loaded"&&(B.state="loaded",B.texture=this.texture)}if(this._boundsArray)return;const c=r.tileTransform(this.tileID,this.map.transform.projection),[m,x,w,A]=this.coordinates.map(P=>{const B=c.projection.project(P[0],P[1]);return r.getTilePoint(c,B)._round()});this.perspectiveTransform=function(P,B,F,H,ee,se,re,oe,le,J){const me=ve(0,0,P,0,0,B,P,B),fe=ve(F,H,ee,se,re,oe,le,J);return r.multiply$1(fe,r.adjoint(me,me),fe),[fe[6]/fe[8]*P/r.EXTENT,fe[7]/fe[8]*B/r.EXTENT]}(this.width,this.height,m.x,m.y,x.x,x.y,A.x,A.y,w.x,w.y);const L=this._boundsArray=new r.StructArrayLayout4i8;L.emplaceBack(m.x,m.y,0,0),L.emplaceBack(x.x,x.y,r.EXTENT,0),L.emplaceBack(A.x,A.y,0,r.EXTENT),L.emplaceBack(w.x,w.y,r.EXTENT,r.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(L,r.boundsAttributes.members),this.boundsSegments=r.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,c=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new r.Texture(n,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,c){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},c(null)):(n.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const qe={vector:q,raster:K,"raster-dem":class extends K{constructor(f,n,c,m){super(f,n,c,m),this.type="raster-dem",this.maxzoom=22,this._options=r.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(x,w){x&&(f.state="errored",n(x)),w&&(f.dem=w,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=r.getImage(this.map._requestManager.transformRequest(c,r.ResourceType.Tile),function(x,w,A,L){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(x)f.state="errored",n(x);else if(w){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:A,expires:L});const P=r.window.ImageBitmap&&w instanceof r.window.ImageBitmap&&(ue==null&&(ue=r.window.OffscreenCanvas&&new r.window.OffscreenCanvas(1,1).getContext("2d")&&typeof r.window.createImageBitmap=="function"),ue),B=1-(w.width-r.prevPowerOfTwo(w.width))/2;B<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const F=P?w:r.exported.getImageData(w,B),H={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:F,encoding:this.encoding,padding:B};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",H,m.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const n=f.canonical,c=Math.pow(2,n.z),m=(n.x-1+c)%c,x=n.x===0?f.wrap-1:f.wrap,w=(n.x+1+c)%c,A=n.x+1===c?f.wrap+1:f.wrap,L={};return L[new r.OverscaledTileID(f.overscaledZ,x,n.z,m,n.y).key]={backfilled:!1},L[new r.OverscaledTileID(f.overscaledZ,A,n.z,w,n.y).key]={backfilled:!1},n.y>0&&(L[new r.OverscaledTileID(f.overscaledZ,x,n.z,m,n.y-1).key]={backfilled:!1},L[new r.OverscaledTileID(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},L[new r.OverscaledTileID(f.overscaledZ,A,n.z,w,n.y-1).key]={backfilled:!1}),n.y+1<c&&(L[new r.OverscaledTileID(f.overscaledZ,x,n.z,m,n.y+1).key]={backfilled:!1},L[new r.OverscaledTileID(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},L[new r.OverscaledTileID(f.overscaledZ,A,n.z,w,n.y+1).key]={backfilled:!1}),L}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends r.Evented{constructor(f,n,c,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(m),this._data=n.data,this._options=r.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const x=r.EXTENT/this.tileSize;this.workerOptions=r.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*x,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*x,extent:r.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:r.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*x,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},n),this}getClusterLeaves(f,n,c,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:n,offset:c},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=r.extend({},this.workerOptions),n=this._data;typeof n=="string"?(f.request=this.map._requestManager.transformRequest(r.exported.resolveURL(n),r.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(c,m)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new r.ErrorEvent(c));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(x.resourceTiming=m.resourceTiming[this.id]),this.fire(new r.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,n){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(c,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,x)=>(delete f.request,f.unloadVectorData(),f.aborted?n(null):m?n(m):(f.loadVectorData(x,this.map.painter,c==="reloadTile"),n(null))),void 0,c==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ce{constructor(f,n,c,m){super(f,n,c,m),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,r.ResourceType.Source).url);r.getVideo(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new r.ErrorEvent(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new r.Texture(f,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ce,canvas:class extends Ce{constructor(f,n,c,m){super(f,n,c,m),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(w=>typeof w!="number"))||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof r.window.HTMLCanvasElement||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof r.window.HTMLCanvasElement?this.options.canvas:r.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends r.Evented{constructor(f,n,c,m){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=n,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new It(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),r.extend(this,r.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:n,y:c,z:m}=f.canonical;return this._implementation.hasTile({x:n,y:c,z:m})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,n){const{x:c,y:m,z:x}=f.tileID.canonical,w=new r.window.AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:c,y:m,z:x},{signal:w.signal})).then(function(A){return delete f.request,f.aborted?(f.state="unloaded",n(null)):A===void 0?(f.state="errored",n(null)):A===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",n(null)):function(L){return L instanceof r.window.ImageData||L instanceof r.window.HTMLCanvasElement||L instanceof r.window.ImageBitmap||L instanceof r.window.HTMLImageElement}(A)?(this.loadTileData(f,A),f.state="loaded",void n(null)):(f.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(A=>{A.code!==20&&(f.state="errored",n(A))}),f.request.cancel=()=>w.abort()}loadTileData(f,n){K.loadTileData(f,n,this._map.painter)}unloadTileData(f){K.unloadTileData(f,this._map.painter)}unloadTile(f,n){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:c,y:m,z:x}=f.tileID.canonical;this._implementation.unloadTile({x:c,y:m,z:x})}n()}abortTile(f,n){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Fe=function(f,n,c,m){const x=new qe[n.type](f,n,c,m);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return r.bindAll(["load","abort","unload","serialize","prepare"],x),x};function Re(f,n){const c=r.identity([]);return r.scale(c,c,[.5*f.width,.5*-f.height,1]),r.translate(c,c,[1,-1,0]),r.multiply(c,c,f.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(c)}function Ke(f,n,c,m,x,w,A,L=!1){const P=f.tilesIn(m,A,L);P.sort(Xt);const B=[];for(const H of P)B.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:H.tile.queryRenderedFeatures(n,c,f._state,H,x,w,Re(f.transform,H.tile.tileID),L)});const F=function(H){const ee={},se={};for(const re of H){const oe=re.queryResults,le=re.wrappedTileID,J=se[le]=se[le]||{};for(const me in oe){const fe=oe[me],ge=J[me]=J[me]||{},Ae=ee[me]=ee[me]||[];for(const Te of fe)ge[Te.featureIndex]||(ge[Te.featureIndex]=!0,Ae.push(Te))}}return ee}(B);for(const H in F)F[H].forEach(ee=>{const se=ee.feature,re=se.layer;re&&re.type!=="background"&&re.type!=="sky"&&(se.source=re.source,re["source-layer"]&&(se.sourceLayer=re["source-layer"]),se.state=se.id!==void 0?f.getFeatureState(re["source-layer"],se.id):{})});return F}function vt(f,n){const c=f.getRenderableIds().map(w=>f.getTileByID(w)),m=[],x={};for(let w=0;w<c.length;w++){const A=c[w],L=A.tileID.canonical.key;x[L]||(x[L]=!0,A.querySourceFeatures(m,n))}return m}function Xt(f,n){const c=f.tileID,m=n.tileID;return c.overscaledZ-m.overscaledZ||c.canonical.y-m.canonical.y||c.wrap-m.wrap||c.canonical.x-m.canonical.x}function Dt(){return wc.workerClass!=null?new wc.workerClass:new r.window.Worker(wc.workerUrl)}const Mi="mapboxgl_preloaded_worker_pool";class gi{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<gi.workerCount;)this.workers.push(new Dt);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mi]}numActive(){return Object.keys(this.active).length}}let yi;function Le(){return yi||(yi=new gi),yi}function hi(f,n){const c={};for(const m in f)m!=="ref"&&(c[m]=f[m]);return r.refProperties.forEach(m=>{m in n&&(c[m]=n[m])}),c}function Pn(f){f=f.slice();const n=Object.create(null);for(let c=0;c<f.length;c++)n[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=hi(f[c],n[f[c].ref]));return f}gi.workerCount=2;const Oi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function wn(f,n,c){c.push({command:Oi.addSource,args:[f,n[f]]})}function In(f,n,c){n.push({command:Oi.removeSource,args:[f]}),c[f]=!0}function Yo(f,n,c,m){In(f,c,m),wn(f,n,c)}function Ys(f,n,c){let m;for(m in f[c])if(f[c].hasOwnProperty(m)&&m!=="data"&&!I(f[c][m],n[c][m]))return!1;for(m in n[c])if(n[c].hasOwnProperty(m)&&m!=="data"&&!I(f[c][m],n[c][m]))return!1;return!0}function st(f,n,c,m,x,w){let A;for(A in n=n||{},f=f||{})f.hasOwnProperty(A)&&(I(f[A],n[A])||c.push({command:w,args:[m,A,n[A],x]}));for(A in n)n.hasOwnProperty(A)&&!f.hasOwnProperty(A)&&(I(f[A],n[A])||c.push({command:w,args:[m,A,n[A],x]}))}function Jo(f){return f.id}function qr(f,n){return f[n.id]=n,f}class nl{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=r.clamp(n,0,1);let c=1,m=this._distances[c];const x=n*this.paddedLength+this.padding;for(;m<x&&c<this._distances.length;)m=this._distances[++c];const w=c-1,A=this._distances[w],L=m-A,P=L>0?(x-A)/L:0;return this.points[w].mult(1-P).add(this.points[c].mult(P))}}class Dh{constructor(n,c,m){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(n/m),this.yCellCount=Math.ceil(c/m);for(let A=0;A<this.xCellCount*this.yCellCount;A++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,m,x,w){this._forEachCell(c,m,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(n,c,m,x){this._forEachCell(c-x,m-x,c+x,m+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(m),this.circles.push(x)}_insertBoxCell(n,c,m,x,w,A){this.boxCells[w].push(A)}_insertCircleCell(n,c,m,x,w,A){this.circleCells[w].push(A)}_query(n,c,m,x,w,A){if(m<0||n>this.width||x<0||c>this.height)return!w&&[];const L=[];if(n<=0&&c<=0&&this.width<=m&&this.height<=x){if(w)return!0;for(let P=0;P<this.boxKeys.length;P++)L.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const B=this.circles[3*P],F=this.circles[3*P+1],H=this.circles[3*P+2];L.push({key:this.circleKeys[P],x1:B-H,y1:F-H,x2:B+H,y2:F+H})}return A?L.filter(A):L}return this._forEachCell(n,c,m,x,this._queryCell,L,{hitTest:w,seenUids:{box:{},circle:{}}},A),w?L.length>0:L}_queryCircle(n,c,m,x,w){const A=n-m,L=n+m,P=c-m,B=c+m;if(L<0||A>this.width||B<0||P>this.height)return!x&&[];const F=[];return this._forEachCell(A,P,L,B,this._queryCellCircle,F,{hitTest:x,circle:{x:n,y:c,radius:m},seenUids:{box:{},circle:{}}},w),x?F.length>0:F}query(n,c,m,x,w){return this._query(n,c,m,x,!1,w)}hitTest(n,c,m,x,w){return this._query(n,c,m,x,!0,w)}hitTestCircle(n,c,m,x){return this._queryCircle(n,c,m,!0,x)}_queryCell(n,c,m,x,w,A,L,P){const B=L.seenUids,F=this.boxCells[w];if(F!==null){const ee=this.bboxes;for(const se of F)if(!B.box[se]){B.box[se]=!0;const re=4*se;if(n<=ee[re+2]&&c<=ee[re+3]&&m>=ee[re+0]&&x>=ee[re+1]&&(!P||P(this.boxKeys[se]))){if(L.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[se],x1:ee[re],y1:ee[re+1],x2:ee[re+2],y2:ee[re+3]})}}}const H=this.circleCells[w];if(H!==null){const ee=this.circles;for(const se of H)if(!B.circle[se]){B.circle[se]=!0;const re=3*se;if(this._circleAndRectCollide(ee[re],ee[re+1],ee[re+2],n,c,m,x)&&(!P||P(this.circleKeys[se]))){if(L.hitTest)return A.push(!0),!0;{const oe=ee[re],le=ee[re+1],J=ee[re+2];A.push({key:this.circleKeys[se],x1:oe-J,y1:le-J,x2:oe+J,y2:le+J})}}}}}_queryCellCircle(n,c,m,x,w,A,L,P){const B=L.circle,F=L.seenUids,H=this.boxCells[w];if(H!==null){const se=this.bboxes;for(const re of H)if(!F.box[re]){F.box[re]=!0;const oe=4*re;if(this._circleAndRectCollide(B.x,B.y,B.radius,se[oe+0],se[oe+1],se[oe+2],se[oe+3])&&(!P||P(this.boxKeys[re])))return A.push(!0),!0}}const ee=this.circleCells[w];if(ee!==null){const se=this.circles;for(const re of ee)if(!F.circle[re]){F.circle[re]=!0;const oe=3*re;if(this._circlesCollide(se[oe],se[oe+1],se[oe+2],B.x,B.y,B.radius)&&(!P||P(this.circleKeys[re])))return A.push(!0),!0}}}_forEachCell(n,c,m,x,w,A,L,P){const B=this._convertToXCellCoord(n),F=this._convertToYCellCoord(c),H=this._convertToXCellCoord(m),ee=this._convertToYCellCoord(x);for(let se=B;se<=H;se++)for(let re=F;re<=ee;re++)if(w.call(this,n,c,m,x,this.xCellCount*re+se,A,L,P))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,m,x,w,A){const L=x-n,P=w-c,B=m+A;return B*B>L*L+P*P}_circleAndRectCollide(n,c,m,x,w,A,L){const P=(A-x)/2,B=Math.abs(n-(x+P));if(B>P+m)return!1;const F=(L-w)/2,H=Math.abs(c-(w+F));if(H>F+m)return!1;if(B<=P||H<=F)return!0;const ee=B-P,se=H-F;return ee*ee+se*se<=m*m}}const Qo=Math.tan(85*Math.PI/180);function Oa(f,n,c,m,x,w,A){const L=r.create();if(c)if(w.name==="globe"){const P=r.calculateGlobeLabelMatrix(x,n);r.multiply(L,L,P)}else{const P=Bt([],A);L[0]=P[0],L[1]=P[1],L[4]=P[2],L[5]=P[3],m||r.rotateZ(L,L,x.angle)}else r.multiply(L,x.labelPlaneMatrix,f);return L}function Wu(f,n,c,m,x,w,A){const L=Oa(f,n,c,m,x,w,A);return w.name==="globe"&&c||(L[2]=L[6]=L[10]=L[14]=0),L}function rl(f,n,c,m,x,w,A){if(c){if(w.name==="globe"){const L=Oa(f,n,c,m,x,w,A);return r.invert(L,L),r.multiply(L,f,L),L}{const L=r.clone(f),P=r.identity([]);return P[0]=A[0],P[1]=A[1],P[4]=A[2],P[5]=A[3],r.multiply(L,L,P),m||r.rotateZ(L,L,-x.angle),L}}return x.glCoordMatrix}function Ht(f,n,c,m){const x=[f,n,c,1];c?r.transformMat4$1(x,x,m):Ft(x,x,m);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function _n(f,n){return Math.min(.5+f/n*.5,1.5)}function vn(f,n){const c=f[0]/f[3],m=f[1]/f[3];return c>=-n[0]&&c<=n[0]&&m>=-n[1]&&m<=n[1]}function fo(f,n,c,m,x,w,A,L,P,B){const F=c.transform,H=m?f.textSizeData:f.iconSizeData,ee=r.evaluateSizeForZoom(H,c.transform.zoom),se=F.projection.name==="globe",re=[256/c.width*2+1,256/c.height*2+1],oe=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;oe.clear();let le=null;se&&(le=m?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const J=f.lineVertexArray,me=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,fe=c.transform.width/c.transform.height;let ge,Ae=!1;for(let Te=0;Te<me.length;Te++){const De=me.get(Te),{numGlyphs:He,writingMode:We}=De;if(We!==r.WritingMode.vertical||Ae||ge===r.WritingMode.horizontal||(Ae=!0),ge=We,(De.hidden||We===r.WritingMode.vertical)&&!Ae){ze(He,oe);continue}Ae=!1;const Qe=new r.pointGeometry(De.tileAnchorX,De.tileAnchorY);let{x:Ut,y:Xe,z:pt}=F.projection.projectTilePoint(Qe.x,Qe.y,B.canonical);if(P){const[fn,di,si]=P(Qe);Ut+=fn,Xe+=di,pt+=si}const it=[Ut,Xe,pt,1];if(r.transformMat4$1(it,it,n),!vn(it,re)){ze(He,oe);continue}const Ct=_n(c.transform.cameraToCenterDistance,it[3]),Ye=r.evaluateSizeForFeature(H,ee,De),Ge=A?Ye/Ct:Ye*Ct,tt=Ht(Ut,Xe,pt,x);if(tt[3]<=0){ze(He,oe);continue}let bt={};const At=A?null:P,bi=$(De,Ge,!1,L,n,x,w,f.glyphOffsetArray,J,oe,le,tt,Qe,bt,fe,At,F.projection,B,A);Ae=bi.useVertical,At&&bi.needsFlipping&&(bt={}),(bi.notEnoughRoom||Ae||bi.needsFlipping&&$(De,Ge,!0,L,n,x,w,f.glyphOffsetArray,J,oe,le,tt,Qe,bt,fe,At,F.projection,B,A).notEnoughRoom)&&ze(He,oe)}m?(f.text.dynamicLayoutVertexBuffer.updateData(oe),le&&f.text.globeExtVertexBuffer.updateData(le)):(f.icon.dynamicLayoutVertexBuffer.updateData(oe),le&&f.icon.globeExtVertexBuffer.updateData(le))}function C(f,n,c,m,x,w,A,L,P,B,F,H,ee,se,re,oe){const{lineStartIndex:le,glyphStartIndex:J,segment:me}=L,fe=J+L.numGlyphs,ge=le+L.lineLength,Ae=n.getoffsetX(J),Te=n.getoffsetX(fe-1),De=Pe(f*Ae,c,m,x,w,A,me,le,ge,P,B,F,H,ee,!0,se,re,oe);if(!De)return null;const He=Pe(f*Te,c,m,x,w,A,me,le,ge,P,B,F,H,ee,!0,se,re,oe);return He?{first:De,last:He}:null}function k(f,n,c,m){return f===r.WritingMode.horizontal&&Math.abs(m)>Math.abs(c)?{useVertical:!0}:f===r.WritingMode.vertical?m>0?{needsFlipping:!0}:null:n!==0&&function(x,w){return x===0||Math.abs(w/x)>Qo}(c,m)?n===1?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function $(f,n,c,m,x,w,A,L,P,B,F,H,ee,se,re,oe,le,J,me){const fe=n/24,ge=f.lineOffsetX*fe,Ae=f.lineOffsetY*fe,{lineStartIndex:Te,glyphStartIndex:De,numGlyphs:He,segment:We,writingMode:Qe,flipState:Ut}=f,Xe=Te+f.lineLength,pt=it=>{if(F){const[tt,bt,At]=it.up,bi=B.length;r.updateGlobeVertexNormal(F,bi+0,tt,bt,At),r.updateGlobeVertexNormal(F,bi+1,tt,bt,At),r.updateGlobeVertexNormal(F,bi+2,tt,bt,At),r.updateGlobeVertexNormal(F,bi+3,tt,bt,At)}const[Ct,Ye,Ge]=it.point;r.addDynamicAttributes(B,Ct,Ye,Ge,it.angle)};if(He>1){const it=C(fe,L,ge,Ae,c,H,ee,f,P,w,se,oe,!1,le,J,me);if(!it)return{notEnoughRoom:!0};if(m&&!c){let[Ct,Ye,Ge]=it.first.point,[tt,bt,At]=it.last.point;[Ct,Ye]=Ht(Ct,Ye,Ge,A),[tt,bt]=Ht(tt,bt,At,A);const bi=k(Qe,Ut,(tt-Ct)*re,bt-Ye);if(f.flipState=bi&&bi.needsFlipping?1:2,bi)return bi}pt(it.first);for(let Ct=De+1;Ct<De+He-1;Ct++){const Ye=Pe(fe*L.getoffsetX(Ct),ge,Ae,c,H,ee,We,Te,Xe,P,w,se,oe,!1,!1,le,J,me);if(!Ye)return B.length-=4*(Ct-De),{notEnoughRoom:!0};pt(Ye)}pt(it.last)}else{if(m&&!c){const Ct=Ht(ee.x,ee.y,0,x),Ye=Te+We+1,Ge=new r.pointGeometry(P.getx(Ye),P.gety(Ye)),tt=Ht(Ge.x,Ge.y,0,x),bt=tt[3]>0?tt:Oe(ee,Ge,Ct,1,x,void 0,le,J.canonical),At=k(Qe,Ut,(bt[0]-Ct[0])*re,bt[1]-Ct[1]);if(f.flipState=At&&At.needsFlipping?1:2,At)return At}const it=Pe(fe*L.getoffsetX(De),ge,Ae,c,H,ee,We,Te,Xe,P,w,se,oe,!1,!1,le,J,me);if(!it)return{notEnoughRoom:!0};pt(it)}return{}}function xe(f,n,c,m,x){const{x:w,y:A,z:L}=m.projectTilePoint(f.x,f.y,n);if(!x)return Ht(w,A,L,c);const[P,B,F]=x(f);return Ht(w+P,A+B,L+F,c)}function Oe(f,n,c,m,x,w,A,L){const P=xe(f.sub(n)._unit()._add(f),L,x,A,w);return r.sub(P,c,P),r.normalize(P,P),r.scaleAndAdd(P,c,P,m)}function Pe(f,n,c,m,x,w,A,L,P,B,F,H,ee,se,re,oe,le,J){const me=m?f-n:f+n;let fe=me>0?1:-1,ge=0;m&&(fe*=-1,ge=Math.PI),fe<0&&(ge+=Math.PI);let Ae=L+A+(fe>0?0:1)|0,Te=x,De=x,He=0,We=0;const Qe=Math.abs(me),Ut=[],Xe=[];let pt=w,it=pt;const Ct=()=>Oe(it,pt,De,Qe-He+1,F,ee,oe,le.canonical);for(;He+We<=Qe;){if(Ae+=fe,Ae<L||Ae>=P)return null;if(De=Te,it=pt,Ut.push(De),se&&Xe.push(it),pt=new r.pointGeometry(B.getx(Ae),B.gety(Ae)),Te=H[Ae],!Te){const si=xe(pt,le.canonical,F,oe,ee);Te=si[3]>0?H[Ae]=si:Ct()}He+=We,We=r.distance(De,Te)}re&&ee&&(H[Ae]&&(Te=Ct(),We=r.distance(De,Te)),H[Ae]=Te);const Ye=(Qe-He)/We,Ge=pt.sub(it)._mult(Ye)._add(it),tt=r.sub([],Te,De),bt=r.scaleAndAdd([],De,tt,Ye);let At=[0,0,1],bi=tt[0],fn=tt[1];if(J&&(At=oe.upVector(le.canonical,Ge.x,Ge.y),At[0]!==0||At[1]!==0||At[2]!==1)){const si=[At[2],0,-At[0]],Ti=r.cross([],At,si);r.normalize(si,si),r.normalize(Ti,Ti),bi=r.dot(tt,si),fn=r.dot(tt,Ti)}if(c){const si=r.cross([],At,tt);r.normalize(si,si),r.scaleAndAdd(bt,bt,si,c*fe)}const di=ge+Math.atan2(fn,bi);return Ut.push(bt),se&&Xe.push(Ge),{point:bt,angle:di,path:Ut,tilePath:Xe,up:At}}function ze(f,n){const c=n.length,m=c+4*f;n.resize(m),n.float32.fill(-1/0,4*c,4*m)}function Ft(f,n,c){const m=n[0],x=n[1];return f[0]=c[0]*m+c[4]*x+c[12],f[1]=c[1]*m+c[5]*x+c[13],f[3]=c[3]*m+c[7]*x+c[15],f}const kt=100;class ai{constructor(n,c,m=new Dh(n.width+200,n.height+200,25),x=new Dh(n.width+200,n.height+200,25)){this.transform=n,this.grid=m,this.ignoredGrid=x,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+kt,this.screenBottomBoundary=n.height+kt,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,m,x,w,A,L,P){let B=m.projectedAnchorX,F=m.projectedAnchorY,H=m.projectedAnchorZ;const ee=m.elevation,se=m.tileID,re=n.getProjection();if(ee&&se){const[Te,De,He]=re.upVector(se.canonical,m.tileAnchorX,m.tileAnchorY),We=re.upVectorScale(se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;B+=Te*ee*We,F+=De*ee*We,H+=He*ee*We}const oe=this.projectAndGetPerspectiveRatio(L,B,F,H,m.tileID,re.name==="globe"||!!ee||this.transform.pitch>0,re),le=A*oe.perspectiveRatio,J=(m.x1*c+x.x-m.padding)*le+oe.point.x,me=(m.y1*c+x.y-m.padding)*le+oe.point.y,fe=(m.x2*c+x.x+m.padding)*le+oe.point.x,ge=(m.y2*c+x.y+m.padding)*le+oe.point.y,Ae=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid(J,me,fe,ge)||!w&&this.grid.hitTest(J,me,fe,ge,P)||Ae?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[J,me,fe,ge],offscreen:this.isOffscreen(J,me,fe,ge),occluded:!1}}placeCollisionCircles(n,c,m,x,w,A,L,P,B,F,H,ee,se,re,oe){const le=[],J=this.transform.elevation,me=n.getProjection(),fe=J?J.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,me):null,ge=new r.pointGeometry(m.tileAnchorX,m.tileAnchorY);let{x:Ae,y:Te,z:De}=me.projectTilePoint(ge.x,ge.y,oe.canonical);if(fe){const[Ge,tt,bt]=fe(ge);Ae+=Ge,Te+=tt,De+=bt}const He=me.name==="globe",We=this.projectAndGetPerspectiveRatio(L,Ae,Te,De,oe,He||!!J||this.transform.pitch>0,me),{perspectiveRatio:Qe}=We,Ut=(H?A/Qe:A*Qe)/r.ONE_EM,Xe=Ht(Ae,Te,De,P),pt=We.signedDistanceFromCamera>0?C(Ut,w,m.lineOffsetX*Ut,m.lineOffsetY*Ut,!1,Xe,ge,m,x,P,{},J&&!H?fe:null,H&&!!J,me,oe,H):null;let it=!1,Ct=!1,Ye=!0;if(pt&&!We.occluded){const Ge=.5*se*Qe+re,tt=new r.pointGeometry(-100,-100),bt=new r.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),At=new nl,{first:bi,last:fn}=pt,di=bi.path.length;let si=[];for(let Li=di-1;Li>=1;Li--)si.push(bi.path[Li]);for(let Li=1;Li<fn.path.length;Li++)si.push(fn.path[Li]);const Ti=2.5*Ge;B&&(si=si.map(([Li,Jn,or],br)=>(fe&&!He&&(or=fe(br<di-1?bi.tilePath[di-1-br]:fn.tilePath[br-di+2])[2]),Ht(Li,Jn,or,B))),si.some(Li=>Li[3]<=0)&&(si=[]));let Mn=[];if(si.length>0){let Li=1/0,Jn=-1/0,or=1/0,br=-1/0;for(const lr of si)Li=Math.min(Li,lr[0]),or=Math.min(or,lr[1]),Jn=Math.max(Jn,lr[0]),br=Math.max(br,lr[1]);Jn>=tt.x&&Li<=bt.x&&br>=tt.y&&or<=bt.y&&(Mn=[si.map(lr=>new r.pointGeometry(lr[0],lr[1]))],(Li<tt.x||Jn>bt.x||or<tt.y||br>bt.y)&&(Mn=r.clipLine(Mn,tt.x,tt.y,bt.x,bt.y)))}for(const Li of Mn){At.reset(Li,.25*Ge);let Jn=0;Jn=At.length<=.5*Ge?1:Math.ceil(At.paddedLength/Ti)+1;for(let or=0;or<Jn;or++){const br=or/Math.max(Jn-1,1),lr=At.lerp(br),os=lr.x+kt,Ao=lr.y+kt;le.push(os,Ao,Ge,0);const ya=os-Ge,va=Ao-Ge,Rr=os+Ge,fr=Ao+Ge;if(Ye=Ye&&this.isOffscreen(ya,va,Rr,fr),Ct=Ct||this.isInsideGrid(ya,va,Rr,fr),!c&&this.grid.hitTestCircle(os,Ao,Ge,ee)&&(it=!0,!F))return{circles:[],offscreen:!1,collisionDetected:it,occluded:!1}}}}return{circles:!F&&it||!Ct?[]:le,offscreen:Ye,collisionDetected:it,occluded:We.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let m=1/0,x=1/0,w=-1/0,A=-1/0;for(const F of n){const H=new r.pointGeometry(F.x+kt,F.y+kt);m=Math.min(m,H.x),x=Math.min(x,H.y),w=Math.max(w,H.x),A=Math.max(A,H.y),c.push(H)}const L=this.grid.query(m,x,w,A).concat(this.ignoredGrid.query(m,x,w,A)),P={},B={};for(const F of L){const H=F.key;if(P[H.bucketInstanceId]===void 0&&(P[H.bucketInstanceId]={}),P[H.bucketInstanceId][H.featureIndex])continue;const ee=[new r.pointGeometry(F.x1,F.y1),new r.pointGeometry(F.x2,F.y1),new r.pointGeometry(F.x2,F.y2),new r.pointGeometry(F.x1,F.y2)];r.polygonIntersectsPolygon(c,ee)&&(P[H.bucketInstanceId][H.featureIndex]=!0,B[H.bucketInstanceId]===void 0&&(B[H.bucketInstanceId]=[]),B[H.bucketInstanceId].push(H.featureIndex))}return B}insertCollisionBox(n,c,m,x,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:w},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,m,x,w){const A=c?this.ignoredGrid:this.grid,L={bucketInstanceId:m,featureIndex:x,collisionGroupID:w};for(let P=0;P<n.length;P+=4)A.insertCircle(L,n[P],n[P+1],n[P+2])}projectAndGetPerspectiveRatio(n,c,m,x,w,A,L){const P=[c,m,x,1];let B=!1;if(x||this.transform.pitch>0){r.transformMat4$1(P,P,n);const H=L.name==="globe";this.fogState&&w&&!H&&(B=function(se,re,oe,le,J,me){const fe=me.calculateFogTileMatrix(J),ge=[re,oe,le];return r.transformMat4(ge,ge,fe),Gt(se,ge,me.pitch,me._fov)}(this.fogState,c,m,x,w.toUnwrapped(),this.transform)>.9)}else Ft(P,P,n);const F=P[3];return{point:new r.pointGeometry((P[0]/F+1)/2*this.transform.width+kt,(-P[1]/F+1)/2*this.transform.height+kt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(L)/F*.5,1.5),signedDistanceFromCamera:F,occluded:A&&P[2]>F||B}}isOffscreen(n,c,m,x){return m<kt||n>=this.screenRightBoundary||x<kt||c>this.screenBottomBoundary}isInsideGrid(n,c,m,x){return m>=0&&n<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=r.identity([]);return r.translate(n,n,[-100,-100,0]),n}}function Zt(f,n,c){const m=n.createTileMatrix(f,f.worldSize,c.toUnwrapped());return r.multiply(new Float32Array(16),f.projMatrix,m)}function Qt(f,n,c){if(n.projection.name===c.projection.name)return f.projMatrix;const m=c.clone();return m.setProjection(n.projection),Zt(m,n.getProjection(),f)}function Hi(f,n,c){return n.name===c.projection.name?f.projMatrix:Zt(c,n,f)}class vr{constructor(n,c,m,x){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):x&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Zi{constructor(n,c,m,x,w,A=!1){this.text=new vr(n?n.text:null,c,m,w),this.icon=new vr(n?n.icon:null,c,x,w),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mr{constructor(n,c,m,x=!1){this.text=n,this.icon=c,this.skipFade=m,this.clipped=x}}class Et{constructor(){this.invProjMatrix=r.create(),this.viewportMatrix=r.create(),this.circles=[]}}class ci{constructor(n,c,m,x,w){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=m,this.bucketIndex=x,this.tileID=w}}class Qi{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:m=>m.collisionGroupID===c}}return this.collisionGroups[n]}}function Yr(f,n,c,m,x){const{horizontalAlign:w,verticalAlign:A}=r.getAnchorAlignment(f),L=-(w-.5)*n,P=-(A-.5)*c,B=r.evaluateVariableOffset(f,m);return new r.pointGeometry(L+B[0]*x,P+B[1]*x)}function Br(f,n,c,m,x){const w=new r.pointGeometry(f,n);return c&&w._rotate(m?x:-x),w}class Os{constructor(n,c,m,x,w){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new ai(this.transform,w),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Qi(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,m,x){const w=m.getBucket(c),A=m.latestFeatureIndex;if(!w||!A||c.id!==w.layerIds[0])return;const L=w.layers[0].layout,P=m.collisionBoxArray,B=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),F=m.tileSize/r.EXTENT,H=m.tileID.toUnwrapped();this.transform.setProjection(w.projection);const ee=(se=m.tileID,re=w.getProjection(),oe=this.transform,re.name===this.projection?oe.calculateProjMatrix(se.toUnwrapped()):Zt(oe,re,se));var se,re,oe;const le=L.get("text-pitch-alignment")==="map",J=L.get("text-rotation-alignment")==="map";c.compileFilter();const me=c.dynamicFilter(),fe=c.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(m),Ae=Wu(ee,m.tileID.canonical,le,J,this.transform,w.getProjection(),ge);let Te=null;if(le){const We=rl(ee,m.tileID.canonical,le,J,this.transform,w.getProjection(),ge);Te=r.multiply([],this.transform.labelPlaneMatrix,We)}let De=null;me&&m.latestFeatureIndex&&(De={unwrappedTileID:H,dynamicFilter:me,dynamicFilterNeedsFeature:fe,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[w.bucketInstanceId]=new ci(w.bucketInstanceId,A,w.sourceLayerIndex,w.index,m.tileID);const He={bucket:w,layout:L,posMatrix:ee,textLabelPlaneMatrix:Ae,labelToScreenMatrix:Te,clippingData:De,scale:B,textPixelRatio:F,holdingForFade:m.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:r.evaluateSizeForZoom(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.evaluateSizeForZoom(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(x)for(const We of w.sortKeyRanges){const{sortKey:Qe,symbolInstanceStart:Ut,symbolInstanceEnd:Xe}=We;n.push({sortKey:Qe,symbolInstanceStart:Ut,symbolInstanceEnd:Xe,parameters:He})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:He})}attemptAnchorPlacement(n,c,m,x,w,A,L,P,B,F,H,ee,se,re,oe,le,J,me){const{textOffset0:fe,textOffset1:ge,crossTileID:Ae}=ee,Te=[fe,ge],De=Yr(n,m,x,Te,w),He=this.collisionIndex.placeCollisionBox(re,w,c,Br(De.x,De.y,A,L,this.transform.angle),H,P,B,F.predicate);if(le){const We=re.getSymbolInstanceIconSize(me,this.transform.zoom,ee.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(re,We,le,Br(De.x,De.y,A,L,this.transform.angle),H,P,B,F.predicate).box.length===0)return}if(He.box.length>0){let We;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ae]&&this.prevPlacement.placements[Ae]&&this.prevPlacement.placements[Ae].text&&(We=this.prevPlacement.variableOffsets[Ae].anchor),this.variableOffsets[Ae]={textOffset:Te,width:m,height:x,anchor:n,textScale:w,prevAnchor:We},this.markUsedJustification(re,n,ee,oe),re.allowVerticalPlacement&&(this.markUsedOrientation(re,oe,ee),this.placedOrientations[Ae]=oe),{shift:De,placedGlyphBoxes:He}}}placeLayerBucketPart(n,c,m,x){const{bucket:w,layout:A,posMatrix:L,textLabelPlaneMatrix:P,labelToScreenMatrix:B,clippingData:F,textPixelRatio:H,holdingForFade:ee,collisionBoxArray:se,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:oe,collisionGroup:le}=n.parameters,J=A.get("text-optional"),me=A.get("icon-optional"),fe=A.get("text-allow-overlap"),ge=A.get("icon-allow-overlap"),Ae=A.get("text-rotation-alignment")==="map",Te=A.get("text-pitch-alignment")==="map",De=A.get("icon-text-fit")!=="none",He=A.get("symbol-z-order")==="viewport-y";this.transform.setProjection(w.projection);let We=fe&&(ge||!w.hasIconData()||me),Qe=ge&&(fe||!w.hasTextData()||J);!w.collisionArrays&&se&&w.deserializeCollisionBoxes(se),m&&x&&w.updateCollisionDebugBuffers(this.transform.zoom,se);const Ut=(Xe,pt,it)=>{const{crossTileID:Ct,numVerticalGlyphVertices:Ye}=Xe;if(F){const Rr={zoom:this.transform.zoom,pitch:this.transform.pitch};let fr=null;if(F.dynamicFilterNeedsFeature){const Hn=this.retainedQueryData[w.bucketInstanceId];fr=F.featureIndex.loadFeature({featureIndex:Xe.featureIndex,bucketIndex:Hn.bucketIndex,sourceLayerIndex:Hn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,F.dynamicFilter)(Rr,fr,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new r.pointGeometry(Xe.tileAnchorX,Xe.tileAnchorY),this.transform.calculateDistanceTileData(F.unwrappedTileID)))return this.placements[Ct]=new Mr(!1,!1,!1,!0),void(c[Ct]=!0)}if(c[Ct])return;if(ee)return void(this.placements[Ct]=new Mr(!1,!1,!1));let Ge=!1,tt=!1,bt=!0,At=!1,bi=!1,fn=null,di={box:null,offscreen:null,occluded:null},si={box:null,offscreen:null,occluded:null},Ti=null,Mn=null,Li=null,Jn=0,or=0,br=0;it.textFeatureIndex?Jn=it.textFeatureIndex:Xe.useRuntimeCollisionCircles&&(Jn=Xe.featureIndex),it.verticalTextFeatureIndex&&(or=it.verticalTextFeatureIndex);const lr=Rr=>{Rr.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const fr=this.transform.elevation;(fr||Rr.elevation)&&(Rr.elevation=fr?fr.getAtTileOffset(Rr.tileID,Rr.tileAnchorX,Rr.tileAnchorY):0)},os=it.textBox;if(os){lr(os);const Rr=Hn=>{let Qr=r.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Hn&&this.prevPlacement){const eo=this.prevPlacement.placedOrientations[Ct];eo&&(this.placedOrientations[Ct]=eo,Qr=eo,this.markUsedOrientation(w,Qr,Xe))}return Qr},fr=(Hn,Qr)=>{if(w.allowVerticalPlacement&&Ye>0&&it.verticalTextBox){for(const eo of w.writingModes)if(eo===r.WritingMode.vertical?(di=Qr(),si=di):di=Hn(),di&&di.box&&di.box.length)break}else di=Hn()};if(A.get("text-variable-anchor")){let Hn=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ct]){const Sr=this.prevPlacement.variableOffsets[Ct];Hn.indexOf(Sr.anchor)>0&&(Hn=Hn.filter(Ws=>Ws!==Sr.anchor),Hn.unshift(Sr.anchor))}const Qr=(Sr,Ws,to)=>{const gl=w.getSymbolInstanceTextSize(re,Xe,this.transform.zoom,pt),Eu=(Sr.x2-Sr.x1)*gl+2*Sr.padding,So=(Sr.y2-Sr.y1)*gl+2*Sr.padding,rn=De&&!ge?Ws:null;rn&&lr(rn);let Vl={box:[],offscreen:!1,occluded:!1};const Ec=fe?2*Hn.length:Hn.length;for(let xa=0;xa<Ec;++xa){const Zc=this.attemptAnchorPlacement(Hn[xa%Hn.length],Sr,Eu,So,gl,Ae,Te,H,L,le,xa>=Hn.length,Xe,pt,w,to,rn,re,oe);if(Zc&&(Vl=Zc.placedGlyphBoxes,Vl&&Vl.box&&Vl.box.length)){Ge=!0,fn=Zc.shift;break}}return Vl};fr(()=>Qr(os,it.iconBox,r.WritingMode.horizontal),()=>{const Sr=it.verticalTextBox;return Sr&&lr(Sr),w.allowVerticalPlacement&&!(di&&di.box&&di.box.length)&&Ye>0&&Sr?Qr(Sr,it.verticalIconBox,r.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),di&&(Ge=di.box,bt=di.offscreen,At=di.occluded);const eo=Rr(di&&di.box);if(!Ge&&this.prevPlacement){const Sr=this.prevPlacement.variableOffsets[Ct];Sr&&(this.variableOffsets[Ct]=Sr,this.markUsedJustification(w,Sr.anchor,Xe,eo))}}else{const Hn=(Qr,eo)=>{const Sr=w.getSymbolInstanceTextSize(re,Xe,this.transform.zoom,pt),Ws=this.collisionIndex.placeCollisionBox(w,Sr,Qr,new r.pointGeometry(0,0),fe,H,L,le.predicate);return Ws&&Ws.box&&Ws.box.length&&(this.markUsedOrientation(w,eo,Xe),this.placedOrientations[Ct]=eo),Ws};fr(()=>Hn(os,r.WritingMode.horizontal),()=>{const Qr=it.verticalTextBox;return w.allowVerticalPlacement&&Ye>0&&Qr?(lr(Qr),Hn(Qr,r.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Rr(di&&di.box&&di.box.length)}}if(Ti=di,Ge=Ti&&Ti.box&&Ti.box.length>0,bt=Ti&&Ti.offscreen,At=Ti&&Ti.occluded,Xe.useRuntimeCollisionCircles){const Rr=w.text.placedSymbolArray.get(Xe.centerJustifiedTextSymbolIndex>=0?Xe.centerJustifiedTextSymbolIndex:Xe.verticalPlacedTextSymbolIndex),fr=r.evaluateSizeForFeature(w.textSizeData,re,Rr),Hn=A.get("text-padding");Mn=this.collisionIndex.placeCollisionCircles(w,fe,Rr,w.lineVertexArray,w.glyphOffsetArray,fr,L,P,B,m,Te,le.predicate,Xe.collisionCircleDiameter*fr/r.ONE_EM,Hn,this.retainedQueryData[w.bucketInstanceId].tileID),Ge=fe||Mn.circles.length>0&&!Mn.collisionDetected,bt=bt&&Mn.offscreen,At=Mn.occluded}if(it.iconFeatureIndex&&(br=it.iconFeatureIndex),it.iconBox){const Rr=fr=>{lr(fr);const Hn=De&&fn?Br(fn.x,fn.y,Ae,Te,this.transform.angle):new r.pointGeometry(0,0),Qr=w.getSymbolInstanceIconSize(oe,this.transform.zoom,Xe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Qr,fr,Hn,ge,H,L,le.predicate)};si&&si.box&&si.box.length&&it.verticalIconBox?(Li=Rr(it.verticalIconBox),tt=Li.box.length>0):(Li=Rr(it.iconBox),tt=Li.box.length>0),bt=bt&&Li.offscreen,bi=Li.occluded}const Ao=J||Xe.numHorizontalGlyphVertices===0&&Ye===0,ya=me||Xe.numIconVertices===0;if(Ao||ya?ya?Ao||(tt=tt&&Ge):Ge=tt&&Ge:tt=Ge=tt&&Ge,Ge&&Ti&&Ti.box&&this.collisionIndex.insertCollisionBox(Ti.box,A.get("text-ignore-placement"),w.bucketInstanceId,si&&si.box&&or?or:Jn,le.ID),tt&&Li&&this.collisionIndex.insertCollisionBox(Li.box,A.get("icon-ignore-placement"),w.bucketInstanceId,br,le.ID),Mn&&(Ge&&this.collisionIndex.insertCollisionCircles(Mn.circles,A.get("text-ignore-placement"),w.bucketInstanceId,Jn,le.ID),m)){const Rr=w.bucketInstanceId;let fr=this.collisionCircleArrays[Rr];fr===void 0&&(fr=this.collisionCircleArrays[Rr]=new Et);for(let Hn=0;Hn<Mn.circles.length;Hn+=4)fr.circles.push(Mn.circles[Hn+0]),fr.circles.push(Mn.circles[Hn+1]),fr.circles.push(Mn.circles[Hn+2]),fr.circles.push(Mn.collisionDetected?1:0)}const va=w.projection.name!=="globe";We=We&&(va||!At),Qe=Qe&&(va||!bi),this.placements[Ct]=new Mr(Ge||We,tt||Qe,bt||w.justReloaded),c[Ct]=!0};if(He){const Xe=w.getSortedSymbolIndexes(this.transform.angle);for(let pt=Xe.length-1;pt>=0;--pt){const it=Xe[pt];Ut(w.symbolInstances.get(it),it,w.collisionArrays[it])}}else for(let Xe=n.symbolInstanceStart;Xe<n.symbolInstanceEnd;Xe++)Ut(w.symbolInstances.get(Xe),Xe,w.collisionArrays[Xe]);if(m&&w.bucketInstanceId in this.collisionCircleArrays){const Xe=this.collisionCircleArrays[w.bucketInstanceId];r.invert(Xe.invProjMatrix,L),Xe.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(n,c,m,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:P,crossTileID:B}=m,F=r.getAnchorJustification(c),H=x===r.WritingMode.vertical?P:F==="left"?w:F==="center"?A:F==="right"?L:-1;w>=0&&(n.text.placedSymbolArray.get(w).crossTileID=H>=0&&w!==H?0:B),A>=0&&(n.text.placedSymbolArray.get(A).crossTileID=H>=0&&A!==H?0:B),L>=0&&(n.text.placedSymbolArray.get(L).crossTileID=H>=0&&L!==H?0:B),P>=0&&(n.text.placedSymbolArray.get(P).crossTileID=H>=0&&P!==H?0:B)}markUsedOrientation(n,c,m){const x=c===r.WritingMode.horizontal||c===r.WritingMode.horizontalOnly?c:0,w=c===r.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:L,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:B}=m,F=n.text.placedSymbolArray;A>=0&&(F.get(A).placedOrientation=x),L>=0&&(F.get(L).placedOrientation=x),P>=0&&(F.get(P).placedOrientation=x),B>=0&&(F.get(B).placedOrientation=w)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let m=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(n):1,w=c?c.opacities:{},A=c?c.variableOffsets:{},L=c?c.placedOrientations:{};for(const P in this.placements){const B=this.placements[P],F=w[P];F?(this.opacities[P]=new Zi(F,x,B.text,B.icon,null,B.clipped),m=m||B.text!==F.text.placed||B.icon!==F.icon.placed):(this.opacities[P]=new Zi(null,x,B.text,B.icon,B.skipFade,B.clipped),m=m||B.text||B.icon)}for(const P in w){const B=w[P];if(!this.opacities[P]){const F=new Zi(B,x,!1,!1);F.isHidden()||(this.opacities[P]=F,m=m||B.text.placed||B.icon.placed)}}for(const P in A)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=A[P]);for(const P in L)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=L[P]);m?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c){const m={};for(const x of c){const w=x.getBucket(n);w&&x.latestFeatureIndex&&n.id===w.layerIds[0]&&this.updateBucketOpacities(w,m,x.collisionBoxArray)}}updateBucketOpacities(n,c,m){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const x=n.layers[0].layout,w=!!n.layers[0].dynamicFilter(),A=new Zi(null,0,!1,!1,!0),L=x.get("text-allow-overlap"),P=x.get("icon-allow-overlap"),B=x.get("text-variable-anchor"),F=x.get("text-rotation-alignment")==="map",H=x.get("text-pitch-alignment")==="map",ee=x.get("icon-text-fit")!=="none",se=new Zi(null,0,L&&(P||!n.hasIconData()||x.get("icon-optional")),P&&(L||!n.hasTextData()||x.get("text-optional")),!0);!n.collisionArrays&&m&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(m);const re=(le,J,me)=>{for(let fe=0;fe<J/4;fe++)le.opacityVertexArray.emplaceBack(me)};let oe=0;for(let le=0;le<n.symbolInstances.length;le++){const J=n.symbolInstances.get(le),{numHorizontalGlyphVertices:me,numVerticalGlyphVertices:fe,crossTileID:ge,numIconVertices:Ae}=J;let Te=this.opacities[ge];c[ge]?Te=A:Te||(Te=se,this.opacities[ge]=Te),c[ge]=!0;const De=me>0||fe>0,He=Ae>0,We=this.placedOrientations[ge],Qe=We===r.WritingMode.vertical,Ut=We===r.WritingMode.horizontal||We===r.WritingMode.horizontalOnly;if(!De&&!He||Te.isHidden()||oe++,De){const Xe=rc(Te.text);re(n.text,me,Qe?Pl:Xe),re(n.text,fe,Ut?Pl:Xe);const pt=Te.text.isHidden(),{leftJustifiedTextSymbolIndex:it,centerJustifiedTextSymbolIndex:Ct,rightJustifiedTextSymbolIndex:Ye,verticalPlacedTextSymbolIndex:Ge}=J,tt=n.text.placedSymbolArray,bt=pt||Qe?1:0;it>=0&&(tt.get(it).hidden=bt),Ct>=0&&(tt.get(Ct).hidden=bt),Ye>=0&&(tt.get(Ye).hidden=bt),Ge>=0&&(tt.get(Ge).hidden=pt||Ut?1:0);const At=this.variableOffsets[ge];At&&this.markUsedJustification(n,At.anchor,J,We);const bi=this.placedOrientations[ge];bi&&(this.markUsedJustification(n,"left",J,bi),this.markUsedOrientation(n,bi,J))}if(He){const Xe=rc(Te.icon),{placedIconSymbolIndex:pt,verticalPlacedIconSymbolIndex:it}=J,Ct=n.icon.placedSymbolArray,Ye=Te.icon.isHidden()?1:0;pt>=0&&(re(n.icon,Ae,Qe?Pl:Xe),Ct.get(pt).hidden=Ye),it>=0&&(re(n.icon,J.numVerticalIconVertices,Ut?Pl:Xe),Ct.get(it).hidden=Ye)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Xe=n.collisionArrays[le];if(Xe){let pt=new r.pointGeometry(0,0),it=!0;if(Xe.textBox||Xe.verticalTextBox){if(B){const Ye=this.variableOffsets[ge];Ye?(pt=Yr(Ye.anchor,Ye.width,Ye.height,Ye.textOffset,Ye.textScale),F&&pt._rotate(H?this.transform.angle:-this.transform.angle)):it=!1}w&&(it=!Te.clipped),Xe.textBox&&Js(n.textCollisionBox.collisionVertexArray,Te.text.placed,!it||Qe,pt.x,pt.y),Xe.verticalTextBox&&Js(n.textCollisionBox.collisionVertexArray,Te.text.placed,!it||Ut,pt.x,pt.y)}const Ct=it&&!!(!Ut&&Xe.verticalIconBox);Xe.iconBox&&Js(n.iconCollisionBox.collisionVertexArray,Te.icon.placed,Ct,ee?pt.x:0,ee?pt.y:0),Xe.verticalIconBox&&Js(n.iconCollisionBox.collisionVertexArray,Te.icon.placed,!Ct,ee?pt.x:0,ee?pt.y:0)}}}if(n.fullyClipped=oe===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=le.invProjMatrix,n.placementViewportMatrix=le.viewportMatrix,n.collisionCircleArray=le.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const m=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*m>n}setStale(){this.stale=!0}}function Js(f,n,c,m,x){f.emplaceBack(n?1:0,c?1:0,m||0,x||0),f.emplaceBack(n?1:0,c?1:0,m||0,x||0),f.emplaceBack(n?1:0,c?1:0,m||0,x||0),f.emplaceBack(n?1:0,c?1:0,m||0,x||0)}const Ar=Math.pow(2,25),kc=Math.pow(2,24),is=Math.pow(2,17),Qs=Math.pow(2,16),uu=Math.pow(2,9),nc=Math.pow(2,8),bs=Math.pow(2,1);function rc(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const n=f.placed?1:0,c=Math.floor(127*f.opacity);return c*Ar+n*kc+c*is+n*Qs+c*uu+n*nc+c*bs+n}const Pl=0;class Xn{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,c,m,x,w){const A=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(A,x,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((L,P)=>L.sortKey-P.sortKey));this._currentPartIndex<A.length;){const L=A[this._currentPartIndex];if(c.placeLayerBucketPart(L,this._seenCrossTileIDs,m,L.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class ar{constructor(n,c,m,x,w,A,L,P){this.placement=new Os(n,w,A,L,P),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(n,c,m){const x=r.exported.now(),w=()=>{const A=r.exported.now()-x;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=c[n[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=L)&&(!A.maxzoom||A.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new Xn(A)),this._inProgressLayer.continuePlacement(m[A.source],this.placement,this._showCollisionBoxes,A,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const hu=512/r.EXTENT/2;class dd{constructor(n,c,m){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=m;for(let x=0;x<c.length;x++){const w=c.get(x),A=w.key;this.indexedSymbolInstances[A]||(this.indexedSymbolInstances[A]=[]),this.indexedSymbolInstances[A].push({crossTileID:w.crossTileID,coord:this.getScaledCoordinates(w,n)})}}getScaledCoordinates(n,c){const m=hu/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*r.EXTENT+n.tileAnchorX)*m),y:Math.floor((c.canonical.y*r.EXTENT+n.tileAnchorY)*m)}}findMatches(n,c,m){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let w=0;w<n.length;w++){const A=n.get(w);if(A.crossTileID)continue;const L=this.indexedSymbolInstances[A.key];if(!L)continue;const P=this.getScaledCoordinates(A,c);for(const B of L)if(Math.abs(B.coord.x-P.x)<=x&&Math.abs(B.coord.y-P.y)<=x&&!m[B.crossTileID]){m[B.crossTileID]=!0,A.crossTileID=B.crossTileID;break}}}}class du{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ol{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(c!==0)for(const m in this.indexes){const x=this.indexes[m],w={};for(const A in x){const L=x[A];L.tileID=L.tileID.unwrapTo(L.tileID.wrap+c),w[L.tileID.key]=L}this.indexes[m]=w}this.lng=n}addBucket(n,c,m){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let w=0;w<c.symbolInstances.length;w++)c.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const x=this.usedCrossTileIDs[n.overscaledZ];for(const w in this.indexes){const A=this.indexes[w];if(Number(w)>n.overscaledZ)for(const L in A){const P=A[L];P.tileID.isChildOf(n)&&P.findMatches(c.symbolInstances,n,x)}else{const L=A[n.scaledTo(Number(w)).key];L&&L.findMatches(c.symbolInstances,n,x)}}for(let w=0;w<c.symbolInstances.length;w++){const A=c.symbolInstances.get(w);A.crossTileID||(A.crossTileID=m.generate(),x[A.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new dd(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const m in c.indexedSymbolInstances)for(const x of c.indexedSymbolInstances[m])delete this.usedCrossTileIDs[n][x.crossTileID]}removeStaleBuckets(n){let c=!1;for(const m in this.indexes){const x=this.indexes[m];for(const w in x)n[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,x[w]),delete x[w],c=!0)}return c}}class Zu{constructor(){this.layerIndexes={},this.crossTileIDs=new du,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,m,x){let w=this.layerIndexes[n.id];w===void 0&&(w=this.layerIndexes[n.id]=new Ol);let A=!1;const L={};x.name!=="globe"&&w.handleWrapJump(m);for(const P of c){const B=P.getBucket(n);B&&n.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(P.tileID,B,this.crossTileIDs)&&(A=!0),L[B.bucketInstanceId]=!0)}return w.removeStaleBuckets(L)&&(A=!0),A}pruneUnusedLayers(n){const c={};n.forEach(m=>{c[m]=!0});for(const m in this.layerIndexes)c[m]||delete this.layerIndexes[m]}}const zc=(f,n)=>r.emitValidationErrors(f,n&&n.filter(c=>c.identifier!=="source.canvas")),Rl=r.pick(Oi,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),$o=r.pick(Oi,["setCenter","setZoom","setBearing","setPitch"]),Hr={version:8,layers:[],sources:{}},ea={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class xr extends r.Evented{constructor(n,c={}){super(),this.map=n,this.dispatcher=new Dn(Le(),this),this.imageManager=new ot,this.imageManager.setEventedParent(this),this.glyphManager=new r.GlyphManager(n._requestManager,c.localFontFamily?r.LocalGlyphMode.all:c.localIdeographFontFamily?r.LocalGlyphMode.ideographs:r.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new Zu,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",r.getReferrer());const m=this;this._rtlTextPluginCallback=xr.registerForPluginStateChange(x=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(w,A)=>{if(r.triggerPluginCompletionEvent(w),A&&A.every(L=>L))for(const L in m._sourceCaches){const P=m._sourceCaches[L],B=P.getSource().type;B!=="vector"&&B!=="geojson"||P.reload()}})}),this.on("data",x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getSource(x.sourceId);if(w&&w.vectorLayerIds)for(const A in this._layers){const L=this._layers[A];L.source===w.id&&this._validateLayer(L)}})}loadURL(n,c={}){this.fire(new r.Event("dataloading",{dataType:"style"}));const m=typeof c.validate=="boolean"?c.validate:!r.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,c.accessToken);const x=this.map._requestManager.transformRequest(n,r.ResourceType.Style);this._request=r.getJSON(x,(w,A)=>{this._request=null,w?this.fire(new r.ErrorEvent(w)):A&&this._load(A,m)})}loadJSON(n,c={}){this.fire(new r.Event("dataloading",{dataType:"style"})),this._request=r.exported.frame(()=>{this._request=null,this._load(n,c.validate!==!1)})}loadEmpty(){this.fire(new r.Event("dataloading",{dataType:"style"})),this._load(Hr,!1)}_updateLayerCount(n,c){const m=c?1:-1;n.is3D()&&(this._num3DLayers+=m),n.type==="circle"&&(this._numCircleLayers+=m),n.type==="symbol"&&(this._numSymbolLayers+=m)}_load(n,c){if(c&&zc(this,r.validateStyle(n)))return;this._loaded=!0,this.stylesheet=r.clone$1(n),this._updateMapProjection();for(const x in n.sources)this.addSource(x,n.sources[x],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const m=Pn(this.stylesheet.layers);this._order=m.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of m)x=r.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new _t(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new r.Event("data",{dataType:"style"})),this.fire(new r.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(c,m,x){let w,A,L;const P=r.exported.devicePixelRatio>1?"@2x":"";let B=r.getJSON(m.transformRequest(m.normalizeSpriteURL(c,P,".json"),r.ResourceType.SpriteJSON),(ee,se)=>{B=null,L||(L=ee,w=se,H())}),F=r.getImage(m.transformRequest(m.normalizeSpriteURL(c,P,".png"),r.ResourceType.SpriteImage),(ee,se)=>{F=null,L||(L=ee,A=se,H())});function H(){if(L)x(L);else if(w&&A){const ee=r.exported.getImageData(A),se={};for(const re in w){const{width:oe,height:le,x:J,y:me,sdf:fe,pixelRatio:ge,stretchX:Ae,stretchY:Te,content:De}=w[re],He=new r.RGBAImage({width:oe,height:le});r.RGBAImage.copy(ee,He,{x:J,y:me},{x:0,y:0},{width:oe,height:le}),se[re]={data:He,pixelRatio:ge,sdf:fe,stretchX:Ae,stretchY:Te,content:De}}x(null,se)}}return{cancel(){B&&(B.cancel(),B=null),F&&(F.cancel(),F=null)}}}(n,this.map._requestManager,(c,m)=>{if(this._spriteRequest=null,c)this.fire(new r.ErrorEvent(c));else if(m)for(const x in m)this.imageManager.addImage(x,m[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new r.Event("data",{dataType:"style"}))})}_validateLayer(n){const c=this.getSource(n.source);if(!c)return;const m=n.sourceLayer;m&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(m)===-1)&&this.fire(new r.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const c=[];for(const m of n){const x=this._layers[m];x.type!=="custom"&&c.push(x.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped():ea[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const c=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(x.length||w.length)&&this._updateWorkerLayers(x,w);for(const A in this._updatedSources){const L=this._updatedSources[A];L==="reload"?this._reloadSource(A):L==="clear"&&this._clearSource(A)}this._updateTilesForChangedImages();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const m={};for(const x in this._sourceCaches){const w=this._sourceCaches[x];m[x]=w.used,w.used=!1}for(const x of this._order){const w=this._layers[x];if(w.recalculate(n,this._availableImages),!w.isHidden(n.zoom)){const L=this._getLayerSourceCache(w);L&&(L.used=!0)}const A=this.map.painter;if(A){const L=w.getProgramIds();if(!L)continue;const P=w.getProgramConfiguration(n.zoom);for(const B of L)A.useProgram(B,P)}}for(const x in m){const w=this._sourceCaches[x];m[x]!==w.used&&w.getSource().fire(new r.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:w.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new r.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),zc(this,r.validateStyle(n)))return!1;(n=r.clone$1(n)).layers=Pn(n.layers);const c=function(x,w){if(!x)return[{command:Oi.setStyle,args:[w]}];let A=[];try{if(!I(x.version,w.version))return[{command:Oi.setStyle,args:[w]}];I(x.center,w.center)||A.push({command:Oi.setCenter,args:[w.center]}),I(x.zoom,w.zoom)||A.push({command:Oi.setZoom,args:[w.zoom]}),I(x.bearing,w.bearing)||A.push({command:Oi.setBearing,args:[w.bearing]}),I(x.pitch,w.pitch)||A.push({command:Oi.setPitch,args:[w.pitch]}),I(x.sprite,w.sprite)||A.push({command:Oi.setSprite,args:[w.sprite]}),I(x.glyphs,w.glyphs)||A.push({command:Oi.setGlyphs,args:[w.glyphs]}),I(x.transition,w.transition)||A.push({command:Oi.setTransition,args:[w.transition]}),I(x.light,w.light)||A.push({command:Oi.setLight,args:[w.light]}),I(x.fog,w.fog)||A.push({command:Oi.setFog,args:[w.fog]}),I(x.projection,w.projection)||A.push({command:Oi.setProjection,args:[w.projection]});const L={},P=[];(function(H,ee,se,re){let oe;for(oe in ee=ee||{},H=H||{})H.hasOwnProperty(oe)&&(ee.hasOwnProperty(oe)||In(oe,se,re));for(oe in ee)ee.hasOwnProperty(oe)&&(H.hasOwnProperty(oe)?I(H[oe],ee[oe])||(H[oe].type==="geojson"&&ee[oe].type==="geojson"&&Ys(H,ee,oe)?se.push({command:Oi.setGeoJSONSourceData,args:[oe,ee[oe].data]}):Yo(oe,ee,se,re)):wn(oe,ee,se))})(x.sources,w.sources,P,L);const B=[];x.layers&&x.layers.forEach(H=>{H.source&&L[H.source]?A.push({command:Oi.removeLayer,args:[H.id]}):B.push(H)});let F=x.terrain;F&&L[F.source]&&(A.push({command:Oi.setTerrain,args:[void 0]}),F=void 0),A=A.concat(P),I(F,w.terrain)||A.push({command:Oi.setTerrain,args:[w.terrain]}),function(H,ee,se){ee=ee||[];const re=(H=H||[]).map(Jo),oe=ee.map(Jo),le=H.reduce(qr,{}),J=ee.reduce(qr,{}),me=re.slice(),fe=Object.create(null);let ge,Ae,Te,De,He,We,Qe;for(ge=0,Ae=0;ge<re.length;ge++)Te=re[ge],J.hasOwnProperty(Te)?Ae++:(se.push({command:Oi.removeLayer,args:[Te]}),me.splice(me.indexOf(Te,Ae),1));for(ge=0,Ae=0;ge<oe.length;ge++)Te=oe[oe.length-1-ge],me[me.length-1-ge]!==Te&&(le.hasOwnProperty(Te)?(se.push({command:Oi.removeLayer,args:[Te]}),me.splice(me.lastIndexOf(Te,me.length-Ae),1)):Ae++,We=me[me.length-ge],se.push({command:Oi.addLayer,args:[J[Te],We]}),me.splice(me.length-ge,0,Te),fe[Te]=!0);for(ge=0;ge<oe.length;ge++)if(Te=oe[ge],De=le[Te],He=J[Te],!fe[Te]&&!I(De,He))if(I(De.source,He.source)&&I(De["source-layer"],He["source-layer"])&&I(De.type,He.type)){for(Qe in st(De.layout,He.layout,se,Te,null,Oi.setLayoutProperty),st(De.paint,He.paint,se,Te,null,Oi.setPaintProperty),I(De.filter,He.filter)||se.push({command:Oi.setFilter,args:[Te,He.filter]}),I(De.minzoom,He.minzoom)&&I(De.maxzoom,He.maxzoom)||se.push({command:Oi.setLayerZoomRange,args:[Te,He.minzoom,He.maxzoom]}),De)De.hasOwnProperty(Qe)&&Qe!=="layout"&&Qe!=="paint"&&Qe!=="filter"&&Qe!=="metadata"&&Qe!=="minzoom"&&Qe!=="maxzoom"&&(Qe.indexOf("paint.")===0?st(De[Qe],He[Qe],se,Te,Qe.slice(6),Oi.setPaintProperty):I(De[Qe],He[Qe])||se.push({command:Oi.setLayerProperty,args:[Te,Qe,He[Qe]]}));for(Qe in He)He.hasOwnProperty(Qe)&&!De.hasOwnProperty(Qe)&&Qe!=="layout"&&Qe!=="paint"&&Qe!=="filter"&&Qe!=="metadata"&&Qe!=="minzoom"&&Qe!=="maxzoom"&&(Qe.indexOf("paint.")===0?st(De[Qe],He[Qe],se,Te,Qe.slice(6),Oi.setPaintProperty):I(De[Qe],He[Qe])||se.push({command:Oi.setLayerProperty,args:[Te,Qe,He[Qe]]}))}else se.push({command:Oi.removeLayer,args:[Te]}),We=me[me.lastIndexOf(Te)+1],se.push({command:Oi.addLayer,args:[He,We]})}(B,w.layers,A)}catch(L){console.warn("Unable to compute style diff:",L),A=[{command:Oi.setStyle,args:[w]}]}return A}(this.serialize(),n).filter(x=>!(x.command in $o));if(c.length===0)return!1;const m=c.filter(x=>!(x.command in Rl));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);return c.forEach(x=>{x.command!=="setTransition"&&x.command!=="setProjection"&&this[x.command].apply(this,x.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,c){return this.getImage(n)?this.fire(new r.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,c),this._afterImageUpdated(n),this)}updateImage(n,c){this.imageManager.updateImage(n,c)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new r.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new r.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,c,m={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(r.validateSource,`sources.${n}`,c,null,m))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=Fe(n,c,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:x.serialize(),sourceId:n}));const w=A=>{const L=(A?"symbol:":"other:")+n,P=this._sourceCaches[L]=new r.SourceCache(L,x,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[n]=P,P.style=this,P.onAdd(this.map)};w(!1),c.type!=="vector"&&c.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const c=this.getSource(n);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===n)return this.fire(new r.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new r.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(n);for(const x of m)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new r.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getSource(n).setData(c),this._changed=!0}getSource(n){const c=this._getSourceCache(n);return c&&c.getSource()}_getSources(){const n=[];for(const c in this._otherSourceCaches){const m=this._getSourceCache(c);m&&n.push(m.getSource())}return n}addLayer(n,c,m={}){this._checkLoaded();const x=n.id;if(this.getLayer(x))return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(n.type==="custom"){if(zc(this,r.validateCustomStyleLayer(n)))return;w=r.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(x,n.source),n=r.clone$1(n),n=r.extend(n,{source:x})),this._validate(r.validateLayer,`layers.${x}`,n,{arrayIndex:-1},m))return;w=r.createStyleLayer(n),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0)}const A=c?this._order.indexOf(c):this._order.length;if(c&&A===-1)return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(A,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const L=this._getLayerSourceCache(w);if(this._removedLayers[x]&&w.source&&L&&w.type!=="custom"){const P=this._removedLayers[x];delete this._removedLayers[x],P.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",L.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,c){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===c)return;const m=this._order.indexOf(n);this._order.splice(m,1);const x=c?this._order.indexOf(c):this._order.length;c&&x===-1?this.fire(new r.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(x,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const c=this._layers[n];if(!c)return void this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const m=this._order.indexOf(n);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=c,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,m){this._checkLoaded();const x=this.getLayer(n);x?x.minzoom===c&&x.maxzoom===m||(c!=null&&(x.minzoom=c),m!=null&&(x.maxzoom=m),this._updateLayer(x)):this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,c,m={}){this._checkLoaded();const x=this.getLayer(n);if(x){if(!I(x.filter,c))return c==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(r.validateFilter,`layers.${x.id}.filter`,c,{layerType:x.type},m)||(x.filter=r.clone$1(c),this._updateLayer(x)))}else this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const c=this.getLayer(n);return c&&r.clone$1(c.filter)}setLayoutProperty(n,c,m,x={}){this._checkLoaded();const w=this.getLayer(n);w?I(w.getLayoutProperty(c),m)||(w.setLayoutProperty(c,m,x),this._updateLayer(w)):this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,c){const m=this.getLayer(n);if(m)return m.getLayoutProperty(c);this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,c,m,x={}){this._checkLoaded();const w=this.getLayer(n);w?I(w.getPaintProperty(c),m)||(w.setPaintProperty(c,m,x)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,c){const m=this.getLayer(n);return m&&m.getPaintProperty(c)}setFeatureState(n,c){this._checkLoaded();const m=n.source,x=n.sourceLayer,w=this.getSource(m);if(!w)return void this.fire(new r.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const A=w.type;if(A==="geojson"&&x)return void this.fire(new r.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!x)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided.")));const L=this._getSourceCaches(m);for(const P of L)P.setFeatureState(x,n.id,c)}removeFeatureState(n,c){this._checkLoaded();const m=n.source,x=this.getSource(m);if(!x)return void this.fire(new r.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const w=x.type,A=w==="vector"?n.sourceLayer:void 0;if(w==="vector"&&!A)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new r.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const L=this._getSourceCaches(m);for(const P of L)P.removeFeatureState(A,n.id,c)}getFeatureState(n){this._checkLoaded();const c=n.source,m=n.sourceLayer,x=this.getSource(c);if(x){if(x.type!=="vector"||m)return n.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(m,n.id);this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new r.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return r.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const c in this._sourceCaches){const m=this._sourceCaches[c].getSource();n[m.id]||(n[m.id]=m.serialize())}return r.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const c=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&c&&c.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",c.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=A=>this._layers[A].type==="fill-extrusion",m={},x=[];for(let A=this._order.length-1;A>=0;A--){const L=this._order[A];if(c(L)){m[L]=A;for(const P of n){const B=P[L];if(B)for(const F of B)x.push(F)}}}x.sort((A,L)=>L.intersectionZ-A.intersectionZ);const w=[];for(let A=this._order.length-1;A>=0;A--){const L=this._order[A];if(c(L))for(let P=x.length-1;P>=0;P--){const B=x[P].feature;if(m[B.layer.id]<A)break;w.push(B),x.pop()}else for(const P of n){const B=P[L];if(B)for(const F of B)w.push(F.feature)}}return w}queryRenderedFeatures(n,c,m){c&&c.filter&&this._validate(r.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const x={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new r.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of c.layers){const B=this._layers[P];if(!B)return this.fire(new r.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];x[B.source]=!0}}const w=[];c.availableImages=this._availableImages;const A=c&&c.layers?c.layers.some(P=>{const B=this.getLayer(P);return B&&B.is3D()}):this.has3DLayers(),L=ui.createFromScreenPoints(n,m);for(const P in this._sourceCaches){const B=this._sourceCaches[P].getSource().id;c.layers&&!x[B]||w.push(Ke(this._sourceCaches[P],this._layers,this._serializedLayers,L,c,m,A,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(P,B,F,H,ee,se,re){const oe={},le=se.queryRenderedSymbols(H),J=[];for(const me of Object.keys(le).map(Number))J.push(re[me]);J.sort(Xt);for(const me of J){const fe=me.featureIndex.lookupSymbolFeatures(le[me.bucketInstanceId],B,me.bucketIndex,me.sourceLayerIndex,ee.filter,ee.layers,ee.availableImages,P);for(const ge in fe){const Ae=oe[ge]=oe[ge]||[],Te=fe[ge];Te.sort((De,He)=>{const We=me.featureSortOrder;if(We){const Qe=We.indexOf(De.featureIndex);return We.indexOf(He.featureIndex)-Qe}return He.featureIndex-De.featureIndex});for(const De of Te)Ae.push(De)}}for(const me in oe)oe[me].forEach(fe=>{const ge=fe.feature,Ae=F(P[me]).getFeatureState(ge.layer["source-layer"],ge.id);ge.source=ge.layer.source,ge.layer["source-layer"]&&(ge.sourceLayer=ge.layer["source-layer"]),ge.state=Ae});return oe}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),L.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(n,c){c&&c.filter&&this._validate(r.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const m=this._getSourceCaches(n);let x=[];for(const w of m)x=x.concat(vt(w,c));return x}addSourceType(n,c,m){return xr.getSourceType(n)?m(new Error(`A source type called "${n}" already exists.`)):(xr.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(n,c={}){this._checkLoaded();const m=this.light.getLight();let x=!1;for(const A in n)if(!I(n[A],m[A])){x=!0;break}if(!x)return;const w=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,c),this.light.updateTransitions(w)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,c=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(c===1){if(typeof n.source=="object"){const m="terrain-dem-src";this.addSource(m,n.source),n=r.clone$1(n),n=r.extend(n,{source:m})}if(this._validate(r.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(n,c);else{const m=this.terrain,x=m.get();for(const w of Object.keys(r.spec.terrain))!n.hasOwnProperty(w)&&r.spec.terrain[w].default&&(n[w]=r.spec.terrain[w].default);for(const w in n)if(!I(n[w],x[w])){m.set(n),this.stylesheet.terrain=n;const A=this._setTransitionParameters({duration:0});m.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new Ni(n,this.map.transform);this.stylesheet.fog=n;const m=this._setTransitionParameters({duration:0});c.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,m=c.get();Object.keys(n).length===0&&c.set(n);for(const x in n)if(!I(n[x],m[x])){c.set(n),this.stylesheet.fog=n;const w=this._setTransitionParameters({duration:0});c.updateTransitions(w);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:r.exported.now(),transition:r.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(m=>this.isLayerDraped(this._layers[m])),c=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const m=this.terrain=new Vi(n,c);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const x=this._setTransitionParameters({duration:0});m.updateTransitions(x)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="symbol"&&this._updateLayer(c)}}_validate(n,c,m,x,w={}){return(!w||w.validate!==!1)&&zc(this,n.call(r.validateStyle,r.extend({key:c,style:this.serialize(),value:m,styleSpec:r.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const c=this._getSourceCaches(n);for(const m of c)m.clearTiles()}_reloadSource(n){const c=this._getSourceCaches(n);for(const m of c)m.resume(),m.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const c in this._sourceCaches)this._sourceCaches[c].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,m,x,w=!1){let A=!1,L=!1;const P={};for(const B of this._order){const F=this._layers[B];if(F.type!=="symbol")continue;if(!P[F.source]){const ee=this._getLayerSourceCache(F);if(!ee)continue;P[F.source]=ee.getRenderableIds(!0).map(se=>ee.getTileByID(se)).sort((se,re)=>re.tileID.overscaledZ-se.tileID.overscaledZ||(se.tileID.isLessThan(re.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(F,P[F.source],n.center.lng,n.projection);A=A||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),w=w||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new r.Event("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.exported.now(),n.zoom))&&(this.pauseablePlacement=new ar(n,this._order,w,c,m,x,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.exported.now()),L=!0),A&&this.pauseablePlacement.placement.setStale()),L||A)for(const B of this._order){const F=this._layers[B];F.type==="symbol"&&this.placement.updateLayerOpacities(F,P[F.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,c,m){this.imageManager.getImages(c.icons,m),this._updateTilesForChangedImages();const x=w=>{w&&w.setDependencies(c.tileID.key,c.type,c.icons)};x(this._otherSourceCaches[c.source]),x(this._symbolSourceCaches[c.source])}getGlyphs(n,c,m){this.glyphManager.getGlyphs(c.stacks,m)}getResource(n,c,m){return r.makeRequest(c,m)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}_isSourceCacheLoaded(n){const c=this._getSourceCaches(n);return c.length===0?(this.fire(new r.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):c.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}xr.getSourceType=function(f){return qe[f]},xr.setSourceType=function(f,n){qe[f]=n},xr.registerForPluginStateChange=r.registerForPluginStateChange;var kl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Bc="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",wo=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,sc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,oc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Fc={},Nc={};const zl=[];ka(kl,zl),ka(wo,zl),ka(sc,zl),ka(oc,zl),Fc=On("",wo),Nc=On(oc,sc);const Ra=On(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Rs=kl,fu=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var po={background:On(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:On(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:On(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:On("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:On(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:On(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:On("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:On("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:On("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:On(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:On(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:On(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:On(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:On(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:On(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:On(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:On(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:On(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:On(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:On(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:On(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:On(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:On(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:On(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:On(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:On(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Bc),skyboxGradient:On(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Bc),skyboxCapture:On(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:On(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:On(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function ka(f,n){const c=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of c)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=m.split(" ");for(const w of x)n.includes(w)||n.push(w)}}function On(f,n){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),x={},w=[...zl];return ka(f,w),ka(n,w),{fragmentSource:f=f.replace(c,(A,L,P,B,F)=>(x[F]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${F}
varying ${P} ${B} ${F};
#else
uniform ${P} ${B} u_${F};
#endif
`:`
#ifdef HAS_UNIFORM_u_${F}
    ${P} ${B} ${F} = u_${F};
#endif
`)),vertexSource:n=n.replace(c,(A,L,P,B,F)=>{const H=B==="float"?"vec2":"vec4",ee=F.match(/color/)?"color":H;return x[F]?L==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${P} ${H} a_${F};
varying ${P} ${B} ${F};
#else
uniform ${P} ${B} u_${F};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${P} ${B} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${ee}(a_${F}, u_${F}_t);
#else
    ${P} ${B} ${F} = u_${F};
#endif
`:L==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
attribute ${P} ${H} a_${F};
#else
uniform ${P} ${B} u_${F};
#endif
`:ee==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${P} ${B} ${F} = a_${F};
#else
    ${P} ${B} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${P} ${B} ${F} = unpack_mix_${ee}(a_${F}, u_${F}_t);
#else
    ${P} ${B} ${F} = u_${F};
#endif
`}),staticAttributes:m,usedDefines:w}}class mo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,c,m,x,w,A,L){this.context=n;let P=this.boundPaintVertexBuffers.length!==x.length;for(let F=0;!P&&F<x.length;F++)this.boundPaintVertexBuffers[F]!==x[F]&&(P=!0);let B=this.boundDynamicVertexBuffers.length!==L.length;for(let F=0;!B&&F<L.length;F++)this.boundDynamicVertexBuffers[F]!==L[F]&&(B=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==m||P||B||this.boundIndexBuffer!==w||this.boundVertexOffset!==A)this.freshBind(c,m,x,w,A,L);else{n.bindVertexArrayOES.set(this.vao);for(const F of L)F&&F.bind();w&&w.dynamicDraw&&w.bind()}}freshBind(n,c,m,x,w,A){let L;const P=n.numAttributes,B=this.context,F=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=A;else{L=B.currentNumAttributes||0;for(let H=P;H<L;H++)F.disableVertexAttribArray(H)}c.enableAttributes(F,n),c.bind(),c.setVertexAttribPointers(F,n,w);for(const H of m)H.enableAttributes(F,n),H.bind(),H.setVertexAttribPointers(F,n,w);for(const H of A)H&&(H.enableAttributes(F,n),H.bind(),H.setVertexAttribPointers(F,n,w));x&&x.bind(),B.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function sl(f,n){const c=Math.pow(2,n.canonical.z),m=n.canonical.y;return[new r.MercatorCoordinate(0,m/c).toLngLat().lat,new r.MercatorCoordinate(0,(m+1)/c).toLngLat().lat]}function za(f,n,c,m,x,w,A){const L=f.context,P=L.gl,B=c.fbo;if(!B)return;f.prepareDrawTile();const F=f.useProgram("hillshade");L.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,B.colorAttachment.get());const H=((oe,le,J,me)=>{const fe=J.paint.get("hillshade-shadow-color"),ge=J.paint.get("hillshade-highlight-color"),Ae=J.paint.get("hillshade-accent-color");let Te=J.paint.get("hillshade-illumination-direction")*(Math.PI/180);J.paint.get("hillshade-illumination-anchor")==="viewport"&&(Te-=oe.transform.angle);const De=!oe.options.moving;return{u_matrix:me||oe.transform.calculateProjMatrix(le.tileID.toUnwrapped(),De),u_image:0,u_latrange:sl(0,le.tileID),u_light:[J.paint.get("hillshade-exaggeration"),Te],u_shadow:fe,u_highlight:ge,u_accent:Ae}})(f,c,m,f.terrain?n.projMatrix:null);f.prepareDrawProgram(L,F,n.toUnwrapped());const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:se,tileBoundsSegments:re}=f.getTileBoundsBuffers(c);F.draw(L,P.TRIANGLES,x,w,A,r.CullFaceMode.disabled,H,m.id,ee,se,re)}function Qn(f,n,c){if(!n.needsDEMTextureUpload)return;const m=f.context,x=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(c.stride);const w=c.getPixels();n.demTexture?n.demTexture.update(w,{premultiply:!1}):n.demTexture=new r.Texture(m,w,x.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function ta(f,n,c,m,x,w){const A=f.context,L=A.gl;if(!n.dem)return;const P=n.dem;if(A.activeTexture.set(L.TEXTURE1),Qn(f,n,P),!n.demTexture)return;n.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);const B=P.dim;A.activeTexture.set(L.TEXTURE0);let F=n.fbo;if(!F){const re=new r.Texture(A,{width:B,height:B,data:null},L.RGBA);re.bind(L.LINEAR,L.CLAMP_TO_EDGE),F=n.fbo=A.createFramebuffer(B,B,!0),F.colorAttachment.set(re.texture)}A.bindFramebuffer.set(F.framebuffer),A.viewport.set([0,0,B,B]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:ee,tileBoundsSegments:se}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(A,L.TRIANGLES,m,x,w,r.CullFaceMode.disabled,((re,oe)=>{const le=oe.stride,J=r.create();return r.ortho(J,0,r.EXTENT,-r.EXTENT,0,0,1),r.translate(J,J,[0,-r.EXTENT,0]),{u_matrix:J,u_image:1,u_dimension:[le,le],u_zoom:re.overscaledZ,u_unpack:oe.unpackVector}})(n.tileID,P),c.id,H,ee,se),n.needsHillshadePrepare=!1}const ac=f=>({u_matrix:new r.UniformMatrix4f(f),u_image0:new r.Uniform1i(f),u_skirt_height:new r.Uniform1f(f)}),Xu=(f,n)=>({u_matrix:f,u_image0:0,u_skirt_height:n}),lc=(f,n,c,m,x,w,A,L,P,B,F,H,ee,se,re)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:A,u_frustum_tr:L,u_frustum_br:P,u_frustum_bl:B,u_globe_pos:F,u_globe_radius:H,u_viewport:ee,u_grid_matrix:re?Float32Array.from(re):new Float32Array(9),u_skirt_height:se});function Ku(f,n){return f!=null&&n!=null&&!(!f.hasData()||!n.hasData())&&f.demTexture!=null&&n.demTexture!=null&&f.tileID.key!==n.tileID.key}const Ba=new class{constructor(){this.operations={}}newMorphing(f,n,c,m,x){if(f in this.operations){const w=this.operations[f];w.to.tileID.key!==c.tileID.key&&(w.queued=c)}else this.operations[f]={startTime:m,phase:0,duration:x,from:n,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const c=this.operations[n];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Fa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ia(f){return 6*Math.pow(1.5,22-f)}function _o(f,n){const c=1<<f.z;return!n&&(f.x===0||f.x===c-1)||f.y===0||f.y===c-1}const $i=f=>({u_matrix:f});function ol(f,n,c,m,x){if(x>0){const w=r.exported.now(),A=(w-f.timeAdded)/x,L=n?(w-n.timeAdded)/x:-1,P=c.getSource(),B=m.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),F=!n||Math.abs(n.tileID.overscaledZ-B)>Math.abs(f.tileID.overscaledZ-B),H=F&&f.refreshedUponExpiration?1:r.clamp(F?A:1-L,0,1);return f.refreshedUponExpiration&&A>=1&&(f.refreshedUponExpiration=!1),n?{opacity:1,mix:1-H}:{opacity:H,mix:0}}return{opacity:1,mix:0}}class fa extends r.SourceCache{constructor(n){const c={type:"raster-dem",maxzoom:n.transform.maxZoom},m=new Dn(Le(),null),x=Fe("mock-dem",c,m,n.style);super("mock-dem",x,!1),x.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class Yu extends r.SourceCache{constructor(n){const c=Fe("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new Dn(Le(),null),n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,m){if(n.freezeTileCoverage)return;this.transform=n;const x=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,A)=>{if(w[A.key]="",!this._tiles[A.key]){const L=new r.Tile(A,this._source.tileSize*A.overscaleFactor(),n.tileZoom);L.state="loaded",this._tiles[A.key]=L}return w},{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(n){const c=this.proxyCachedFBO[n];if(c!==void 0){const m=Object.values(c);this.renderCachePool.push(...m),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class al extends r.OverscaledTileID{constructor(n,c,m){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=m}}class Na extends r.Elevation{constructor(n,c){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,x,w]=function(P){const B=new r.StructArrayLayout2i4,F=new r.StructArrayLayout3ui6,H=131;B.reserve(17161),F.reserve(33800);const ee=r.EXTENT/128,se=r.EXTENT+ee/2,re=se+ee;for(let le=-ee;le<re;le+=ee)for(let J=-ee;J<re;J+=ee){const me=J<0||J>se||le<0||le>se?24575:0,fe=r.clamp(Math.round(J),0,r.EXTENT),ge=r.clamp(Math.round(le),0,r.EXTENT);B.emplaceBack(fe+me,ge)}const oe=(le,J)=>{const me=J*H+le;F.emplaceBack(me+1,me,me+H),F.emplaceBack(me+H,me+H+1,me+1)};for(let le=1;le<129;le++)for(let J=1;J<129;J++)oe(J,le);return[0,129].forEach(le=>{for(let J=0;J<130;J++)oe(J,le),oe(le,J)}),[B,F,32768]}(),A=n.context;this.gridBuffer=A.createVertexBuffer(m,r.posAttributes.members),this.gridIndexBuffer=A.createIndexBuffer(x),this.gridSegments=r.SegmentVector.simpleSegment(0,0,m.length,x.length),this.gridNoSkirtSegments=r.SegmentVector.simpleSegment(0,0,m.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Yu(c.map),this.orthoMatrix=r.create(),r.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.EXTENT,0,r.EXTENT,0,1);const L=A.gl;this._overlapStencilMode=new r.StencilMode({func:L.GEQUAL,mask:255},0,255,L.KEEP,L.KEEP,L.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new fa(c.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,c,m){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const x=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const w=()=>{this.sourceCache.used&&r.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const A=this.getScaledDemTileSize();this.sourceCache.update(c,A,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,w(),this._initializing=!0),w(),c.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&r.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(P=>{const B=c.getTileByID(P).tileID;return B.projMatrix=m.calculateProjMatrix(B.toUnwrapped()),B});(function(P,B){const F=B.transform.pointCoordinate(B.transform.getCameraPoint()),H=new r.pointGeometry(F.x,F.y);P.sort((ee,se)=>{if(se.overscaledZ-ee.overscaledZ)return se.overscaledZ-ee.overscaledZ;const re=new r.pointGeometry(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),oe=new r.pointGeometry(se.canonical.x+(1<<se.canonical.z)*se.wrap,se.canonical.y),le=H.mult(1<<ee.canonical.z);return le.x-=.5,le.y-=.5,le.distSqr(re)-le.distSqr(oe)})})(x,this.painter),this._previousZoom=m.zoom;const w=this.proxyToSource||{};this.proxyToSource={},x.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const A=this._style._sourceCaches;for(const P in A){const B=A[P];if(!B.used||(B!==this.sourceCache&&this.resetTileLookupCache(B.id),this._setupProxiedCoordsForOrtho(B,n[P],w),B.usedForTerrain))continue;const F=n[P];B.getSource().reparseOverscaled&&this._assignTerrainTiles(F)}this.proxiedCoords[c.id]=x.map(P=>new al(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1,this._updateTimestamp=r.exported.now();const L={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const B=this.terrainTileForTile[P.key];if(!B)continue;const F=B.tileID.key;F in L||(this._visibleDemTiles.push(B),L[F]=F)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const m=this._findTileCoveringTileID(c,this.sourceCache);m&&(this.terrainTileForTile[c.key]=m)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const m in this.terrainTileForTile){const x=this.terrainTileForTile[m],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),Qn(this.painter,x,w))}}_prepareDemTileUniforms(n,c,m,x){if(!c||c.demTexture==null)return!1;const w=n.tileID.canonical,A=Math.pow(2,c.tileID.canonical.z-w.z),L=x||"";return m[`u_dem_tl${L}`]=[w.x*A%1,w.y*A%1],m[`u_dem_scale${L}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,c=n.gl;if(!this._emptyDepthBufferTexture){const m=new r.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.Texture(n,m,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const c=this._visibleDemTiles.reduce((m,x)=>{if(!x.dem)return m;const w=x.dem.tree.minimums[0];return w>0&&n++,m+w},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const m=this._getLoadedAreaMinimum(),x=new r.RGBAImage({width:1,height:1},new Uint8Array(r.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new r.Texture(n,x,c.RGBA,{premultiply:!1}),w}setupElevationDraw(n,c,m){const x=this.painter.context,w=x.gl,A=(L=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:r.DEMData.getUnpackVector(L),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var L;A.u_dem_size=this.sourceCache.getSource().tileSize,A.u_exaggeration=this.exaggeration();let P=null,B=null,F=1;if(m&&m.morphing&&this._useVertexMorphing){const H=m.morphing.srcDemTile,ee=m.morphing.dstDemTile;F=m.morphing.phase,H&&ee&&(this._prepareDemTileUniforms(n,H,A,"_prev")&&(B=H),this._prepareDemTileUniforms(n,ee,A)&&(P=ee))}if(B&&P?(x.activeTexture.set(w.TEXTURE2),P.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),x.activeTexture.set(w.TEXTURE4),B.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE,w.NEAREST),A.u_dem_lerp=F):(P=this.terrainTileForTile[n.tileID.key],x.activeTexture.set(w.TEXTURE2),(this._prepareDemTileUniforms(n,P,A)?P.demTexture:this.emptyDEMTexture).bind(w.NEAREST,w.CLAMP_TO_EDGE)),x.activeTexture.set(w.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&P){const H=(1<<P.tileID.canonical.z)*r.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=H}if(m&&m.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),c.setTerrainUniformValues(x,A),this.painter.transform.projection.name==="globe"){const H=this.globeUniformValues(this.painter.transform,n.tileID.canonical,m&&m.useDenormalizedUpVectorScale);c.setGlobeUniformValues(x,H)}}globeUniformValues(n,c,m){const x=n.projection;return{u_tile_tl_up:x.upVector(c,0,0),u_tile_tr_up:x.upVector(c,r.EXTENT,0),u_tile_br_up:x.upVector(c,r.EXTENT,r.EXTENT),u_tile_bl_up:x.upVector(c,0,r.EXTENT),u_tile_up_scale:m?r.globeMetersToEcef(1):x.upVectorScale(c,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const c=this.painter,m=this.painter.context;n.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(x,w,A,L,P){if(x.transform.projection.name==="globe")(function(B,F,H,ee,se){const re=B.context,oe=re.gl;let le,J;const me=B.options.showTerrainWireframe?2:0,fe=B.transform,ge=r.globeUseCustomAntiAliasing(B,re,fe),Ae=(Ct,Ye)=>{if(J===Ct)return;const Ge=[Fa[Ct],"PROJECTION_GLOBE_VIEW"];ge&&Ge.push("CUSTOM_ANTIALIASING"),Ye&&Ge.push(Fa[me]),le=B.useProgram("globeRaster",null,Ge),J=Ct},Te=B.colorModeForRenderPass(),De=new r.DepthMode(oe.LEQUAL,r.DepthMode.ReadWrite,B.depthRangeFor3D);Ba.update(se);const He=r.calculateGlobeMercatorMatrix(fe),We=[r.mercatorXfromLng(fe.center.lng),r.mercatorYfromLat(fe.center.lat)],Qe=me?[!1,!0]:[!1],Ut=B.globeSharedBuffers,Xe=[fe.width*r.exported.devicePixelRatio,fe.height*r.exported.devicePixelRatio],pt=Float32Array.from(fe.globeMatrix),it={useDenormalizedUpVectorScale:!0};if(Qe.forEach(Ct=>{const Ye=B.transform,Ge=ia(Ye.zoom)*F.exaggeration();J=-1;const tt=Ct?oe.LINES:oe.TRIANGLES;for(const bt of ee){const At=H.getTile(bt),bi=r.StencilMode.disabled,fn=F.prevTerrainTileForTile[bt.key],di=F.terrainTileForTile[bt.key];Ku(fn,di)&&Ba.newMorphing(bt.key,fn,di,se,250),re.activeTexture.set(oe.TEXTURE0),At.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const si=Ba.getMorphValuesForProxy(bt.key),Ti=si?1:0;si&&r.extend$1(it,{morphing:{srcDemTile:si.from,dstDemTile:si.to,phase:r.easeCubicInOut(si.phase)}});const Mn=r.tileCornersToBounds(bt.canonical),Li=r.getLatitudinalLod(Mn.getCenter().lat),Jn=r.getGridMatrix(bt.canonical,Mn,Li,Ye.worldSize/Ye._pixelsPerMercatorPixel),or=r.globeNormalizeECEF(r.globeTileBounds(bt.canonical)),br=lc(Ye.projMatrix,pt,He,or,r.globeToMercatorTransition(Ye.zoom),We,Ye.frustumCorners.TL,Ye.frustumCorners.TR,Ye.frustumCorners.BR,Ye.frustumCorners.BL,Ye.globeCenterInViewSpace,Ye.globeRadius,Xe,Ge,Jn);if(Ae(Ti,Ct),F.setupElevationDraw(At,le,it),B.prepareDrawProgram(re,le,bt.toUnwrapped()),Ut){const[lr,os,Ao]=Ct?Ut.getWirefameBuffers(B.context,Li):Ut.getGridBuffers(Li,Ge!==0);le.draw(re,tt,De,bi,Te,r.CullFaceMode.backCCW,br,"globe_raster",lr,os,Ao)}}}),Ut){const Ct=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ge&&Ct.push("CUSTOM_ANTIALIASING"),le=B.useProgram("globeRaster",null,Ct);for(const Ye of ee){const{x:Ge,y:tt,z:bt}=Ye.canonical,At=tt===0,bi=tt===(1<<bt)-1,[fn,di,si,Ti]=Ut.getPoleBuffers(bt);if(Ti&&(At||bi)){const Mn=H.getTile(Ye);re.activeTexture.set(oe.TEXTURE0),Mn.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);let Li=r.globePoleMatrixForTile(bt,Ge,fe);const Jn=r.globeNormalizeECEF(r.globeTileBounds(Ye.canonical)),or=(br,lr)=>br.draw(re,oe.TRIANGLES,De,r.StencilMode.disabled,Te,r.CullFaceMode.disabled,lc(fe.projMatrix,Li,Li,Jn,0,We,fe.frustumCorners.TL,fe.frustumCorners.TR,fe.frustumCorners.BR,fe.frustumCorners.BL,fe.globeCenterInViewSpace,fe.globeRadius,Xe,0),"globe_pole_raster",lr,si,Ti);F.setupElevationDraw(Mn,le,it),B.prepareDrawProgram(re,le,Ye.toUnwrapped()),At&&or(le,fn),bi&&(Li=r.scale(r.create(),Li,[1,-1,1]),or(le,di))}}}})(x,w,A,L,P);else{const B=x.context,F=B.gl;let H,ee;const se=x.options.showTerrainWireframe?2:0,re=(fe,ge)=>{if(ee===fe)return;const Ae=[Fa[fe]];ge&&Ae.push(Fa[se]),H=x.useProgram("terrainRaster",null,Ae),ee=fe},oe=x.colorModeForRenderPass(),le=new r.DepthMode(F.LEQUAL,r.DepthMode.ReadWrite,x.depthRangeFor3D);Ba.update(P);const J=x.transform,me=ia(J.zoom)*w.exaggeration();(se?[!1,!0]:[!1]).forEach(fe=>{ee=-1;const ge=fe?F.LINES:F.TRIANGLES,[Ae,Te]=fe?w.getWirefameBuffer():[w.gridIndexBuffer,w.gridSegments];for(const De of L){const He=A.getTile(De),We=r.StencilMode.disabled,Qe=w.prevTerrainTileForTile[De.key],Ut=w.terrainTileForTile[De.key];Ku(Qe,Ut)&&Ba.newMorphing(De.key,Qe,Ut,P,250),B.activeTexture.set(F.TEXTURE0),He.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE,F.LINEAR_MIPMAP_NEAREST);const Xe=Ba.getMorphValuesForProxy(De.key),pt=Xe?1:0;let it;Xe&&(it={morphing:{srcDemTile:Xe.from,dstDemTile:Xe.to,phase:r.easeCubicInOut(Xe.phase)}});const Ct=Xu(De.projMatrix,_o(De.canonical,J.renderWorldCopies)?me/10:me);re(pt,fe),w.setupElevationDraw(He,H,it),x.prepareDrawProgram(B,H,De.toUnwrapped()),H.draw(B,ge,le,We,oe,r.CullFaceMode.backCCW,Ct,"terrain_raster",w.gridBuffer,Ae,Te)}})}}(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const c=this.painter,m=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],A=this._drapedRenderBatches.shift(),L=[],P=c.style.order;let B=0;for(const F of w){const H=x.getTileByID(F.proxyTileKey),ee=x.proxyCachedFBO[F.key]?x.proxyCachedFBO[F.key][n]:void 0,se=ee!==void 0?x.renderCache[ee]:this.pool[B++],re=ee!==void 0;if(H.texture=se.tex,re&&!se.dirty){L.push(H.tileID);continue}let oe;m.bindFramebuffer.set(se.fb.framebuffer),this.renderedToTile=!1,se.dirty&&(m.clear({color:r.Color.transparent,stencil:0}),se.dirty=!1);for(let le=A.start;le<=A.end;++le){const J=c.style._layers[P[le]];if(J.isHidden(c.transform.zoom))continue;const me=c.style._getLayerSourceCache(J),fe=me?this.proxyToSource[F.key][me.id]:[F];if(!fe)continue;const ge=fe;m.viewport.set([0,0,se.fb.width,se.fb.height]),oe!==(me?me.id:null)&&(this._setupStencil(se,fe,J,me),oe=me?me.id:null),c.renderLayer(c,me,J,ge)}this.renderedToTile?(se.dirty=!0,L.push(H.tileID)):re||--B,B===5&&(B=0,this.renderToBackBuffer(L))}return this.renderToBackBuffer(L),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,c.width,c.height]),A.end+1}postRender(){}renderCacheEfficiency(n){const c=n.order.length;if(c===0)return{efficiency:100};let m,x=0,w=0,A=!1;for(let L=0;L<c;++L){const P=n._layers[n.order[L]];this._style.isLayerDraped(P)?(A&&++x,++w):A||(A=!0,m=P.id)}return w===0?{efficiency:100}:{efficiency:100*(1-x/w),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,c,m){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const A=w.tileID,L=1<<A.overscaledZ,{x:P,y:B}=A.canonical,F=P/L,H=(P+1)/L,ee=B/L,se=(B+1)/L;return{minx:F,miny:ee,maxx:H,maxy:se,t:w.dem.tree.raycastRoot(F,ee,H,se,n,c,m),tile:w}});x.sort((w,A)=>(w.t!==null?w.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const w of x){if(w.t==null)return null;const A=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,n,c,m);if(A!=null)return A}return null}_createFBO(){const n=this.painter.context,c=n.gl,m=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const x=new r.Texture(n,{width:m[0],height:m[1],data:null},c.RGBA);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const w=n.createFramebuffer(m[0],m[1],!1);return w.colorAttachment.set(x.texture),w.depthAttachment=new Ps(n,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._layers[n],m=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!m&&c.shouldRedrape():!m&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const m of this._style._getSources())if(m instanceof q){n=!0;break}if(!n)return;const c={};for(let m=0;m<this._style.order.length;++m){const x=this._style._layers[this._style.order[m]],w=this._style._getLayerSourceCache(x);if(w&&!c[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof r.ZoomDependentExpression){c[w.id]=!0;for(const A of this.proxyCoords){const L=this.proxyToSource[A.key][w.id];if(L)for(const P of L)this._clearRenderCacheForTile(w.id,P)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof K){n=!0;break}if(!n)return;const c={};for(let m=0;m<this._style.order.length;++m){const x=this._style._layers[this._style.order[m]],w=this._style._getLayerSourceCache(x);if(!w||c[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const A=x.paint.get("raster-fade-duration");for(const L of this.proxyCoords){const P=this.proxyToSource[L.key][w.id];if(P)for(const B of P){const F=ol(w.getTile(B),w.findLoadedParent(B,0),w,this.painter.transform,A);(F.opacity!==1||F.mix!==0)&&this._clearRenderCacheForTile(w.id,B)}}}}_setupDrapedRenderBatches(){const n=this._style.order,c=n.length;if(c===0)return;const m=[];let x,w=0,A=this._style._layers[n[w]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++w<c;)A=this._style._layers[n[w]];for(;w<c;++w){const L=this._style._layers[n[w]];L.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(L)?x===void 0&&(x=w):x!==void 0&&(m.push({start:x,end:w-1}),x=void 0))}x!==void 0&&m.push({start:x,end:w-1}),this._drapedRenderBatches=m}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const A=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let L=0;L<A.length;++L){const P=Object.values(A[L]);c.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,x=this._tilesDirty;for(let A=m.length-1;A>=0;A--){const L=m[A];if(c.getTileByID(L.key),c.proxyCachedFBO[L.key]!==void 0){const P=n[L.key],B=this.proxyToSource[L.key];let F=0;for(const H in B){const ee=B[H],se=P[H];if(!se||se.length!==ee.length||ee.some((re,oe)=>re!==se[oe]||x[H]&&x[H].hasOwnProperty(re.key))){F=-1;break}++F}for(const H in c.proxyCachedFBO[L.key])c.renderCache[c.proxyCachedFBO[L.key][H]].dirty=F<0||F!==Object.values(P).length}}const w=[...this._drapedRenderBatches];w.sort((A,L)=>L.end-L.start-(A.end-A.start));for(const A of w)for(const L of m){if(c.proxyCachedFBO[L.key])continue;let P=c.renderCachePool.pop();P===void 0&&c.renderCache.length<50&&(P=c.renderCache.length,c.renderCache.push(this._createFBO())),P!==void 0&&(c.proxyCachedFBO[L.key]={},c.proxyCachedFBO[L.key][A.start]=P,c.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,m,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,A=w.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let L;if(m.isTileClipped())L=c.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);L=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+L>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=L,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):r.StencilMode.disabled}_renderTileClippingMasks(n,c){const m=this.painter,x=this.painter.context,w=x.gl;m._tileClippingMaskIDs={},x.setColorMode(r.ColorMode.disabled),x.setDepthMode(r.DepthMode.disabled);const A=m.useProgram("clippingMask");for(const L of n){const P=m._tileClippingMaskIDs[L.key]=--c;A.draw(x,w.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:w.ALWAYS,mask:0},P,255,w.KEEP,w.KEEP,w.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,$i(L.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const m=[n.x,n.y,1,1];r.transformMat4$1(m,m,c.pixelMatrixInverse),r.scale$1(m,m,1/m[3]),m[0]/=c.worldSize,m[1]/=c.worldSize;const x=c._camera.position,w=r.mercatorZfromAltitude(1,c.center.lat),A=[x[0],x[1],x[2]/w,0],L=r.subtract([],m.slice(0,3),A);r.normalize(L,L);const P=this.raycast(A,L,this._exaggeration);return P!==null&&P?(r.scaleAndAdd(A,A,L,P),A[3]=A[2],A[2]*=w,A):null}drawDepth(){const n=this.painter,c=n.context,m=this.proxySourceCache,x=Math.ceil(n.width),w=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===w||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const A=c.gl,L=c.createFramebuffer(x,w,!0);c.activeTexture.set(A.TEXTURE0);const P=new r.Texture(c,{width:x,height:w,data:null},A.RGBA);P.bind(A.NEAREST,A.CLAMP_TO_EDGE),L.colorAttachment.set(P.texture);const B=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,x,w);L.depthAttachment.set(B),this._depthFBO=L,this._depthTexture=P}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,x,w]),function(A,L,P,B){if(A.transform.projection.name==="globe")return;const F=A.context,H=F.gl;F.clear({depth:1});const ee=A.useProgram("terrainDepth"),se=new r.DepthMode(H.LESS,r.DepthMode.ReadWrite,A.depthRangeFor3D);for(const re of B){const oe=P.getTile(re),le=Xu(re.projMatrix,0);L.setupElevationDraw(oe,ee),ee.draw(F,H.TRIANGLES,se,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.backCCW,le,"terrain_depth",L.gridBuffer,L.gridIndexBuffer,L.gridNoSkirtSegments)}}(n,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,c,m){if(n.getSource()instanceof Ce)return this._setupProxiedCoordsForImageSource(n,c,m);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const x=this.proxiedCoords[n.id]=[],w=this.proxyCoords;for(let L=0;L<w.length;L++){const P=w[L],B=this._findTileCoveringTileID(P,n);if(B){const F=this._createProxiedId(P,B,m[P.key]&&m[P.key][n.id]);x.push(F),this.proxyToSource[P.key][n.id]=[F]}}let A=!1;for(let L=0;L<c.length;L++){const P=n.getTile(c[L]);if(!P||!P.hasData())continue;const B=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(B&&B.tileID.canonical.z!==P.tileID.canonical.z){const F=this.proxyToSource[B.tileID.key][n.id],H=this._createProxiedId(B.tileID,P,m[B.tileID.key]&&m[B.tileID.key][n.id]);F?F.splice(F.length-1,0,H):this.proxyToSource[B.tileID.key][n.id]=[H],x.push(H),A=!0}}this._sourceTilesOverlap[n.id]=A}_setupProxiedCoordsForImageSource(n,c,m){if(!n.getSource().loaded())return;const x=this.proxiedCoords[n.id]=[],w=this.proxyCoords,A=n.getSource(),L=new r.pointGeometry(A.tileID.x,A.tileID.y)._div(1<<A.tileID.z),P=A.coordinates.map(r.MercatorCoordinate.fromLngLat).reduce((F,H)=>(F.min.x=Math.min(F.min.x,H.x-L.x),F.min.y=Math.min(F.min.y,H.y-L.y),F.max.x=Math.max(F.max.x,H.x-L.x),F.max.y=Math.max(F.max.y,H.y-L.y),F),{min:new r.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),B=(F,H)=>{const ee=F.wrap+F.canonical.x/(1<<F.canonical.z),se=F.canonical.y/(1<<F.canonical.z),re=r.EXTENT/(1<<F.canonical.z),oe=H.wrap+H.canonical.x/(1<<H.canonical.z),le=H.canonical.y/(1<<H.canonical.z);return ee+re<oe+P.min.x||ee>oe+P.max.x||se+re<le+P.min.y||se>le+P.max.y};for(let F=0;F<w.length;F++){const H=w[F];for(let ee=0;ee<c.length;ee++){const se=n.getTile(c[ee]);if(!se||!se.hasData()||B(H,se.tileID))continue;const re=this._createProxiedId(H,se,m[H.key]&&m[H.key][n.id]),oe=this.proxyToSource[H.key][n.id];oe?oe.push(re):this.proxyToSource[H.key][n.id]=[re],x.push(re)}}}_createProxiedId(n,c,m){let x=this.orthoMatrix;if(m){const w=m.find(A=>A.key===c.tileID.key);if(w)return w}if(c.tileID.key!==n.key){const w=n.canonical.z-c.tileID.canonical.z;let A,L,P;x=r.create();const B=c.tileID.wrap-n.wrap<<n.overscaledZ;w>0?(A=r.EXTENT>>w,L=A*((c.tileID.canonical.x<<w)-n.canonical.x+B),P=A*((c.tileID.canonical.y<<w)-n.canonical.y)):(A=r.EXTENT<<-w,L=r.EXTENT*(c.tileID.canonical.x-(n.canonical.x+B<<-w)),P=r.EXTENT*(c.tileID.canonical.y-(n.canonical.y<<-w))),r.ortho(x,0,A,0,A,0,1),r.translate(x,x,[L,P,0])}return new al(c.tileID,n.key,x)}_findTileCoveringTileID(n,c){let m=c.getTile(n);if(m&&m.hasData())return m;const x=this._findCoveringTileCache[c.id],w=x[n.key];if(m=w?c.getTileByID(w):null,m&&m.hasData()||w===null)return m;let A=m?m.tileID:n,L=A.overscaledZ;const P=c.getSource().minzoom,B=[];if(!w){const H=c.getSource().maxzoom;if(n.canonical.z>=H){const ee=n.canonical.z-H;c.getSource().reparseOverscaled?(L=Math.max(n.canonical.z+2,c.transform.tileZoom),A=new r.OverscaledTileID(L,n.wrap,H,n.canonical.x>>ee,n.canonical.y>>ee)):ee!==0&&(L=H,A=new r.OverscaledTileID(L,n.wrap,H,n.canonical.x>>ee,n.canonical.y>>ee))}A.key!==n.key&&(B.push(A.key),m=c.getTile(A))}const F=H=>{B.forEach(ee=>{x[ee]=H}),B.length=0};for(L-=1;L>=P&&(!m||!m.hasData());L--){m&&F(m.tileID.key);const H=A.calculateScaledKey(L);if(m=c.getTileByID(H),m&&m.hasData())break;const ee=x[H];if(ee===null)break;ee===void 0?B.push(H):m=c.getTileByID(ee)}return F(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let m=this._tilesDirty[n];m||(m=this._tilesDirty[n]={}),m[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(c){let m=0;const x=new r.StructArrayLayout2ui4,w=131;for(let A=1;A<129;A++){for(let L=1;L<129;L++)m=A*w+L,x.emplaceBack(m,m+1),x.emplaceBack(m,m+w),x.emplaceBack(m+1,m+w),A===128&&x.emplaceBack(m+w,m+w+1);x.emplaceBack(m+1,m+1+w)}return x}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=r.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Uc{static cacheKey(n,c,m,x){let w=`${c}${x?x.cacheKey:""}`;for(const A of m)n.usedDefines.includes(A)&&(w+=`/${A}`);return w}constructor(n,c,m,x,w,A){const L=n.gl;this.program=L.createProgram();const P=function(J){const me=[];for(let fe=0;fe<J.length;fe++){if(J[fe]===null)continue;const ge=J[fe].split(" ");me.push(ge.pop())}return me}(m.staticAttributes),B=x?x.getBinderAttributes():[],F=P.concat(B);let H=x?x.defines():[];H=H.concat(A.map(J=>`#define ${J}`));const ee=n.isWebGL2?`#version 300 es
`:"",se=ee+H.concat(n.extStandardDerivatives&&ee.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(fu):fu,fu,Rs,Ra.fragmentSource,Nc.fragmentSource,m.fragmentSource).join(`
`),re=ee+H.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Rs,Ra.vertexSource,Nc.vertexSource,Fc.vertexSource,m.vertexSource).join(`
`),oe=L.createShader(L.FRAGMENT_SHADER);if(L.isContextLost())return void(this.failedToCreate=!0);L.shaderSource(oe,se),L.compileShader(oe),L.attachShader(this.program,oe);const le=L.createShader(L.VERTEX_SHADER);if(L.isContextLost())this.failedToCreate=!0;else{L.shaderSource(le,re),L.compileShader(le),L.attachShader(this.program,le),this.attributes={},this.numAttributes=F.length;for(let J=0;J<this.numAttributes;J++)F[J]&&(L.bindAttribLocation(this.program,J,F[J]),this.attributes[F[J]]=J);L.linkProgram(this.program),L.deleteShader(le),L.deleteShader(oe),this.fixedUniforms=w(n),this.binderUniforms=x?x.getUniforms(n):[],A.includes("TERRAIN")&&(this.terrainUniforms=(J=>({u_dem:new r.Uniform1i(J),u_dem_prev:new r.Uniform1i(J),u_dem_unpack:new r.Uniform4f(J),u_dem_tl:new r.Uniform2f(J),u_dem_scale:new r.Uniform1f(J),u_dem_tl_prev:new r.Uniform2f(J),u_dem_scale_prev:new r.Uniform1f(J),u_dem_size:new r.Uniform1f(J),u_dem_lerp:new r.Uniform1f(J),u_exaggeration:new r.Uniform1f(J),u_depth:new r.Uniform1i(J),u_depth_size_inv:new r.Uniform2f(J),u_meter_to_dem:new r.Uniform1f(J),u_label_plane_matrix_inv:new r.UniformMatrix4f(J)}))(n)),A.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new r.Uniform3f(J),u_tile_tr_up:new r.Uniform3f(J),u_tile_br_up:new r.Uniform3f(J),u_tile_bl_up:new r.Uniform3f(J),u_tile_up_scale:new r.Uniform1f(J)}))(n)),A.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new r.UniformMatrix4f(J),u_fog_range:new r.Uniform2f(J),u_fog_color:new r.Uniform4f(J),u_fog_horizon_blend:new r.Uniform1f(J),u_fog_temporal_offset:new r.Uniform1f(J),u_frustum_tl:new r.Uniform3f(J),u_frustum_tr:new r.Uniform3f(J),u_frustum_br:new r.Uniform3f(J),u_frustum_bl:new r.Uniform3f(J),u_globe_pos:new r.Uniform3f(J),u_globe_radius:new r.Uniform1f(J),u_globe_transition:new r.Uniform1f(J),u_is_globe:new r.Uniform1i(J),u_viewport:new r.Uniform2f(J)}))(n))}}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)m[x]&&m[x].set(this.program,x,c[x])}}setGlobeUniformValues(n,c){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)m[x]&&m[x].set(this.program,x,c[x])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const x in c)m[x].set(this.program,x,c[x])}}draw(n,c,m,x,w,A,L,P,B,F,H,ee,se,re,oe){const le=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(m),n.setStencilMode(x),n.setColorMode(w),n.setCullFace(A);for(const me of Object.keys(this.fixedUniforms))this.fixedUniforms[me].set(this.program,me,L[me]);re&&re.setUniforms(this.program,n,this.binderUniforms,ee,{zoom:se});const J={[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[c];for(const me of H.get()){const fe=me.vaos||(me.vaos={});(fe[P]||(fe[P]=new mo)).bind(n,this,B,re?re.getPaintVertexBuffers():[],F,me.vertexOffset,oe||[]),le.drawElements(c,me.primitiveLength*J,le.UNSIGNED_SHORT,me.primitiveOffset*J*2)}}}function Ju(f,n){const c=Math.pow(2,n.tileID.overscaledZ),m=n.tileSize*Math.pow(2,f.transform.tileZoom)/c,x=m*(n.tileID.canonical.x+n.tileID.wrap*c),w=m*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/bn(n,1,f.transform.tileZoom),u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const Qu=r.create(),cc=(f,n,c,m,x,w,A,L,P,B,F)=>{const H=n.style.light,ee=H.properties.get("position"),se=[ee.x,ee.y,ee.z],re=r.create$1();H.properties.get("anchor")==="viewport"&&(r.fromRotation(re,-n.transform.angle),r.transformMat3(se,se,re));const oe=H.properties.get("color"),le=n.transform,J={u_matrix:f,u_lightpos:se,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[oe.r,oe.g,oe.b],u_vertical_gradient:+c,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Qu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:x,u_edge_radius:w};return le.projection.name==="globe"&&(J.u_tile_id=[A.canonical.x,A.canonical.y,1<<A.canonical.z],J.u_zoom_transition=P,J.u_inv_rot_matrix=F,J.u_merc_center=B,J.u_up_dir=le.projection.upVector(new r.CanonicalTileID(0,0,0),B[0]*r.EXTENT,B[1]*r.EXTENT),J.u_height_lift=L),J},pu=(f,n,c,m,x,w,A,L,P,B,F,H)=>{const ee=cc(f,n,c,m,x,w,A,P,B,F,H),se={u_height_factor:-Math.pow(2,A.overscaledZ)/L.tileSize/8};return r.extend(ee,Ju(n,L),se)},uc=f=>({u_matrix:f}),us=(f,n,c)=>r.extend(uc(f),Ju(n,c)),Ua=(f,n)=>({u_matrix:f,u_world:n}),hc=(f,n,c,m)=>r.extend(us(f,n,c),{u_world:m}),Va=r.create(),dc=(f,n,c,m,x,w)=>{const A=f.transform,L=A.projection.name==="globe";let P;if(w.paint.get("circle-pitch-alignment")==="map")if(L){const F=r.globePixelsToTileUnits(A.zoom,n.canonical)*A._pixelsPerMercatorPixel;P=Float32Array.from([F,0,0,F])}else P=A.calculatePixelsToTileUnitsMatrix(c);else P=new Float32Array([A.pixelsToGLUnits[0],0,0,A.pixelsToGLUnits[1]]);const B={u_camera_to_center_distance:A.cameraToCenterDistance,u_matrix:f.translatePosMatrix(n.projMatrix,c,w.paint.get("circle-translate"),w.paint.get("circle-translate-anchor")),u_device_pixel_ratio:r.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:Va,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){B.u_inv_rot_matrix=m,B.u_merc_center=x,B.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],B.u_zoom_transition=r.globeToMercatorTransition(A.zoom);const F=x[0]*r.EXTENT,H=x[1]*r.EXTENT;B.u_up_dir=A.projection.upVector(new r.CanonicalTileID(0,0,0),F,H)}return B},na=f=>{const n=[];return f.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),f.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},$u=(f,n,c,m)=>{const x=r.EXTENT/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:n.getCameraToCenterDistance(m),u_extrude_scale:[n.pixelsToGLUnits[0]/x,n.pixelsToGLUnits[1]/x]}},Vc=(f,n,c=1)=>({u_matrix:f,u_color:n,u_overlay:0,u_overlay_scale:c}),fc=r.create(),Fo=(f,n,c,m,x,w,A)=>{const L=f.transform,P=L.projection.name==="globe",B=P?r.globePixelsToTileUnits(L.zoom,n.canonical)*L._pixelsPerMercatorPixel:bn(c,1,w),F={u_matrix:n.projMatrix,u_extrude_scale:B,u_intensity:A,u_inv_rot_matrix:fc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){F.u_inv_rot_matrix=m,F.u_merc_center=x,F.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],F.u_zoom_transition=r.globeToMercatorTransition(L.zoom);const H=x[0]*r.EXTENT,ee=x[1]*r.EXTENT;F.u_up_dir=L.projection.upVector(new r.CanonicalTileID(0,0,0),H,ee)}return F},Ga=(f,n,c,m,x,w,A)=>{const L=f.transform,P=L.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:ja(f,n,c,m),u_pixels_to_tile_units:P,u_device_pixel_ratio:w,u_units_to_pixels:[1/L.pixelsToGLUnits[0],1/L.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:pc(c)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Gc(n,f.transform),u_alpha_discard_threshold:0,u_trim_offset:A}},eh=(f,n,c,m,x)=>{const w=f.transform;return{u_matrix:ja(f,n,c,m),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:x,u_image:0,u_tile_units_to_pixels:Gc(n,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Gc(f,n){return 1/bn(f,1,n.tileZoom)}function ja(f,n,c,m){return f.translatePosMatrix(m||n.tileID.projMatrix,n,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function pc(f){const n=f.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const ll=(f,n,c,m,x,w)=>{return{u_matrix:f,u_tl_parent:n,u_scale_parent:c,u_fade_t:m.mix,u_opacity:m.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(L=x.paint.get("raster-saturation"),L>0?1-1/(1.001-L):-L),u_contrast_factor:(A=x.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:Ve(x.paint.get("raster-hue-rotate")),u_perspective_transform:w};var A,L};function Ve(f){f*=Math.PI/180;const n=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const ut=r.create(),ii=(f,n,c,m,x,w,A,L,P,B,F,H,ee,se,re,oe)=>{const le=x.transform,J={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:le.width/le.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:A,u_coord_matrix:L,u_is_text:+P,u_pitch_with_map:+m,u_texsize:B,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ut,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ut,u_up_vector:[0,-1,0]};return oe.name==="globe"&&(J.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],J.u_zoom_transition=H,J.u_inv_rot_matrix=se,J.u_merc_center=ee,J.u_camera_forward=le._camera.forward(),J.u_ecef_origin=r.globeECEFOrigin(le.globeMatrix,F.toUnwrapped()),J.u_tile_matrix=Float32Array.from(le.globeMatrix),J.u_up_vector=re),J},Ri=(f,n,c,m,x,w,A,L,P,B,F,H,ee,se,re,oe,le)=>r.extend(ii(f,n,c,m,x,w,A,L,P,B,H,ee,se,re,oe,le),{u_gamma_scale:m?x.transform.cameraToCenterDistance*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:r.exported.devicePixelRatio,u_is_halo:+F}),$n=(f,n,c,m,x,w,A,L,P,B,F,H,ee,se,re,oe)=>r.extend(Ri(f,n,c,m,x,w,A,L,!0,P,!0,F,H,ee,se,re,oe),{u_texsize_icon:B,u_texture_icon:1}),cn=(f,n,c)=>({u_matrix:f,u_opacity:n,u_color:c}),Or=(f,n,c,m,x)=>r.extend(function(w,A,L){const P=A.imageManager.getPattern(w.toString()),{width:B,height:F}=A.imageManager.getPixelSize(),H=Math.pow(2,L.tileID.overscaledZ),ee=L.tileSize*Math.pow(2,A.transform.tileZoom)/H,se=ee*(L.tileID.canonical.x+L.tileID.wrap*H),re=ee*L.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[B,F],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/bn(L,1,A.transform.tileZoom),u_pixel_coord_upper:[se>>16,re>>16],u_pixel_coord_lower:[65535&se,65535&re]}}(m,c,x),{u_matrix:f,u_opacity:n}),ns={fillExtrusion:f=>({u_matrix:new r.UniformMatrix4f(f),u_lightpos:new r.Uniform3f(f),u_lightintensity:new r.Uniform1f(f),u_lightcolor:new r.Uniform3f(f),u_vertical_gradient:new r.Uniform1f(f),u_opacity:new r.Uniform1f(f),u_edge_radius:new r.Uniform1f(f),u_ao:new r.Uniform2f(f),u_tile_id:new r.Uniform3f(f),u_zoom_transition:new r.Uniform1f(f),u_inv_rot_matrix:new r.UniformMatrix4f(f),u_merc_center:new r.Uniform2f(f),u_up_dir:new r.Uniform3f(f),u_height_lift:new r.Uniform1f(f)}),fillExtrusionPattern:f=>({u_matrix:new r.UniformMatrix4f(f),u_lightpos:new r.Uniform3f(f),u_lightintensity:new r.Uniform1f(f),u_lightcolor:new r.Uniform3f(f),u_vertical_gradient:new r.Uniform1f(f),u_height_factor:new r.Uniform1f(f),u_edge_radius:new r.Uniform1f(f),u_ao:new r.Uniform2f(f),u_tile_id:new r.Uniform3f(f),u_zoom_transition:new r.Uniform1f(f),u_inv_rot_matrix:new r.UniformMatrix4f(f),u_merc_center:new r.Uniform2f(f),u_up_dir:new r.Uniform3f(f),u_height_lift:new r.Uniform1f(f),u_image:new r.Uniform1i(f),u_texsize:new r.Uniform2f(f),u_pixel_coord_upper:new r.Uniform2f(f),u_pixel_coord_lower:new r.Uniform2f(f),u_tile_units_to_pixels:new r.Uniform1f(f),u_opacity:new r.Uniform1f(f)}),fill:f=>({u_matrix:new r.UniformMatrix4f(f)}),fillPattern:f=>({u_matrix:new r.UniformMatrix4f(f),u_image:new r.Uniform1i(f),u_texsize:new r.Uniform2f(f),u_pixel_coord_upper:new r.Uniform2f(f),u_pixel_coord_lower:new r.Uniform2f(f),u_tile_units_to_pixels:new r.Uniform1f(f)}),fillOutline:f=>({u_matrix:new r.UniformMatrix4f(f),u_world:new r.Uniform2f(f)}),fillOutlinePattern:f=>({u_matrix:new r.UniformMatrix4f(f),u_world:new r.Uniform2f(f),u_image:new r.Uniform1i(f),u_texsize:new r.Uniform2f(f),u_pixel_coord_upper:new r.Uniform2f(f),u_pixel_coord_lower:new r.Uniform2f(f),u_tile_units_to_pixels:new r.Uniform1f(f)}),circle:f=>({u_camera_to_center_distance:new r.Uniform1f(f),u_extrude_scale:new r.UniformMatrix2f(f),u_device_pixel_ratio:new r.Uniform1f(f),u_matrix:new r.UniformMatrix4f(f),u_inv_rot_matrix:new r.UniformMatrix4f(f),u_merc_center:new r.Uniform2f(f),u_tile_id:new r.Uniform3f(f),u_zoom_transition:new r.Uniform1f(f),u_up_dir:new r.Uniform3f(f)}),collisionBox:f=>({u_matrix:new r.UniformMatrix4f(f),u_camera_to_center_distance:new r.Uniform1f(f),u_extrude_scale:new r.Uniform2f(f)}),collisionCircle:f=>({u_matrix:new r.UniformMatrix4f(f),u_inv_matrix:new r.UniformMatrix4f(f),u_camera_to_center_distance:new r.Uniform1f(f),u_viewport_size:new r.Uniform2f(f)}),debug:f=>({u_color:new r.UniformColor(f),u_matrix:new r.UniformMatrix4f(f),u_overlay:new r.Uniform1i(f),u_overlay_scale:new r.Uniform1f(f)}),clippingMask:f=>({u_matrix:new r.UniformMatrix4f(f)}),heatmap:f=>({u_extrude_scale:new r.Uniform1f(f),u_intensity:new r.Uniform1f(f),u_matrix:new r.UniformMatrix4f(f),u_inv_rot_matrix:new r.UniformMatrix4f(f),u_merc_center:new r.Uniform2f(f),u_tile_id:new r.Uniform3f(f),u_zoom_transition:new r.Uniform1f(f),u_up_dir:new r.Uniform3f(f)}),heatmapTexture:f=>({u_image:new r.Uniform1i(f),u_color_ramp:new r.Uniform1i(f),u_opacity:new r.Uniform1f(f)}),hillshade:f=>({u_matrix:new r.UniformMatrix4f(f),u_image:new r.Uniform1i(f),u_latrange:new r.Uniform2f(f),u_light:new r.Uniform2f(f),u_shadow:new r.UniformColor(f),u_highlight:new r.UniformColor(f),u_accent:new r.UniformColor(f)}),hillshadePrepare:f=>({u_matrix:new r.UniformMatrix4f(f),u_image:new r.Uniform1i(f),u_dimension:new r.Uniform2f(f),u_zoom:new r.Uniform1f(f),u_unpack:new r.Uniform4f(f)}),line:f=>({u_matrix:new r.UniformMatrix4f(f),u_pixels_to_tile_units:new r.UniformMatrix2f(f),u_device_pixel_ratio:new r.Uniform1f(f),u_units_to_pixels:new r.Uniform2f(f),u_dash_image:new r.Uniform1i(f),u_gradient_image:new r.Uniform1i(f),u_image_height:new r.Uniform1f(f),u_texsize:new r.Uniform2f(f),u_tile_units_to_pixels:new r.Uniform1f(f),u_alpha_discard_threshold:new r.Uniform1f(f),u_trim_offset:new r.Uniform2f(f)}),linePattern:f=>({u_matrix:new r.UniformMatrix4f(f),u_texsize:new r.Uniform2f(f),u_pixels_to_tile_units:new r.UniformMatrix2f(f),u_device_pixel_ratio:new r.Uniform1f(f),u_image:new r.Uniform1i(f),u_units_to_pixels:new r.Uniform2f(f),u_tile_units_to_pixels:new r.Uniform1f(f),u_alpha_discard_threshold:new r.Uniform1f(f)}),raster:f=>({u_matrix:new r.UniformMatrix4f(f),u_tl_parent:new r.Uniform2f(f),u_scale_parent:new r.Uniform1f(f),u_fade_t:new r.Uniform1f(f),u_opacity:new r.Uniform1f(f),u_image0:new r.Uniform1i(f),u_image1:new r.Uniform1i(f),u_brightness_low:new r.Uniform1f(f),u_brightness_high:new r.Uniform1f(f),u_saturation_factor:new r.Uniform1f(f),u_contrast_factor:new r.Uniform1f(f),u_spin_weights:new r.Uniform3f(f),u_perspective_transform:new r.Uniform2f(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new r.Uniform1i(f),u_is_size_feature_constant:new r.Uniform1i(f),u_size_t:new r.Uniform1f(f),u_size:new r.Uniform1f(f),u_camera_to_center_distance:new r.Uniform1f(f),u_rotate_symbol:new r.Uniform1i(f),u_aspect_ratio:new r.Uniform1f(f),u_fade_change:new r.Uniform1f(f),u_matrix:new r.UniformMatrix4f(f),u_label_plane_matrix:new r.UniformMatrix4f(f),u_coord_matrix:new r.UniformMatrix4f(f),u_is_text:new r.Uniform1i(f),u_pitch_with_map:new r.Uniform1i(f),u_texsize:new r.Uniform2f(f),u_tile_id:new r.Uniform3f(f),u_zoom_transition:new r.Uniform1f(f),u_inv_rot_matrix:new r.UniformMatrix4f(f),u_merc_center:new r.Uniform2f(f),u_camera_forward:new r.Uniform3f(f),u_tile_matrix:new r.UniformMatrix4f(f),u_up_vector:new r.Uniform3f(f),u_ecef_origin:new r.Uniform3f(f),u_texture:new r.Uniform1i(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new r.Uniform1i(f),u_is_size_feature_constant:new r.Uniform1i(f),u_size_t:new r.Uniform1f(f),u_size:new r.Uniform1f(f),u_camera_to_center_distance:new r.Uniform1f(f),u_rotate_symbol:new r.Uniform1i(f),u_aspect_ratio:new r.Uniform1f(f),u_fade_change:new r.Uniform1f(f),u_matrix:new r.UniformMatrix4f(f),u_label_plane_matrix:new r.UniformMatrix4f(f),u_coord_matrix:new r.UniformMatrix4f(f),u_is_text:new r.Uniform1i(f),u_pitch_with_map:new r.Uniform1i(f),u_texsize:new r.Uniform2f(f),u_texture:new r.Uniform1i(f),u_gamma_scale:new r.Uniform1f(f),u_device_pixel_ratio:new r.Uniform1f(f),u_tile_id:new r.Uniform3f(f),u_zoom_transition:new r.Uniform1f(f),u_inv_rot_matrix:new r.UniformMatrix4f(f),u_merc_center:new r.Uniform2f(f),u_camera_forward:new r.Uniform3f(f),u_tile_matrix:new r.UniformMatrix4f(f),u_up_vector:new r.Uniform3f(f),u_ecef_origin:new r.Uniform3f(f),u_is_halo:new r.Uniform1i(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new r.Uniform1i(f),u_is_size_feature_constant:new r.Uniform1i(f),u_size_t:new r.Uniform1f(f),u_size:new r.Uniform1f(f),u_camera_to_center_distance:new r.Uniform1f(f),u_rotate_symbol:new r.Uniform1i(f),u_aspect_ratio:new r.Uniform1f(f),u_fade_change:new r.Uniform1f(f),u_matrix:new r.UniformMatrix4f(f),u_label_plane_matrix:new r.UniformMatrix4f(f),u_coord_matrix:new r.UniformMatrix4f(f),u_is_text:new r.Uniform1i(f),u_pitch_with_map:new r.Uniform1i(f),u_texsize:new r.Uniform2f(f),u_texsize_icon:new r.Uniform2f(f),u_texture:new r.Uniform1i(f),u_texture_icon:new r.Uniform1i(f),u_gamma_scale:new r.Uniform1f(f),u_device_pixel_ratio:new r.Uniform1f(f),u_is_halo:new r.Uniform1i(f)}),background:f=>({u_matrix:new r.UniformMatrix4f(f),u_opacity:new r.Uniform1f(f),u_color:new r.UniformColor(f)}),backgroundPattern:f=>({u_matrix:new r.UniformMatrix4f(f),u_opacity:new r.Uniform1f(f),u_image:new r.Uniform1i(f),u_pattern_tl:new r.Uniform2f(f),u_pattern_br:new r.Uniform2f(f),u_texsize:new r.Uniform2f(f),u_pattern_size:new r.Uniform2f(f),u_pixel_coord_upper:new r.Uniform2f(f),u_pixel_coord_lower:new r.Uniform2f(f),u_tile_units_to_pixels:new r.Uniform1f(f)}),terrainRaster:ac,terrainDepth:ac,skybox:f=>({u_matrix:new r.UniformMatrix4f(f),u_sun_direction:new r.Uniform3f(f),u_cubemap:new r.Uniform1i(f),u_opacity:new r.Uniform1f(f),u_temporal_offset:new r.Uniform1f(f)}),skyboxGradient:f=>({u_matrix:new r.UniformMatrix4f(f),u_color_ramp:new r.Uniform1i(f),u_center_direction:new r.Uniform3f(f),u_radius:new r.Uniform1f(f),u_opacity:new r.Uniform1f(f),u_temporal_offset:new r.Uniform1f(f)}),skyboxCapture:f=>({u_matrix_3f:new r.UniformMatrix3f(f),u_sun_direction:new r.Uniform3f(f),u_sun_intensity:new r.Uniform1f(f),u_color_tint_r:new r.Uniform4f(f),u_color_tint_m:new r.Uniform4f(f),u_luminance:new r.Uniform1f(f)}),globeRaster:f=>({u_proj_matrix:new r.UniformMatrix4f(f),u_globe_matrix:new r.UniformMatrix4f(f),u_normalize_matrix:new r.UniformMatrix4f(f),u_merc_matrix:new r.UniformMatrix4f(f),u_zoom_transition:new r.Uniform1f(f),u_merc_center:new r.Uniform2f(f),u_image0:new r.Uniform1i(f),u_grid_matrix:new r.UniformMatrix3f(f),u_skirt_height:new r.Uniform1f(f),u_frustum_tl:new r.Uniform3f(f),u_frustum_tr:new r.Uniform3f(f),u_frustum_br:new r.Uniform3f(f),u_frustum_bl:new r.Uniform3f(f),u_globe_pos:new r.Uniform3f(f),u_globe_radius:new r.Uniform1f(f),u_viewport:new r.Uniform2f(f)}),globeAtmosphere:f=>({u_frustum_tl:new r.Uniform3f(f),u_frustum_tr:new r.Uniform3f(f),u_frustum_br:new r.Uniform3f(f),u_frustum_bl:new r.Uniform3f(f),u_horizon:new r.Uniform1f(f),u_transition:new r.Uniform1f(f),u_fadeout_range:new r.Uniform1f(f),u_color:new r.Uniform4f(f),u_high_color:new r.Uniform4f(f),u_space_color:new r.Uniform4f(f),u_star_intensity:new r.Uniform1f(f),u_star_density:new r.Uniform1f(f),u_star_size:new r.Uniform1f(f),u_temporal_offset:new r.Uniform1f(f),u_horizon_angle:new r.Uniform1f(f),u_rotation_matrix:new r.UniformMatrix4f(f)})};let ks;function rs(f,n,c,m,x,w,A){const L=f.context,P=L.gl,B=f.transform,F=f.useProgram("collisionBox"),H=[];let ee=0,se=0;for(let ge=0;ge<m.length;ge++){const Ae=m[ge],Te=n.getTile(Ae),De=Te.getBucket(c);if(!De)continue;const He=Qt(Ae,De,B);let We=He;x[0]===0&&x[1]===0||(We=f.translatePosMatrix(He,Te,x,w));const Qe=A?De.textCollisionBox:De.iconCollisionBox,Ut=De.collisionCircleArray;if(Ut.length>0){const Xe=r.create(),pt=We;r.mul(Xe,De.placementInvProjMatrix,B.glCoordMatrix),r.mul(Xe,Xe,De.placementViewportMatrix),H.push({circleArray:Ut,circleOffset:se,transform:pt,invTransform:Xe,projection:De.getProjection()}),ee+=Ut.length/4,se=ee}Qe&&(f.terrain&&f.terrain.setupElevationDraw(Te,F),F.draw(L,P.LINES,r.DepthMode.disabled,r.StencilMode.disabled,f.colorModeForRenderPass(),r.CullFaceMode.disabled,$u(We,B,Te,De.getProjection()),c.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,B.zoom,null,[Qe.collisionVertexBuffer,Qe.collisionVertexBufferExt]))}if(!A||!H.length)return;const re=f.useProgram("collisionCircle"),oe=new r.StructArrayLayout2f1f2i16;oe.resize(4*ee),oe._trim();let le=0;for(const ge of H)for(let Ae=0;Ae<ge.circleArray.length/4;Ae++){const Te=4*Ae,De=ge.circleArray[Te+0],He=ge.circleArray[Te+1],We=ge.circleArray[Te+2],Qe=ge.circleArray[Te+3];oe.emplace(le++,De,He,We,Qe,0),oe.emplace(le++,De,He,We,Qe,1),oe.emplace(le++,De,He,We,Qe,2),oe.emplace(le++,De,He,We,Qe,3)}(!ks||ks.length<2*ee)&&(ks=function(ge){const Ae=2*ge,Te=new r.StructArrayLayout3ui6;Te.resize(Ae),Te._trim();for(let De=0;De<Ae;De++){const He=6*De;Te.uint16[He+0]=4*De+0,Te.uint16[He+1]=4*De+1,Te.uint16[He+2]=4*De+2,Te.uint16[He+3]=4*De+2,Te.uint16[He+4]=4*De+3,Te.uint16[He+5]=4*De+0}return Te}(ee));const J=L.createIndexBuffer(ks,!0),me=L.createVertexBuffer(oe,r.collisionCircleLayout.members,!0);for(const ge of H){const Ae={u_matrix:ge.transform,u_inv_matrix:ge.invTransform,u_camera_to_center_distance:(fe=B).getCameraToCenterDistance(ge.projection),u_viewport_size:[fe.width,fe.height]};re.draw(L,P.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,f.colorModeForRenderPass(),r.CullFaceMode.disabled,Ae,c.id,me,J,r.SegmentVector.simpleSegment(0,2*ge.circleOffset,ge.circleArray.length,ge.circleArray.length/2),null,B.zoom)}var fe;me.destroy(),J.destroy()}const Jr=r.create();function ra({width:f,height:n,anchor:c,textOffset:m,textScale:x},w){const{horizontalAlign:A,verticalAlign:L}=r.getAnchorAlignment(c),P=-(A-.5)*f,B=-(L-.5)*n,F=r.evaluateVariableOffset(c,m);return new r.pointGeometry((P/x+F[0])*w,(B/x+F[1])*w)}function hs(f,n,c,m,x,w,A,L,P,B,F){const H=f.text.placedSymbolArray,ee=f.text.dynamicLayoutVertexArray,se=f.icon.dynamicLayoutVertexArray,re={},oe=f.getProjection(),le=Hi(L,oe,w),J=w.elevation,me=oe.upVectorScale(L.canonical,w.center.lat,w.worldSize).metersToTile;ee.clear();for(let fe=0;fe<H.length;fe++){const ge=H.get(fe),{tileAnchorX:Ae,tileAnchorY:Te,numGlyphs:De}=ge,He=f.allowVerticalPlacement&&!ge.placedOrientation,We=ge.hidden||!ge.crossTileID||He?null:m[ge.crossTileID];if(We){let Qe=0,Ut=0,Xe=0;if(J){const bi=J?J.getAtTileOffset(L,Ae,Te):0,[fn,di,si]=oe.upVector(L.canonical,Ae,Te);Qe=bi*fn*me,Ut=bi*di*me,Xe=bi*si*me}let[pt,it,Ct,Ye]=Ht(ge.projectedAnchorX+Qe,ge.projectedAnchorY+Ut,ge.projectedAnchorZ+Xe,c?le:A);const Ge=_n(w.getCameraToCenterDistance(oe),Ye);let tt=x.evaluateSizeForFeature(f.textSizeData,B,ge)*Ge/r.ONE_EM;c&&(tt*=f.tilePixelRatio/P);const bt=ra(We,tt);c?({x:pt,y:it,z:Ct}=oe.projectTilePoint(Ae+bt.x,Te+bt.y,L.canonical),[pt,it,Ct]=Ht(pt+Qe,it+Ut,Ct+Xe,A)):(n&&bt._rotate(-w.angle),pt+=bt.x,it+=bt.y,Ct=0);const At=f.allowVerticalPlacement&&ge.placedOrientation===r.WritingMode.vertical?Math.PI/2:0;for(let bi=0;bi<De;bi++)r.addDynamicAttributes(ee,pt,it,Ct,At);F&&ge.associatedIconIndex>=0&&(re[ge.associatedIconIndex]={x:pt,y:it,z:Ct,angle:At})}else ze(De,ee)}if(F){se.clear();const fe=f.icon.placedSymbolArray;for(let ge=0;ge<fe.length;ge++){const Ae=fe.get(ge),{numGlyphs:Te}=Ae,De=re[ge];if(Ae.hidden||!De)ze(Te,se);else{const{x:He,y:We,z:Qe,angle:Ut}=De;for(let Xe=0;Xe<Te;Xe++)r.addDynamicAttributes(se,He,We,Qe,Ut)}}f.icon.dynamicLayoutVertexBuffer.updateData(se)}f.text.dynamicLayoutVertexBuffer.updateData(ee)}function Ne(f,n,c){return c.iconsInText&&n?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function ft(f,n,c,m,x,w,A,L,P,B,F,H){const ee=f.context,se=ee.gl,re=f.transform,oe=L==="map",le=P==="map",J=oe&&c.layout.get("symbol-placement")!=="point",me=oe&&!le&&!J,fe=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ge=!1;const Ae=f.depthModeForSublayer(0,r.DepthMode.ReadOnly),Te=[r.mercatorXfromLng(re.center.lng),r.mercatorYfromLat(re.center.lat)],De=c.layout.get("text-variable-anchor"),He=re.projection.name==="globe",We=[],Qe=[0,-1,0];let Ut=Qe;!He&&!re.mercatorFromTransition||oe||(Ut=function(Xe){const pt=Xe._camera.getWorldToCamera(Xe.worldSize,1),it=r.multiply([],pt,Xe.globeMatrix);r.invert(it,it);const Ct=[0,0,0],Ye=[0,1,0,0];return r.transformMat4$1(Ye,Ye,it),Ct[0]=Ye[0],Ct[1]=Ye[1],Ct[2]=Ye[2],r.normalize(Ct,Ct),Ct}(re));for(const Xe of m){const pt=n.getTile(Xe),it=pt.getBucket(c);if(!it||it.projection.name==="mercator"&&He)continue;const Ct=x?it.text:it.icon;if(!Ct||it.fullyClipped||!Ct.segments.get().length)continue;const Ye=Ct.programConfigurations.get(c.id),Ge=x||it.sdfIcons,tt=x?it.textSizeData:it.iconSizeData,bt=le||re.pitch!==0,At=r.evaluateSizeForZoom(tt,re.zoom);let bi,fn,di,si,Ti=[0,0],Mn=null;if(x){if(fn=pt.glyphAtlasTexture,di=se.LINEAR,bi=pt.glyphAtlasTexture.size,it.iconsInText){Ti=pt.imageAtlasTexture.size,Mn=pt.imageAtlasTexture;const So=tt.kind==="composite"||tt.kind==="camera";si=bt||f.options.rotating||f.options.zooming||So?se.LINEAR:se.NEAREST}}else{const So=c.layout.get("icon-size").constantOr(0)!==1||it.iconsNeedLinear;fn=pt.imageAtlasTexture,di=Ge||f.options.rotating||f.options.zooming||So||bt?se.LINEAR:se.NEAREST,bi=pt.imageAtlasTexture.size}const Li=it.projection.name==="globe",Jn=Li?Ut:Qe,or=Li?r.globeToMercatorTransition(re.zoom):0,br=Hi(Xe,it.getProjection(),re),lr=re.calculatePixelsToTileUnitsMatrix(pt),os=Oa(br,pt.tileID.canonical,le,oe,re,it.getProjection(),lr),Ao=f.terrain&&le&&J?r.invert(r.create(),os):Jr,ya=rl(br,pt.tileID.canonical,le,oe,re,it.getProjection(),lr),va=De&&it.hasTextData(),Rr=c.layout.get("icon-text-fit")!=="none"&&va&&it.hasIconData();if(J){const So=re.elevation,rn=So?So.getAtTileOffsetFunc(Xe,re.center.lat,re.worldSize,it.getProjection()):null,Vl=Wu(br,pt.tileID.canonical,le,oe,re,it.getProjection(),lr);fo(it,br,f,x,Vl,ya,le,B,rn,Xe)}const fr=J||x&&De||Rr,Hn=f.translatePosMatrix(br,pt,w,A),Qr=fr?Jr:os,eo=f.translatePosMatrix(ya,pt,w,A,!0),Sr=it.getProjection().createInversionMatrix(re,Xe.canonical),Ws=[];f.terrainRenderModeElevated()&&le&&Ws.push("PITCH_WITH_MAP_TERRAIN"),Li&&Ws.push("PROJECTION_GLOBE_VIEW"),fr&&Ws.push("PROJECTED_POS_ON_VIEWPORT");const to=Ge&&c.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let gl;gl=Ge?it.iconsInText?$n(tt.kind,At,me,le,f,Hn,Qr,eo,bi,Ti,Xe,or,Te,Sr,Jn,it.getProjection()):Ri(tt.kind,At,me,le,f,Hn,Qr,eo,x,bi,!0,Xe,or,Te,Sr,Jn,it.getProjection()):ii(tt.kind,At,me,le,f,Hn,Qr,eo,x,bi,Xe,or,Te,Sr,Jn,it.getProjection());const Eu={program:f.useProgram(Ne(Ge,x,it),Ye,Ws),buffers:Ct,uniformValues:gl,atlasTexture:fn,atlasTextureIcon:Mn,atlasInterpolation:di,atlasInterpolationIcon:si,isSDF:Ge,hasHalo:to,tile:pt,labelPlaneMatrixInv:Ao};if(fe&&it.canOverlap){ge=!0;const So=Ct.segments.get();for(const rn of So)We.push({segments:new r.SegmentVector([rn]),sortKey:rn.sortKey,state:Eu})}else We.push({segments:Ct.segments,sortKey:0,state:Eu})}ge&&We.sort((Xe,pt)=>Xe.sortKey-pt.sortKey);for(const Xe of We){const pt=Xe.state;if(f.terrain&&f.terrain.setupElevationDraw(pt.tile,pt.program,{useDepthForOcclusion:!He,labelPlaneMatrixInv:pt.labelPlaneMatrixInv}),ee.activeTexture.set(se.TEXTURE0),pt.atlasTexture.bind(pt.atlasInterpolation,se.CLAMP_TO_EDGE),pt.atlasTextureIcon&&(ee.activeTexture.set(se.TEXTURE1),pt.atlasTextureIcon&&pt.atlasTextureIcon.bind(pt.atlasInterpolationIcon,se.CLAMP_TO_EDGE)),pt.isSDF){const it=pt.uniformValues;pt.hasHalo&&(it.u_is_halo=1,at(pt.buffers,Xe.segments,c,f,pt.program,Ae,F,H,it)),it.u_is_halo=0}at(pt.buffers,Xe.segments,c,f,pt.program,Ae,F,H,pt.uniformValues)}}function at(f,n,c,m,x,w,A,L,P){const B=m.context,F=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer];x.draw(B,B.gl.TRIANGLES,w,A,L,r.CullFaceMode.disabled,P,c.id,f.layoutVertexBuffer,f.indexBuffer,n,c.paint,m.transform.zoom,f.programConfigurations.get(c.id),F)}function _i(f,n,c,m,x,w,A){const L=f.context.gl,P=c.paint.get("fill-pattern"),B=P&&P.constantOr(1);let F,H,ee,se,re;A?(H=B&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",F=L.LINES):(H=B?"fillPattern":"fill",F=L.TRIANGLES);for(const oe of m){const le=n.getTile(oe);if(B&&!le.patternsLoaded())continue;const J=le.getBucket(c);if(!J)continue;f.prepareDrawTile();const me=J.programConfigurations.get(c.id),fe=f.useProgram(H,me);B&&(f.context.activeTexture.set(L.TEXTURE0),le.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),me.updatePaintBuffers());const ge=P.constantOr(null);if(ge&&le.imageAtlas){const Te=le.imageAtlas.patternPositions[ge.toString()];Te&&me.setConstantPatternPositions(Te)}const Ae=f.translatePosMatrix(oe.projMatrix,le,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(A){se=J.indexBuffer2,re=J.segments2;const Te=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[L.drawingBufferWidth,L.drawingBufferHeight];ee=H==="fillOutlinePattern"&&B?hc(Ae,f,le,Te):Ua(Ae,Te)}else se=J.indexBuffer,re=J.segments,ee=B?us(Ae,f,le):uc(Ae);f.prepareDrawProgram(f.context,fe,oe.toUnwrapped()),fe.draw(f.context,F,x,f.stencilModeForClipping(oe),w,r.CullFaceMode.disabled,ee,c.id,J.layoutVertexBuffer,se,re,c.paint,f.transform.zoom,me)}}function Xi(f,n,c,m,x,w,A){const L=f.context,P=L.gl,B=f.transform,F=c.paint.get("fill-extrusion-pattern"),H=F.constantOr(1),ee=c.paint.get("fill-extrusion-opacity"),se=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],re=c.layout.get("fill-extrusion-edge-radius"),oe=B.projection.name==="globe"?r.fillExtrusionHeightLift():0,le=B.projection.name==="globe",J=le?r.globeToMercatorTransition(B.zoom):0,me=[r.mercatorXfromLng(B.center.lng),r.mercatorYfromLat(B.center.lat)],fe=[];le&&fe.push("PROJECTION_GLOBE_VIEW"),se[0]>0&&fe.push("FAUX_AO");for(const ge of m){const Ae=n.getTile(ge),Te=Ae.getBucket(c);if(!Te||Te.projection.name!==B.projection.name)continue;const De=Te.programConfigurations.get(c.id),He=f.useProgram(H?"fillExtrusionPattern":"fillExtrusion",De,fe);if(f.terrain){const Ct=f.terrain;if(f.style.terrainSetForDrapingOnly())Ct.setupElevationDraw(Ae,He,{useMeterToDem:!0});else{if(!Te.enableTerrain)continue;if(Ct.setupElevationDraw(Ae,He,{useMeterToDem:!0}),qn(L,n,ge,Te,c,Ct),!Te.centroidVertexBuffer){const Ye=He.attributes.a_centroid_pos;Ye!==void 0&&P.vertexAttrib2f(Ye,0,0)}}}H&&(f.context.activeTexture.set(P.TEXTURE0),Ae.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),De.updatePaintBuffers());const We=F.constantOr(null);if(We&&Ae.imageAtlas){const Ct=Ae.imageAtlas.patternPositions[We.toString()];Ct&&De.setConstantPatternPositions(Ct)}const Qe=f.translatePosMatrix(ge.projMatrix,Ae,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ut=B.projection.createInversionMatrix(B,ge.canonical),Xe=c.paint.get("fill-extrusion-vertical-gradient"),pt=H?pu(Qe,f,Xe,ee,se,re,ge,Ae,oe,J,me,Ut):cc(Qe,f,Xe,ee,se,re,ge,oe,J,me,Ut);f.prepareDrawProgram(L,He,ge.toUnwrapped());const it=[];f.terrain&&it.push(Te.centroidVertexBuffer),le&&it.push(Te.layoutVertexExtBuffer),He.draw(L,L.gl.TRIANGLES,x,w,A,r.CullFaceMode.backCCW,pt,c.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,c.paint,f.transform.zoom,De,it)}}function qn(f,n,c,m,x,w){const A=[J=>{let me=J.canonical.x-1,fe=J.wrap;return me<0&&(me=(1<<J.canonical.z)-1,fe--),new r.OverscaledTileID(J.overscaledZ,fe,J.canonical.z,me,J.canonical.y)},J=>{let me=J.canonical.x+1,fe=J.wrap;return me===1<<J.canonical.z&&(me=0,fe++),new r.OverscaledTileID(J.overscaledZ,fe,J.canonical.z,me,J.canonical.y)},J=>new r.OverscaledTileID(J.overscaledZ,J.wrap,J.canonical.z,J.canonical.x,(J.canonical.y===0?1<<J.canonical.z:J.canonical.y)-1),J=>new r.OverscaledTileID(J.overscaledZ,J.wrap,J.canonical.z,J.canonical.x,J.canonical.y===(1<<J.canonical.z)-1?0:J.canonical.y+1)],L=J=>{const me=n.getSource().minzoom,fe=Ae=>{const Te=n.getTileByID(Ae);if(Te&&Te.hasData())return Te.getBucket(x)},ge=[0,-1,1];for(const Ae of ge){if(J.overscaledZ+Ae<me)continue;const Te=fe(J.calculateScaledKey(J.overscaledZ+Ae));if(Te)return Te}},P=[0,0,0],B=(J,me)=>(P[0]=Math.min(J.min.y,me.min.y),P[1]=Math.max(J.max.y,me.max.y),P[2]=r.EXTENT-me.min.x>J.max.x?me.min.x-r.EXTENT:J.max.x,P),F=(J,me)=>(P[0]=Math.min(J.min.x,me.min.x),P[1]=Math.max(J.max.x,me.max.x),P[2]=r.EXTENT-me.min.y>J.max.y?me.min.y-r.EXTENT:J.max.y,P),H=[(J,me)=>B(J,me),(J,me)=>B(me,J),(J,me)=>F(J,me),(J,me)=>F(me,J)],ee=new r.pointGeometry(0,0);let se,re,oe;const le=(J,me,fe,ge,Ae)=>{const Te=[[ge?fe:J,ge?J:fe,0],[ge?fe:me,ge?me:fe,0]],De=Ae<0?r.EXTENT+Ae:Ae,He=[ge?De:(J+me)/2,ge?(J+me)/2:De,0];return fe===0&&Ae<0||fe!==0&&Ae>0?w.getForTilePoints(oe,[He],!0,re):Te.push(He),w.getForTilePoints(c,Te,!0,se),Math.max(Te[0][2],Te[1][2],He[2])/w.exaggeration()};for(let J=0;J<4;J++){const me=(J<2?1:5)-J,fe=m.borders[J];if(fe.length===0)continue;const ge=oe=A[J](c),Ae=L(ge);if(!(Ae&&Ae instanceof r.FillExtrusionBucket&&Ae.enableTerrain)||m.borderDoneWithNeighborZ[J]===Ae.canonical.z&&Ae.borderDoneWithNeighborZ[me]===m.canonical.z||(re=w.findDEMTileFor(ge),!re||!re.dem))continue;if(!se){const We=w.findDEMTileFor(c);if(!We||!We.dem)return;se=We}const Te=Ae.borders[me];let De=0;const He=Ae.borderDoneWithNeighborZ[me]!==m.canonical.z;if(m.canonical.z===Ae.canonical.z){for(let We=0;We<fe.length;We++){const Qe=m.featuresOnBorder[fe[We]],Ut=Qe.borders[J];let Xe;for(;De<Te.length&&(Xe=Ae.featuresOnBorder[Te[De]],!(Xe.borders[me][1]>Ut[0]+3));)He&&Ae.encodeCentroid(void 0,Xe,!1),De++;if(Xe&&De<Te.length){const pt=De;let it=0;for(;!(Xe.borders[me][0]>Ut[1]-3)&&(it++,++De!==Te.length);)Xe=Ae.featuresOnBorder[Te[De]];if(Xe=Ae.featuresOnBorder[Te[pt]],Qe.intersectsCount()>1||Xe.intersectsCount()>1||it!==1){it!==1&&(De=pt),m.encodeCentroid(void 0,Qe,!1),He&&Ae.encodeCentroid(void 0,Xe,!1);continue}const Ct=H[J](Qe,Xe),Ye=J%2?r.EXTENT-1:0;ee.x=le(Ct[0],Math.min(r.EXTENT-1,Ct[1]),Ye,J<2,Ct[2]),ee.y=0,m.encodeCentroid(ee,Qe,!1),He&&Ae.encodeCentroid(ee,Xe,!1)}else m.encodeCentroid(void 0,Qe,!1)}m.borderDoneWithNeighborZ[J]=Ae.canonical.z,m.needsCentroidUpdate=!0,He&&(Ae.borderDoneWithNeighborZ[me]=m.canonical.z,Ae.needsCentroidUpdate=!0)}else{for(const We of fe)m.encodeCentroid(void 0,m.featuresOnBorder[We],!1);if(He){for(const We of Te)Ae.encodeCentroid(void 0,Ae.featuresOnBorder[We],!1);Ae.borderDoneWithNeighborZ[me]=m.canonical.z,Ae.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[J]=Ae.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(f)}const Wr=new r.Color(1,0,0,1),dr=new r.Color(0,1,0,1),mu=new r.Color(0,0,1,1),mr=new r.Color(1,0,1,1),En=new r.Color(0,1,1,1);function qa(f,n,c){const m=f.context,x=f.transform,w=m.gl,A=x.projection.name==="globe",L=A?["PROJECTION_GLOBE_VIEW"]:null;let P=c.projMatrix;if(A&&r.globeToMercatorTransition(x.zoom)>0){const Qe=r.transitionTileAABBinECEF(c.canonical,x),Ut=r.globeDenormalizeECEF(Qe);P=r.multiply(new Float32Array(16),x.globeMatrix,Ut),r.multiply(P,x.projMatrix,P)}const B=f.useProgram("debug",null,L),F=n.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(F,B);const H=r.DepthMode.disabled,ee=r.StencilMode.disabled,se=f.colorModeForRenderPass(),re="$debug";m.activeTexture.set(w.TEXTURE0),f.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),A?F._makeGlobeTileDebugBuffers(f.context,x):F._makeDebugTileBoundsBuffers(f.context,x.projection);const oe=F._tileDebugBuffer||f.debugBuffer,le=F._tileDebugIndexBuffer||f.debugIndexBuffer,J=F._tileDebugSegments||f.debugSegments;B.draw(m,w.LINE_STRIP,H,ee,se,r.CullFaceMode.disabled,Vc(P,r.Color.red),re,oe,le,J,null,null,null,[F._globeTileDebugBorderBuffer]);const me=F.latestRawTileData,fe=Math.floor((me&&me.byteLength||0)/1024),ge=n.getTile(c).tileSize,Ae=512/Math.min(ge,512)*(c.overscaledZ/x.zoom)*.5;let Te=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Te+=` => ${c.overscaledZ}`),Te+=` ${fe}kb`,function(Qe,Ut){Qe.initDebugOverlayCanvas();const Xe=Qe.debugOverlayCanvas,pt=Qe.context.gl,it=Qe.debugOverlayCanvas.getContext("2d");it.clearRect(0,0,Xe.width,Xe.height),it.shadowColor="white",it.shadowBlur=2,it.lineWidth=1.5,it.strokeStyle="white",it.textBaseline="top",it.font="bold 36px Open Sans, sans-serif",it.fillText(Ut,5,5),it.strokeText(Ut,5,5),Qe.debugOverlayTexture.update(Xe),Qe.debugOverlayTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE)}(f,Te);const De=F._tileDebugTextBuffer||f.debugBuffer,He=F._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,We=F._tileDebugTextSegments||f.debugSegments;B.draw(m,w.TRIANGLES,H,ee,r.ColorMode.alphaBlended,r.CullFaceMode.disabled,Vc(P,r.Color.transparent,Ae),re,De,He,We,null,null,null,[F._globeTileDebugTextBuffer])}function $s(f,n,c,m){ds(f,0,n+c/2,f.transform.width,c,m)}function Eo(f,n,c,m){ds(f,n-c/2,0,c,f.transform.height,m)}function ds(f,n,c,m,x,w){const A=f.context,L=A.gl;L.enable(L.SCISSOR_TEST),L.scissor(n*r.exported.devicePixelRatio,c*r.exported.devicePixelRatio,m*r.exported.devicePixelRatio,x*r.exported.devicePixelRatio),A.clear({color:w}),L.disable(L.SCISSOR_TEST)}const zs=r.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Tn}=zs;function To(f,n,c,m){f.emplaceBack(n,c,m)}class cl{constructor(n){this.vertexArray=new r.StructArrayLayout3f12,this.indices=new r.StructArrayLayout3ui6,To(this.vertexArray,-1,-1,1),To(this.vertexArray,1,-1,1),To(this.vertexArray,-1,1,1),To(this.vertexArray,1,1,1),To(this.vertexArray,-1,-1,-1),To(this.vertexArray,1,-1,-1),To(this.vertexArray,-1,1,-1),To(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Tn),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=r.SegmentVector.simpleSegment(0,0,36,12)}}function on(f,n,c,m,x,w){const A=f.gl,L=n.paint.get("sky-atmosphere-color"),P=n.paint.get("sky-atmosphere-halo-color"),B=n.paint.get("sky-atmosphere-sun-intensity"),F=((H,ee,se,re,oe)=>({u_matrix_3f:H,u_sun_direction:ee,u_sun_intensity:se,u_color_tint_r:[re.r,re.g,re.b,re.a],u_color_tint_m:[oe.r,oe.g,oe.b,oe.a],u_luminance:5e-5}))(r.fromMat4(r.create$1(),m),x,B,L,P);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+w,n.skyboxTexture,0),c.draw(f,A.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.frontCW,F,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const pa=r.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ph{constructor(n){const c=new r.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const m=new r.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(c,pa.members),this.indexBuffer=n.createIndexBuffer(m),this.segments=r.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const mc={symbol:function(f,n,c,m,x){if(f.renderPass!=="translucent")return;const w=r.StencilMode.disabled,A=f.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,P,B,F,H,ee,se){const re=P.transform,oe=H==="map",le=ee==="map";for(const J of L){const me=F.getTile(J),fe=me.getBucket(B);if(!fe||!fe.text||!fe.text.segments.get().length)continue;const ge=r.evaluateSizeForZoom(fe.textSizeData,re.zoom),Ae=Hi(J,fe.getProjection(),re),Te=re.calculatePixelsToTileUnitsMatrix(me),De=Oa(Ae,me.tileID.canonical,le,oe,re,fe.getProjection(),Te),He=B.layout.get("icon-text-fit")!=="none"&&fe.hasIconData();if(ge){const We=Math.pow(2,re.zoom-me.tileID.overscaledZ);hs(fe,oe,le,se,r.symbolSize,re,De,J,We,ge,He)}}}(m,f,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x),c.paint.get("icon-opacity").constantOr(1)!==0&&ft(f,n,c,m,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,A),c.paint.get("text-opacity").constantOr(1)!==0&&ft(f,n,c,m,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,A),n.map.showCollisionBoxes&&(rs(f,n,c,m,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),rs(f,n,c,m,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,c,m){if(f.renderPass!=="translucent")return;const x=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),A=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)===0&&(w.constantOr(1)===0||A.constantOr(1)===0))return;const P=f.context,B=P.gl,F=f.transform,H=f.depthModeForSublayer(0,r.DepthMode.ReadOnly),ee=r.StencilMode.disabled,se=f.colorModeForRenderPass(),re=F.projection.name==="globe",oe=[r.mercatorXfromLng(F.center.lng),r.mercatorYfromLat(F.center.lat)],le=[];for(let me=0;me<m.length;me++){const fe=m[me],ge=n.getTile(fe),Ae=ge.getBucket(c);if(!Ae||Ae.projection.name!==F.projection.name)continue;const Te=Ae.programConfigurations.get(c.id),De=na(c);re&&De.push("PROJECTION_GLOBE_VIEW");const He=f.useProgram("circle",Te,De),We=Ae.layoutVertexBuffer,Qe=Ae.globeExtVertexBuffer,Ut=Ae.indexBuffer,Xe=F.projection.createInversionMatrix(F,fe.canonical),pt={programConfiguration:Te,program:He,layoutVertexBuffer:We,globeExtVertexBuffer:Qe,indexBuffer:Ut,uniformValues:dc(f,fe,ge,Xe,oe,c),tile:ge};if(L){const it=Ae.segments.get();for(const Ct of it)le.push({segments:new r.SegmentVector([Ct]),sortKey:Ct.sortKey,state:pt})}else le.push({segments:Ae.segments,sortKey:0,state:pt})}L&&le.sort((me,fe)=>me.sortKey-fe.sortKey);const J={useDepthForOcclusion:!re};for(const me of le){const{programConfiguration:fe,program:ge,layoutVertexBuffer:Ae,globeExtVertexBuffer:Te,indexBuffer:De,uniformValues:He,tile:We}=me.state,Qe=me.segments;f.terrain&&f.terrain.setupElevationDraw(We,ge,J),f.prepareDrawProgram(P,ge,We.tileID.toUnwrapped()),ge.draw(P,B.TRIANGLES,H,ee,se,r.CullFaceMode.disabled,He,c.id,Ae,De,Qe,c.paint,F.zoom,fe,[Te])}},heatmap:function(f,n,c,m){if(c.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const x=f.context,w=x.gl,A=r.StencilMode.disabled,L=new r.ColorMode([w.ONE,w.ONE],r.Color.transparent,[!0,!0,!0,!0]);(function(se,re,oe,le){const J=se.gl,me=re.width*le,fe=re.height*le;se.activeTexture.set(J.TEXTURE1),se.viewport.set([0,0,me,fe]);let ge=oe.heatmapFbo;if(!ge||ge&&(ge.width!==me||ge.height!==fe)){ge&&ge.destroy();const Ae=J.createTexture();J.bindTexture(J.TEXTURE_2D,Ae),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),ge=oe.heatmapFbo=se.createFramebuffer(me,fe,!1),function(Te,De,He,We,Qe,Ut){const Xe=Te.gl;Xe.texImage2D(Xe.TEXTURE_2D,0,Te.isWebGL2&&Te.extRenderToTextureHalfFloat?Xe.RGBA16F:Xe.RGBA,Qe,Ut,0,Xe.RGBA,Te.extRenderToTextureHalfFloat?Te.isWebGL2?Xe.HALF_FLOAT:Te.extTextureHalfFloat.HALF_FLOAT_OES:Xe.UNSIGNED_BYTE,null),We.colorAttachment.set(He)}(se,0,Ae,ge,me,fe)}else J.bindTexture(J.TEXTURE_2D,ge.colorAttachment.get()),se.bindFramebuffer.set(ge.framebuffer)})(x,f,c,f.transform.projection.name==="globe"?.5:.25),x.clear({color:r.Color.transparent});const P=f.transform,B=P.projection.name==="globe",F=B?["PROJECTION_GLOBE_VIEW"]:null,H=B?r.CullFaceMode.frontCCW:r.CullFaceMode.disabled,ee=[r.mercatorXfromLng(P.center.lng),r.mercatorYfromLat(P.center.lat)];for(let se=0;se<m.length;se++){const re=m[se];if(n.hasRenderableParent(re))continue;const oe=n.getTile(re),le=oe.getBucket(c);if(!le||le.projection.name!==P.projection.name)continue;const J=le.programConfigurations.get(c.id),me=f.useProgram("heatmap",J,F),{zoom:fe}=f.transform;f.terrain&&f.terrain.setupElevationDraw(oe,me),f.prepareDrawProgram(x,me,re.toUnwrapped());const ge=P.projection.createInversionMatrix(P,re.canonical);me.draw(x,w.TRIANGLES,r.DepthMode.disabled,A,L,H,Fo(f,re,oe,ge,ee,fe,c.paint.get("heatmap-intensity")),c.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,c.paint,f.transform.zoom,J,B?[le.globeExtVertexBuffer]:null)}x.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(x,w){const A=x.context,L=A.gl,P=w.heatmapFbo;if(!P)return;A.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,P.colorAttachment.get()),A.activeTexture.set(L.TEXTURE1);let B=w.colorRampTexture;B||(B=w.colorRampTexture=new r.Texture(A,w.colorRamp,L.RGBA)),B.bind(L.LINEAR,L.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(A,L.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,x.colorModeForRenderPass(),r.CullFaceMode.disabled,((F,H,ee,se)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)}(f,c))},line:function(f,n,c,m){if(f.renderPass!=="translucent")return;const x=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const A=f.depthModeForSublayer(0,r.DepthMode.ReadOnly),L=f.colorModeForRenderPass(),P=f.terrain&&f.terrain.renderingToTexture?1:r.exported.devicePixelRatio,B=c.paint.get("line-dasharray"),F=B.constantOr(1),H=c.layout.get("line-cap"),ee=c.paint.get("line-pattern"),se=ee.constantOr(1),re=c.paint.get("line-gradient"),oe=se?"linePattern":"line",le=f.context,J=le.gl,me=(ge=>{const Ae=[];pc(ge)&&Ae.push("RENDER_LINE_DASH"),ge.paint.get("line-gradient")&&Ae.push("RENDER_LINE_GRADIENT");const Te=ge.paint.get("line-trim-offset");Te[0]===0&&Te[1]===0||Ae.push("RENDER_LINE_TRIM_OFFSET");const De=ge.paint.get("line-pattern").constantOr(1),He=ge.paint.get("line-opacity").constantOr(1)!==1;return!De&&He&&Ae.push("RENDER_LINE_ALPHA_DISCARD"),Ae})(c);let fe=me.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(fe=!1);for(const ge of m){const Ae=n.getTile(ge);if(se&&!Ae.patternsLoaded())continue;const Te=Ae.getBucket(c);if(!Te)continue;f.prepareDrawTile();const De=Te.programConfigurations.get(c.id),He=f.useProgram(oe,De,me),We=ee.constantOr(null);if(We&&Ae.imageAtlas){const Ge=Ae.imageAtlas.patternPositions[We.toString()];Ge&&De.setConstantPatternPositions(Ge)}const Qe=B.constantOr(null),Ut=H.constantOr(null);if(!se&&Qe&&Ut&&Ae.lineAtlas){const Ge=Ae.lineAtlas.getDash(Qe,Ut);Ge&&De.setConstantPatternPositions(Ge)}let[Xe,pt]=c.paint.get("line-trim-offset");(Ut==="round"||Ut==="square")&&Xe!==pt&&(Xe===0&&(Xe-=1),pt===1&&(pt+=1));const it=f.terrain?ge.projMatrix:null,Ct=se?eh(f,Ae,c,it,P):Ga(f,Ae,c,it,Te.lineClipsArray.length,P,[Xe,pt]);if(re){const Ge=Te.gradients[c.id];let tt=Ge.texture;if(c.gradientVersion!==Ge.version){let bt=256;if(c.stepInterpolant){const At=n.getSource().maxzoom,bi=ge.canonical.z===At?Math.ceil(1<<f.transform.maxZoom-ge.canonical.z):1;bt=r.clamp(r.nextPowerOfTwo(Te.maxLineLength/r.EXTENT*1024*bi),256,le.maxTextureSize)}Ge.gradient=r.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:bt,image:Ge.gradient||void 0,clips:Te.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new r.Texture(le,Ge.gradient,J.RGBA),Ge.version=c.gradientVersion,tt=Ge.texture}le.activeTexture.set(J.TEXTURE1),tt.bind(c.stepInterpolant?J.NEAREST:J.LINEAR,J.CLAMP_TO_EDGE)}F&&(le.activeTexture.set(J.TEXTURE0),Ae.lineAtlasTexture.bind(J.LINEAR,J.REPEAT),De.updatePaintBuffers()),se&&(le.activeTexture.set(J.TEXTURE0),Ae.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),De.updatePaintBuffers()),f.prepareDrawProgram(le,He,ge.toUnwrapped());const Ye=Ge=>{He.draw(le,J.TRIANGLES,A,Ge,L,r.CullFaceMode.disabled,Ct,c.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,c.paint,f.transform.zoom,De,[Te.layoutVertexBuffer2])};if(fe){const Ge=f.stencilModeForClipping(ge).ref;Ge===0&&f.terrain&&le.clear({stencil:0});const tt={func:J.EQUAL,mask:255};Ct.u_alpha_discard_threshold=.8,Ye(new r.StencilMode(tt,Ge,255,J.KEEP,J.KEEP,J.INVERT)),Ct.u_alpha_discard_threshold=0,Ye(new r.StencilMode(tt,Ge,255,J.KEEP,J.KEEP,J.KEEP))}else Ye(f.stencilModeForClipping(ge))}fe&&(f.resetStencilClippingMasks(),f.terrain&&le.clear({stencil:0}))},fill:function(f,n,c,m){const x=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const A=f.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),P=f.opaquePassEnabledForLayer()&&!L.constantOr(1)&&x.constantOr(r.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===P){const B=f.depthModeForSublayer(1,f.renderPass==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly);_i(f,n,c,m,B,A,!1)}if(f.renderPass==="translucent"&&c.paint.get("fill-antialias")){const B=f.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,r.DepthMode.ReadOnly);_i(f,n,c,m,B,A,!0)}},"fill-extrusion":function(f,n,c,m){const x=c.paint.get("fill-extrusion-opacity");if(x!==0&&f.renderPass==="translucent"){const w=new r.DepthMode(f.context.gl.LEQUAL,r.DepthMode.ReadWrite,f.depthRangeFor3D);if(x!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))Xi(f,n,c,m,w,r.StencilMode.disabled,r.ColorMode.disabled),Xi(f,n,c,m,w,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const A=f.colorModeForRenderPass();Xi(f,n,c,m,w,r.StencilMode.disabled,A)}}},hillshade:function(f,n,c,m){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const x=f.context,w=f.depthModeForSublayer(0,r.DepthMode.ReadOnly),A=f.colorModeForRenderPass(),L=f.terrain&&f.terrain.renderingToTexture,[P,B]=f.renderPass!=="translucent"||L?[{},m]:f.stencilConfigForOverlap(m);for(const F of B){const H=n.getTile(F);if(H.needsHillshadePrepare&&f.renderPass==="offscreen")ta(f,H,c,w,r.StencilMode.disabled,A);else if(f.renderPass==="translucent"){const ee=L&&f.terrain?f.terrain.stencilModeForRTTOverlap(F):P[F.overscaledZ];za(f,F,H,c,w,ee,A)}}x.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,c,m,x,w){if(f.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!m.length)return;const A=f.context,L=A.gl,P=n.getSource(),B=f.useProgram("raster"),F=f.colorModeForRenderPass(),H=f.terrain&&f.terrain.renderingToTexture,[ee,se]=P instanceof Ce||H?[{},m]:f.stencilConfigForOverlap(m),re=se[se.length-1].overscaledZ,oe=!f.options.moving;for(const le of se){const J=H?r.DepthMode.disabled:f.depthModeForSublayer(le.overscaledZ-re,c.paint.get("raster-opacity")===1?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly,L.LESS),me=le.toUnwrapped(),fe=n.getTile(le);if(H&&(!fe||!fe.hasData()))continue;const ge=H?le.projMatrix:f.transform.calculateProjMatrix(me,oe),Ae=f.terrain&&H?f.terrain.stencilModeForRTTOverlap(le):ee[le.overscaledZ],Te=w?0:c.paint.get("raster-fade-duration");fe.registerFadeDuration(Te);const De=n.findLoadedParent(le,0),He=ol(fe,De,n,f.transform,Te);let We,Qe;f.terrain&&f.terrain.prepareDrawTile();const Ut=c.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;A.activeTexture.set(L.TEXTURE0),fe.texture.bind(Ut,L.CLAMP_TO_EDGE),A.activeTexture.set(L.TEXTURE1),De?(De.texture.bind(Ut,L.CLAMP_TO_EDGE),We=Math.pow(2,De.tileID.overscaledZ-fe.tileID.overscaledZ),Qe=[fe.tileID.canonical.x*We%1,fe.tileID.canonical.y*We%1]):fe.texture.bind(Ut,L.CLAMP_TO_EDGE);const Xe=ll(ge,Qe||[0,0],We||1,He,c,P instanceof Ce?P.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(A,B,me),P instanceof Ce)P.boundsBuffer&&P.boundsSegments&&B.draw(A,L.TRIANGLES,J,r.StencilMode.disabled,F,r.CullFaceMode.disabled,Xe,c.id,P.boundsBuffer,f.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:pt,tileBoundsIndexBuffer:it,tileBoundsSegments:Ct}=f.getTileBoundsBuffers(fe);B.draw(A,L.TRIANGLES,J,Ae,F,r.CullFaceMode.disabled,Xe,c.id,pt,it,Ct)}}f.resetStencilClippingMasks()},background:function(f,n,c,m){const x=c.paint.get("background-color"),w=c.paint.get("background-opacity");if(w===0)return;const A=f.context,L=A.gl,P=f.transform,B=P.tileSize,F=c.paint.get("background-pattern");if(f.isPatternMissing(F))return;const H=!F&&x.a===1&&w===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==H)return;const ee=r.StencilMode.disabled,se=f.depthModeForSublayer(0,H==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly),re=f.colorModeForRenderPass(),oe=f.useProgram(F?"backgroundPattern":"background");let le,J=m;J||(le=f.getBackgroundTiles(),J=Object.values(le).map(me=>me.tileID)),F&&(A.activeTexture.set(L.TEXTURE0),f.imageManager.bind(f.context));for(const me of J){const fe=me.toUnwrapped(),ge=m?me.projMatrix:f.transform.calculateProjMatrix(fe);f.prepareDrawTile();const Ae=n?n.getTile(me):le?le[me.key]:new r.Tile(me,B,P.zoom,f),Te=F?Or(ge,w,f,F,{tileID:me,tileSize:B}):cn(ge,w,x);f.prepareDrawProgram(A,oe,fe);const{tileBoundsBuffer:De,tileBoundsIndexBuffer:He,tileBoundsSegments:We}=f.getTileBoundsBuffers(Ae);oe.draw(A,L.TRIANGLES,se,ee,re,r.CullFaceMode.disabled,Te,c.id,De,He,We)}},sky:function(f,n,c){const m=f.transform,x=m.projection.name==="mercator"||m.projection.name==="globe"?1:r.smoothstep(7,8,m.zoom),w=c.paint.get("sky-opacity")*x;if(w===0)return;const A=f.context,L=c.paint.get("sky-type"),P=new r.DepthMode(A.gl.LEQUAL,r.DepthMode.ReadOnly,[0,1]),B=f.frameCounter/1e3%1;L==="atmosphere"?f.renderPass==="offscreen"?c.needsSkyboxCapture(f)&&(function(F,H,ee,se){const re=F.context,oe=re.gl;let le=H.skyboxFbo;if(!le){le=H.skyboxFbo=re.createFramebuffer(32,32,!1),H.skyboxGeometry=new cl(re),H.skyboxTexture=re.gl.createTexture(),oe.bindTexture(oe.TEXTURE_CUBE_MAP,H.skyboxTexture),oe.texParameteri(oe.TEXTURE_CUBE_MAP,oe.TEXTURE_WRAP_S,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_CUBE_MAP,oe.TEXTURE_WRAP_T,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_CUBE_MAP,oe.TEXTURE_MIN_FILTER,oe.LINEAR),oe.texParameteri(oe.TEXTURE_CUBE_MAP,oe.TEXTURE_MAG_FILTER,oe.LINEAR);for(let ge=0;ge<6;++ge)oe.texImage2D(oe.TEXTURE_CUBE_MAP_POSITIVE_X+ge,0,oe.RGBA,32,32,0,oe.RGBA,oe.UNSIGNED_BYTE,null)}re.bindFramebuffer.set(le.framebuffer),re.viewport.set([0,0,32,32]);const J=H.getCenter(F,!0),me=F.useProgram("skyboxCapture"),fe=new Float64Array(16);r.identity(fe),r.rotateY(fe,fe,.5*-Math.PI),on(re,H,me,fe,J,0),r.identity(fe),r.rotateY(fe,fe,.5*Math.PI),on(re,H,me,fe,J,1),r.identity(fe),r.rotateX(fe,fe,.5*-Math.PI),on(re,H,me,fe,J,2),r.identity(fe),r.rotateX(fe,fe,.5*Math.PI),on(re,H,me,fe,J,3),r.identity(fe),on(re,H,me,fe,J,4),r.identity(fe),r.rotateY(fe,fe,Math.PI),on(re,H,me,fe,J,5),re.viewport.set([0,0,F.width,F.height])}(f,c),c.markSkyboxValid(f)):f.renderPass==="sky"&&function(F,H,ee,se,re){const oe=F.context,le=oe.gl,J=F.transform,me=F.useProgram("skybox");oe.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_CUBE_MAP,H.skyboxTexture);const fe=((ge,Ae,Te,De,He)=>({u_matrix:ge,u_sun_direction:Ae,u_cubemap:0,u_opacity:De,u_temporal_offset:He}))(J.skyboxMatrix,H.getCenter(F,!1),0,se,re);F.prepareDrawProgram(oe,me),me.draw(oe,le.TRIANGLES,ee,r.StencilMode.disabled,F.colorModeForRenderPass(),r.CullFaceMode.backCW,fe,"skybox",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(f,c,P,w,B):L==="gradient"&&f.renderPass==="sky"&&function(F,H,ee,se,re){const oe=F.context,le=oe.gl,J=F.transform,me=F.useProgram("skyboxGradient");H.skyboxGeometry||(H.skyboxGeometry=new cl(oe)),oe.activeTexture.set(le.TEXTURE0);let fe=H.colorRampTexture;fe||(fe=H.colorRampTexture=new r.Texture(oe,H.colorRamp,le.RGBA)),fe.bind(le.LINEAR,le.CLAMP_TO_EDGE);const ge=((Ae,Te,De,He,We)=>({u_matrix:Ae,u_color_ramp:0,u_center_direction:Te,u_radius:r.degToRad(De),u_opacity:He,u_temporal_offset:We}))(J.skyboxMatrix,H.getCenter(F,!1),H.paint.get("sky-gradient-radius"),se,re);F.prepareDrawProgram(oe,me),me.draw(oe,le.TRIANGLES,ee,r.StencilMode.disabled,F.colorModeForRenderPass(),r.CullFaceMode.backCW,ge,"skyboxGradient",H.skyboxGeometry.vertexBuffer,H.skyboxGeometry.indexBuffer,H.skyboxGeometry.segment)}(f,c,P,w,B)},debug:function(f,n,c){for(let m=0;m<c.length;m++)qa(f,n,c[m])},custom:function(f,n,c,m){const x=f.context,w=c.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&c.isLayerDraped()){if(f.renderPass==="offscreen"){const A=w.prerender;if(A){if(f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const L=f.transform.pointMerc;A.call(w,x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.globeToMercatorTransition(f.transform.zoom),[L.x,L.y],f.transform.pixelsPerMeterRatio)}else A.call(w,x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const L=w.renderToTile;if(L){const P=m[0].canonical,B=new r.MercatorCoordinate(P.x+m[0].wrap*(1<<P.z),P.y,P.z);x.setDepthMode(r.DepthMode.disabled),x.setStencilMode(r.StencilMode.disabled),x.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),L.call(w,x.gl,B),x.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),x.setColorMode(f.colorModeForRenderPass()),x.setStencilMode(r.StencilMode.disabled);const A=w.renderingMode==="3d"?new r.DepthMode(f.context.gl.LEQUAL,r.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,r.DepthMode.ReadOnly);if(x.setDepthMode(A),f.transform.projection.name==="globe"){const L=f.transform.pointMerc;w.render(x.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.globeToMercatorTransition(f.transform.zoom),[L.x,L.y],f.transform.pixelsPerMeterRatio)}else w.render(x.gl,f.transform.customLayerMatrix());x.setDirty(),f.setBaseState(),x.bindFramebuffer.set(null)}}else r.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class ma{constructor(n,c,m=!1){this.context=new he(n,m),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=r.SourceCache.maxUnderzooming+r.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Zu,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,c){const m=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Na(this,n));const x=this._terrain;this.transform.elevation=m?x:null,x.update(n,this.transform,c)}_updateFog(n){const c=n.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,x]=c.getFovAdjustedRange(this.transform._fov);if(m>x)return void(this.transform.fogCullDistSq=null);const w=m+.78*(x-m);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,c){if(this.width=n*r.exported.devicePixelRatio,this.height=c*r.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const n=this.context,c=new r.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(r.EXTENT,0),c.emplaceBack(0,r.EXTENT),c.emplaceBack(r.EXTENT,r.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(c,r.posAttributes.members),this.tileExtentSegments=r.SegmentVector.simpleSegment(0,0,4,2);const m=new r.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(r.EXTENT,0),m.emplaceBack(0,r.EXTENT),m.emplaceBack(r.EXTENT,r.EXTENT),this.debugBuffer=n.createVertexBuffer(m,r.posAttributes.members),this.debugSegments=r.SegmentVector.simpleSegment(0,0,4,5);const x=new r.StructArrayLayout2i4;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(x,r.posAttributes.members),this.viewportSegments=r.SegmentVector.simpleSegment(0,0,4,2);const w=new r.StructArrayLayout4i8;w.emplaceBack(0,0,0,0),w.emplaceBack(r.EXTENT,0,r.EXTENT,0),w.emplaceBack(0,r.EXTENT,0,r.EXTENT),w.emplaceBack(r.EXTENT,r.EXTENT,r.EXTENT,r.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(w,r.boundsAttributes.members),this.mercatorBoundsSegments=r.SegmentVector.simpleSegment(0,0,4,2);const A=new r.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(A);const L=new r.StructArrayLayout1ui2;for(const B of[0,1,3,2,0])L.emplaceBack(B);this.debugIndexBuffer=n.createIndexBuffer(L),this.emptyTexture=new r.Texture(n,new r.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=r.create();const P=this.context.gl;this.stencilClearMode=new r.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(r.window.performance.now()),this.atmosphereBuffer=new Ph(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,c=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,c.TRIANGLES,r.DepthMode.disabled,this.stencilClearMode,r.ColorMode.disabled,r.CullFaceMode.disabled,$i(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,m){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let L=!1;for(const P of m)if(this._tileClippingMaskIDs[P.key]===void 0){L=!0;break}if(!L)return}this.currentStencilSource=c.id;const x=this.context,w=x.gl;this.nextStencilID+m.length>256&&this.clearStencil(),x.setColorMode(r.ColorMode.disabled),x.setDepthMode(r.DepthMode.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const L of m){const P=c.getTile(L),B=this._tileClippingMaskIDs[L.key]=this.nextStencilID++,{tileBoundsBuffer:F,tileBoundsIndexBuffer:H,tileBoundsSegments:ee}=this.getTileBoundsBuffers(P);A.draw(x,w.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:w.ALWAYS,mask:0},B,255,w.KEEP,w.KEEP,w.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,$i(L.projMatrix),"$clipping",F,H,ee)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new r.StencilMode({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new r.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,m=n.sort((A,L)=>L.overscaledZ-A.overscaledZ),x=m[m.length-1].overscaledZ,w=m[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const A={};for(let L=0;L<w;L++)A[L+x]=new r.StencilMode({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[A,m]}return[{[x]:r.StencilMode.disabled},m]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new r.ColorMode([n.CONSTANT_COLOR,n.ONE],new r.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.ColorMode.unblended:r.ColorMode.alphaBlended}depthModeForSublayer(n,c,m){if(!this.opaquePassEnabledForLayer())return r.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new r.DepthMode(m||this.context.gl.LEQUAL,c,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,c){this.style=n,this.options=c,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(r.exported.now()),this.imageManager.beginFrame();const m=this.style.order,x=this.style._sourceCaches;for(const P in x){const B=x[P];B.used&&B.prepare(this.context)}const w={},A={},L={};for(const P in x){const B=x[P];w[P]=B.getVisibleCoordinates(),A[P]=w[P].slice().reverse(),L[P]=B.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<m.length;P++)if(this.style._layers[m[P]].is3D()){this.opaquePassCutoff=P;break}if(this.terrain&&(this.terrain.updateTileBinding(L),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.GlobeSharedBuffers(this.context)),r.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const P of m){const B=this.style._layers[P],F=n._getLayerSourceCache(B);if(!B.hasOffscreenPass()||B.isHidden(this.transform.zoom))continue;const H=F?A[F.id]:void 0;(B.type==="custom"||B.isSky()||H&&H.length)&&this.renderLayer(this,F,B,H)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?r.Color.black:r.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[m[this.currentLayer]],B=n._getLayerSourceCache(P);if(P.isSky())continue;const F=B?A[B.id]:void 0;this._renderTileClippingMasks(P,B,F),this.renderLayer(this,B,P,F)}if(this.style.fog&&this.transform.projection.supportsFog&&function(P,B){const F=P.context,H=F.gl,ee=P.transform,se=new r.DepthMode(H.LEQUAL,r.DepthMode.ReadOnly,[0,1]),re=P.useProgram("globeAtmosphere",null,ee.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),oe=r.globeToMercatorTransition(ee.zoom),le=B.properties.get("color").toArray01(),J=B.properties.get("high-color").toArray01(),me=B.properties.get("space-color").toArray01PremultipliedAlpha(),fe=r.identity$1([]);r.rotateY$1(fe,fe,-r.degToRad(ee._center.lng)),r.rotateX$1(fe,fe,r.degToRad(ee._center.lat)),r.rotateZ$1(fe,fe,ee.angle),r.rotateX$1(fe,fe,-ee._pitch);const ge=r.fromQuat(new Float32Array(16),fe),Ae=r.mapValue(B.properties.get("star-intensity"),0,1,0,.25),Te=5e-4,De=r.mapValue(B.properties.get("horizon-blend"),0,1,Te,.25),He=r.globeUseCustomAntiAliasing(P,F,ee)&&De===Te?ee.worldSize/(2*Math.PI*1.025)-1:ee.globeRadius,We=P.frameCounter/1e3%1,Qe=r.length(ee.globeCenterInViewSpace),Ut=Math.sqrt(Math.pow(Qe,2)-Math.pow(He,2)),Xe=Math.acos(Ut/Qe),pt=((Ct,Ye,Ge,tt,bt,At,bi,fn,di,si,Ti,Mn,Li,Jn)=>({u_frustum_tl:Ct,u_frustum_tr:Ye,u_frustum_br:Ge,u_frustum_bl:tt,u_horizon:bt,u_transition:At,u_fadeout_range:bi,u_color:fn,u_high_color:di,u_space_color:si,u_star_intensity:Ti,u_star_size:5*r.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Mn,u_horizon_angle:Li,u_rotation_matrix:Jn}))(ee.frustumCorners.TL,ee.frustumCorners.TR,ee.frustumCorners.BR,ee.frustumCorners.BL,ee.frustumCorners.horizon,oe,De,le,J,me,Ae,We,Xe,ge);P.prepareDrawProgram(F,re);const it=P.atmosphereBuffer;it&&re.draw(F,H.TRIANGLES,se,r.StencilMode.disabled,r.ColorMode.alphaBlended,r.CullFaceMode.backCW,pt,"skybox",it.vertexBuffer,it.indexBuffer,it.segments)}(this,this.style.fog),this.renderPass="sky",(r.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const P=this.style._layers[m[this.currentLayer]],B=n._getLayerSourceCache(P);P.isSky()&&this.renderLayer(this,B,P,B?A[B.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const P=this.style._layers[m[this.currentLayer]],B=n._getLayerSourceCache(P);if(P.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(P)){if(P.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const F=B?(P.type==="symbol"?L:A)[B.id]:void 0;this._renderTileClippingMasks(P,B,B?w[B.id]:void 0),this.renderLayer(this,B,P,F),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let P=null;r.values(this.style._layers).forEach(B=>{const F=n._getLayerSourceCache(B);F&&!B.isHidden(this.transform.zoom)&&(!P||P.getSource().maxzoom<F.getSource().maxzoom)&&(P=F)}),P&&this.options.showTileBoundaries&&mc.debug(this,P,P.getVisibleCoordinates())}this.options.showPadding&&function(P){const B=P.transform.padding;$s(P,P.transform.height-(B.top||0),3,Wr),$s(P,B.bottom||0,3,dr),Eo(P,B.left||0,3,mu),Eo(P,P.transform.width-(B.right||0),3,mr);const F=P.transform.centerPoint;(function(H,ee,se,re){ds(H,ee-1,se-10,2,20,re),ds(H,ee-10,se-1,20,2,re)})(P,F.x,P.transform.height-F.y,En)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(r.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,c,m,x){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||x&&x.length)&&(this.id=m.id,this.gpuTimingStart(m),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(m.type)||n.terrain&&m.type==="custom")&&mc[m.type](n,c,m,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let m=this.gpuTimers[n.id];m||(m=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),m.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,c=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),n.beginQueryEXT(n.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const c={};for(const m in n){const x=n[m],w=this.context.extTimerQuery,A=w.getQueryObjectEXT(x.query,w.QUERY_RESULT_EXT)/1e6;w.deleteQueryEXT(x.query),c[m]=A}return c}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let m=0;for(const x of n)m+=c.getQueryObjectEXT(x,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(x);return m}translatePosMatrix(n,c,m,x,w){if(!m[0]&&!m[1])return n;const A=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(A){const B=Math.sin(A),F=Math.cos(A);m=[m[0]*F-m[1]*B,m[0]*B+m[1]*F]}const L=[w?m[0]:bn(c,m[0],this.transform.zoom),w?m[1]:bn(c,m[1],this.transform.zoom),0],P=new Float32Array(16);return r.translate(P,n,L),P}saveTileTexture(n){const c=this._tileTextures[n.size[0]];c?c.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}isPatternMissing(n){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&this.terrain.exaggeration()===0,m=this.style&&this.style.fog,x=[];return this.terrainRenderModeElevated()&&x.push("TERRAIN"),this.transform.projection.name==="globe"&&x.push("GLOBE"),c&&x.push("ZERO_EXAGGERATION"),m&&!n&&m.getOpacity(this.transform.pitch)!==0&&x.push("FOG"),n&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}useProgram(n,c,m){this.cache=this.cache||{};const x=m||[],w=this.currentGlobalDefines().concat(x),A=Uc.cacheKey(po[n],n,w,c);return this.cache[A]||(this.cache[A]=new Uc(this.context,n,po[n],c,ns[n],w)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=r.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,c,m){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const w=x.getOpacity(this.transform.pitch),A=((L,P,B,F,H,ee,se,re,oe,le,J)=>{const me=L.transform,fe=P.properties.get("color").toArray01();fe[3]=F;const ge=L.frameCounter/1e3%1;return{u_fog_matrix:B?me.calculateFogTileMatrix(B):L.identityMat,u_fog_range:P.getFovAdjustedRange(me._fov),u_fog_color:fe,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:ge,u_frustum_tl:H,u_frustum_tr:ee,u_frustum_br:se,u_frustum_bl:re,u_globe_pos:oe,u_globe_radius:le,u_viewport:J,u_globe_transition:r.globeToMercatorTransition(me.zoom),u_is_globe:+(me.projection.name==="globe")}})(this,x,m,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.exported.devicePixelRatio,this.transform.height*r.exported.devicePixelRatio]);c.setFogUniformValues(n,A)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const x of m)c[x.key]=n[x.key]||new r.Tile(x,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class Io{constructor(n=0,c=0,m=0,x=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(m)||m<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=m,this.right=x}interpolate(n,c,m){return c.top!=null&&n.top!=null&&(this.top=r.number(n.top,c.top,m)),c.bottom!=null&&n.bottom!=null&&(this.bottom=r.number(n.bottom,c.bottom,m)),c.left!=null&&n.left!=null&&(this.left=r.number(n.left,c.left,m)),c.right!=null&&n.right!=null&&(this.right=r.number(n.right,c.right,m)),this}getCenter(n,c){const m=r.clamp((this.left+n-this.right)/2,0,n),x=r.clamp((this.top+c-this.bottom)/2,0,c);return new r.pointGeometry(m,x)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Io(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ul(f,n){const c=r.getColumn(f,3);r.fromQuat(f,n),r.setColumn(f,3,c)}function _c(f,n){const c=r.identity$1([]);return r.rotateZ$1(c,c,-n),r.rotateX$1(c,c,-f),c}function hl(f,n){const c=[f[0],f[1],0],m=[n[0],n[1],0];if(r.length(c)>=1e-15){const A=r.normalize([],c);r.scale$2(m,A,r.dot(m,A)),n[0]=m[0],n[1]=m[1]}const x=r.cross([],n,f);if(r.len(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return _c(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),w)}class dl{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){if(n){const c=n instanceof r.MercatorCoordinate?n:new r.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(c.x=r.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(n,c){if(this.orientation=null,!this.position)return;const m=this._elevation?this._elevation.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(n)):0,x=this.position,w=r.MercatorCoordinate.fromLngLat(n,m),A=[w.x-x.x,w.y-x.y,w.z-x.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=hl(A,c)}setPitchBearing(n,c){this.orientation=_c(r.degToRad(n),r.degToRad(-c))}}class jc{constructor(n,c){this._transform=r.identity([]),this.orientation=c,this.position=n}get mercatorPosition(){const n=this.position;return new r.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=r.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var c;n&&r.setColumn(this._transform,3,[(c=n)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||r.identity$1([]),n&&ul(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=_c(n,c),ul(this._transform,this._orientation)}forward(){const n=r.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=r.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=r.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const m=new Float64Array(16);return r.invert(m,this.getWorldToCamera(n,c)),m}getWorldToCameraPosition(n,c,m){const x=this.position;r.scale$2(x,x,-n);const w=new Float64Array(16);return r.fromScaling(w,[m,m,m]),r.translate(w,w,x),w[10]*=c,w}getWorldToCamera(n,c){const m=new Float64Array(16),x=new Float64Array(4),w=this.position;return r.conjugate(x,this._orientation),r.scale$2(w,w,-n),r.fromQuat(m,x),r.translate(m,m,w),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=c,m[9]*=c,m[10]*=c,m[11]*=c,m}getCameraToClipPerspective(n,c,m,x){const w=new Float64Array(16);return r.perspective(w,n,c,m,x),w}getDistanceToElevation(n,c=!1){const m=n===0?0:r.mercatorZfromAltitude(n,c?r.latFromMercatorY(this.position[1]):this.position[1]),x=this.forward();return(m-this.position[2])/x[2]}clone(){return new jc([...this.position],[...this.orientation])}}function Bl(f,n){const c=Ha(f.projection,f.zoom,f.width,f.height),m=function(w,A,L,P,B){const F=new r.LngLat(L.lng-180*sa,L.lat),H=new r.LngLat(L.lng+180*sa,L.lat),ee=w.project(F.lng,F.lat),se=w.project(H.lng,H.lat),re=-Math.atan2(se.y-ee.y,se.x-ee.x),oe=r.MercatorCoordinate.fromLngLat(L);oe.y=r.clamp(oe.y,-.999975,.999975);const le=oe.toLngLat(),J=w.project(le.lng,le.lat),me=r.MercatorCoordinate.fromLngLat(le);me.x+=sa;const fe=me.toLngLat(),ge=w.project(fe.lng,fe.lat),Ae=ih(ge.x-J.x,ge.y-J.y,re),Te=r.MercatorCoordinate.fromLngLat(le);Te.y+=sa;const De=Te.toLngLat(),He=w.project(De.lng,De.lat),We=ih(He.x-J.x,He.y-J.y,re),Qe=Math.abs(Ae.x)/Math.abs(We.y),Ut=r.identity([]);r.rotateZ(Ut,Ut,-re*(1-(B?0:P)));const Xe=r.identity([]);return r.scale(Xe,Xe,[1,1-(1-Qe)*P,1]),Xe[4]=-We.x/We.y*P,r.rotateZ(Xe,Xe,re),r.multiply(Xe,Ut,Xe),Xe}(f.projection,0,f.center,c,n),x=th(f);return r.scale(m,m,[x,x,1]),m}function th(f){const n=f.projection,c=Ha(f.projection,f.zoom,f.width,f.height),m=gc(n,f.center),x=gc(n,r.LngLat.convert(n.center));return Math.pow(2,m*c+(1-c)*x)}function Ha(f,n,c,m,x=1/0){const w=f.range;if(!w)return 0;const A=Math.min(x,Math.max(c,m)),L=Math.log(A/1024)/Math.LN2;return r.smoothstep(w[0]+L,w[1]+L,n)}const sa=1/4e4;function gc(f,n){const c=r.clamp(n.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),m=new r.LngLat(n.lng-180*sa,c),x=new r.LngLat(n.lng+180*sa,c),w=f.project(m.lng,c),A=f.project(x.lng,c),L=r.MercatorCoordinate.fromLngLat(m),P=r.MercatorCoordinate.fromLngLat(x),B=A.x-w.x,F=A.y-w.y,H=P.x-L.x,ee=P.y-L.y,se=Math.sqrt((H*H+ee*ee)/(B*B+F*F));return Math.log(se)/Math.LN2}function ih(f,n,c){const m=Math.cos(c),x=Math.sin(c);return{x:f*m-n*x,y:f*x+n*m}}class ni{constructor(n,c,m,x,w,A,L){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=m??0,this._maxPitch=x??60,this.setProjection(A),this.setMaxBounds(L),this.width=0,this.height=0,this._center=new r.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Io,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new jc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new ni(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,c=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(n||m)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return r.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=r.getProjection(this.projectionOptions);const m=!I(c,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.getProjection({name:"mercator"});const c=n!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.pointGeometry(this.width,this.height)}get bearing(){return r.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;var m;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(m=new r.ARRAY_TYPE(4),r.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(x,w,A){var L=w[0],P=w[1],B=w[2],F=w[3],H=Math.sin(A),ee=Math.cos(A);x[0]=L*ee+B*H,x[1]=P*ee+F*H,x[2]=L*-H+B*ee,x[3]=P*-H+F*ee}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=r.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=r.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let x=0,w=0;for(let A=0;A<c.length;A++){const L=new r.pointGeometry(c[A][0]*this.width,m+c[A][1]*(this.height-m)),P=n.pointCoordinate(L);if(!P)continue;const B=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);x+=P[3]*B,w+=B}return w===0?NaN:x/w}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(n),w=this._mercatorZfromZoom(this._maxZoom),A=Math.max(x-m,w);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let m;m=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const x=r.length(r.sub([],this._camera.position,m));return r.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!r.exactEquals(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const m=[n.position.x,n.position.y,n.position.z];r.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new dl;return c.position=new r.MercatorCoordinate(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!r.length$1(n))return!1;r.normalize$1(n,n);const c=r.transformQuat([],[0,0,-1],n),m=r.transformQuat([],[0,-1,0],n);if(m[2]<0)return!1;const x=hl(c,m);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;n[2]=r.clamp(n[2],x/m,x/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,m){this._unmodified=!1,this._edgeInsets.interpolate(n,c,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new r.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const m=this.pointCoordinate(new r.pointGeometry(0,0)),x=this.pointCoordinate(new r.pointGeometry(this.width,0)),w=this.pointCoordinate(new r.pointGeometry(this.width,this.height)),A=this.pointCoordinate(new r.pointGeometry(0,this.height)),L=Math.floor(Math.min(m.x,x.x,w.x,A.x)),P=Math.floor(Math.max(m.x,x.x,w.x,A.x)),B=1;for(let F=L-B;F<=P+B;F++)F!==0&&c.push(new r.UnwrappedTileID(F,n))}return c}coveringTiles(n){let c=this.coveringZoomLevel(n);const m=c,x=this.elevation&&!n.isTerrainDEM,w=this.projection.name==="mercator";if(n.minzoom!==void 0&&c<n.minzoom)return[];n.maxzoom!==void 0&&c>n.maxzoom&&(c=n.maxzoom);const A=this.locationCoordinate(this.center),L=this.center.lat,P=1<<c,B=[P*A.x,P*A.y,0],F=this.projection.name==="globe",H=!F,ee=r.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,H),se=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),re=P*r.mercatorZfromAltitude(1,this.center.lat),oe=this._camera.position[2]/r.mercatorZfromAltitude(1,this.center.lat),le=[P*se.x,P*se.y,oe*(H?1:re)],J=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),me=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,fe=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ge=n.isTerrainDEM?-fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ae=this.projection.isReprojectedInTileSpace?th(this):1,Te=Ye=>{const tt=new r.MercatorCoordinate(Ye.x+25e-6,Ye.y,Ye.z),bt=new r.MercatorCoordinate(Ye.x,Ye.y+25e-6,Ye.z),At=Ye.toLngLat(),bi=tt.toLngLat(),fn=bt.toLngLat(),di=this.locationCoordinate(At),si=this.locationCoordinate(bi),Ti=this.locationCoordinate(fn),Mn=Math.hypot(si.x-di.x,si.y-di.y),Li=Math.hypot(Ti.x-di.x,Ti.y-di.y);return Math.sqrt(Mn*Li)*Ae/25e-6},De=Ye=>{const Ge=fe,tt=ge;return{aabb:r.tileAABB(this,P,0,0,0,Ye,tt,Ge,this.projection),zoom:0,x:0,y:0,minZ:tt,maxZ:Ge,wrap:Ye,fullyVisible:!1}},He=[];let We=[];const Qe=c,Ut=n.reparseOverscaled?m:c,Xe=Ye=>Ye*Ye,pt=Xe((oe-this._centerAltitude)*re),it=Ye=>{if(!this._elevation||!Ye.tileID||!w)return;const Ge=this._elevation.getMinMaxForTile(Ye.tileID),tt=Ye.aabb;Ge?(tt.min[2]=Ge.min,tt.max[2]=Ge.max,tt.center[2]=(tt.min[2]+tt.max[2])/2):(Ye.shouldSplit=Ct(Ye),Ye.shouldSplit||(tt.min[2]=tt.max[2]=tt.center[2]=this._centerAltitude))},Ct=Ye=>{if(Ye.zoom<me)return!0;if(Ye.zoom===Qe)return!1;if(Ye.shouldSplit!=null)return Ye.shouldSplit;const Ge=Ye.aabb.distanceX(le),tt=Ye.aabb.distanceY(le);let bt=pt,At=1;if(F){bt=Xe(Ye.aabb.distanceZ(le));const di=Math.pow(2,Ye.zoom),si=r.latFromMercatorY((Ye.y+1)/di),Ti=r.latFromMercatorY(Ye.y/di),Mn=Math.min(Math.max(L,si),Ti),Li=r.circumferenceAtLatitude(Mn)/r.circumferenceAtLatitude(L);if(At=Mn===L?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Li/this._mercatorScaleRatio),this.zoom<=r.GLOBE_ZOOM_THRESHOLD_MIN&&Ye.zoom===Qe-1&&Li>=.9)return!0}else if(x&&(bt=Xe(Ye.aabb.distanceZ(le)*re)),this.projection.isReprojectedInTileSpace&&m<=5){const di=Math.pow(2,Ye.zoom),si=Te(new r.MercatorCoordinate((Ye.x+.5)/di,(Ye.y+.5)/di));At=si>.85?1:si}const bi=Ge*Ge+tt*tt+bt,fn=Xe((1<<Qe-Ye.zoom)*J*At*((di,si)=>{if(si*Xe(.707)<di)return 1;const Ti=Math.sqrt(si/di);return Ti/(1.4144271570014144+(Math.pow(1.1,Ti-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(bt,pt),bi));return bi<fn};if(this.renderWorldCopies)for(let Ye=1;Ye<=3;Ye++)He.push(De(-Ye)),He.push(De(Ye));for(He.push(De(0));He.length>0;){const Ye=He.pop(),Ge=Ye.x,tt=Ye.y;let bt=Ye.fullyVisible;if(!bt){const At=Ye.aabb.intersects(ee);if(At===0)continue;bt=At===2}if(Ye.zoom!==Qe&&Ct(Ye))for(let At=0;At<4;At++){const bi=(Ge<<1)+At%2,fn=(tt<<1)+(At>>1),di={aabb:w?Ye.aabb.quadrant(At):r.tileAABB(this,P,Ye.zoom+1,bi,fn,Ye.wrap,Ye.minZ,Ye.maxZ,this.projection),zoom:Ye.zoom+1,x:bi,y:fn,wrap:Ye.wrap,fullyVisible:bt,tileID:void 0,shouldSplit:void 0,minZ:Ye.minZ,maxZ:Ye.maxZ};x&&!F&&(di.tileID=new r.OverscaledTileID(Ye.zoom+1===Qe?Ut:Ye.zoom+1,Ye.wrap,Ye.zoom+1,bi,fn),it(di)),He.push(di)}else{const At=Ye.zoom===Qe?Ut:Ye.zoom;if(n.minzoom&&n.minzoom>At)continue;const bi=B[0]-(.5+Ge+(Ye.wrap<<Ye.zoom))*(1<<c-Ye.zoom),fn=B[1]-.5-tt,di=Ye.tileID?Ye.tileID:new r.OverscaledTileID(At,Ye.wrap,Ye.zoom,Ge,tt);We.push({tileID:di,distanceSq:bi*bi+fn*fn})}}if(this.fogCullDistSq){const Ye=this.fogCullDistSq,Ge=this.horizonLineFromTop();We=We.filter(tt=>{const bt=[0,0,0,1],At=[r.EXTENT,r.EXTENT,0,1],bi=this.calculateFogTileMatrix(tt.tileID.toUnwrapped());r.transformMat4$1(bt,bt,bi),r.transformMat4$1(At,At,bi);const fn=r.getAABBPointSquareDist(bt,At);if(fn===0)return!0;let di=!1;const si=this._elevation;if(si&&fn>Ye&&Ge!==0){const Ti=this.calculateProjMatrix(tt.tileID.toUnwrapped());let Mn;n.isTerrainDEM||(Mn=si.getMinMaxForTile(tt.tileID)),Mn||(Mn={min:ge,max:fe});const Li=r.furthestTileCorner(this.rotation),Jn=[Li[0]*r.EXTENT,Li[1]*r.EXTENT,Mn.max];r.transformMat4(Jn,Jn,Ti),di=(1-Jn[1])*this.height*.5<Ge}return fn<Ye||di})}return We.sort((Ye,Ge)=>Ye.distanceSq-Ge.distanceSq).map(Ye=>Ye.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const c=r.clamp(n.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),m=this.projection.project(n.lng,c);return new r.pointGeometry(m.x*this.worldSize,m.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,c){let m,x;const w=this.centerPoint;if(this.projection.name==="globe"){const L=this.worldSize;m=(c.x-w.x)/L,x=(c.y-w.y)/L}else{const L=this.pointCoordinate(c),P=this.pointCoordinate(w);m=L.x-P.x,x=L.y-P.y}const A=this.locationCoordinate(n);this.setLocation(new r.MercatorCoordinate(A.x-m,A.y-x))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,c){const m=c?r.mercatorZfromAltitude(c,n.lat):void 0,x=this.projection.project(n.lng,n.lat);return new r.MercatorCoordinate(x.x,x.y,m)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const m=c??this._centerAltitude,x=[n.x,n.y,0,1],w=[n.x,n.y,1,1];r.transformMat4$1(x,x,this.pixelMatrixInverse),r.transformMat4$1(w,w,this.pixelMatrixInverse);const A=w[3];r.scale$1(x,x,1/x[3]),r.scale$1(w,w,1/A);const L=x[2],P=w[2];return{p0:x,p1:w,t:L===P?0:(m-L)/(P-L)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],m=[n.x,n.y,1,1];return r.transformMat4$1(c,c,this.pixelMatrixInverse),r.transformMat4$1(m,m,this.pixelMatrixInverse),r.scale$1(c,c,1/c[3]),r.scale$1(m,m,1/m[3]),c[2]=r.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,m[2]=r.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,r.scale$1(c,c,1/this.worldSize),r.scale$1(m,m,1/this.worldSize),new r.Ray([c[0],c[1],c[2]],r.normalize([],r.sub([],m,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:m,t:x}=n,w=r.mercatorZfromAltitude(c[2],this._center.lat),A=r.mercatorZfromAltitude(m[2],this._center.lat);return new r.MercatorCoordinate(r.number(c[0],m[0],x)/this.worldSize,r.number(c[1],m[1],x)/this.worldSize,r.number(w,A,x))}pointCoordinate(n,c=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,c)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let c=this.projection.pointCoordinate3D(this,n.x,n.y);if(c)return new r.MercatorCoordinate(c[0],c[1],c[2]);let m=0,x=this.horizonLineFromTop();if(n.y>x)return this.pointCoordinate(n);const w=.02*x,A=n.clone();for(let L=0;L<10&&x-m>w;L++){A.y=r.number(m,x,.66);const P=this.projection.pointCoordinate3D(this,A.x,A.y);P?(x=A.y,c=P):m=A.y}return c?new r.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,c){const m=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,x=[n.x*this.worldSize,n.y*this.worldSize,m+n.toAltitude(),1];return r.transformMat4$1(x,x,this.pixelMatrix),x[3]>0?new r.pointGeometry(x[0]/x[3],x[1]/x[3]):new r.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:c}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new r.pointGeometry(c,n)),A=this.pointLocation3D(new r.pointGeometry(x,n)),L=this.pointLocation3D(new r.pointGeometry(x,m)),P=this.pointLocation3D(new r.pointGeometry(c,m));let B=Math.min(w.lng,A.lng,L.lng,P.lng),F=Math.max(w.lng,A.lng,L.lng,P.lng),H=Math.min(w.lat,A.lat,L.lat,P.lat),ee=Math.max(w.lat,A.lat,L.lat,P.lat);const se=Math.pow(2,-this.zoom)/16*270,re=this.projection.name==="globe"?1:4,oe=(le,J,me,fe,ge)=>{const Ae=(le+me)/2,Te=(J+fe)/2,De=new r.pointGeometry(Ae,Te),{lng:He,lat:We}=this.pointLocation3D(De),Qe=Math.max(0,B-He,H-We,He-F,We-ee);B=Math.min(B,He),F=Math.max(F,He),H=Math.min(H,We),ee=Math.max(ee,We),(ge<re||Qe>se)&&(oe(le,J,Ae,Te,ge+1),oe(Ae,Te,me,fe,ge+1))};if(oe(c,n,x,n,1),oe(x,n,x,m,1),oe(x,m,c,m,1),oe(c,m,c,n,1),this.projection.name==="globe"){const[le,J]=r.polesInViewport(this);le?(ee=90,F=180,B=-180):J&&(H=-90,F=180,B=-180)}return new r.LngLatBounds(new r.LngLat(B,H),new r.LngLat(F,ee))}_getBoundsRectangular(n,c){const{top:m,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,L=new r.pointGeometry(x,m),P=new r.pointGeometry(A,m),B=new r.pointGeometry(A,w),F=new r.pointGeometry(x,w);let H=this.pointCoordinate(L,n),ee=this.pointCoordinate(P,n);const se=this.pointCoordinate(B,c),re=this.pointCoordinate(F,c),oe=(le,J)=>(J.y-le.y)/(J.x-le.x);return H.y>1&&ee.y>=0?H=new r.MercatorCoordinate((1-re.y)/oe(re,H)+re.x,1):H.y<0&&ee.y<=1&&(H=new r.MercatorCoordinate(-re.y/oe(re,H)+re.x,0)),ee.y>1&&H.y>=0?ee=new r.MercatorCoordinate((1-se.y)/oe(se,ee)+se.x,1):ee.y<0&&H.y<=1&&(ee=new r.MercatorCoordinate(-se.y/oe(se,ee)+se.x,0)),new r.LngLatBounds().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(se))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=n.visibleDemTiles.reduce((m,x)=>{if(x.dem){const w=x.dem.tree;m.min=Math.min(m.min,w.minimums[0]),m.max=Math.max(m.max,w.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-r.MAX_MERCATOR_LATITUDE,this.maxLat=r.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=r.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=r.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=r.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileMatrix(this,c,n)}calculateDistanceTileData(n){const c=n.key,m=this._distanceTileDataCache;if(m[c])return m[c];const x=n.canonical,w=1/this.height,A=this.cameraWorldSize,L=A/this.zoomScale(x.z),P=(x.x+Math.pow(2,x.z)*n.wrap)*L,B=x.y*L,F=this.point;F.x*=A/this.worldSize,F.y*=A/this.worldSize;const H=this.angle,ee=Math.sin(-H),se=-Math.cos(-H);return m[c]={bearing:[ee,se],center:[(F.x-P)*w,(F.y-B)*w],scale:L/r.EXTENT*w},m[c]}calculateFogTileMatrix(n){const c=n.key,m=this._fogTileMatrixCache;if(m[c])return m[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return r.multiply(x,this.worldToFogMatrix,x),m[c]=new Float32Array(x),m[c]}calculateProjMatrix(n,c=!1){const m=n.key,x=c?this._alignedProjMatrixCache:this._projMatrixCache;if(x[m])return x[m];const w=this.calculatePosMatrix(n,this.worldSize);return r.multiply(w,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,w),x[m]=new Float32Array(w),x[m]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,m=this._pixelsToTileUnitsCache;if(m[c])return m[c];const x=function(w,A){const{scale:L}=w.tileTransform,P=L*r.EXTENT/(w.tileSize*Math.pow(2,A.zoom-w.tileID.overscaledZ+w.tileID.canonical.z));return B=new Float32Array(4),ee=(F=A.inverseAdjustmentMatrix)[1],se=F[2],re=F[3],le=(H=[P,P])[1],B[0]=F[0]*(oe=H[0]),B[1]=ee*oe,B[2]=se*le,B[3]=re*le,B;var B,F,H,ee,se,re,oe,le}(n,this);return m[c]=x,m[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,c=r.fromScaling([],[n,n,n]);return r.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const c=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(c),x=this._camera.forward(),w=r.mercatorZfromAltitude(1,this._center.lat);m[2]/=w,x[2]/=w,r.normalize(x,x);const A=n.raycast(m,x,n.exaggeration());if(A){const L=r.scaleAndAdd([],m,x,A),P=new r.MercatorCoordinate(L[0],L[1],r.mercatorZfromAltitude(L[2],r.latFromMercatorY(L[1]))),B=(P.z+r.length([P.x-m[0],P.y-m[1],P.z-m[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(B),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const c=this._elevation,m=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(m),w=c.getAtPointOrZero(new r.MercatorCoordinate(...x)),A=this.pixelsPerMeter/this.worldSize*w,L=this._minimumHeightOverTerrain(),P=x[2]-A;if(P<=L)if(P<0||n){const B=this.locationCoordinate(this._center,this._centerAltitude),F=[x[0],x[1],B.z-x[2]],H=r.length(F);F[2]-=(L-P)/this._pixelsPerMercatorPixel;const ee=r.length(F);if(ee===0)return;r.scale$2(F,F,H/ee*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],B.z*this._pixelsPerMercatorPixel-F[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const ee=this.center;return ee.lat=r.clamp(ee.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(ee.lng=r.clamp(ee.lng,this.minLng,this.maxLng)),this.center=ee,void(this._constraining=!1)}const c=this._unmodified,{x:m,y:x}=this.point;let w=0,A=m,L=x;const P=this.width/2,B=this.height/2,F=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(x-B<F&&(L=F+B),x+B>H&&(L=H-B),H-F<this.height&&(w=Math.max(w,this.height/(H-F)),L=(H+F)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ee=this.worldMinX*this.scale,se=this.worldMaxX*this.scale,re=this.worldSize/2-(ee+se)/2;A=(m+re+this.worldSize)%this.worldSize-re,A-P<ee&&(A=ee+P),A+P>se&&(A=se-P),se-ee<this.width&&(w=Math.max(w,this.width/(se-ee)),A=(se+ee)/2)}A===m&&L===x||(this.center=this.unproject(new r.pointGeometry(A,L))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.mercatorZfromAltitude(1,this.center.lat)/r.mercatorZfromAltitude(1,r.GLOBE_SCALE_MATCH_LATITUDE));const m=Ha(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const x=this.projection.zAxisUnit==="meters"?c:1,w=this._camera.getWorldToCamera(this.worldSize,x),A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);A[8]=2*-n.x/this.width,A[9]=2*n.y/this.height;let L=r.mul([],A,w);if(this.projection.isReprojectedInTileSpace){const Te=this.locationCoordinate(this.center),De=r.identity([]);r.translate(De,De,[Te.x*this.worldSize,Te.y*this.worldSize,0]),r.multiply(De,De,Bl(this)),r.translate(De,De,[-Te.x*this.worldSize,-Te.y*this.worldSize,0]),r.multiply(L,L,De),this.inverseAdjustmentMatrix=function(He){const We=Bl(He,!0);return Bt([],[We[0],We[1],We[4],We[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=r.scale([],L,[this.worldSize,this.worldSize,this.worldSize/x,1]),this.projMatrix=L,this.invProjMatrix=r.invert(new Float64Array(16),this.projMatrix);const P=r.invert([],A);this.frustumCorners=r.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const B=new Float32Array(16);r.identity(B),r.scale(B,B,[1,-1,1]),r.rotateX(B,B,this._pitch),r.rotateZ(B,B,this.angle);const F=r.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),H=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-n.x/this.width,F[9]=2*(n.y+H)/this.height,this.skyboxMatrix=r.multiply(B,F,B);const ee=this.point,se=ee.x,re=ee.y,oe=this.width%2/2,le=this.height%2/2,J=Math.cos(this.angle),me=Math.sin(this.angle),fe=se-Math.round(se)+J*oe+me*le,ge=re-Math.round(re)+J*le+me*oe,Ae=new Float64Array(L);if(r.translate(Ae,Ae,[fe>.5?fe-1:fe,ge>.5?ge-1:ge,0]),this.alignedProjMatrix=Ae,L=r.create(),r.scale(L,L,[this.width/2,-this.height/2,1]),r.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=r.create(),r.scale(L,L,[1,-1,1]),r.translate(L,L,[-1,-1,0]),r.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=r.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},L=r.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.calculateGlobeMatrix(this);const Te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.transformMat4(Te,Te,w),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,m=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[n,n,c];r.scale$2(w,w,x),r.scale$2(m,m,-1),r.multiply$2(m,m,w);const A=r.create();r.translate(A,A,m),r.scale(A,A,w),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,x)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-m[0]*w,x.y/this.worldSize-m[1]*w,n/this.worldSize*this._centerAltitude-m[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],x=n[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((c-m)/x,1)),this._camera.position=r.scaleAndAdd([],this._camera.position,n,w),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:m,bearing:x}=this._camera.getPitchBearing(),w=r.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.degToRad(this._maxPitch)),L=Math.max((n[2]-w)/Math.cos(m),A),P=this._zoomFromMercatorZ(L);r.scaleAndAdd(n,n,c,L),this._pitch=r.clamp(m,r.degToRad(this.minPitch),r.degToRad(this.maxPitch)),this.angle=r.wrap(x,-Math.PI,Math.PI),this._setZoom(r.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let c=0,m=r.GLOBE_ZOOM_THRESHOLD_MAX,x=0,w=1/0;for(;m-c>1e-6&&m>c;){const A=c+.5*(m-c),L=this.tileSize*Math.pow(2,A),P=this.getCameraToCenterDistance(this.projection,A,L),B=this.scaleZoom(P/(n*this.tileSize)),F=Math.abs(A-B);F<w&&(w=F,x=A),A<B?c=A:m=A}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,c){const m=Math.min(n.x,c.x),x=Math.max(n.x,c.x),w=Math.min(n.y,c.y),A=Math.max(n.y,c.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const L=[new r.pointGeometry(m,w),new r.pointGeometry(x,A),new r.pointGeometry(m,A),new r.pointGeometry(x,w)],P=this.renderWorldCopies?-3:0,B=this.renderWorldCopies?4:1;for(const F of L){const H=this.pointRayIntersection(F);if(H.t<0)return!0;const ee=this.rayIntersectionCoordinate(H);if(ee.x<P||ee.y<0||ee.x>B||ee.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.pointGeometry(0,0),new r.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,c){const m=r.length(r.sub([],this._camera.position,n)),x=this._zoomFromMercatorZ(m)+c;return m-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([c,m,x],w){const A=[c,m,x,1];r.transformMat4$1(A,A,w);const L=A[3]=Math.max(A[3],1e-6);return A[0]/=L,A[1]/=L,A[2]/=L,A}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.pointGeometry(0,n))}}getCameraToCenterDistance(n,c=this.zoom,m=this.worldSize){const x=Ha(n,c,this.width,this.height,1024),w=n.pixelSpaceConversion(this.center.lat,m,x);return .5/Math.tan(.5*this._fov)*this.height*w}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.multiply(n,n,this.globeMatrix),n}}function _a(f,n){let c=!1,m=null;const x=()=>{m=null,c&&(f(),m=setTimeout(x,n),c=!1)};return()=>(c=!0,m||x(),m)}class nh{constructor(n){this._hashName=n&&encodeURIComponent(n),r.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=_a(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,r.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),r.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const c=_u(n);if(this._hashName){const m=this._hashName;let x=!1;const w=r.window.location.hash.slice(1).split("&").map(A=>{const L=A.split("=")[0];return L===m?(x=!0,`${L}=${c}`):A}).filter(A=>A);return x||w.push(`${m}=${c}`),`#${w.join("&")}`}return`#${c}`}_getCurrentHash(){const n=r.window.location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(c=m)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(m=>isNaN(m))){const m=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(c[3]||0):n.getBearing();return n.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:m,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=r.window.location.href.replace(/(#.+)?$/,this.getHashString());r.window.history.replaceState(r.window.history.state,null,n)}}function _u(f,n){const c=f.getCenter(),m=Math.round(100*f.getZoom())/100,x=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),A=Math.round(c.lng*w)/w,L=Math.round(c.lat*w)/w,P=f.getBearing(),B=f.getPitch();let F=n?`/${A}/${L}/${m}`:`${m}/${L}/${A}`;return(P||B)&&(F+="/"+Math.round(10*P)/10),B&&(F+=`/${Math.round(B)}`),F}const qc={linearity:.3,easing:r.bezier(0,0,.3,1)},gu=r.extend({deceleration:2500,maxSpeed:1400},qc),fd=r.extend({deceleration:20,maxSpeed:1400},qc),Oh=r.extend({deceleration:1e3,maxSpeed:360},qc),pd=r.extend({deceleration:1e3,maxSpeed:90},qc);class ss{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=r.exported.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new r.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)c.zoom+=w.zoomDelta||0,c.bearing+=w.bearingDelta||0,c.pitch+=w.pitchDelta||0,w.panDelta&&c.pan._add(w.panDelta),w.around&&(c.around=w.around),w.pinchAround&&(c.pinchAround=w.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const w=rh(c.pan.mag(),m,r.extend({},gu,n||{}));x.offset=c.pan.mult(w.amount/c.pan.mag()),x.center=this._map.transform.center,ws(x,w)}if(c.zoom){const w=rh(c.zoom,m,fd);x.zoom=this._map.transform.zoom+w.amount,ws(x,w)}if(c.bearing){const w=rh(c.bearing,m,Oh);x.bearing=this._map.transform.bearing+r.clamp(w.amount,-179,179),ws(x,w)}if(c.pitch){const w=rh(c.pitch,m,pd);x.pitch=this._map.transform.pitch+w.amount,ws(x,w)}if(x.zoom||x.bearing){const w=c.pinchAround===void 0?c.around:c.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function ws(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function rh(f,n,c){const{maxSpeed:m,linearity:x,deceleration:w}=c,A=r.clamp(f*x/(n/1e3),-m,m),L=Math.abs(A)/(w*x);return{easing:c.easing,duration:1e3*L,amount:A*(L/2)}}class Hs extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,m,x={}){const w=_e(c.getCanvasContainer(),m),A=c.unproject(w);super(n,r.extend({point:w,lngLat:A,originalEvent:m},x)),this._defaultPrevented=!1,this.target=c}}class sh extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,m){const x=n==="touchend"?m.changedTouches:m.touches,w=ct(c.getCanvasContainer(),x),A=w.map(P=>c.unproject(P)),L=w.reduce((P,B,F,H)=>P.add(B.div(H.length)),new r.pointGeometry(0,0));super(n,{points:w,point:L,lngLats:A,lngLat:c.unproject(L),originalEvent:m}),this._defaultPrevented=!1}}class zp extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,m){super(n,{originalEvent:m}),this._defaultPrevented=!1}}class Rh{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new zp(n.type,this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new Hs(n.type,this._map,n))}mouseup(n){this._map.fire(new Hs(n.type,this._map,n))}preclick(n){const c=r.extend({},n);c.type="preclick",this._map.fire(new Hs(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new Hs(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new Hs(n.type,this._map,n))}mouseover(n){this._map.fire(new Hs(n.type,this._map,n))}mouseout(n){this._map.fire(new Hs(n.type,this._map,n))}touchstart(n){return this._firePreventable(new sh(n.type,this._map,n))}touchmove(n){this._map.fire(new sh(n.type,this._map,n))}touchend(n){this._map.fire(new sh(n.type,this._map,n))}touchcancel(n){this._map.fire(new sh(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yc{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new Hs(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new Hs(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class oh{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&n.button===0&&(Ie(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const m=c,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(m)||!this._box&&m.dist(x)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=Z("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const A=Math.min(x.x,m.x),L=Math.max(x.x,m.x),P=Math.min(x.y,m.y),B=Math.max(x.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${P}px)`,this._box.style.width=L-A+"px",this._box.style.height=B-P+"px")})}mouseupWindow(n,c){if(!this._active)return;const m=this._startPos,x=c;if(m&&n.button===0){if(this.reset(),je(),m.x!==x.x||m.y!==x.y)return this._map.fire(new r.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:w=>w.fitScreenCoordinates(m,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ye(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new r.Event(n,{originalEvent:c}))}}function Fl(f,n){const c={};for(let m=0;m<f.length;m++)c[f[m].identifier]=n[m];return c}class yu{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,c,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),m.length===this.numTouches&&(this.centroid=function(x){const w=new r.pointGeometry(0,0);for(const A of x)w._add(A);return w.div(x.length)}(c),this.touches=Fl(m,c)))}touchmove(n,c,m){if(this.aborted||!this.centroid)return;const x=Fl(m,c);for(const w in this.touches){const A=this.touches[w],L=x[w];(!L||L.dist(A)>30)&&(this.aborted=!0)}}touchend(n,c,m){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class fl{constructor(n){this.singleTap=new yu(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,c,m){this.singleTap.touchstart(n,c,m)}touchmove(n,c,m){this.singleTap.touchmove(n,c,m)}touchend(n,c,m){const x=this.singleTap.touchend(n,c,m);if(x){const w=n.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(x)<30;if(w&&A||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class vu{constructor(){this._zoomIn=new fl({numTouches:1,numTaps:2}),this._zoomOut=new fl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,m){this._zoomIn.touchstart(n,c,m),this._zoomOut.touchstart(n,c,m)}touchmove(n,c,m){this._zoomIn.touchmove(n,c,m),this._zoomOut.touchmove(n,c,m)}touchend(n,c,m){const x=this._zoomIn.touchend(n,c,m),w=this._zoomOut.touchend(n,c,m);return x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(x)},{originalEvent:n})}):w?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(w)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Hc={0:1,2:2};class kh{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const m=lt(n);this._correctButton(n,m)&&(this._lastPoint=c,this._eventButton=m)}mousemoveWindow(n,c){const m=this._lastPoint;if(m){if(n.preventDefault(),this._eventButton!=null&&function(x,w){const A=Hc[w];return x.buttons===void 0||(x.buttons&A)!==A}(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(m,c)}}mouseupWindow(n){this._lastPoint&&lt(n)===this._eventButton&&(this._moved&&je(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uf extends kh{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return c===0&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class md extends kh{_correctButton(n,c){return c===0&&n.ctrlKey||c===2}_move(n,c){const m=.8*(c.x-n.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(n){n.preventDefault()}}class _d extends kh{_correctButton(n,c){return c===0&&n.ctrlKey||c===2}_move(n,c){const m=-.5*(c.y-n.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(n){n.preventDefault()}}class xu{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),r.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.pointGeometry(0,0)}touchstart(n,c,m){return this._calculateTransform(n,c,m)}touchmove(n,c,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!r.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,c,m)}}touchend(n,c,m){this._calculateTransform(n,c,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,m){m.length>0&&(this._active=!0);const x=Fl(m,c),w=new r.pointGeometry(0,0),A=new r.pointGeometry(0,0);let L=0;for(const B in x){const F=x[B],H=this._touches[B];H&&(w._add(F),A._add(F.sub(H)),L++,x[B]=F)}if(this._touches=x,L<this._minTouches||!A.mag())return;const P=A.div(L);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(L),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Wc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,c,m){return{}}touchstart(n,c,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,m){const x=this._firstTwoTouches;if(!x)return;n.preventDefault();const[w,A]=x,L=Nl(m,c,w),P=Nl(m,c,A);if(!L||!P)return;const B=this._aroundCenter?null:L.add(P).div(2);return this._move([L,P],B,n)}touchend(n,c,m){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,A=Nl(m,c,x),L=Nl(m,c,w);A&&L||(this._active&&je(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Nl(f,n,c){for(let m=0;m<f.length;m++)if(f[m].identifier===c)return n[m]}function gd(f,n){return Math.log(f/n)/Math.LN2}class ne extends Wc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const m=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(gd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gd(this._distance,m),pinchAround:c}}}function vc(f,n){return 180*f.angleWith(n)/Math.PI}class ah extends Wc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const m=this._vector;if(this._vector=n[0].sub(n[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:vc(this._vector,m),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const x=vc(n,m);return Math.abs(x)<c}}function Mo(f){return Math.abs(f.y)>Math.abs(f.x)}class en extends Wc{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Mo(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,m){const x=this._lastPoints;if(!x)return;const w=n[0].sub(x[0]),A=n[1].sub(x[1]);return this._map._cooperativeGestures&&!r.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(w,A,m.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(w.y+A.y)/2*-.5})}gestureBeginsVertically(n,c,m){if(this._valid!==void 0)return this._valid;const x=n.mag()>=2,w=c.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const A=n.y>0==c.y>0;return Mo(n)&&Mo(c)&&A}}const Bp={panStep:100,bearingStep:15,pitchStep:10};class hf{constructor(){const n=Bp;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,m=0,x=0,w=0,A=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?m=-1:(n.preventDefault(),w=-1);break;case 39:n.shiftKey?m=1:(n.preventDefault(),w=1);break;case 38:n.shiftKey?x=1:(n.preventDefault(),A=-1);break;case 40:n.shiftKey?x=-1:(n.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(m=0,x=0),{cameraAnimation:L=>{const P=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:Fp,zoom:c?Math.round(P)+c*(n.shiftKey?2:1):P,bearing:L.getBearing()+m*this._bearingStep,pitch:L.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-A*this._panStep],center:L.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fp(f){return f*(2-f)}const xc=4.000244140625;class Ul{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,r.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||r.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===r.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const m=r.exported.now(),x=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,c!==0&&c%xc==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=_e(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>xc?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&B!==0&&(B=1/B);const F=c(),H=Math.pow(2,F),ee=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):H;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(ee*B))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:c(),x=this._startZoom,w=this._easing;let A,L=!1;if(this._type==="wheel"&&x&&w){const P=Math.min((r.exported.now()-this._lastWheelEventTime)/200,1),B=w(P);A=r.number(x,m,B),P<1?this._frameId||(this._frameId=!0):L=!0}else A=m,L=!0;return this._active=!0,L&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!L,zoomDelta:A-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=r.ease;if(this._prevEase){const m=this._prevEase,x=(r.exported.now()-m.start)/m.duration,w=m.easing(x+.01)-m.easing(x),A=.27/Math.sqrt(w*w+1e-4)*.01,L=Math.sqrt(.0729-A*A);c=r.bezier(A,L,.25,1)}return this._prevEase={start:r.exported.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Z("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(r.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class df{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(n.shiftKey?-1:1),around:m.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pl{constructor(){this._tap=new fl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,c,m){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=c[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(n,c,m))}touchmove(n,c,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const x=c[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,n.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(n,c,m)}touchend(n,c,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(n,c,m)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zh{constructor(n,c,m){this._el=n,this._mousePan=c,this._touchPan=m}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ri{constructor(n,c,m){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ff{constructor(n,c,m,x){this._el=n,this._touchZoom=c,this._touchRotate=m,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const lh=f=>f.zoom||f.drag||f.pitch||f.rotate;class ch extends r.Event{}class uh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const m=r.sub([],c,n);this.radius=r.length(m[2]<0?r.div([],m,this.constants):[m[0],m[1],0])}projectRay(n){r.div(n,n,this.constants),r.normalize(n,n),r.mul$1(n,n,this.constants);const c=r.scale$2([],n,this.radius);if(c[2]>0){const m=r.scale$2([],[0,0,1],r.dot(c,[0,0,1])),x=r.scale$2([],r.normalize([],[c[0],c[1],0]),this.radius),w=r.add([],c,r.scale$2([],r.sub([],r.add([],x,m),c),2));c[0]=w[0],c[1]=w[1]}return c}}function hh(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class ml{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ss(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new uh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),r.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[r.window.document,"mousemove",{capture:!0}],[r.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[r.window,"blur",void 0]];for(const[x,w,A]of this._listeners)x.addEventListener(w,x===r.window.document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[n,c,m]of this._listeners)n.removeEventListener(c,n===r.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(n){const c=this._map,m=c.getCanvasContainer();this._add("mapEvent",new Rh(c,n));const x=c.boxZoom=new oh(c,n);this._add("boxZoom",x);const w=new vu,A=new bu;c.doubleClickZoom=new df(A,w),this._add("tapZoom",w),this._add("clickZoom",A);const L=new pl;this._add("tapDragZoom",L);const P=c.touchPitch=new en(c);this._add("touchPitch",P);const B=new md(n),F=new _d(n);c.dragRotate=new ri(n,B,F),this._add("mouseRotate",B,["mousePitch"]),this._add("mousePitch",F,["mouseRotate"]);const H=new uf(n),ee=new xu(c,n);c.dragPan=new zh(m,H,ee),this._add("mousePan",H),this._add("touchPan",ee,["touchZoom","touchRotate"]);const se=new ah,re=new ne;c.touchZoomRotate=new ff(m,re,se,L),this._add("touchRotate",se,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new yc(c));const oe=c.scrollZoom=new Ul(c,this);this._add("scrollZoom",oe,["mousePan"]);const le=c.keyboard=new hf;this._add("keyboard",le);for(const J of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[J]&&c[J].enable(n[J])}_add(n,c,m){this._handlers.push({handlerName:n,handler:c,allowed:m}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!lh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,c,m){for(const x in n)if(x!==m&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const m of n)this._el.contains(m.target)&&c.push(m);return c}handleEvent(n,c){this._updatingCamera=!0;const m=n.type==="renderFrame",x=m?void 0:n,w={needsRenderFrame:!1},A={},L={},P=n.touches?this._getMapTouches(n.touches):void 0,B=P?ct(this._el,P):m?void 0:_e(this._el,n);for(const{handlerName:ee,handler:se,allowed:re}of this._handlers){if(!se.isEnabled())continue;let oe;this._blockedByActive(L,re,ee)?se.reset():se[c||n.type]&&(oe=se[c||n.type](n,B,P),this.mergeHandlerResult(w,A,oe,ee,x),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()),(oe||se.isActive())&&(L[ee]=se)}const F={};for(const ee in this._previousActiveHandlers)L[ee]||(F[ee]=x);this._previousActiveHandlers=L,(Object.keys(F).length||hh(w))&&(this._changes.push([w,A,F]),this._triggerRenderFrame()),(Object.keys(L).length||hh(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=w;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(n,c,m,x,w){if(!m)return;r.extend(n,m);const A={handlerName:x,originalEvent:m.originalEvent||w};m.zoomDelta!==void 0&&(c.zoom=A),m.panDelta!==void 0&&(c.drag=A),m.pitchDelta!==void 0&&(c.pitch=A),m.bearingDelta!==void 0&&(c.rotate=A)}_applyChanges(){const n={},c={},m={};for(const[x,w,A]of this._changes)x.panDelta&&(n.panDelta=(n.panDelta||new r.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(n.around=x.around),x.aroundCoord!==void 0&&(n.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(n.pinchAround=x.pinchAround),x.noInertia&&(n.noInertia=x.noInertia),r.extend(c,w),r.extend(m,A);this._updateMapTransform(n,c,m),this._changes=[]}_updateMapTransform(n,c,m){const x=this._map,w=x.transform,A=me=>[me.x,me.y,me.z];if((me=>{const fe=this._eventsInProgress.drag;return fe&&!this._handlersById[fe.handlerName].isActive()})()&&!hh(n)){const me=w.zoom;w.cameraElevationReference="sea",w.recenterOnTerrain(),w.cameraElevationReference="ground",me!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!hh(n))return void this._fireEvents(c,m,!0);let{panDelta:L,zoomDelta:P,bearingDelta:B,pitchDelta:F,around:H,aroundCoord:ee,pinchAround:se}=n;w._isCameraConstrained&&(P>0&&(P=0),w._isCameraConstrained=!1),se!==void 0&&(H=se),(P||(me=>c.drag&&!this._eventsInProgress.drag)())&&H&&(this._dragOrigin=A(w.pointCoordinate3D(H)),this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),H=H||x.transform.centerPoint,B&&(w.bearing+=B),F&&(w.pitch+=F),w._updateCameraState();const re=[0,0,0];if(L)if(w.projection.name==="mercator"){const me=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(H).dir),fe=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(H.sub(L)).dir);re[0]=fe[0]-me[0],re[1]=fe[1]-me[1]}else{const me=w.pointCoordinate(H);if(w.projection.name==="globe"){L=L.rotate(-w.angle);const fe=w._pixelsPerMercatorPixel/w.worldSize;re[0]=-L.x*r.mercatorScale(r.latFromMercatorY(me.y))*fe,re[1]=-L.y*r.mercatorScale(w.center.lat)*fe}else{const fe=w.pointCoordinate(H.sub(L));me&&fe&&(re[0]=fe.x-me.x,re[1]=fe.y-me.y)}}const oe=w.zoom,le=[0,0,0];if(P){const me=A(ee||w.pointCoordinate3D(H)),fe={dir:r.normalize([],r.sub([],me,w._camera.position))};if(fe.dir[2]<0){const ge=w.zoomDeltaToMovement(me,P);r.scale$2(le,fe.dir,ge)}}const J=r.add(re,re,le);w._translateCameraConstrained(J),P&&Math.abs(w.zoom-oe)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,m,!0)}_fireEvents(n,c,m){const x=lh(this._eventsInProgress),w=lh(n),A={};for(const F in n){const{originalEvent:H}=n[F];this._eventsInProgress[F]||(A[`${F}start`]=H),this._eventsInProgress[F]=n[F]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const F in A)this._fireEvent(F,A[F]);w&&this._fireEvent("move",w.originalEvent);for(const F in n){const{originalEvent:H}=n[F];this._fireEvent(F,H)}const L={};let P;for(const F in this._eventsInProgress){const{handlerName:H,originalEvent:ee}=this._eventsInProgress[F];this._handlersById[H].isActive()||(delete this._eventsInProgress[F],P=c[H]||ee,L[`${F}end`]=P)}for(const F in L)this._fireEvent(F,L[F]);const B=lh(this._eventsInProgress);if(m&&(x||w)&&!B){this._updatingCamera=!0;const F=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=ee=>ee!==0&&-this._bearingSnap<ee&&ee<this._bearingSnap;F?(H(F.bearing||this._map.getBearing())&&(F.bearing=0),this._map.easeTo(F,{originalEvent:P})):(this._map.fire(new r.Event("moveend",{originalEvent:P})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new r.Event(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new ch("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const yd="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class pf extends r.Evented{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,r.bindAll(["_renderFrameCallback"],this)}getCenter(){return new r.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,m){return n=r.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,r.extend({offset:n},c),m)}panTo(n,c,m){return this.easeTo(r.extend({center:n},c),m)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,m){return this.easeTo(r.extend({zoom:n},c),m)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,m){return this.easeTo(r.extend({bearing:n},c),m)}resetNorth(n,c){return this.rotateTo(0,r.extend({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(r.extend({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=r.LngLatBounds.convert(n);const m=c&&c.bearing||0,x=c&&c.pitch||0,w=n.getNorthWest(),A=n.getSouthEast();return this._cameraForBounds(this.transform,w,A,m,x,c)}_extendCameraOptions(n){const c={top:0,bottom:0,right:0,left:0};if(typeof(n=r.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const m=n.padding;n.padding={top:m,bottom:m,right:m,left:m}}return n.padding=r.extend(c,n.padding),n}_minimumAABBFrustumDistance(n,c){const m=c.max[0]-c.min[0],x=c.max[1]-c.min[1];return m/x>n.aspect?m/(2*Math.tan(.5*n.fovX)*n.aspect):x/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,c,m,x,w,A){const L=n.clone(),P=this._extendCameraOptions(A);L.bearing=x,L.pitch=w;const B=r.LngLat.convert(c),F=r.LngLat.convert(m),H=.5*(B.lat+F.lat),ee=.5*(B.lng+F.lng),se=r.latLngToECEF(H,ee),re=r.normalize([],se),oe=r.normalize([],r.cross([],re,[0,1,0])),le=r.cross([],oe,re),J=[oe[0],oe[1],oe[2],0,le[0],le[1],le[2],0,re[0],re[1],re[2],0,0,0,0,1],me=[se,r.latLngToECEF(B.lat,B.lng),r.latLngToECEF(F.lat,B.lng),r.latLngToECEF(F.lat,F.lng),r.latLngToECEF(B.lat,F.lng),r.latLngToECEF(H,B.lng),r.latLngToECEF(H,F.lng),r.latLngToECEF(B.lat,ee),r.latLngToECEF(F.lat,ee)];let fe=r.Aabb.fromPoints(me.map(bt=>[r.dot(oe,bt),r.dot(le,bt),r.dot(re,bt)]));const ge=r.transformMat4([],fe.center,J);r.squaredLength(ge)===0&&r.set(ge,0,0,1),r.normalize(ge,ge),r.scale$2(ge,ge,r.GLOBE_RADIUS),L.center=r.ecefToLatLng(ge);const Ae=L.getWorldToCameraMatrix(),Te=r.invert(new Float64Array(16),Ae);fe=r.Aabb.applyTransform(fe,r.multiply([],Ae,J)),r.transformMat4(ge,ge,Ae);const De=.5*(fe.max[2]-fe.min[2]),He=this._minimumAABBFrustumDistance(L,fe),We=r.scale$2([],[0,0,1],De),Qe=r.add(We,ge,We),Ut=He+(L.pitch===0?0:r.distance(ge,Qe)),Xe=L.globeCenterInViewSpace,pt=r.sub([],ge,[Xe[0],Xe[1],Xe[2]]);r.normalize(pt,pt),r.scale$2(pt,pt,Ut);const it=r.add([],ge,pt);r.transformMat4(it,it,Te);const Ct=r.earthRadius/r.GLOBE_RADIUS,Ye=r.length(it),Ge=r.mercatorZfromAltitude(Math.max(Ye*Ct-r.earthRadius,Number.EPSILON),0),tt=Math.min(L.zoomFromMercatorZAdjusted(Ge),P.maxZoom);return tt>.5*(r.GLOBE_ZOOM_THRESHOLD_MIN+r.GLOBE_ZOOM_THRESHOLD_MAX)?(L.setProjection({name:"mercator"}),L.zoom=tt,this._cameraForBounds(L,c,m,x,w,A)):{center:L.center,zoom:tt,bearing:x,pitch:w}}queryTerrainElevation(n,c){const m=this.transform.elevation;return m?(c=r.extend({},{exaggerated:!0},c),m.getAtPoint(r.MercatorCoordinate.fromLngLat(n),null,c.exaggerated)):null}_cameraForBounds(n,c,m,x,w,A){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,c,m,x,w,A);const L=n.clone(),P=this._extendCameraOptions(A),B=L.padding;L.bearing=x,L.pitch=w;const F=r.LngLat.convert(c),H=r.LngLat.convert(m),ee=new r.LngLat(F.lng,H.lat),se=new r.LngLat(H.lng,F.lat),re=L.project(F),oe=L.project(H),le=this.queryTerrainElevation(F),J=this.queryTerrainElevation(H),me=this.queryTerrainElevation(ee),fe=this.queryTerrainElevation(se),ge=[[re.x,re.y,Math.min(le||0,J||0,me||0,fe||0)],[oe.x,oe.y,Math.max(le||0,J||0,me||0,fe||0)]];let Ae=r.Aabb.fromPoints(ge);const Te=L.getWorldToCameraMatrix(),De=r.invert(new Float64Array(16),Te);Ae=r.Aabb.applyTransform(Ae,Te);const He=r.sub([],Ae.max,Ae.min),We=B.left||0,Qe=B.right||0,Ut=B.bottom||0,Xe=B.top||0,{left:pt,right:it,top:Ct,bottom:Ye}=P.padding,Ge=.5*(We+Qe),tt=.5*(Xe+Ut),bt=Math.min(L.scaleZoom(L.scale*Math.min((L.width-(We+Qe+pt+it))/He[0],(L.height-(Ut+Xe+Ye+Ct))/He[1])),P.maxZoom),At=L.scale/L.zoomScale(bt);Ae=new r.Aabb([Ae.min[0]-(pt+Ge)*At,Ae.min[1]-(Ye+tt)*At,Ae.min[2]],[Ae.max[0]+(it+Ge)*At,Ae.max[1]+(Ct+tt)*At,Ae.max[2]]);const bi=.5*He[2],fn=this._minimumAABBFrustumDistance(L,Ae),di=[0,0,1,0];r.transformMat4$1(di,di,Te),r.normalize$2(di,di);const si=r.scale$2([],di,fn+bi),Ti=r.add([],Ae.center,si),Mn=(typeof P.offset.x=="number"&&typeof P.offset.y=="number"?new r.pointGeometry(P.offset.x,P.offset.y):r.pointGeometry.convert(P.offset)).rotate(-r.degToRad(x));Ae.center[0]-=Mn.x*At,Ae.center[1]+=Mn.y*At,r.transformMat4(Ae.center,Ae.center,De),r.transformMat4(Ti,Ti,De);const Li=[Ae.center[0],Ae.center[1],Ti[2]*L.pixelsPerMeter];r.scale$2(Li,Li,1/L.worldSize);const Jn=r.lngFromMercatorX(Li[0]),or=r.latFromMercatorY(Li[1]),br=Math.min(L._zoomFromMercatorZ(Li[2]),P.maxZoom),lr=new r.LngLat(Jn,or);return L.mercatorFromTransition&&br<.5*(r.GLOBE_ZOOM_THRESHOLD_MIN+r.GLOBE_ZOOM_THRESHOLD_MAX)?(L.setProjection({name:"globe"}),L.zoom=br,this._cameraForBounds(L,c,m,x,w,A)):{center:lr,zoom:br,bearing:x,pitch:w}}fitBounds(n,c,m){const x=this.cameraForBounds(n,c);return this._fitInternal(x,c,m)}fitScreenCoordinates(n,c,m,x,w){const A=r.pointGeometry.convert(n),L=r.pointGeometry.convert(c),P=new r.pointGeometry(Math.min(A.x,L.x),Math.min(A.y,L.y)),B=new r.pointGeometry(Math.max(A.x,L.x),Math.max(A.y,L.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,L))return this;const F=this.transform.pointLocation3D(P),H=this.transform.pointLocation3D(B),ee=this.transform.pointLocation3D(new r.pointGeometry(P.x,B.y)),se=this.transform.pointLocation3D(new r.pointGeometry(B.x,P.y)),re=[Math.min(F.lng,H.lng,ee.lng,se.lng),Math.min(F.lat,H.lat,ee.lat,se.lat)],oe=[Math.max(F.lng,H.lng,ee.lng,se.lng),Math.max(F.lat,H.lat,ee.lat,se.lat)],le=x&&x.pitch?x.pitch:this.getPitch(),J=this._cameraForBounds(this.transform,re,oe,m,le,x);return this._fitInternal(J,x,w)}_fitInternal(n,c,m){return n?(delete(c=r.extend(n,c)).padding,c.linear?this.easeTo(c,m):this.flyTo(c,m)):this}jumpTo(n,c){this.stop();const m=n.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,A=!1;return"zoom"in n&&m.zoom!==+n.zoom&&(x=!0,m.zoom=+n.zoom),n.center!==void 0&&(m.center=r.LngLat.convert(n.center)),"bearing"in n&&m.bearing!==+n.bearing&&(w=!0,m.bearing=+n.bearing),"pitch"in n&&m.pitch!==+n.pitch&&(A=!0,m.pitch=+n.pitch),n.padding==null||m.isPaddingEqual(n.padding)||(m.padding=n.padding),n.preloadOnly?(this._preloadTiles(m),this):(this.fire(new r.Event("movestart",c)).fire(new r.Event("move",c)),x&&this.fire(new r.Event("zoomstart",c)).fire(new r.Event("zoom",c)).fire(new r.Event("zoomend",c)),w&&this.fire(new r.Event("rotatestart",c)).fire(new r.Event("rotate",c)).fire(new r.Event("rotateend",c)),A&&this.fire(new r.Event("pitchstart",c)).fire(new r.Event("pitch",c)).fire(new r.Event("pitchend",c)),this.fire(new r.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.warnOnce(yd),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const m=this.transform;if(!m.projection.supportsFreeCamera)return r.warnOnce(yd),this;this.stop();const x=m.zoom,w=m.pitch,A=m.bearing;m.setFreeCameraOptions(n);const L=x!==m.zoom,P=w!==m.pitch,B=A!==m.bearing;return this.fire(new r.Event("movestart",c)).fire(new r.Event("move",c)),L&&this.fire(new r.Event("zoomstart",c)).fire(new r.Event("zoom",c)).fire(new r.Event("zoomend",c)),B&&this.fire(new r.Event("rotatestart",c)).fire(new r.Event("rotate",c)).fire(new r.Event("rotateend",c)),P&&this.fire(new r.Event("pitchstart",c)).fire(new r.Event("pitch",c)).fire(new r.Event("pitchend",c)),this.fire(new r.Event("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),((n=r.extend({offset:[0,0],duration:500,easing:r.ease},n)).animate===!1||!n.essential&&r.exported.prefersReducedMotion)&&(n.duration=0);const m=this.transform,x=this.getZoom(),w=this.getBearing(),A=this.getPitch(),L=this.getPadding(),P="zoom"in n?+n.zoom:x,B="bearing"in n?this._normalizeBearing(n.bearing,w):w,F="pitch"in n?+n.pitch:A,H="padding"in n?n.padding:m.padding,ee=r.pointGeometry.convert(n.offset);let se,re,oe;if(m.projection.name==="globe"){const We=r.MercatorCoordinate.fromLngLat(m.center),Qe=ee.rotate(-m.angle);We.x+=Qe.x/m.worldSize,We.y+=Qe.y/m.worldSize;const Ut=We.toLngLat(),Xe=r.LngLat.convert(n.center||Ut);this._normalizeCenter(Xe),se=m.centerPoint.add(Qe),re=new r.pointGeometry(We.x,We.y).mult(m.worldSize),oe=new r.pointGeometry(r.mercatorXfromLng(Xe.lng),r.mercatorYfromLat(Xe.lat)).mult(m.worldSize).sub(re)}else{se=m.centerPoint.add(ee);const We=m.pointLocation(se),Qe=r.LngLat.convert(n.center||We);this._normalizeCenter(Qe),re=m.project(We),oe=m.project(Qe).sub(re)}const le=m.zoomScale(P-x);let J,me;n.around&&(J=r.LngLat.convert(n.around),me=m.locationPoint(J));const fe=this._zooming||P!==x,ge=this._rotating||w!==B,Ae=this._pitching||F!==A,Te=!m.isPaddingEqual(H),De=We=>Qe=>{if(fe&&(We.zoom=r.number(x,P,Qe)),ge&&(We.bearing=r.number(w,B,Qe)),Ae&&(We.pitch=r.number(A,F,Qe)),Te&&(We.interpolatePadding(L,H,Qe),se=We.centerPoint.add(ee)),J)We.setLocationAtPoint(J,me);else{const Ut=We.zoomScale(We.zoom-x),Xe=P>x?Math.min(2,le):Math.max(.5,le),pt=Math.pow(Xe,1-Qe),it=We.unproject(re.add(oe.mult(Qe*pt)).mult(Ut));We.setLocationAtPoint(We.renderWorldCopies?it.wrap():it,se)}return n.preloadOnly||this._fireMoveEvents(c),We};if(n.preloadOnly){const We=this._emulate(De,n.duration,m);return this._preloadTiles(We),this}const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=fe,this._rotating=ge,this._pitching=Ae,this._padding=Te,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,He),this._ease(De(m),We=>{m.recenterOnTerrain(),this._afterEase(c,We)},n),this}_prepareEase(n,c,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||m.moving||this.fire(new r.Event("movestart",n)),this._zooming&&!m.zooming&&this.fire(new r.Event("zoomstart",n)),this._rotating&&!m.rotating&&this.fire(new r.Event("rotatestart",n)),this._pitching&&!m.pitching&&this.fire(new r.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new r.Event("move",n)),this._zooming&&this.fire(new r.Event("zoom",n)),this._rotating&&this.fire(new r.Event("rotate",n)),this._pitching&&this.fire(new r.Event("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new r.Event("zoomend",n)),x&&this.fire(new r.Event("rotateend",n)),w&&this.fire(new r.Event("pitchend",n)),this.fire(new r.Event("moveend",n))}flyTo(n,c){if(!n.essential&&r.exported.prefersReducedMotion){const bt=r.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(bt,c)}this.stop(),n=r.extend({offset:[0,0],speed:1.2,curve:1.42,easing:r.ease},n);const m=this.transform,x=this.getZoom(),w=this.getBearing(),A=this.getPitch(),L=this.getPadding(),P="zoom"in n?r.clamp(+n.zoom,m.minZoom,m.maxZoom):x,B="bearing"in n?this._normalizeBearing(n.bearing,w):w,F="pitch"in n?+n.pitch:A,H="padding"in n?n.padding:m.padding,ee=m.zoomScale(P-x),se=r.pointGeometry.convert(n.offset);let re=m.centerPoint.add(se);const oe=m.pointLocation(re),le=r.LngLat.convert(n.center||oe);this._normalizeCenter(le);const J=m.project(oe),me=m.project(le).sub(J);let fe=n.curve;const ge=Math.max(m.width,m.height),Ae=ge/ee,Te=me.mag();if("minZoom"in n){const bt=r.clamp(Math.min(n.minZoom,x,P),m.minZoom,m.maxZoom),At=ge/m.zoomScale(bt-x);fe=Math.sqrt(At/Te*2)}const De=fe*fe;function He(bt){const At=(Ae*Ae-ge*ge+(bt?-1:1)*De*De*Te*Te)/(2*(bt?Ae:ge)*De*Te);return Math.log(Math.sqrt(At*At+1)-At)}function We(bt){return(Math.exp(bt)-Math.exp(-bt))/2}function Qe(bt){return(Math.exp(bt)+Math.exp(-bt))/2}const Ut=He(0);let Xe=function(bt){return Qe(Ut)/Qe(Ut+fe*bt)},pt=function(bt){return ge*((Qe(Ut)*(We(At=Ut+fe*bt)/Qe(At))-We(Ut))/De)/Te;var At},it=(He(1)-Ut)/fe;if(Math.abs(Te)<1e-6||!isFinite(it)){if(Math.abs(ge-Ae)<1e-6)return this.easeTo(n,c);const bt=Ae<ge?-1:1;it=Math.abs(Math.log(Ae/ge))/fe,pt=function(){return 0},Xe=function(At){return Math.exp(bt*fe*At)}}n.duration="duration"in n?+n.duration:1e3*it/("screenSpeed"in n?+n.screenSpeed/fe:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Ct=w!==B,Ye=F!==A,Ge=!m.isPaddingEqual(H),tt=bt=>At=>{const bi=At*it,fn=1/Xe(bi);bt.zoom=At===1?P:x+bt.scaleZoom(fn),Ct&&(bt.bearing=r.number(w,B,At)),Ye&&(bt.pitch=r.number(A,F,At)),Ge&&(bt.interpolatePadding(L,H,At),re=bt.centerPoint.add(se));const di=At===1?le:bt.unproject(J.add(me.mult(pt(bi))).mult(fn));return bt.setLocationAtPoint(bt.renderWorldCopies?di.wrap():di,re),bt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(c),bt};if(n.preloadOnly){const bt=this._emulate(tt,n.duration,m);return this._preloadTiles(bt),this}return this._zooming=!0,this._rotating=Ct,this._pitching=Ye,this._padding=Ge,this._prepareEase(c,!1),this._ease(tt(m),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,c)}if(!n){const m=this.handlers;m&&m.stop(!1)}return this}_ease(n,c,m){m.animate===!1||m.duration===0?(n(1),c()):(this._easeStart=r.exported.now(),this._easeOptions=m,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((r.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=r.wrap(n,-180,180);const m=Math.abs(n-c);return Math.abs(n-360-c)<m&&(n-=360),Math.abs(n+360-c)<m&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const m=n.lng-c.center.lng;n.lng+=m>180?-360:m<-180?360:0}_emulate(n,c,m){const x=Math.ceil(15*c/1e3),w=[],A=n(m.clone());for(let L=0;L<=x;L++){const P=A(L/x);w.push(P.clone())}return w}}class vd{constructor(n={}){this.options=n,r.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact;return this._map=n,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z("button","mapboxgl-ctrl-attrib-button",this._container),Z("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,c){const m=this._map._getUIString(`AttributionControl.${c}`);n.setAttribute("aria-label",m),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.config.ACCESS_TOKEN}];if(n){const m=c.reduce((x,w,A)=>(w.value&&(x+=`${w.key}=${w.value}${A<c.length-1?"&":""}`),x),"?");n.href=`${r.config.FEEDBACK_URL}/${m}#${_u(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._sourceCaches;for(const x in c){const w=c[x];if(w.used){const A=w.getSource();A.attribution&&n.indexOf(A.attribution)<0&&n.push(A.attribution)}}n.sort((x,w)=>x.length-w.length),n=n.filter((x,w)=>{for(let A=w+1;A<n.length;A++)if(n[A].indexOf(x)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const m=n.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,n.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class xd{constructor(){r.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=Z("div","mapboxgl-ctrl");const c=Z("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const c in n){const m=n[c].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class dh{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,m=c?this._queue.concat(c):this._queue;for(const x of m)if(x.id===n)return void(x.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const m of c)if(!m.cancelled&&(m.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function _l(f,n,c){if(f=new r.LngLat(f.lng,f.lat),n){const m=new r.LngLat(f.lng-360,f.lat),x=new r.LngLat(f.lng+360,f.lat),w=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),A=c.locationPoint(f).distSqr(n),L=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint(m).distSqr(n)<A&&(L||Math.abs(m.lng-c.center.lng)<w)?f=m:c.locationPoint(x).distSqr(n)<A&&(L||Math.abs(x.lng-c.center.lng)<w)&&(f=x)}for(;Math.abs(f.lng-c.center.lng)>180;){const m=c.locationPoint(f);if(m.x>=0&&m.y>=0&&m.x<=c.width&&m.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const wu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Bh extends r.Evented{constructor(n,c){if(super(),(n instanceof r.window.HTMLElement||c)&&(n=r.extend({element:n},c)),r.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=r.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z("div");const x=41,w=27,A=Y("svg",{display:"block",height:x*this._scale+"px",width:w*this._scale+"px",viewBox:`0 0 ${w} ${x}`},this._element),L=Y("radialGradient",{id:"shadowGradient"},Y("defs",{},A));Y("stop",{offset:"10%","stop-opacity":.4},L),Y("stop",{offset:"100%","stop-opacity":.05},L),Y("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),Y("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),Y("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),Y("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=r.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const m=this._element.classList;for(const x in wu)m.remove(`mapboxgl-marker-anchor-${x}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=r.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,m=n.charCode||n.keyCode;c!=="Space"&&c!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,m=this._element;this._popup&&(c===m||m.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,c=this._pos;if(!n||!c)return!1;const m=n.unproject(c),x=n.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(m)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const c=this._pos;if(!c||c.x<0||c.x>n.transform.width||c.y<0||c.y>n.transform.height)return void this._clearFadeTimer();const m=n.unproject(c);let x;n._showingGlobe()&&r.isLngLatBehindGlobe(n.transform,this._lngLat)?x=0:(x=1-n._queryFogOpacity(m),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${wu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const n=this._pos,c=this._map,m=this.getPitchAlignment();if(!c||!n||m!=="map")return"";if(!c._showingGlobe()){const P=c.getPitch();return P?`rotateX(${P}deg)`:""}const x=r.radToDeg(r.globeTiltAtLngLat(c.transform,this._lngLat)),w=n.sub(r.globeCenterToScreenPoint(c.transform)),A=Math.abs(w.x)+Math.abs(w.y);if(A===0)return"";const L=x/A;return`rotateX(${-w.y*L}deg) rotateY(${w.x*L}deg)`}_calculateZTransform(){const n=this._pos,c=this._map;if(!c||!n)return"";let m=0;const x=this.getRotationAlignment();if(x==="map")if(c._showingGlobe()){const w=c.project(new r.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),A=c.project(new r.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);m=r.radToDeg(Math.atan2(A.y,A.x))-90}else m=-c.getBearing();else if(x==="horizon"){const w=r.smoothstep(4,6,c.getZoom()),A=r.globeCenterToScreenPoint(c.transform);A.y+=w*c.transform.height;const L=n.sub(A),P=r.radToDeg(Math.atan2(L.y,L.x));m=(P>90?P-270:P+90)*(1-w)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(n){r.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=_l(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),n===!0?this._updateFrameId=r.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=r.pointGeometry.convert(n),this._update(),this}_onMove(n){const c=this._map;if(!c)return;const m=this._pointerdownPos,x=this._positionDelta;if(m&&x){if(!this._isDragging){const w=this._clickTolerance||c._clickTolerance;if(n.point.dist(m)<w)return;this._isDragging=!0}this._pos=n.point.sub(x),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.Event("dragstart"))),this.fire(new r.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.Event("dragend")),this._state="inactive"}_addDragHandler(n){const c=this._map,m=this._pos;c&&m&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(m),this._pointerdownPos=n.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const c=this._map;return c&&(n?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ga={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},mf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bd(f=new r.pointGeometry(0,0),n="bottom"){if(typeof f=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(n){case"top":return new r.pointGeometry(0,f);case"top-left":return new r.pointGeometry(c,c);case"top-right":return new r.pointGeometry(-c,c);case"bottom":return new r.pointGeometry(0,-f);case"bottom-left":return new r.pointGeometry(c,-c);case"bottom-right":return new r.pointGeometry(-c,-c);case"left":return new r.pointGeometry(f,0);case"right":return new r.pointGeometry(-f,0)}return new r.pointGeometry(0,0)}return f instanceof r.pointGeometry||Array.isArray(f)?r.pointGeometry.convert(f):r.pointGeometry.convert(f[n]||[0,0])}class _f{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=r.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,m){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+m}}const gf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},yf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Fh={showCompass:!0,showZoom:!0,visualizePitch:!1};class wd{constructor(n,c,m=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new md({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,m&&(this.mousePitch=new _d({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),r.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),Ie()}move(n,c){const m=this.map,x=this.mouseRotate.mousemoveWindow(n,c),w=x&&x.bearingDelta;if(w&&m.setBearing(m.getBearing()+w),this.mousePitch){const A=this.mousePitch.mousemoveWindow(n,c),L=A&&A.pitchDelta;L&&m.setPitch(m.getPitch()+L)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ye(),r.window.removeEventListener("mousemove",this.mousemove),r.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(r.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),_e(this.element,n)),r.window.addEventListener("mousemove",this.mousemove),r.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,_e(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ct(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=ct(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const vf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},xf={maxWidth:100,unit:"metric"};function Nh(f,n,c){const m=bc(n),x=m/n,w={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[c];this._map._requestDomTask(()=>{this._container.style.width=f*x+"px",this._container.innerHTML=`${m}&nbsp;${w}`})}function bc(f){const n=Math.pow(10,`${Math.floor(f)}`.length-1);let c=f/n;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:c>=1?1:function(m){const x=Math.pow(10,Math.ceil(-Math.log(m)/Math.LN10));return Math.round(m*x)/x}(c),n*c}const wc={version:r.version,supported:R,setRTLTextPlugin:r.setRTLTextPlugin,getRTLTextPluginStatus:r.getRTLTextPluginStatus,Map:class extends pf{constructor(f){if(r.LivePerformanceUtils.mark(r.PerformanceMarkers.create),(f=r.extend({},yf,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&r.isSafariWithAntialiasingBug(r.window)&&(f.antialias=!1,r.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ni(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._useWebGL2=f.useWebGL2,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new dh,this._domRenderTaskQueue=new dh,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.uniqueId(),this._locale=r.extend({},gf,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new _f(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,typeof f.container=="string"){if(this._container=r.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof r.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&r.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),r.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),r.window!==void 0&&(r.window.addEventListener("online",this._onWindowOnline,!1),r.window.addEventListener("resize",this._onWindowResize,!1),r.window.addEventListener("orientationchange",this._onWindowResize,!1),r.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),r.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new ml(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new nh(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,r.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new vd({customAttribution:f.customAttribution})),this._logoControl=new xd,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new r.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new r.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(f,n){if(n===void 0&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const m=this._controlPositions[n];return n.indexOf("bottom")!==-1?m.insertBefore(c,m.firstChild):m.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new r.Event("movestart",f)).fire(new r.Event("move",f)),this.fire(new r.Event("resize",f)),n&&this.fire(new r.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(r.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?r.window.navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(n=>n==="auto"?r.window.navigator.language:n):f}setLanguage(f){const n=this._parseLanguage(f);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,n=f.projection.name;let c;n==="globe"&&f.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX?(f.setMercatorFromTransition(),c=!0):n==="mercator"&&f.zoom<r.GLOBE_ZOOM_THRESHOLD_MAX&&(f.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,n){return this._updateProjection(f||n||{name:"mercator"})}_updateProjection(f){let n;if(n=f.name==="globe"&&this.transform.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(f){return this.transform.locationPoint3D(r.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(r.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,n,c){if(f==="mouseenter"||f==="mouseover"){let m=!1;const x=A=>{const L=n.filter(B=>this.getLayer(B)),P=L.length?this.queryRenderedFeatures(A.point,{layers:L}):[];P.length?m||(m=!0,c.call(this,new Hs(f,this,A.originalEvent,{features:P}))):m=!1},w=()=>{m=!1};return{layers:new Set(n),listener:c,delegates:{mousemove:x,mouseout:w}}}if(f==="mouseleave"||f==="mouseout"){let m=!1;const x=A=>{const L=n.filter(P=>this.getLayer(P));(L.length?this.queryRenderedFeatures(A.point,{layers:L}):[]).length?m=!0:m&&(m=!1,c.call(this,new Hs(f,this,A.originalEvent)))},w=A=>{m&&(m=!1,c.call(this,new Hs(f,this,A.originalEvent)))};return{layers:new Set(n),listener:c,delegates:{mousemove:x,mouseout:w}}}{const m=x=>{const w=n.filter(L=>this.getLayer(L)),A=w.length?this.queryRenderedFeatures(x.point,{layers:w}):[];A.length&&(x.features=A,c.call(this,x),delete x.features)};return{layers:new Set(n),listener:c,delegates:{[f]:m}}}}on(f,n,c){if(c===void 0)return super.on(f,n);Array.isArray(n)||(n=[n]);const m=this._createDelegatedListener(f,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(const x in m.delegates)this.on(x,m.delegates[x]);return this}once(f,n,c){if(c===void 0)return super.once(f,n);Array.isArray(n)||(n=[n]);const m=this._createDelegatedListener(f,n,c);for(const x in m.delegates)this.once(x,m.delegates[x]);return this}off(f,n,c){if(c===void 0)return super.off(f,n);n=new Set(Array.isArray(n)?n:[n]);const m=(w,A)=>{if(w.size!==A.size)return!1;for(const L of w)if(!A.has(L))return!1;return!0},x=this._delegatedListeners?this._delegatedListeners[f]:void 0;return x&&(w=>{for(let A=0;A<w.length;A++){const L=w[A];if(L.listener===c&&m(L.layers,n)){for(const P in L.delegates)this.off(P,L.delegates[P]);return w.splice(A,1),this}}})(x),this}queryRenderedFeatures(f,n){return this.style?(n!==void 0||f===void 0||f instanceof r.pointGeometry||Array.isArray(f)||(n=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(f,n){return this.style.querySourceFeatures(f,n)}setStyle(f,n){return(n=r.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(n==null)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new xr(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new xr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,n){if(typeof f=="string"){const c=this._requestManager.normalizeStyleURL(f),m=this._requestManager.transformRequest(c,r.ResourceType.Style);r.getJSON(m,(x,w)=>{x?this.fire(new r.ErrorEvent(x)):w&&this._updateDiff(w,n)})}else typeof f=="object"&&this._updateDiff(f,n)}_updateDiff(f,n){try{this.style.setState(f)&&this._update(!0)}catch(c){r.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(f,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.warnOnce("There is no style added to the map."),!1)}addSource(f,n){return this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const n in f){const c=f[n]._tiles;for(const m in c){const x=c[m];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}addSourceType(f,n,c){this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,c)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,n,{pixelRatio:c=1,sdf:m=!1,stretchX:x,stretchY:w,content:A}={}){if(this._lazyInitEmptyStyle(),n instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&n instanceof r.window.ImageBitmap){const{width:L,height:P,data:B}=r.exported.getImageData(n);this.style.addImage(f,{data:new r.RGBAImage({width:L,height:P},B),pixelRatio:c,stretchX:x,stretchY:w,content:A,sdf:m,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:L,height:P}=n,B=n;this.style.addImage(f,{data:new r.RGBAImage({width:L,height:P},new Uint8Array(B.data)),pixelRatio:c,stretchX:x,stretchY:w,content:A,sdf:m,version:0,userImage:B}),B.onAdd&&B.onAdd(this,f)}}updateImage(f,n){const c=this.style.getImage(f);if(!c)return void this.fire(new r.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=n instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&n instanceof r.window.ImageBitmap?r.exported.getImageData(n):n,{width:x,height:w}=m;x!==void 0&&w!==void 0?x===c.data.width&&w===c.data.height?(c.data.replace(m.data,!(n instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&n instanceof r.window.ImageBitmap)),this.style.updateImage(f,c)):this.fire(new r.ErrorEvent(new Error(`The width and height of the updated image (${x}, ${w})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`))):this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new r.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,n){r.getImage(this._requestManager.transformRequest(f,r.ResourceType.Image),(c,m)=>{n(c,m instanceof r.window.HTMLImageElement?r.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(f,n){return this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)}moveLayer(f,n){return this.style.moveLayer(f,n),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,n,c){return this.style.setLayerZoomRange(f,n,c),this._update(!0)}setFilter(f,n,c={}){return this.style.setFilter(f,n,c),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,n,c,m={}){return this.style.setPaintProperty(f,n,c,m),this._update(!0)}getPaintProperty(f,n){return this.style.getPaintProperty(f,n)}setLayoutProperty(f,n,c,m={}){return this.style.setLayoutProperty(f,n,c,m),this._update(!0)}getLayoutProperty(f,n){return this.style.getLayoutProperty(f,n)}setLight(f,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.LngLat.convert(f),this.transform):0}setFeatureState(f,n){return this.style.setFeatureState(f,n),this._update()}removeFeatureState(f,n){return this.style.removeFeatureState(f,n),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,m,x,w=this._container;for(;w&&(!m||!x);){const A=r.window.getComputedStyle(w).transform;A&&A!=="none"&&(c=A.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(m=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(x=c[3])),w=w.parentElement}this._containerWidth=m?Math.abs(f/m):f,this._containerHeight=x?Math.abs(n/x):n}_detectMissingCSS(){r.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=Z("div","mapboxgl-canvas-container",f);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=Z("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=Z("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{m[x]=Z("div",`mapboxgl-ctrl-${x}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const c=r.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);n!==-1&&this._markers.splice(n,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const n=this._popups.indexOf(f);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const f=r.extend({},R.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",f),c=n||this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);c?(this._useWebGL2&&!n&&r.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),r.storeAuthState(c,!0),this.painter=new ma(c,this.transform,!!n),this.on("data",m=>{m.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.exported$1.testSupport(c)):this.fire(new r.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new r.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;const c=this.painter.context.extTimerQuery,m=r.exported.now();if(this.listens("gpu-timing-frame")&&(n=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],r.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],r.window.performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const x=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,P=this.transform.pitch,B=r.exported.now(),F=new r.EvaluationParameters(L,{now:B,fadeDuration:x,pitch:P,transition:this.style.getTransition()});this.style.update(F)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let w=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),w=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):w=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,x,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:x,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const L=r.exported.now()-m;c.endQueryEXT(c.TIME_ELAPSED_EXT,n),setTimeout(()=>{const P=c.getQueryObjectEXT(n,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(n),this.fire(new r.Event("gpu-timing-frame",{cpuTime:L,gpuTime:P})),r.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(L);this.fire(new r.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(L);this.fire(new r.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||w;if(A||this._repaint)this.triggerRepaint();else{const L=!this.isMoving()&&this.loaded();if(L&&(w=this._updateAverageElevation(m,!0)),w)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new r.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new r.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,r.LivePerformanceUtils.mark(r.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&r.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const n of this._markers)f&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!f||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(f,n=!1){const c=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);if((n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const m=this.transform.averageElevation;let x=this.transform.sampleAverageElevation(),w=!1;this.transform.elevation&&(w=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(x)?x=0:this._averageElevationLastSampledAt=f;const A=Math.abs(m-x);if(A>1){if(this._isInitialLoad||w)return this._averageElevation.jumpTo(x),c(x);this._averageElevation.easeTo(x,f,300)}else if(A>1e-4)return this._averageElevation.jumpTo(x),c(x)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){r.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===r.AUTH_ERR_MSG||f.status===401)){const n=this.painter.context.gl;r.storeAuthState(n,!1),this._logoControl instanceof xd&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,m=c.createFramebuffer();function x(w){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,w,0);const A=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,A),A}return c.bindFramebuffer(c.FRAMEBUFFER,m),this._canvasPixelComparison(x(f),n.canvasCopies.map(x),n.timeStamps)}_canvasPixelComparison(f,n,c){let m=c[1]-c[0];const x=f.length/4;for(let w=0;w<n.length;w++){const A=n[w];let L=0;for(let P=0;P<A.length;P+=4)A[P]===f[P]&&A[P+1]===f[P+1]&&A[P+2]===f[P+2]&&A[P+3]===f[P+3]&&(L+=1);m+=(c[w+2]-c[w+1])*(1-L/x)}return m}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),r.window!==void 0&&(r.window.removeEventListener("resize",this._onWindowResize,!1),r.window.removeEventListener("orientationchange",this._onWindowResize,!1),r.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),r.window.removeEventListener("online",this._onWindowOnline,!1),r.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new r.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=r.exported.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(f){const n=this.style?Object.values(this.style._sourceCaches):[];return r.asyncAll(n,(c,m)=>c._preloadTiles(f,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){r.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,n){r.setCacheLimits(f,n)}get version(){return r.version}},NavigationControl:class{constructor(f){this.options=r.extend({},Fh,f),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(r.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),Z("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),Z("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:n}):c.resetNorth({},{originalEvent:n}))}),this._compassIcon=Z("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const n=f.getZoom(),c=n===f.getMaxZoom(),m=n===f.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wd(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,n){const c=Z("button",f,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(f,n){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",c),f.firstElementChild&&f.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends r.Evented{constructor(f){super(),this.options=r.extend({geolocation:r.window.navigator.geolocation},vf,f),r.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=_a(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const n=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,f(c)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):r.window.navigator.permissions!==void 0?r.window.navigator.permissions.query({name:"geolocation"}).then(c=>n(c.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),c=f.coords;return!!n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new r.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("geolocate",f)),this._finish()}}_updateCamera(f){const n=new r.LngLat(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,m=this._map.getBearing(),x=r.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),x,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new r.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,n=r.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,c=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Z("button","mapboxgl-ctrl-geolocate",this._container),Z("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){r.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z("div","mapboxgl-user-location"),this._dotElement.appendChild(Z("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Z("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Bh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Z("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.Event("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{r.window.addEventListener("ondeviceorientationabsolute"in r.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};r.window.DeviceMotionEvent!==void 0&&typeof r.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),r.window.removeEventListener("deviceorientation",this._onDeviceOrientation),r.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:vd,ScaleControl:class{constructor(f){this.options=r.extend({},xf,f),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Nh.bind(this)),r.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,n=this._map,c=n._containerHeight/2,m=n._containerWidth/2-f/2,x=n.unproject([m,c]),w=n.unproject([m+f,c]),A=x.distanceTo(w);if(this.options.unit==="imperial"){const L=3.2808*A;L>5280?this._setScale(f,L/5280,"mile"):this._setScale(f,L,"foot")}else this.options.unit==="nautical"?this._setScale(f,A/1852,"nautical-mile"):A>=1e3?this._setScale(f,A/1e3,"kilometer"):this._setScale(f,A,"meter")}_setScale(f,n,c){const m=bc(n),x=m/n;this._map._requestDomTask(()=>{this._container.style.width=f*x+"px",this._container.innerHTML=c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:c}).format(m):`${m}&nbsp;nm`})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Z("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof r.window.HTMLElement?this._container=f.container:r.warnOnce("Full screen control 'container' must be a DOM element.")),r.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in r.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in r.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,r.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!r.window.document.fullscreenEnabled&&!r.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Z("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),r.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(r.window.document.fullscreenElement||r.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?r.window.document.exitFullscreen?r.window.document.exitFullscreen():r.window.document.webkitCancelFullScreen&&r.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.Evented{constructor(f){super(),this.options=r.extend(Object.create(ga),f),r.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new r.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new r.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=r.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(r.window.document.createTextNode(f))}setHTML(f){const n=r.window.document.createDocumentFragment(),c=r.window.document.createElement("body");let m;for(c.innerHTML=f;m=c.firstChild,m;)n.appendChild(m);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=Z("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(f),this.options.closeButton){const c=this._closeButton=Z("button","mapboxgl-popup-close-button",n);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._updateClassList(),n}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._map,c=this._container,m=this._pos;if(!n||!c||!m)return"bottom";const x=c.offsetWidth,w=c.offsetHeight,A=m.x<x/2,L=m.x>n.transform.width-x/2;if(m.y+f<w)return A?"top-left":L?"top-right":"top";if(m.y>n.transform.height-w){if(A)return"bottom-left";if(L)return"bottom-right"}return A?"left":L?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),f.className=n.join(" ")}_update(f){const n=this._map,c=this._content;if(!n||!this._lngLat&&!this._trackPointer||!c)return;let m=this._container;if(m||(m=this._container=Z("div","mapboxgl-popup",n.getContainer()),this._tip=Z("div","mapboxgl-popup-tip",m),m.appendChild(c)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_l(this._lngLat,this._pos,n.transform)),!this._trackPointer||f){const x=this._pos=this._trackPointer&&f?f:n.project(this._lngLat),w=bd(this.options.offset),A=this._anchor=this._getAnchor(w.y),L=bd(this.options.offset,A),P=x.add(L).round();n._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${wu[A]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&n._showingGlobe()){const x=r.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(mf);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:Bh,Style:xr,LngLat:r.LngLat,LngLatBounds:r.LngLatBounds,Point:r.pointGeometry,MercatorCoordinate:r.MercatorCoordinate,FreeCameraOptions:dl,Evented:r.Evented,config:r.config,prewarm:function(){Le().acquire(Mi)},clearPrewarmedResources:function(){const f=yi;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Mi),yi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return r.config.ACCESS_TOKEN},set accessToken(f){r.config.ACCESS_TOKEN=f},get baseApiUrl(){return r.config.API_URL},set baseApiUrl(f){r.config.API_URL=f},get workerCount(){return gi.workerCount},set workerCount(f){gi.workerCount=f},get maxParallelImageRequests(){return r.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){r.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){r.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:r.exported.setNow,restoreNow:r.exported.restoreNow};return wc});var E=_;return E})})(Bb);const f1=Lv;var Dv={},Fb={get exports(){return Dv},set exports(s){Dv=s}};(function(s,a){(function(o,d){s.exports=d()})(ru,function(){var o=function(C,k){var $={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},xe={on:function(Pe,ze,Ft){if($[Pe]===void 0)throw new Error("Invalid event type: "+Pe);$[Pe].push({selector:ze,fn:Ft})},render:function(Pe){k.store.featureChanged(Pe)}},Oe=function(Pe,ze){for(var Ft=$[Pe],kt=Ft.length;kt--;){var ai=Ft[kt];if(ai.selector(ze)){ai.fn.call(xe,ze)||k.store.render(),k.ui.updateMapClasses();break}}};return C.start.call(xe),{render:C.render,stop:function(){C.stop&&C.stop()},trash:function(){C.trash&&(C.trash(),k.store.render())},combineFeatures:function(){C.combineFeatures&&C.combineFeatures()},uncombineFeatures:function(){C.uncombineFeatures&&C.uncombineFeatures()},drag:function(Pe){Oe("drag",Pe)},click:function(Pe){Oe("click",Pe)},mousemove:function(Pe){Oe("mousemove",Pe)},mousedown:function(Pe){Oe("mousedown",Pe)},mouseup:function(Pe){Oe("mouseup",Pe)},mouseout:function(Pe){Oe("mouseout",Pe)},keydown:function(Pe){Oe("keydown",Pe)},keyup:function(Pe){Oe("keyup",Pe)},touchstart:function(Pe){Oe("touchstart",Pe)},touchmove:function(Pe){Oe("touchmove",Pe)},touchend:function(Pe){Oe("touchend",Pe)},tap:function(Pe){Oe("tap",Pe)}}};function d(C){if(C.__esModule)return C;var k=C.default;if(typeof k=="function"){var $=function xe(){if(this instanceof xe){var Oe=[null];Oe.push.apply(Oe,arguments);var Pe=Function.bind.apply(k,Oe);return new Pe}return k.apply(this,arguments)};$.prototype=k.prototype}else $={};return Object.defineProperty($,"__esModule",{value:!0}),Object.keys(C).forEach(function(xe){var Oe=Object.getOwnPropertyDescriptor(C,xe);Object.defineProperty($,xe,Oe.get?Oe:{enumerable:!0,get:function(){return C[xe]}})}),$}var _={},v={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},E=v;function r(C){var k=0;if(C&&C.length>0){k+=Math.abs(I(C[0]));for(var $=1;$<C.length;$++)k-=Math.abs(I(C[$]))}return k}function I(C){var k,$,xe,Oe,Pe,ze,Ft=0,kt=C.length;if(kt>2){for(ze=0;ze<kt;ze++)ze===kt-2?(xe=kt-2,Oe=kt-1,Pe=0):ze===kt-1?(xe=kt-1,Oe=0,Pe=1):(xe=ze,Oe=ze+1,Pe=ze+2),k=C[xe],$=C[Oe],Ft+=(R(C[Pe][0])-R(k[0]))*Math.sin(R($[1]));Ft=Ft*E.RADIUS*E.RADIUS/2}return Ft}function R(C){return C*Math.PI/180}_.geometry=function C(k){var $,xe=0;switch(k.type){case"Polygon":return r(k.coordinates);case"MultiPolygon":for($=0;$<k.coordinates.length;$++)xe+=r(k.coordinates[$]);return xe;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for($=0;$<k.geometries.length;$++)xe+=C(k.geometries[$]);return xe}},_.ring=I;var U={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},V={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Z={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},Y={POLYGON:"polygon",LINE:"line_string",POINT:"point"},W={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},te={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},ae={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Ie={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},ye={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Ue={ACTIVE:"true",INACTIVE:"false"},je=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],_e=-85,ct=Object.freeze({__proto__:null,classes:U,sources:V,cursors:Z,types:Y,geojsonTypes:W,modes:te,events:ae,updateActions:Ie,meta:ye,activeStates:Ue,interactions:je,LAT_MIN:-90,LAT_RENDERED_MIN:_e,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),lt={Point:0,LineString:1,MultiLineString:1,Polygon:2};function St(C,k){var $=lt[C.geometry.type]-lt[k.geometry.type];return $===0&&C.geometry.type===W.POLYGON?C.area-k.area:$}function Bt(C){return C.map(function(k){return k.geometry.type===W.POLYGON&&(k.area=_.geometry({type:W.FEATURE,property:{},geometry:k.geometry})),k}).sort(St).map(function(k){return delete k.area,k})}function et(C,k){return k===void 0&&(k=0),[[C.point.x-k,C.point.y-k],[C.point.x+k,C.point.y+k]]}function ot(C){if(this._items={},this._nums={},this._length=C?C.length:0,C)for(var k=0,$=C.length;k<$;k++)this.add(C[k]),C[k]!==void 0&&(typeof C[k]=="string"?this._items[C[k]]=k:this._nums[C[k]]=k)}ot.prototype.add=function(C){return this.has(C)||(this._length++,typeof C=="string"?this._items[C]=this._length:this._nums[C]=this._length),this},ot.prototype.delete=function(C){return this.has(C)===!1||(this._length--,delete this._items[C],delete this._nums[C]),this},ot.prototype.has=function(C){return(typeof C=="string"||typeof C=="number")&&(this._items[C]!==void 0||this._nums[C]!==void 0)},ot.prototype.values=function(){var C=this,k=[];return Object.keys(this._items).forEach(function($){k.push({k:$,v:C._items[$]})}),Object.keys(this._nums).forEach(function($){k.push({k:JSON.parse($),v:C._nums[$]})}),k.sort(function($,xe){return $.v-xe.v}).map(function($){return $.k})},ot.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Nt=[ye.FEATURE,ye.MIDPOINT,ye.VERTEX],qt={click:function(C,k,$){return _t(C,k,$,$.options.clickBuffer)},touch:function(C,k,$){return _t(C,k,$,$.options.touchBuffer)}};function _t(C,k,$,xe){if($.map===null)return[];var Oe=C?et(C,xe):k,Pe={};$.options.styles&&(Pe.layers=$.options.styles.map(function(ai){return ai.id}));var ze=$.map.queryRenderedFeatures(Oe,Pe).filter(function(ai){return Nt.indexOf(ai.properties.meta)!==-1}),Ft=new ot,kt=[];return ze.forEach(function(ai){var Zt=ai.properties.id;Ft.has(Zt)||(Ft.add(Zt),kt.push(ai))}),Bt(kt)}function dt(C,k){var $=qt.click(C,null,k),xe={mouse:Z.NONE};return $[0]&&(xe.mouse=$[0].properties.active===Ue.ACTIVE?Z.MOVE:Z.POINTER,xe.feature=$[0].properties.meta),k.events.currentModeName().indexOf("draw")!==-1&&(xe.mouse=Z.ADD),k.ui.queueMapClasses(xe),k.ui.updateMapClasses(),$[0]}function ti(C,k){var $=C.x-k.x,xe=C.y-k.y;return Math.sqrt($*$+xe*xe)}function Vi(C,k,$){$===void 0&&($={});var xe=$.fineTolerance!=null?$.fineTolerance:4,Oe=$.grossTolerance!=null?$.grossTolerance:12,Pe=$.interval!=null?$.interval:500;C.point=C.point||k.point,C.time=C.time||k.time;var ze=ti(C.point,k.point);return ze<xe||ze<Oe&&k.time-C.time<Pe}function Gt(C,k,$){$===void 0&&($={});var xe=$.tolerance!=null?$.tolerance:25,Oe=$.interval!=null?$.interval:250;return C.point=C.point||k.point,C.time=C.time||k.time,ti(C.point,k.point)<xe&&k.time-C.time<Oe}var Yi={},Gi={get exports(){return Yi},set exports(C){Yi=C}}.exports=function(C,k){if(k||(k=16),C===void 0&&(C=128),C<=0)return"0";for(var $=Math.log(Math.pow(2,C))/Math.log(k),xe=2;$===1/0;xe*=2)$=Math.log(Math.pow(2,C/xe))/Math.log(k)*xe;var Oe=$-Math.floor($),Pe="";for(xe=0;xe<Math.floor($);xe++)Pe=Math.floor(Math.random()*k).toString(k)+Pe;if(Oe){var ze=Math.pow(k,Oe);Pe=Math.floor(Math.random()*ze).toString(k)+Pe}var Ft=parseInt(Pe,k);return Ft!==1/0&&Ft>=Math.pow(2,C)?Gi(C,k):Pe};Gi.rack=function(C,k,$){var xe=function(Pe){var ze=0;do{if(ze++>10){if(!$)throw new Error("too many ID collisions, use more bits");C+=$}var Ft=Gi(C,k)}while(Object.hasOwnProperty.call(Oe,Ft));return Oe[Ft]=Pe,Ft},Oe=xe.hats={};return xe.get=function(Pe){return xe.hats[Pe]},xe.set=function(Pe,ze){return xe.hats[Pe]=ze,xe},xe.bits=C||128,xe.base=k||16,xe};var ki=function(C,k){this.ctx=C,this.properties=k.properties||{},this.coordinates=k.geometry.coordinates,this.id=k.id||Yi(),this.type=k.geometry.type};ki.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},ki.prototype.incomingCoords=function(C){this.setCoordinates(C)},ki.prototype.setCoordinates=function(C){this.coordinates=C,this.changed()},ki.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},ki.prototype.setProperty=function(C,k){this.properties[C]=k},ki.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:W.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},ki.prototype.internal=function(C){var k={id:this.id,meta:ye.FEATURE,"meta:type":this.type,active:Ue.INACTIVE,mode:C};if(this.ctx.options.userProperties)for(var $ in this.properties)k["user_"+$]=this.properties[$];return{type:W.FEATURE,properties:k,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Ni=function(C,k){ki.call(this,C,k)};(Ni.prototype=Object.create(ki.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Ni.prototype.updateCoordinate=function(C,k,$){this.coordinates=arguments.length===3?[k,$]:[C,k],this.changed()},Ni.prototype.getCoordinate=function(){return this.getCoordinates()};var Dn=function(C,k){ki.call(this,C,k)};(Dn.prototype=Object.create(ki.prototype)).isValid=function(){return this.coordinates.length>1},Dn.prototype.addCoordinate=function(C,k,$){this.changed();var xe=parseInt(C,10);this.coordinates.splice(xe,0,[k,$])},Dn.prototype.getCoordinate=function(C){var k=parseInt(C,10);return JSON.parse(JSON.stringify(this.coordinates[k]))},Dn.prototype.removeCoordinate=function(C){this.changed(),this.coordinates.splice(parseInt(C,10),1)},Dn.prototype.updateCoordinate=function(C,k,$){var xe=parseInt(C,10);this.coordinates[xe]=[k,$],this.changed()};var bn=function(C,k){ki.call(this,C,k),this.coordinates=this.coordinates.map(function($){return $.slice(0,-1)})};(bn.prototype=Object.create(ki.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(C){return C.length>2})},bn.prototype.incomingCoords=function(C){this.coordinates=C.map(function(k){return k.slice(0,-1)}),this.changed()},bn.prototype.setCoordinates=function(C){this.coordinates=C,this.changed()},bn.prototype.addCoordinate=function(C,k,$){this.changed();var xe=C.split(".").map(function(Oe){return parseInt(Oe,10)});this.coordinates[xe[0]].splice(xe[1],0,[k,$])},bn.prototype.removeCoordinate=function(C){this.changed();var k=C.split(".").map(function(xe){return parseInt(xe,10)}),$=this.coordinates[k[0]];$&&($.splice(k[1],1),$.length<3&&this.coordinates.splice(k[0],1))},bn.prototype.getCoordinate=function(C){var k=C.split(".").map(function(xe){return parseInt(xe,10)}),$=this.coordinates[k[0]];return JSON.parse(JSON.stringify($[k[1]]))},bn.prototype.getCoordinates=function(){return this.coordinates.map(function(C){return C.concat([C[0]])})},bn.prototype.updateCoordinate=function(C,k,$){this.changed();var xe=C.split("."),Oe=parseInt(xe[0],10),Pe=parseInt(xe[1],10);this.coordinates[Oe]===void 0&&(this.coordinates[Oe]=[]),this.coordinates[Oe][Pe]=[k,$]};var ui={MultiPoint:Ni,MultiLineString:Dn,MultiPolygon:bn},Wi=function(C,k,$,xe,Oe){var Pe=$.split("."),ze=parseInt(Pe[0],10),Ft=Pe[1]?Pe.slice(1).join("."):null;return C[ze][k](Ft,xe,Oe)},Ei=function(C,k){if(ki.call(this,C,k),delete this.coordinates,this.model=ui[k.geometry.type],this.model===void 0)throw new TypeError(k.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(k.geometry.coordinates)};function Wt(C){this.map=C.map,this.drawConfig=JSON.parse(JSON.stringify(C.options||{})),this._ctx=C}(Ei.prototype=Object.create(ki.prototype))._coordinatesToFeatures=function(C){var k=this,$=this.model.bind(this);return C.map(function(xe){return new $(k.ctx,{id:Yi(),type:W.FEATURE,properties:{},geometry:{coordinates:xe,type:k.type.replace("Multi","")}})})},Ei.prototype.isValid=function(){return this.features.every(function(C){return C.isValid()})},Ei.prototype.setCoordinates=function(C){this.features=this._coordinatesToFeatures(C),this.changed()},Ei.prototype.getCoordinate=function(C){return Wi(this.features,"getCoordinate",C)},Ei.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(C){return C.type===W.POLYGON?C.getCoordinates():C.coordinates})))},Ei.prototype.updateCoordinate=function(C,k,$){Wi(this.features,"updateCoordinate",C,k,$),this.changed()},Ei.prototype.addCoordinate=function(C,k,$){Wi(this.features,"addCoordinate",C,k,$),this.changed()},Ei.prototype.removeCoordinate=function(C){Wi(this.features,"removeCoordinate",C),this.changed()},Ei.prototype.getFeatures=function(){return this.features},Wt.prototype.setSelected=function(C){return this._ctx.store.setSelected(C)},Wt.prototype.setSelectedCoordinates=function(C){var k=this;this._ctx.store.setSelectedCoordinates(C),C.reduce(function($,xe){return $[xe.feature_id]===void 0&&($[xe.feature_id]=!0,k._ctx.store.get(xe.feature_id).changed()),$},{})},Wt.prototype.getSelected=function(){return this._ctx.store.getSelected()},Wt.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Wt.prototype.isSelected=function(C){return this._ctx.store.isSelected(C)},Wt.prototype.getFeature=function(C){return this._ctx.store.get(C)},Wt.prototype.select=function(C){return this._ctx.store.select(C)},Wt.prototype.deselect=function(C){return this._ctx.store.deselect(C)},Wt.prototype.deleteFeature=function(C,k){return k===void 0&&(k={}),this._ctx.store.delete(C,k)},Wt.prototype.addFeature=function(C){return this._ctx.store.add(C)},Wt.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Wt.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Wt.prototype.setActionableState=function(C){C===void 0&&(C={});var k={trash:C.trash||!1,combineFeatures:C.combineFeatures||!1,uncombineFeatures:C.uncombineFeatures||!1};return this._ctx.events.actionable(k)},Wt.prototype.changeMode=function(C,k,$){return k===void 0&&(k={}),$===void 0&&($={}),this._ctx.events.changeMode(C,k,$)},Wt.prototype.updateUIClasses=function(C){return this._ctx.ui.queueMapClasses(C)},Wt.prototype.activateUIButton=function(C){return this._ctx.ui.setActiveButton(C)},Wt.prototype.featuresAt=function(C,k,$){if($===void 0&&($="click"),$!=="click"&&$!=="touch")throw new Error("invalid buffer type");return qt[$](C,k,this._ctx)},Wt.prototype.newFeature=function(C){var k=C.geometry.type;return k===W.POINT?new Ni(this._ctx,C):k===W.LINE_STRING?new Dn(this._ctx,C):k===W.POLYGON?new bn(this._ctx,C):new Ei(this._ctx,C)},Wt.prototype.isInstanceOf=function(C,k){if(C===W.POINT)return k instanceof Ni;if(C===W.LINE_STRING)return k instanceof Dn;if(C===W.POLYGON)return k instanceof bn;if(C==="MultiFeature")return k instanceof Ei;throw new Error("Unknown feature class: "+C)},Wt.prototype.doRender=function(C){return this._ctx.store.featureChanged(C)},Wt.prototype.onSetup=function(){},Wt.prototype.onDrag=function(){},Wt.prototype.onClick=function(){},Wt.prototype.onMouseMove=function(){},Wt.prototype.onMouseDown=function(){},Wt.prototype.onMouseUp=function(){},Wt.prototype.onMouseOut=function(){},Wt.prototype.onKeyUp=function(){},Wt.prototype.onKeyDown=function(){},Wt.prototype.onTouchStart=function(){},Wt.prototype.onTouchMove=function(){},Wt.prototype.onTouchEnd=function(){},Wt.prototype.onTap=function(){},Wt.prototype.onStop=function(){},Wt.prototype.onTrash=function(){},Wt.prototype.onCombineFeature=function(){},Wt.prototype.onUncombineFeature=function(){},Wt.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Vn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},It=Object.keys(Vn);function wt(C){var k=Object.keys(C);return function($,xe){xe===void 0&&(xe={});var Oe={},Pe=k.reduce(function(ze,Ft){return ze[Ft]=C[Ft],ze},new Wt($));return{start:function(){var ze=this;Oe=Pe.onSetup(xe),It.forEach(function(Ft){var kt,ai=Vn[Ft],Zt=function(){return!1};C[ai]&&(Zt=function(){return!0}),ze.on(Ft,Zt,(kt=ai,function(Qt){return Pe[kt](Oe,Qt)}))})},stop:function(){Pe.onStop(Oe)},trash:function(){Pe.onTrash(Oe)},combineFeatures:function(){Pe.onCombineFeatures(Oe)},uncombineFeatures:function(){Pe.onUncombineFeatures(Oe)},render:function(ze,Ft){Pe.toDisplayFeatures(Oe,ze,Ft)}}}}function Ii(C){return[].concat(C).filter(function(k){return k!==void 0})}function dn(){var C=this;if(!(C.ctx.map&&C.ctx.map.getSource(V.HOT)!==void 0))return kt();var k=C.ctx.events.currentModeName();C.ctx.ui.queueMapClasses({mode:k});var $=[],xe=[];C.isDirty?xe=C.getAllIds():($=C.getChangedIds().filter(function(ai){return C.get(ai)!==void 0}),xe=C.sources.hot.filter(function(ai){return ai.properties.id&&$.indexOf(ai.properties.id)===-1&&C.get(ai.properties.id)!==void 0}).map(function(ai){return ai.properties.id})),C.sources.hot=[];var Oe=C.sources.cold.length;C.sources.cold=C.isDirty?[]:C.sources.cold.filter(function(ai){var Zt=ai.properties.id||ai.properties.parent;return $.indexOf(Zt)===-1});var Pe=Oe!==C.sources.cold.length||xe.length>0;function ze(ai,Zt){var Qt=C.get(ai).internal(k);C.ctx.events.currentModeRender(Qt,function(Hi){C.sources[Zt].push(Hi)})}if($.forEach(function(ai){return ze(ai,"hot")}),xe.forEach(function(ai){return ze(ai,"cold")}),Pe&&C.ctx.map.getSource(V.COLD).setData({type:W.FEATURE_COLLECTION,features:C.sources.cold}),C.ctx.map.getSource(V.HOT).setData({type:W.FEATURE_COLLECTION,features:C.sources.hot}),C._emitSelectionChange&&(C.ctx.map.fire(ae.SELECTION_CHANGE,{features:C.getSelected().map(function(ai){return ai.toGeoJSON()}),points:C.getSelectedCoordinates().map(function(ai){return{type:W.FEATURE,properties:{},geometry:{type:W.POINT,coordinates:ai.coordinates}}})}),C._emitSelectionChange=!1),C._deletedFeaturesToEmit.length){var Ft=C._deletedFeaturesToEmit.map(function(ai){return ai.toGeoJSON()});C._deletedFeaturesToEmit=[],C.ctx.map.fire(ae.DELETE,{features:Ft})}function kt(){C.isDirty=!1,C.clearChangedIds()}kt(),C.ctx.map.fire(ae.RENDER,{})}function $t(C){var k,$=this;this._features={},this._featureIds=new ot,this._selectedFeatureIds=new ot,this._selectedCoordinates=[],this._changedFeatureIds=new ot,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=C,this.sources={hot:[],cold:[]},this.render=function(){k||(k=requestAnimationFrame(function(){k=null,dn.call($)}))},this.isDirty=!1}function gt(C,k){var $=C._selectedCoordinates.filter(function(xe){return C._selectedFeatureIds.has(xe.feature_id)});C._selectedCoordinates.length===$.length||k.silent||(C._emitSelectionChange=!0),C._selectedCoordinates=$}$t.prototype.createRenderBatch=function(){var C=this,k=this.render,$=0;return this.render=function(){$++},function(){C.render=k,$>0&&C.render()}},$t.prototype.setDirty=function(){return this.isDirty=!0,this},$t.prototype.featureChanged=function(C){return this._changedFeatureIds.add(C),this},$t.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},$t.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},$t.prototype.getAllIds=function(){return this._featureIds.values()},$t.prototype.add=function(C){return this.featureChanged(C.id),this._features[C.id]=C,this._featureIds.add(C.id),this},$t.prototype.delete=function(C,k){var $=this;return k===void 0&&(k={}),Ii(C).forEach(function(xe){$._featureIds.has(xe)&&($._featureIds.delete(xe),$._selectedFeatureIds.delete(xe),k.silent||$._deletedFeaturesToEmit.indexOf($._features[xe])===-1&&$._deletedFeaturesToEmit.push($._features[xe]),delete $._features[xe],$.isDirty=!0)}),gt(this,k),this},$t.prototype.get=function(C){return this._features[C]},$t.prototype.getAll=function(){var C=this;return Object.keys(this._features).map(function(k){return C._features[k]})},$t.prototype.select=function(C,k){var $=this;return k===void 0&&(k={}),Ii(C).forEach(function(xe){$._selectedFeatureIds.has(xe)||($._selectedFeatureIds.add(xe),$._changedFeatureIds.add(xe),k.silent||($._emitSelectionChange=!0))}),this},$t.prototype.deselect=function(C,k){var $=this;return k===void 0&&(k={}),Ii(C).forEach(function(xe){$._selectedFeatureIds.has(xe)&&($._selectedFeatureIds.delete(xe),$._changedFeatureIds.add(xe),k.silent||($._emitSelectionChange=!0))}),gt(this,k),this},$t.prototype.clearSelected=function(C){return C===void 0&&(C={}),this.deselect(this._selectedFeatureIds.values(),{silent:C.silent}),this},$t.prototype.setSelected=function(C,k){var $=this;return k===void 0&&(k={}),C=Ii(C),this.deselect(this._selectedFeatureIds.values().filter(function(xe){return C.indexOf(xe)===-1}),{silent:k.silent}),this.select(C.filter(function(xe){return!$._selectedFeatureIds.has(xe)}),{silent:k.silent}),this},$t.prototype.setSelectedCoordinates=function(C){return this._selectedCoordinates=C,this._emitSelectionChange=!0,this},$t.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},$t.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},$t.prototype.getSelected=function(){var C=this;return this._selectedFeatureIds.values().map(function(k){return C.get(k)})},$t.prototype.getSelectedCoordinates=function(){var C=this;return this._selectedCoordinates.map(function(k){return{coordinates:C.get(k.feature_id).getCoordinate(k.coord_path)}})},$t.prototype.isSelected=function(C){return this._selectedFeatureIds.has(C)},$t.prototype.setFeatureProperty=function(C,k,$){this.get(C).setProperty(k,$),this.featureChanged(C)},$t.prototype.storeMapConfig=function(){var C=this;je.forEach(function(k){C.ctx.map[k]&&(C._mapInitialConfig[k]=C.ctx.map[k].isEnabled())})},$t.prototype.restoreMapConfig=function(){var C=this;Object.keys(this._mapInitialConfig).forEach(function(k){C._mapInitialConfig[k]?C.ctx.map[k].enable():C.ctx.map[k].disable()})},$t.prototype.getInitialConfigValue=function(C){return this._mapInitialConfig[C]===void 0||this._mapInitialConfig[C]};var Si=function(){for(var C=arguments,k={},$=0;$<arguments.length;$++){var xe=C[$];for(var Oe in xe)Pi.call(xe,Oe)&&(k[Oe]=xe[Oe])}return k},Pi=Object.prototype.hasOwnProperty,Pr=["mode","feature","mouse"];function Ir(C){var k=null,$=null,xe={onRemove:function(){return C.map.off("load",xe.connect),clearInterval($),xe.removeLayers(),C.store.restoreMapConfig(),C.ui.removeButtons(),C.events.removeEventListeners(),C.ui.clearMapClasses(),C.map=null,C.container=null,C.store=null,k&&k.parentNode&&k.parentNode.removeChild(k),k=null,this},connect:function(){C.map.off("load",xe.connect),clearInterval($),xe.addLayers(),C.store.storeMapConfig(),C.events.addEventListeners()},onAdd:function(Oe){var Pe=Oe.fire;return Oe.fire=function(ze,Ft){var kt=arguments;return Pe.length===1&&arguments.length!==1&&(kt=[Si({},{type:ze},Ft)]),Pe.apply(Oe,kt)},C.map=Oe,C.events=function(ze){var Ft=Object.keys(ze.options.modes).reduce(function(Et,ci){return Et[ci]=wt(ze.options.modes[ci]),Et},{}),kt={},ai={},Zt={},Qt=null,Hi=null;Zt.drag=function(Et,ci){ci({point:Et.point,time:new Date().getTime()})?(ze.ui.queueMapClasses({mouse:Z.DRAG}),Hi.drag(Et)):Et.originalEvent.stopPropagation()},Zt.mousedrag=function(Et){Zt.drag(Et,function(ci){return!Vi(kt,ci)})},Zt.touchdrag=function(Et){Zt.drag(Et,function(ci){return!Gt(ai,ci)})},Zt.mousemove=function(Et){if((Et.originalEvent.buttons!==void 0?Et.originalEvent.buttons:Et.originalEvent.which)===1)return Zt.mousedrag(Et);var ci=dt(Et,ze);Et.featureTarget=ci,Hi.mousemove(Et)},Zt.mousedown=function(Et){kt={time:new Date().getTime(),point:Et.point};var ci=dt(Et,ze);Et.featureTarget=ci,Hi.mousedown(Et)},Zt.mouseup=function(Et){var ci=dt(Et,ze);Et.featureTarget=ci,Vi(kt,{point:Et.point,time:new Date().getTime()})?Hi.click(Et):Hi.mouseup(Et)},Zt.mouseout=function(Et){Hi.mouseout(Et)},Zt.touchstart=function(Et){if(Et.originalEvent.preventDefault(),ze.options.touchEnabled){ai={time:new Date().getTime(),point:Et.point};var ci=qt.touch(Et,null,ze)[0];Et.featureTarget=ci,Hi.touchstart(Et)}},Zt.touchmove=function(Et){if(Et.originalEvent.preventDefault(),ze.options.touchEnabled)return Hi.touchmove(Et),Zt.touchdrag(Et)},Zt.touchend=function(Et){if(Et.originalEvent.preventDefault(),ze.options.touchEnabled){var ci=qt.touch(Et,null,ze)[0];Et.featureTarget=ci,Gt(ai,{time:new Date().getTime(),point:Et.point})?Hi.tap(Et):Hi.touchend(Et)}};var vr=function(Et){return!(Et===8||Et===46||Et>=48&&Et<=57)};function Zi(Et,ci,Qi){Qi===void 0&&(Qi={}),Hi.stop();var Yr=Ft[Et];if(Yr===void 0)throw new Error(Et+" is not valid");Qt=Et;var Br=Yr(ze,ci);Hi=o(Br,ze),Qi.silent||ze.map.fire(ae.MODE_CHANGE,{mode:Et}),ze.store.setDirty(),ze.store.render()}Zt.keydown=function(Et){(Et.srcElement||Et.target).classList[0]==="mapboxgl-canvas"&&(Et.keyCode!==8&&Et.keyCode!==46||!ze.options.controls.trash?vr(Et.keyCode)?Hi.keydown(Et):Et.keyCode===49&&ze.options.controls.point?Zi(te.DRAW_POINT):Et.keyCode===50&&ze.options.controls.line_string?Zi(te.DRAW_LINE_STRING):Et.keyCode===51&&ze.options.controls.polygon&&Zi(te.DRAW_POLYGON):(Et.preventDefault(),Hi.trash()))},Zt.keyup=function(Et){vr(Et.keyCode)&&Hi.keyup(Et)},Zt.zoomend=function(){ze.store.changeZoom()},Zt.data=function(Et){if(Et.dataType==="style"){var ci=ze.setup,Qi=ze.map,Yr=ze.options,Br=ze.store;Yr.styles.some(function(Os){return Qi.getLayer(Os.id)})||(ci.addLayers(),Br.setDirty(),Br.render())}};var Mr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Qt=ze.options.defaultMode,Hi=o(Ft[Qt](ze),ze)},changeMode:Zi,actionable:function(Et){var ci=!1;Object.keys(Et).forEach(function(Qi){if(Mr[Qi]===void 0)throw new Error("Invalid action type");Mr[Qi]!==Et[Qi]&&(ci=!0),Mr[Qi]=Et[Qi]}),ci&&ze.map.fire(ae.ACTIONABLE,{actions:Mr})},currentModeName:function(){return Qt},currentModeRender:function(Et,ci){return Hi.render(Et,ci)},fire:function(Et,ci){Zt[Et]&&Zt[Et](ci)},addEventListeners:function(){ze.map.on("mousemove",Zt.mousemove),ze.map.on("mousedown",Zt.mousedown),ze.map.on("mouseup",Zt.mouseup),ze.map.on("data",Zt.data),ze.map.on("touchmove",Zt.touchmove),ze.map.on("touchstart",Zt.touchstart),ze.map.on("touchend",Zt.touchend),ze.container.addEventListener("mouseout",Zt.mouseout),ze.options.keybindings&&(ze.container.addEventListener("keydown",Zt.keydown),ze.container.addEventListener("keyup",Zt.keyup))},removeEventListeners:function(){ze.map.off("mousemove",Zt.mousemove),ze.map.off("mousedown",Zt.mousedown),ze.map.off("mouseup",Zt.mouseup),ze.map.off("data",Zt.data),ze.map.off("touchmove",Zt.touchmove),ze.map.off("touchstart",Zt.touchstart),ze.map.off("touchend",Zt.touchend),ze.container.removeEventListener("mouseout",Zt.mouseout),ze.options.keybindings&&(ze.container.removeEventListener("keydown",Zt.keydown),ze.container.removeEventListener("keyup",Zt.keyup))},trash:function(Et){Hi.trash(Et)},combineFeatures:function(){Hi.combineFeatures()},uncombineFeatures:function(){Hi.uncombineFeatures()},getMode:function(){return Qt}}}(C),C.ui=function(ze){var Ft={},kt=null,ai={mode:null,feature:null,mouse:null},Zt={mode:null,feature:null,mouse:null};function Qt(Et){Zt=Si(Zt,Et)}function Hi(){var Et,ci;if(ze.container){var Qi=[],Yr=[];Pr.forEach(function(Br){Zt[Br]!==ai[Br]&&(Qi.push(Br+"-"+ai[Br]),Zt[Br]!==null&&Yr.push(Br+"-"+Zt[Br]))}),Qi.length>0&&(Et=ze.container.classList).remove.apply(Et,Qi),Yr.length>0&&(ci=ze.container.classList).add.apply(ci,Yr),ai=Si(ai,Zt)}}function vr(Et,ci){ci===void 0&&(ci={});var Qi=document.createElement("button");return Qi.className=U.CONTROL_BUTTON+" "+ci.className,Qi.setAttribute("title",ci.title),ci.container.appendChild(Qi),Qi.addEventListener("click",function(Yr){if(Yr.preventDefault(),Yr.stopPropagation(),Yr.target===kt)return Zi(),void ci.onDeactivate();Mr(Et),ci.onActivate()},!0),Qi}function Zi(){kt&&(kt.classList.remove(U.ACTIVE_BUTTON),kt=null)}function Mr(Et){Zi();var ci=Ft[Et];ci&&ci&&Et!=="trash"&&(ci.classList.add(U.ACTIVE_BUTTON),kt=ci)}return{setActiveButton:Mr,queueMapClasses:Qt,updateMapClasses:Hi,clearMapClasses:function(){Qt({mode:null,feature:null,mouse:null}),Hi()},addButtons:function(){var Et=ze.options.controls,ci=document.createElement("div");return ci.className=U.CONTROL_GROUP+" "+U.CONTROL_BASE,Et&&(Et[Y.LINE]&&(Ft[Y.LINE]=vr(Y.LINE,{container:ci,className:U.CONTROL_BUTTON_LINE,title:"LineString tool "+(ze.options.keybindings?"(l)":""),onActivate:function(){return ze.events.changeMode(te.DRAW_LINE_STRING)},onDeactivate:function(){return ze.events.trash()}})),Et[Y.POLYGON]&&(Ft[Y.POLYGON]=vr(Y.POLYGON,{container:ci,className:U.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(ze.options.keybindings?"(p)":""),onActivate:function(){return ze.events.changeMode(te.DRAW_POLYGON)},onDeactivate:function(){return ze.events.trash()}})),Et[Y.POINT]&&(Ft[Y.POINT]=vr(Y.POINT,{container:ci,className:U.CONTROL_BUTTON_POINT,title:"Marker tool "+(ze.options.keybindings?"(m)":""),onActivate:function(){return ze.events.changeMode(te.DRAW_POINT)},onDeactivate:function(){return ze.events.trash()}})),Et.trash&&(Ft.trash=vr("trash",{container:ci,className:U.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){ze.events.trash()}})),Et.combine_features&&(Ft.combine_features=vr("combineFeatures",{container:ci,className:U.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){ze.events.combineFeatures()}})),Et.uncombine_features&&(Ft.uncombine_features=vr("uncombineFeatures",{container:ci,className:U.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){ze.events.uncombineFeatures()}}))),ci},removeButtons:function(){Object.keys(Ft).forEach(function(Et){var ci=Ft[Et];ci.parentNode&&ci.parentNode.removeChild(ci),delete Ft[Et]})}}}(C),C.container=Oe.getContainer(),C.store=new $t(C),k=C.ui.addButtons(),C.options.boxSelect&&(Oe.boxZoom.disable(),Oe.dragPan.disable(),Oe.dragPan.enable()),Oe.loaded()?xe.connect():(Oe.on("load",xe.connect),$=setInterval(function(){Oe.loaded()&&xe.connect()},16)),C.events.start(),k},addLayers:function(){C.map.addSource(V.COLD,{data:{type:W.FEATURE_COLLECTION,features:[]},type:"geojson"}),C.map.addSource(V.HOT,{data:{type:W.FEATURE_COLLECTION,features:[]},type:"geojson"}),C.options.styles.forEach(function(Oe){C.map.addLayer(Oe)}),C.store.setDirty(!0),C.store.render()},removeLayers:function(){C.options.styles.forEach(function(Oe){C.map.getLayer(Oe.id)&&C.map.removeLayer(Oe.id)}),C.map.getSource(V.COLD)&&C.map.removeSource(V.COLD),C.map.getSource(V.HOT)&&C.map.removeSource(V.HOT)}};return C.setup=xe,xe}var Ji=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function jn(C){return function(k){var $=k.featureTarget;return!!$&&!!$.properties&&$.properties.meta===C}}function sr(C){return!!C.originalEvent&&!!C.originalEvent.shiftKey&&C.originalEvent.button===0}function Be(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.active===Ue.ACTIVE&&C.featureTarget.properties.meta===ye.FEATURE}function li(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.active===Ue.INACTIVE&&C.featureTarget.properties.meta===ye.FEATURE}function qi(C){return C.featureTarget===void 0}function Ci(C){return!!C.featureTarget&&!!C.featureTarget.properties&&C.featureTarget.properties.meta===ye.FEATURE}function Jt(C){var k=C.featureTarget;return!!k&&!!k.properties&&k.properties.meta===ye.VERTEX}function nn(C){return!!C.originalEvent&&C.originalEvent.shiftKey===!0}function vs(C){return C.keyCode===27}function yt(C){return C.keyCode===13}var fi=Object.freeze({__proto__:null,isOfMetaType:jn,isShiftMousedown:sr,isActiveFeature:Be,isInactiveFeature:li,noTarget:qi,isFeature:Ci,isVertex:Jt,isShiftDown:nn,isEscapeKey:vs,isEnterKey:yt,isTrue:function(){return!0}}),xi=yn;function yn(C,k){this.x=C,this.y=k}function ls(C,k){var $=k.getBoundingClientRect();return new xi(C.clientX-$.left-(k.clientLeft||0),C.clientY-$.top-(k.clientTop||0))}function js(C,k,$,xe){return{type:W.FEATURE,properties:{meta:ye.VERTEX,parent:C,coord_path:$,active:xe?Ue.ACTIVE:Ue.INACTIVE},geometry:{type:W.POINT,coordinates:k}}}function Xo(C,k,$){var xe=k.geometry.coordinates,Oe=$.geometry.coordinates;if(xe[1]>85||xe[1]<_e||Oe[1]>85||Oe[1]<_e)return null;var Pe={lng:(xe[0]+Oe[0])/2,lat:(xe[1]+Oe[1])/2};return{type:W.FEATURE,properties:{meta:ye.MIDPOINT,parent:C,lng:Pe.lng,lat:Pe.lat,coord_path:$.properties.coord_path},geometry:{type:W.POINT,coordinates:[Pe.lng,Pe.lat]}}}function bo(C,k,$){k===void 0&&(k={}),$===void 0&&($=null);var xe,Oe=C.geometry,Pe=Oe.type,ze=Oe.coordinates,Ft=C.properties&&C.properties.id,kt=[];function ai(Qt,Hi){var vr="",Zi=null;Qt.forEach(function(Mr,Et){var ci=Hi!=null?Hi+"."+Et:String(Et),Qi=js(Ft,Mr,ci,Zt(ci));if(k.midpoints&&Zi){var Yr=Xo(Ft,Zi,Qi);Yr&&kt.push(Yr)}Zi=Qi;var Br=JSON.stringify(Mr);vr!==Br&&kt.push(Qi),Et===0&&(vr=Br)})}function Zt(Qt){return!!k.selectedPaths&&k.selectedPaths.indexOf(Qt)!==-1}return Pe===W.POINT?kt.push(js(Ft,ze,$,Zt($))):Pe===W.POLYGON?ze.forEach(function(Qt,Hi){ai(Qt,$!==null?$+"."+Hi:String(Hi))}):Pe===W.LINE_STRING?ai(ze,$):Pe.indexOf(W.MULTI_PREFIX)===0&&(xe=Pe.replace(W.MULTI_PREFIX,""),ze.forEach(function(Qt,Hi){var vr={type:W.FEATURE,properties:C.properties,geometry:{type:xe,coordinates:Qt}};kt=kt.concat(bo(vr,k,Hi))})),kt}yn.prototype={clone:function(){return new yn(this.x,this.y)},add:function(C){return this.clone()._add(C)},sub:function(C){return this.clone()._sub(C)},multByPoint:function(C){return this.clone()._multByPoint(C)},divByPoint:function(C){return this.clone()._divByPoint(C)},mult:function(C){return this.clone()._mult(C)},div:function(C){return this.clone()._div(C)},rotate:function(C){return this.clone()._rotate(C)},rotateAround:function(C,k){return this.clone()._rotateAround(C,k)},matMult:function(C){return this.clone()._matMult(C)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(C){return this.x===C.x&&this.y===C.y},dist:function(C){return Math.sqrt(this.distSqr(C))},distSqr:function(C){var k=C.x-this.x,$=C.y-this.y;return k*k+$*$},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(C){return Math.atan2(this.y-C.y,this.x-C.x)},angleWith:function(C){return this.angleWithSep(C.x,C.y)},angleWithSep:function(C,k){return Math.atan2(this.x*k-this.y*C,this.x*C+this.y*k)},_matMult:function(C){var k=C[0]*this.x+C[1]*this.y,$=C[2]*this.x+C[3]*this.y;return this.x=k,this.y=$,this},_add:function(C){return this.x+=C.x,this.y+=C.y,this},_sub:function(C){return this.x-=C.x,this.y-=C.y,this},_mult:function(C){return this.x*=C,this.y*=C,this},_div:function(C){return this.x/=C,this.y/=C,this},_multByPoint:function(C){return this.x*=C.x,this.y*=C.y,this},_divByPoint:function(C){return this.x/=C.x,this.y/=C.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var C=this.y;return this.y=this.x,this.x=-C,this},_rotate:function(C){var k=Math.cos(C),$=Math.sin(C),xe=k*this.x-$*this.y,Oe=$*this.x+k*this.y;return this.x=xe,this.y=Oe,this},_rotateAround:function(C,k){var $=Math.cos(C),xe=Math.sin(C),Oe=k.x+$*(this.x-k.x)-xe*(this.y-k.y),Pe=k.y+xe*(this.x-k.x)+$*(this.y-k.y);return this.x=Oe,this.y=Pe,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yn.convert=function(C){return C instanceof yn?C:Array.isArray(C)?new yn(C[0],C[1]):C};var cs={enable:function(C){setTimeout(function(){C.map&&C.map.doubleClickZoom&&C._ctx&&C._ctx.store&&C._ctx.store.getInitialConfigValue&&C._ctx.store.getInitialConfigValue("doubleClickZoom")&&C.map.doubleClickZoom.enable()},0)},disable:function(C){setTimeout(function(){C.map&&C.map.doubleClickZoom&&C.map.doubleClickZoom.disable()},0)}},ho={},La={get exports(){return ho},set exports(C){ho=C}},qs=function(C){if(!C||!C.type)return null;var k=ua[C.type];if(!k)return null;if(k==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:C}]};if(k==="feature")return{type:"FeatureCollection",features:[C]};if(k==="featurecollection")return C},ua={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Dl=Object.freeze({__proto__:null,default:function C(k){switch(k&&k.type||null){case"FeatureCollection":return k.features=k.features.reduce(function($,xe){return $.concat(C(xe))},[]),k;case"Feature":return k.geometry?C(k.geometry).map(function($){var xe={type:"Feature",properties:JSON.parse(JSON.stringify(k.properties)),geometry:$};return k.id!==void 0&&(xe.id=k.id),xe}):[k];case"MultiPoint":return k.coordinates.map(function($){return{type:"Point",coordinates:$}});case"MultiPolygon":return k.coordinates.map(function($){return{type:"Polygon",coordinates:$}});case"MultiLineString":return k.coordinates.map(function($){return{type:"LineString",coordinates:$}});case"GeometryCollection":return k.geometries.map(C).reduce(function($,xe){return $.concat(xe)},[]);case"Point":case"Polygon":case"LineString":return[k]}}}),Da=qs,Ko=d(Dl),Pa=function(C){return function k($){return Array.isArray($)&&$.length&&typeof $[0]=="number"?[$]:$.reduce(function(xe,Oe){return Array.isArray(Oe)&&Array.isArray(Oe[0])?xe.concat(k(Oe)):(xe.push(Oe),xe)},[])}(C)};Ko instanceof Function||(Ko=Ko.default);var xs={},ha={get exports(){return xs},set exports(C){xs=C}}.exports=function(C){return new Ps(C)};function Ps(C){this.value=C}function da(C,k,$){var xe=[],Oe=[],Pe=!0;return function ze(Ft){var kt=$?he(Ft):Ft,ai={},Zt=!0,Qt={node:kt,node_:Ft,path:[].concat(xe),parent:Oe[Oe.length-1],parents:Oe,key:xe.slice(-1)[0],isRoot:xe.length===0,level:xe.length,circular:null,update:function(Zi,Mr){Qt.isRoot||(Qt.parent.node[Qt.key]=Zi),Qt.node=Zi,Mr&&(Zt=!1)},delete:function(Zi){delete Qt.parent.node[Qt.key],Zi&&(Zt=!1)},remove:function(Zi){ue(Qt.parent.node)?Qt.parent.node.splice(Qt.key,1):delete Qt.parent.node[Qt.key],Zi&&(Zt=!1)},keys:null,before:function(Zi){ai.before=Zi},after:function(Zi){ai.after=Zi},pre:function(Zi){ai.pre=Zi},post:function(Zi){ai.post=Zi},stop:function(){Pe=!1},block:function(){Zt=!1}};if(!Pe)return Qt;function Hi(){if(typeof Qt.node=="object"&&Qt.node!==null){Qt.keys&&Qt.node_===Qt.node||(Qt.keys=q(Qt.node)),Qt.isLeaf=Qt.keys.length==0;for(var Zi=0;Zi<Oe.length;Zi++)if(Oe[Zi].node_===Ft){Qt.circular=Oe[Zi];break}}else Qt.isLeaf=!0,Qt.keys=null;Qt.notLeaf=!Qt.isLeaf,Qt.notRoot=!Qt.isRoot}Hi();var vr=k.call(Qt,Qt.node);return vr!==void 0&&Qt.update&&Qt.update(vr),ai.before&&ai.before.call(Qt,Qt.node),Zt&&(typeof Qt.node!="object"||Qt.node===null||Qt.circular||(Oe.push(Qt),Hi(),ve(Qt.keys,function(Zi,Mr){xe.push(Zi),ai.pre&&ai.pre.call(Qt,Qt.node[Zi],Zi);var Et=ze(Qt.node[Zi]);$&&Ce.call(Qt.node,Zi)&&(Qt.node[Zi]=Et.node),Et.isLast=Mr==Qt.keys.length-1,Et.isFirst=Mr==0,ai.post&&ai.post.call(Qt,Et),xe.pop()}),Oe.pop()),ai.after&&ai.after.call(Qt,Qt.node)),Qt}(C).node}function he(C){if(typeof C=="object"&&C!==null){var k;if(ue(C))k=[];else if(K(C)==="[object Date]")k=new Date(C.getTime?C.getTime():C);else if(function(Oe){return K(Oe)==="[object RegExp]"}(C))k=new RegExp(C);else if(function(Oe){return K(Oe)==="[object Error]"}(C))k={message:C.message};else if(function(Oe){return K(Oe)==="[object Boolean]"}(C))k=new Boolean(C);else if(function(Oe){return K(Oe)==="[object Number]"}(C))k=new Number(C);else if(function(Oe){return K(Oe)==="[object String]"}(C))k=new String(C);else if(Object.create&&Object.getPrototypeOf)k=Object.create(Object.getPrototypeOf(C));else if(C.constructor===Object)k={};else{var $=C.constructor&&C.constructor.prototype||C.__proto__||{},xe=function(){};xe.prototype=$,k=new xe}return ve(q(C),function(Oe){k[Oe]=C[Oe]}),k}return C}Ps.prototype.get=function(C){for(var k=this.value,$=0;$<C.length;$++){var xe=C[$];if(!k||!Ce.call(k,xe)){k=void 0;break}k=k[xe]}return k},Ps.prototype.has=function(C){for(var k=this.value,$=0;$<C.length;$++){var xe=C[$];if(!k||!Ce.call(k,xe))return!1;k=k[xe]}return!0},Ps.prototype.set=function(C,k){for(var $=this.value,xe=0;xe<C.length-1;xe++){var Oe=C[xe];Ce.call($,Oe)||($[Oe]={}),$=$[Oe]}return $[C[xe]]=k,k},Ps.prototype.map=function(C){return da(this.value,C,!0)},Ps.prototype.forEach=function(C){return this.value=da(this.value,C,!1),this.value},Ps.prototype.reduce=function(C,k){var $=arguments.length===1,xe=$?this.value:k;return this.forEach(function(Oe){this.isRoot&&$||(xe=C.call(this,xe,Oe))}),xe},Ps.prototype.paths=function(){var C=[];return this.forEach(function(k){C.push(this.path)}),C},Ps.prototype.nodes=function(){var C=[];return this.forEach(function(k){C.push(this.node)}),C},Ps.prototype.clone=function(){var C=[],k=[];return function $(xe){for(var Oe=0;Oe<C.length;Oe++)if(C[Oe]===xe)return k[Oe];if(typeof xe=="object"&&xe!==null){var Pe=he(xe);return C.push(xe),k.push(Pe),ve(q(xe),function(ze){Pe[ze]=$(xe[ze])}),C.pop(),k.pop(),Pe}return xe}(this.value)};var q=Object.keys||function(C){var k=[];for(var $ in C)k.push($);return k};function K(C){return Object.prototype.toString.call(C)}var ue=Array.isArray||function(C){return Object.prototype.toString.call(C)==="[object Array]"},ve=function(C,k){if(C.forEach)return C.forEach(k);for(var $=0;$<C.length;$++)k(C[$],$,C)};ve(q(Ps.prototype),function(C){ha[C]=function(k){var $=[].slice.call(arguments,1),xe=new Ps(k);return xe[C].apply(xe,$)}});var Ce=Object.hasOwnProperty||function(C,k){return k in C},qe=Fe;function Fe(C){if(!(this instanceof Fe))return new Fe(C);this._bbox=C||[1/0,1/0,-1/0,-1/0],this._valid=!!C}Fe.prototype.include=function(C){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],C[0]),this._bbox[1]=Math.min(this._bbox[1],C[1]),this._bbox[2]=Math.max(this._bbox[2],C[0]),this._bbox[3]=Math.max(this._bbox[3],C[1]),this},Fe.prototype.equals=function(C){var k;return k=C instanceof Fe?C.bbox():C,this._bbox[0]==k[0]&&this._bbox[1]==k[1]&&this._bbox[2]==k[2]&&this._bbox[3]==k[3]},Fe.prototype.center=function(C){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Fe.prototype.union=function(C){var k;return this._valid=!0,k=C instanceof Fe?C.bbox():C,this._bbox[0]=Math.min(this._bbox[0],k[0]),this._bbox[1]=Math.min(this._bbox[1],k[1]),this._bbox[2]=Math.max(this._bbox[2],k[2]),this._bbox[3]=Math.max(this._bbox[3],k[3]),this},Fe.prototype.bbox=function(){return this._valid?this._bbox:null},Fe.prototype.contains=function(C){if(!C)return this._fastContains();if(!this._valid)return null;var k=C[0],$=C[1];return this._bbox[0]<=k&&this._bbox[1]<=$&&this._bbox[2]>=k&&this._bbox[3]>=$},Fe.prototype.intersect=function(C){return this._valid?(k=C instanceof Fe?C.bbox():C,!(this._bbox[0]>k[2]||this._bbox[2]<k[0]||this._bbox[3]<k[1]||this._bbox[1]>k[3])):null;var k},Fe.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var C="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",C)},Fe.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Re=function(C){if(!C)return[];var k=Ko(Da(C)),$=[];return k.features.forEach(function(xe){xe.geometry&&($=$.concat(Pa(xe.geometry.coordinates)))}),$},Ke=xs,vt=qe,Xt={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Dt=Object.keys(Xt);function Mi(C){for(var k=vt(),$=Re(C),xe=0;xe<$.length;xe++)k.include($[xe]);return k}La.exports=function(C){return Mi(C).bbox()},ho.polygon=function(C){return Mi(C).polygon()},ho.bboxify=function(C){return Ke(C).map(function(k){k&&Dt.some(function($){return!!k[$]&&Xt[$].indexOf(k.type)!==-1})&&(k.bbox=Mi(k).bbox(),this.update(k))})};var gi=-90;function yi(C,k){var $=gi,xe=90,Oe=gi,Pe=90,ze=270,Ft=-270;C.forEach(function(ai){var Zt=ho(ai),Qt=Zt[1],Hi=Zt[3],vr=Zt[0],Zi=Zt[2];Qt>$&&($=Qt),Hi<xe&&(xe=Hi),Hi>Oe&&(Oe=Hi),Qt<Pe&&(Pe=Qt),vr<ze&&(ze=vr),Zi>Ft&&(Ft=Zi)});var kt=k;return $+kt.lat>85&&(kt.lat=85-$),Oe+kt.lat>90&&(kt.lat=90-Oe),xe+kt.lat<-85&&(kt.lat=-85-xe),Pe+kt.lat<gi&&(kt.lat=gi-Pe),ze+kt.lng<=-270&&(kt.lng+=360*Math.ceil(Math.abs(kt.lng)/360)),Ft+kt.lng>=270&&(kt.lng-=360*Math.ceil(Math.abs(kt.lng)/360)),kt}function Le(C,k){var $=yi(C.map(function(xe){return xe.toGeoJSON()}),k);C.forEach(function(xe){var Oe,Pe=xe.getCoordinates(),ze=function(kt){var ai={lng:kt[0]+$.lng,lat:kt[1]+$.lat};return[ai.lng,ai.lat]},Ft=function(kt){return kt.map(function(ai){return ze(ai)})};xe.type===W.POINT?Oe=ze(Pe):xe.type===W.LINE_STRING||xe.type===W.MULTI_POINT?Oe=Pe.map(ze):xe.type===W.POLYGON||xe.type===W.MULTI_LINE_STRING?Oe=Pe.map(Ft):xe.type===W.MULTI_POLYGON&&(Oe=Pe.map(function(kt){return kt.map(function(ai){return Ft(ai)})})),xe.incomingCoords(Oe)})}var hi={onSetup:function(C){var k=this,$={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:C.featureIds||[]};return this.setSelected($.initiallySelectedFeatureIds.filter(function(xe){return k.getFeature(xe)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),$},fireUpdate:function(){this.map.fire(ae.UPDATE,{action:Ie.MOVE,features:this.getSelected().map(function(C){return C.toGeoJSON()})})},fireActionable:function(){var C=this,k=this.getSelected(),$=k.filter(function(Ft){return C.isInstanceOf("MultiFeature",Ft)}),xe=!1;if(k.length>1){xe=!0;var Oe=k[0].type.replace("Multi","");k.forEach(function(Ft){Ft.type.replace("Multi","")!==Oe&&(xe=!1)})}var Pe=$.length>0,ze=k.length>0;this.setActionableState({combineFeatures:xe,uncombineFeatures:Pe,trash:ze})},getUniqueIds:function(C){return C.length?C.map(function(k){return k.properties.id}).filter(function(k){return k!==void 0}).reduce(function(k,$){return k.add($),k},new ot).values():[]},stopExtendedInteractions:function(C){C.boxSelectElement&&(C.boxSelectElement.parentNode&&C.boxSelectElement.parentNode.removeChild(C.boxSelectElement),C.boxSelectElement=null),this.map.dragPan.enable(),C.boxSelecting=!1,C.canBoxSelect=!1,C.dragMoving=!1,C.canDragMove=!1},onStop:function(){cs.enable(this)},onMouseMove:function(C){return this.stopExtendedInteractions(C),!0},onMouseOut:function(C){return!C.dragMoving||this.fireUpdate()}};hi.onTap=hi.onClick=function(C,k){return qi(k)?this.clickAnywhere(C,k):jn(ye.VERTEX)(k)?this.clickOnVertex(C,k):Ci(k)?this.clickOnFeature(C,k):void 0},hi.clickAnywhere=function(C){var k=this,$=this.getSelectedIds();$.length&&(this.clearSelectedFeatures(),$.forEach(function(xe){return k.doRender(xe)})),cs.enable(this),this.stopExtendedInteractions(C)},hi.clickOnVertex=function(C,k){this.changeMode(te.DIRECT_SELECT,{featureId:k.featureTarget.properties.parent,coordPath:k.featureTarget.properties.coord_path,startPos:k.lngLat}),this.updateUIClasses({mouse:Z.MOVE})},hi.startOnActiveFeature=function(C,k){this.stopExtendedInteractions(C),this.map.dragPan.disable(),this.doRender(k.featureTarget.properties.id),C.canDragMove=!0,C.dragMoveLocation=k.lngLat},hi.clickOnFeature=function(C,k){var $=this;cs.disable(this),this.stopExtendedInteractions(C);var xe=nn(k),Oe=this.getSelectedIds(),Pe=k.featureTarget.properties.id,ze=this.isSelected(Pe);if(!xe&&ze&&this.getFeature(Pe).type!==W.POINT)return this.changeMode(te.DIRECT_SELECT,{featureId:Pe});ze&&xe?(this.deselect(Pe),this.updateUIClasses({mouse:Z.POINTER}),Oe.length===1&&cs.enable(this)):!ze&&xe?(this.select(Pe),this.updateUIClasses({mouse:Z.MOVE})):ze||xe||(Oe.forEach(function(Ft){return $.doRender(Ft)}),this.setSelected(Pe),this.updateUIClasses({mouse:Z.MOVE})),this.doRender(Pe)},hi.onMouseDown=function(C,k){return Be(k)?this.startOnActiveFeature(C,k):this.drawConfig.boxSelect&&sr(k)?this.startBoxSelect(C,k):void 0},hi.startBoxSelect=function(C,k){this.stopExtendedInteractions(C),this.map.dragPan.disable(),C.boxSelectStartLocation=ls(k.originalEvent,this.map.getContainer()),C.canBoxSelect=!0},hi.onTouchStart=function(C,k){if(Be(k))return this.startOnActiveFeature(C,k)},hi.onDrag=function(C,k){return C.canDragMove?this.dragMove(C,k):this.drawConfig.boxSelect&&C.canBoxSelect?this.whileBoxSelect(C,k):void 0},hi.whileBoxSelect=function(C,k){C.boxSelecting=!0,this.updateUIClasses({mouse:Z.ADD}),C.boxSelectElement||(C.boxSelectElement=document.createElement("div"),C.boxSelectElement.classList.add(U.BOX_SELECT),this.map.getContainer().appendChild(C.boxSelectElement));var $=ls(k.originalEvent,this.map.getContainer()),xe=Math.min(C.boxSelectStartLocation.x,$.x),Oe=Math.max(C.boxSelectStartLocation.x,$.x),Pe=Math.min(C.boxSelectStartLocation.y,$.y),ze=Math.max(C.boxSelectStartLocation.y,$.y),Ft="translate("+xe+"px, "+Pe+"px)";C.boxSelectElement.style.transform=Ft,C.boxSelectElement.style.WebkitTransform=Ft,C.boxSelectElement.style.width=Oe-xe+"px",C.boxSelectElement.style.height=ze-Pe+"px"},hi.dragMove=function(C,k){C.dragMoving=!0,k.originalEvent.stopPropagation();var $={lng:k.lngLat.lng-C.dragMoveLocation.lng,lat:k.lngLat.lat-C.dragMoveLocation.lat};Le(this.getSelected(),$),C.dragMoveLocation=k.lngLat},hi.onTouchEnd=hi.onMouseUp=function(C,k){var $=this;if(C.dragMoving)this.fireUpdate();else if(C.boxSelecting){var xe=[C.boxSelectStartLocation,ls(k.originalEvent,this.map.getContainer())],Oe=this.featuresAt(null,xe,"click"),Pe=this.getUniqueIds(Oe).filter(function(ze){return!$.isSelected(ze)});Pe.length&&(this.select(Pe),Pe.forEach(function(ze){return $.doRender(ze)}),this.updateUIClasses({mouse:Z.MOVE}))}this.stopExtendedInteractions(C)},hi.toDisplayFeatures=function(C,k,$){k.properties.active=this.isSelected(k.properties.id)?Ue.ACTIVE:Ue.INACTIVE,$(k),this.fireActionable(),k.properties.active===Ue.ACTIVE&&k.geometry.type!==W.POINT&&bo(k).forEach($)},hi.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},hi.onCombineFeatures=function(){var C=this.getSelected();if(!(C.length===0||C.length<2)){for(var k=[],$=[],xe=C[0].type.replace("Multi",""),Oe=0;Oe<C.length;Oe++){var Pe=C[Oe];if(Pe.type.replace("Multi","")!==xe)return;Pe.type.includes("Multi")?Pe.getCoordinates().forEach(function(Ft){k.push(Ft)}):k.push(Pe.getCoordinates()),$.push(Pe.toGeoJSON())}if($.length>1){var ze=this.newFeature({type:W.FEATURE,properties:$[0].properties,geometry:{type:"Multi"+xe,coordinates:k}});this.addFeature(ze),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([ze.id]),this.map.fire(ae.COMBINE_FEATURES,{createdFeatures:[ze.toGeoJSON()],deletedFeatures:$})}this.fireActionable()}},hi.onUncombineFeatures=function(){var C=this,k=this.getSelected();if(k.length!==0){for(var $=[],xe=[],Oe=function(ze){var Ft=k[ze];C.isInstanceOf("MultiFeature",Ft)&&(Ft.getFeatures().forEach(function(kt){C.addFeature(kt),kt.properties=Ft.properties,$.push(kt.toGeoJSON()),C.select([kt.id])}),C.deleteFeature(Ft.id,{silent:!0}),xe.push(Ft.toGeoJSON()))},Pe=0;Pe<k.length;Pe++)Oe(Pe);$.length>1&&this.map.fire(ae.UNCOMBINE_FEATURES,{createdFeatures:$,deletedFeatures:xe}),this.fireActionable()}};var Pn=jn(ye.VERTEX),Oi=jn(ye.MIDPOINT),wn={fireUpdate:function(){this.map.fire(ae.UPDATE,{action:Ie.CHANGE_COORDINATES,features:this.getSelected().map(function(C){return C.toGeoJSON()})})},fireActionable:function(C){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:C.selectedCoordPaths.length>0})},startDragging:function(C,k){this.map.dragPan.disable(),C.canDragMove=!0,C.dragMoveLocation=k.lngLat},stopDragging:function(C){this.map.dragPan.enable(),C.dragMoving=!1,C.canDragMove=!1,C.dragMoveLocation=null},onVertex:function(C,k){this.startDragging(C,k);var $=k.featureTarget.properties,xe=C.selectedCoordPaths.indexOf($.coord_path);nn(k)||xe!==-1?nn(k)&&xe===-1&&C.selectedCoordPaths.push($.coord_path):C.selectedCoordPaths=[$.coord_path];var Oe=this.pathsToCoordinates(C.featureId,C.selectedCoordPaths);this.setSelectedCoordinates(Oe)},onMidpoint:function(C,k){this.startDragging(C,k);var $=k.featureTarget.properties;C.feature.addCoordinate($.coord_path,$.lng,$.lat),this.fireUpdate(),C.selectedCoordPaths=[$.coord_path]},pathsToCoordinates:function(C,k){return k.map(function($){return{feature_id:C,coord_path:$}})},onFeature:function(C,k){C.selectedCoordPaths.length===0?this.startDragging(C,k):this.stopDragging(C)},dragFeature:function(C,k,$){Le(this.getSelected(),$),C.dragMoveLocation=k.lngLat},dragVertex:function(C,k,$){for(var xe=C.selectedCoordPaths.map(function(Ft){return C.feature.getCoordinate(Ft)}),Oe=yi(xe.map(function(Ft){return{type:W.FEATURE,properties:{},geometry:{type:W.POINT,coordinates:Ft}}}),$),Pe=0;Pe<xe.length;Pe++){var ze=xe[Pe];C.feature.updateCoordinate(C.selectedCoordPaths[Pe],ze[0]+Oe.lng,ze[1]+Oe.lat)}},clickNoTarget:function(){this.changeMode(te.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(te.SIMPLE_SELECT)},clickActiveFeature:function(C){C.selectedCoordPaths=[],this.clearSelectedCoordinates(),C.feature.changed()},onSetup:function(C){var k=C.featureId,$=this.getFeature(k);if(!$)throw new Error("You must provide a featureId to enter direct_select mode");if($.type===W.POINT)throw new TypeError("direct_select mode doesn't handle point features");var xe={featureId:k,feature:$,dragMoveLocation:C.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:C.coordPath?[C.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(k,xe.selectedCoordPaths)),this.setSelected(k),cs.disable(this),this.setActionableState({trash:!0}),xe},onStop:function(){cs.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(C,k,$){C.featureId===k.properties.id?(k.properties.active=Ue.ACTIVE,$(k),bo(k,{map:this.map,midpoints:!0,selectedPaths:C.selectedCoordPaths}).forEach($)):(k.properties.active=Ue.INACTIVE,$(k)),this.fireActionable(C)},onTrash:function(C){C.selectedCoordPaths.sort(function(k,$){return $.localeCompare(k,"en",{numeric:!0})}).forEach(function(k){return C.feature.removeCoordinate(k)}),this.fireUpdate(),C.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(C),C.feature.isValid()===!1&&(this.deleteFeature([C.featureId]),this.changeMode(te.SIMPLE_SELECT,{}))},onMouseMove:function(C,k){var $=Be(k),xe=Pn(k),Oe=C.selectedCoordPaths.length===0;return $&&Oe||xe&&!Oe?this.updateUIClasses({mouse:Z.MOVE}):this.updateUIClasses({mouse:Z.NONE}),this.stopDragging(C),!0},onMouseOut:function(C){return C.dragMoving&&this.fireUpdate(),!0}};wn.onTouchStart=wn.onMouseDown=function(C,k){return Pn(k)?this.onVertex(C,k):Be(k)?this.onFeature(C,k):Oi(k)?this.onMidpoint(C,k):void 0},wn.onDrag=function(C,k){if(C.canDragMove===!0){C.dragMoving=!0,k.originalEvent.stopPropagation();var $={lng:k.lngLat.lng-C.dragMoveLocation.lng,lat:k.lngLat.lat-C.dragMoveLocation.lat};C.selectedCoordPaths.length>0?this.dragVertex(C,k,$):this.dragFeature(C,k,$),C.dragMoveLocation=k.lngLat}},wn.onClick=function(C,k){return qi(k)?this.clickNoTarget(C,k):Be(k)?this.clickActiveFeature(C,k):li(k)?this.clickInactive(C,k):void this.stopDragging(C)},wn.onTap=function(C,k){return qi(k)?this.clickNoTarget(C,k):Be(k)?this.clickActiveFeature(C,k):li(k)?this.clickInactive(C,k):void 0},wn.onTouchEnd=wn.onMouseUp=function(C){C.dragMoving&&this.fireUpdate(),this.stopDragging(C)};var In={};function Yo(C,k){return!!C.lngLat&&C.lngLat.lng===k[0]&&C.lngLat.lat===k[1]}In.onSetup=function(){var C=this.newFeature({type:W.FEATURE,properties:{},geometry:{type:W.POINT,coordinates:[]}});return this.addFeature(C),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(Y.POINT),this.setActionableState({trash:!0}),{point:C}},In.stopDrawingAndRemove=function(C){this.deleteFeature([C.point.id],{silent:!0}),this.changeMode(te.SIMPLE_SELECT)},In.onTap=In.onClick=function(C,k){this.updateUIClasses({mouse:Z.MOVE}),C.point.updateCoordinate("",k.lngLat.lng,k.lngLat.lat),this.map.fire(ae.CREATE,{features:[C.point.toGeoJSON()]}),this.changeMode(te.SIMPLE_SELECT,{featureIds:[C.point.id]})},In.onStop=function(C){this.activateUIButton(),C.point.getCoordinate().length||this.deleteFeature([C.point.id],{silent:!0})},In.toDisplayFeatures=function(C,k,$){var xe=k.properties.id===C.point.id;if(k.properties.active=xe?Ue.ACTIVE:Ue.INACTIVE,!xe)return $(k)},In.onTrash=In.stopDrawingAndRemove,In.onKeyUp=function(C,k){if(vs(k)||yt(k))return this.stopDrawingAndRemove(C,k)};var Ys={onSetup:function(){var C=this.newFeature({type:W.FEATURE,properties:{},geometry:{type:W.POLYGON,coordinates:[[]]}});return this.addFeature(C),this.clearSelectedFeatures(),cs.disable(this),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(Y.POLYGON),this.setActionableState({trash:!0}),{polygon:C,currentVertexPosition:0}},clickAnywhere:function(C,k){if(C.currentVertexPosition>0&&Yo(k,C.polygon.coordinates[0][C.currentVertexPosition-1]))return this.changeMode(te.SIMPLE_SELECT,{featureIds:[C.polygon.id]});this.updateUIClasses({mouse:Z.ADD}),C.polygon.updateCoordinate("0."+C.currentVertexPosition,k.lngLat.lng,k.lngLat.lat),C.currentVertexPosition++,C.polygon.updateCoordinate("0."+C.currentVertexPosition,k.lngLat.lng,k.lngLat.lat)},clickOnVertex:function(C){return this.changeMode(te.SIMPLE_SELECT,{featureIds:[C.polygon.id]})},onMouseMove:function(C,k){C.polygon.updateCoordinate("0."+C.currentVertexPosition,k.lngLat.lng,k.lngLat.lat),Jt(k)&&this.updateUIClasses({mouse:Z.POINTER})}};Ys.onTap=Ys.onClick=function(C,k){return Jt(k)?this.clickOnVertex(C,k):this.clickAnywhere(C,k)},Ys.onKeyUp=function(C,k){vs(k)?(this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(te.SIMPLE_SELECT)):yt(k)&&this.changeMode(te.SIMPLE_SELECT,{featureIds:[C.polygon.id]})},Ys.onStop=function(C){this.updateUIClasses({mouse:Z.NONE}),cs.enable(this),this.activateUIButton(),this.getFeature(C.polygon.id)!==void 0&&(C.polygon.removeCoordinate("0."+C.currentVertexPosition),C.polygon.isValid()?this.map.fire(ae.CREATE,{features:[C.polygon.toGeoJSON()]}):(this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(te.SIMPLE_SELECT,{},{silent:!0})))},Ys.toDisplayFeatures=function(C,k,$){var xe=k.properties.id===C.polygon.id;if(k.properties.active=xe?Ue.ACTIVE:Ue.INACTIVE,!xe)return $(k);if(k.geometry.coordinates.length!==0){var Oe=k.geometry.coordinates[0].length;if(!(Oe<3)){if(k.properties.meta=ye.FEATURE,$(js(C.polygon.id,k.geometry.coordinates[0][0],"0.0",!1)),Oe>3){var Pe=k.geometry.coordinates[0].length-3;$(js(C.polygon.id,k.geometry.coordinates[0][Pe],"0."+Pe,!1))}if(Oe<=4){var ze=[[k.geometry.coordinates[0][0][0],k.geometry.coordinates[0][0][1]],[k.geometry.coordinates[0][1][0],k.geometry.coordinates[0][1][1]]];if($({type:W.FEATURE,properties:k.properties,geometry:{coordinates:ze,type:W.LINE_STRING}}),Oe===3)return}return $(k)}}},Ys.onTrash=function(C){this.deleteFeature([C.polygon.id],{silent:!0}),this.changeMode(te.SIMPLE_SELECT)};var st={onSetup:function(C){var k,$,xe=(C=C||{}).featureId,Oe="forward";if(xe){if(!(k=this.getFeature(xe)))throw new Error("Could not find a feature with the provided featureId");var Pe=C.from;if(Pe&&Pe.type==="Feature"&&Pe.geometry&&Pe.geometry.type==="Point"&&(Pe=Pe.geometry),Pe&&Pe.type==="Point"&&Pe.coordinates&&Pe.coordinates.length===2&&(Pe=Pe.coordinates),!Pe||!Array.isArray(Pe))throw new Error("Please use the `from` property to indicate which point to continue the line from");var ze=k.coordinates.length-1;if(k.coordinates[ze][0]===Pe[0]&&k.coordinates[ze][1]===Pe[1])$=ze+1,k.addCoordinate.apply(k,[$].concat(k.coordinates[ze]));else{if(k.coordinates[0][0]!==Pe[0]||k.coordinates[0][1]!==Pe[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");Oe="backwards",$=0,k.addCoordinate.apply(k,[$].concat(k.coordinates[0]))}}else k=this.newFeature({type:W.FEATURE,properties:{},geometry:{type:W.LINE_STRING,coordinates:[]}}),$=0,this.addFeature(k);return this.clearSelectedFeatures(),cs.disable(this),this.updateUIClasses({mouse:Z.ADD}),this.activateUIButton(Y.LINE),this.setActionableState({trash:!0}),{line:k,currentVertexPosition:$,direction:Oe}},clickAnywhere:function(C,k){if(C.currentVertexPosition>0&&Yo(k,C.line.coordinates[C.currentVertexPosition-1])||C.direction==="backwards"&&Yo(k,C.line.coordinates[C.currentVertexPosition+1]))return this.changeMode(te.SIMPLE_SELECT,{featureIds:[C.line.id]});this.updateUIClasses({mouse:Z.ADD}),C.line.updateCoordinate(C.currentVertexPosition,k.lngLat.lng,k.lngLat.lat),C.direction==="forward"?(C.currentVertexPosition++,C.line.updateCoordinate(C.currentVertexPosition,k.lngLat.lng,k.lngLat.lat)):C.line.addCoordinate(0,k.lngLat.lng,k.lngLat.lat)},clickOnVertex:function(C){return this.changeMode(te.SIMPLE_SELECT,{featureIds:[C.line.id]})},onMouseMove:function(C,k){C.line.updateCoordinate(C.currentVertexPosition,k.lngLat.lng,k.lngLat.lat),Jt(k)&&this.updateUIClasses({mouse:Z.POINTER})}};st.onTap=st.onClick=function(C,k){if(Jt(k))return this.clickOnVertex(C,k);this.clickAnywhere(C,k)},st.onKeyUp=function(C,k){yt(k)?this.changeMode(te.SIMPLE_SELECT,{featureIds:[C.line.id]}):vs(k)&&(this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(te.SIMPLE_SELECT))},st.onStop=function(C){cs.enable(this),this.activateUIButton(),this.getFeature(C.line.id)!==void 0&&(C.line.removeCoordinate(""+C.currentVertexPosition),C.line.isValid()?this.map.fire(ae.CREATE,{features:[C.line.toGeoJSON()]}):(this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(te.SIMPLE_SELECT,{},{silent:!0})))},st.onTrash=function(C){this.deleteFeature([C.line.id],{silent:!0}),this.changeMode(te.SIMPLE_SELECT)},st.toDisplayFeatures=function(C,k,$){var xe=k.properties.id===C.line.id;if(k.properties.active=xe?Ue.ACTIVE:Ue.INACTIVE,!xe)return $(k);k.geometry.coordinates.length<2||(k.properties.meta=ye.FEATURE,$(js(C.line.id,k.geometry.coordinates[C.direction==="forward"?k.geometry.coordinates.length-2:1],""+(C.direction==="forward"?k.geometry.coordinates.length-2:1),!1)),$(k))};var Jo={simple_select:hi,direct_select:wn,draw_point:In,draw_polygon:Ys,draw_line_string:st},qr={defaultMode:te.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Ji,modes:Jo,controls:{},userProperties:!1},nl={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Dh={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Qo(C,k){return C.map(function($){return $.source?$:Si($,{id:$.id+"."+k,source:k==="hot"?V.HOT:V.COLD})})}var Oa={};(function(C,k){var $="__lodash_hash_undefined__",xe=9007199254740991,Oe="[object Arguments]",Pe="[object Array]",ze="[object Boolean]",Ft="[object Date]",kt="[object Error]",ai="[object Function]",Zt="[object Map]",Qt="[object Number]",Hi="[object Object]",vr="[object Promise]",Zi="[object RegExp]",Mr="[object Set]",Et="[object String]",ci="[object Symbol]",Qi="[object WeakMap]",Yr="[object ArrayBuffer]",Br="[object DataView]",Os=/^\[object .+?Constructor\]$/,Js=/^(?:0|[1-9]\d*)$/,Ar={};Ar["[object Float32Array]"]=Ar["[object Float64Array]"]=Ar["[object Int8Array]"]=Ar["[object Int16Array]"]=Ar["[object Int32Array]"]=Ar["[object Uint8Array]"]=Ar["[object Uint8ClampedArray]"]=Ar["[object Uint16Array]"]=Ar["[object Uint32Array]"]=!0,Ar[Oe]=Ar[Pe]=Ar[Yr]=Ar[ze]=Ar[Br]=Ar[Ft]=Ar[kt]=Ar[ai]=Ar[Zt]=Ar[Qt]=Ar[Hi]=Ar[Zi]=Ar[Mr]=Ar[Et]=Ar[Qi]=!1;var kc=typeof ru=="object"&&ru&&ru.Object===Object&&ru,is=typeof self=="object"&&self&&self.Object===Object&&self,Qs=kc||is||Function("return this")(),uu=k&&!k.nodeType&&k,nc=uu&&C&&!C.nodeType&&C,bs=nc&&nc.exports===uu,rc=bs&&kc.process,Pl=function(){try{return rc&&rc.binding&&rc.binding("util")}catch{}}(),Xn=Pl&&Pl.isTypedArray;function ar(Ve,ut){for(var ii=-1,Ri=Ve==null?0:Ve.length;++ii<Ri;)if(ut(Ve[ii],ii,Ve))return!0;return!1}function hu(Ve){var ut=-1,ii=Array(Ve.size);return Ve.forEach(function(Ri,$n){ii[++ut]=[$n,Ri]}),ii}function dd(Ve){var ut=-1,ii=Array(Ve.size);return Ve.forEach(function(Ri){ii[++ut]=Ri}),ii}var du,Ol,Zu,zc=Array.prototype,Rl=Function.prototype,$o=Object.prototype,Hr=Qs["__core-js_shared__"],ea=Rl.toString,xr=$o.hasOwnProperty,kl=(du=/[^.]+$/.exec(Hr&&Hr.keys&&Hr.keys.IE_PROTO||""))?"Symbol(src)_1."+du:"",Bc=$o.toString,wo=RegExp("^"+ea.call(xr).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),sc=bs?Qs.Buffer:void 0,oc=Qs.Symbol,Fc=Qs.Uint8Array,Nc=$o.propertyIsEnumerable,zl=zc.splice,Ra=oc?oc.toStringTag:void 0,Rs=Object.getOwnPropertySymbols,fu=sc?sc.isBuffer:void 0,po=(Ol=Object.keys,Zu=Object,function(Ve){return Ol(Zu(Ve))}),ka=Ua(Qs,"DataView"),On=Ua(Qs,"Map"),mo=Ua(Qs,"Promise"),sl=Ua(Qs,"Set"),za=Ua(Qs,"WeakMap"),Qn=Ua(Object,"create"),ta=na(ka),ac=na(On),Xu=na(mo),lc=na(sl),Ku=na(za),Ba=oc?oc.prototype:void 0,Fa=Ba?Ba.valueOf:void 0;function ia(Ve){var ut=-1,ii=Ve==null?0:Ve.length;for(this.clear();++ut<ii;){var Ri=Ve[ut];this.set(Ri[0],Ri[1])}}function _o(Ve){var ut=-1,ii=Ve==null?0:Ve.length;for(this.clear();++ut<ii;){var Ri=Ve[ut];this.set(Ri[0],Ri[1])}}function $i(Ve){var ut=-1,ii=Ve==null?0:Ve.length;for(this.clear();++ut<ii;){var Ri=Ve[ut];this.set(Ri[0],Ri[1])}}function ol(Ve){var ut=-1,ii=Ve==null?0:Ve.length;for(this.__data__=new $i;++ut<ii;)this.add(Ve[ut])}function fa(Ve){var ut=this.__data__=new _o(Ve);this.size=ut.size}function Yu(Ve,ut){var ii=fc(Ve),Ri=!ii&&Vc(Ve),$n=!ii&&!Ri&&Fo(Ve),cn=!ii&&!Ri&&!$n&&pc(Ve),Or=ii||Ri||$n||cn,ns=Or?function(Jr,ra){for(var hs=-1,Ne=Array(Jr);++hs<Jr;)Ne[hs]=ra(hs);return Ne}(Ve.length,String):[],ks=ns.length;for(var rs in Ve)!ut&&!xr.call(Ve,rs)||Or&&(rs=="length"||$n&&(rs=="offset"||rs=="parent")||cn&&(rs=="buffer"||rs=="byteLength"||rs=="byteOffset")||dc(rs,ks))||ns.push(rs);return ns}function al(Ve,ut){for(var ii=Ve.length;ii--;)if($u(Ve[ii][0],ut))return ii;return-1}function Na(Ve){return Ve==null?Ve===void 0?"[object Undefined]":"[object Null]":Ra&&Ra in Object(Ve)?function(ut){var ii=xr.call(ut,Ra),Ri=ut[Ra];try{ut[Ra]=void 0;var $n=!0}catch{}var cn=Bc.call(ut);return $n&&(ii?ut[Ra]=Ri:delete ut[Ra]),cn}(Ve):function(ut){return Bc.call(ut)}(Ve)}function Uc(Ve){return ja(Ve)&&Na(Ve)==Oe}function Ju(Ve,ut,ii,Ri,$n){return Ve===ut||(Ve==null||ut==null||!ja(Ve)&&!ja(ut)?Ve!=Ve&&ut!=ut:function(cn,Or,ns,ks,rs,Jr){var ra=fc(cn),hs=fc(Or),Ne=ra?Pe:Va(cn),ft=hs?Pe:Va(Or),at=(Ne=Ne==Oe?Hi:Ne)==Hi,_i=(ft=ft==Oe?Hi:ft)==Hi,Xi=Ne==ft;if(Xi&&Fo(cn)){if(!Fo(Or))return!1;ra=!0,at=!1}if(Xi&&!at)return Jr||(Jr=new fa),ra||pc(cn)?pu(cn,Or,ns,ks,rs,Jr):function(mr,En,qa,$s,Eo,ds,zs){switch(qa){case Br:if(mr.byteLength!=En.byteLength||mr.byteOffset!=En.byteOffset)return!1;mr=mr.buffer,En=En.buffer;case Yr:return!(mr.byteLength!=En.byteLength||!ds(new Fc(mr),new Fc(En)));case ze:case Ft:case Qt:return $u(+mr,+En);case kt:return mr.name==En.name&&mr.message==En.message;case Zi:case Et:return mr==En+"";case Zt:var Tn=hu;case Mr:var To=1&$s;if(Tn||(Tn=dd),mr.size!=En.size&&!To)return!1;var cl=zs.get(mr);if(cl)return cl==En;$s|=2,zs.set(mr,En);var on=pu(Tn(mr),Tn(En),$s,Eo,ds,zs);return zs.delete(mr),on;case ci:if(Fa)return Fa.call(mr)==Fa.call(En)}return!1}(cn,Or,Ne,ns,ks,rs,Jr);if(!(1&ns)){var qn=at&&xr.call(cn,"__wrapped__"),Wr=_i&&xr.call(Or,"__wrapped__");if(qn||Wr){var dr=qn?cn.value():cn,mu=Wr?Or.value():Or;return Jr||(Jr=new fa),rs(dr,mu,ns,ks,Jr)}}return Xi?(Jr||(Jr=new fa),function(mr,En,qa,$s,Eo,ds){var zs=1&qa,Tn=uc(mr),To=Tn.length,cl=uc(En).length;if(To!=cl&&!zs)return!1;for(var on=To;on--;){var pa=Tn[on];if(!(zs?pa in En:xr.call(En,pa)))return!1}var Ph=ds.get(mr);if(Ph&&ds.get(En))return Ph==En;var mc=!0;ds.set(mr,En),ds.set(En,mr);for(var ma=zs;++on<To;){var Io=mr[pa=Tn[on]],ul=En[pa];if($s)var _c=zs?$s(ul,Io,pa,En,mr,ds):$s(Io,ul,pa,mr,En,ds);if(!(_c===void 0?Io===ul||Eo(Io,ul,qa,$s,ds):_c)){mc=!1;break}ma||(ma=pa=="constructor")}if(mc&&!ma){var hl=mr.constructor,dl=En.constructor;hl==dl||!("constructor"in mr)||!("constructor"in En)||typeof hl=="function"&&hl instanceof hl&&typeof dl=="function"&&dl instanceof dl||(mc=!1)}return ds.delete(mr),ds.delete(En),mc}(cn,Or,ns,ks,rs,Jr)):!1}(Ve,ut,ii,Ri,Ju,$n))}function Qu(Ve){return!(!Gc(Ve)||function(ut){return!!kl&&kl in ut}(Ve))&&(Ga(Ve)?wo:Os).test(na(Ve))}function cc(Ve){if(ii=(ut=Ve)&&ut.constructor,Ri=typeof ii=="function"&&ii.prototype||$o,ut!==Ri)return po(Ve);var ut,ii,Ri,$n=[];for(var cn in Object(Ve))xr.call(Ve,cn)&&cn!="constructor"&&$n.push(cn);return $n}function pu(Ve,ut,ii,Ri,$n,cn){var Or=1&ii,ns=Ve.length,ks=ut.length;if(ns!=ks&&!(Or&&ks>ns))return!1;var rs=cn.get(Ve);if(rs&&cn.get(ut))return rs==ut;var Jr=-1,ra=!0,hs=2&ii?new ol:void 0;for(cn.set(Ve,ut),cn.set(ut,Ve);++Jr<ns;){var Ne=Ve[Jr],ft=ut[Jr];if(Ri)var at=Or?Ri(ft,Ne,Jr,ut,Ve,cn):Ri(Ne,ft,Jr,Ve,ut,cn);if(at!==void 0){if(at)continue;ra=!1;break}if(hs){if(!ar(ut,function(_i,Xi){if(qn=Xi,!hs.has(qn)&&(Ne===_i||$n(Ne,_i,ii,Ri,cn)))return hs.push(Xi);var qn})){ra=!1;break}}else if(Ne!==ft&&!$n(Ne,ft,ii,Ri,cn)){ra=!1;break}}return cn.delete(Ve),cn.delete(ut),ra}function uc(Ve){return function(ut,ii,Ri){var $n=ii(ut);return fc(ut)?$n:function(cn,Or){for(var ns=-1,ks=Or.length,rs=cn.length;++ns<ks;)cn[rs+ns]=Or[ns];return cn}($n,Ri(ut))}(Ve,ll,hc)}function us(Ve,ut){var ii,Ri,$n=Ve.__data__;return((Ri=typeof(ii=ut))=="string"||Ri=="number"||Ri=="symbol"||Ri=="boolean"?ii!=="__proto__":ii===null)?$n[typeof ut=="string"?"string":"hash"]:$n.map}function Ua(Ve,ut){var ii=function(Ri,$n){return Ri==null?void 0:Ri[$n]}(Ve,ut);return Qu(ii)?ii:void 0}ia.prototype.clear=function(){this.__data__=Qn?Qn(null):{},this.size=0},ia.prototype.delete=function(Ve){var ut=this.has(Ve)&&delete this.__data__[Ve];return this.size-=ut?1:0,ut},ia.prototype.get=function(Ve){var ut=this.__data__;if(Qn){var ii=ut[Ve];return ii===$?void 0:ii}return xr.call(ut,Ve)?ut[Ve]:void 0},ia.prototype.has=function(Ve){var ut=this.__data__;return Qn?ut[Ve]!==void 0:xr.call(ut,Ve)},ia.prototype.set=function(Ve,ut){var ii=this.__data__;return this.size+=this.has(Ve)?0:1,ii[Ve]=Qn&&ut===void 0?$:ut,this},_o.prototype.clear=function(){this.__data__=[],this.size=0},_o.prototype.delete=function(Ve){var ut=this.__data__,ii=al(ut,Ve);return!(ii<0)&&(ii==ut.length-1?ut.pop():zl.call(ut,ii,1),--this.size,!0)},_o.prototype.get=function(Ve){var ut=this.__data__,ii=al(ut,Ve);return ii<0?void 0:ut[ii][1]},_o.prototype.has=function(Ve){return al(this.__data__,Ve)>-1},_o.prototype.set=function(Ve,ut){var ii=this.__data__,Ri=al(ii,Ve);return Ri<0?(++this.size,ii.push([Ve,ut])):ii[Ri][1]=ut,this},$i.prototype.clear=function(){this.size=0,this.__data__={hash:new ia,map:new(On||_o),string:new ia}},$i.prototype.delete=function(Ve){var ut=us(this,Ve).delete(Ve);return this.size-=ut?1:0,ut},$i.prototype.get=function(Ve){return us(this,Ve).get(Ve)},$i.prototype.has=function(Ve){return us(this,Ve).has(Ve)},$i.prototype.set=function(Ve,ut){var ii=us(this,Ve),Ri=ii.size;return ii.set(Ve,ut),this.size+=ii.size==Ri?0:1,this},ol.prototype.add=ol.prototype.push=function(Ve){return this.__data__.set(Ve,$),this},ol.prototype.has=function(Ve){return this.__data__.has(Ve)},fa.prototype.clear=function(){this.__data__=new _o,this.size=0},fa.prototype.delete=function(Ve){var ut=this.__data__,ii=ut.delete(Ve);return this.size=ut.size,ii},fa.prototype.get=function(Ve){return this.__data__.get(Ve)},fa.prototype.has=function(Ve){return this.__data__.has(Ve)},fa.prototype.set=function(Ve,ut){var ii=this.__data__;if(ii instanceof _o){var Ri=ii.__data__;if(!On||Ri.length<199)return Ri.push([Ve,ut]),this.size=++ii.size,this;ii=this.__data__=new $i(Ri)}return ii.set(Ve,ut),this.size=ii.size,this};var hc=Rs?function(Ve){return Ve==null?[]:(Ve=Object(Ve),function(ut,ii){for(var Ri=-1,$n=ut==null?0:ut.length,cn=0,Or=[];++Ri<$n;){var ns=ut[Ri];ii(ns,Ri,ut)&&(Or[cn++]=ns)}return Or}(Rs(Ve),function(ut){return Nc.call(Ve,ut)}))}:function(){return[]},Va=Na;function dc(Ve,ut){return!!(ut=ut??xe)&&(typeof Ve=="number"||Js.test(Ve))&&Ve>-1&&Ve%1==0&&Ve<ut}function na(Ve){if(Ve!=null){try{return ea.call(Ve)}catch{}try{return Ve+""}catch{}}return""}function $u(Ve,ut){return Ve===ut||Ve!=Ve&&ut!=ut}(ka&&Va(new ka(new ArrayBuffer(1)))!=Br||On&&Va(new On)!=Zt||mo&&Va(mo.resolve())!=vr||sl&&Va(new sl)!=Mr||za&&Va(new za)!=Qi)&&(Va=function(Ve){var ut=Na(Ve),ii=ut==Hi?Ve.constructor:void 0,Ri=ii?na(ii):"";if(Ri)switch(Ri){case ta:return Br;case ac:return Zt;case Xu:return vr;case lc:return Mr;case Ku:return Qi}return ut});var Vc=Uc(function(){return arguments}())?Uc:function(Ve){return ja(Ve)&&xr.call(Ve,"callee")&&!Nc.call(Ve,"callee")},fc=Array.isArray,Fo=fu||function(){return!1};function Ga(Ve){if(!Gc(Ve))return!1;var ut=Na(Ve);return ut==ai||ut=="[object GeneratorFunction]"||ut=="[object AsyncFunction]"||ut=="[object Proxy]"}function eh(Ve){return typeof Ve=="number"&&Ve>-1&&Ve%1==0&&Ve<=xe}function Gc(Ve){var ut=typeof Ve;return Ve!=null&&(ut=="object"||ut=="function")}function ja(Ve){return Ve!=null&&typeof Ve=="object"}var pc=Xn?function(Ve){return function(ut){return Ve(ut)}}(Xn):function(Ve){return ja(Ve)&&eh(Ve.length)&&!!Ar[Na(Ve)]};function ll(Ve){return(ut=Ve)!=null&&eh(ut.length)&&!Ga(ut)?Yu(Ve):cc(Ve);var ut}C.exports=function(Ve,ut){return Ju(Ve,ut)}})({get exports(){return Oa},set exports(C){Oa=C}},Oa);var Wu=Oa;function rl(C,k){return C.length===k.length&&JSON.stringify(C.map(function($){return $}).sort())===JSON.stringify(k.map(function($){return $}).sort())}var Ht={Polygon:bn,LineString:Dn,Point:Ni,MultiPolygon:Ei,MultiLineString:Ei,MultiPoint:Ei},_n=Object.freeze({__proto__:null,CommonSelectors:fi,constrainFeatureMovement:yi,createMidPoint:Xo,createSupplementaryPoints:bo,createVertex:js,doubleClickZoom:cs,euclideanDistance:ti,featuresAt:qt,getFeatureAtAndSetCursors:dt,isClick:Vi,isEventAtCoordinates:Yo,isTap:Gt,mapEventToBoundingBox:et,ModeHandler:o,moveFeatures:Le,sortFeatures:Bt,stringSetsAreEqual:rl,StringSet:ot,theme:Ji,toDenseArray:Ii}),vn=function(C,k){var $={options:C=function(Oe){Oe===void 0&&(Oe={});var Pe=Si(Oe);return Oe.controls||(Pe.controls={}),Oe.displayControlsDefault===!1?Pe.controls=Si(Dh,Oe.controls):Pe.controls=Si(nl,Oe.controls),(Pe=Si(qr,Pe)).styles=Qo(Pe.styles,"cold").concat(Qo(Pe.styles,"hot")),Pe}(C)};k=function(Oe,Pe){return Pe.modes=te,Pe.getFeatureIdsAt=function(ze){return qt.click({point:ze},null,Oe).map(function(Ft){return Ft.properties.id})},Pe.getSelectedIds=function(){return Oe.store.getSelectedIds()},Pe.getSelected=function(){return{type:W.FEATURE_COLLECTION,features:Oe.store.getSelectedIds().map(function(ze){return Oe.store.get(ze)}).map(function(ze){return ze.toGeoJSON()})}},Pe.getSelectedPoints=function(){return{type:W.FEATURE_COLLECTION,features:Oe.store.getSelectedCoordinates().map(function(ze){return{type:W.FEATURE,properties:{},geometry:{type:W.POINT,coordinates:ze.coordinates}}})}},Pe.set=function(ze){if(ze.type===void 0||ze.type!==W.FEATURE_COLLECTION||!Array.isArray(ze.features))throw new Error("Invalid FeatureCollection");var Ft=Oe.store.createRenderBatch(),kt=Oe.store.getAllIds().slice(),ai=Pe.add(ze),Zt=new ot(ai);return(kt=kt.filter(function(Qt){return!Zt.has(Qt)})).length&&Pe.delete(kt),Ft(),ai},Pe.add=function(ze){var Ft=JSON.parse(JSON.stringify(qs(ze))).features.map(function(kt){if(kt.id=kt.id||Yi(),kt.geometry===null)throw new Error("Invalid geometry: null");if(Oe.store.get(kt.id)===void 0||Oe.store.get(kt.id).type!==kt.geometry.type){var ai=Ht[kt.geometry.type];if(ai===void 0)throw new Error("Invalid geometry type: "+kt.geometry.type+".");var Zt=new ai(Oe,kt);Oe.store.add(Zt)}else{var Qt=Oe.store.get(kt.id);Qt.properties=kt.properties,Wu(Qt.getCoordinates(),kt.geometry.coordinates)||Qt.incomingCoords(kt.geometry.coordinates)}return kt.id});return Oe.store.render(),Ft},Pe.get=function(ze){var Ft=Oe.store.get(ze);if(Ft)return Ft.toGeoJSON()},Pe.getAll=function(){return{type:W.FEATURE_COLLECTION,features:Oe.store.getAll().map(function(ze){return ze.toGeoJSON()})}},Pe.delete=function(ze){return Oe.store.delete(ze,{silent:!0}),Pe.getMode()!==te.DIRECT_SELECT||Oe.store.getSelectedIds().length?Oe.store.render():Oe.events.changeMode(te.SIMPLE_SELECT,void 0,{silent:!0}),Pe},Pe.deleteAll=function(){return Oe.store.delete(Oe.store.getAllIds(),{silent:!0}),Pe.getMode()===te.DIRECT_SELECT?Oe.events.changeMode(te.SIMPLE_SELECT,void 0,{silent:!0}):Oe.store.render(),Pe},Pe.changeMode=function(ze,Ft){return Ft===void 0&&(Ft={}),ze===te.SIMPLE_SELECT&&Pe.getMode()===te.SIMPLE_SELECT?(rl(Ft.featureIds||[],Oe.store.getSelectedIds())||(Oe.store.setSelected(Ft.featureIds,{silent:!0}),Oe.store.render()),Pe):(ze===te.DIRECT_SELECT&&Pe.getMode()===te.DIRECT_SELECT&&Ft.featureId===Oe.store.getSelectedIds()[0]||Oe.events.changeMode(ze,Ft,{silent:!0}),Pe)},Pe.getMode=function(){return Oe.events.getMode()},Pe.trash=function(){return Oe.events.trash({silent:!0}),Pe},Pe.combineFeatures=function(){return Oe.events.combineFeatures({silent:!0}),Pe},Pe.uncombineFeatures=function(){return Oe.events.uncombineFeatures({silent:!0}),Pe},Pe.setFeatureProperty=function(ze,Ft,kt){return Oe.store.setFeatureProperty(ze,Ft,kt),Pe},Pe}($,k),$.api=k;var xe=Ir($);return k.onAdd=xe.onAdd,k.onRemove=xe.onRemove,k.types=Y,k.options=C,k};function fo(C){vn(C,this)}return fo.modes=Jo,fo.constants=ct,fo.lib=_n,fo})})(Fb);const Nb=zb(Dv);function Ub(){const{subscribe:s,set:a,update:o}=af([]);return{subscribe:s,set:a,add:d=>o(_=>(d.forEach(v=>{if(_.map(E=>E.id).includes(v.id)){const E=_.map(r=>r.id).filter(r=>r.startsWith(v.id)).length;v.id+=`_${E}`}}),[..._,...d]))}}const Rx=Ub();function Vb(s){return s.type==="Feature"}function kx(s){return s.type==="FeatureCollection"}function Gb(s){return s.type==="GeometryCollection"}function zx(s,a){return s.type==="Point"?{...s,coordinates:a.forward(s.coordinates)}:s.type==="LineString"||s.type==="MultiPoint"?{...s,coordinates:s.coordinates.map(a.forward)}:s.type==="Polygon"||s.type==="MultiLineString"?{...s,coordinates:s.coordinates.map(o=>o.map(a.forward))}:s.type==="MultiPolygon"?{...s,coordinates:s.coordinates.map(o=>o.map(d=>d.map(a.forward)))}:s.type==="GeometryCollection"?{...s,geometries:s.geometries.map(o=>zx(o,a))}:s}function jb(){const{subscribe:s,set:a,update:o}=af([]),{subscribe:d,set:_}=af();return{subscribe:s,set:a,add:v=>o(E=>{if(E.map(r=>r.id).includes(v.id)){const r=E.map(I=>I.id).filter(I=>I.startsWith(v.id)).length;v.id+=`_${r}`}return[v,...E]}),setNewLayerIndex:_,subscribeNewLayerIndex:d,toggleVisibility:v=>o(E=>{const r=E.find(I=>I.id===v);if(!r)throw new Error("Invalid layer id");return r.isVisible=!r.isVisible,E}),deleteLayer:v=>o(E=>E.filter(r=>r.id!==v))}}const Rc=jb();var yy={},qb={get exports(){return yy},set exports(s){yy=s}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(s,a){(function(){var o,d="4.17.21",_=200,v="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",E="Expected a function",r="Invalid `variable` option passed into `_.template`",I="__lodash_hash_undefined__",R=500,U="__lodash_placeholder__",V=1,Z=2,Y=4,W=1,te=2,ae=1,Ie=2,ye=4,Ue=8,je=16,_e=32,ct=64,lt=128,St=256,Bt=512,et=30,ot="...",Nt=800,qt=16,_t=1,dt=2,ti=3,Vi=1/0,Gt=9007199254740991,Yi=17976931348623157e292,Gi=0/0,ki=4294967295,Ni=ki-1,Dn=ki>>>1,bn=[["ary",lt],["bind",ae],["bindKey",Ie],["curry",Ue],["curryRight",je],["flip",Bt],["partial",_e],["partialRight",ct],["rearg",St]],ui="[object Arguments]",Wi="[object Array]",Ei="[object AsyncFunction]",Wt="[object Boolean]",Vn="[object Date]",It="[object DOMException]",wt="[object Error]",Ii="[object Function]",dn="[object GeneratorFunction]",$t="[object Map]",gt="[object Number]",Si="[object Null]",Pi="[object Object]",Pr="[object Promise]",Ir="[object Proxy]",Ji="[object RegExp]",jn="[object Set]",sr="[object String]",Be="[object Symbol]",li="[object Undefined]",qi="[object WeakMap]",Ci="[object WeakSet]",Jt="[object ArrayBuffer]",nn="[object DataView]",vs="[object Float32Array]",yt="[object Float64Array]",fi="[object Int8Array]",xi="[object Int16Array]",yn="[object Int32Array]",ls="[object Uint8Array]",js="[object Uint8ClampedArray]",Xo="[object Uint16Array]",bo="[object Uint32Array]",cs=/\b__p \+= '';/g,ho=/\b(__p \+=) '' \+/g,La=/(__e\(.*?\)|\b__t\)) \+\n'';/g,qs=/&(?:amp|lt|gt|quot|#39);/g,ua=/[&<>"']/g,Dl=RegExp(qs.source),Da=RegExp(ua.source),Ko=/<%-([\s\S]+?)%>/g,Pa=/<%([\s\S]+?)%>/g,xs=/<%=([\s\S]+?)%>/g,ha=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ps=/^\w*$/,da=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,he=/[\\^$.*+?()[\]{}|]/g,q=RegExp(he.source),K=/^\s+/,ue=/\s/,ve=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Ce=/\{\n\/\* \[wrapped with (.+)\] \*/,qe=/,? & /,Fe=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Re=/[()=,{}\[\]\/\s]/,Ke=/\\(\\)?/g,vt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Xt=/\w*$/,Dt=/^[-+]0x[0-9a-f]+$/i,Mi=/^0b[01]+$/i,gi=/^\[object .+?Constructor\]$/,yi=/^0o[0-7]+$/i,Le=/^(?:0|[1-9]\d*)$/,hi=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Pn=/($^)/,Oi=/['\n\r\u2028\u2029\\]/g,wn="\\ud800-\\udfff",In="\\u0300-\\u036f",Yo="\\ufe20-\\ufe2f",Ys="\\u20d0-\\u20ff",st=In+Yo+Ys,Jo="\\u2700-\\u27bf",qr="a-z\\xdf-\\xf6\\xf8-\\xff",nl="\\xac\\xb1\\xd7\\xf7",Dh="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Qo="\\u2000-\\u206f",Oa=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Wu="A-Z\\xc0-\\xd6\\xd8-\\xde",rl="\\ufe0e\\ufe0f",Ht=nl+Dh+Qo+Oa,_n="['’]",vn="["+wn+"]",fo="["+Ht+"]",C="["+st+"]",k="\\d+",$="["+Jo+"]",xe="["+qr+"]",Oe="[^"+wn+Ht+k+Jo+qr+Wu+"]",Pe="\\ud83c[\\udffb-\\udfff]",ze="(?:"+C+"|"+Pe+")",Ft="[^"+wn+"]",kt="(?:\\ud83c[\\udde6-\\uddff]){2}",ai="[\\ud800-\\udbff][\\udc00-\\udfff]",Zt="["+Wu+"]",Qt="\\u200d",Hi="(?:"+xe+"|"+Oe+")",vr="(?:"+Zt+"|"+Oe+")",Zi="(?:"+_n+"(?:d|ll|m|re|s|t|ve))?",Mr="(?:"+_n+"(?:D|LL|M|RE|S|T|VE))?",Et=ze+"?",ci="["+rl+"]?",Qi="(?:"+Qt+"(?:"+[Ft,kt,ai].join("|")+")"+ci+Et+")*",Yr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Br="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Os=ci+Et+Qi,Js="(?:"+[$,kt,ai].join("|")+")"+Os,Ar="(?:"+[Ft+C+"?",C,kt,ai,vn].join("|")+")",kc=RegExp(_n,"g"),is=RegExp(C,"g"),Qs=RegExp(Pe+"(?="+Pe+")|"+Ar+Os,"g"),uu=RegExp([Zt+"?"+xe+"+"+Zi+"(?="+[fo,Zt,"$"].join("|")+")",vr+"+"+Mr+"(?="+[fo,Zt+Hi,"$"].join("|")+")",Zt+"?"+Hi+"+"+Zi,Zt+"+"+Mr,Br,Yr,k,Js].join("|"),"g"),nc=RegExp("["+Qt+wn+st+rl+"]"),bs=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,rc=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Pl=-1,Xn={};Xn[vs]=Xn[yt]=Xn[fi]=Xn[xi]=Xn[yn]=Xn[ls]=Xn[js]=Xn[Xo]=Xn[bo]=!0,Xn[ui]=Xn[Wi]=Xn[Jt]=Xn[Wt]=Xn[nn]=Xn[Vn]=Xn[wt]=Xn[Ii]=Xn[$t]=Xn[gt]=Xn[Pi]=Xn[Ji]=Xn[jn]=Xn[sr]=Xn[qi]=!1;var ar={};ar[ui]=ar[Wi]=ar[Jt]=ar[nn]=ar[Wt]=ar[Vn]=ar[vs]=ar[yt]=ar[fi]=ar[xi]=ar[yn]=ar[$t]=ar[gt]=ar[Pi]=ar[Ji]=ar[jn]=ar[sr]=ar[Be]=ar[ls]=ar[js]=ar[Xo]=ar[bo]=!0,ar[wt]=ar[Ii]=ar[qi]=!1;var hu={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},dd={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},du={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Ol={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Zu=parseFloat,zc=parseInt,Rl=typeof ru=="object"&&ru&&ru.Object===Object&&ru,$o=typeof self=="object"&&self&&self.Object===Object&&self,Hr=Rl||$o||Function("return this")(),ea=a&&!a.nodeType&&a,xr=ea&&!0&&s&&!s.nodeType&&s,kl=xr&&xr.exports===ea,Bc=kl&&Rl.process,wo=function(){try{var Ne=xr&&xr.require&&xr.require("util").types;return Ne||Bc&&Bc.binding&&Bc.binding("util")}catch{}}(),sc=wo&&wo.isArrayBuffer,oc=wo&&wo.isDate,Fc=wo&&wo.isMap,Nc=wo&&wo.isRegExp,zl=wo&&wo.isSet,Ra=wo&&wo.isTypedArray;function Rs(Ne,ft,at){switch(at.length){case 0:return Ne.call(ft);case 1:return Ne.call(ft,at[0]);case 2:return Ne.call(ft,at[0],at[1]);case 3:return Ne.call(ft,at[0],at[1],at[2])}return Ne.apply(ft,at)}function fu(Ne,ft,at,_i){for(var Xi=-1,qn=Ne==null?0:Ne.length;++Xi<qn;){var Wr=Ne[Xi];ft(_i,Wr,at(Wr),Ne)}return _i}function po(Ne,ft){for(var at=-1,_i=Ne==null?0:Ne.length;++at<_i&&ft(Ne[at],at,Ne)!==!1;);return Ne}function ka(Ne,ft){for(var at=Ne==null?0:Ne.length;at--&&ft(Ne[at],at,Ne)!==!1;);return Ne}function On(Ne,ft){for(var at=-1,_i=Ne==null?0:Ne.length;++at<_i;)if(!ft(Ne[at],at,Ne))return!1;return!0}function mo(Ne,ft){for(var at=-1,_i=Ne==null?0:Ne.length,Xi=0,qn=[];++at<_i;){var Wr=Ne[at];ft(Wr,at,Ne)&&(qn[Xi++]=Wr)}return qn}function sl(Ne,ft){var at=Ne==null?0:Ne.length;return!!at&&$i(Ne,ft,0)>-1}function za(Ne,ft,at){for(var _i=-1,Xi=Ne==null?0:Ne.length;++_i<Xi;)if(at(ft,Ne[_i]))return!0;return!1}function Qn(Ne,ft){for(var at=-1,_i=Ne==null?0:Ne.length,Xi=Array(_i);++at<_i;)Xi[at]=ft(Ne[at],at,Ne);return Xi}function ta(Ne,ft){for(var at=-1,_i=ft.length,Xi=Ne.length;++at<_i;)Ne[Xi+at]=ft[at];return Ne}function ac(Ne,ft,at,_i){var Xi=-1,qn=Ne==null?0:Ne.length;for(_i&&qn&&(at=Ne[++Xi]);++Xi<qn;)at=ft(at,Ne[Xi],Xi,Ne);return at}function Xu(Ne,ft,at,_i){var Xi=Ne==null?0:Ne.length;for(_i&&Xi&&(at=Ne[--Xi]);Xi--;)at=ft(at,Ne[Xi],Xi,Ne);return at}function lc(Ne,ft){for(var at=-1,_i=Ne==null?0:Ne.length;++at<_i;)if(ft(Ne[at],at,Ne))return!0;return!1}var Ku=al("length");function Ba(Ne){return Ne.split("")}function Fa(Ne){return Ne.match(Fe)||[]}function ia(Ne,ft,at){var _i;return at(Ne,function(Xi,qn,Wr){if(ft(Xi,qn,Wr))return _i=qn,!1}),_i}function _o(Ne,ft,at,_i){for(var Xi=Ne.length,qn=at+(_i?1:-1);_i?qn--:++qn<Xi;)if(ft(Ne[qn],qn,Ne))return qn;return-1}function $i(Ne,ft,at){return ft===ft?ii(Ne,ft,at):_o(Ne,fa,at)}function ol(Ne,ft,at,_i){for(var Xi=at-1,qn=Ne.length;++Xi<qn;)if(_i(Ne[Xi],ft))return Xi;return-1}function fa(Ne){return Ne!==Ne}function Yu(Ne,ft){var at=Ne==null?0:Ne.length;return at?Qu(Ne,ft)/at:Gi}function al(Ne){return function(ft){return ft==null?o:ft[Ne]}}function Na(Ne){return function(ft){return Ne==null?o:Ne[ft]}}function Uc(Ne,ft,at,_i,Xi){return Xi(Ne,function(qn,Wr,dr){at=_i?(_i=!1,qn):ft(at,qn,Wr,dr)}),at}function Ju(Ne,ft){var at=Ne.length;for(Ne.sort(ft);at--;)Ne[at]=Ne[at].value;return Ne}function Qu(Ne,ft){for(var at,_i=-1,Xi=Ne.length;++_i<Xi;){var qn=ft(Ne[_i]);qn!==o&&(at=at===o?qn:at+qn)}return at}function cc(Ne,ft){for(var at=-1,_i=Array(Ne);++at<Ne;)_i[at]=ft(at);return _i}function pu(Ne,ft){return Qn(ft,function(at){return[at,Ne[at]]})}function uc(Ne){return Ne&&Ne.slice(0,Or(Ne)+1).replace(K,"")}function us(Ne){return function(ft){return Ne(ft)}}function Ua(Ne,ft){return Qn(ft,function(at){return Ne[at]})}function hc(Ne,ft){return Ne.has(ft)}function Va(Ne,ft){for(var at=-1,_i=Ne.length;++at<_i&&$i(ft,Ne[at],0)>-1;);return at}function dc(Ne,ft){for(var at=Ne.length;at--&&$i(ft,Ne[at],0)>-1;);return at}function na(Ne,ft){for(var at=Ne.length,_i=0;at--;)Ne[at]===ft&&++_i;return _i}var $u=Na(hu),Vc=Na(dd);function fc(Ne){return"\\"+Ol[Ne]}function Fo(Ne,ft){return Ne==null?o:Ne[ft]}function Ga(Ne){return nc.test(Ne)}function eh(Ne){return bs.test(Ne)}function Gc(Ne){for(var ft,at=[];!(ft=Ne.next()).done;)at.push(ft.value);return at}function ja(Ne){var ft=-1,at=Array(Ne.size);return Ne.forEach(function(_i,Xi){at[++ft]=[Xi,_i]}),at}function pc(Ne,ft){return function(at){return Ne(ft(at))}}function ll(Ne,ft){for(var at=-1,_i=Ne.length,Xi=0,qn=[];++at<_i;){var Wr=Ne[at];(Wr===ft||Wr===U)&&(Ne[at]=U,qn[Xi++]=at)}return qn}function Ve(Ne){var ft=-1,at=Array(Ne.size);return Ne.forEach(function(_i){at[++ft]=_i}),at}function ut(Ne){var ft=-1,at=Array(Ne.size);return Ne.forEach(function(_i){at[++ft]=[_i,_i]}),at}function ii(Ne,ft,at){for(var _i=at-1,Xi=Ne.length;++_i<Xi;)if(Ne[_i]===ft)return _i;return-1}function Ri(Ne,ft,at){for(var _i=at+1;_i--;)if(Ne[_i]===ft)return _i;return _i}function $n(Ne){return Ga(Ne)?ks(Ne):Ku(Ne)}function cn(Ne){return Ga(Ne)?rs(Ne):Ba(Ne)}function Or(Ne){for(var ft=Ne.length;ft--&&ue.test(Ne.charAt(ft)););return ft}var ns=Na(du);function ks(Ne){for(var ft=Qs.lastIndex=0;Qs.test(Ne);)++ft;return ft}function rs(Ne){return Ne.match(Qs)||[]}function Jr(Ne){return Ne.match(uu)||[]}var ra=function Ne(ft){ft=ft==null?Hr:hs.defaults(Hr.Object(),ft,hs.pick(Hr,rc));var at=ft.Array,_i=ft.Date,Xi=ft.Error,qn=ft.Function,Wr=ft.Math,dr=ft.Object,mu=ft.RegExp,mr=ft.String,En=ft.TypeError,qa=at.prototype,$s=qn.prototype,Eo=dr.prototype,ds=ft["__core-js_shared__"],zs=$s.toString,Tn=Eo.hasOwnProperty,To=0,cl=function(){var h=/[^.]+$/.exec(ds&&ds.keys&&ds.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),on=Eo.toString,pa=zs.call(dr),Ph=Hr._,mc=mu("^"+zs.call(Tn).replace(he,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ma=kl?ft.Buffer:o,Io=ft.Symbol,ul=ft.Uint8Array,_c=ma?ma.allocUnsafe:o,hl=pc(dr.getPrototypeOf,dr),dl=dr.create,jc=Eo.propertyIsEnumerable,Bl=qa.splice,th=Io?Io.isConcatSpreadable:o,Ha=Io?Io.iterator:o,sa=Io?Io.toStringTag:o,gc=function(){try{var h=Es(dr,"defineProperty");return h({},"",{}),h}catch{}}(),ih=ft.clearTimeout!==Hr.clearTimeout&&ft.clearTimeout,ni=_i&&_i.now!==Hr.Date.now&&_i.now,_a=ft.setTimeout!==Hr.setTimeout&&ft.setTimeout,nh=Wr.ceil,_u=Wr.floor,qc=dr.getOwnPropertySymbols,gu=ma?ma.isBuffer:o,fd=ft.isFinite,Oh=qa.join,pd=pc(dr.keys,dr),ss=Wr.max,ws=Wr.min,rh=_i.now,Hs=ft.parseInt,sh=Wr.random,zp=qa.reverse,Rh=Es(ft,"DataView"),yc=Es(ft,"Map"),oh=Es(ft,"Promise"),Fl=Es(ft,"Set"),yu=Es(ft,"WeakMap"),fl=Es(dr,"create"),vu=yu&&new yu,Hc={},kh=gh(Rh),uf=gh(yc),md=gh(oh),_d=gh(Fl),xu=gh(yu),Wc=Io?Io.prototype:o,Nl=Wc?Wc.valueOf:o,gd=Wc?Wc.toString:o;function ne(h){if(Kr(h)&&!gn(h)&&!(h instanceof en)){if(h instanceof Mo)return h;if(Tn.call(h,"__wrapped__"))return zf(h)}return new Mo(h)}var vc=function(){function h(){}return function(y){if(!Fr(y))return{};if(dl)return dl(y);h.prototype=y;var S=new h;return h.prototype=o,S}}();function ah(){}function Mo(h,y){this.__wrapped__=h,this.__actions__=[],this.__chain__=!!y,this.__index__=0,this.__values__=o}ne.templateSettings={escape:Ko,evaluate:Pa,interpolate:xs,variable:"",imports:{_:ne}},ne.prototype=ah.prototype,ne.prototype.constructor=ne,Mo.prototype=vc(ah.prototype),Mo.prototype.constructor=Mo;function en(h){this.__wrapped__=h,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=ki,this.__views__=[]}function Bp(){var h=new en(this.__wrapped__);return h.__actions__=io(this.__actions__),h.__dir__=this.__dir__,h.__filtered__=this.__filtered__,h.__iteratees__=io(this.__iteratees__),h.__takeCount__=this.__takeCount__,h.__views__=io(this.__views__),h}function hf(){if(this.__filtered__){var h=new en(this);h.__dir__=-1,h.__filtered__=!0}else h=this.clone(),h.__dir__*=-1;return h}function Fp(){var h=this.__wrapped__.value(),y=this.__dir__,S=gn(h),N=y<0,Q=S?h.length:0,ce=Dd(0,Q,this.__views__),Ee=ce.start,ke=ce.end,Ze=ke-Ee,Mt=N?ke:Ee-1,Lt=this.__iteratees__,Vt=Lt.length,mi=0,zi=ws(Ze,this.__takeCount__);if(!S||!N&&Q==Ze&&zi==Ze)return Tu(h,this.__actions__);var an=[];e:for(;Ze--&&mi<zi;){Mt+=y;for(var Bn=-1,un=h[Mt];++Bn<Vt;){var Kn=Lt[Bn],er=Kn.iteratee,Ma=Kn.type,Go=er(un);if(Ma==dt)un=Go;else if(!Go){if(Ma==_t)continue e;break e}}an[mi++]=un}return an}en.prototype=vc(ah.prototype),en.prototype.constructor=en;function xc(h){var y=-1,S=h==null?0:h.length;for(this.clear();++y<S;){var N=h[y];this.set(N[0],N[1])}}function Ul(){this.__data__=fl?fl(null):{},this.size=0}function df(h){var y=this.has(h)&&delete this.__data__[h];return this.size-=y?1:0,y}function bu(h){var y=this.__data__;if(fl){var S=y[h];return S===I?o:S}return Tn.call(y,h)?y[h]:o}function pl(h){var y=this.__data__;return fl?y[h]!==o:Tn.call(y,h)}function zh(h,y){var S=this.__data__;return this.size+=this.has(h)?0:1,S[h]=fl&&y===o?I:y,this}xc.prototype.clear=Ul,xc.prototype.delete=df,xc.prototype.get=bu,xc.prototype.has=pl,xc.prototype.set=zh;function ri(h){var y=-1,S=h==null?0:h.length;for(this.clear();++y<S;){var N=h[y];this.set(N[0],N[1])}}function ff(){this.__data__=[],this.size=0}function lh(h){var y=this.__data__,S=wc(y,h);if(S<0)return!1;var N=y.length-1;return S==N?y.pop():Bl.call(y,S,1),--this.size,!0}function ch(h){var y=this.__data__,S=wc(y,h);return S<0?o:y[S][1]}function uh(h){return wc(this.__data__,h)>-1}function hh(h,y){var S=this.__data__,N=wc(S,h);return N<0?(++this.size,S.push([h,y])):S[N][1]=y,this}ri.prototype.clear=ff,ri.prototype.delete=lh,ri.prototype.get=ch,ri.prototype.has=uh,ri.prototype.set=hh;function ml(h){var y=-1,S=h==null?0:h.length;for(this.clear();++y<S;){var N=h[y];this.set(N[0],N[1])}}function yd(){this.size=0,this.__data__={hash:new xc,map:new(yc||ri),string:new xc}}function pf(h){var y=No(this,h).delete(h);return this.size-=y?1:0,y}function vd(h){return No(this,h).get(h)}function xd(h){return No(this,h).has(h)}function dh(h,y){var S=No(this,h),N=S.size;return S.set(h,y),this.size+=S.size==N?0:1,this}ml.prototype.clear=yd,ml.prototype.delete=pf,ml.prototype.get=vd,ml.prototype.has=xd,ml.prototype.set=dh;function _l(h){var y=-1,S=h==null?0:h.length;for(this.__data__=new ml;++y<S;)this.add(h[y])}function wu(h){return this.__data__.set(h,I),this}function Bh(h){return this.__data__.has(h)}_l.prototype.add=_l.prototype.push=wu,_l.prototype.has=Bh;function ga(h){var y=this.__data__=new ri(h);this.size=y.size}function mf(){this.__data__=new ri,this.size=0}function bd(h){var y=this.__data__,S=y.delete(h);return this.size=y.size,S}function _f(h){return this.__data__.get(h)}function gf(h){return this.__data__.has(h)}function yf(h,y){var S=this.__data__;if(S instanceof ri){var N=S.__data__;if(!yc||N.length<_-1)return N.push([h,y]),this.size=++S.size,this;S=this.__data__=new ml(N)}return S.set(h,y),this.size=S.size,this}ga.prototype.clear=mf,ga.prototype.delete=bd,ga.prototype.get=_f,ga.prototype.has=gf,ga.prototype.set=yf;function Fh(h,y){var S=gn(h),N=!S&&Lu(h),Q=!S&&!N&&$c(h),ce=!S&&!N&&!Q&&Jh(h),Ee=S||N||Q||ce,ke=Ee?cc(h.length,mr):[],Ze=ke.length;for(var Mt in h)(y||Tn.call(h,Mt))&&!(Ee&&(Mt=="length"||Q&&(Mt=="offset"||Mt=="parent")||ce&&(Mt=="buffer"||Mt=="byteLength"||Mt=="byteOffset")||Ic(Mt,Ze)))&&ke.push(Mt);return ke}function wd(h){var y=h.length;return y?h[gl(0,y-1)]:o}function vf(h,y){return Ac(io(h),w(y,0,h.length))}function xf(h){return Ac(io(h))}function Nh(h,y,S){(S!==o&&!$l(h[y],S)||S===o&&!(y in h))&&m(h,y,S)}function bc(h,y,S){var N=h[y];(!(Tn.call(h,y)&&$l(N,S))||S===o&&!(y in h))&&m(h,y,S)}function wc(h,y){for(var S=h.length;S--;)if($l(h[S][0],y))return S;return-1}function f(h,y,S,N){return H(h,function(Q,ce,Ee){y(N,Q,S(Q),Ee)}),N}function n(h,y){return h&&go(y,fs(y),h)}function c(h,y){return h&&go(y,oa(y),h)}function m(h,y,S){y=="__proto__"&&gc?gc(h,y,{configurable:!0,enumerable:!0,value:S,writable:!0}):h[y]=S}function x(h,y){for(var S=-1,N=y.length,Q=at(N),ce=h==null;++S<N;)Q[S]=ce?o:bm(h,y[S]);return Q}function w(h,y,S){return h===h&&(S!==o&&(h=h<=S?h:S),y!==o&&(h=h>=y?h:y)),h}function A(h,y,S,N,Q,ce){var Ee,ke=y&V,Ze=y&Z,Mt=y&Y;if(S&&(Ee=Q?S(h,N,Q,ce):S(h)),Ee!==o)return Ee;if(!Fr(h))return h;var Lt=gn(h);if(Lt){if(Ee=Oy(h),!ke)return io(h,Ee)}else{var Vt=Lo(h),mi=Vt==Ii||Vt==dn;if($c(h))return Id(h,ke);if(Vt==Pi||Vt==ui||mi&&!Q){if(Ee=Ze||mi?{}:Wp(h),!ke)return Ze?Mu(h,c(Ee,h)):jl(h,n(Ee,h))}else{if(!ar[Vt])return Q?h:{};Ee=L_(h,Vt,ke)}}ce||(ce=new ga);var zi=ce.get(h);if(zi)return zi;ce.set(h,Ee),vm(h)?h.forEach(function(un){Ee.add(A(un,y,S,un,h,ce))}):gm(h)&&h.forEach(function(un,Kn){Ee.set(Kn,A(un,y,S,Kn,h,ce))});var an=Mt?Ze?Xl:Cu:Ze?oa:fs,Bn=Lt?o:an(h);return po(Bn||h,function(un,Kn){Bn&&(Kn=un,un=h[Kn]),bc(Ee,Kn,A(un,y,S,Kn,h,ce))}),Ee}function L(h){var y=fs(h);return function(S){return P(S,h,y)}}function P(h,y,S){var N=S.length;if(h==null)return!N;for(h=dr(h);N--;){var Q=S[N],ce=y[Q],Ee=h[Q];if(Ee===o&&!(Q in h)||!ce(Ee))return!1}return!0}function B(h,y,S){if(typeof h!="function")throw new En(E);return jh(function(){h.apply(o,S)},y)}function F(h,y,S,N){var Q=-1,ce=sl,Ee=!0,ke=h.length,Ze=[],Mt=y.length;if(!ke)return Ze;S&&(y=Qn(y,us(S))),N?(ce=za,Ee=!1):y.length>=_&&(ce=hc,Ee=!1,y=new _l(y));e:for(;++Q<ke;){var Lt=h[Q],Vt=S==null?Lt:S(Lt);if(Lt=N||Lt!==0?Lt:0,Ee&&Vt===Vt){for(var mi=Mt;mi--;)if(y[mi]===Vt)continue e;Ze.push(Lt)}else ce(y,Vt,N)||Ze.push(Lt)}return Ze}var H=x_(ge),ee=x_(Ae,!0);function se(h,y){var S=!0;return H(h,function(N,Q,ce){return S=!!y(N,Q,ce),S}),S}function re(h,y,S){for(var N=-1,Q=h.length;++N<Q;){var ce=h[N],Ee=y(ce);if(Ee!=null&&(ke===o?Ee===Ee&&!Ya(Ee):S(Ee,ke)))var ke=Ee,Ze=ce}return Ze}function oe(h,y,S,N){var Q=h.length;for(S=Rn(S),S<0&&(S=-S>Q?0:Q+S),N=N===o||N>Q?Q:Rn(N),N<0&&(N+=Q),N=S>N?0:Hd(N);S<N;)h[S++]=y;return h}function le(h,y){var S=[];return H(h,function(N,Q,ce){y(N,Q,ce)&&S.push(N)}),S}function J(h,y,S,N,Q){var ce=-1,Ee=h.length;for(S||(S=D_),Q||(Q=[]);++ce<Ee;){var ke=h[ce];y>0&&S(ke)?y>1?J(ke,y-1,S,N,Q):ta(Q,ke):N||(Q[Q.length]=ke)}return Q}var me=b_(),fe=b_(!0);function ge(h,y){return h&&me(h,y,fs)}function Ae(h,y){return h&&fe(h,y,fs)}function Te(h,y){return mo(y,function(S){return Lc(h[S])})}function De(h,y){y=Iu(y,h);for(var S=0,N=y.length;h!=null&&S<N;)h=h[Jl(y[S++])];return S&&S==N?h:o}function He(h,y,S){var N=y(h);return gn(h)?N:ta(N,S(h))}function We(h){return h==null?h===o?li:Si:sa&&sa in dr(h)?vl(h):_h(h)}function Qe(h,y){return h>y}function Ut(h,y){return h!=null&&Tn.call(h,y)}function Xe(h,y){return h!=null&&y in dr(h)}function pt(h,y,S){return h>=ws(y,S)&&h<ss(y,S)}function it(h,y,S){for(var N=S?za:sl,Q=h[0].length,ce=h.length,Ee=ce,ke=at(ce),Ze=1/0,Mt=[];Ee--;){var Lt=h[Ee];Ee&&y&&(Lt=Qn(Lt,us(y))),Ze=ws(Lt.length,Ze),ke[Ee]=!S&&(y||Q>=120&&Lt.length>=120)?new _l(Ee&&Lt):o}Lt=h[0];var Vt=-1,mi=ke[0];e:for(;++Vt<Q&&Mt.length<Ze;){var zi=Lt[Vt],an=y?y(zi):zi;if(zi=S||zi!==0?zi:0,!(mi?hc(mi,an):N(Mt,an,S))){for(Ee=ce;--Ee;){var Bn=ke[Ee];if(!(Bn?hc(Bn,an):N(h[Ee],an,S)))continue e}mi&&mi.push(an),Mt.push(zi)}}return Mt}function Ct(h,y,S,N){return ge(h,function(Q,ce,Ee){y(N,S(Q),ce,Ee)}),N}function Ye(h,y,S){y=Iu(y,h),h=Xa(h,y);var N=h==null?h:h[Jl(kr(y))];return N==null?o:Rs(N,h,S)}function Ge(h){return Kr(h)&&We(h)==ui}function tt(h){return Kr(h)&&We(h)==Jt}function bt(h){return Kr(h)&&We(h)==Vn}function At(h,y,S,N,Q){return h===y?!0:h==null||y==null||!Kr(h)&&!Kr(y)?h!==h&&y!==y:bi(h,y,S,N,At,Q)}function bi(h,y,S,N,Q,ce){var Ee=gn(h),ke=gn(y),Ze=Ee?Wi:Lo(h),Mt=ke?Wi:Lo(y);Ze=Ze==ui?Pi:Ze,Mt=Mt==ui?Pi:Mt;var Lt=Ze==Pi,Vt=Mt==Pi,mi=Ze==Mt;if(mi&&$c(h)){if(!$c(y))return!1;Ee=!0,Lt=!1}if(mi&&!Lt)return ce||(ce=new ga),Ee||Jh(h)?A_(h,y,S,N,Q,ce):Hp(h,y,Ze,S,N,Q,ce);if(!(S&W)){var zi=Lt&&Tn.call(h,"__wrapped__"),an=Vt&&Tn.call(y,"__wrapped__");if(zi||an){var Bn=zi?h.value():h,un=an?y.value():y;return ce||(ce=new ga),Q(Bn,un,S,N,ce)}}return mi?(ce||(ce=new ga),S_(h,y,S,N,Q,ce)):!1}function fn(h){return Kr(h)&&Lo(h)==$t}function di(h,y,S,N){var Q=S.length,ce=Q,Ee=!N;if(h==null)return!ce;for(h=dr(h);Q--;){var ke=S[Q];if(Ee&&ke[2]?ke[1]!==h[ke[0]]:!(ke[0]in h))return!1}for(;++Q<ce;){ke=S[Q];var Ze=ke[0],Mt=h[Ze],Lt=ke[1];if(Ee&&ke[2]){if(Mt===o&&!(Ze in h))return!1}else{var Vt=new ga;if(N)var mi=N(Mt,Lt,Ze,h,y,Vt);if(!(mi===o?At(Lt,Mt,W|te,N,Vt):mi))return!1}}return!0}function si(h){if(!Fr(h)||P_(h))return!1;var y=Lc(h)?mc:gi;return y.test(gh(h))}function Ti(h){return Kr(h)&&We(h)==Ji}function Mn(h){return Kr(h)&&Lo(h)==jn}function Li(h){return Kr(h)&&Du(h.length)&&!!Xn[We(h)]}function Jn(h){return typeof h=="function"?h:h==null?Ia:typeof h=="object"?gn(h)?ya(h[0],h[1]):Ao(h):Dm(h)}function or(h){if(!Jc(h))return pd(h);var y=[];for(var S in dr(h))Tn.call(h,S)&&S!="constructor"&&y.push(S);return y}function br(h){if(!Fr(h))return Mc(h);var y=Jc(h),S=[];for(var N in h)N=="constructor"&&(y||!Tn.call(h,N))||S.push(N);return S}function lr(h,y){return h<y}function os(h,y){var S=-1,N=Ta(h)?at(h.length):[];return H(h,function(Q,ce,Ee){N[++S]=y(Q,ce,Ee)}),N}function Ao(h){var y=ph(h);return y.length==1&&y[0][2]?Of(y[0][0],y[0][1]):function(S){return S===h||di(S,h,y)}}function ya(h,y){return Df(h)&&Pf(y)?Of(Jl(h),y):function(S){var N=bm(S,h);return N===o&&N===y?wm(S,h):At(y,N,W|te)}}function va(h,y,S,N,Q){h!==y&&me(y,function(ce,Ee){if(Q||(Q=new ga),Fr(ce))Rr(h,y,Ee,S,va,N,Q);else{var ke=N?N(Kp(h,Ee),ce,Ee+"",h,y,Q):o;ke===o&&(ke=ce),Nh(h,Ee,ke)}},oa)}function Rr(h,y,S,N,Q,ce,Ee){var ke=Kp(h,S),Ze=Kp(y,S),Mt=Ee.get(Ze);if(Mt){Nh(h,S,Mt);return}var Lt=ce?ce(ke,Ze,S+"",h,y,Ee):o,Vt=Lt===o;if(Vt){var mi=gn(Ze),zi=!mi&&$c(Ze),an=!mi&&!zi&&Jh(Ze);Lt=Ze,mi||zi||an?gn(ke)?Lt=ke:Ts(ke)?Lt=io(ke):zi?(Vt=!1,Lt=Id(Ze,!0)):an?(Vt=!1,Lt=y_(Ze,!0)):Lt=[]:Pu(Ze)||Lu(Ze)?(Lt=ke,Lu(ke)?Lt=vg(ke):(!Fr(ke)||Lc(ke))&&(Lt=Wp(Ze))):Vt=!1}Vt&&(Ee.set(Ze,Lt),Q(Lt,Ze,N,ce,Ee),Ee.delete(Ze)),Nh(h,S,Lt)}function fr(h,y){var S=h.length;if(S)return y+=y<0?S:0,Ic(y,S)?h[y]:o}function Hn(h,y,S){y.length?y=Qn(y,function(ce){return gn(ce)?function(Ee){return De(Ee,ce.length===1?ce[0]:ce)}:ce}):y=[Ia];var N=-1;y=Qn(y,us(Ki()));var Q=os(h,function(ce,Ee,ke){var Ze=Qn(y,function(Mt){return Mt(ce)});return{criteria:Ze,index:++N,value:ce}});return Ju(Q,function(ce,Ee){return Dy(ce,Ee,S)})}function Qr(h,y){return eo(h,y,function(S,N){return wm(h,N)})}function eo(h,y,S){for(var N=-1,Q=y.length,ce={};++N<Q;){var Ee=y[N],ke=De(h,Ee);S(ke,Ee)&&xa(ce,Iu(Ee,h),ke)}return ce}function Sr(h){return function(y){return De(y,h)}}function Ws(h,y,S,N){var Q=N?ol:$i,ce=-1,Ee=y.length,ke=h;for(h===y&&(y=io(y)),S&&(ke=Qn(h,us(S)));++ce<Ee;)for(var Ze=0,Mt=y[ce],Lt=S?S(Mt):Mt;(Ze=Q(ke,Lt,Ze,N))>-1;)ke!==h&&Bl.call(ke,Ze,1),Bl.call(h,Ze,1);return h}function to(h,y){for(var S=h?y.length:0,N=S-1;S--;){var Q=y[S];if(S==N||Q!==ce){var ce=Q;Ic(Q)?Bl.call(h,Q,1):wf(h,Q)}}return h}function gl(h,y){return h+_u(sh()*(y-h+1))}function Eu(h,y,S,N){for(var Q=-1,ce=ss(nh((y-h)/(S||1)),0),Ee=at(ce);ce--;)Ee[N?ce:++Q]=h,h+=S;return Ee}function So(h,y){var S="";if(!h||y<1||y>Gt)return S;do y%2&&(S+=h),y=_u(y/2),y&&(h+=h);while(y);return S}function rn(h,y){return Yp(Gh(h,y,Ia),h+"")}function Vl(h){return wd(Ru(h))}function Ec(h,y){var S=Ru(h);return Ac(S,w(y,0,S.length))}function xa(h,y,S,N){if(!Fr(h))return h;y=Iu(y,h);for(var Q=-1,ce=y.length,Ee=ce-1,ke=h;ke!=null&&++Q<ce;){var Ze=Jl(y[Q]),Mt=S;if(Ze==="__proto__"||Ze==="constructor"||Ze==="prototype")return h;if(Q!=Ee){var Lt=ke[Ze];Mt=N?N(Lt,Ze,ke):o,Mt===o&&(Mt=Fr(Lt)?Lt:Ic(y[Q+1])?[]:{})}bc(ke,Ze,Mt),ke=ke[Ze]}return h}var Zc=vu?function(h,y){return vu.set(h,y),h}:Ia,f_=gc?function(h,y){return gc(h,"toString",{configurable:!0,enumerable:!1,value:Xd(y),writable:!0})}:Ia;function Np(h){return Ac(Ru(h))}function Wa(h,y,S){var N=-1,Q=h.length;y<0&&(y=-y>Q?0:Q+y),S=S>Q?Q:S,S<0&&(S+=Q),Q=y>S?0:S-y>>>0,y>>>=0;for(var ce=at(Q);++N<Q;)ce[N]=h[N+y];return ce}function p_(h,y){var S;return H(h,function(N,Q,ce){return S=y(N,Q,ce),!S}),!!S}function Ed(h,y,S){var N=0,Q=h==null?N:h.length;if(typeof y=="number"&&y===y&&Q<=Dn){for(;N<Q;){var ce=N+Q>>>1,Ee=h[ce];Ee!==null&&!Ya(Ee)&&(S?Ee<=y:Ee<y)?N=ce+1:Q=ce}return Q}return bf(h,y,Ia,S)}function bf(h,y,S,N){var Q=0,ce=h==null?0:h.length;if(ce===0)return 0;y=S(y);for(var Ee=y!==y,ke=y===null,Ze=Ya(y),Mt=y===o;Q<ce;){var Lt=_u((Q+ce)/2),Vt=S(h[Lt]),mi=Vt!==o,zi=Vt===null,an=Vt===Vt,Bn=Ya(Vt);if(Ee)var un=N||an;else Mt?un=an&&(N||mi):ke?un=an&&mi&&(N||!zi):Ze?un=an&&mi&&!zi&&(N||!Bn):zi||Bn?un=!1:un=N?Vt<=y:Vt<y;un?Q=Lt+1:ce=Lt}return ws(ce,Ni)}function Up(h,y){for(var S=-1,N=h.length,Q=0,ce=[];++S<N;){var Ee=h[S],ke=y?y(Ee):Ee;if(!S||!$l(ke,Ze)){var Ze=ke;ce[Q++]=Ee===0?0:Ee}}return ce}function Vp(h){return typeof h=="number"?h:Ya(h)?Gi:+h}function ba(h){if(typeof h=="string")return h;if(gn(h))return Qn(h,ba)+"";if(Ya(h))return gd?gd.call(h):"";var y=h+"";return y=="0"&&1/h==-Vi?"-0":y}function Xc(h,y,S){var N=-1,Q=sl,ce=h.length,Ee=!0,ke=[],Ze=ke;if(S)Ee=!1,Q=za;else if(ce>=_){var Mt=y?null:Md(h);if(Mt)return Ve(Mt);Ee=!1,Q=hc,Ze=new _l}else Ze=y?[]:ke;e:for(;++N<ce;){var Lt=h[N],Vt=y?y(Lt):Lt;if(Lt=S||Lt!==0?Lt:0,Ee&&Vt===Vt){for(var mi=Ze.length;mi--;)if(Ze[mi]===Vt)continue e;y&&Ze.push(Vt),ke.push(Lt)}else Q(Ze,Vt,S)||(Ze!==ke&&Ze.push(Vt),ke.push(Lt))}return ke}function wf(h,y){return y=Iu(y,h),h=Xa(h,y),h==null||delete h[Jl(kr(y))]}function m_(h,y,S,N){return xa(h,y,S(De(h,y)),N)}function Ef(h,y,S,N){for(var Q=h.length,ce=N?Q:-1;(N?ce--:++ce<Q)&&y(h[ce],ce,h););return S?Wa(h,N?0:ce,N?ce+1:Q):Wa(h,N?ce+1:0,N?Q:ce)}function Tu(h,y){var S=h;return S instanceof en&&(S=S.value()),ac(y,function(N,Q){return Q.func.apply(Q.thisArg,ta([N],Q.args))},S)}function Gp(h,y,S){var N=h.length;if(N<2)return N?Xc(h[0]):[];for(var Q=-1,ce=at(N);++Q<N;)for(var Ee=h[Q],ke=-1;++ke<N;)ke!=Q&&(ce[Q]=F(ce[Q]||Ee,h[ke],y,S));return Xc(J(ce,1),y,S)}function Tf(h,y,S){for(var N=-1,Q=h.length,ce=y.length,Ee={};++N<Q;){var ke=N<ce?y[N]:o;S(Ee,h[N],ke)}return Ee}function Td(h){return Ts(h)?h:[]}function If(h){return typeof h=="function"?h:Ia}function Iu(h,y){return gn(h)?h:Df(h,y)?[h]:Jp(cr(h))}var Mf=rn;function Kc(h,y,S){var N=h.length;return S=S===o?N:S,!y&&S>=N?h:Wa(h,y,S)}var Af=ih||function(h){return Hr.clearTimeout(h)};function Id(h,y){if(y)return h.slice();var S=h.length,N=_c?_c(S):new h.constructor(S);return h.copy(N),N}function Gl(h){var y=new h.constructor(h.byteLength);return new ul(y).set(new ul(h)),y}function Sf(h,y){var S=y?Gl(h.buffer):h.buffer;return new h.constructor(S,h.byteOffset,h.byteLength)}function __(h){var y=new h.constructor(h.source,Xt.exec(h));return y.lastIndex=h.lastIndex,y}function g_(h){return Nl?dr(Nl.call(h)):{}}function y_(h,y){var S=y?Gl(h.buffer):h.buffer;return new h.constructor(S,h.byteOffset,h.length)}function v_(h,y){if(h!==y){var S=h!==o,N=h===null,Q=h===h,ce=Ya(h),Ee=y!==o,ke=y===null,Ze=y===y,Mt=Ya(y);if(!ke&&!Mt&&!ce&&h>y||ce&&Ee&&Ze&&!ke&&!Mt||N&&Ee&&Ze||!S&&Ze||!Q)return 1;if(!N&&!ce&&!Mt&&h<y||Mt&&S&&Q&&!N&&!ce||ke&&S&&Q||!Ee&&Q||!Ze)return-1}return 0}function Dy(h,y,S){for(var N=-1,Q=h.criteria,ce=y.criteria,Ee=Q.length,ke=S.length;++N<Ee;){var Ze=v_(Q[N],ce[N]);if(Ze){if(N>=ke)return Ze;var Mt=S[N];return Ze*(Mt=="desc"?-1:1)}}return h.index-y.index}function Cf(h,y,S,N){for(var Q=-1,ce=h.length,Ee=S.length,ke=-1,Ze=y.length,Mt=ss(ce-Ee,0),Lt=at(Ze+Mt),Vt=!N;++ke<Ze;)Lt[ke]=y[ke];for(;++Q<Ee;)(Vt||Q<ce)&&(Lt[S[Q]]=h[Q]);for(;Mt--;)Lt[ke++]=h[Q++];return Lt}function Uh(h,y,S,N){for(var Q=-1,ce=h.length,Ee=-1,ke=S.length,Ze=-1,Mt=y.length,Lt=ss(ce-ke,0),Vt=at(Lt+Mt),mi=!N;++Q<Lt;)Vt[Q]=h[Q];for(var zi=Q;++Ze<Mt;)Vt[zi+Ze]=y[Ze];for(;++Ee<ke;)(mi||Q<ce)&&(Vt[zi+S[Ee]]=h[Q++]);return Vt}function io(h,y){var S=-1,N=h.length;for(y||(y=at(N));++S<N;)y[S]=h[S];return y}function go(h,y,S,N){var Q=!S;S||(S={});for(var ce=-1,Ee=y.length;++ce<Ee;){var ke=y[ce],Ze=N?N(S[ke],h[ke],ke,S,h):o;Ze===o&&(Ze=h[ke]),Q?m(S,ke,Ze):bc(S,ke,Ze)}return S}function jl(h,y){return go(h,Ld(h),y)}function Mu(h,y){return go(h,$r(h),y)}function ql(h,y){return function(S,N){var Q=gn(S)?fu:f,ce=y?y():{};return Q(S,h,Ki(N,2),ce)}}function yl(h){return rn(function(y,S){var N=-1,Q=S.length,ce=Q>1?S[Q-1]:o,Ee=Q>2?S[2]:o;for(ce=h.length>3&&typeof ce=="function"?(Q--,ce):o,Ee&&Uo(S[0],S[1],Ee)&&(ce=Q<3?o:ce,Q=1),y=dr(y);++N<Q;){var ke=S[N];ke&&h(y,ke,N,ce)}return y})}function x_(h,y){return function(S,N){if(S==null)return S;if(!Ta(S))return h(S,N);for(var Q=S.length,ce=y?Q:-1,Ee=dr(S);(y?ce--:++ce<Q)&&N(Ee[ce],ce,Ee)!==!1;);return S}}function b_(h){return function(y,S,N){for(var Q=-1,ce=dr(y),Ee=N(y),ke=Ee.length;ke--;){var Ze=Ee[h?ke:++Q];if(S(ce[Ze],Ze,ce)===!1)break}return y}}function Py(h,y,S){var N=y&ae,Q=Au(h);function ce(){var Ee=this&&this!==Hr&&this instanceof ce?Q:h;return Ee.apply(N?S:this,arguments)}return ce}function w_(h){return function(y){y=cr(y);var S=Ga(y)?cn(y):o,N=S?S[0]:y.charAt(0),Q=S?Kc(S,1).join(""):y.slice(1);return N[h]()+Q}}function fh(h){return function(y){return ac(Gg(Am(y).replace(kc,"")),h,"")}}function Au(h){return function(){var y=arguments;switch(y.length){case 0:return new h;case 1:return new h(y[0]);case 2:return new h(y[0],y[1]);case 3:return new h(y[0],y[1],y[2]);case 4:return new h(y[0],y[1],y[2],y[3]);case 5:return new h(y[0],y[1],y[2],y[3],y[4]);case 6:return new h(y[0],y[1],y[2],y[3],y[4],y[5]);case 7:return new h(y[0],y[1],y[2],y[3],y[4],y[5],y[6])}var S=vc(h.prototype),N=h.apply(S,y);return Fr(N)?N:S}}function Hl(h,y,S){var N=Au(h);function Q(){for(var ce=arguments.length,Ee=at(ce),ke=ce,Ze=Tc(Q);ke--;)Ee[ke]=arguments[ke];var Mt=ce<3&&Ee[0]!==Ze&&Ee[ce-1]!==Ze?[]:ll(Ee,Ze);if(ce-=Mt.length,ce<S)return Lf(h,y,Zr,Q.placeholder,o,Ee,Mt,o,o,S-ce);var Lt=this&&this!==Hr&&this instanceof Q?N:h;return Rs(Lt,this,Ee)}return Q}function E_(h){return function(y,S,N){var Q=dr(y);if(!Ta(y)){var ce=Ki(S,3);y=fs(y),S=function(ke){return ce(Q[ke],ke,Q)}}var Ee=h(y,S,N);return Ee>-1?Q[ce?y[Ee]:Ee]:o}}function T_(h){return Za(function(y){var S=y.length,N=S,Q=Mo.prototype.thru;for(h&&y.reverse();N--;){var ce=y[N];if(typeof ce!="function")throw new En(E);if(Q&&!Ee&&Cd(ce)=="wrapper")var Ee=new Mo([],!0)}for(N=Ee?N:S;++N<S;){ce=y[N];var ke=Cd(ce),Ze=ke=="wrapper"?Sd(ce):o;Ze&&Zp(Ze[0])&&Ze[1]==(lt|Ue|_e|St)&&!Ze[4].length&&Ze[9]==1?Ee=Ee[Cd(Ze[0])].apply(Ee,Ze[3]):Ee=ce.length==1&&Zp(ce)?Ee[ke]():Ee.thru(ce)}return function(){var Mt=arguments,Lt=Mt[0];if(Ee&&Mt.length==1&&gn(Lt))return Ee.plant(Lt).value();for(var Vt=0,mi=S?y[Vt].apply(this,Mt):Lt;++Vt<S;)mi=y[Vt].call(this,mi);return mi}})}function Zr(h,y,S,N,Q,ce,Ee,ke,Ze,Mt){var Lt=y&lt,Vt=y&ae,mi=y&Ie,zi=y&(Ue|je),an=y&Bt,Bn=mi?o:Au(h);function un(){for(var Kn=arguments.length,er=at(Kn),Ma=Kn;Ma--;)er[Ma]=arguments[Ma];if(zi)var Go=Tc(un),Aa=na(er,Go);if(N&&(er=Cf(er,N,Q,zi)),ce&&(er=Uh(er,ce,Ee,zi)),Kn-=Aa,zi&&Kn<Mt){var Is=ll(er,Go);return Lf(h,y,Zr,un.placeholder,S,er,Is,ke,Ze,Mt-Kn)}var wl=Vt?S:this,jo=mi?wl[h]:h;return Kn=er.length,ke?er=xl(er,ke):an&&Kn>1&&er.reverse(),Lt&&Ze<Kn&&(er.length=Ze),this&&this!==Hr&&this instanceof un&&(jo=Bn||Au(jo)),jo.apply(wl,er)}return un}function Fi(h,y){return function(S,N){return Ct(S,h,y(N),{})}}function Wl(h,y){return function(S,N){var Q;if(S===o&&N===o)return y;if(S!==o&&(Q=S),N!==o){if(Q===o)return N;typeof S=="string"||typeof N=="string"?(S=ba(S),N=ba(N)):(S=Vp(S),N=Vp(N)),Q=h(S,N)}return Q}}function Vh(h){return Za(function(y){return y=Qn(y,us(Ki())),rn(function(S){var N=this;return h(y,function(Q){return Rs(Q,N,S)})})})}function Co(h,y){y=y===o?" ":ba(y);var S=y.length;if(S<2)return S?So(y,h):y;var N=So(y,nh(h/$n(y)));return Ga(y)?Kc(cn(N),0,h).join(""):N.slice(0,h)}function I_(h,y,S,N){var Q=y&ae,ce=Au(h);function Ee(){for(var ke=-1,Ze=arguments.length,Mt=-1,Lt=N.length,Vt=at(Lt+Ze),mi=this&&this!==Hr&&this instanceof Ee?ce:h;++Mt<Lt;)Vt[Mt]=N[Mt];for(;Ze--;)Vt[Mt++]=arguments[++ke];return Rs(mi,Q?S:this,Vt)}return Ee}function jp(h){return function(y,S,N){return N&&typeof N!="number"&&Uo(y,S,N)&&(S=N=o),y=vo(y),S===o?(S=y,y=0):S=vo(S),N=N===o?y<S?1:-1:vo(N),Eu(y,S,N,h)}}function wa(h){return function(y,S){return typeof y=="string"&&typeof S=="string"||(y=Po(y),S=Po(S)),h(y,S)}}function Lf(h,y,S,N,Q,ce,Ee,ke,Ze,Mt){var Lt=y&Ue,Vt=Lt?Ee:o,mi=Lt?o:Ee,zi=Lt?ce:o,an=Lt?o:ce;y|=Lt?_e:ct,y&=~(Lt?ct:_e),y&ye||(y&=~(ae|Ie));var Bn=[h,y,Q,zi,Vt,an,mi,ke,Ze,Mt],un=S.apply(o,Bn);return Zp(h)&&Pd(un,Bn),un.placeholder=N,Rf(un,h,y)}function Yc(h){var y=Wr[h];return function(S,N){if(S=Po(S),N=N==null?0:ws(Rn(N),292),N&&fd(S)){var Q=(cr(S)+"e").split("e"),ce=y(Q[0]+"e"+(+Q[1]+N));return Q=(cr(ce)+"e").split("e"),+(Q[0]+"e"+(+Q[1]-N))}return y(S)}}var Md=Fl&&1/Ve(new Fl([,-0]))[1]==Vi?function(h){return new Fl(h)}:Lm;function Su(h){return function(y){var S=Lo(y);return S==$t?ja(y):S==jn?ut(y):pu(y,h(y))}}function Zl(h,y,S,N,Q,ce,Ee,ke){var Ze=y&Ie;if(!Ze&&typeof h!="function")throw new En(E);var Mt=N?N.length:0;if(Mt||(y&=~(_e|ct),N=Q=o),Ee=Ee===o?Ee:ss(Rn(Ee),0),ke=ke===o?ke:Rn(ke),Mt-=Q?Q.length:0,y&ct){var Lt=N,Vt=Q;N=Q=o}var mi=Ze?o:Sd(h),zi=[h,y,S,N,Q,Lt,Vt,ce,Ee,ke];if(mi&&Vo(zi,mi),h=zi[0],y=zi[1],S=zi[2],N=zi[3],Q=zi[4],ke=zi[9]=zi[9]===o?Ze?0:h.length:ss(zi[9]-Mt,0),!ke&&y&(Ue|je)&&(y&=~(Ue|je)),!y||y==ae)var an=Py(h,y,S);else y==Ue||y==je?an=Hl(h,y,ke):(y==_e||y==(ae|_e))&&!Q.length?an=I_(h,y,S,N):an=Zr.apply(o,zi);var Bn=mi?Zc:Pd;return Rf(Bn(an,zi),h,y)}function Ad(h,y,S,N){return h===o||$l(h,Eo[S])&&!Tn.call(N,S)?y:h}function qp(h,y,S,N,Q,ce){return Fr(h)&&Fr(y)&&(ce.set(y,h),va(h,y,o,qp,ce),ce.delete(y)),h}function M_(h){return Pu(h)?o:h}function A_(h,y,S,N,Q,ce){var Ee=S&W,ke=h.length,Ze=y.length;if(ke!=Ze&&!(Ee&&Ze>ke))return!1;var Mt=ce.get(h),Lt=ce.get(y);if(Mt&&Lt)return Mt==y&&Lt==h;var Vt=-1,mi=!0,zi=S&te?new _l:o;for(ce.set(h,y),ce.set(y,h);++Vt<ke;){var an=h[Vt],Bn=y[Vt];if(N)var un=Ee?N(Bn,an,Vt,y,h,ce):N(an,Bn,Vt,h,y,ce);if(un!==o){if(un)continue;mi=!1;break}if(zi){if(!lc(y,function(Kn,er){if(!hc(zi,er)&&(an===Kn||Q(an,Kn,S,N,ce)))return zi.push(er)})){mi=!1;break}}else if(!(an===Bn||Q(an,Bn,S,N,ce))){mi=!1;break}}return ce.delete(h),ce.delete(y),mi}function Hp(h,y,S,N,Q,ce,Ee){switch(S){case nn:if(h.byteLength!=y.byteLength||h.byteOffset!=y.byteOffset)return!1;h=h.buffer,y=y.buffer;case Jt:return!(h.byteLength!=y.byteLength||!ce(new ul(h),new ul(y)));case Wt:case Vn:case gt:return $l(+h,+y);case wt:return h.name==y.name&&h.message==y.message;case Ji:case sr:return h==y+"";case $t:var ke=ja;case jn:var Ze=N&W;if(ke||(ke=Ve),h.size!=y.size&&!Ze)return!1;var Mt=Ee.get(h);if(Mt)return Mt==y;N|=te,Ee.set(h,y);var Lt=A_(ke(h),ke(y),N,Q,ce,Ee);return Ee.delete(h),Lt;case Be:if(Nl)return Nl.call(h)==Nl.call(y)}return!1}function S_(h,y,S,N,Q,ce){var Ee=S&W,ke=Cu(h),Ze=ke.length,Mt=Cu(y),Lt=Mt.length;if(Ze!=Lt&&!Ee)return!1;for(var Vt=Ze;Vt--;){var mi=ke[Vt];if(!(Ee?mi in y:Tn.call(y,mi)))return!1}var zi=ce.get(h),an=ce.get(y);if(zi&&an)return zi==y&&an==h;var Bn=!0;ce.set(h,y),ce.set(y,h);for(var un=Ee;++Vt<Ze;){mi=ke[Vt];var Kn=h[mi],er=y[mi];if(N)var Ma=Ee?N(er,Kn,mi,y,h,ce):N(Kn,er,mi,h,y,ce);if(!(Ma===o?Kn===er||Q(Kn,er,S,N,ce):Ma)){Bn=!1;break}un||(un=mi=="constructor")}if(Bn&&!un){var Go=h.constructor,Aa=y.constructor;Go!=Aa&&"constructor"in h&&"constructor"in y&&!(typeof Go=="function"&&Go instanceof Go&&typeof Aa=="function"&&Aa instanceof Aa)&&(Bn=!1)}return ce.delete(h),ce.delete(y),Bn}function Za(h){return Yp(Gh(h,o,F_),h+"")}function Cu(h){return He(h,fs,Ld)}function Xl(h){return He(h,oa,$r)}var Sd=vu?function(h){return vu.get(h)}:Lm;function Cd(h){for(var y=h.name+"",S=Hc[y],N=Tn.call(Hc,y)?S.length:0;N--;){var Q=S[N],ce=Q.func;if(ce==null||ce==h)return Q.name}return y}function Tc(h){var y=Tn.call(ne,"placeholder")?ne:h;return y.placeholder}function Ki(){var h=ne.iteratee||Dc;return h=h===Dc?Jn:h,arguments.length?h(arguments[0],arguments[1]):h}function No(h,y){var S=h.__data__;return Ry(y)?S[typeof y=="string"?"string":"hash"]:S.map}function ph(h){for(var y=fs(h),S=y.length;S--;){var N=y[S],Q=h[N];y[S]=[N,Q,Pf(Q)]}return y}function Es(h,y){var S=Fo(h,y);return si(S)?S:o}function vl(h){var y=Tn.call(h,sa),S=h[sa];try{h[sa]=o;var N=!0}catch{}var Q=on.call(h);return N&&(y?h[sa]=S:delete h[sa]),Q}var Ld=qc?function(h){return h==null?[]:(h=dr(h),mo(qc(h),function(y){return jc.call(h,y)}))}:Pm,$r=qc?function(h){for(var y=[];h;)ta(y,Ld(h)),h=hl(h);return y}:Pm,Lo=We;(Rh&&Lo(new Rh(new ArrayBuffer(1)))!=nn||yc&&Lo(new yc)!=$t||oh&&Lo(oh.resolve())!=Pr||Fl&&Lo(new Fl)!=jn||yu&&Lo(new yu)!=qi)&&(Lo=function(h){var y=We(h),S=y==Pi?h.constructor:o,N=S?gh(S):"";if(N)switch(N){case kh:return nn;case uf:return $t;case md:return Pr;case _d:return jn;case xu:return qi}return y});function Dd(h,y,S){for(var N=-1,Q=S.length;++N<Q;){var ce=S[N],Ee=ce.size;switch(ce.type){case"drop":h+=Ee;break;case"dropRight":y-=Ee;break;case"take":y=ws(y,h+Ee);break;case"takeRight":h=ss(h,y-Ee);break}}return{start:h,end:y}}function Kl(h){var y=h.match(Ce);return y?y[1].split(qe):[]}function C_(h,y,S){y=Iu(y,h);for(var N=-1,Q=y.length,ce=!1;++N<Q;){var Ee=Jl(y[N]);if(!(ce=h!=null&&S(h,Ee)))break;h=h[Ee]}return ce||++N!=Q?ce:(Q=h==null?0:h.length,!!Q&&Du(Q)&&Ic(Ee,Q)&&(gn(h)||Lu(h)))}function Oy(h){var y=h.length,S=new h.constructor(y);return y&&typeof h[0]=="string"&&Tn.call(h,"index")&&(S.index=h.index,S.input=h.input),S}function Wp(h){return typeof h.constructor=="function"&&!Jc(h)?vc(hl(h)):{}}function L_(h,y,S){var N=h.constructor;switch(y){case Jt:return Gl(h);case Wt:case Vn:return new N(+h);case nn:return Sf(h,S);case vs:case yt:case fi:case xi:case yn:case ls:case js:case Xo:case bo:return y_(h,S);case $t:return new N;case gt:case sr:return new N(h);case Ji:return __(h);case jn:return new N;case Be:return g_(h)}}function mh(h,y){var S=y.length;if(!S)return h;var N=S-1;return y[N]=(S>1?"& ":"")+y[N],y=y.join(S>2?", ":" "),h.replace(ve,`{
/* [wrapped with `+y+`] */
`)}function D_(h){return gn(h)||Lu(h)||!!(th&&h&&h[th])}function Ic(h,y){var S=typeof h;return y=y??Gt,!!y&&(S=="number"||S!="symbol"&&Le.test(h))&&h>-1&&h%1==0&&h<y}function Uo(h,y,S){if(!Fr(S))return!1;var N=typeof y;return(N=="number"?Ta(S)&&Ic(y,S.length):N=="string"&&y in S)?$l(S[y],h):!1}function Df(h,y){if(gn(h))return!1;var S=typeof h;return S=="number"||S=="symbol"||S=="boolean"||h==null||Ya(h)?!0:Ps.test(h)||!ha.test(h)||y!=null&&h in dr(y)}function Ry(h){var y=typeof h;return y=="string"||y=="number"||y=="symbol"||y=="boolean"?h!=="__proto__":h===null}function Zp(h){var y=Cd(h),S=ne[y];if(typeof S!="function"||!(y in en.prototype))return!1;if(h===S)return!0;var N=Sd(S);return!!N&&h===N[0]}function P_(h){return!!cl&&cl in h}var O_=ds?Lc:fp;function Jc(h){var y=h&&h.constructor,S=typeof y=="function"&&y.prototype||Eo;return h===S}function Pf(h){return h===h&&!Fr(h)}function Of(h,y){return function(S){return S==null?!1:S[h]===y&&(y!==o||h in dr(S))}}function Xp(h){var y=Yf(h,function(N){return S.size===R&&S.clear(),N}),S=y.cache;return y}function Vo(h,y){var S=h[1],N=y[1],Q=S|N,ce=Q<(ae|Ie|lt),Ee=N==lt&&S==Ue||N==lt&&S==St&&h[7].length<=y[8]||N==(lt|St)&&y[7].length<=y[8]&&S==Ue;if(!(ce||Ee))return h;N&ae&&(h[2]=y[2],Q|=S&ae?0:ye);var ke=y[3];if(ke){var Ze=h[3];h[3]=Ze?Cf(Ze,ke,y[4]):ke,h[4]=Ze?ll(h[3],U):y[4]}return ke=y[5],ke&&(Ze=h[5],h[5]=Ze?Uh(Ze,ke,y[6]):ke,h[6]=Ze?ll(h[5],U):y[6]),ke=y[7],ke&&(h[7]=ke),N&lt&&(h[8]=h[8]==null?y[8]:ws(h[8],y[8])),h[9]==null&&(h[9]=y[9]),h[0]=y[0],h[1]=Q,h}function Mc(h){var y=[];if(h!=null)for(var S in dr(h))y.push(S);return y}function _h(h){return on.call(h)}function Gh(h,y,S){return y=ss(y===o?h.length-1:y,0),function(){for(var N=arguments,Q=-1,ce=ss(N.length-y,0),Ee=at(ce);++Q<ce;)Ee[Q]=N[y+Q];Q=-1;for(var ke=at(y+1);++Q<y;)ke[Q]=N[Q];return ke[y]=S(Ee),Rs(h,this,ke)}}function Xa(h,y){return y.length<2?h:De(h,Wa(y,0,-1))}function xl(h,y){for(var S=h.length,N=ws(y.length,S),Q=io(h);N--;){var ce=y[N];h[N]=Ic(ce,S)?Q[ce]:o}return h}function Kp(h,y){if(!(y==="constructor"&&typeof h[y]=="function")&&y!="__proto__")return h[y]}var Pd=Yl(Zc),jh=_a||function(h,y){return Hr.setTimeout(h,y)},Yp=Yl(f_);function Rf(h,y,S){var N=y+"";return Yp(h,mh(N,kf(Kl(N),S)))}function Yl(h){var y=0,S=0;return function(){var N=rh(),Q=qt-(N-S);if(S=N,Q>0){if(++y>=Nt)return arguments[0]}else y=0;return h.apply(o,arguments)}}function Ac(h,y){var S=-1,N=h.length,Q=N-1;for(y=y===o?N:y;++S<y;){var ce=gl(S,Q),Ee=h[ce];h[ce]=h[S],h[S]=Ee}return h.length=y,h}var Jp=Xp(function(h){var y=[];return h.charCodeAt(0)===46&&y.push(""),h.replace(da,function(S,N,Q,ce){y.push(Q?ce.replace(Ke,"$1"):N||S)}),y});function Jl(h){if(typeof h=="string"||Ya(h))return h;var y=h+"";return y=="0"&&1/h==-Vi?"-0":y}function gh(h){if(h!=null){try{return zs.call(h)}catch{}try{return h+""}catch{}}return""}function kf(h,y){return po(bn,function(S){var N="_."+S[0];y&S[1]&&!sl(h,N)&&h.push(N)}),h.sort()}function zf(h){if(h instanceof en)return h.clone();var y=new Mo(h.__wrapped__,h.__chain__);return y.__actions__=io(h.__actions__),y.__index__=h.__index__,y.__values__=h.__values__,y}function qh(h,y,S){(S?Uo(h,y,S):y===o)?y=1:y=ss(Rn(y),0);var N=h==null?0:h.length;if(!N||y<1)return[];for(var Q=0,ce=0,Ee=at(nh(N/y));Q<N;)Ee[ce++]=Wa(h,Q,Q+=y);return Ee}function Hh(h){for(var y=-1,S=h==null?0:h.length,N=0,Q=[];++y<S;){var ce=h[y];ce&&(Q[N++]=ce)}return Q}function Od(){var h=arguments.length;if(!h)return[];for(var y=at(h-1),S=arguments[0],N=h;N--;)y[N-1]=arguments[N];return ta(gn(S)?io(S):[S],J(y,1))}var Bf=rn(function(h,y){return Ts(h)?F(h,J(y,1,Ts,!0)):[]}),R_=rn(function(h,y){var S=kr(y);return Ts(S)&&(S=o),Ts(h)?F(h,J(y,1,Ts,!0),Ki(S,2)):[]}),Rd=rn(function(h,y){var S=kr(y);return Ts(S)&&(S=o),Ts(h)?F(h,J(y,1,Ts,!0),o,S):[]});function Qp(h,y,S){var N=h==null?0:h.length;return N?(y=S||y===o?1:Rn(y),Wa(h,y<0?0:y,N)):[]}function k_(h,y,S){var N=h==null?0:h.length;return N?(y=S||y===o?1:Rn(y),y=N-y,Wa(h,0,y<0?0:y)):[]}function Wh(h,y){return h&&h.length?Ef(h,Ki(y,3),!0,!0):[]}function z_(h,y){return h&&h.length?Ef(h,Ki(y,3),!0):[]}function $p(h,y,S,N){var Q=h==null?0:h.length;return Q?(S&&typeof S!="number"&&Uo(h,y,S)&&(S=0,N=Q),oe(h,y,S,N)):[]}function em(h,y,S){var N=h==null?0:h.length;if(!N)return-1;var Q=S==null?0:Rn(S);return Q<0&&(Q=ss(N+Q,0)),_o(h,Ki(y,3),Q)}function B_(h,y,S){var N=h==null?0:h.length;if(!N)return-1;var Q=N-1;return S!==o&&(Q=Rn(S),Q=S<0?ss(N+Q,0):ws(Q,N-1)),_o(h,Ki(y,3),Q,!0)}function F_(h){var y=h==null?0:h.length;return y?J(h,1):[]}function kd(h){var y=h==null?0:h.length;return y?J(h,Vi):[]}function N_(h,y){var S=h==null?0:h.length;return S?(y=y===o?1:Rn(y),J(h,y)):[]}function Wn(h){for(var y=-1,S=h==null?0:h.length,N={};++y<S;){var Q=h[y];N[Q[0]]=Q[1]}return N}function Ff(h){return h&&h.length?h[0]:o}function Sc(h,y,S){var N=h==null?0:h.length;if(!N)return-1;var Q=S==null?0:Rn(S);return Q<0&&(Q=ss(N+Q,0)),$i(h,y,Q)}function Cc(h){var y=h==null?0:h.length;return y?Wa(h,0,-1):[]}var Ql=rn(function(h){var y=Qn(h,Td);return y.length&&y[0]===h[0]?it(y):[]}),Ka=rn(function(h){var y=kr(h),S=Qn(h,Td);return y===kr(S)?y=o:S.pop(),S.length&&S[0]===h[0]?it(S,Ki(y,2)):[]}),yo=rn(function(h){var y=kr(h),S=Qn(h,Td);return y=typeof y=="function"?y:o,y&&S.pop(),S.length&&S[0]===h[0]?it(S,o,y):[]});function U_(h,y){return h==null?"":Oh.call(h,y)}function kr(h){var y=h==null?0:h.length;return y?h[y-1]:o}function V_(h,y,S){var N=h==null?0:h.length;if(!N)return-1;var Q=N;return S!==o&&(Q=Rn(S),Q=Q<0?ss(N+Q,0):ws(Q,N-1)),y===y?Ri(h,y,Q):_o(h,fa,Q,!0)}function Zh(h,y){return h&&h.length?fr(h,Rn(y)):o}var tm=rn(im);function im(h,y){return h&&h.length&&y&&y.length?Ws(h,y):h}function nm(h,y,S){return h&&h.length&&y&&y.length?Ws(h,y,Ki(S,2)):h}function ky(h,y,S){return h&&h.length&&y&&y.length?Ws(h,y,o,S):h}var rm=Za(function(h,y){var S=h==null?0:h.length,N=x(h,y);return to(h,Qn(y,function(Q){return Ic(Q,S)?+Q:Q}).sort(v_)),N});function G_(h,y){var S=[];if(!(h&&h.length))return S;var N=-1,Q=[],ce=h.length;for(y=Ki(y,3);++N<ce;){var Ee=h[N];y(Ee,N,h)&&(S.push(Ee),Q.push(N))}return to(h,Q),S}function sm(h){return h==null?h:zp.call(h)}function Qc(h,y,S){var N=h==null?0:h.length;return N?(S&&typeof S!="number"&&Uo(h,y,S)?(y=0,S=N):(y=y==null?0:Rn(y),S=S===o?N:Rn(S)),Wa(h,y,S)):[]}function yh(h,y){return Ed(h,y)}function Nf(h,y,S){return bf(h,y,Ki(S,2))}function Uf(h,y){var S=h==null?0:h.length;if(S){var N=Ed(h,y);if(N<S&&$l(h[N],y))return N}return-1}function om(h,y){return Ed(h,y,!0)}function j_(h,y,S){return bf(h,y,Ki(S,2),!0)}function zy(h,y){var S=h==null?0:h.length;if(S){var N=Ed(h,y,!0)-1;if($l(h[N],y))return N}return-1}function q_(h){return h&&h.length?Up(h):[]}function By(h,y){return h&&h.length?Up(h,Ki(y,2)):[]}function am(h){var y=h==null?0:h.length;return y?Wa(h,1,y):[]}function Fy(h,y,S){return h&&h.length?(y=S||y===o?1:Rn(y),Wa(h,0,y<0?0:y)):[]}function lm(h,y,S){var N=h==null?0:h.length;return N?(y=S||y===o?1:Rn(y),y=N-y,Wa(h,y<0?0:y,N)):[]}function H_(h,y){return h&&h.length?Ef(h,Ki(y,3),!1,!0):[]}function W_(h,y){return h&&h.length?Ef(h,Ki(y,3)):[]}var vh=rn(function(h){return Xc(J(h,1,Ts,!0))}),Z_=rn(function(h){var y=kr(h);return Ts(y)&&(y=o),Xc(J(h,1,Ts,!0),Ki(y,2))}),Ny=rn(function(h){var y=kr(h);return y=typeof y=="function"?y:o,Xc(J(h,1,Ts,!0),o,y)});function Xh(h){return h&&h.length?Xc(h):[]}function Vf(h,y){return h&&h.length?Xc(h,Ki(y,2)):[]}function X_(h,y){return y=typeof y=="function"?y:o,h&&h.length?Xc(h,o,y):[]}function Gf(h){if(!(h&&h.length))return[];var y=0;return h=mo(h,function(S){if(Ts(S))return y=ss(S.length,y),!0}),cc(y,function(S){return Qn(h,al(S))})}function K_(h,y){if(!(h&&h.length))return[];var S=Gf(h);return y==null?S:Qn(S,function(N){return Rs(y,o,N)})}var Uy=rn(function(h,y){return Ts(h)?F(h,y):[]}),Y_=rn(function(h){return Gp(mo(h,Ts))}),Vy=rn(function(h){var y=kr(h);return Ts(y)&&(y=o),Gp(mo(h,Ts),Ki(y,2))}),J_=rn(function(h){var y=kr(h);return y=typeof y=="function"?y:o,Gp(mo(h,Ts),o,y)}),Gy=rn(Gf);function jy(h,y){return Tf(h||[],y||[],bc)}function Q_(h,y){return Tf(h||[],y||[],xa)}var $_=rn(function(h){var y=h.length,S=y>1?h[y-1]:o;return S=typeof S=="function"?(h.pop(),S):o,K_(h,S)});function cm(h){var y=ne(h);return y.__chain__=!0,y}function um(h,y){return y(h),h}function bl(h,y){return y(h)}var Ea=Za(function(h){var y=h.length,S=y?h[0]:0,N=this.__wrapped__,Q=function(ce){return x(ce,h)};return y>1||this.__actions__.length||!(N instanceof en)||!Ic(S)?this.thru(Q):(N=N.slice(S,+S+(y?1:0)),N.__actions__.push({func:bl,args:[Q],thisArg:o}),new Mo(N,this.__chain__).thru(function(ce){return y&&!ce.length&&ce.push(o),ce}))});function qy(){return cm(this)}function hm(){return new Mo(this.value(),this.__chain__)}function Hy(){this.__values__===o&&(this.__values__=no(this.value()));var h=this.__index__>=this.__values__.length,y=h?o:this.__values__[this.__index__++];return{done:h,value:y}}function Wy(){return this}function Zy(h){for(var y,S=this;S instanceof ah;){var N=zf(S);N.__index__=0,N.__values__=o,y?Q.__wrapped__=N:y=N;var Q=N;S=S.__wrapped__}return Q.__wrapped__=h,y}function Kh(){var h=this.__wrapped__;if(h instanceof en){var y=h;return this.__actions__.length&&(y=new en(this)),y=y.reverse(),y.__actions__.push({func:bl,args:[sm],thisArg:o}),new Mo(y,this.__chain__)}return this.thru(sm)}function jf(){return Tu(this.__wrapped__,this.__actions__)}var eg=ql(function(h,y,S){Tn.call(h,S)?++h[S]:m(h,S,1)});function xh(h,y,S){var N=gn(h)?On:se;return S&&Uo(h,y,S)&&(y=o),N(h,Ki(y,3))}function zd(h,y){var S=gn(h)?mo:le;return S(h,Ki(y,3))}var Xy=E_(em),Ky=E_(B_);function Yy(h,y){return J(Xr(h,y),1)}function Jy(h,y){return J(Xr(h,y),Vi)}function Qy(h,y,S){return S=S===o?1:Rn(S),J(Xr(h,y),S)}function tg(h,y){var S=gn(h)?po:H;return S(h,Ki(y,3))}function ig(h,y){var S=gn(h)?ka:ee;return S(h,Ki(y,3))}var dm=ql(function(h,y,S){Tn.call(h,S)?h[S].push(y):m(h,S,[y])});function $y(h,y,S,N){h=Ta(h)?h:Ru(h),S=S&&!N?Rn(S):0;var Q=h.length;return S<0&&(S=ss(Q+S,0)),qd(h)?S<=Q&&h.indexOf(y,S)>-1:!!Q&&$i(h,y,S)>-1}var Yh=rn(function(h,y,S){var N=-1,Q=typeof y=="function",ce=Ta(h)?at(h.length):[];return H(h,function(Ee){ce[++N]=Q?Rs(y,Ee,S):Ye(Ee,y,S)}),ce}),e0=ql(function(h,y,S){m(h,S,y)});function Xr(h,y){var S=gn(h)?Qn:os;return S(h,Ki(y,3))}function qf(h,y,S,N){return h==null?[]:(gn(y)||(y=y==null?[]:[y]),S=N?o:S,gn(S)||(S=S==null?[]:[S]),Hn(h,y,S))}var ng=ql(function(h,y,S){h[S?0:1].push(y)},function(){return[[],[]]});function Hf(h,y,S){var N=gn(h)?ac:Uc,Q=arguments.length<3;return N(h,Ki(y,4),S,Q,H)}function Wf(h,y,S){var N=gn(h)?Xu:Uc,Q=arguments.length<3;return N(h,Ki(y,4),S,Q,ee)}function Bd(h,y){var S=gn(h)?mo:le;return S(h,Jf(Ki(y,3)))}function rg(h){var y=gn(h)?wd:Vl;return y(h)}function sg(h,y,S){(S?Uo(h,y,S):y===o)?y=1:y=Rn(y);var N=gn(h)?vf:Ec;return N(h,y)}function Fd(h){var y=gn(h)?xf:Np;return y(h)}function fm(h){if(h==null)return 0;if(Ta(h))return qd(h)?$n(h):h.length;var y=Lo(h);return y==$t||y==jn?h.size:or(h).length}function pm(h,y,S){var N=gn(h)?lc:p_;return S&&Uo(h,y,S)&&(y=o),N(h,Ki(y,3))}var t0=rn(function(h,y){if(h==null)return[];var S=y.length;return S>1&&Uo(h,y[0],y[1])?y=[]:S>2&&Uo(y[0],y[1],y[2])&&(y=[y[0]]),Hn(h,J(y,1),[])}),Nd=ni||function(){return Hr.Date.now()};function Ud(h,y){if(typeof y!="function")throw new En(E);return h=Rn(h),function(){if(--h<1)return y.apply(this,arguments)}}function og(h,y,S){return y=S?o:y,y=h&&y==null?h.length:y,Zl(h,lt,o,o,o,o,y)}function Zf(h,y){var S;if(typeof y!="function")throw new En(E);return h=Rn(h),function(){return--h>0&&(S=y.apply(this,arguments)),h<=1&&(y=o),S}}var mm=rn(function(h,y,S){var N=ae;if(S.length){var Q=ll(S,Tc(mm));N|=_e}return Zl(h,N,y,S,Q)}),Xf=rn(function(h,y,S){var N=ae|Ie;if(S.length){var Q=ll(S,Tc(Xf));N|=_e}return Zl(y,N,h,S,Q)});function Kf(h,y,S){y=S?o:y;var N=Zl(h,Ue,o,o,o,o,o,y);return N.placeholder=Kf.placeholder,N}function Vd(h,y,S){y=S?o:y;var N=Zl(h,je,o,o,o,o,o,y);return N.placeholder=Vd.placeholder,N}function ag(h,y,S){var N,Q,ce,Ee,ke,Ze,Mt=0,Lt=!1,Vt=!1,mi=!0;if(typeof h!="function")throw new En(E);y=Po(y)||0,Fr(S)&&(Lt=!!S.leading,Vt="maxWait"in S,ce=Vt?ss(Po(S.maxWait)||0,y):ce,mi="trailing"in S?!!S.trailing:mi);function zi(Is){var wl=N,jo=Q;return N=Q=o,Mt=Is,Ee=h.apply(jo,wl),Ee}function an(Is){return Mt=Is,ke=jh(Kn,y),Lt?zi(Is):Ee}function Bn(Is){var wl=Is-Ze,jo=Is-Mt,Bm=y-wl;return Vt?ws(Bm,ce-jo):Bm}function un(Is){var wl=Is-Ze,jo=Is-Mt;return Ze===o||wl>=y||wl<0||Vt&&jo>=ce}function Kn(){var Is=Nd();if(un(Is))return er(Is);ke=jh(Kn,Bn(Is))}function er(Is){return ke=o,mi&&N?zi(Is):(N=Q=o,Ee)}function Ma(){ke!==o&&Af(ke),Mt=0,N=Ze=Q=ke=o}function Go(){return ke===o?Ee:er(Nd())}function Aa(){var Is=Nd(),wl=un(Is);if(N=arguments,Q=this,Ze=Is,wl){if(ke===o)return an(Ze);if(Vt)return Af(ke),ke=jh(Kn,y),zi(Ze)}return ke===o&&(ke=jh(Kn,y)),Ee}return Aa.cancel=Ma,Aa.flush=Go,Aa}var i0=rn(function(h,y){return B(h,1,y)}),n0=rn(function(h,y,S){return B(h,Po(y)||0,S)});function r0(h){return Zl(h,Bt)}function Yf(h,y){if(typeof h!="function"||y!=null&&typeof y!="function")throw new En(E);var S=function(){var N=arguments,Q=y?y.apply(this,N):N[0],ce=S.cache;if(ce.has(Q))return ce.get(Q);var Ee=h.apply(this,N);return S.cache=ce.set(Q,Ee)||ce,Ee};return S.cache=new(Yf.Cache||ml),S}Yf.Cache=ml;function Jf(h){if(typeof h!="function")throw new En(E);return function(){var y=arguments;switch(y.length){case 0:return!h.call(this);case 1:return!h.call(this,y[0]);case 2:return!h.call(this,y[0],y[1]);case 3:return!h.call(this,y[0],y[1],y[2])}return!h.apply(this,y)}}function Qf(h){return Zf(2,h)}var s0=Mf(function(h,y){y=y.length==1&&gn(y[0])?Qn(y[0],us(Ki())):Qn(J(y,1),us(Ki()));var S=y.length;return rn(function(N){for(var Q=-1,ce=ws(N.length,S);++Q<ce;)N[Q]=y[Q].call(this,N[Q]);return Rs(h,this,N)})}),$f=rn(function(h,y){var S=ll(y,Tc($f));return Zl(h,_e,o,y,S)}),bh=rn(function(h,y){var S=ll(y,Tc(bh));return Zl(h,ct,o,y,S)}),o0=Za(function(h,y){return Zl(h,St,o,o,o,y)});function a0(h,y){if(typeof h!="function")throw new En(E);return y=y===o?y:Rn(y),rn(h,y)}function l0(h,y){if(typeof h!="function")throw new En(E);return y=y==null?0:ss(Rn(y),0),rn(function(S){var N=S[y],Q=Kc(S,0,y);return N&&ta(Q,N),Rs(h,this,Q)})}function lg(h,y,S){var N=!0,Q=!0;if(typeof h!="function")throw new En(E);return Fr(S)&&(N="leading"in S?!!S.leading:N,Q="trailing"in S?!!S.trailing:Q),ag(h,y,{leading:N,maxWait:y,trailing:Q})}function cg(h){return og(h,1)}function c0(h,y){return $f(If(y),h)}function u0(){if(!arguments.length)return[];var h=arguments[0];return gn(h)?h:[h]}function h0(h){return A(h,Y)}function _m(h,y){return y=typeof y=="function"?y:o,A(h,Y,y)}function ep(h){return A(h,V|Y)}function tp(h,y){return y=typeof y=="function"?y:o,A(h,V|Y,y)}function d0(h,y){return y==null||P(h,y,fs(y))}function $l(h,y){return h===y||h!==h&&y!==y}var Gd=wa(Qe),jd=wa(function(h,y){return h>=y}),Lu=Ge(function(){return arguments}())?Ge:function(h){return Kr(h)&&Tn.call(h,"callee")&&!jc.call(h,"callee")},gn=at.isArray,ug=sc?us(sc):tt;function Ta(h){return h!=null&&Du(h.length)&&!Lc(h)}function Ts(h){return Kr(h)&&Ta(h)}function hg(h){return h===!0||h===!1||Kr(h)&&We(h)==Wt}var $c=gu||fp,dg=oc?us(oc):bt;function fg(h){return Kr(h)&&h.nodeType===1&&!Pu(h)}function pg(h){if(h==null)return!0;if(Ta(h)&&(gn(h)||typeof h=="string"||typeof h.splice=="function"||$c(h)||Jh(h)||Lu(h)))return!h.length;var y=Lo(h);if(y==$t||y==jn)return!h.size;if(Jc(h))return!or(h).length;for(var S in h)if(Tn.call(h,S))return!1;return!0}function f0(h,y){return At(h,y)}function p0(h,y,S){S=typeof S=="function"?S:o;var N=S?S(h,y):o;return N===o?At(h,y,o,S):!!N}function ip(h){if(!Kr(h))return!1;var y=We(h);return y==wt||y==It||typeof h.message=="string"&&typeof h.name=="string"&&!Pu(h)}function np(h){return typeof h=="number"&&fd(h)}function Lc(h){if(!Fr(h))return!1;var y=We(h);return y==Ii||y==dn||y==Ei||y==Ir}function Do(h){return typeof h=="number"&&h==Rn(h)}function Du(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=Gt}function Fr(h){var y=typeof h;return h!=null&&(y=="object"||y=="function")}function Kr(h){return h!=null&&typeof h=="object"}var gm=Fc?us(Fc):fn;function mg(h,y){return h===y||di(h,y,ph(y))}function m0(h,y,S){return S=typeof S=="function"?S:o,di(h,y,ph(y),S)}function _0(h){return _g(h)&&h!=+h}function g0(h){if(O_(h))throw new Xi(v);return si(h)}function y0(h){return h===null}function v0(h){return h==null}function _g(h){return typeof h=="number"||Kr(h)&&We(h)==gt}function Pu(h){if(!Kr(h)||We(h)!=Pi)return!1;var y=hl(h);if(y===null)return!0;var S=Tn.call(y,"constructor")&&y.constructor;return typeof S=="function"&&S instanceof S&&zs.call(S)==pa}var ym=Nc?us(Nc):Ti;function gg(h){return Do(h)&&h>=-Gt&&h<=Gt}var vm=zl?us(zl):Mn;function qd(h){return typeof h=="string"||!gn(h)&&Kr(h)&&We(h)==sr}function Ya(h){return typeof h=="symbol"||Kr(h)&&We(h)==Be}var Jh=Ra?us(Ra):Li;function x0(h){return h===o}function b0(h){return Kr(h)&&Lo(h)==qi}function w0(h){return Kr(h)&&We(h)==Ci}var yg=wa(lr),E0=wa(function(h,y){return h<=y});function no(h){if(!h)return[];if(Ta(h))return qd(h)?cn(h):io(h);if(Ha&&h[Ha])return Gc(h[Ha]());var y=Lo(h),S=y==$t?ja:y==jn?Ve:Ru;return S(h)}function vo(h){if(!h)return h===0?h:0;if(h=Po(h),h===Vi||h===-Vi){var y=h<0?-1:1;return y*Yi}return h===h?h:0}function Rn(h){var y=vo(h),S=y%1;return y===y?S?y-S:y:0}function Hd(h){return h?w(Rn(h),0,ki):0}function Po(h){if(typeof h=="number")return h;if(Ya(h))return Gi;if(Fr(h)){var y=typeof h.valueOf=="function"?h.valueOf():h;h=Fr(y)?y+"":y}if(typeof h!="string")return h===0?h:+h;h=uc(h);var S=Mi.test(h);return S||yi.test(h)?zc(h.slice(2),S?2:8):Dt.test(h)?Gi:+h}function vg(h){return go(h,oa(h))}function T0(h){return h?w(Rn(h),-Gt,Gt):h===0?h:0}function cr(h){return h==null?"":ba(h)}var I0=yl(function(h,y){if(Jc(y)||Ta(y)){go(y,fs(y),h);return}for(var S in y)Tn.call(y,S)&&bc(h,S,y[S])}),xg=yl(function(h,y){go(y,oa(y),h)}),Ou=yl(function(h,y,S,N){go(y,oa(y),h,N)}),bg=yl(function(h,y,S,N){go(y,fs(y),h,N)}),wg=Za(x);function wr(h,y){var S=vc(h);return y==null?S:n(S,y)}var xm=rn(function(h,y){h=dr(h);var S=-1,N=y.length,Q=N>2?y[2]:o;for(Q&&Uo(y[0],y[1],Q)&&(N=1);++S<N;)for(var ce=y[S],Ee=oa(ce),ke=-1,Ze=Ee.length;++ke<Ze;){var Mt=Ee[ke],Lt=h[Mt];(Lt===o||$l(Lt,Eo[Mt])&&!Tn.call(h,Mt))&&(h[Mt]=ce[Mt])}return h}),Eg=rn(function(h){return h.push(o,qp),Rs(sp,o,h)});function Tg(h,y){return ia(h,Ki(y,3),ge)}function eu(h,y){return ia(h,Ki(y,3),Ae)}function Qh(h,y){return h==null?h:me(h,Ki(y,3),oa)}function Ig(h,y){return h==null?h:fe(h,Ki(y,3),oa)}function M0(h,y){return h&&ge(h,Ki(y,3))}function A0(h,y){return h&&Ae(h,Ki(y,3))}function S0(h){return h==null?[]:Te(h,fs(h))}function C0(h){return h==null?[]:Te(h,oa(h))}function bm(h,y,S){var N=h==null?o:De(h,y);return N===o?S:N}function L0(h,y){return h!=null&&C_(h,y,Ut)}function wm(h,y){return h!=null&&C_(h,y,Xe)}var D0=Fi(function(h,y,S){y!=null&&typeof y.toString!="function"&&(y=on.call(y)),h[y]=S},Xd(Ia)),P0=Fi(function(h,y,S){y!=null&&typeof y.toString!="function"&&(y=on.call(y)),Tn.call(h,y)?h[y].push(S):h[y]=[S]},Ki),rp=rn(Ye);function fs(h){return Ta(h)?Fh(h):or(h)}function oa(h){return Ta(h)?Fh(h,!0):br(h)}function O0(h,y){var S={};return y=Ki(y,3),ge(h,function(N,Q,ce){m(S,y(N,Q,ce),N)}),S}function R0(h,y){var S={};return y=Ki(y,3),ge(h,function(N,Q,ce){m(S,Q,y(N,Q,ce))}),S}var k0=yl(function(h,y,S){va(h,y,S)}),sp=yl(function(h,y,S,N){va(h,y,S,N)}),Em=Za(function(h,y){var S={};if(h==null)return S;var N=!1;y=Qn(y,function(ce){return ce=Iu(ce,h),N||(N=ce.length>1),ce}),go(h,Xl(h),S),N&&(S=A(S,V|Z|Y,M_));for(var Q=y.length;Q--;)wf(S,y[Q]);return S});function Mg(h,y){return $h(h,Jf(Ki(y)))}var Ja=Za(function(h,y){return h==null?{}:Qr(h,y)});function $h(h,y){if(h==null)return{};var S=Qn(Xl(h),function(N){return[N]});return y=Ki(y),eo(h,S,function(N,Q){return y(N,Q[0])})}function ed(h,y,S){y=Iu(y,h);var N=-1,Q=y.length;for(Q||(Q=1,h=o);++N<Q;){var ce=h==null?o:h[Jl(y[N])];ce===o&&(N=Q,ce=S),h=Lc(ce)?ce.call(h):ce}return h}function Tm(h,y,S){return h==null?h:xa(h,y,S)}function op(h,y,S,N){return N=typeof N=="function"?N:o,h==null?h:xa(h,y,S,N)}var Ag=Su(fs),Im=Su(oa);function Sg(h,y,S){var N=gn(h),Q=N||$c(h)||Jh(h);if(y=Ki(y,4),S==null){var ce=h&&h.constructor;Q?S=N?new ce:[]:Fr(h)?S=Lc(ce)?vc(hl(h)):{}:S={}}return(Q?po:ge)(h,function(Ee,ke,Ze){return y(S,Ee,ke,Ze)}),S}function z0(h,y){return h==null?!0:wf(h,y)}function Cg(h,y,S){return h==null?h:m_(h,y,If(S))}function Lg(h,y,S,N){return N=typeof N=="function"?N:o,h==null?h:m_(h,y,If(S),N)}function Ru(h){return h==null?[]:Ua(h,fs(h))}function Dg(h){return h==null?[]:Ua(h,oa(h))}function B0(h,y,S){return S===o&&(S=y,y=o),S!==o&&(S=Po(S),S=S===S?S:0),y!==o&&(y=Po(y),y=y===y?y:0),w(Po(h),y,S)}function Pg(h,y,S){return y=vo(y),S===o?(S=y,y=0):S=vo(S),h=Po(h),pt(h,y,S)}function tu(h,y,S){if(S&&typeof S!="boolean"&&Uo(h,y,S)&&(y=S=o),S===o&&(typeof y=="boolean"?(S=y,y=o):typeof h=="boolean"&&(S=h,h=o)),h===o&&y===o?(h=0,y=1):(h=vo(h),y===o?(y=h,h=0):y=vo(y)),h>y){var N=h;h=y,y=N}if(S||h%1||y%1){var Q=sh();return ws(h+Q*(y-h+Zu("1e-"+((Q+"").length-1))),y)}return gl(h,y)}var Og=fh(function(h,y,S){return y=y.toLowerCase(),h+(S?Mm(y):y)});function Mm(h){return Zd(cr(h).toLowerCase())}function Am(h){return h=cr(h),h&&h.replace(hi,$u).replace(is,"")}function Rg(h,y,S){h=cr(h),y=ba(y);var N=h.length;S=S===o?N:w(Rn(S),0,N);var Q=S;return S-=y.length,S>=0&&h.slice(S,Q)==y}function F0(h){return h=cr(h),h&&Da.test(h)?h.replace(ua,Vc):h}function N0(h){return h=cr(h),h&&q.test(h)?h.replace(he,"\\$&"):h}var kg=fh(function(h,y,S){return h+(S?"-":"")+y.toLowerCase()}),zg=fh(function(h,y,S){return h+(S?" ":"")+y.toLowerCase()}),Wd=w_("toLowerCase");function Bg(h,y,S){h=cr(h),y=Rn(y);var N=y?$n(h):0;if(!y||N>=y)return h;var Q=(y-N)/2;return Co(_u(Q),S)+h+Co(nh(Q),S)}function Fg(h,y,S){h=cr(h),y=Rn(y);var N=y?$n(h):0;return y&&N<y?h+Co(y-N,S):h}function Sm(h,y,S){h=cr(h),y=Rn(y);var N=y?$n(h):0;return y&&N<y?Co(y-N,S)+h:h}function td(h,y,S){return S||y==null?y=0:y&&(y=+y),Hs(cr(h).replace(K,""),y||0)}function Ng(h,y,S){return(S?Uo(h,y,S):y===o)?y=1:y=Rn(y),So(cr(h),y)}function ap(){var h=arguments,y=cr(h[0]);return h.length<3?y:y.replace(h[1],h[2])}var Ug=fh(function(h,y,S){return h+(S?"_":"")+y.toLowerCase()});function lp(h,y,S){return S&&typeof S!="number"&&Uo(h,y,S)&&(y=S=o),S=S===o?ki:S>>>0,S?(h=cr(h),h&&(typeof y=="string"||y!=null&&!ym(y))&&(y=ba(y),!y&&Ga(h))?Kc(cn(h),0,S):h.split(y,S)):[]}var cp=fh(function(h,y,S){return h+(S?" ":"")+Zd(y)});function U0(h,y,S){return h=cr(h),S=S==null?0:w(Rn(S),0,h.length),y=ba(y),h.slice(S,S+y.length)==y}function V0(h,y,S){var N=ne.templateSettings;S&&Uo(h,y,S)&&(y=o),h=cr(h),y=Ou({},y,N,Ad);var Q=Ou({},y.imports,N.imports,Ad),ce=fs(Q),Ee=Ua(Q,ce),ke,Ze,Mt=0,Lt=y.interpolate||Pn,Vt="__p += '",mi=mu((y.escape||Pn).source+"|"+Lt.source+"|"+(Lt===xs?vt:Pn).source+"|"+(y.evaluate||Pn).source+"|$","g"),zi="//# sourceURL="+(Tn.call(y,"sourceURL")?(y.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Pl+"]")+`
`;h.replace(mi,function(un,Kn,er,Ma,Go,Aa){return er||(er=Ma),Vt+=h.slice(Mt,Aa).replace(Oi,fc),Kn&&(ke=!0,Vt+=`' +
__e(`+Kn+`) +
'`),Go&&(Ze=!0,Vt+=`';
`+Go+`;
__p += '`),er&&(Vt+=`' +
((__t = (`+er+`)) == null ? '' : __t) +
'`),Mt=Aa+un.length,un}),Vt+=`';
`;var an=Tn.call(y,"variable")&&y.variable;if(!an)Vt=`with (obj) {
`+Vt+`
}
`;else if(Re.test(an))throw new Xi(r);Vt=(Ze?Vt.replace(cs,""):Vt).replace(ho,"$1").replace(La,"$1;"),Vt="function("+(an||"obj")+`) {
`+(an?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(ke?", __e = _.escape":"")+(Ze?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Vt+`return __p
}`;var Bn=iu(function(){return qn(ce,zi+"return "+Vt).apply(o,Ee)});if(Bn.source=Vt,ip(Bn))throw Bn;return Bn}function G0(h){return cr(h).toLowerCase()}function j0(h){return cr(h).toUpperCase()}function q0(h,y,S){if(h=cr(h),h&&(S||y===o))return uc(h);if(!h||!(y=ba(y)))return h;var N=cn(h),Q=cn(y),ce=Va(N,Q),Ee=dc(N,Q)+1;return Kc(N,ce,Ee).join("")}function id(h,y,S){if(h=cr(h),h&&(S||y===o))return h.slice(0,Or(h)+1);if(!h||!(y=ba(y)))return h;var N=cn(h),Q=dc(N,cn(y))+1;return Kc(N,0,Q).join("")}function Cm(h,y,S){if(h=cr(h),h&&(S||y===o))return h.replace(K,"");if(!h||!(y=ba(y)))return h;var N=cn(h),Q=Va(N,cn(y));return Kc(N,Q).join("")}function H0(h,y){var S=et,N=ot;if(Fr(y)){var Q="separator"in y?y.separator:Q;S="length"in y?Rn(y.length):S,N="omission"in y?ba(y.omission):N}h=cr(h);var ce=h.length;if(Ga(h)){var Ee=cn(h);ce=Ee.length}if(S>=ce)return h;var ke=S-$n(N);if(ke<1)return N;var Ze=Ee?Kc(Ee,0,ke).join(""):h.slice(0,ke);if(Q===o)return Ze+N;if(Ee&&(ke+=Ze.length-ke),ym(Q)){if(h.slice(ke).search(Q)){var Mt,Lt=Ze;for(Q.global||(Q=mu(Q.source,cr(Xt.exec(Q))+"g")),Q.lastIndex=0;Mt=Q.exec(Lt);)var Vt=Mt.index;Ze=Ze.slice(0,Vt===o?ke:Vt)}}else if(h.indexOf(ba(Q),ke)!=ke){var mi=Ze.lastIndexOf(Q);mi>-1&&(Ze=Ze.slice(0,mi))}return Ze+N}function Vg(h){return h=cr(h),h&&Dl.test(h)?h.replace(qs,ns):h}var W0=fh(function(h,y,S){return h+(S?" ":"")+y.toUpperCase()}),Zd=w_("toUpperCase");function Gg(h,y,S){return h=cr(h),y=S?o:y,y===o?eh(h)?Jr(h):Fa(h):h.match(y)||[]}var iu=rn(function(h,y){try{return Rs(h,o,y)}catch(S){return ip(S)?S:new Xi(S)}}),jg=Za(function(h,y){return po(y,function(S){S=Jl(S),m(h,S,mm(h[S],h))}),h});function qg(h){var y=h==null?0:h.length,S=Ki();return h=y?Qn(h,function(N){if(typeof N[1]!="function")throw new En(E);return[S(N[0]),N[1]]}):[],rn(function(N){for(var Q=-1;++Q<y;){var ce=h[Q];if(Rs(ce[0],this,N))return Rs(ce[1],this,N)}})}function up(h){return L(A(h,V))}function Xd(h){return function(){return h}}function Z0(h,y){return h==null||h!==h?y:h}var Hg=T_(),wh=T_(!0);function Ia(h){return h}function Dc(h){return Jn(typeof h=="function"?h:A(h,V))}function X0(h){return Ao(A(h,V))}function Kd(h,y){return ya(h,A(y,V))}var Yd=rn(function(h,y){return function(S){return Ye(S,h,y)}}),Jd=rn(function(h,y){return function(S){return Ye(h,S,y)}});function Eh(h,y,S){var N=fs(y),Q=Te(y,N);S==null&&!(Fr(y)&&(Q.length||!N.length))&&(S=y,y=h,h=this,Q=Te(y,fs(y)));var ce=!(Fr(S)&&"chain"in S)||!!S.chain,Ee=Lc(h);return po(Q,function(ke){var Ze=y[ke];h[ke]=Ze,Ee&&(h.prototype[ke]=function(){var Mt=this.__chain__;if(ce||Mt){var Lt=h(this.__wrapped__),Vt=Lt.__actions__=io(this.__actions__);return Vt.push({func:Ze,args:arguments,thisArg:h}),Lt.__chain__=Mt,Lt}return Ze.apply(h,ta([this.value()],arguments))})}),h}function hp(){return Hr._===this&&(Hr._=Ph),this}function Lm(){}function K0(h){return h=Rn(h),rn(function(y){return fr(y,h)})}var nd=Vh(Qn),dp=Vh(On),Y0=Vh(lc);function Dm(h){return Df(h)?al(Jl(h)):Sr(h)}function Wg(h){return function(y){return h==null?o:De(h,y)}}var J0=jp(),Zg=jp(!0);function Pm(){return[]}function fp(){return!1}function Q0(){return{}}function Xg(){return""}function $0(){return!0}function ev(h,y){if(h=Rn(h),h<1||h>Gt)return[];var S=ki,N=ws(h,ki);y=Ki(y),h-=ki;for(var Q=cc(N,y);++S<h;)y(S);return Q}function pp(h){return gn(h)?Qn(h,Jl):Ya(h)?[h]:io(Jp(cr(h)))}function mp(h){var y=++To;return cr(h)+y}var _p=Wl(function(h,y){return h+y},0),tv=Yc("ceil"),Om=Wl(function(h,y){return h/y},1),Rm=Yc("floor");function ku(h){return h&&h.length?re(h,Ia,Qe):o}function iv(h,y){return h&&h.length?re(h,Ki(y,2),Qe):o}function km(h){return Yu(h,Ia)}function Kg(h,y){return Yu(h,Ki(y,2))}function gp(h){return h&&h.length?re(h,Ia,lr):o}function nv(h,y){return h&&h.length?re(h,Ki(y,2),lr):o}var rv=Wl(function(h,y){return h*y},1),sv=Yc("round"),ov=Wl(function(h,y){return h-y},0);function zm(h){return h&&h.length?Qu(h,Ia):0}function av(h,y){return h&&h.length?Qu(h,Ki(y,2)):0}return ne.after=Ud,ne.ary=og,ne.assign=I0,ne.assignIn=xg,ne.assignInWith=Ou,ne.assignWith=bg,ne.at=wg,ne.before=Zf,ne.bind=mm,ne.bindAll=jg,ne.bindKey=Xf,ne.castArray=u0,ne.chain=cm,ne.chunk=qh,ne.compact=Hh,ne.concat=Od,ne.cond=qg,ne.conforms=up,ne.constant=Xd,ne.countBy=eg,ne.create=wr,ne.curry=Kf,ne.curryRight=Vd,ne.debounce=ag,ne.defaults=xm,ne.defaultsDeep=Eg,ne.defer=i0,ne.delay=n0,ne.difference=Bf,ne.differenceBy=R_,ne.differenceWith=Rd,ne.drop=Qp,ne.dropRight=k_,ne.dropRightWhile=Wh,ne.dropWhile=z_,ne.fill=$p,ne.filter=zd,ne.flatMap=Yy,ne.flatMapDeep=Jy,ne.flatMapDepth=Qy,ne.flatten=F_,ne.flattenDeep=kd,ne.flattenDepth=N_,ne.flip=r0,ne.flow=Hg,ne.flowRight=wh,ne.fromPairs=Wn,ne.functions=S0,ne.functionsIn=C0,ne.groupBy=dm,ne.initial=Cc,ne.intersection=Ql,ne.intersectionBy=Ka,ne.intersectionWith=yo,ne.invert=D0,ne.invertBy=P0,ne.invokeMap=Yh,ne.iteratee=Dc,ne.keyBy=e0,ne.keys=fs,ne.keysIn=oa,ne.map=Xr,ne.mapKeys=O0,ne.mapValues=R0,ne.matches=X0,ne.matchesProperty=Kd,ne.memoize=Yf,ne.merge=k0,ne.mergeWith=sp,ne.method=Yd,ne.methodOf=Jd,ne.mixin=Eh,ne.negate=Jf,ne.nthArg=K0,ne.omit=Em,ne.omitBy=Mg,ne.once=Qf,ne.orderBy=qf,ne.over=nd,ne.overArgs=s0,ne.overEvery=dp,ne.overSome=Y0,ne.partial=$f,ne.partialRight=bh,ne.partition=ng,ne.pick=Ja,ne.pickBy=$h,ne.property=Dm,ne.propertyOf=Wg,ne.pull=tm,ne.pullAll=im,ne.pullAllBy=nm,ne.pullAllWith=ky,ne.pullAt=rm,ne.range=J0,ne.rangeRight=Zg,ne.rearg=o0,ne.reject=Bd,ne.remove=G_,ne.rest=a0,ne.reverse=sm,ne.sampleSize=sg,ne.set=Tm,ne.setWith=op,ne.shuffle=Fd,ne.slice=Qc,ne.sortBy=t0,ne.sortedUniq=q_,ne.sortedUniqBy=By,ne.split=lp,ne.spread=l0,ne.tail=am,ne.take=Fy,ne.takeRight=lm,ne.takeRightWhile=H_,ne.takeWhile=W_,ne.tap=um,ne.throttle=lg,ne.thru=bl,ne.toArray=no,ne.toPairs=Ag,ne.toPairsIn=Im,ne.toPath=pp,ne.toPlainObject=vg,ne.transform=Sg,ne.unary=cg,ne.union=vh,ne.unionBy=Z_,ne.unionWith=Ny,ne.uniq=Xh,ne.uniqBy=Vf,ne.uniqWith=X_,ne.unset=z0,ne.unzip=Gf,ne.unzipWith=K_,ne.update=Cg,ne.updateWith=Lg,ne.values=Ru,ne.valuesIn=Dg,ne.without=Uy,ne.words=Gg,ne.wrap=c0,ne.xor=Y_,ne.xorBy=Vy,ne.xorWith=J_,ne.zip=Gy,ne.zipObject=jy,ne.zipObjectDeep=Q_,ne.zipWith=$_,ne.entries=Ag,ne.entriesIn=Im,ne.extend=xg,ne.extendWith=Ou,Eh(ne,ne),ne.add=_p,ne.attempt=iu,ne.camelCase=Og,ne.capitalize=Mm,ne.ceil=tv,ne.clamp=B0,ne.clone=h0,ne.cloneDeep=ep,ne.cloneDeepWith=tp,ne.cloneWith=_m,ne.conformsTo=d0,ne.deburr=Am,ne.defaultTo=Z0,ne.divide=Om,ne.endsWith=Rg,ne.eq=$l,ne.escape=F0,ne.escapeRegExp=N0,ne.every=xh,ne.find=Xy,ne.findIndex=em,ne.findKey=Tg,ne.findLast=Ky,ne.findLastIndex=B_,ne.findLastKey=eu,ne.floor=Rm,ne.forEach=tg,ne.forEachRight=ig,ne.forIn=Qh,ne.forInRight=Ig,ne.forOwn=M0,ne.forOwnRight=A0,ne.get=bm,ne.gt=Gd,ne.gte=jd,ne.has=L0,ne.hasIn=wm,ne.head=Ff,ne.identity=Ia,ne.includes=$y,ne.indexOf=Sc,ne.inRange=Pg,ne.invoke=rp,ne.isArguments=Lu,ne.isArray=gn,ne.isArrayBuffer=ug,ne.isArrayLike=Ta,ne.isArrayLikeObject=Ts,ne.isBoolean=hg,ne.isBuffer=$c,ne.isDate=dg,ne.isElement=fg,ne.isEmpty=pg,ne.isEqual=f0,ne.isEqualWith=p0,ne.isError=ip,ne.isFinite=np,ne.isFunction=Lc,ne.isInteger=Do,ne.isLength=Du,ne.isMap=gm,ne.isMatch=mg,ne.isMatchWith=m0,ne.isNaN=_0,ne.isNative=g0,ne.isNil=v0,ne.isNull=y0,ne.isNumber=_g,ne.isObject=Fr,ne.isObjectLike=Kr,ne.isPlainObject=Pu,ne.isRegExp=ym,ne.isSafeInteger=gg,ne.isSet=vm,ne.isString=qd,ne.isSymbol=Ya,ne.isTypedArray=Jh,ne.isUndefined=x0,ne.isWeakMap=b0,ne.isWeakSet=w0,ne.join=U_,ne.kebabCase=kg,ne.last=kr,ne.lastIndexOf=V_,ne.lowerCase=zg,ne.lowerFirst=Wd,ne.lt=yg,ne.lte=E0,ne.max=ku,ne.maxBy=iv,ne.mean=km,ne.meanBy=Kg,ne.min=gp,ne.minBy=nv,ne.stubArray=Pm,ne.stubFalse=fp,ne.stubObject=Q0,ne.stubString=Xg,ne.stubTrue=$0,ne.multiply=rv,ne.nth=Zh,ne.noConflict=hp,ne.noop=Lm,ne.now=Nd,ne.pad=Bg,ne.padEnd=Fg,ne.padStart=Sm,ne.parseInt=td,ne.random=tu,ne.reduce=Hf,ne.reduceRight=Wf,ne.repeat=Ng,ne.replace=ap,ne.result=ed,ne.round=sv,ne.runInContext=Ne,ne.sample=rg,ne.size=fm,ne.snakeCase=Ug,ne.some=pm,ne.sortedIndex=yh,ne.sortedIndexBy=Nf,ne.sortedIndexOf=Uf,ne.sortedLastIndex=om,ne.sortedLastIndexBy=j_,ne.sortedLastIndexOf=zy,ne.startCase=cp,ne.startsWith=U0,ne.subtract=ov,ne.sum=zm,ne.sumBy=av,ne.template=V0,ne.times=ev,ne.toFinite=vo,ne.toInteger=Rn,ne.toLength=Hd,ne.toLower=G0,ne.toNumber=Po,ne.toSafeInteger=T0,ne.toString=cr,ne.toUpper=j0,ne.trim=q0,ne.trimEnd=id,ne.trimStart=Cm,ne.truncate=H0,ne.unescape=Vg,ne.uniqueId=mp,ne.upperCase=W0,ne.upperFirst=Zd,ne.each=tg,ne.eachRight=ig,ne.first=Ff,Eh(ne,function(){var h={};return ge(ne,function(y,S){Tn.call(ne.prototype,S)||(h[S]=y)}),h}(),{chain:!1}),ne.VERSION=d,po(["bind","bindKey","curry","curryRight","partial","partialRight"],function(h){ne[h].placeholder=ne}),po(["drop","take"],function(h,y){en.prototype[h]=function(S){S=S===o?1:ss(Rn(S),0);var N=this.__filtered__&&!y?new en(this):this.clone();return N.__filtered__?N.__takeCount__=ws(S,N.__takeCount__):N.__views__.push({size:ws(S,ki),type:h+(N.__dir__<0?"Right":"")}),N},en.prototype[h+"Right"]=function(S){return this.reverse()[h](S).reverse()}}),po(["filter","map","takeWhile"],function(h,y){var S=y+1,N=S==_t||S==ti;en.prototype[h]=function(Q){var ce=this.clone();return ce.__iteratees__.push({iteratee:Ki(Q,3),type:S}),ce.__filtered__=ce.__filtered__||N,ce}}),po(["head","last"],function(h,y){var S="take"+(y?"Right":"");en.prototype[h]=function(){return this[S](1).value()[0]}}),po(["initial","tail"],function(h,y){var S="drop"+(y?"":"Right");en.prototype[h]=function(){return this.__filtered__?new en(this):this[S](1)}}),en.prototype.compact=function(){return this.filter(Ia)},en.prototype.find=function(h){return this.filter(h).head()},en.prototype.findLast=function(h){return this.reverse().find(h)},en.prototype.invokeMap=rn(function(h,y){return typeof h=="function"?new en(this):this.map(function(S){return Ye(S,h,y)})}),en.prototype.reject=function(h){return this.filter(Jf(Ki(h)))},en.prototype.slice=function(h,y){h=Rn(h);var S=this;return S.__filtered__&&(h>0||y<0)?new en(S):(h<0?S=S.takeRight(-h):h&&(S=S.drop(h)),y!==o&&(y=Rn(y),S=y<0?S.dropRight(-y):S.take(y-h)),S)},en.prototype.takeRightWhile=function(h){return this.reverse().takeWhile(h).reverse()},en.prototype.toArray=function(){return this.take(ki)},ge(en.prototype,function(h,y){var S=/^(?:filter|find|map|reject)|While$/.test(y),N=/^(?:head|last)$/.test(y),Q=ne[N?"take"+(y=="last"?"Right":""):y],ce=N||/^find/.test(y);Q&&(ne.prototype[y]=function(){var Ee=this.__wrapped__,ke=N?[1]:arguments,Ze=Ee instanceof en,Mt=ke[0],Lt=Ze||gn(Ee),Vt=function(Kn){var er=Q.apply(ne,ta([Kn],ke));return N&&mi?er[0]:er};Lt&&S&&typeof Mt=="function"&&Mt.length!=1&&(Ze=Lt=!1);var mi=this.__chain__,zi=!!this.__actions__.length,an=ce&&!mi,Bn=Ze&&!zi;if(!ce&&Lt){Ee=Bn?Ee:new en(this);var un=h.apply(Ee,ke);return un.__actions__.push({func:bl,args:[Vt],thisArg:o}),new Mo(un,mi)}return an&&Bn?h.apply(this,ke):(un=this.thru(Vt),an?N?un.value()[0]:un.value():un)})}),po(["pop","push","shift","sort","splice","unshift"],function(h){var y=qa[h],S=/^(?:push|sort|unshift)$/.test(h)?"tap":"thru",N=/^(?:pop|shift)$/.test(h);ne.prototype[h]=function(){var Q=arguments;if(N&&!this.__chain__){var ce=this.value();return y.apply(gn(ce)?ce:[],Q)}return this[S](function(Ee){return y.apply(gn(Ee)?Ee:[],Q)})}}),ge(en.prototype,function(h,y){var S=ne[y];if(S){var N=S.name+"";Tn.call(Hc,N)||(Hc[N]=[]),Hc[N].push({name:y,func:S})}}),Hc[Zr(o,Ie).name]=[{name:"wrapper",func:o}],en.prototype.clone=Bp,en.prototype.reverse=hf,en.prototype.value=Fp,ne.prototype.at=Ea,ne.prototype.chain=qy,ne.prototype.commit=hm,ne.prototype.next=Hy,ne.prototype.plant=Zy,ne.prototype.reverse=Kh,ne.prototype.toJSON=ne.prototype.valueOf=ne.prototype.value=jf,ne.prototype.first=ne.prototype.head,Ha&&(ne.prototype[Ha]=Wy),ne},hs=ra();xr?((xr.exports=hs)._=hs,ea._=hs):Hr._=hs}).call(ru)})(qb,yy);const Ch=yy,p1=["#FF5733","#F2BE22","#17BEBB","#7B68EE","#FF8C00","#00BFFF","#9932CC","#2E8B57","#FF1493","#8B4513"];let Hb=0;const Vv=()=>p1[Hb++%p1.length];function Wb(s){return typeof s=="string"}function o_(s){return s!==void 0&&!Wb(s)}function uy(s,a,o){const d=a.geojson.data;if(!o_(d))throw new Error("Invalid data source");switch(d.type){case"Point":case"MultiPoint":Gv(s,d,a.id);break;case"LineString":case"MultiLineString":jv(s,d,a.id);break;case"Polygon":case"MultiPolygon":qv(s,d,a.id);break;case"Feature":Zb(s,a);break;case"GeometryCollection":Xb(s,a);break;case"FeatureCollection":Kb(s,a);break}}function Gv(s,a,o){const d={id:o+"-point",type:"circle",source:{type:"geojson",data:a},paint:{"circle-color":Vv()},isVisible:!0,displayName:o};Rc.add(d),s.addLayer(d)}function jv(s,a,o){const d={id:o+"-line",type:"line",source:{type:"geojson",data:a},paint:{"line-color":Vv()},isVisible:!0,displayName:o};Rc.add(d),s.addLayer(d)}function qv(s,a,o){const d={id:o+"-polygon",type:"fill",source:{type:"geojson",data:a},paint:{"fill-color":Vv()},isVisible:!0,displayName:o};Rc.add(d),s.addLayer(d)}function Zb(s,a){const o=a.geojson.data;if(!o_(o)||!Vb(o))throw new Error("Not a Feature");uy(s,{...a,geojson:{type:"geojson",data:o.geometry}})}function Xb(s,a){const o=a.geojson.data;if(!o_(o)||!Gb(o))throw new Error("Not a GeometryCollection");const d=Ch.groupBy(o.geometries,_=>{switch(_.type){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"GeometryCollection":throw new Error("Invalid structure")}});Ch.forEach(d,(_,v)=>{const E={type:"GeometryCollection",geometries:_};switch(v){case"Point":Gv(s,E,a.id);break;case"LineString":jv(s,E,a.id);break;case"Polygon":qv(s,E,a.id);break}})}function Kb(s,a){const o=a.geojson.data;if(!o_(o)||!kx(o))throw new Error("Not a FeaureCollection");const d=Ch.groupBy(o.features,_=>{switch(_.geometry.type){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"GeometryCollection":throw new Error("Invalid structure")}});Ch.forEach(d,(_,v)=>{const E={type:"FeatureCollection",features:_};switch(v){case"Point":Gv(s,E,a.id);break;case"LineString":jv(s,E,a.id);break;case"Polygon":qv(s,E,a.id);break}})}var Pv=function(s,a){return Pv=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,d){o.__proto__=d}||function(o,d){for(var _ in d)Object.prototype.hasOwnProperty.call(d,_)&&(o[_]=d[_])},Pv(s,a)};function au(s,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");Pv(s,a);function o(){this.constructor=s}s.prototype=a===null?Object.create(a):(o.prototype=a.prototype,new o)}var _s=function(){return _s=Object.assign||function(a){for(var o,d=1,_=arguments.length;d<_;d++){o=arguments[d];for(var v in o)Object.prototype.hasOwnProperty.call(o,v)&&(a[v]=o[v])}return a},_s.apply(this,arguments)};function ec(s){var a=typeof Symbol=="function"&&Symbol.iterator,o=a&&s[a],d=0;if(o)return o.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&d>=s.length&&(s=void 0),{value:s&&s[d++],done:!s}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")}function m1(s,a){var o=typeof Symbol=="function"&&s[Symbol.iterator];if(!o)return s;var d=o.call(s),_,v=[],E;try{for(;(a===void 0||a-- >0)&&!(_=d.next()).done;)v.push(_.value)}catch(r){E={error:r}}finally{try{_&&!_.done&&(o=d.return)&&o.call(d)}finally{if(E)throw E.error}}return v}function Yb(s,a,o){if(o||arguments.length===2)for(var d=0,_=a.length,v;d<_;d++)(v||!(d in a))&&(v||(v=Array.prototype.slice.call(a,0,d)),v[d]=a[d]);return s.concat(v||Array.prototype.slice.call(a))}/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var lu=function(){function s(a){a===void 0&&(a={}),this.adapter=a}return Object.defineProperty(s,"cssClasses",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(s,"strings",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(s,"numbers",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(s,"defaultAdapter",{get:function(){return{}},enumerable:!1,configurable:!0}),s.prototype.init=function(){},s.prototype.destroy=function(){},s}();/**
 * @license
 * Copyright 2020 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Ml;(function(s){s.RICH="mdc-tooltip--rich",s.SHOWN="mdc-tooltip--shown",s.SHOWING="mdc-tooltip--showing",s.SHOWING_TRANSITION="mdc-tooltip--showing-transition",s.HIDE="mdc-tooltip--hide",s.HIDE_TRANSITION="mdc-tooltip--hide-transition",s.MULTILINE_TOOLTIP="mdc-tooltip--multiline",s.SURFACE="mdc-tooltip__surface",s.SURFACE_ANIMATION="mdc-tooltip__surface-animation",s.TOOLTIP_CARET_TOP="mdc-tooltip__caret-surface-top",s.TOOLTIP_CARET_BOTTOM="mdc-tooltip__caret-surface-bottom"})(Ml||(Ml={}));var Qa={BOUNDED_ANCHOR_GAP:4,UNBOUNDED_ANCHOR_GAP:8,MIN_VIEWPORT_TOOLTIP_THRESHOLD:8,HIDE_DELAY_MS:600,SHOW_DELAY_MS:500,MIN_HEIGHT:24,MAX_WIDTH:200,CARET_INDENTATION:24,ANIMATION_SCALE:.8},Qg={ARIA_EXPANDED:"aria-expanded",ARIA_HASPOPUP:"aria-haspopup",PERSISTENT:"data-mdc-tooltip-persistent",SCROLLABLE_ANCESTOR:"tooltip-scrollable-ancestor",HAS_CARET:"data-mdc-tooltip-has-caret"},sf;(function(s){s[s.DETECTED=0]="DETECTED",s[s.START=1]="START",s[s.CENTER=2]="CENTER",s[s.END=3]="END"})(sf||(sf={}));var Sp;(function(s){s[s.DETECTED=0]="DETECTED",s[s.ABOVE=1]="ABOVE",s[s.BELOW=2]="BELOW"})(Sp||(Sp={}));var vy;(function(s){s[s.BOUNDED=0]="BOUNDED",s[s.UNBOUNDED=1]="UNBOUNDED"})(vy||(vy={}));var hn={LEFT:"left",RIGHT:"right",CENTER:"center",TOP:"top",BOTTOM:"bottom"},Yn;(function(s){s[s.DETECTED=0]="DETECTED",s[s.ABOVE_START=1]="ABOVE_START",s[s.ABOVE_CENTER=2]="ABOVE_CENTER",s[s.ABOVE_END=3]="ABOVE_END",s[s.TOP_SIDE_START=4]="TOP_SIDE_START",s[s.CENTER_SIDE_START=5]="CENTER_SIDE_START",s[s.BOTTOM_SIDE_START=6]="BOTTOM_SIDE_START",s[s.TOP_SIDE_END=7]="TOP_SIDE_END",s[s.CENTER_SIDE_END=8]="CENTER_SIDE_END",s[s.BOTTOM_SIDE_END=9]="BOTTOM_SIDE_END",s[s.BELOW_START=10]="BELOW_START",s[s.BELOW_CENTER=11]="BELOW_CENTER",s[s.BELOW_END=12]="BELOW_END"})(Yn||(Yn={}));var Bo;(function(s){s[s.ABOVE=1]="ABOVE",s[s.BELOW=2]="BELOW",s[s.SIDE_TOP=3]="SIDE_TOP",s[s.SIDE_CENTER=4]="SIDE_CENTER",s[s.SIDE_BOTTOM=5]="SIDE_BOTTOM"})(Bo||(Bo={}));var pr;(function(s){s[s.START=1]="START",s[s.CENTER=2]="CENTER",s[s.END=3]="END",s[s.SIDE_START=4]="SIDE_START",s[s.SIDE_END=5]="SIDE_END"})(pr||(pr={}));/**
 * @license
 * Copyright 2020 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Jb=function(){function s(){this.rafIDs=new Map}return s.prototype.request=function(a,o){var d=this;this.cancel(a);var _=requestAnimationFrame(function(v){d.rafIDs.delete(a),o(v)});this.rafIDs.set(a,_)},s.prototype.cancel=function(a){var o=this.rafIDs.get(a);o&&(cancelAnimationFrame(o),this.rafIDs.delete(a))},s.prototype.cancelAll=function(){var a=this;this.rafIDs.forEach(function(o,d){a.cancel(d)})},s.prototype.getQueue=function(){var a=[];return this.rafIDs.forEach(function(o,d){a.push(d)}),a},s}();/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var _1={animation:{prefixed:"-webkit-animation",standard:"animation"},transform:{prefixed:"-webkit-transform",standard:"transform"},transition:{prefixed:"-webkit-transition",standard:"transition"}};function Qb(s){return!!s.document&&typeof s.document.createElement=="function"}function g1(s,a){if(Qb(s)&&a in _1){var o=s.document.createElement("div"),d=_1[a],_=d.standard,v=d.prefixed,E=_ in o.style;return E?_:v}return a}/**
 * @license
 * Copyright 2020 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Gn={UNKNOWN:"Unknown",BACKSPACE:"Backspace",ENTER:"Enter",SPACEBAR:"Spacebar",PAGE_UP:"PageUp",PAGE_DOWN:"PageDown",END:"End",HOME:"Home",ARROW_LEFT:"ArrowLeft",ARROW_UP:"ArrowUp",ARROW_RIGHT:"ArrowRight",ARROW_DOWN:"ArrowDown",DELETE:"Delete",ESCAPE:"Escape",TAB:"Tab"},tl=new Set;tl.add(Gn.BACKSPACE);tl.add(Gn.ENTER);tl.add(Gn.SPACEBAR);tl.add(Gn.PAGE_UP);tl.add(Gn.PAGE_DOWN);tl.add(Gn.END);tl.add(Gn.HOME);tl.add(Gn.ARROW_LEFT);tl.add(Gn.ARROW_UP);tl.add(Gn.ARROW_RIGHT);tl.add(Gn.ARROW_DOWN);tl.add(Gn.DELETE);tl.add(Gn.ESCAPE);tl.add(Gn.TAB);var Cl={BACKSPACE:8,ENTER:13,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46,ESCAPE:27,TAB:9},il=new Map;il.set(Cl.BACKSPACE,Gn.BACKSPACE);il.set(Cl.ENTER,Gn.ENTER);il.set(Cl.SPACEBAR,Gn.SPACEBAR);il.set(Cl.PAGE_UP,Gn.PAGE_UP);il.set(Cl.PAGE_DOWN,Gn.PAGE_DOWN);il.set(Cl.END,Gn.END);il.set(Cl.HOME,Gn.HOME);il.set(Cl.ARROW_LEFT,Gn.ARROW_LEFT);il.set(Cl.ARROW_UP,Gn.ARROW_UP);il.set(Cl.ARROW_RIGHT,Gn.ARROW_RIGHT);il.set(Cl.ARROW_DOWN,Gn.ARROW_DOWN);il.set(Cl.DELETE,Gn.DELETE);il.set(Cl.ESCAPE,Gn.ESCAPE);il.set(Cl.TAB,Gn.TAB);var hd=new Set;hd.add(Gn.PAGE_UP);hd.add(Gn.PAGE_DOWN);hd.add(Gn.END);hd.add(Gn.HOME);hd.add(Gn.ARROW_LEFT);hd.add(Gn.ARROW_UP);hd.add(Gn.ARROW_RIGHT);hd.add(Gn.ARROW_DOWN);function ao(s){var a=s.key;if(tl.has(a))return a;var o=il.get(s.keyCode);return o||Gn.UNKNOWN}/**
 * @license
 * Copyright 2020 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var $b=Ml.RICH,vv=Ml.SHOWN,xv=Ml.SHOWING,$g=Ml.SHOWING_TRANSITION,Gm=Ml.HIDE,ey=Ml.HIDE_TRANSITION,ew=Ml.MULTILINE_TOOLTIP,Ov;(function(s){s.POLL_ANCHOR="poll_anchor"})(Ov||(Ov={}));var y1=typeof window<"u",tw=function(s){au(a,s);function a(o){var d=s.call(this,_s(_s({},a.defaultAdapter),o))||this;return d.tooltipShown=!1,d.anchorGap=Qa.BOUNDED_ANCHOR_GAP,d.xTooltipPos=sf.DETECTED,d.yTooltipPos=Sp.DETECTED,d.tooltipPositionWithCaret=Yn.DETECTED,d.minViewportTooltipThreshold=Qa.MIN_VIEWPORT_TOOLTIP_THRESHOLD,d.hideDelayMs=Qa.HIDE_DELAY_MS,d.showDelayMs=Qa.SHOW_DELAY_MS,d.anchorRect=null,d.parentRect=null,d.frameId=null,d.hideTimeout=null,d.showTimeout=null,d.addAncestorScrollEventListeners=new Array,d.removeAncestorScrollEventListeners=new Array,d.animFrame=new Jb,d.anchorBlurHandler=function(_){d.handleAnchorBlur(_)},d.documentClickHandler=function(_){d.handleDocumentClick(_)},d.documentKeydownHandler=function(_){d.handleKeydown(_)},d.tooltipMouseEnterHandler=function(){d.handleTooltipMouseEnter()},d.tooltipMouseLeaveHandler=function(){d.handleTooltipMouseLeave()},d.richTooltipFocusOutHandler=function(_){d.handleRichTooltipFocusOut(_)},d.windowScrollHandler=function(){d.handleWindowScrollEvent()},d.windowResizeHandler=function(){d.handleWindowChangeEvent()},d}return Object.defineProperty(a,"defaultAdapter",{get:function(){return{getAttribute:function(){return null},setAttribute:function(){},removeAttribute:function(){},addClass:function(){},hasClass:function(){return!1},removeClass:function(){},getComputedStyleProperty:function(){return""},setStyleProperty:function(){},setSurfaceAnimationStyleProperty:function(){},getViewportWidth:function(){return 0},getViewportHeight:function(){return 0},getTooltipSize:function(){return{width:0,height:0}},getAnchorBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},getParentBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},getAnchorAttribute:function(){return null},setAnchorAttribute:function(){return null},isRTL:function(){return!1},anchorContainsElement:function(){return!1},tooltipContainsElement:function(){return!1},focusAnchorElement:function(){},registerEventHandler:function(){},deregisterEventHandler:function(){},registerAnchorEventHandler:function(){},deregisterAnchorEventHandler:function(){},registerDocumentEventHandler:function(){},deregisterDocumentEventHandler:function(){},registerWindowEventHandler:function(){},deregisterWindowEventHandler:function(){},notifyHidden:function(){},getTooltipCaretBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},setTooltipCaretStyle:function(){},clearTooltipCaretStyles:function(){},getActiveElement:function(){return null}}},enumerable:!1,configurable:!0}),a.prototype.init=function(){this.richTooltip=this.adapter.hasClass($b),this.persistentTooltip=this.adapter.getAttribute(Qg.PERSISTENT)==="true",this.interactiveTooltip=!!this.adapter.getAnchorAttribute(Qg.ARIA_EXPANDED)&&this.adapter.getAnchorAttribute(Qg.ARIA_HASPOPUP)==="dialog",this.hasCaret=this.richTooltip&&this.adapter.getAttribute(Qg.HAS_CARET)==="true"},a.prototype.isShown=function(){return this.tooltipShown},a.prototype.isRich=function(){return this.richTooltip},a.prototype.isPersistent=function(){return this.persistentTooltip},a.prototype.handleAnchorMouseEnter=function(){var o=this;this.tooltipShown?this.show():(this.clearHideTimeout(),this.showTimeout=setTimeout(function(){o.show()},this.showDelayMs))},a.prototype.handleAnchorTouchstart=function(){var o=this;this.showTimeout=setTimeout(function(){o.show()},this.showDelayMs),this.adapter.registerWindowEventHandler("contextmenu",this.preventContextMenuOnLongTouch)},a.prototype.preventContextMenuOnLongTouch=function(o){o.preventDefault()},a.prototype.handleAnchorTouchend=function(){this.clearShowTimeout(),this.isShown()||this.adapter.deregisterWindowEventHandler("contextmenu",this.preventContextMenuOnLongTouch)},a.prototype.handleAnchorFocus=function(o){var d=this,_=o.relatedTarget,v=_ instanceof HTMLElement&&this.adapter.tooltipContainsElement(_);v||(this.showTimeout=setTimeout(function(){d.show()},this.showDelayMs))},a.prototype.handleAnchorMouseLeave=function(){var o=this;this.clearShowTimeout(),this.hideTimeout=setTimeout(function(){o.hide()},this.hideDelayMs)},a.prototype.handleAnchorClick=function(){this.tooltipShown?this.hide():this.show()},a.prototype.handleDocumentClick=function(o){var d=o.target instanceof HTMLElement&&(this.adapter.anchorContainsElement(o.target)||this.adapter.tooltipContainsElement(o.target));this.richTooltip&&this.persistentTooltip&&d||this.hide()},a.prototype.handleKeydown=function(o){var d=ao(o);if(d===Gn.ESCAPE){var _=this.adapter.getActiveElement(),v=_ instanceof HTMLElement&&this.adapter.tooltipContainsElement(_);v&&this.adapter.focusAnchorElement(),this.hide()}},a.prototype.handleAnchorBlur=function(o){if(this.richTooltip){var d=o.relatedTarget instanceof HTMLElement&&this.adapter.tooltipContainsElement(o.relatedTarget);if(d||o.relatedTarget===null&&this.interactiveTooltip)return}this.hide()},a.prototype.handleTooltipMouseEnter=function(){this.show()},a.prototype.handleTooltipMouseLeave=function(){var o=this;this.clearShowTimeout(),this.hideTimeout=setTimeout(function(){o.hide()},this.hideDelayMs)},a.prototype.handleRichTooltipFocusOut=function(o){var d=o.relatedTarget instanceof HTMLElement&&(this.adapter.anchorContainsElement(o.relatedTarget)||this.adapter.tooltipContainsElement(o.relatedTarget));d||o.relatedTarget===null&&this.interactiveTooltip||this.hide()},a.prototype.handleWindowScrollEvent=function(){if(this.persistentTooltip){this.handleWindowChangeEvent();return}this.hide()},a.prototype.handleWindowChangeEvent=function(){var o=this;this.animFrame.request(Ov.POLL_ANCHOR,function(){o.repositionTooltipOnAnchorMove()})},a.prototype.show=function(){var o,d,_=this;if(this.clearHideTimeout(),this.clearShowTimeout(),!this.tooltipShown){this.tooltipShown=!0,this.adapter.removeAttribute("aria-hidden"),this.richTooltip&&(this.interactiveTooltip&&this.adapter.setAnchorAttribute("aria-expanded","true"),this.adapter.registerEventHandler("focusout",this.richTooltipFocusOutHandler)),this.persistentTooltip||(this.adapter.registerEventHandler("mouseenter",this.tooltipMouseEnterHandler),this.adapter.registerEventHandler("mouseleave",this.tooltipMouseLeaveHandler)),this.adapter.removeClass(Gm),this.adapter.addClass(xv),this.isTooltipMultiline()&&!this.richTooltip&&this.adapter.addClass(ew),this.anchorRect=this.adapter.getAnchorBoundingRect(),this.parentRect=this.adapter.getParentBoundingRect(),this.richTooltip?this.positionRichTooltip():this.positionPlainTooltip(),this.adapter.registerAnchorEventHandler("blur",this.anchorBlurHandler),this.adapter.registerDocumentEventHandler("click",this.documentClickHandler),this.adapter.registerDocumentEventHandler("keydown",this.documentKeydownHandler),this.adapter.registerWindowEventHandler("scroll",this.windowScrollHandler),this.adapter.registerWindowEventHandler("resize",this.windowResizeHandler);try{for(var v=ec(this.addAncestorScrollEventListeners),E=v.next();!E.done;E=v.next()){var r=E.value;r()}}catch(I){o={error:I}}finally{try{E&&!E.done&&(d=v.return)&&d.call(v)}finally{if(o)throw o.error}}this.frameId=requestAnimationFrame(function(){_.clearAllAnimationClasses(),_.adapter.addClass(vv),_.adapter.addClass($g)})}},a.prototype.hide=function(){var o,d;if(this.clearHideTimeout(),this.clearShowTimeout(),!!this.tooltipShown){this.frameId&&cancelAnimationFrame(this.frameId),this.tooltipShown=!1,this.adapter.setAttribute("aria-hidden","true"),this.adapter.deregisterEventHandler("focusout",this.richTooltipFocusOutHandler),this.richTooltip&&this.interactiveTooltip&&this.adapter.setAnchorAttribute("aria-expanded","false"),this.persistentTooltip||(this.adapter.deregisterEventHandler("mouseenter",this.tooltipMouseEnterHandler),this.adapter.deregisterEventHandler("mouseleave",this.tooltipMouseLeaveHandler)),this.clearAllAnimationClasses(),this.adapter.addClass(Gm),this.adapter.addClass(ey),this.adapter.removeClass(vv),this.adapter.deregisterAnchorEventHandler("blur",this.anchorBlurHandler),this.adapter.deregisterDocumentEventHandler("click",this.documentClickHandler),this.adapter.deregisterDocumentEventHandler("keydown",this.documentKeydownHandler),this.adapter.deregisterWindowEventHandler("scroll",this.windowScrollHandler),this.adapter.deregisterWindowEventHandler("resize",this.windowResizeHandler),this.adapter.deregisterWindowEventHandler("contextmenu",this.preventContextMenuOnLongTouch);try{for(var _=ec(this.removeAncestorScrollEventListeners),v=_.next();!v.done;v=_.next()){var E=v.value;E()}}catch(r){o={error:r}}finally{try{v&&!v.done&&(d=_.return)&&d.call(_)}finally{if(o)throw o.error}}}},a.prototype.handleTransitionEnd=function(){var o=this.adapter.hasClass(Gm);this.adapter.removeClass(xv),this.adapter.removeClass($g),this.adapter.removeClass(Gm),this.adapter.removeClass(ey),o&&this.showTimeout===null&&this.adapter.notifyHidden()},a.prototype.clearAllAnimationClasses=function(){this.adapter.removeClass($g),this.adapter.removeClass(ey)},a.prototype.setTooltipPosition=function(o){var d=o.xPos,_=o.yPos,v=o.withCaretPos;if(this.hasCaret&&v){this.tooltipPositionWithCaret=v;return}d&&(this.xTooltipPos=d),_&&(this.yTooltipPos=_)},a.prototype.setAnchorBoundaryType=function(o){o===vy.UNBOUNDED?this.anchorGap=Qa.UNBOUNDED_ANCHOR_GAP:this.anchorGap=Qa.BOUNDED_ANCHOR_GAP},a.prototype.setShowDelay=function(o){this.showDelayMs=o},a.prototype.setHideDelay=function(o){this.hideDelayMs=o},a.prototype.isTooltipMultiline=function(){var o=this.adapter.getTooltipSize();return o.height>Qa.MIN_HEIGHT&&o.width>=Qa.MAX_WIDTH},a.prototype.positionPlainTooltip=function(){var o=this.calculateTooltipStyles(this.anchorRect),d=o.top,_=o.yTransformOrigin,v=o.left,E=o.xTransformOrigin,r=y1?g1(window,"transform"):"transform";this.adapter.setSurfaceAnimationStyleProperty(r+"-origin",E+" "+_),this.adapter.setStyleProperty("top",d+"px"),this.adapter.setStyleProperty("left",v+"px")},a.prototype.positionRichTooltip=function(){var o,d,_,v,E=this.adapter.getComputedStyleProperty("width");this.adapter.setStyleProperty("width",E);var r=this.hasCaret?this.calculateTooltipWithCaretStyles(this.anchorRect):this.calculateTooltipStyles(this.anchorRect),I=r.top,R=r.yTransformOrigin,U=r.left,V=r.xTransformOrigin,Z=y1?g1(window,"transform"):"transform";this.adapter.setSurfaceAnimationStyleProperty(Z+"-origin",V+" "+R);var Y=U-((d=(o=this.parentRect)===null||o===void 0?void 0:o.left)!==null&&d!==void 0?d:0),W=I-((v=(_=this.parentRect)===null||_===void 0?void 0:_.top)!==null&&v!==void 0?v:0);this.adapter.setStyleProperty("top",W+"px"),this.adapter.setStyleProperty("left",Y+"px")},a.prototype.calculateTooltipStyles=function(o){if(!o)return{top:0,left:0};var d=this.adapter.getTooltipSize(),_=this.calculateYTooltipDistance(o,d.height),v=this.calculateXTooltipDistance(o,d.width);return{top:_.distance,yTransformOrigin:_.yTransformOrigin,left:v.distance,xTransformOrigin:v.xTransformOrigin}},a.prototype.calculateXTooltipDistance=function(o,d){var _=!this.adapter.isRTL(),v,E,r,I,R;this.richTooltip?(v=_?o.left-d:o.right,E=_?o.right:o.left-d,I=_?hn.RIGHT:hn.LEFT,R=_?hn.LEFT:hn.RIGHT):(v=_?o.left:o.right-d,E=_?o.right-d:o.left,r=o.left+(o.width-d)/2,I=_?hn.LEFT:hn.RIGHT,R=_?hn.RIGHT:hn.LEFT);var U=this.richTooltip?this.determineValidPositionOptions(v,E):this.determineValidPositionOptions(r,v,E);if(this.xTooltipPos===sf.START&&U.has(v))return{distance:v,xTransformOrigin:I};if(this.xTooltipPos===sf.END&&U.has(E))return{distance:E,xTransformOrigin:R};if(this.xTooltipPos===sf.CENTER&&U.has(r))return{distance:r,xTransformOrigin:hn.CENTER};var V=this.richTooltip?[{distance:E,xTransformOrigin:R},{distance:v,xTransformOrigin:I}]:[{distance:r,xTransformOrigin:hn.CENTER},{distance:v,xTransformOrigin:I},{distance:E,xTransformOrigin:R}],Z=V.find(function(te){var ae=te.distance;return U.has(ae)});if(Z)return Z;if(o.left<0)return{distance:this.minViewportTooltipThreshold,xTransformOrigin:hn.LEFT};var Y=this.adapter.getViewportWidth(),W=Y-(d+this.minViewportTooltipThreshold);return{distance:W,xTransformOrigin:hn.RIGHT}},a.prototype.determineValidPositionOptions=function(){for(var o,d,_=[],v=0;v<arguments.length;v++)_[v]=arguments[v];var E=new Set,r=new Set;try{for(var I=ec(_),R=I.next();!R.done;R=I.next()){var U=R.value;this.positionHonorsViewportThreshold(U)?E.add(U):this.positionDoesntCollideWithViewport(U)&&r.add(U)}}catch(V){o={error:V}}finally{try{R&&!R.done&&(d=I.return)&&d.call(I)}finally{if(o)throw o.error}}return E.size?E:r},a.prototype.positionHonorsViewportThreshold=function(o){var d=this.adapter.getViewportWidth(),_=this.adapter.getTooltipSize().width;return o+_<=d-this.minViewportTooltipThreshold&&o>=this.minViewportTooltipThreshold},a.prototype.positionDoesntCollideWithViewport=function(o){var d=this.adapter.getViewportWidth(),_=this.adapter.getTooltipSize().width;return o+_<=d&&o>=0},a.prototype.calculateYTooltipDistance=function(o,d){var _=o.bottom+this.anchorGap,v=o.top-(this.anchorGap+d),E=this.determineValidYPositionOptions(v,_);return this.yTooltipPos===Sp.ABOVE&&E.has(v)?{distance:v,yTransformOrigin:hn.BOTTOM}:this.yTooltipPos===Sp.BELOW&&E.has(_)?{distance:_,yTransformOrigin:hn.TOP}:E.has(_)?{distance:_,yTransformOrigin:hn.TOP}:E.has(v)?{distance:v,yTransformOrigin:hn.BOTTOM}:{distance:_,yTransformOrigin:hn.TOP}},a.prototype.determineValidYPositionOptions=function(o,d){var _=new Set,v=new Set;return this.yPositionHonorsViewportThreshold(o)?_.add(o):this.yPositionDoesntCollideWithViewport(o)&&v.add(o),this.yPositionHonorsViewportThreshold(d)?_.add(d):this.yPositionDoesntCollideWithViewport(d)&&v.add(d),_.size?_:v},a.prototype.yPositionHonorsViewportThreshold=function(o){var d=this.adapter.getViewportHeight(),_=this.adapter.getTooltipSize().height;return o+_+this.minViewportTooltipThreshold<=d&&o>=this.minViewportTooltipThreshold},a.prototype.yPositionDoesntCollideWithViewport=function(o){var d=this.adapter.getViewportHeight(),_=this.adapter.getTooltipSize().height;return o+_<=d&&o>=0},a.prototype.calculateTooltipWithCaretStyles=function(o){this.adapter.clearTooltipCaretStyles();var d=this.adapter.getTooltipCaretBoundingRect();if(!o||!d)return{position:Yn.DETECTED,top:0,left:0};var _=d.width/Qa.ANIMATION_SCALE,v=d.height/Qa.ANIMATION_SCALE/2,E=this.adapter.getTooltipSize(),r=this.calculateYWithCaretDistanceOptions(o,E.height,{caretWidth:_,caretHeight:v}),I=this.calculateXWithCaretDistanceOptions(o,E.width,{caretWidth:_,caretHeight:v}),R=this.validateTooltipWithCaretDistances(r,I);R.size<1&&(R=this.generateBackupPositionOption(o,E,{caretWidth:_,caretHeight:v}));var U=this.determineTooltipWithCaretDistance(R),V=U.position,Z=U.xDistance,Y=U.yDistance,W=this.setCaretPositionStyles(V,{caretWidth:_,caretHeight:v}),te=W.yTransformOrigin,ae=W.xTransformOrigin;return{yTransformOrigin:te,xTransformOrigin:ae,top:Y,left:Z}},a.prototype.calculateXWithCaretDistanceOptions=function(o,d,_){var v=_.caretWidth,E=_.caretHeight,r=!this.adapter.isRTL(),I=o.left+o.width/2,R=o.left-(d+this.anchorGap+E),U=o.right+this.anchorGap+E,V=r?R:U,Z=r?U:R,Y=I-(Qa.CARET_INDENTATION+v/2),W=I-(d-Qa.CARET_INDENTATION-v/2),te=r?Y:W,ae=r?W:Y,Ie=I-d/2,ye=new Map([[pr.START,te],[pr.CENTER,Ie],[pr.END,ae],[pr.SIDE_END,Z],[pr.SIDE_START,V]]);return ye},a.prototype.calculateYWithCaretDistanceOptions=function(o,d,_){var v=_.caretWidth,E=_.caretHeight,r=o.top+o.height/2,I=o.bottom+this.anchorGap+E,R=o.top-(this.anchorGap+d+E),U=r-(Qa.CARET_INDENTATION+v/2),V=r-d/2,Z=r-(d-Qa.CARET_INDENTATION-v/2),Y=new Map([[Bo.ABOVE,R],[Bo.BELOW,I],[Bo.SIDE_TOP,U],[Bo.SIDE_CENTER,V],[Bo.SIDE_BOTTOM,Z]]);return Y},a.prototype.repositionTooltipOnAnchorMove=function(){var o=this.adapter.getAnchorBoundingRect();!o||!this.anchorRect||(o.top!==this.anchorRect.top||o.left!==this.anchorRect.left||o.height!==this.anchorRect.height||o.width!==this.anchorRect.width)&&(this.anchorRect=o,this.parentRect=this.adapter.getParentBoundingRect(),this.richTooltip?this.positionRichTooltip():this.positionPlainTooltip())},a.prototype.validateTooltipWithCaretDistances=function(o,d){var _,v,E,r,I,R,U=new Map,V=new Map,Z=new Map([[Bo.ABOVE,[pr.START,pr.CENTER,pr.END]],[Bo.BELOW,[pr.START,pr.CENTER,pr.END]],[Bo.SIDE_TOP,[pr.SIDE_START,pr.SIDE_END]],[Bo.SIDE_CENTER,[pr.SIDE_START,pr.SIDE_END]],[Bo.SIDE_BOTTOM,[pr.SIDE_START,pr.SIDE_END]]]);try{for(var Y=ec(Z.keys()),W=Y.next();!W.done;W=Y.next()){var te=W.value,ae=o.get(te);if(this.yPositionHonorsViewportThreshold(ae))try{for(var Ie=(E=void 0,ec(Z.get(te))),ye=Ie.next();!ye.done;ye=Ie.next()){var Ue=ye.value,je=d.get(Ue);if(this.positionHonorsViewportThreshold(je)){var _e=this.caretPositionOptionsMapping(Ue,te);U.set(_e,{xDistance:je,yDistance:ae})}}}catch(St){E={error:St}}finally{try{ye&&!ye.done&&(r=Ie.return)&&r.call(Ie)}finally{if(E)throw E.error}}if(this.yPositionDoesntCollideWithViewport(ae))try{for(var ct=(I=void 0,ec(Z.get(te))),lt=ct.next();!lt.done;lt=ct.next()){var Ue=lt.value,je=d.get(Ue);if(this.positionDoesntCollideWithViewport(je)){var _e=this.caretPositionOptionsMapping(Ue,te);V.set(_e,{xDistance:je,yDistance:ae})}}}catch(St){I={error:St}}finally{try{lt&&!lt.done&&(R=ct.return)&&R.call(ct)}finally{if(I)throw I.error}}}}catch(St){_={error:St}}finally{try{W&&!W.done&&(v=Y.return)&&v.call(Y)}finally{if(_)throw _.error}}return U.size?U:V},a.prototype.generateBackupPositionOption=function(o,d,_){var v=!this.adapter.isRTL(),E,r;if(o.left<0)E=this.minViewportTooltipThreshold+_.caretHeight,r=v?pr.END:pr.START;else{var I=this.adapter.getViewportWidth();E=I-(d.width+this.minViewportTooltipThreshold+_.caretHeight),r=v?pr.START:pr.END}var R,U;if(o.top<0)R=this.minViewportTooltipThreshold+_.caretHeight,U=Bo.BELOW;else{var V=this.adapter.getViewportHeight();R=V-(d.height+this.minViewportTooltipThreshold+_.caretHeight),U=Bo.ABOVE}var Z=this.caretPositionOptionsMapping(r,U);return new Map([[Z,{xDistance:E,yDistance:R}]])},a.prototype.determineTooltipWithCaretDistance=function(o){if(o.has(this.tooltipPositionWithCaret)){var d=o.get(this.tooltipPositionWithCaret);return{position:this.tooltipPositionWithCaret,xDistance:d.xDistance,yDistance:d.yDistance}}var _=[Yn.ABOVE_START,Yn.ABOVE_CENTER,Yn.ABOVE_END,Yn.TOP_SIDE_START,Yn.CENTER_SIDE_START,Yn.BOTTOM_SIDE_START,Yn.TOP_SIDE_END,Yn.CENTER_SIDE_END,Yn.BOTTOM_SIDE_END,Yn.BELOW_START,Yn.BELOW_CENTER,Yn.BELOW_END],v=_.find(function(r){return o.has(r)}),E=o.get(v);return{position:v,xDistance:E.xDistance,yDistance:E.yDistance}},a.prototype.caretPositionOptionsMapping=function(o,d){switch(d){case Bo.ABOVE:if(o===pr.START)return Yn.ABOVE_START;if(o===pr.CENTER)return Yn.ABOVE_CENTER;if(o===pr.END)return Yn.ABOVE_END;break;case Bo.BELOW:if(o===pr.START)return Yn.BELOW_START;if(o===pr.CENTER)return Yn.BELOW_CENTER;if(o===pr.END)return Yn.BELOW_END;break;case Bo.SIDE_TOP:if(o===pr.SIDE_START)return Yn.TOP_SIDE_START;if(o===pr.SIDE_END)return Yn.TOP_SIDE_END;break;case Bo.SIDE_CENTER:if(o===pr.SIDE_START)return Yn.CENTER_SIDE_START;if(o===pr.SIDE_END)return Yn.CENTER_SIDE_END;break;case Bo.SIDE_BOTTOM:if(o===pr.SIDE_START)return Yn.BOTTOM_SIDE_START;if(o===pr.SIDE_END)return Yn.BOTTOM_SIDE_END;break}throw new Error("MDCTooltipFoundation: Invalid caret position of "+o+", "+d)},a.prototype.setCaretPositionStyles=function(o,d){var _,v,E=this.calculateCaretPositionOnTooltip(o,d);if(!E)return{yTransformOrigin:0,xTransformOrigin:0};this.adapter.clearTooltipCaretStyles(),this.adapter.setTooltipCaretStyle(E.yAlignment,E.yAxisPx),this.adapter.setTooltipCaretStyle(E.xAlignment,E.xAxisPx);var r=E.skew*(Math.PI/180),I=Math.cos(r);this.adapter.setTooltipCaretStyle("transform","rotate("+E.rotation+"deg) skewY("+E.skew+"deg) scaleX("+I+")"),this.adapter.setTooltipCaretStyle("transform-origin",E.xAlignment+" "+E.yAlignment);try{for(var R=ec(E.caretCorners),U=R.next();!U.done;U=R.next()){var V=U.value;this.adapter.setTooltipCaretStyle(V,"0")}}catch(Z){_={error:Z}}finally{try{U&&!U.done&&(v=R.return)&&v.call(R)}finally{if(_)throw _.error}}return{yTransformOrigin:E.yTransformOrigin,xTransformOrigin:E.xTransformOrigin}},a.prototype.calculateCaretPositionOnTooltip=function(o,d){var _=!this.adapter.isRTL(),v=this.adapter.getComputedStyleProperty("width"),E=this.adapter.getComputedStyleProperty("height");if(!(!v||!E||!d)){var r="calc(("+v+" - "+d.caretWidth+"px) / 2)",I="calc(("+E+" - "+d.caretWidth+"px) / 2)",R="0",U=Qa.CARET_INDENTATION+"px",V="calc("+v+" - "+U+")",Z="calc("+E+" - "+U+")",Y=35,W=Math.abs(90-Y),te=["border-bottom-right-radius","border-top-left-radius"],ae=["border-bottom-left-radius","border-top-right-radius"],Ie=20;switch(o){case Yn.BELOW_CENTER:return{yAlignment:hn.TOP,xAlignment:hn.LEFT,yAxisPx:R,xAxisPx:r,rotation:-1*Y,skew:-1*Ie,xTransformOrigin:r,yTransformOrigin:R,caretCorners:te};case Yn.BELOW_END:return{yAlignment:hn.TOP,xAlignment:_?hn.RIGHT:hn.LEFT,yAxisPx:R,xAxisPx:U,rotation:_?Y:-1*Y,skew:_?Ie:-1*Ie,xTransformOrigin:_?V:U,yTransformOrigin:R,caretCorners:_?ae:te};case Yn.BELOW_START:return{yAlignment:hn.TOP,xAlignment:_?hn.LEFT:hn.RIGHT,yAxisPx:R,xAxisPx:U,rotation:_?-1*Y:Y,skew:_?-1*Ie:Ie,xTransformOrigin:_?U:V,yTransformOrigin:R,caretCorners:_?te:ae};case Yn.TOP_SIDE_END:return{yAlignment:hn.TOP,xAlignment:_?hn.LEFT:hn.RIGHT,yAxisPx:U,xAxisPx:R,rotation:_?W:-1*W,skew:_?-1*Ie:Ie,xTransformOrigin:_?R:v,yTransformOrigin:U,caretCorners:_?te:ae};case Yn.CENTER_SIDE_END:return{yAlignment:hn.TOP,xAlignment:_?hn.LEFT:hn.RIGHT,yAxisPx:I,xAxisPx:R,rotation:_?W:-1*W,skew:_?-1*Ie:Ie,xTransformOrigin:_?R:v,yTransformOrigin:I,caretCorners:_?te:ae};case Yn.BOTTOM_SIDE_END:return{yAlignment:hn.BOTTOM,xAlignment:_?hn.LEFT:hn.RIGHT,yAxisPx:U,xAxisPx:R,rotation:_?-1*W:W,skew:_?Ie:-1*Ie,xTransformOrigin:_?R:v,yTransformOrigin:Z,caretCorners:_?ae:te};case Yn.TOP_SIDE_START:return{yAlignment:hn.TOP,xAlignment:_?hn.RIGHT:hn.LEFT,yAxisPx:U,xAxisPx:R,rotation:_?-1*W:W,skew:_?Ie:-1*Ie,xTransformOrigin:_?v:R,yTransformOrigin:U,caretCorners:_?ae:te};case Yn.CENTER_SIDE_START:return{yAlignment:hn.TOP,xAlignment:_?hn.RIGHT:hn.LEFT,yAxisPx:I,xAxisPx:R,rotation:_?-1*W:W,skew:_?Ie:-1*Ie,xTransformOrigin:_?v:R,yTransformOrigin:I,caretCorners:_?ae:te};case Yn.BOTTOM_SIDE_START:return{yAlignment:hn.BOTTOM,xAlignment:_?hn.RIGHT:hn.LEFT,yAxisPx:U,xAxisPx:R,rotation:_?W:-1*W,skew:_?-1*Ie:Ie,xTransformOrigin:_?v:R,yTransformOrigin:Z,caretCorners:_?te:ae};case Yn.ABOVE_CENTER:return{yAlignment:hn.BOTTOM,xAlignment:hn.LEFT,yAxisPx:R,xAxisPx:r,rotation:Y,skew:Ie,xTransformOrigin:r,yTransformOrigin:E,caretCorners:ae};case Yn.ABOVE_END:return{yAlignment:hn.BOTTOM,xAlignment:_?hn.RIGHT:hn.LEFT,yAxisPx:R,xAxisPx:U,rotation:_?-1*Y:Y,skew:_?-1*Ie:Ie,xTransformOrigin:_?V:U,yTransformOrigin:E,caretCorners:_?te:ae};default:case Yn.ABOVE_START:return{yAlignment:hn.BOTTOM,xAlignment:_?hn.LEFT:hn.RIGHT,yAxisPx:R,xAxisPx:U,rotation:_?Y:-1*Y,skew:_?Ie:-1*Ie,xTransformOrigin:_?U:V,yTransformOrigin:E,caretCorners:_?ae:te}}}},a.prototype.clearShowTimeout=function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)},a.prototype.clearHideTimeout=function(){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)},a.prototype.attachScrollHandler=function(o){var d=this;this.addAncestorScrollEventListeners.push(function(){o("scroll",d.windowScrollHandler)})},a.prototype.removeScrollHandler=function(o){var d=this;this.removeAncestorScrollEventListeners.push(function(){o("scroll",d.windowScrollHandler)})},a.prototype.destroy=function(){var o,d;this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null),this.clearHideTimeout(),this.clearShowTimeout(),this.adapter.removeClass(vv),this.adapter.removeClass($g),this.adapter.removeClass(xv),this.adapter.removeClass(Gm),this.adapter.removeClass(ey),this.richTooltip&&this.adapter.deregisterEventHandler("focusout",this.richTooltipFocusOutHandler),this.persistentTooltip||(this.adapter.deregisterEventHandler("mouseenter",this.tooltipMouseEnterHandler),this.adapter.deregisterEventHandler("mouseleave",this.tooltipMouseLeaveHandler)),this.adapter.deregisterAnchorEventHandler("blur",this.anchorBlurHandler),this.adapter.deregisterDocumentEventHandler("click",this.documentClickHandler),this.adapter.deregisterDocumentEventHandler("keydown",this.documentKeydownHandler),this.adapter.deregisterWindowEventHandler("scroll",this.windowScrollHandler),this.adapter.deregisterWindowEventHandler("resize",this.windowResizeHandler);try{for(var _=ec(this.removeAncestorScrollEventListeners),v=_.next();!v.done;v=_.next()){var E=v.value;E()}}catch(r){o={error:r}}finally{try{v&&!v.done&&(d=_.return)&&d.call(_)}finally{if(o)throw o.error}}this.animFrame.cancelAll()},a}(lu);function Un(s){return Object.entries(s).filter(([a,o])=>a!==""&&o).map(([a])=>a).join(" ")}function Us(s,a,o,d={bubbles:!0},_=!1){if(typeof Event>"u")throw new Error("Event not defined.");if(!s)throw new Error("Tried to dipatch event without element.");const v=new CustomEvent(a,Object.assign(Object.assign({},d),{detail:o}));if(s==null||s.dispatchEvent(v),_&&a.startsWith("SMUI")){const E=new CustomEvent(a.replace(/^SMUI/g,()=>"MDC"),Object.assign(Object.assign({},d),{detail:o}));s==null||s.dispatchEvent(E),E.defaultPrevented&&v.preventDefault()}return v}function xy(s,a){let o=Object.getOwnPropertyNames(s);const d={};for(let _=0;_<o.length;_++){const v=o[_],E=v.indexOf("$");E!==-1&&a.indexOf(v.substring(0,E+1))!==-1||a.indexOf(v)===-1&&(d[v]=s[v])}return d}const v1=/^[a-z]+(?::(?:preventDefault|stopPropagation|passive|nonpassive|capture|once|self))+$/,iw=/^[^$]+(?:\$(?:preventDefault|stopPropagation|passive|nonpassive|capture|once|self))+$/;function Wo(s){let a,o=[];s.$on=(_,v)=>{let E=_,r=()=>{};return a?r=a(E,v):o.push([E,v]),E.match(v1)&&console&&console.warn('Event modifiers in SMUI now use "$" instead of ":", so that all events can be bound with modifiers. Please update your event binding: ',E),()=>{r()}};function d(_){Jm(s,_)}return _=>{const v=[],E={};a=(r,I)=>{let R=r,U=I,V=!1;const Z=R.match(v1),Y=R.match(iw),W=Z||Y;if(R.match(/^SMUI:\w+:/)){const Ie=R.split(":");let ye="";for(let Ue=0;Ue<Ie.length;Ue++)ye+=Ue===Ie.length-1?":"+Ie[Ue]:Ie[Ue].split("-").map(je=>je.slice(0,1).toUpperCase()+je.slice(1)).join("");console.warn(`The event ${R.split("$")[0]} has been renamed to ${ye.split("$")[0]}.`),R=ye}if(W){const Ie=R.split(Z?":":"$");R=Ie[0];const ye=Ie.slice(1).reduce((Ue,je)=>(Ue[je]=!0,Ue),{});ye.passive&&(V=V||{},V.passive=!0),ye.nonpassive&&(V=V||{},V.passive=!1),ye.capture&&(V=V||{},V.capture=!0),ye.once&&(V=V||{},V.once=!0),ye.preventDefault&&(U=Tb(U)),ye.stopPropagation&&(U=Ib(U))}const te=xo(_,R,U,V),ae=()=>{te();const Ie=v.indexOf(ae);Ie>-1&&v.splice(Ie,1)};return v.push(ae),R in E||(E[R]=xo(_,R,d)),ae};for(let r=0;r<o.length;r++)a(o[r][0],o[r][1]);return{destroy:()=>{for(let r=0;r<v.length;r++)v[r]();for(let r of Object.entries(E))r[1]()}}}}function as(s,a){let o=Object.getOwnPropertyNames(s);const d={};for(let _=0;_<o.length;_++){const v=o[_];v.substring(0,a.length)===a&&(d[v.substring(a.length)]=s[v])}return d}function ca(s,a){let o=[];if(a)for(let d=0;d<a.length;d++){const _=a[d],v=Array.isArray(_)?_[0]:_;Array.isArray(_)&&_.length>1?o.push(v(s,_[1])):o.push(v(s))}return{update(d){if((d&&d.length||0)!=o.length)throw new Error("You must not change the length of an actions array.");if(d)for(let _=0;_<d.length;_++){const v=o[_];if(v&&v.update){const E=d[_];Array.isArray(E)&&E.length>1?v.update(E[1]):v.update()}}},destroy(){for(let d=0;d<o.length;d++){const _=o[d];_&&_.destroy&&_.destroy()}}}}function nw(s){let a,o,d,_,v,E,r,I,R,U,V,Z,Y;const W=s[32].default,te=Ss(W,s,s[31],null);let ae=[{class:d=Un({[s[6]]:!0,"mdc-tooltip__surface":!0,"mdc-tooltip__surface-animation":!0})},{style:_=Object.entries(s[13]).map(x1).concat([s[7]]).join(" ")},as(s[19],"surface$")],Ie={};for(let je=0;je<ae.length;je+=1)Ie=Ai(Ie,ae[je]);let ye=[{class:v=Un({[s[1]]:!0,"mdc-tooltip":!0,"mdc-tooltip--rich":s[18],...s[10]})},{style:E=Object.entries(s[11]).map(b1).concat([s[2]]).join(" ")},{"aria-hidden":"true"},{id:s[3]},{"data-mdc-tooltip-persist":r=s[18]&&s[4]?"true":void 0},{"data-mdc-tooltip-persistent":I=s[18]&&s[4]?"true":void 0},{"data-mdc-tooltip-has-caret":void 0},{"data-hide-tooltip-from-screenreader":R=s[5]?"true":void 0},s[14],s[12],xy(s[19],["surface$"])],Ue={};for(let je=0;je<ye.length;je+=1)Ue=Ai(Ue,ye[je]);return{c(){a=pn("div"),o=pn("div"),te&&te.c(),this.h()},l(je){a=mn(je,"DIV",{class:!0,style:!0,"aria-hidden":!0,id:!0,"data-mdc-tooltip-persist":!0,"data-mdc-tooltip-persistent":!0,"data-mdc-tooltip-has-caret":!0,"data-hide-tooltip-from-screenreader":!0});var _e=xn(a);o=mn(_e,"DIV",{class:!0,style:!0});var ct=xn(o);te&&te.l(ct),ct.forEach(Tt),_e.forEach(Tt),this.h()},h(){Cr(o,Ie),Cr(a,Ue)},m(je,_e){pi(je,a,_e),ln(a,o),te&&te.m(o,null),s[33](a),V=!0,Z||(Y=[Lr(U=ca.call(null,a,s[0])),Lr(s[15].call(null,a)),xo(a,"transitionend",s[34])],Z=!0)},p(je,_e){te&&te.p&&(!V||_e[1]&1)&&Cs(te,W,je,je[31],V?Ds(W,je[31],_e,null):Ls(je[31]),null),Cr(o,Ie=yr(ae,[(!V||_e[0]&64&&d!==(d=Un({[je[6]]:!0,"mdc-tooltip__surface":!0,"mdc-tooltip__surface-animation":!0})))&&{class:d},(!V||_e[0]&8320&&_!==(_=Object.entries(je[13]).map(x1).concat([je[7]]).join(" ")))&&{style:_},_e[0]&524288&&as(je[19],"surface$")])),Cr(a,Ue=yr(ye,[(!V||_e[0]&1026&&v!==(v=Un({[je[1]]:!0,"mdc-tooltip":!0,"mdc-tooltip--rich":je[18],...je[10]})))&&{class:v},(!V||_e[0]&2052&&E!==(E=Object.entries(je[11]).map(b1).concat([je[2]]).join(" ")))&&{style:E},{"aria-hidden":"true"},(!V||_e[0]&8)&&{id:je[3]},(!V||_e[0]&16&&r!==(r=je[18]&&je[4]?"true":void 0))&&{"data-mdc-tooltip-persist":r},(!V||_e[0]&16&&I!==(I=je[18]&&je[4]?"true":void 0))&&{"data-mdc-tooltip-persistent":I},{"data-mdc-tooltip-has-caret":void 0},(!V||_e[0]&32&&R!==(R=je[5]?"true":void 0))&&{"data-hide-tooltip-from-screenreader":R},_e[0]&16384&&je[14],_e[0]&4096&&je[12],_e[0]&524288&&xy(je[19],["surface$"])])),U&&As(U.update)&&_e[0]&1&&U.update.call(null,je[0])},i(je){V||(Ot(te,je),V=!0)},o(je){jt(te,je),V=!1},d(je){je&&Tt(a),te&&te.d(je),s[33](null),Z=!1,Al(Y)}}}let rw=0;const x1=([s,a])=>`${s}: ${a};`,b1=([s,a])=>`${s}: ${a};`;function sw(s,a,o){let d;const _=["use","class","style","id","unbounded","xPos","yPos","persistent","interactive","hideFromScreenreader","showDelay","hideDelay","surface$class","surface$style","attachScrollHandler","removeScrollHandler","getElement"];let v=hr(a,_),E,r,{$$slots:I={},$$scope:R}=a;const U=Wo(qo());let{use:V=[]}=a,{class:Z=""}=a,{style:Y=""}=a,{id:W="SMUI-tooltip-"+rw++}=a,{unbounded:te=!1}=a,{xPos:ae="detected"}=a,{yPos:Ie="detected"}=a,{persistent:ye=!1}=a,{interactive:Ue=ye}=a,{hideFromScreenreader:je=!1}=a,{showDelay:_e=void 0}=a,{hideDelay:ct=void 0}=a,{surface$class:lt=""}=a,{surface$style:St=""}=a,Bt,et,ot={setParent(Be){Object.defineProperty(this,"parent",{value:Be})},setNextSibling(Be){Object.defineProperty(this,"nextSibling",{value:Be})}},Nt={},qt={},_t={},dt={},ti=Ks("SMUI:tooltip:wrapper:anchor");Vu(s,ti,Be=>o(30,E=Be));let Vi=Ks("SMUI:tooltip:wrapper:tooltip");Vu(s,Vi,Be=>o(35,r=Be));const Gt=Ks("SMUI:tooltip:rich");let Yi;ic(()=>(o(8,et=new tw({getAttribute:Ei,setAttribute:Wt,removeAttribute:Vn,addClass:Dn,hasClass:Ni,removeClass:bn,getComputedStyleProperty:Be=>{const li=Ji();let qi=getComputedStyle(li).getPropertyValue(Be);return qi==="auto"&&(li.classList.add("smui-banner--force-show"),qi=getComputedStyle(li).getPropertyValue(Be),li.classList.remove("smui-banner--force-show")),qi},setStyleProperty:ui,setSurfaceAnimationStyleProperty:Wi,getViewportWidth:()=>window.innerWidth,getViewportHeight:()=>window.innerHeight,getTooltipSize:()=>{const Be=Ji();let li={width:Be.offsetWidth,height:Be.offsetHeight};return(li.width===0||li.height===0)&&(Be.classList.add("smui-banner--force-show"),li={width:Be.offsetWidth,height:Be.offsetHeight},Be.classList.remove("smui-banner--force-show")),li},getAnchorBoundingRect:()=>E?E.getBoundingClientRect():null,getParentBoundingRect:()=>{let Be=Ji().parentElement;return Gt||(Be=document.body),(Be==null?void 0:Be.getBoundingClientRect())||null},getAnchorAttribute:Be=>E?E.getAttribute(Be):null,setAnchorAttribute:(Be,li)=>{E&&E.setAttribute(Be,li)},isRTL:()=>getComputedStyle(Ji()).direction==="rtl",anchorContainsElement:Be=>!!(E&&E.contains(Be)),tooltipContainsElement:Be=>Ji().contains(Be),focusAnchorElement:()=>{E&&E.focus()},registerEventHandler:(Be,li)=>{Ji().addEventListener(Be,li)},deregisterEventHandler:(Be,li)=>{Ji().removeEventListener(Be,li)},registerAnchorEventHandler:(Be,li)=>{E&&E.addEventListener(Be,li)},deregisterAnchorEventHandler:(Be,li)=>{E&&E.removeEventListener(Be,li)},registerDocumentEventHandler:(Be,li)=>{document.body.addEventListener(Be,li)},deregisterDocumentEventHandler:(Be,li)=>{document.body.removeEventListener(Be,li)},registerWindowEventHandler:(Be,li)=>{window.addEventListener(Be,li,Be==="scroll"&&{capture:!0,passive:!0})},deregisterWindowEventHandler:(Be,li)=>{window.removeEventListener(Be,li,Be==="scroll"&&{capture:!0,passive:!0})},notifyHidden:()=>{Us(Ji(),"SMUITooltip:hidden",void 0,void 0,!0)},getTooltipCaretBoundingRect:()=>{const Be=Ji().querySelector(`.${Ml.TOOLTIP_CARET_TOP}`);return Be?Be.getBoundingClientRect():null},setTooltipCaretStyle:(Be,li)=>{const qi=Ji().querySelector(`.${Ml.TOOLTIP_CARET_TOP}`),Ci=Ji().querySelector(`.${Ml.TOOLTIP_CARET_BOTTOM}`);!qi||!Ci||(qi.style.setProperty(Be,li),Ci.style.setProperty(Be,li))},clearTooltipCaretStyles:()=>{const Be=Ji().querySelector(`.${Ml.TOOLTIP_CARET_TOP}`),li=Ji().querySelector(`.${Ml.TOOLTIP_CARET_BOTTOM}`);!Be||!li||(Be.removeAttribute("style"),li.removeAttribute("style"))},getActiveElement:()=>document.activeElement})),Qm(Vi,r=Bt,r),()=>{E&&Gi(E)})),ud(()=>{var Be;!Gt&&typeof document<"u"&&document.body===Ji().parentElement&&ot.parent!==Ji().parentElement&&(!((Be=ot.parent)===null||Be===void 0)&&Be.insertBefore)&&ot.nextSibling&&ot.parent.insertBefore(Ji(),ot.nextSibling)});function Gi(Be){Be.removeEventListener("focusout",It),Gt&&ye?(Be.removeEventListener("click",wt),Be.removeEventListener("keydown",wt)):(Be.removeEventListener("mouseenter",Ii),Be.removeEventListener("focusin",dn),Be.removeEventListener("mouseleave",$t),Be.removeEventListener("touchstart",gt),Be.removeEventListener("touchend",Si)),Gt&&Ue?(Be.removeAttribute("aria-haspopup"),Be.removeAttribute("aria-expanded"),Be.removeAttribute("data-tooltip-id")):Be.removeAttribute("aria-describedby"),et.destroy()}function ki(Be){Be.addEventListener("focusout",It),Gt&&ye?(Be.addEventListener("click",wt),Be.addEventListener("keydown",wt)):(Be.addEventListener("mouseenter",Ii),Be.addEventListener("focusin",dn),Be.addEventListener("mouseleave",$t),Be.addEventListener("touchstart",gt),Be.addEventListener("touchend",Si)),Gt&&Ue?(Be.setAttribute("aria-haspopup","dialog"),Be.setAttribute("aria-expanded","false"),Be.setAttribute("data-tooltip-id",W)):Be.setAttribute("aria-describedby",W),Gt||Pi(),et.init()}function Ni(Be){return Be in Nt?Nt[Be]:Ji().classList.contains(Be)}function Dn(Be){Nt[Be]||o(10,Nt[Be]=!0,Nt)}function bn(Be){(!(Be in Nt)||Nt[Be])&&o(10,Nt[Be]=!1,Nt)}function ui(Be,li){qt[Be]!=li&&(li===""||li==null?(delete qt[Be],o(11,qt)):o(11,qt[Be]=li,qt))}function Wi(Be,li){dt[Be]!=li&&(li===""||li==null?(delete dt[Be],o(13,dt)):o(13,dt[Be]=li,dt))}function Ei(Be){var li;return Be in _t?(li=_t[Be])!==null&&li!==void 0?li:null:Ji().getAttribute(Be)}function Wt(Be,li){_t[Be]!==li&&o(12,_t[Be]=li,_t)}function Vn(Be){(!(Be in _t)||_t[Be]!=null)&&o(12,_t[Be]=void 0,_t)}function It(Be){Bt.contains(Be.relatedTarget)||et&&et.hide()}function wt(Be){Be.type==="keydown"&&Be.key!=="Enter"&&Be.key!==" "||et&&et.handleAnchorClick()}function Ii(){et&&et.handleAnchorMouseEnter()}function dn(Be){et&&et.handleAnchorFocus(Be)}function $t(){et&&et.handleAnchorMouseLeave()}function gt(){et&&et.handleAnchorTouchstart()}function Si(){et&&et.handleAnchorTouchend()}function Pi(){var Be,li;E&&document.body!==Ji().parentNode&&(ot.setParent((Be=Ji().parentElement)!==null&&Be!==void 0?Be:void 0),ot.setNextSibling((li=Ji().nextElementSibling)!==null&&li!==void 0?li:void 0),document.body.appendChild(Ji()))}function Pr(Be){et&&et.attachScrollHandler(Be)}function Ir(Be){et&&et.removeScrollHandler(Be)}function Ji(){return Bt}function jn(Be){Dr[Be?"unshift":"push"](()=>{Bt=Be,o(9,Bt)})}const sr=()=>et&&et.handleTransitionEnd();return s.$$set=Be=>{a=Ai(Ai({},a),Ho(Be)),o(19,v=hr(a,_)),"use"in Be&&o(0,V=Be.use),"class"in Be&&o(1,Z=Be.class),"style"in Be&&o(2,Y=Be.style),"id"in Be&&o(3,W=Be.id),"unbounded"in Be&&o(20,te=Be.unbounded),"xPos"in Be&&o(21,ae=Be.xPos),"yPos"in Be&&o(22,Ie=Be.yPos),"persistent"in Be&&o(4,ye=Be.persistent),"interactive"in Be&&o(23,Ue=Be.interactive),"hideFromScreenreader"in Be&&o(5,je=Be.hideFromScreenreader),"showDelay"in Be&&o(24,_e=Be.showDelay),"hideDelay"in Be&&o(25,ct=Be.hideDelay),"surface$class"in Be&&o(6,lt=Be.surface$class),"surface$style"in Be&&o(7,St=Be.surface$style),"$$scope"in Be&&o(31,R=Be.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&8388624&&o(14,d={role:Gt&&Ue?"dialog":"tooltip",tabindex:Gt&&ye?-1:void 0}),s.$$.dirty[0]&1610612992&&et&&Yi!==E&&(Yi&&Gi(Yi),E&&ki(E),o(29,Yi=E)),s.$$.dirty[0]&1048832&&et&&et.setAnchorBoundaryType(vy[te?"UNBOUNDED":"BOUNDED"]),s.$$.dirty[0]&6291712&&et&&et.setTooltipPosition({xPos:sf[ae.toUpperCase()],yPos:Sp[Ie.toUpperCase()]}),s.$$.dirty[0]&16777472&&et&&_e!=null&&et.setShowDelay(_e),s.$$.dirty[0]&33554688&&et&&ct!=null&&et.setHideDelay(ct)},[V,Z,Y,W,ye,je,lt,St,et,Bt,Nt,qt,_t,dt,d,U,ti,Vi,Gt,v,te,ae,Ie,Ue,_e,ct,Pr,Ir,Ji,Yi,E,R,I,jn,sr]}class My extends gs{constructor(a){super(),ys(this,a,sw,nw,ts,{use:0,class:1,style:2,id:3,unbounded:20,xPos:21,yPos:22,persistent:4,interactive:23,hideFromScreenreader:5,showDelay:24,hideDelay:25,surface$class:6,surface$style:7,attachScrollHandler:26,removeScrollHandler:27,getElement:28},null,[-1,-1])}get attachScrollHandler(){return this.$$.ctx[26]}get removeScrollHandler(){return this.$$.ctx[27]}get getElement(){return this.$$.ctx[28]}}function ow(s){let a;const o=s[12].default,d=Ss(o,s,s[11],null);return{c(){d&&d.c()},l(_){d&&d.l(_)},m(_,v){d&&d.m(_,v),a=!0},p(_,v){d&&d.p&&(!a||v&2048)&&Cs(d,o,_,_[11],a?Ds(o,_[11],v,null):Ls(_[11]),null)},i(_){a||(Ot(d,_),a=!0)},o(_){jt(d,_),a=!1},d(_){d&&d.d(_)}}}function aw(s){let a,o,d,_,v,E;const r=s[12].default,I=Ss(r,s,s[11],null);let R=[{class:o=Un({[s[1]]:!0,"mdc-tooltip-wrapper--rich":!0})},s[7]],U={};for(let V=0;V<R.length;V+=1)U=Ai(U,R[V]);return{c(){a=pn("div"),I&&I.c(),this.h()},l(V){a=mn(V,"DIV",{class:!0});var Z=xn(a);I&&I.l(Z),Z.forEach(Tt),this.h()},h(){Cr(a,U)},m(V,Z){pi(V,a,Z),I&&I.m(a,null),s[13](a),_=!0,v||(E=[Lr(d=ca.call(null,a,s[0])),Lr(s[4].call(null,a))],v=!0)},p(V,Z){I&&I.p&&(!_||Z&2048)&&Cs(I,r,V,V[11],_?Ds(r,V[11],Z,null):Ls(V[11]),null),Cr(a,U=yr(R,[(!_||Z&2&&o!==(o=Un({[V[1]]:!0,"mdc-tooltip-wrapper--rich":!0})))&&{class:o},Z&128&&V[7]])),d&&As(d.update)&&Z&1&&d.update.call(null,V[0])},i(V){_||(Ot(I,V),_=!0)},o(V){jt(I,V),_=!1},d(V){V&&Tt(a),I&&I.d(V),s[13](null),v=!1,Al(E)}}}function lw(s){let a,o,d,_;const v=[aw,ow],E=[];function r(I,R){return I[2]?0:1}return a=r(s),o=E[a]=v[a](s),{c(){o.c(),d=rr()},l(I){o.l(I),d=rr()},m(I,R){E[a].m(I,R),pi(I,d,R),_=!0},p(I,[R]){let U=a;a=r(I),a===U?E[a].p(I,R):(Vs(),jt(E[U],1,1,()=>{E[U]=null}),Gs(),o=E[a],o?o.p(I,R):(o=E[a]=v[a](I),o.c()),Ot(o,1),o.m(d.parentNode,d))},i(I){_||(Ot(o),_=!0)},o(I){jt(o),_=!1},d(I){E[a].d(I),I&&Tt(d)}}}function cw(s,a,o){const d=["use","class","rich","getElement"];let _=hr(a,d),v,E,{$$slots:r={},$$scope:I}=a;const R=Wo(qo());let{use:U=[]}=a,{class:V=""}=a,{rich:Z=!1}=a,Y;const W=af(void 0);Vu(s,W,ye=>o(10,E=ye));const te=af(void 0);Vu(s,te,ye=>o(9,v=ye)),Xs("SMUI:tooltip:wrapper:anchor",W),Xs("SMUI:tooltip:wrapper:tooltip",te),Xs("SMUI:tooltip:rich",Z);function ae(){return Y}function Ie(ye){Dr[ye?"unshift":"push"](()=>{Y=ye,o(3,Y)})}return s.$$set=ye=>{a=Ai(Ai({},a),Ho(ye)),o(7,_=hr(a,d)),"use"in ye&&o(0,U=ye.use),"class"in ye&&o(1,V=ye.class),"rich"in ye&&o(2,Z=ye.rich),"$$scope"in ye&&o(11,I=ye.$$scope)},s.$$.update=()=>{s.$$.dirty&1536&&v&&!E&&Qm(W,E=v.previousElementSibling,E)},[U,V,Z,Y,R,W,te,_,ae,v,E,I,r,Ie]}class Km extends gs{constructor(a){super(),ys(this,a,cw,lw,ts,{use:0,class:1,rich:2,getElement:8})}get getElement(){return this.$$.ctx[8]}}function uw(s){let a;const o=s[11].default,d=Ss(o,s,s[13],null);return{c(){d&&d.c()},l(_){d&&d.l(_)},m(_,v){d&&d.m(_,v),a=!0},p(_,v){d&&d.p&&(!a||v&8192)&&Cs(d,o,_,_[13],a?Ds(o,_[13],v,null):Ls(_[13]),null)},i(_){a||(Ot(d,_),a=!0)},o(_){jt(d,_),a=!1},d(_){d&&d.d(_)}}}function hw(s){let a,o,d;const _=[{tag:s[4]},{use:[s[6],...s[0]]},{class:Un({[s[1]]:!0,"mdc-button__icon":s[8]==="button","mdc-fab__icon":s[8]==="fab","mdc-icon-button__icon":s[8]==="icon-button","mdc-icon-button__icon--on":s[8]==="icon-button"&&s[2],"mdc-tab__icon":s[8]==="tab","mdc-banner__icon":s[8]==="banner","mdc-segmented-button__icon":s[8]==="segmented-button"})},{"aria-hidden":"true"},s[7]?{focusable:"false",tabindex:"-1"}:{},s[9]];var v=s[3];function E(r){let I={$$slots:{default:[uw]},$$scope:{ctx:r}};for(let R=0;R<_.length;R+=1)I=Ai(I,_[R]);return{props:I}}return v&&(a=Gu(v,E(s)),s[12](a)),{c(){a&&Sn(a.$$.fragment),o=rr()},l(r){a&&Zn(a.$$.fragment,r),o=rr()},m(r,I){a&&Cn(a,r,I),pi(r,o,I),d=!0},p(r,[I]){const R=I&983?yr(_,[I&16&&{tag:r[4]},I&65&&{use:[r[6],...r[0]]},I&262&&{class:Un({[r[1]]:!0,"mdc-button__icon":r[8]==="button","mdc-fab__icon":r[8]==="fab","mdc-icon-button__icon":r[8]==="icon-button","mdc-icon-button__icon--on":r[8]==="icon-button"&&r[2],"mdc-tab__icon":r[8]==="tab","mdc-banner__icon":r[8]==="banner","mdc-segmented-button__icon":r[8]==="segmented-button"})},_[3],I&128&&ms(r[7]?{focusable:"false",tabindex:"-1"}:{}),I&512&&ms(r[9])]):{};if(I&8192&&(R.$$scope={dirty:I,ctx:r}),I&8&&v!==(v=r[3])){if(a){Vs();const U=a;jt(U.$$.fragment,1,0,()=>{Ln(U,1)}),Gs()}v?(a=Gu(v,E(r)),r[12](a),Sn(a.$$.fragment),Ot(a.$$.fragment,1),Cn(a,o.parentNode,o)):a=null}else v&&a.$set(R)},i(r){d||(a&&Ot(a.$$.fragment,r),d=!0)},o(r){a&&jt(a.$$.fragment,r),d=!1},d(r){s[12](null),r&&Tt(o),a&&Ln(a,r)}}}function dw(s,a,o){const d=["use","class","on","component","tag","getElement"];let _=hr(a,d),{$$slots:v={},$$scope:E}=a;const r=Wo(qo());let{use:I=[]}=a,{class:R=""}=a,{on:U=!1}=a,V,{component:Z=qu}=a,{tag:Y=Z===qu?"i":void 0}=a;const W=Z===xw,te=Ks("SMUI:icon:context");function ae(){return V.getElement()}function Ie(ye){Dr[ye?"unshift":"push"](()=>{V=ye,o(5,V)})}return s.$$set=ye=>{a=Ai(Ai({},a),Ho(ye)),o(9,_=hr(a,d)),"use"in ye&&o(0,I=ye.use),"class"in ye&&o(1,R=ye.class),"on"in ye&&o(2,U=ye.on),"component"in ye&&o(3,Z=ye.component),"tag"in ye&&o(4,Y=ye.tag),"$$scope"in ye&&o(13,E=ye.$$scope)},[I,R,U,Z,Y,V,r,W,te,_,ae,v,Ie,E]}class fw extends gs{constructor(a){super(),ys(this,a,dw,hw,ts,{use:0,class:1,on:2,component:3,tag:4,getElement:10})}get getElement(){return this.$$.ctx[10]}}function pw(s){let a=s[1],o,d,_=s[1]&&bv(s);return{c(){_&&_.c(),o=rr()},l(v){_&&_.l(v),o=rr()},m(v,E){_&&_.m(v,E),pi(v,o,E),d=!0},p(v,E){v[1]?a?ts(a,v[1])?(_.d(1),_=bv(v),a=v[1],_.c(),_.m(o.parentNode,o)):_.p(v,E):(_=bv(v),a=v[1],_.c(),_.m(o.parentNode,o)):a&&(_.d(1),_=null,a=v[1])},i(v){d||(Ot(_),d=!0)},o(v){jt(_),d=!1},d(v){v&&Tt(o),_&&_.d(v)}}}function mw(s){let a=s[1],o,d=s[1]&&wv(s);return{c(){d&&d.c(),o=rr()},l(_){d&&d.l(_),o=rr()},m(_,v){d&&d.m(_,v),pi(_,o,v)},p(_,v){_[1]?a?ts(a,_[1])?(d.d(1),d=wv(_),a=_[1],d.c(),d.m(o.parentNode,o)):d.p(_,v):(d=wv(_),a=_[1],d.c(),d.m(o.parentNode,o)):a&&(d.d(1),d=null,a=_[1])},i:ju,o:ju,d(_){_&&Tt(o),d&&d.d(_)}}}function bv(s){let a,o,d,_,v;const E=s[8].default,r=Ss(E,s,s[7],null);let I=[s[5]],R={};for(let U=0;U<I.length;U+=1)R=Ai(R,I[U]);return{c(){a=pn(s[1]),r&&r.c(),this.h()},l(U){a=mn(U,(s[1]||"null").toUpperCase(),{});var V=xn(a);r&&r.l(V),V.forEach(Tt),this.h()},h(){my(s[1])(a,R)},m(U,V){pi(U,a,V),r&&r.m(a,null),s[10](a),d=!0,_||(v=[Lr(o=ca.call(null,a,s[0])),Lr(s[4].call(null,a))],_=!0)},p(U,V){r&&r.p&&(!d||V&128)&&Cs(r,E,U,U[7],d?Ds(E,U[7],V,null):Ls(U[7]),null),my(U[1])(a,R=yr(I,[V&32&&U[5]])),o&&As(o.update)&&V&1&&o.update.call(null,U[0])},i(U){d||(Ot(r,U),d=!0)},o(U){jt(r,U),d=!1},d(U){U&&Tt(a),r&&r.d(U),s[10](null),_=!1,Al(v)}}}function wv(s){let a,o,d,_,v=[s[5]],E={};for(let r=0;r<v.length;r+=1)E=Ai(E,v[r]);return{c(){a=pn(s[1]),this.h()},l(r){a=mn(r,(s[1]||"null").toUpperCase(),{}),xn(a).forEach(Tt),this.h()},h(){my(s[1])(a,E)},m(r,I){pi(r,a,I),s[9](a),d||(_=[Lr(o=ca.call(null,a,s[0])),Lr(s[4].call(null,a))],d=!0)},p(r,I){my(r[1])(a,E=yr(v,[I&32&&r[5]])),o&&As(o.update)&&I&1&&o.update.call(null,r[0])},d(r){r&&Tt(a),s[9](null),d=!1,Al(_)}}}function _w(s){let a,o,d,_;const v=[mw,pw],E=[];function r(I,R){return I[3]?0:1}return a=r(s),o=E[a]=v[a](s),{c(){o.c(),d=rr()},l(I){o.l(I),d=rr()},m(I,R){E[a].m(I,R),pi(I,d,R),_=!0},p(I,[R]){let U=a;a=r(I),a===U?E[a].p(I,R):(Vs(),jt(E[U],1,1,()=>{E[U]=null}),Gs(),o=E[a],o?o.p(I,R):(o=E[a]=v[a](I),o.c()),Ot(o,1),o.m(d.parentNode,d))},i(I){_||(Ot(o),_=!0)},o(I){jt(o),_=!1},d(I){E[a].d(I),I&&Tt(d)}}}function gw(s,a,o){let d;const _=["use","tag","getElement"];let v=hr(a,_),{$$slots:E={},$$scope:r}=a,{use:I=[]}=a,{tag:R}=a;const U=Wo(qo());let V;function Z(){return V}function Y(te){Dr[te?"unshift":"push"](()=>{V=te,o(2,V)})}function W(te){Dr[te?"unshift":"push"](()=>{V=te,o(2,V)})}return s.$$set=te=>{a=Ai(Ai({},a),Ho(te)),o(5,v=hr(a,_)),"use"in te&&o(0,I=te.use),"tag"in te&&o(1,R=te.tag),"$$scope"in te&&o(7,r=te.$$scope)},s.$$.update=()=>{s.$$.dirty&2&&o(3,d=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"].indexOf(R)>-1)},[I,R,V,d,U,v,Z,r,E,Y,W]}class qu extends gs{constructor(a){super(),ys(this,a,gw,_w,ts,{use:0,tag:1,getElement:6})}get getElement(){return this.$$.ctx[6]}}function yw(s){let a,o,d,_,v;const E=s[6].default,r=Ss(E,s,s[5],null);let I=[s[3]],R={};for(let U=0;U<I.length;U+=1)R=Ai(R,I[U]);return{c(){a=ly("svg"),r&&r.c(),this.h()},l(U){a=cy(U,"svg",{});var V=xn(a);r&&r.l(V),V.forEach(Tt),this.h()},h(){d1(a,R)},m(U,V){pi(U,a,V),r&&r.m(a,null),s[7](a),d=!0,_||(v=[Lr(o=ca.call(null,a,s[0])),Lr(s[2].call(null,a))],_=!0)},p(U,[V]){r&&r.p&&(!d||V&32)&&Cs(r,E,U,U[5],d?Ds(E,U[5],V,null):Ls(U[5]),null),d1(a,R=yr(I,[V&8&&U[3]])),o&&As(o.update)&&V&1&&o.update.call(null,U[0])},i(U){d||(Ot(r,U),d=!0)},o(U){jt(r,U),d=!1},d(U){U&&Tt(a),r&&r.d(U),s[7](null),_=!1,Al(v)}}}function vw(s,a,o){const d=["use","getElement"];let _=hr(a,d),{$$slots:v={},$$scope:E}=a,{use:r=[]}=a;const I=Wo(qo());let R;function U(){return R}function V(Z){Dr[Z?"unshift":"push"](()=>{R=Z,o(1,R)})}return s.$$set=Z=>{a=Ai(Ai({},a),Ho(Z)),o(3,_=hr(a,d)),"use"in Z&&o(0,r=Z.use),"$$scope"in Z&&o(5,E=Z.$$scope)},[r,R,I,_,U,E,v,V]}class xw extends gs{constructor(a){super(),ys(this,a,vw,yw,ts,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}}function bw(s){let a;const o=s[11].default,d=Ss(o,s,s[13],null);return{c(){d&&d.c()},l(_){d&&d.l(_)},m(_,v){d&&d.m(_,v),a=!0},p(_,v){d&&d.p&&(!a||v&8192)&&Cs(d,o,_,_[13],a?Ds(o,_[13],v,null):Ls(_[13]),null)},i(_){a||(Ot(d,_),a=!0)},o(_){jt(d,_),a=!1},d(_){d&&d.d(_)}}}function ww(s){let a,o,d;const _=[{tag:s[3]},{use:[s[8],...s[0]]},{class:Un({[s[1]]:!0,[s[6]]:!0,...s[5]})},s[7],s[9]];var v=s[2];function E(r){let I={$$slots:{default:[bw]},$$scope:{ctx:r}};for(let R=0;R<_.length;R+=1)I=Ai(I,_[R]);return{props:I}}return v&&(a=Gu(v,E(s)),s[12](a)),{c(){a&&Sn(a.$$.fragment),o=rr()},l(r){a&&Zn(a.$$.fragment,r),o=rr()},m(r,I){a&&Cn(a,r,I),pi(r,o,I),d=!0},p(r,[I]){const R=I&1003?yr(_,[I&8&&{tag:r[3]},I&257&&{use:[r[8],...r[0]]},I&98&&{class:Un({[r[1]]:!0,[r[6]]:!0,...r[5]})},I&128&&ms(r[7]),I&512&&ms(r[9])]):{};if(I&8192&&(R.$$scope={dirty:I,ctx:r}),I&4&&v!==(v=r[2])){if(a){Vs();const U=a;jt(U.$$.fragment,1,0,()=>{Ln(U,1)}),Gs()}v?(a=Gu(v,E(r)),r[12](a),Sn(a.$$.fragment),Ot(a.$$.fragment,1),Cn(a,o.parentNode,o)):a=null}else v&&a.$set(R)},i(r){d||(a&&Ot(a.$$.fragment,r),d=!0)},o(r){a&&jt(a.$$.fragment,r),d=!1},d(r){s[12](null),r&&Tt(o),a&&Ln(a,r)}}}const Sh={component:qu,tag:"div",class:"",classMap:{},contexts:{},props:{}};function Ew(s,a,o){const d=["use","class","component","tag","getElement"];let _=hr(a,d),{$$slots:v={},$$scope:E}=a,{use:r=[]}=a,{class:I=""}=a,R;const U=Sh.class,V={},Z=[],Y=Sh.contexts,W=Sh.props;let{component:te=Sh.component}=a,{tag:ae=te===qu?Sh.tag:void 0}=a;Object.entries(Sh.classMap).forEach(([je,_e])=>{const ct=Ks(_e);ct&&"subscribe"in ct&&Z.push(ct.subscribe(lt=>{o(5,V[je]=lt,V)}))});const Ie=Wo(qo());for(let je in Y)Y.hasOwnProperty(je)&&Xs(je,Y[je]);ud(()=>{for(const je of Z)je()});function ye(){return R.getElement()}function Ue(je){Dr[je?"unshift":"push"](()=>{R=je,o(4,R)})}return s.$$set=je=>{a=Ai(Ai({},a),Ho(je)),o(9,_=hr(a,d)),"use"in je&&o(0,r=je.use),"class"in je&&o(1,I=je.class),"component"in je&&o(2,te=je.component),"tag"in je&&o(3,ae=je.tag),"$$scope"in je&&o(13,E=je.$$scope)},[r,I,te,ae,R,V,U,W,Ie,_,ye,v,Ue,E]}class Tw extends gs{constructor(a){super(),ys(this,a,Ew,ww,ts,{use:0,class:1,component:2,tag:3,getElement:10})}get getElement(){return this.$$.ctx[10]}}const w1=Object.assign({},Sh);function cu(s){return new Proxy(Tw,{construct:function(a,o){return Object.assign(Sh,w1,s),new a(...o)},get:function(a,o){return Object.assign(Sh,w1,s),a[o]}})}cu({class:"mdc-tooltip__title",tag:"h2"});cu({class:"mdc-tooltip__content",tag:"div"});cu({class:"mdc-tooltip__content-link",tag:"a"});cu({class:"mdc-tooltip--rich-actions",tag:"div",contexts:{"SMUI:button:context":"tooltip:rich-actions"}});/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */function Iw(s){return s===void 0&&(s=window),Mw(s)?{passive:!0}:!1}function Mw(s){s===void 0&&(s=window);var a=!1;try{var o={get passive(){return a=!0,!1}},d=function(){};s.document.addEventListener("test",d,o),s.document.removeEventListener("test",d,o)}catch{a=!1}return a}const Aw=Object.freeze(Object.defineProperty({__proto__:null,applyPassive:Iw},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */function Sw(s,a){if(s.closest)return s.closest(a);for(var o=s;o;){if(Bx(o,a))return o;o=o.parentElement}return null}function Bx(s,a){var o=s.matches||s.webkitMatchesSelector||s.msMatchesSelector;return o.call(s,a)}function Cw(s){var a=s;if(a.offsetParent!==null)return a.scrollWidth;var o=a.cloneNode(!0);o.style.setProperty("position","absolute"),o.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(o);var d=o.scrollWidth;return document.documentElement.removeChild(o),d}const Hv=Object.freeze(Object.defineProperty({__proto__:null,closest:Sw,estimateScrollWidth:Cw,matches:Bx},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Lw={BG_FOCUSED:"mdc-ripple-upgraded--background-focused",FG_ACTIVATION:"mdc-ripple-upgraded--foreground-activation",FG_DEACTIVATION:"mdc-ripple-upgraded--foreground-deactivation",ROOT:"mdc-ripple-upgraded",UNBOUNDED:"mdc-ripple-upgraded--unbounded"},Dw={VAR_FG_SCALE:"--mdc-ripple-fg-scale",VAR_FG_SIZE:"--mdc-ripple-fg-size",VAR_FG_TRANSLATE_END:"--mdc-ripple-fg-translate-end",VAR_FG_TRANSLATE_START:"--mdc-ripple-fg-translate-start",VAR_LEFT:"--mdc-ripple-left",VAR_TOP:"--mdc-ripple-top"},E1={DEACTIVATION_TIMEOUT_MS:225,FG_DEACTIVATION_MS:150,INITIAL_ORIGIN_SCALE:.6,PADDING:10,TAP_DELAY_MS:300},ty;function Pw(s,a){a===void 0&&(a=!1);var o=s.CSS,d=ty;if(typeof ty=="boolean"&&!a)return ty;var _=o&&typeof o.supports=="function";if(!_)return!1;var v=o.supports("--css-vars","yes"),E=o.supports("(--css-vars: yes)")&&o.supports("color","#00000000");return d=v||E,a||(ty=d),d}function Ow(s,a,o){if(!s)return{x:0,y:0};var d=a.x,_=a.y,v=d+o.left,E=_+o.top,r,I;if(s.type==="touchstart"){var R=s;r=R.changedTouches[0].pageX-v,I=R.changedTouches[0].pageY-E}else{var U=s;r=U.pageX-v,I=U.pageY-E}return{x:r,y:I}}/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var T1=["touchstart","pointerdown","mousedown","keydown"],I1=["touchend","pointerup","mouseup","contextmenu"],iy=[],Rw=function(s){au(a,s);function a(o){var d=s.call(this,_s(_s({},a.defaultAdapter),o))||this;return d.activationAnimationHasEnded=!1,d.activationTimer=0,d.fgDeactivationRemovalTimer=0,d.fgScale="0",d.frame={width:0,height:0},d.initialSize=0,d.layoutFrame=0,d.maxRadius=0,d.unboundedCoords={left:0,top:0},d.activationState=d.defaultActivationState(),d.activationTimerCallback=function(){d.activationAnimationHasEnded=!0,d.runDeactivationUXLogicIfReady()},d.activateHandler=function(_){d.activateImpl(_)},d.deactivateHandler=function(){d.deactivateImpl()},d.focusHandler=function(){d.handleFocus()},d.blurHandler=function(){d.handleBlur()},d.resizeHandler=function(){d.layout()},d}return Object.defineProperty(a,"cssClasses",{get:function(){return Lw},enumerable:!1,configurable:!0}),Object.defineProperty(a,"strings",{get:function(){return Dw},enumerable:!1,configurable:!0}),Object.defineProperty(a,"numbers",{get:function(){return E1},enumerable:!1,configurable:!0}),Object.defineProperty(a,"defaultAdapter",{get:function(){return{addClass:function(){},browserSupportsCssVars:function(){return!0},computeBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},containsEventTarget:function(){return!0},deregisterDocumentInteractionHandler:function(){},deregisterInteractionHandler:function(){},deregisterResizeHandler:function(){},getWindowPageOffset:function(){return{x:0,y:0}},isSurfaceActive:function(){return!0},isSurfaceDisabled:function(){return!0},isUnbounded:function(){return!0},registerDocumentInteractionHandler:function(){},registerInteractionHandler:function(){},registerResizeHandler:function(){},removeClass:function(){},updateCssVariable:function(){}}},enumerable:!1,configurable:!0}),a.prototype.init=function(){var o=this,d=this.supportsPressRipple();if(this.registerRootHandlers(d),d){var _=a.cssClasses,v=_.ROOT,E=_.UNBOUNDED;requestAnimationFrame(function(){o.adapter.addClass(v),o.adapter.isUnbounded()&&(o.adapter.addClass(E),o.layoutInternal())})}},a.prototype.destroy=function(){var o=this;if(this.supportsPressRipple()){this.activationTimer&&(clearTimeout(this.activationTimer),this.activationTimer=0,this.adapter.removeClass(a.cssClasses.FG_ACTIVATION)),this.fgDeactivationRemovalTimer&&(clearTimeout(this.fgDeactivationRemovalTimer),this.fgDeactivationRemovalTimer=0,this.adapter.removeClass(a.cssClasses.FG_DEACTIVATION));var d=a.cssClasses,_=d.ROOT,v=d.UNBOUNDED;requestAnimationFrame(function(){o.adapter.removeClass(_),o.adapter.removeClass(v),o.removeCssVars()})}this.deregisterRootHandlers(),this.deregisterDeactivationHandlers()},a.prototype.activate=function(o){this.activateImpl(o)},a.prototype.deactivate=function(){this.deactivateImpl()},a.prototype.layout=function(){var o=this;this.layoutFrame&&cancelAnimationFrame(this.layoutFrame),this.layoutFrame=requestAnimationFrame(function(){o.layoutInternal(),o.layoutFrame=0})},a.prototype.setUnbounded=function(o){var d=a.cssClasses.UNBOUNDED;o?this.adapter.addClass(d):this.adapter.removeClass(d)},a.prototype.handleFocus=function(){var o=this;requestAnimationFrame(function(){return o.adapter.addClass(a.cssClasses.BG_FOCUSED)})},a.prototype.handleBlur=function(){var o=this;requestAnimationFrame(function(){return o.adapter.removeClass(a.cssClasses.BG_FOCUSED)})},a.prototype.supportsPressRipple=function(){return this.adapter.browserSupportsCssVars()},a.prototype.defaultActivationState=function(){return{activationEvent:void 0,hasDeactivationUXRun:!1,isActivated:!1,isProgrammatic:!1,wasActivatedByPointer:!1,wasElementMadeActive:!1}},a.prototype.registerRootHandlers=function(o){var d,_;if(o){try{for(var v=ec(T1),E=v.next();!E.done;E=v.next()){var r=E.value;this.adapter.registerInteractionHandler(r,this.activateHandler)}}catch(I){d={error:I}}finally{try{E&&!E.done&&(_=v.return)&&_.call(v)}finally{if(d)throw d.error}}this.adapter.isUnbounded()&&this.adapter.registerResizeHandler(this.resizeHandler)}this.adapter.registerInteractionHandler("focus",this.focusHandler),this.adapter.registerInteractionHandler("blur",this.blurHandler)},a.prototype.registerDeactivationHandlers=function(o){var d,_;if(o.type==="keydown")this.adapter.registerInteractionHandler("keyup",this.deactivateHandler);else try{for(var v=ec(I1),E=v.next();!E.done;E=v.next()){var r=E.value;this.adapter.registerDocumentInteractionHandler(r,this.deactivateHandler)}}catch(I){d={error:I}}finally{try{E&&!E.done&&(_=v.return)&&_.call(v)}finally{if(d)throw d.error}}},a.prototype.deregisterRootHandlers=function(){var o,d;try{for(var _=ec(T1),v=_.next();!v.done;v=_.next()){var E=v.value;this.adapter.deregisterInteractionHandler(E,this.activateHandler)}}catch(r){o={error:r}}finally{try{v&&!v.done&&(d=_.return)&&d.call(_)}finally{if(o)throw o.error}}this.adapter.deregisterInteractionHandler("focus",this.focusHandler),this.adapter.deregisterInteractionHandler("blur",this.blurHandler),this.adapter.isUnbounded()&&this.adapter.deregisterResizeHandler(this.resizeHandler)},a.prototype.deregisterDeactivationHandlers=function(){var o,d;this.adapter.deregisterInteractionHandler("keyup",this.deactivateHandler);try{for(var _=ec(I1),v=_.next();!v.done;v=_.next()){var E=v.value;this.adapter.deregisterDocumentInteractionHandler(E,this.deactivateHandler)}}catch(r){o={error:r}}finally{try{v&&!v.done&&(d=_.return)&&d.call(_)}finally{if(o)throw o.error}}},a.prototype.removeCssVars=function(){var o=this,d=a.strings,_=Object.keys(d);_.forEach(function(v){v.indexOf("VAR_")===0&&o.adapter.updateCssVariable(d[v],null)})},a.prototype.activateImpl=function(o){var d=this;if(!this.adapter.isSurfaceDisabled()){var _=this.activationState;if(!_.isActivated){var v=this.previousActivationEvent,E=v&&o!==void 0&&v.type!==o.type;if(!E){_.isActivated=!0,_.isProgrammatic=o===void 0,_.activationEvent=o,_.wasActivatedByPointer=_.isProgrammatic?!1:o!==void 0&&(o.type==="mousedown"||o.type==="touchstart"||o.type==="pointerdown");var r=o!==void 0&&iy.length>0&&iy.some(function(I){return d.adapter.containsEventTarget(I)});if(r){this.resetActivationState();return}o!==void 0&&(iy.push(o.target),this.registerDeactivationHandlers(o)),_.wasElementMadeActive=this.checkElementMadeActive(o),_.wasElementMadeActive&&this.animateActivation(),requestAnimationFrame(function(){iy=[],!_.wasElementMadeActive&&o!==void 0&&(o.key===" "||o.keyCode===32)&&(_.wasElementMadeActive=d.checkElementMadeActive(o),_.wasElementMadeActive&&d.animateActivation()),_.wasElementMadeActive||(d.activationState=d.defaultActivationState())})}}}},a.prototype.checkElementMadeActive=function(o){return o!==void 0&&o.type==="keydown"?this.adapter.isSurfaceActive():!0},a.prototype.animateActivation=function(){var o=this,d=a.strings,_=d.VAR_FG_TRANSLATE_START,v=d.VAR_FG_TRANSLATE_END,E=a.cssClasses,r=E.FG_DEACTIVATION,I=E.FG_ACTIVATION,R=a.numbers.DEACTIVATION_TIMEOUT_MS;this.layoutInternal();var U="",V="";if(!this.adapter.isUnbounded()){var Z=this.getFgTranslationCoordinates(),Y=Z.startPoint,W=Z.endPoint;U=Y.x+"px, "+Y.y+"px",V=W.x+"px, "+W.y+"px"}this.adapter.updateCssVariable(_,U),this.adapter.updateCssVariable(v,V),clearTimeout(this.activationTimer),clearTimeout(this.fgDeactivationRemovalTimer),this.rmBoundedActivationClasses(),this.adapter.removeClass(r),this.adapter.computeBoundingRect(),this.adapter.addClass(I),this.activationTimer=setTimeout(function(){o.activationTimerCallback()},R)},a.prototype.getFgTranslationCoordinates=function(){var o=this.activationState,d=o.activationEvent,_=o.wasActivatedByPointer,v;_?v=Ow(d,this.adapter.getWindowPageOffset(),this.adapter.computeBoundingRect()):v={x:this.frame.width/2,y:this.frame.height/2},v={x:v.x-this.initialSize/2,y:v.y-this.initialSize/2};var E={x:this.frame.width/2-this.initialSize/2,y:this.frame.height/2-this.initialSize/2};return{startPoint:v,endPoint:E}},a.prototype.runDeactivationUXLogicIfReady=function(){var o=this,d=a.cssClasses.FG_DEACTIVATION,_=this.activationState,v=_.hasDeactivationUXRun,E=_.isActivated,r=v||!E;r&&this.activationAnimationHasEnded&&(this.rmBoundedActivationClasses(),this.adapter.addClass(d),this.fgDeactivationRemovalTimer=setTimeout(function(){o.adapter.removeClass(d)},E1.FG_DEACTIVATION_MS))},a.prototype.rmBoundedActivationClasses=function(){var o=a.cssClasses.FG_ACTIVATION;this.adapter.removeClass(o),this.activationAnimationHasEnded=!1,this.adapter.computeBoundingRect()},a.prototype.resetActivationState=function(){var o=this;this.previousActivationEvent=this.activationState.activationEvent,this.activationState=this.defaultActivationState(),setTimeout(function(){return o.previousActivationEvent=void 0},a.numbers.TAP_DELAY_MS)},a.prototype.deactivateImpl=function(){var o=this,d=this.activationState;if(d.isActivated){var _=_s({},d);d.isProgrammatic?(requestAnimationFrame(function(){o.animateDeactivation(_)}),this.resetActivationState()):(this.deregisterDeactivationHandlers(),requestAnimationFrame(function(){o.activationState.hasDeactivationUXRun=!0,o.animateDeactivation(_),o.resetActivationState()}))}},a.prototype.animateDeactivation=function(o){var d=o.wasActivatedByPointer,_=o.wasElementMadeActive;(d||_)&&this.runDeactivationUXLogicIfReady()},a.prototype.layoutInternal=function(){var o=this;this.frame=this.adapter.computeBoundingRect();var d=Math.max(this.frame.height,this.frame.width),_=function(){var E=Math.sqrt(Math.pow(o.frame.width,2)+Math.pow(o.frame.height,2));return E+a.numbers.PADDING};this.maxRadius=this.adapter.isUnbounded()?d:_();var v=Math.floor(d*a.numbers.INITIAL_ORIGIN_SCALE);this.adapter.isUnbounded()&&v%2!==0?this.initialSize=v-1:this.initialSize=v,this.fgScale=""+this.maxRadius/this.initialSize,this.updateLayoutCssVars()},a.prototype.updateLayoutCssVars=function(){var o=a.strings,d=o.VAR_FG_SIZE,_=o.VAR_LEFT,v=o.VAR_TOP,E=o.VAR_FG_SCALE;this.adapter.updateCssVariable(d,this.initialSize+"px"),this.adapter.updateCssVariable(E,this.fgScale),this.adapter.isUnbounded()&&(this.unboundedCoords={left:Math.round(this.frame.width/2-this.initialSize/2),top:Math.round(this.frame.height/2-this.initialSize/2)},this.adapter.updateCssVariable(_,this.unboundedCoords.left+"px"),this.adapter.updateCssVariable(v,this.unboundedCoords.top+"px"))},a}(lu);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var ny={ICON_BUTTON_ON:"mdc-icon-button--on",ROOT:"mdc-icon-button"},Ih={ARIA_LABEL:"aria-label",ARIA_PRESSED:"aria-pressed",DATA_ARIA_LABEL_OFF:"data-aria-label-off",DATA_ARIA_LABEL_ON:"data-aria-label-on",CHANGE_EVENT:"MDCIconButtonToggle:change"};/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var kw=function(s){au(a,s);function a(o){var d=s.call(this,_s(_s({},a.defaultAdapter),o))||this;return d.hasToggledAriaLabel=!1,d}return Object.defineProperty(a,"cssClasses",{get:function(){return ny},enumerable:!1,configurable:!0}),Object.defineProperty(a,"strings",{get:function(){return Ih},enumerable:!1,configurable:!0}),Object.defineProperty(a,"defaultAdapter",{get:function(){return{addClass:function(){},hasClass:function(){return!1},notifyChange:function(){},removeClass:function(){},getAttr:function(){return null},setAttr:function(){}}},enumerable:!1,configurable:!0}),a.prototype.init=function(){var o=this.adapter.getAttr(Ih.DATA_ARIA_LABEL_ON),d=this.adapter.getAttr(Ih.DATA_ARIA_LABEL_OFF);if(o&&d){if(this.adapter.getAttr(Ih.ARIA_PRESSED)!==null)throw new Error("MDCIconButtonToggleFoundation: Button should not set `aria-pressed` if it has a toggled aria label.");this.hasToggledAriaLabel=!0}else this.adapter.setAttr(Ih.ARIA_PRESSED,String(this.isOn()))},a.prototype.handleClick=function(){this.toggle(),this.adapter.notifyChange({isOn:this.isOn()})},a.prototype.isOn=function(){return this.adapter.hasClass(ny.ICON_BUTTON_ON)},a.prototype.toggle=function(o){if(o===void 0&&(o=!this.isOn()),o?this.adapter.addClass(ny.ICON_BUTTON_ON):this.adapter.removeClass(ny.ICON_BUTTON_ON),this.hasToggledAriaLabel){var d=o?this.adapter.getAttr(Ih.DATA_ARIA_LABEL_ON):this.adapter.getAttr(Ih.DATA_ARIA_LABEL_OFF);this.adapter.setAttr(Ih.ARIA_LABEL,d||"")}else this.adapter.setAttr(Ih.ARIA_PRESSED,""+o)},a}(lu);const{applyPassive:ry}=Aw,{matches:zw}=Hv;function t_(s,{ripple:a=!0,surface:o=!1,unbounded:d=!1,disabled:_=!1,color:v,active:E,rippleElement:r,eventTarget:I,activeTarget:R,addClass:U=W=>s.classList.add(W),removeClass:V=W=>s.classList.remove(W),addStyle:Z=(W,te)=>s.style.setProperty(W,te),initPromise:Y=Promise.resolve()}={}){let W,te=Ks("SMUI:addLayoutListener"),ae,Ie=E,ye=I,Ue=R;function je(){o?(U("mdc-ripple-surface"),v==="primary"?(U("smui-ripple-surface--primary"),V("smui-ripple-surface--secondary")):v==="secondary"?(V("smui-ripple-surface--primary"),U("smui-ripple-surface--secondary")):(V("smui-ripple-surface--primary"),V("smui-ripple-surface--secondary"))):(V("mdc-ripple-surface"),V("smui-ripple-surface--primary"),V("smui-ripple-surface--secondary")),W&&Ie!==E&&(Ie=E,E?W.activate():E===!1&&W.deactivate()),a&&!W?(W=new Rw({addClass:U,browserSupportsCssVars:()=>Pw(window),computeBoundingRect:()=>(r||s).getBoundingClientRect(),containsEventTarget:ct=>s.contains(ct),deregisterDocumentInteractionHandler:(ct,lt)=>document.documentElement.removeEventListener(ct,lt,ry()),deregisterInteractionHandler:(ct,lt)=>(I||s).removeEventListener(ct,lt,ry()),deregisterResizeHandler:ct=>window.removeEventListener("resize",ct),getWindowPageOffset:()=>({x:window.pageXOffset,y:window.pageYOffset}),isSurfaceActive:()=>E??zw(R||s,":active"),isSurfaceDisabled:()=>!!_,isUnbounded:()=>!!d,registerDocumentInteractionHandler:(ct,lt)=>document.documentElement.addEventListener(ct,lt,ry()),registerInteractionHandler:(ct,lt)=>(I||s).addEventListener(ct,lt,ry()),registerResizeHandler:ct=>window.addEventListener("resize",ct),removeClass:V,updateCssVariable:Z}),Y.then(()=>{W&&(W.init(),W.setUnbounded(d))})):W&&!a&&Y.then(()=>{W&&(W.destroy(),W=void 0)}),W&&(ye!==I||Ue!==R)&&(ye=I,Ue=R,W.destroy(),requestAnimationFrame(()=>{W&&(W.init(),W.setUnbounded(d))})),!a&&d&&U("mdc-ripple-upgraded--unbounded")}je(),te&&(ae=te(_e));function _e(){W&&W.layout()}return{update(ct){({ripple:a,surface:o,unbounded:d,disabled:_,color:v,active:E,rippleElement:r,eventTarget:I,activeTarget:R,addClass:U,removeClass:V,addStyle:Z,initPromise:Y}=Object.assign({ripple:!0,surface:!1,unbounded:!1,disabled:!1,color:void 0,active:void 0,rippleElement:void 0,eventTarget:void 0,activeTarget:void 0,addClass:lt=>s.classList.add(lt),removeClass:lt=>s.classList.remove(lt),addStyle:(lt,St)=>s.style.setProperty(lt,St),initPromise:Promise.resolve()},ct)),je()},destroy(){W&&(W.destroy(),W=void 0,V("mdc-ripple-surface"),V("smui-ripple-surface--primary"),V("smui-ripple-surface--secondary")),ae&&ae()}}}function M1(s){let a;return{c(){a=pn("div"),this.h()},l(o){a=mn(o,"DIV",{class:!0}),xn(a).forEach(Tt),this.h()},h(){tn(a,"class","mdc-icon-button__touch")},m(o,d){pi(o,a,d)},d(o){o&&Tt(a)}}}function Bw(s){let a,o,d,_;const v=s[33].default,E=Ss(v,s,s[37],null);let r=s[8]&&M1();return{c(){a=pn("div"),o=ir(),E&&E.c(),r&&r.c(),d=rr(),this.h()},l(I){a=mn(I,"DIV",{class:!0}),xn(a).forEach(Tt),o=nr(I),E&&E.l(I),r&&r.l(I),d=rr(),this.h()},h(){tn(a,"class","mdc-icon-button__ripple")},m(I,R){pi(I,a,R),pi(I,o,R),E&&E.m(I,R),r&&r.m(I,R),pi(I,d,R),_=!0},p(I,R){E&&E.p&&(!_||R[1]&64)&&Cs(E,v,I,I[37],_?Ds(v,I[37],R,null):Ls(I[37]),null),I[8]?r||(r=M1(),r.c(),r.m(d.parentNode,d)):r&&(r.d(1),r=null)},i(I){_||(Ot(E,I),_=!0)},o(I){jt(E,I),_=!1},d(I){I&&Tt(a),I&&Tt(o),E&&E.d(I),r&&r.d(I),I&&Tt(d)}}}function Fw(s){let a,o,d;const _=[{tag:s[14]},{use:[[t_,{ripple:s[4],unbounded:!0,color:s[5],disabled:!!s[29].disabled,addClass:s[26],removeClass:s[27],addStyle:s[28]}],s[22],...s[1]]},{class:Un({[s[2]]:!0,"mdc-icon-button":!0,"mdc-icon-button--on":!s[23](s[0])&&s[0],"mdc-icon-button--touch":s[8],"mdc-icon-button--display-flex":s[9],"smui-icon-button--size-button":s[10]==="button","smui-icon-button--size-mini":s[10]==="mini","mdc-icon-button--reduced-size":s[10]==="mini"||s[10]==="button","mdc-card__action":s[24]==="card:action","mdc-card__action--icon":s[24]==="card:action","mdc-top-app-bar__navigation-icon":s[24]==="top-app-bar:navigation","mdc-top-app-bar__action-item":s[24]==="top-app-bar:action","mdc-snackbar__dismiss":s[24]==="snackbar:actions","mdc-data-table__pagination-button":s[24]==="data-table:pagination","mdc-data-table__sort-icon-button":s[24]==="data-table:sortable-header-cell","mdc-dialog__close":(s[24]==="dialog:header"||s[24]==="dialog:sheet")&&s[12]==="close",...s[18]})},{style:Object.entries(s[19]).map(A1).concat([s[3]]).join(" ")},{"aria-pressed":s[23](s[0])?null:s[0]?"true":"false"},{"aria-label":s[0]?s[6]:s[7]},{"data-aria-label-on":s[6]},{"data-aria-label-off":s[7]},{"aria-describedby":s[25]},{href:s[11]},s[21],s[20],s[29]];var v=s[13];function E(r){let I={$$slots:{default:[Bw]},$$scope:{ctx:r}};for(let R=0;R<_.length;R+=1)I=Ai(I,_[R]);return{props:I}}return v&&(a=Gu(v,E(s)),s[34](a),a.$on("click",s[35]),a.$on("click",s[36])),{c(){a&&Sn(a.$$.fragment),o=rr()},l(r){a&&Zn(a.$$.fragment,r),o=rr()},m(r,I){a&&Cn(a,r,I),pi(r,o,I),d=!0},p(r,I){const R=I[0]&1073504255?yr(_,[I[0]&16384&&{tag:r[14]},I[0]&1010827314&&{use:[[t_,{ripple:r[4],unbounded:!0,color:r[5],disabled:!!r[29].disabled,addClass:r[26],removeClass:r[27],addStyle:r[28]}],r[22],...r[1]]},I[0]&25433861&&{class:Un({[r[2]]:!0,"mdc-icon-button":!0,"mdc-icon-button--on":!r[23](r[0])&&r[0],"mdc-icon-button--touch":r[8],"mdc-icon-button--display-flex":r[9],"smui-icon-button--size-button":r[10]==="button","smui-icon-button--size-mini":r[10]==="mini","mdc-icon-button--reduced-size":r[10]==="mini"||r[10]==="button","mdc-card__action":r[24]==="card:action","mdc-card__action--icon":r[24]==="card:action","mdc-top-app-bar__navigation-icon":r[24]==="top-app-bar:navigation","mdc-top-app-bar__action-item":r[24]==="top-app-bar:action","mdc-snackbar__dismiss":r[24]==="snackbar:actions","mdc-data-table__pagination-button":r[24]==="data-table:pagination","mdc-data-table__sort-icon-button":r[24]==="data-table:sortable-header-cell","mdc-dialog__close":(r[24]==="dialog:header"||r[24]==="dialog:sheet")&&r[12]==="close",...r[18]})},I[0]&524296&&{style:Object.entries(r[19]).map(A1).concat([r[3]]).join(" ")},I[0]&8388609&&{"aria-pressed":r[23](r[0])?null:r[0]?"true":"false"},I[0]&193&&{"aria-label":r[0]?r[6]:r[7]},I[0]&64&&{"data-aria-label-on":r[6]},I[0]&128&&{"data-aria-label-off":r[7]},I[0]&33554432&&{"aria-describedby":r[25]},I[0]&2048&&{href:r[11]},I[0]&2097152&&ms(r[21]),I[0]&1048576&&ms(r[20]),I[0]&536870912&&ms(r[29])]):{};if(I[0]&256|I[1]&64&&(R.$$scope={dirty:I,ctx:r}),I[0]&8192&&v!==(v=r[13])){if(a){Vs();const U=a;jt(U.$$.fragment,1,0,()=>{Ln(U,1)}),Gs()}v?(a=Gu(v,E(r)),r[34](a),a.$on("click",r[35]),a.$on("click",r[36]),Sn(a.$$.fragment),Ot(a.$$.fragment,1),Cn(a,o.parentNode,o)):a=null}else v&&a.$set(R)},i(r){d||(a&&Ot(a.$$.fragment,r),d=!0)},o(r){a&&jt(a.$$.fragment,r),d=!1},d(r){s[34](null),r&&Tt(o),a&&Ln(a,r)}}}const A1=([s,a])=>`${s}: ${a};`;function Nw(s,a,o){let d;const _=["use","class","style","ripple","color","toggle","pressed","ariaLabelOn","ariaLabelOff","touch","displayFlex","size","href","action","component","tag","getElement"];let v=hr(a,_),{$$slots:E={},$$scope:r}=a;const I=Wo(qo());let R=()=>{};function U(wt){return wt===R}let{use:V=[]}=a,{class:Z=""}=a,{style:Y=""}=a,{ripple:W=!0}=a,{color:te=void 0}=a,{toggle:ae=!1}=a,{pressed:Ie=R}=a,{ariaLabelOn:ye=void 0}=a,{ariaLabelOff:Ue=void 0}=a,{touch:je=!1}=a,{displayFlex:_e=!0}=a,{size:ct="normal"}=a,{href:lt=void 0}=a,{action:St=void 0}=a,Bt,et,ot={},Nt={},qt={},_t=Ks("SMUI:icon-button:context"),dt=Ks("SMUI:icon-button:aria-describedby"),{component:ti=qu}=a,{tag:Vi=ti===qu?lt==null?"button":"a":void 0}=a,Gt=v.disabled;Xs("SMUI:icon:context","icon-button");let Yi=null;ud(()=>{et&&et.destroy()});function Gi(wt){return wt in ot?ot[wt]:Ei().classList.contains(wt)}function ki(wt){ot[wt]||o(18,ot[wt]=!0,ot)}function Ni(wt){(!(wt in ot)||ot[wt])&&o(18,ot[wt]=!1,ot)}function Dn(wt,Ii){Nt[wt]!=Ii&&(Ii===""||Ii==null?(delete Nt[wt],o(19,Nt)):o(19,Nt[wt]=Ii,Nt))}function bn(wt){var Ii;return wt in qt?(Ii=qt[wt])!==null&&Ii!==void 0?Ii:null:Ei().getAttribute(wt)}function ui(wt,Ii){qt[wt]!==Ii&&o(20,qt[wt]=Ii,qt)}function Wi(wt){o(0,Ie=wt.isOn)}function Ei(){return Bt.getElement()}function Wt(wt){Dr[wt?"unshift":"push"](()=>{Bt=wt,o(16,Bt)})}const Vn=()=>et&&et.handleClick(),It=()=>_t==="top-app-bar:navigation"&&Us(Ei(),"SMUITopAppBarIconButton:nav");return s.$$set=wt=>{a=Ai(Ai({},a),Ho(wt)),o(29,v=hr(a,_)),"use"in wt&&o(1,V=wt.use),"class"in wt&&o(2,Z=wt.class),"style"in wt&&o(3,Y=wt.style),"ripple"in wt&&o(4,W=wt.ripple),"color"in wt&&o(5,te=wt.color),"toggle"in wt&&o(30,ae=wt.toggle),"pressed"in wt&&o(0,Ie=wt.pressed),"ariaLabelOn"in wt&&o(6,ye=wt.ariaLabelOn),"ariaLabelOff"in wt&&o(7,Ue=wt.ariaLabelOff),"touch"in wt&&o(8,je=wt.touch),"displayFlex"in wt&&o(9,_e=wt.displayFlex),"size"in wt&&o(10,ct=wt.size),"href"in wt&&o(11,lt=wt.href),"action"in wt&&o(12,St=wt.action),"component"in wt&&o(13,ti=wt.component),"tag"in wt&&o(14,Vi=wt.tag),"$$scope"in wt&&o(37,r=wt.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&4096&&o(21,d=(()=>{if(_t==="data-table:pagination")switch(St){case"first-page":return{"data-first-page":"true"};case"prev-page":return{"data-prev-page":"true"};case"next-page":return{"data-next-page":"true"};case"last-page":return{"data-last-page":"true"};default:return{"data-action":"true"}}else return _t==="dialog:header"||_t==="dialog:sheet"?{"data-mdc-dialog-action":St}:{action:St}})()),Gt!==v.disabled){const wt=Ei();"blur"in wt&&wt.blur(),o(31,Gt=v.disabled)}s.$$.dirty[0]&1073938432|s.$$.dirty[1]&2&&Bt&&Ei()&&ae!==Yi&&(ae&&!et?(o(17,et=new kw({addClass:ki,hasClass:Gi,notifyChange:wt=>{Wi(wt),Us(Ei(),"SMUIIconButtonToggle:change",wt,void 0,!0)},removeClass:Ni,getAttr:bn,setAttr:ui})),et.init()):!ae&&et&&(et.destroy(),o(17,et=void 0),o(18,ot={}),o(20,qt={})),o(32,Yi=ae)),s.$$.dirty[0]&131073&&et&&!U(Ie)&&et.isOn()!==Ie&&et.toggle(Ie)},[Ie,V,Z,Y,W,te,ye,Ue,je,_e,ct,lt,St,ti,Vi,Ei,Bt,et,ot,Nt,qt,d,I,U,_t,dt,ki,Ni,Dn,v,ae,Gt,Yi,E,Wt,Vn,It,r]}class a_ extends gs{constructor(a){super(),ys(this,a,Nw,Fw,ts,{use:1,class:2,style:3,ripple:4,color:5,toggle:30,pressed:0,ariaLabelOn:6,ariaLabelOff:7,touch:8,displayFlex:9,size:10,href:11,action:12,component:13,tag:14,getElement:15},null,[-1,-1])}get getElement(){return this.$$.ctx[15]}}function Fx(s){const a=s-1;return a*a*a+1}function Uw(s){return--s*s*s*s*s+1}function Vw(s,a){var o={};for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&a.indexOf(d)<0&&(o[d]=s[d]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var _=0,d=Object.getOwnPropertySymbols(s);_<d.length;_++)a.indexOf(d[_])<0&&Object.prototype.propertyIsEnumerable.call(s,d[_])&&(o[d[_]]=s[d[_]]);return o}function Gw(s){var{fallback:a}=s,o=Vw(s,["fallback"]);const d=new Map,_=new Map;function v(r,I,R){const{delay:U=0,duration:V=lt=>Math.sqrt(lt)*30,easing:Z=Fx}=Ai(Ai({},o),R),Y=r.getBoundingClientRect(),W=I.getBoundingClientRect(),te=Y.left-W.left,ae=Y.top-W.top,Ie=Y.width/W.width,ye=Y.height/W.height,Ue=Math.sqrt(te*te+ae*ae),je=getComputedStyle(I),_e=je.transform==="none"?"":je.transform,ct=+je.opacity;return{delay:U,duration:As(V)?V(Ue):V,easing:Z,css:(lt,St)=>`
				opacity: ${lt*ct};
				transform-origin: top left;
				transform: ${_e} translate(${St*te}px,${St*ae}px) scale(${lt+(1-lt)*Ie}, ${lt+(1-lt)*ye});
			`}}function E(r,I,R){return(U,V)=>(r.set(V.key,U),()=>{if(I.has(V.key)){const Z=I.get(V.key);return I.delete(V.key),v(Z,U,V)}return r.delete(V.key),a&&a(U,V,R)})}return[E(_,d,!1),E(d,_,!0)]}function jw(s,{from:a,to:o},d={}){const _=getComputedStyle(s),v=_.transform==="none"?"":_.transform,[E,r]=_.transformOrigin.split(" ").map(parseFloat),I=a.left+a.width*E/o.width-(o.left+E),R=a.top+a.height*r/o.height-(o.top+r),{delay:U=0,duration:V=Y=>Math.sqrt(Y)*120,easing:Z=Fx}=d;return{delay:U,duration:As(V)?V(Math.sqrt(I*I+R*R)):V,easing:Z,css:(Y,W)=>{const te=W*I,ae=W*R,Ie=Y+W*a.width/o.width,ye=Y+W*a.height/o.height;return`transform: ${v} translate(${te}px, ${ae}px) scale(${Ie}, ${ye});`}}}function S1(s,a,o){const d=s.slice();return d[15]=a[o],d[17]=o,d}const qw=s=>({item:s&1,index:s&1}),C1=s=>({item:s[15],index:s[17]});function L1(s){let a,o=[],d=new Map,_,v=s[0];const E=r=>r[8](r[15]);for(let r=0;r<v.length;r+=1){let I=S1(s,v,r),R=E(I);d.set(R,o[r]=D1(R,I))}return{c(){a=pn("ul");for(let r=0;r<o.length;r+=1)o[r].c();this.h()},l(r){a=mn(r,"UL",{class:!0});var I=xn(a);for(let R=0;R<o.length;R+=1)o[R].l(I);I.forEach(Tt),this.h()},h(){tn(a,"class","svelte-1xt2noz")},m(r,I){pi(r,a,I);for(let R=0;R<o.length;R+=1)o[R]&&o[R].m(a,null);_=!0},p(r,I){if(I&1523){v=r[0],Vs();for(let R=0;R<o.length;R+=1)o[R].r();o=Mb(o,I,E,1,r,v,d,a,Ob,D1,null,S1);for(let R=0;R<o.length;R+=1)o[R].a();Gs()}},i(r){if(!_){for(let I=0;I<v.length;I+=1)Ot(o[I]);_=!0}},o(r){for(let I=0;I<o.length;I+=1)jt(o[I]);_=!1},d(r){r&&Tt(a);for(let I=0;I<o.length;I+=1)o[I].d()}}}function Hw(s){let a,o=s[8](s[15])+"",d;return{c(){a=pn("p"),d=co(o)},l(_){a=mn(_,"P",{});var v=xn(a);d=uo(v,o),v.forEach(Tt)},m(_,v){pi(_,a,v),ln(a,d)},p(_,v){v&1&&o!==(o=_[8](_[15])+"")&&Sl(d,o)},d(_){_&&Tt(a)}}}function D1(s,a){let o,d,_,v,E,r,I,R=ju,U,V,Z;const Y=a[11].default,W=Ss(Y,a,a[10],C1),te=W||Hw(a);return{key:s,first:null,c(){o=pn("li"),te&&te.c(),d=ir(),this.h()},l(ae){o=mn(ae,"LI",{"data-index":!0,"data-id":!0,draggable:!0,class:!0});var Ie=xn(o);te&&te.l(Ie),d=nr(Ie),Ie.forEach(Tt),this.h()},h(){tn(o,"data-index",_=a[17]),tn(o,"data-id",v=JSON.stringify(a[8](a[15]))),tn(o,"draggable","true"),tn(o,"class","svelte-1xt2noz"),_y(o,"over",a[8](a[15])===a[1]),this.first=o},m(ae,Ie){pi(ae,o,Ie),te&&te.m(o,null),ln(o,d),U=!0,V||(Z=[xo(o,"dragstart",a[4]),xo(o,"dragover",a[5]),xo(o,"dragleave",a[6]),xo(o,"drop",a[7])],V=!0)},p(ae,Ie){a=ae,W?W.p&&(!U||Ie&1025)&&Cs(W,Y,a,a[10],U?Ds(Y,a[10],Ie,qw):Ls(a[10]),C1):te&&te.p&&(!U||Ie&1)&&te.p(a,U?Ie:-1),(!U||Ie&1&&_!==(_=a[17]))&&tn(o,"data-index",_),(!U||Ie&1&&v!==(v=JSON.stringify(a[8](a[15]))))&&tn(o,"data-id",v),(!U||Ie&259)&&_y(o,"over",a[8](a[15])===a[1])},r(){I=o.getBoundingClientRect()},f(){Ab(o),R(),Sb(o,I)},a(){R(),R=Cb(o,I,jw,{duration:300})},i(ae){U||(Ot(te,ae),Lb(()=>{U&&(r&&r.end(1),E=Db(o,a[3],{key:a[8](a[15])}),E.start())}),U=!0)},o(ae){jt(te,ae),E&&E.invalidate(),r=Pb(o,a[2],{key:a[8](a[15])}),U=!1},d(ae){ae&&Tt(o),te&&te.d(ae),ae&&r&&r.end(),V=!1,Al(Z)}}}function Ww(s){let a,o,d=s[0]&&s[0].length&&L1(s);return{c(){d&&d.c(),a=rr()},l(_){d&&d.l(_),a=rr()},m(_,v){d&&d.m(_,v),pi(_,a,v),o=!0},p(_,[v]){_[0]&&_[0].length?d?(d.p(_,v),v&1&&Ot(d,1)):(d=L1(_),d.c(),Ot(d,1),d.m(a.parentNode,a)):d&&(Vs(),jt(d,1,1,()=>{d=null}),Gs())},i(_){o||(Ot(d),o=!0)},o(_){jt(d),o=!1},d(_){d&&d.d(_),_&&Tt(a)}}}function Zw(s,a,o){let{$$slots:d={},$$scope:_}=a;const[v,E]=Gw({duration:ye=>Math.sqrt(ye*200),fallback(ye,Ue){const je=getComputedStyle(ye),_e=je.transform==="none"?"":je.transform;return{duration:600,easing:Uw,css:ct=>`
					transform: ${_e} scale(${ct});
					opacity: ${ct}
				`}}});let r=!1;const I=ye=>ye.dataset.index&&ye.dataset||I(ye.parentNode),R=ye=>{ye.dataTransfer.setData("source",ye.target.dataset.index)},U=ye=>{ye.preventDefault();let Ue=I(ye.target);r!==Ue.id&&o(1,r=JSON.parse(Ue.id))},V=ye=>{let Ue=I(ye.target);r===Ue.id&&o(1,r=!1)},Z=ye=>{o(1,r=!1),ye.preventDefault();let Ue=I(ye.target),je=ye.dataTransfer.getData("source"),_e=Ue.index;W({from:je,to:_e})},Y=Px(),W=({from:ye,to:Ue})=>{let je=[...ae];const _e=je.splice(ye,1)[0];je.splice(Ue,0,_e),Y("sort",{newList:je,from:ye,to:Ue})},te=ye=>Ie?ye[Ie]:ye;let{list:ae}=a,{key:Ie}=a;return s.$$set=ye=>{"list"in ye&&o(0,ae=ye.list),"key"in ye&&o(9,Ie=ye.key),"$$scope"in ye&&o(10,_=ye.$$scope)},[ae,r,v,E,R,U,V,Z,te,Ie,_,d]}class Xw extends gs{constructor(a){super(),ys(this,a,Zw,Ww,ts,{list:0,key:9})}}function Kw(s){let a=s[4][s[2]].muiIcon+"",o;return{c(){o=co(a)},l(d){o=uo(d,a)},m(d,_){pi(d,o,_)},p(d,_){_&4&&a!==(a=d[4][d[2]].muiIcon+"")&&Sl(o,a)},d(d){d&&Tt(o)}}}function Yw(s){let a,o,d;return o=new a_({props:{class:"material-icons",$$slots:{default:[Kw]},$$scope:{ctx:s}}}),o.$on("click",function(){As(s[4][s[2]].onClick)&&s[4][s[2]].onClick.apply(this,arguments)}),{c(){a=pn("span"),Sn(o.$$.fragment),this.h()},l(_){a=mn(_,"SPAN",{class:!0});var v=xn(a);Zn(o.$$.fragment,v),v.forEach(Tt),this.h()},h(){tn(a,"class","visibility-btn svelte-187k7qo")},m(_,v){pi(_,a,v),Cn(o,a,null),d=!0},p(_,v){s=_;const E={};v&516&&(E.$$scope={dirty:v,ctx:s}),o.$set(E)},i(_){d||(Ot(o.$$.fragment,_),d=!0)},o(_){jt(o.$$.fragment,_),d=!1},d(_){_&&Tt(a),Ln(o)}}}function Jw(s){let a=s[4][s[1]].muiIcon+"",o;return{c(){o=co(a)},l(d){o=uo(d,a)},m(d,_){pi(d,o,_)},p(d,_){_&2&&a!==(a=d[4][d[1]].muiIcon+"")&&Sl(o,a)},d(d){d&&Tt(o)}}}function P1(s){let a,o;return a=new My({props:{$$slots:{default:[Qw]},$$scope:{ctx:s}}}),{c(){Sn(a.$$.fragment)},l(d){Zn(a.$$.fragment,d)},m(d,_){Cn(a,d,_),o=!0},p(d,_){const v={};_&514&&(v.$$scope={dirty:_,ctx:d}),a.$set(v)},i(d){o||(Ot(a.$$.fragment,d),o=!0)},o(d){jt(a.$$.fragment,d),o=!1},d(d){Ln(a,d)}}}function Qw(s){let a=s[4][s[1]].tooltip+"",o;return{c(){o=co(a)},l(d){o=uo(d,a)},m(d,_){pi(d,o,_)},p(d,_){_&2&&a!==(a=d[4][d[1]].tooltip+"")&&Sl(o,a)},d(d){d&&Tt(o)}}}function $w(s){let a,o,d,_,v;o=new a_({props:{class:"material-icons",$$slots:{default:[Jw]},$$scope:{ctx:s}}}),o.$on("click",function(){As(s[4][s[1]].onClick)&&s[4][s[1]].onClick.apply(this,arguments)});let E=s[4][s[1]].tooltip&&P1(s);return{c(){a=pn("span"),Sn(o.$$.fragment),d=ir(),E&&E.c(),_=rr(),this.h()},l(r){a=mn(r,"SPAN",{class:!0});var I=xn(a);Zn(o.$$.fragment,I),I.forEach(Tt),d=nr(r),E&&E.l(r),_=rr(),this.h()},h(){tn(a,"class","action-btn")},m(r,I){pi(r,a,I),Cn(o,a,null),pi(r,d,I),E&&E.m(r,I),pi(r,_,I),v=!0},p(r,I){s=r;const R={};I&514&&(R.$$scope={dirty:I,ctx:s}),o.$set(R),s[4][s[1]].tooltip?E?(E.p(s,I),I&2&&Ot(E,1)):(E=P1(s),E.c(),Ot(E,1),E.m(_.parentNode,_)):E&&(Vs(),jt(E,1,1,()=>{E=null}),Gs())},i(r){v||(Ot(o.$$.fragment,r),Ot(E),v=!0)},o(r){jt(o.$$.fragment,r),jt(E),v=!1},d(r){r&&Tt(a),Ln(o),r&&Tt(d),E&&E.d(r),r&&Tt(_)}}}function eE(s){let a,o,d,_,v,E,r=s[0].displayName+"",I,R,U,V,Z,Y;return U=new Km({props:{$$slots:{default:[Yw]},$$scope:{ctx:s}}}),Z=new Km({props:{$$slots:{default:[$w]},$$scope:{ctx:s}}}),{c(){a=pn("div"),o=pn("img"),v=ir(),E=pn("p"),I=co(r),R=ir(),Sn(U.$$.fragment),V=ir(),Sn(Z.$$.fragment),this.h()},l(W){a=mn(W,"DIV",{class:!0});var te=xn(a);o=mn(te,"IMG",{class:!0,src:!0,alt:!0}),v=nr(te),E=mn(te,"P",{class:!0});var ae=xn(E);I=uo(ae,r),ae.forEach(Tt),R=nr(te),Zn(U.$$.fragment,te),V=nr(te),Zn(Z.$$.fragment,te),te.forEach(Tt),this.h()},h(){tn(o,"class","icon svelte-187k7qo"),gy(o.src,d=O1(s[0]))||tn(o,"src",d),tn(o,"alt",_=s[0].type),tn(E,"class","description"),tn(a,"class","item svelte-187k7qo")},m(W,te){pi(W,a,te),ln(a,o),ln(a,v),ln(a,E),ln(E,I),ln(a,R),Cn(U,a,null),ln(a,V),Cn(Z,a,null),s[8](a),Y=!0},p(W,[te]){(!Y||te&1&&!gy(o.src,d=O1(W[0])))&&tn(o,"src",d),(!Y||te&1&&_!==(_=W[0].type))&&tn(o,"alt",_),(!Y||te&1)&&r!==(r=W[0].displayName+"")&&Sl(I,r);const ae={};te&516&&(ae.$$scope={dirty:te,ctx:W}),U.$set(ae);const Ie={};te&514&&(Ie.$$scope={dirty:te,ctx:W}),Z.$set(Ie)},i(W){Y||(Ot(U.$$.fragment,W),Ot(Z.$$.fragment,W),Y=!0)},o(W){jt(U.$$.fragment,W),jt(Z.$$.fragment,W),Y=!1},d(W){W&&Tt(a),Ln(U),Ln(Z),s[8](null)}}}function O1(s){switch(s.type){case"circle":return"button-icons/point.png";case"line":return"button-icons/line.png";case"fill":case"fill-extrusion":return"button-icons/polygon.png";default:return"button-icons/polygon.png"}}function tE(s,a,o){let{map:d}=a,{layer:_}=a,{selectModeEnabled:v}=a,E=!1,r,I,R;const U={acceptEdit:{tooltip:"Accept layer edit",onClick:()=>console.log("yayaya"),muiIcon:"check"},cancelEdit:{tooltip:"Cancel edit",onClick:()=>null,muiIcon:"do_disturb"},isInvisible:{tooltip:"Show",onClick:()=>{Rc.toggleVisibility(_.id)},muiIcon:"visibility_off"},isVisible:{tooltip:"Hide",onClick:()=>{Rc.toggleVisibility(_.id)},muiIcon:"visibility"},remove:{tooltip:"Remove layer",onClick:async()=>{var Z;d.removeLayer(_.id),Rc.deleteLayer(_.id),(Z=R.parentNode)==null||Z.removeChild(R),setTimeout(()=>{},0)},muiIcon:"delete_outline"},checked:{onClick:()=>{o(7,E=!1)},muiIcon:"check_box"},notChecked:{onClick:()=>{o(7,E=!0)},muiIcon:"check_box_outline_blank"}};function V(Z){Dr[Z?"unshift":"push"](()=>{R=Z,o(3,R)})}return s.$$set=Z=>{"map"in Z&&o(5,d=Z.map),"layer"in Z&&o(0,_=Z.layer),"selectModeEnabled"in Z&&o(6,v=Z.selectModeEnabled)},s.$$.update=()=>{s.$$.dirty&192&&o(1,r=v?E?"checked":"notChecked":"remove"),s.$$.dirty&1&&o(2,I=_.isVisible?"isVisible":"isInvisible")},[_,r,I,R,U,d,v,E,V]}class iE extends gs{constructor(a){super(),ys(this,a,tE,eE,ts,{map:5,layer:0,selectModeEnabled:6})}}function nE(){return this._array=null,Promise.resolve()}function rE(){var s=this._array;return this._array=null,Promise.resolve(s?{done:!1,value:s}:{done:!0,value:void 0})}function i_(s){return new Wv(s instanceof Uint8Array?s:new Uint8Array(s))}function Wv(s){this._array=s}Wv.prototype.read=rE;Wv.prototype.cancel=nE;function sE(s){return fetch(s).then(function(a){return a.body&&a.body.getReader?a.body.getReader():a.arrayBuffer().then(i_)})}function oE(s){return new Promise(function(a,o){var d=new XMLHttpRequest;d.responseType="arraybuffer",d.onload=function(){a(i_(d.response))},d.onerror=o,d.ontimeout=o,d.open("GET",s,!0),d.send()})}function hy(s){return(typeof fetch=="function"?sE:oE)(s)}function Rv(s){return typeof s.read=="function"?s:s.getReader()}const Zv=new Uint8Array(0);function aE(){return this._source.cancel()}function lE(s,a){if(!s.length)return a;if(!a.length)return s;var o=new Uint8Array(s.length+a.length);return o.set(s),o.set(a,s.length),o}function cE(){var s=this,a=s._array.subarray(s._index);return s._source.read().then(function(o){return s._array=Zv,s._index=0,o.done?a.length>0?{done:!1,value:a}:{done:!0,value:void 0}:{done:!1,value:lE(a,o.value)}})}function uE(s){if((s|=0)<0)throw new Error("invalid length");var a=this,o=this._array.length-this._index;if(this._index+s<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=s));var d=new Uint8Array(s);return d.set(this._array.subarray(this._index)),function _(){return a._source.read().then(function(v){return v.done?(a._array=Zv,a._index=0,o>0?d.subarray(0,o):null):o+v.value.length>=s?(a._array=v.value,a._index=s-o,d.set(v.value.subarray(0,s-o),o),d):(d.set(v.value,o),o+=v.value.length,_())})}()}function Nx(s){return typeof s.slice=="function"?s:new Ay(typeof s.read=="function"?s:s.getReader())}function Ay(s){this._source=s,this._array=Zv,this._index=0}Ay.prototype.read=cE;Ay.prototype.slice=uE;Ay.prototype.cancel=aE;function hE(){return this._source.cancel()}function dE(s){return/^[nf]$/i.test(s)?!1:/^[yt]$/i.test(s)?!0:null}function fE(s){return new Date(+s.substring(0,4),s.substring(4,6)-1,+s.substring(6,8))}function sy(s){return!(s=s.trim())||isNaN(s=+s)?null:s}function pE(s){return s.trim()||null}var mE={B:sy,C:pE,D:fE,F:sy,L:dE,M:sy,N:sy};function _E(){var s=this,a=1;return s._source.slice(s._recordLength).then(function(o){return o&&o[0]!==26?{done:!1,value:s._fields.reduce(function(d,_){return d[_.name]=mE[_.type](s._decode(o.subarray(a,a+=_.length))),d},{})}:{done:!0,value:void 0}})}function Cp(s){return new DataView(s.buffer,s.byteOffset,s.byteLength)}function Ux(s,a){return s=Nx(s),s.slice(32).then(function(o){var d=Cp(o);return s.slice(d.getUint16(8,!0)-32).then(function(_){return new Vx(s,a,d,Cp(_))})})}function Vx(s,a,o,d){this._source=s,this._decode=a.decode.bind(a),this._recordLength=o.getUint16(10,!0),this._fields=[];for(var _=0;d.getUint8(_)!==13;_+=32){for(var v=0;v<11&&d.getUint8(_+v)!==0;++v);this._fields.push({name:this._decode(new Uint8Array(d.buffer,d.byteOffset+_,v)),type:String.fromCharCode(d.getUint8(_+11)),length:d.getUint8(_+16)})}}var Gx=Vx.prototype;Gx.read=_E;Gx.cancel=hE;function gE(){return this._source.cancel()}function Ev(s){var a=40,o,d=s.getInt32(36,!0),_=new Array(d);for(o=0;o<d;++o,a+=16)_[o]=[s.getFloat64(a,!0),s.getFloat64(a+8,!0)];return{type:"MultiPoint",coordinates:_}}function yE(){return null}function Tv(s){return{type:"Point",coordinates:[s.getFloat64(4,!0),s.getFloat64(12,!0)]}}function Iv(s){var a=44,o,d=s.getInt32(36,!0),_=s.getInt32(40,!0),v=new Array(d),E=new Array(_),r=[],I=[];for(o=0;o<d;++o,a+=4)v[o]=s.getInt32(a,!0);for(o=0;o<_;++o,a+=16)E[o]=[s.getFloat64(a,!0),s.getFloat64(a+8,!0)];return v.forEach(function(R,U){var V=E.slice(R,v[U+1]);vE(V)?r.push([V]):I.push(V)}),I.forEach(function(R){r.some(function(U){if(xE(U[0],R))return U.push(R),!0})||r.push([R])}),r.length===1?{type:"Polygon",coordinates:r[0]}:{type:"MultiPolygon",coordinates:r}}function vE(s){if((o=s.length)<4)return!1;for(var a=0,o,d=s[o-1][1]*s[0][0]-s[o-1][0]*s[0][1];++a<o;)d+=s[a-1][1]*s[a][0]-s[a-1][0]*s[a][1];return d>=0}function xE(s,a){for(var o=-1,d=a.length,_;++o<d;)if(_=bE(s,a[o]))return _>0;return!1}function bE(s,a){for(var o=a[0],d=a[1],_=-1,v=0,E=s.length,r=E-1;v<E;r=v++){var I=s[v],R=I[0],U=I[1],V=s[r],Z=V[0],Y=V[1];if(wE(I,V,a))return 0;U>d!=Y>d&&o<(Z-R)*(d-U)/(Y-U)+R&&(_=-_)}return _}function wE(s,a,o){var d=o[0]-s[0],_=o[1]-s[1];if(d===0&&_===0)return!0;var v=a[0]-s[0],E=a[1]-s[1];if(v===0&&E===0)return!1;var r=(d*v+_*E)/(v*v+E*E);return r<0||r>1?!1:r===0||r===1?!0:r*v===d&&r*E===_}function Mv(s){var a=44,o,d=s.getInt32(36,!0),_=s.getInt32(40,!0),v=new Array(d),E=new Array(_);for(o=0;o<d;++o,a+=4)v[o]=s.getInt32(a,!0);for(o=0;o<_;++o,a+=16)E[o]=[s.getFloat64(a,!0),s.getFloat64(a+8,!0)];return d===1?{type:"LineString",coordinates:E}:{type:"MultiLineString",coordinates:v.map(function(r,I){return E.slice(r,v[I+1])})}}function R1(s,a){var o=new Uint8Array(s.length+a.length);return o.set(s,0),o.set(a,s.length),o}function EE(){var s=this;return++s._index,s._source.slice(12).then(function(a){if(a==null)return{done:!0,value:void 0};var o=Cp(a);function d(){return s._source.slice(4).then(function(v){return v==null?{done:!0,value:void 0}:(o=Cp(a=R1(a.slice(4),v)),o.getInt32(0,!1)!==s._index?d():_())})}function _(){var v=o.getInt32(4,!1)*2-4,E=o.getInt32(8,!0);return v<0||E&&E!==s._type?d():s._source.slice(v).then(function(r){return{done:!1,value:E?s._parse(Cp(R1(a.slice(8),r))):null}})}return _()})}var k1={0:yE,1:Tv,3:Mv,5:Iv,8:Ev,11:Tv,13:Mv,15:Iv,18:Ev,21:Tv,23:Mv,25:Iv,28:Ev};function TE(s){return s=Nx(s),s.slice(100).then(function(a){return new jx(s,Cp(a))})}function jx(s,a){var o=a.getInt32(32,!0);if(!(o in k1))throw new Error("unsupported shape type: "+o);this._source=s,this._type=o,this._index=0,this._parse=k1[o],this.bbox=[a.getFloat64(36,!0),a.getFloat64(44,!0),a.getFloat64(52,!0),a.getFloat64(60,!0)]}var qx=jx.prototype;qx.read=EE;qx.cancel=gE;function IE(){}function ME(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(IE)}function AE(){var s=this;return Promise.all([s._dbf?s._dbf.read():{value:{}},s._shp.read()]).then(function(a){var o=a[0],d=a[1];return d.done?d:{done:!1,value:{type:"Feature",properties:o.value,geometry:d.value}}})}function SE(s,a,o){return Promise.all([TE(s),a&&Ux(a,o)]).then(function(d){return new Hx(d[0],d[1])})}function Hx(s,a){this._shp=s,this._dbf=a,this.bbox=s.bbox}var Wx=Hx.prototype;Wx.read=AE;Wx.cancel=ME;function CE(s,a,o){return typeof a=="string"?(/\.dbf$/.test(a)||(a+=".dbf"),a=hy(a)):a instanceof ArrayBuffer||a instanceof Uint8Array?a=i_(a):a!=null&&(a=Rv(a)),typeof s=="string"?(/\.shp$/.test(s)||(s+=".shp"),a===void 0&&(a=hy(s.substring(0,s.length-4)+".dbf").catch(function(){})),s=hy(s)):s instanceof ArrayBuffer||s instanceof Uint8Array?s=i_(s):s=Rv(s),Promise.all([s,a]).then(function(d){var _=d[0],v=d[1],E="windows-1252";return o&&o.encoding!=null&&(E=o.encoding),SE(_,v,v&&new TextDecoder(E))})}function LE(s,a){var o="windows-1252";return a&&a.encoding!=null&&(o=a.encoding),o=new TextDecoder(o),typeof s=="string"?(/\.dbf$/.test(s)||(s+=".dbf"),s=hy(s)):s instanceof ArrayBuffer||s instanceof Uint8Array?s=i_(s):s=Rv(s),Promise.resolve(s).then(function(d){return Ux(d,o)})}function DE(s,a,o){return CE(s,a,o).then(function(d){var _=[],v={type:"FeatureCollection",features:_,bbox:d.bbox};return d.read().then(function E(r){return r.done?v:(_.push(r.value),d.read().then(E))})})}function PE(s){s("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),s("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),s("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),s.WGS84=s["EPSG:4326"],s["EPSG:3785"]=s["EPSG:3857"],s.GOOGLE=s["EPSG:3857"],s["EPSG:900913"]=s["EPSG:3857"],s["EPSG:102113"]=s["EPSG:3857"]}var lf=1,cf=2,Lp=3,OE=4,kv=5,z1=6378137,RE=6356752314e-3,B1=.0066943799901413165,Ym=484813681109536e-20,ei=Math.PI/2,kE=.16666666666666666,zE=.04722222222222222,BE=.022156084656084655,wi=1e-10,la=.017453292519943295,Nu=57.29577951308232,Vr=Math.PI/4,n_=Math.PI*2,lo=3.14159265359,Ll={};Ll.greenwich=0;Ll.lisbon=-9.131906111111;Ll.paris=2.337229166667;Ll.bogota=-74.080916666667;Ll.madrid=-3.687938888889;Ll.rome=12.452333333333;Ll.bern=7.439583333333;Ll.jakarta=106.807719444444;Ll.ferro=-17.666666666667;Ll.brussels=4.367975;Ll.stockholm=18.058277777778;Ll.athens=23.7163375;Ll.oslo=10.722916666667;const FE={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var F1=/[\s_\-\/\(\)]/g;function ld(s,a){if(s[a])return s[a];for(var o=Object.keys(s),d=a.toLowerCase().replace(F1,""),_=-1,v,E;++_<o.length;)if(v=o[_],E=v.toLowerCase().replace(F1,""),E===d)return s[v]}function zv(s){var a={},o=s.split("+").map(function(r){return r.trim()}).filter(function(r){return r}).reduce(function(r,I){var R=I.split("=");return R.push(!0),r[R[0].toLowerCase()]=R[1],r},{}),d,_,v,E={proj:"projName",datum:"datumCode",rf:function(r){a.rf=parseFloat(r)},lat_0:function(r){a.lat0=r*la},lat_1:function(r){a.lat1=r*la},lat_2:function(r){a.lat2=r*la},lat_ts:function(r){a.lat_ts=r*la},lon_0:function(r){a.long0=r*la},lon_1:function(r){a.long1=r*la},lon_2:function(r){a.long2=r*la},alpha:function(r){a.alpha=parseFloat(r)*la},gamma:function(r){a.rectified_grid_angle=parseFloat(r)},lonc:function(r){a.longc=r*la},x_0:function(r){a.x0=parseFloat(r)},y_0:function(r){a.y0=parseFloat(r)},k_0:function(r){a.k0=parseFloat(r)},k:function(r){a.k0=parseFloat(r)},a:function(r){a.a=parseFloat(r)},b:function(r){a.b=parseFloat(r)},r_a:function(){a.R_A=!0},zone:function(r){a.zone=parseInt(r,10)},south:function(){a.utmSouth=!0},towgs84:function(r){a.datum_params=r.split(",").map(function(I){return parseFloat(I)})},to_meter:function(r){a.to_meter=parseFloat(r)},units:function(r){a.units=r;var I=ld(FE,r);I&&(a.to_meter=I.to_meter)},from_greenwich:function(r){a.from_greenwich=r*la},pm:function(r){var I=ld(Ll,r);a.from_greenwich=(I||parseFloat(r))*la},nadgrids:function(r){r==="@null"?a.datumCode="none":a.nadgrids=r},axis:function(r){var I="ewnsud";r.length===3&&I.indexOf(r.substr(0,1))!==-1&&I.indexOf(r.substr(1,1))!==-1&&I.indexOf(r.substr(2,1))!==-1&&(a.axis=r)},approx:function(){a.approx=!0}};for(d in o)_=o[d],d in E?(v=E[d],typeof v=="function"?v(_):a[v]=_):a[d]=_;return typeof a.datumCode=="string"&&a.datumCode!=="WGS84"&&(a.datumCode=a.datumCode.toLowerCase()),a}var r_=1,Zx=2,Xx=3,by=4,Kx=5,Xv=-1,NE=/\s/,UE=/[A-Za-z]/,VE=/[A-Za-z84_]/,Sy=/[,\]]/,Yx=/[\d\.E\-\+]/;function Lh(s){if(typeof s!="string")throw new Error("not a string");this.text=s.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=r_}Lh.prototype.readCharicter=function(){var s=this.text[this.place++];if(this.state!==by)for(;NE.test(s);){if(this.place>=this.text.length)return;s=this.text[this.place++]}switch(this.state){case r_:return this.neutral(s);case Zx:return this.keyword(s);case by:return this.quoted(s);case Kx:return this.afterquote(s);case Xx:return this.number(s);case Xv:return}};Lh.prototype.afterquote=function(s){if(s==='"'){this.word+='"',this.state=by;return}if(Sy.test(s)){this.word=this.word.trim(),this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in afterquote yet, index '+this.place)};Lh.prototype.afterItem=function(s){if(s===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=r_;return}if(s==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=r_,this.currentObject=this.stack.pop(),this.currentObject||(this.state=Xv);return}};Lh.prototype.number=function(s){if(Yx.test(s)){this.word+=s;return}if(Sy.test(s)){this.word=parseFloat(this.word),this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in number yet, index '+this.place)};Lh.prototype.quoted=function(s){if(s==='"'){this.state=Kx;return}this.word+=s};Lh.prototype.keyword=function(s){if(VE.test(s)){this.word+=s;return}if(s==="["){var a=[];a.push(this.word),this.level++,this.root===null?this.root=a:this.currentObject.push(a),this.stack.push(this.currentObject),this.currentObject=a,this.state=r_;return}if(Sy.test(s)){this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in keyword yet, index '+this.place)};Lh.prototype.neutral=function(s){if(UE.test(s)){this.word=s,this.state=Zx;return}if(s==='"'){this.word="",this.state=by;return}if(Yx.test(s)){this.word=s,this.state=Xx;return}if(Sy.test(s)){this.afterItem(s);return}throw new Error(`havn't handled "`+s+'" in neutral yet, index '+this.place)};Lh.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===Xv)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function GE(s){var a=new Lh(s);return a.output()}function N1(s,a,o){Array.isArray(a)&&(o.unshift(a),a=null);var d=a?{}:s,_=o.reduce(function(v,E){return Ep(E,v),v},d);a&&(s[a]=_)}function Ep(s,a){if(!Array.isArray(s)){a[s]=!0;return}var o=s.shift();if(o==="PARAMETER"&&(o=s.shift()),s.length===1){if(Array.isArray(s[0])){a[o]={},Ep(s[0],a[o]);return}a[o]=s[0];return}if(!s.length){a[o]=!0;return}if(o==="TOWGS84"){a[o]=s;return}if(o==="AXIS"){o in a||(a[o]=[]),a[o].push(s);return}Array.isArray(o)||(a[o]={});var d;switch(o){case"UNIT":case"PRIMEM":case"VERT_DATUM":a[o]={name:s[0].toLowerCase(),convert:s[1]},s.length===3&&Ep(s[2],a[o]);return;case"SPHEROID":case"ELLIPSOID":a[o]={name:s[0],a:s[1],rf:s[2]},s.length===4&&Ep(s[3],a[o]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":s[0]=["name",s[0]],N1(a,o,s);return;default:for(d=-1;++d<s.length;)if(!Array.isArray(s[d]))return Ep(s,a[o]);return N1(a,o,s)}}var jE=.017453292519943295;function qE(s,a){var o=a[0],d=a[1];!(o in s)&&d in s&&(s[o]=s[d],a.length===3&&(s[o]=a[2](s[o])))}function Fu(s){return s*jE}function HE(s){if(s.type==="GEOGCS"?s.projName="longlat":s.type==="LOCAL_CS"?(s.projName="identity",s.local=!0):typeof s.PROJECTION=="object"?s.projName=Object.keys(s.PROJECTION)[0]:s.projName=s.PROJECTION,s.AXIS){for(var a="",o=0,d=s.AXIS.length;o<d;++o){var _=[s.AXIS[o][0].toLowerCase(),s.AXIS[o][1].toLowerCase()];_[0].indexOf("north")!==-1||(_[0]==="y"||_[0]==="lat")&&_[1]==="north"?a+="n":_[0].indexOf("south")!==-1||(_[0]==="y"||_[0]==="lat")&&_[1]==="south"?a+="s":_[0].indexOf("east")!==-1||(_[0]==="x"||_[0]==="lon")&&_[1]==="east"?a+="e":(_[0].indexOf("west")!==-1||(_[0]==="x"||_[0]==="lon")&&_[1]==="west")&&(a+="w")}a.length===2&&(a+="u"),a.length===3&&(s.axis=a)}s.UNIT&&(s.units=s.UNIT.name.toLowerCase(),s.units==="metre"&&(s.units="meter"),s.UNIT.convert&&(s.type==="GEOGCS"?s.DATUM&&s.DATUM.SPHEROID&&(s.to_meter=s.UNIT.convert*s.DATUM.SPHEROID.a):s.to_meter=s.UNIT.convert));var v=s.GEOGCS;s.type==="GEOGCS"&&(v=s),v&&(v.DATUM?s.datumCode=v.DATUM.name.toLowerCase():s.datumCode=v.name.toLowerCase(),s.datumCode.slice(0,2)==="d_"&&(s.datumCode=s.datumCode.slice(2)),(s.datumCode==="new_zealand_geodetic_datum_1949"||s.datumCode==="new_zealand_1949")&&(s.datumCode="nzgd49"),(s.datumCode==="wgs_1984"||s.datumCode==="world_geodetic_system_1984")&&(s.PROJECTION==="Mercator_Auxiliary_Sphere"&&(s.sphere=!0),s.datumCode="wgs84"),s.datumCode.slice(-6)==="_ferro"&&(s.datumCode=s.datumCode.slice(0,-6)),s.datumCode.slice(-8)==="_jakarta"&&(s.datumCode=s.datumCode.slice(0,-8)),~s.datumCode.indexOf("belge")&&(s.datumCode="rnb72"),v.DATUM&&v.DATUM.SPHEROID&&(s.ellps=v.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),s.ellps.toLowerCase().slice(0,13)==="international"&&(s.ellps="intl"),s.a=v.DATUM.SPHEROID.a,s.rf=parseFloat(v.DATUM.SPHEROID.rf,10)),v.DATUM&&v.DATUM.TOWGS84&&(s.datum_params=v.DATUM.TOWGS84),~s.datumCode.indexOf("osgb_1936")&&(s.datumCode="osgb36"),~s.datumCode.indexOf("osni_1952")&&(s.datumCode="osni52"),(~s.datumCode.indexOf("tm65")||~s.datumCode.indexOf("geodetic_datum_of_1965"))&&(s.datumCode="ire65"),s.datumCode==="ch1903+"&&(s.datumCode="ch1903"),~s.datumCode.indexOf("israel")&&(s.datumCode="isr93")),s.b&&!isFinite(s.b)&&(s.b=s.a);function E(R){var U=s.to_meter||1;return R*U}var r=function(R){return qE(s,R)},I=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",Fu],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",Fu],["x0","false_easting",E],["y0","false_northing",E],["long0","central_meridian",Fu],["lat0","latitude_of_origin",Fu],["lat0","standard_parallel_1",Fu],["lat1","standard_parallel_1",Fu],["lat2","standard_parallel_2",Fu],["azimuth","Azimuth"],["alpha","azimuth",Fu],["srsCode","name"]];I.forEach(r),!s.long0&&s.longc&&(s.projName==="Albers_Conic_Equal_Area"||s.projName==="Lambert_Azimuthal_Equal_Area")&&(s.long0=s.longc),!s.lat_ts&&s.lat1&&(s.projName==="Stereographic_South_Pole"||s.projName==="Polar Stereographic (variant B)")?(s.lat0=Fu(s.lat1>0?90:-90),s.lat_ts=s.lat1):!s.lat_ts&&s.lat0&&s.projName==="Polar_Stereographic"&&(s.lat_ts=s.lat0,s.lat0=Fu(s.lat0>0?90:-90))}function Jx(s){var a=GE(s),o=a.shift(),d=a.shift();a.unshift(["name",d]),a.unshift(["type",o]);var _={};return Ep(a,_),HE(_),_}function $a(s){var a=this;if(arguments.length===2){var o=arguments[1];typeof o=="string"?o.charAt(0)==="+"?$a[s]=zv(arguments[1]):$a[s]=Jx(arguments[1]):$a[s]=o}else if(arguments.length===1){if(Array.isArray(s))return s.map(function(d){Array.isArray(d)?$a.apply(a,d):$a(d)});if(typeof s=="string"){if(s in $a)return $a[s]}else"EPSG"in s?$a["EPSG:"+s.EPSG]=s:"ESRI"in s?$a["ESRI:"+s.ESRI]=s:"IAU2000"in s?$a["IAU2000:"+s.IAU2000]=s:console.log(s);return}}PE($a);function WE(s){return typeof s=="string"}function ZE(s){return s in $a}var XE=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function KE(s){return XE.some(function(a){return s.indexOf(a)>-1})}var YE=["3857","900913","3785","102113"];function JE(s){var a=ld(s,"authority");if(a){var o=ld(a,"epsg");return o&&YE.indexOf(o)>-1}}function QE(s){var a=ld(s,"extension");if(a)return ld(a,"proj4")}function $E(s){return s[0]==="+"}function eT(s){if(WE(s)){if(ZE(s))return $a[s];if(KE(s)){var a=Jx(s);if(JE(a))return $a["EPSG:3857"];var o=QE(a);return o?zv(o):a}if($E(s))return zv(s)}else return s}function U1(s,a){s=s||{};var o,d;if(!a)return s;for(d in a)o=a[d],o!==void 0&&(s[d]=o);return s}function Hu(s,a,o){var d=s*a;return o/Math.sqrt(1-d*d)}function l_(s){return s<0?-1:1}function Di(s){return Math.abs(s)<=lo?s:s-l_(s)*n_}function ou(s,a,o){var d=s*o,_=.5*s;return d=Math.pow((1-d)/(1+d),_),Math.tan(.5*(ei-a))/d}function s_(s,a){for(var o=.5*s,d,_,v=ei-2*Math.atan(a),E=0;E<=15;E++)if(d=s*Math.sin(v),_=ei-2*Math.atan(a*Math.pow((1-d)/(1+d),o))-v,v+=_,Math.abs(_)<=1e-10)return v;return-9999}function tT(){var s=this.b/this.a;this.es=1-s*s,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Hu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function iT(s){var a=s.x,o=s.y;if(o*Nu>90&&o*Nu<-90&&a*Nu>180&&a*Nu<-180)return null;var d,_;if(Math.abs(Math.abs(o)-ei)<=wi)return null;if(this.sphere)d=this.x0+this.a*this.k0*Di(a-this.long0),_=this.y0+this.a*this.k0*Math.log(Math.tan(Vr+.5*o));else{var v=Math.sin(o),E=ou(this.e,o,v);d=this.x0+this.a*this.k0*Di(a-this.long0),_=this.y0-this.a*this.k0*Math.log(E)}return s.x=d,s.y=_,s}function nT(s){var a=s.x-this.x0,o=s.y-this.y0,d,_;if(this.sphere)_=ei-2*Math.atan(Math.exp(-o/(this.a*this.k0)));else{var v=Math.exp(-o/(this.a*this.k0));if(_=s_(this.e,v),_===-9999)return null}return d=Di(this.long0+a/(this.a*this.k0)),s.x=d,s.y=_,s}var rT=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const sT={init:tT,forward:iT,inverse:nT,names:rT};function oT(){}function V1(s){return s}var aT=["longlat","identity"];const lT={init:oT,forward:V1,inverse:V1,names:aT};var cT=[sT,lT],dy={},wy=[];function Qx(s,a){var o=wy.length;return s.names?(wy[o]=s,s.names.forEach(function(d){dy[d.toLowerCase()]=o}),this):(console.log(a),!0)}function uT(s){if(!s)return!1;var a=s.toLowerCase();if(typeof dy[a]<"u"&&wy[dy[a]])return wy[dy[a]]}function hT(){cT.forEach(Qx)}const dT={start:hT,add:Qx,get:uT};var zn={};zn.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};zn.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};zn.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};zn.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};zn.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};zn.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};zn.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};zn.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};zn.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};zn.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};zn.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};zn.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};zn.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};zn.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};zn.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};zn.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};zn.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};zn.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};zn.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};zn.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};zn.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};zn.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};zn.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};zn.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};zn.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};zn.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};zn.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};zn.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};zn.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};zn.hough={a:6378270,rf:297,ellipseName:"Hough"};zn.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};zn.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};zn.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};zn.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};zn.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};zn.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};zn.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};zn.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};zn.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};zn.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};zn.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};zn.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var fT=zn.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};zn.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function pT(s,a,o,d){var _=s*s,v=a*a,E=(_-v)/_,r=0;d?(s*=1-E*(kE+E*(zE+E*BE)),_=s*s,E=0):r=Math.sqrt(E);var I=(_-v)/v;return{es:E,e:r,ep2:I}}function mT(s,a,o,d,_){if(!s){var v=ld(zn,d);v||(v=fT),s=v.a,a=v.b,o=v.rf}return o&&!a&&(a=(1-1/o)*s),(o===0||Math.abs(s-a)<wi)&&(_=!0,a=s),{a:s,b:a,rf:o,sphere:_}}var Zo={};Zo.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};Zo.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};Zo.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};Zo.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};Zo.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};Zo.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};Zo.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};Zo.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};Zo.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};Zo.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};Zo.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};Zo.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};Zo.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};Zo.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};Zo.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};Zo.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};Zo.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function _T(s,a,o,d,_,v,E){var r={};return s===void 0||s==="none"?r.datum_type=kv:r.datum_type=OE,a&&(r.datum_params=a.map(parseFloat),(r.datum_params[0]!==0||r.datum_params[1]!==0||r.datum_params[2]!==0)&&(r.datum_type=lf),r.datum_params.length>3&&(r.datum_params[3]!==0||r.datum_params[4]!==0||r.datum_params[5]!==0||r.datum_params[6]!==0)&&(r.datum_type=cf,r.datum_params[3]*=Ym,r.datum_params[4]*=Ym,r.datum_params[5]*=Ym,r.datum_params[6]=r.datum_params[6]/1e6+1)),E&&(r.datum_type=Lp,r.grids=E),r.a=o,r.b=d,r.es=_,r.ep2=v,r}var $x={};function gT(s,a){var o=new DataView(a),d=xT(o),_=bT(o,d);_.nSubgrids>1&&console.log("Only single NTv2 subgrids are currently supported, subsequent sub grids are ignored");var v=wT(o,_,d),E={header:_,subgrids:v};return $x[s]=E,E}function yT(s){if(s===void 0)return null;var a=s.split(",");return a.map(vT)}function vT(s){if(s.length===0)return null;var a=s[0]==="@";return a&&(s=s.slice(1)),s==="null"?{name:"null",mandatory:!a,grid:null,isNull:!0}:{name:s,mandatory:!a,grid:$x[s]||null,isNull:!1}}function Tp(s){return s/3600*Math.PI/180}function xT(s){var a=s.getInt32(8,!1);return a===11?!1:(a=s.getInt32(8,!0),a!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function bT(s,a){return{nFields:s.getInt32(8,a),nSubgridFields:s.getInt32(24,a),nSubgrids:s.getInt32(40,a),shiftType:Bv(s,56,56+8).trim(),fromSemiMajorAxis:s.getFloat64(120,a),fromSemiMinorAxis:s.getFloat64(136,a),toSemiMajorAxis:s.getFloat64(152,a),toSemiMinorAxis:s.getFloat64(168,a)}}function Bv(s,a,o){return String.fromCharCode.apply(null,new Uint8Array(s.buffer.slice(a,o)))}function wT(s,a,o){for(var d=176,_=[],v=0;v<a.nSubgrids;v++){var E=TT(s,d,o),r=IT(s,d,E,o),I=Math.round(1+(E.upperLongitude-E.lowerLongitude)/E.longitudeInterval),R=Math.round(1+(E.upperLatitude-E.lowerLatitude)/E.latitudeInterval);_.push({ll:[Tp(E.lowerLongitude),Tp(E.lowerLatitude)],del:[Tp(E.longitudeInterval),Tp(E.latitudeInterval)],lim:[I,R],count:E.gridNodeCount,cvs:ET(r)})}return _}function ET(s){return s.map(function(a){return[Tp(a.longitudeShift),Tp(a.latitudeShift)]})}function TT(s,a,o){return{name:Bv(s,a+8,a+16).trim(),parent:Bv(s,a+24,a+24+8).trim(),lowerLatitude:s.getFloat64(a+72,o),upperLatitude:s.getFloat64(a+88,o),lowerLongitude:s.getFloat64(a+104,o),upperLongitude:s.getFloat64(a+120,o),latitudeInterval:s.getFloat64(a+136,o),longitudeInterval:s.getFloat64(a+152,o),gridNodeCount:s.getInt32(a+168,o)}}function IT(s,a,o,d){for(var _=a+176,v=16,E=[],r=0;r<o.gridNodeCount;r++){var I={latitudeShift:s.getFloat32(_+r*v,d),longitudeShift:s.getFloat32(_+r*v+4,d),latitudeAccuracy:s.getFloat32(_+r*v+8,d),longitudeAccuracy:s.getFloat32(_+r*v+12,d)};E.push(I)}return E}function Uu(s,a){if(!(this instanceof Uu))return new Uu(s);a=a||function(R){if(R)throw R};var o=eT(s);if(typeof o!="object"){a(s);return}var d=Uu.projections.get(o.projName);if(!d){a(s);return}if(o.datumCode&&o.datumCode!=="none"){var _=ld(Zo,o.datumCode);_&&(o.datum_params=o.datum_params||(_.towgs84?_.towgs84.split(","):null),o.ellps=_.ellipse,o.datumName=_.datumName?_.datumName:o.datumCode)}o.k0=o.k0||1,o.axis=o.axis||"enu",o.ellps=o.ellps||"wgs84",o.lat1=o.lat1||o.lat0;var v=mT(o.a,o.b,o.rf,o.ellps,o.sphere),E=pT(v.a,v.b,v.rf,o.R_A),r=yT(o.nadgrids),I=o.datum||_T(o.datumCode,o.datum_params,v.a,v.b,E.es,E.ep2,r);U1(this,o),U1(this,d),this.a=v.a,this.b=v.b,this.rf=v.rf,this.sphere=v.sphere,this.es=E.es,this.e=E.e,this.ep2=E.ep2,this.datum=I,this.init(),a(null,this)}Uu.projections=dT;Uu.projections.start();function MT(s,a){return s.datum_type!==a.datum_type||s.a!==a.a||Math.abs(s.es-a.es)>5e-11?!1:s.datum_type===lf?s.datum_params[0]===a.datum_params[0]&&s.datum_params[1]===a.datum_params[1]&&s.datum_params[2]===a.datum_params[2]:s.datum_type===cf?s.datum_params[0]===a.datum_params[0]&&s.datum_params[1]===a.datum_params[1]&&s.datum_params[2]===a.datum_params[2]&&s.datum_params[3]===a.datum_params[3]&&s.datum_params[4]===a.datum_params[4]&&s.datum_params[5]===a.datum_params[5]&&s.datum_params[6]===a.datum_params[6]:!0}function eb(s,a,o){var d=s.x,_=s.y,v=s.z?s.z:0,E,r,I,R;if(_<-ei&&_>-1.001*ei)_=-ei;else if(_>ei&&_<1.001*ei)_=ei;else{if(_<-ei)return{x:-1/0,y:-1/0,z:s.z};if(_>ei)return{x:1/0,y:1/0,z:s.z}}return d>Math.PI&&(d-=2*Math.PI),r=Math.sin(_),R=Math.cos(_),I=r*r,E=o/Math.sqrt(1-a*I),{x:(E+v)*R*Math.cos(d),y:(E+v)*R*Math.sin(d),z:(E*(1-a)+v)*r}}function tb(s,a,o,d){var _=1e-12,v=_*_,E=30,r,I,R,U,V,Z,Y,W,te,ae,Ie,ye,Ue,je=s.x,_e=s.y,ct=s.z?s.z:0,lt,St,Bt;if(r=Math.sqrt(je*je+_e*_e),I=Math.sqrt(je*je+_e*_e+ct*ct),r/o<_){if(lt=0,I/o<_)return St=ei,Bt=-d,{x:s.x,y:s.y,z:s.z}}else lt=Math.atan2(_e,je);R=ct/I,U=r/I,V=1/Math.sqrt(1-a*(2-a)*U*U),W=U*(1-a)*V,te=R*V,Ue=0;do Ue++,Y=o/Math.sqrt(1-a*te*te),Bt=r*W+ct*te-Y*(1-a*te*te),Z=a*Y/(Y+Bt),V=1/Math.sqrt(1-Z*(2-Z)*U*U),ae=U*(1-Z)*V,Ie=R*V,ye=Ie*W-ae*te,W=ae,te=Ie;while(ye*ye>v&&Ue<E);return St=Math.atan(Ie/Math.abs(ae)),{x:lt,y:St,z:Bt}}function AT(s,a,o){if(a===lf)return{x:s.x+o[0],y:s.y+o[1],z:s.z+o[2]};if(a===cf){var d=o[0],_=o[1],v=o[2],E=o[3],r=o[4],I=o[5],R=o[6];return{x:R*(s.x-I*s.y+r*s.z)+d,y:R*(I*s.x+s.y-E*s.z)+_,z:R*(-r*s.x+E*s.y+s.z)+v}}}function ST(s,a,o){if(a===lf)return{x:s.x-o[0],y:s.y-o[1],z:s.z-o[2]};if(a===cf){var d=o[0],_=o[1],v=o[2],E=o[3],r=o[4],I=o[5],R=o[6],U=(s.x-d)/R,V=(s.y-_)/R,Z=(s.z-v)/R;return{x:U+I*V-r*Z,y:-I*U+V+E*Z,z:r*U-E*V+Z}}}function oy(s){return s===lf||s===cf}function CT(s,a,o){if(MT(s,a)||s.datum_type===kv||a.datum_type===kv)return o;var d=s.a,_=s.es;if(s.datum_type===Lp){var v=G1(s,!1,o);if(v!==0)return;d=z1,_=B1}var E=a.a,r=a.b,I=a.es;if(a.datum_type===Lp&&(E=z1,r=RE,I=B1),_===I&&d===E&&!oy(s.datum_type)&&!oy(a.datum_type))return o;if(o=eb(o,_,d),oy(s.datum_type)&&(o=AT(o,s.datum_type,s.datum_params)),oy(a.datum_type)&&(o=ST(o,a.datum_type,a.datum_params)),o=tb(o,I,E,r),a.datum_type===Lp){var R=G1(a,!0,o);if(R!==0)return}return o}function G1(s,a,o){if(s.grids===null||s.grids.length===0)return console.log("Grid shift grids not found"),-1;for(var d={x:-o.x,y:o.y},_={x:Number.NaN,y:Number.NaN},v=[],E=0;E<s.grids.length;E++){var r=s.grids[E];if(v.push(r.name),r.isNull){_=d;break}if(r.mandatory,r.grid===null){if(r.mandatory)return console.log("Unable to find mandatory grid '"+r.name+"'"),-1;continue}var I=r.grid.subgrids[0],R=(Math.abs(I.del[1])+Math.abs(I.del[0]))/1e4,U=I.ll[0]-R,V=I.ll[1]-R,Z=I.ll[0]+(I.lim[0]-1)*I.del[0]+R,Y=I.ll[1]+(I.lim[1]-1)*I.del[1]+R;if(!(V>d.y||U>d.x||Y<d.y||Z<d.x)&&(_=LT(d,a,I),!isNaN(_.x)))break}return isNaN(_.x)?(console.log("Failed to find a grid shift table for location '"+-d.x*Nu+" "+d.y*Nu+" tried: '"+v+"'"),-1):(o.x=-_.x,o.y=_.y,0)}function LT(s,a,o){var d={x:Number.NaN,y:Number.NaN};if(isNaN(s.x))return d;var _={x:s.x,y:s.y};_.x-=o.ll[0],_.y-=o.ll[1],_.x=Di(_.x-Math.PI)+Math.PI;var v=j1(_,o);if(a){if(isNaN(v.x))return d;v.x=_.x-v.x,v.y=_.y-v.y;var E=9,r=1e-12,I,R;do{if(R=j1(v,o),isNaN(R.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}I={x:_.x-(R.x+v.x),y:_.y-(R.y+v.y)},v.x+=I.x,v.y+=I.y}while(E--&&Math.abs(I.x)>r&&Math.abs(I.y)>r);if(E<0)return console.log("Inverse grid shift iterator failed to converge."),d;d.x=Di(v.x+o.ll[0]),d.y=v.y+o.ll[1]}else isNaN(v.x)||(d.x=s.x+v.x,d.y=s.y+v.y);return d}function j1(s,a){var o={x:s.x/a.del[0],y:s.y/a.del[1]},d={x:Math.floor(o.x),y:Math.floor(o.y)},_={x:o.x-1*d.x,y:o.y-1*d.y},v={x:Number.NaN,y:Number.NaN},E;if(d.x<0||d.x>=a.lim[0]||d.y<0||d.y>=a.lim[1])return v;E=d.y*a.lim[0]+d.x;var r={x:a.cvs[E][0],y:a.cvs[E][1]};E++;var I={x:a.cvs[E][0],y:a.cvs[E][1]};E+=a.lim[0];var R={x:a.cvs[E][0],y:a.cvs[E][1]};E--;var U={x:a.cvs[E][0],y:a.cvs[E][1]},V=_.x*_.y,Z=_.x*(1-_.y),Y=(1-_.x)*(1-_.y),W=(1-_.x)*_.y;return v.x=Y*r.x+Z*I.x+W*U.x+V*R.x,v.y=Y*r.y+Z*I.y+W*U.y+V*R.y,v}function q1(s,a,o){var d=o.x,_=o.y,v=o.z||0,E,r,I,R={};for(I=0;I<3;I++)if(!(a&&I===2&&o.z===void 0))switch(I===0?(E=d,"ew".indexOf(s.axis[I])!==-1?r="x":r="y"):I===1?(E=_,"ns".indexOf(s.axis[I])!==-1?r="y":r="x"):(E=v,r="z"),s.axis[I]){case"e":R[r]=E;break;case"w":R[r]=-E;break;case"n":R[r]=E;break;case"s":R[r]=-E;break;case"u":o[r]!==void 0&&(R.z=E);break;case"d":o[r]!==void 0&&(R.z=-E);break;default:return null}return R}function ib(s){var a={x:s[0],y:s[1]};return s.length>2&&(a.z=s[2]),s.length>3&&(a.m=s[3]),a}function DT(s){H1(s.x),H1(s.y)}function H1(s){if(typeof Number.isFinite=="function"){if(Number.isFinite(s))return;throw new TypeError("coordinates must be finite numbers")}if(typeof s!="number"||s!==s||!isFinite(s))throw new TypeError("coordinates must be finite numbers")}function PT(s,a){return(s.datum.datum_type===lf||s.datum.datum_type===cf||s.datum.datum_type===Lp)&&a.datumCode!=="WGS84"||(a.datum.datum_type===lf||a.datum.datum_type===cf||a.datum.datum_type===Lp)&&s.datumCode!=="WGS84"}function Ey(s,a,o,d){var _;Array.isArray(o)?o=ib(o):o={x:o.x,y:o.y,z:o.z,m:o.m};var v=o.z!==void 0;if(DT(o),s.datum&&a.datum&&PT(s,a)&&(_=new Uu("WGS84"),o=Ey(s,_,o,d),s=_),d&&s.axis!=="enu"&&(o=q1(s,!1,o)),s.projName==="longlat")o={x:o.x*la,y:o.y*la,z:o.z||0};else if(s.to_meter&&(o={x:o.x*s.to_meter,y:o.y*s.to_meter,z:o.z||0}),o=s.inverse(o),!o)return;if(s.from_greenwich&&(o.x+=s.from_greenwich),o=CT(s.datum,a.datum,o),!!o)return a.from_greenwich&&(o={x:o.x-a.from_greenwich,y:o.y,z:o.z||0}),a.projName==="longlat"?o={x:o.x*Nu,y:o.y*Nu,z:o.z||0}:(o=a.forward(o),a.to_meter&&(o={x:o.x/a.to_meter,y:o.y/a.to_meter,z:o.z||0})),d&&a.axis!=="enu"?q1(a,!0,o):(v||delete o.z,o)}var W1=Uu("WGS84");function Av(s,a,o,d){var _,v,E;return Array.isArray(o)?(_=Ey(s,a,o,d)||{x:NaN,y:NaN},o.length>2?typeof s.name<"u"&&s.name==="geocent"||typeof a.name<"u"&&a.name==="geocent"?typeof _.z=="number"?[_.x,_.y,_.z].concat(o.splice(3)):[_.x,_.y,o[2]].concat(o.splice(3)):[_.x,_.y].concat(o.splice(2)):[_.x,_.y]):(v=Ey(s,a,o,d),E=Object.keys(o),E.length===2||E.forEach(function(r){if(typeof s.name<"u"&&s.name==="geocent"||typeof a.name<"u"&&a.name==="geocent"){if(r==="x"||r==="y"||r==="z")return}else if(r==="x"||r==="y")return;v[r]=o[r]}),v)}function Z1(s){return s instanceof Uu?s:s.oProj?s.oProj:Uu(s)}function tc(s,a,o){s=Z1(s);var d=!1,_;return typeof a>"u"?(a=s,s=W1,d=!0):(typeof a.x<"u"||Array.isArray(a))&&(o=a,a=s,s=W1,d=!0),a=Z1(a),o?Av(s,a,o):(_={forward:function(v,E){return Av(s,a,v,E)},inverse:function(v,E){return Av(a,s,v,E)}},d&&(_.oProj=a),_)}var X1=6,nb="AJSAJS",rb="AFAFAF",Ip=65,Il=73,Pc=79,Wm=86,Zm=90;const OT={forward:sb,inverse:RT,toPoint:ob};function sb(s,a){return a=a||5,BT(kT({lat:s[1],lon:s[0]}),a)}function RT(s){var a=Kv(lb(s.toUpperCase()));return a.lat&&a.lon?[a.lon,a.lat,a.lon,a.lat]:[a.left,a.bottom,a.right,a.top]}function ob(s){var a=Kv(lb(s.toUpperCase()));return a.lat&&a.lon?[a.lon,a.lat]:[(a.left+a.right)/2,(a.top+a.bottom)/2]}function Sv(s){return s*(Math.PI/180)}function K1(s){return 180*(s/Math.PI)}function kT(s){var a=s.lat,o=s.lon,d=6378137,_=.00669438,v=.9996,E,r,I,R,U,V,Z,Y=Sv(a),W=Sv(o),te,ae;ae=Math.floor((o+180)/6)+1,o===180&&(ae=60),a>=56&&a<64&&o>=3&&o<12&&(ae=32),a>=72&&a<84&&(o>=0&&o<9?ae=31:o>=9&&o<21?ae=33:o>=21&&o<33?ae=35:o>=33&&o<42&&(ae=37)),E=(ae-1)*6-180+3,te=Sv(E),r=_/(1-_),I=d/Math.sqrt(1-_*Math.sin(Y)*Math.sin(Y)),R=Math.tan(Y)*Math.tan(Y),U=r*Math.cos(Y)*Math.cos(Y),V=Math.cos(Y)*(W-te),Z=d*((1-_/4-3*_*_/64-5*_*_*_/256)*Y-(3*_/8+3*_*_/32+45*_*_*_/1024)*Math.sin(2*Y)+(15*_*_/256+45*_*_*_/1024)*Math.sin(4*Y)-35*_*_*_/3072*Math.sin(6*Y));var Ie=v*I*(V+(1-R+U)*V*V*V/6+(5-18*R+R*R+72*U-58*r)*V*V*V*V*V/120)+5e5,ye=v*(Z+I*Math.tan(Y)*(V*V/2+(5-R+9*U+4*U*U)*V*V*V*V/24+(61-58*R+R*R+600*U-330*r)*V*V*V*V*V*V/720));return a<0&&(ye+=1e7),{northing:Math.round(ye),easting:Math.round(Ie),zoneNumber:ae,zoneLetter:zT(a)}}function Kv(s){var a=s.northing,o=s.easting,d=s.zoneLetter,_=s.zoneNumber;if(_<0||_>60)return null;var v=.9996,E=6378137,r=.00669438,I,R=(1-Math.sqrt(1-r))/(1+Math.sqrt(1-r)),U,V,Z,Y,W,te,ae,Ie,ye,Ue=o-5e5,je=a;d<"N"&&(je-=1e7),ae=(_-1)*6-180+3,I=r/(1-r),te=je/v,Ie=te/(E*(1-r/4-3*r*r/64-5*r*r*r/256)),ye=Ie+(3*R/2-27*R*R*R/32)*Math.sin(2*Ie)+(21*R*R/16-55*R*R*R*R/32)*Math.sin(4*Ie)+151*R*R*R/96*Math.sin(6*Ie),U=E/Math.sqrt(1-r*Math.sin(ye)*Math.sin(ye)),V=Math.tan(ye)*Math.tan(ye),Z=I*Math.cos(ye)*Math.cos(ye),Y=E*(1-r)/Math.pow(1-r*Math.sin(ye)*Math.sin(ye),1.5),W=Ue/(U*v);var _e=ye-U*Math.tan(ye)/Y*(W*W/2-(5+3*V+10*Z-4*Z*Z-9*I)*W*W*W*W/24+(61+90*V+298*Z+45*V*V-252*I-3*Z*Z)*W*W*W*W*W*W/720);_e=K1(_e);var ct=(W-(1+2*V+Z)*W*W*W/6+(5-2*Z+28*V-3*Z*Z+8*I+24*V*V)*W*W*W*W*W/120)/Math.cos(ye);ct=ae+K1(ct);var lt;if(s.accuracy){var St=Kv({northing:s.northing+s.accuracy,easting:s.easting+s.accuracy,zoneLetter:s.zoneLetter,zoneNumber:s.zoneNumber});lt={top:St.lat,right:St.lon,bottom:_e,left:ct}}else lt={lat:_e,lon:ct};return lt}function zT(s){var a="Z";return 84>=s&&s>=72?a="X":72>s&&s>=64?a="W":64>s&&s>=56?a="V":56>s&&s>=48?a="U":48>s&&s>=40?a="T":40>s&&s>=32?a="S":32>s&&s>=24?a="R":24>s&&s>=16?a="Q":16>s&&s>=8?a="P":8>s&&s>=0?a="N":0>s&&s>=-8?a="M":-8>s&&s>=-16?a="L":-16>s&&s>=-24?a="K":-24>s&&s>=-32?a="J":-32>s&&s>=-40?a="H":-40>s&&s>=-48?a="G":-48>s&&s>=-56?a="F":-56>s&&s>=-64?a="E":-64>s&&s>=-72?a="D":-72>s&&s>=-80&&(a="C"),a}function BT(s,a){var o="00000"+s.easting,d="00000"+s.northing;return s.zoneNumber+s.zoneLetter+FT(s.easting,s.northing,s.zoneNumber)+o.substr(o.length-5,a)+d.substr(d.length-5,a)}function FT(s,a,o){var d=ab(o),_=Math.floor(s/1e5),v=Math.floor(a/1e5)%20;return NT(_,v,d)}function ab(s){var a=s%X1;return a===0&&(a=X1),a}function NT(s,a,o){var d=o-1,_=nb.charCodeAt(d),v=rb.charCodeAt(d),E=_+s-1,r=v+a,I=!1;E>Zm&&(E=E-Zm+Ip-1,I=!0),(E===Il||_<Il&&E>Il||(E>Il||_<Il)&&I)&&E++,(E===Pc||_<Pc&&E>Pc||(E>Pc||_<Pc)&&I)&&(E++,E===Il&&E++),E>Zm&&(E=E-Zm+Ip-1),r>Wm?(r=r-Wm+Ip-1,I=!0):I=!1,(r===Il||v<Il&&r>Il||(r>Il||v<Il)&&I)&&r++,(r===Pc||v<Pc&&r>Pc||(r>Pc||v<Pc)&&I)&&(r++,r===Il&&r++),r>Wm&&(r=r-Wm+Ip-1);var R=String.fromCharCode(E)+String.fromCharCode(r);return R}function lb(s){if(s&&s.length===0)throw"MGRSPoint coverting from nothing";for(var a=s.length,o=null,d="",_,v=0;!/[A-Z]/.test(_=s.charAt(v));){if(v>=2)throw"MGRSPoint bad conversion from: "+s;d+=_,v++}var E=parseInt(d,10);if(v===0||v+3>a)throw"MGRSPoint bad conversion from: "+s;var r=s.charAt(v++);if(r<="A"||r==="B"||r==="Y"||r>="Z"||r==="I"||r==="O")throw"MGRSPoint zone letter "+r+" not handled: "+s;o=s.substring(v,v+=2);for(var I=ab(E),R=UT(o.charAt(0),I),U=VT(o.charAt(1),I);U<GT(r);)U+=2e6;var V=a-v;if(V%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+s;var Z=V/2,Y=0,W=0,te,ae,Ie,ye,Ue;return Z>0&&(te=1e5/Math.pow(10,Z),ae=s.substring(v,v+Z),Y=parseFloat(ae)*te,Ie=s.substring(v+Z),W=parseFloat(Ie)*te),ye=Y+R,Ue=W+U,{easting:ye,northing:Ue,zoneLetter:r,zoneNumber:E,accuracy:te}}function UT(s,a){for(var o=nb.charCodeAt(a-1),d=1e5,_=!1;o!==s.charCodeAt(0);){if(o++,o===Il&&o++,o===Pc&&o++,o>Zm){if(_)throw"Bad character: "+s;o=Ip,_=!0}d+=1e5}return d}function VT(s,a){if(s>"V")throw"MGRSPoint given invalid Northing "+s;for(var o=rb.charCodeAt(a-1),d=0,_=!1;o!==s.charCodeAt(0);){if(o++,o===Il&&o++,o===Pc&&o++,o>Wm){if(_)throw"Bad character: "+s;o=Ip,_=!0}d+=1e5}return d}function GT(s){var a;switch(s){case"C":a=11e5;break;case"D":a=2e6;break;case"E":a=28e5;break;case"F":a=37e5;break;case"G":a=46e5;break;case"H":a=55e5;break;case"J":a=64e5;break;case"K":a=73e5;break;case"L":a=82e5;break;case"M":a=91e5;break;case"N":a=0;break;case"P":a=8e5;break;case"Q":a=17e5;break;case"R":a=26e5;break;case"S":a=35e5;break;case"T":a=44e5;break;case"U":a=53e5;break;case"V":a=62e5;break;case"W":a=7e6;break;case"X":a=79e5;break;default:a=-1}if(a>=0)return a;throw"Invalid zone letter: "+s}function Op(s,a,o){if(!(this instanceof Op))return new Op(s,a,o);if(Array.isArray(s))this.x=s[0],this.y=s[1],this.z=s[2]||0;else if(typeof s=="object")this.x=s.x,this.y=s.y,this.z=s.z||0;else if(typeof s=="string"&&typeof a>"u"){var d=s.split(",");this.x=parseFloat(d[0],10),this.y=parseFloat(d[1],10),this.z=parseFloat(d[2],10)||0}else this.x=s,this.y=a,this.z=o||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}Op.fromMGRS=function(s){return new Op(ob(s))};Op.prototype.toMGRS=function(s){return sb([this.x,this.y],s)};var jT=1,qT=.25,Y1=.046875,J1=.01953125,Q1=.01068115234375,HT=.75,WT=.46875,ZT=.013020833333333334,XT=.007120768229166667,KT=.3645833333333333,YT=.005696614583333333,JT=.3076171875;function cb(s){var a=[];a[0]=jT-s*(qT+s*(Y1+s*(J1+s*Q1))),a[1]=s*(HT-s*(Y1+s*(J1+s*Q1)));var o=s*s;return a[2]=o*(WT-s*(ZT+s*XT)),o*=s,a[3]=o*(KT-s*YT),a[4]=o*s*JT,a}function Cy(s,a,o,d){return o*=a,a*=a,d[0]*s-o*(d[1]+a*(d[2]+a*(d[3]+a*d[4])))}var QT=20;function ub(s,a,o){for(var d=1/(1-a),_=s,v=QT;v;--v){var E=Math.sin(_),r=1-a*E*E;if(r=(Cy(_,E,Math.cos(_),o)-s)*(r*Math.sqrt(r))*d,_-=r,Math.abs(r)<wi)return _}return _}function $T(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=cb(this.es),this.ml0=Cy(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function e2(s){var a=s.x,o=s.y,d=Di(a-this.long0),_,v,E,r=Math.sin(o),I=Math.cos(o);if(this.es){var U=I*d,V=Math.pow(U,2),Z=this.ep2*Math.pow(I,2),Y=Math.pow(Z,2),W=Math.abs(I)>wi?Math.tan(o):0,te=Math.pow(W,2),ae=Math.pow(te,2);_=1-this.es*Math.pow(r,2),U=U/Math.sqrt(_);var Ie=Cy(o,r,I,this.en);v=this.a*(this.k0*U*(1+V/6*(1-te+Z+V/20*(5-18*te+ae+14*Z-58*te*Z+V/42*(61+179*ae-ae*te-479*te)))))+this.x0,E=this.a*(this.k0*(Ie-this.ml0+r*d*U/2*(1+V/12*(5-te+9*Z+4*Y+V/30*(61+ae-58*te+270*Z-330*te*Z+V/56*(1385+543*ae-ae*te-3111*te))))))+this.y0}else{var R=I*Math.sin(d);if(Math.abs(Math.abs(R)-1)<wi)return 93;if(v=.5*this.a*this.k0*Math.log((1+R)/(1-R))+this.x0,E=I*Math.cos(d)/Math.sqrt(1-Math.pow(R,2)),R=Math.abs(E),R>=1){if(R-1>wi)return 93;E=0}else E=Math.acos(E);o<0&&(E=-E),E=this.a*this.k0*(E-this.lat0)+this.y0}return s.x=v,s.y=E,s}function t2(s){var a,o,d,_,v=(s.x-this.x0)*(1/this.a),E=(s.y-this.y0)*(1/this.a);if(this.es)if(a=this.ml0+E/this.k0,o=ub(a,this.es,this.en),Math.abs(o)<ei){var V=Math.sin(o),Z=Math.cos(o),Y=Math.abs(Z)>wi?Math.tan(o):0,W=this.ep2*Math.pow(Z,2),te=Math.pow(W,2),ae=Math.pow(Y,2),Ie=Math.pow(ae,2);a=1-this.es*Math.pow(V,2);var ye=v*Math.sqrt(a)/this.k0,Ue=Math.pow(ye,2);a=a*Y,d=o-a*Ue/(1-this.es)*.5*(1-Ue/12*(5+3*ae-9*W*ae+W-4*te-Ue/30*(61+90*ae-252*W*ae+45*Ie+46*W-Ue/56*(1385+3633*ae+4095*Ie+1574*Ie*ae)))),_=Di(this.long0+ye*(1-Ue/6*(1+2*ae+W-Ue/20*(5+28*ae+24*Ie+8*W*ae+6*W-Ue/42*(61+662*ae+1320*Ie+720*Ie*ae))))/Z)}else d=ei*l_(E),_=0;else{var r=Math.exp(v/this.k0),I=.5*(r-1/r),R=this.lat0+E/this.k0,U=Math.cos(R);a=Math.sqrt((1-Math.pow(U,2))/(1+Math.pow(I,2))),d=Math.asin(a),E<0&&(d=-d),I===0&&U===0?_=0:_=Di(Math.atan2(I,U)+this.long0)}return s.x=_,s.y=d,s}var i2=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const fy={init:$T,forward:e2,inverse:t2,names:i2};function hb(s){var a=Math.exp(s);return a=(a-1/a)/2,a}function su(s,a){s=Math.abs(s),a=Math.abs(a);var o=Math.max(s,a),d=Math.min(s,a)/(o||1);return o*Math.sqrt(1+Math.pow(d,2))}function n2(s){var a=1+s,o=a-1;return o===0?s:s*Math.log(a)/o}function r2(s){var a=Math.abs(s);return a=n2(a*(1+a/(su(1,a)+1))),s<0?-a:a}function Yv(s,a){for(var o=2*Math.cos(2*a),d=s.length-1,_=s[d],v=0,E;--d>=0;)E=-v+o*_+s[d],v=_,_=E;return a+E*Math.sin(2*a)}function s2(s,a){for(var o=2*Math.cos(a),d=s.length-1,_=s[d],v=0,E;--d>=0;)E=-v+o*_+s[d],v=_,_=E;return Math.sin(a)*E}function o2(s){var a=Math.exp(s);return a=(a+1/a)/2,a}function db(s,a,o){for(var d=Math.sin(a),_=Math.cos(a),v=hb(o),E=o2(o),r=2*_*E,I=-2*d*v,R=s.length-1,U=s[R],V=0,Z=0,Y=0,W,te;--R>=0;)W=Z,te=V,Z=U,V=Y,U=-W+r*Z-I*V+s[R],Y=-te+I*Z+r*V;return r=d*E,I=_*v,[r*U-I*Y,r*Y+I*U]}function a2(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(fy.init.apply(this),this.forward=fy.forward,this.inverse=fy.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var s=this.es/(1+Math.sqrt(1-this.es)),a=s/(2-s),o=a;this.cgb[0]=a*(2+a*(-2/3+a*(-2+a*(116/45+a*(26/45+a*(-2854/675)))))),this.cbg[0]=a*(-2+a*(2/3+a*(4/3+a*(-82/45+a*(32/45+a*(4642/4725)))))),o=o*a,this.cgb[1]=o*(7/3+a*(-8/5+a*(-227/45+a*(2704/315+a*(2323/945))))),this.cbg[1]=o*(5/3+a*(-16/15+a*(-13/9+a*(904/315+a*(-1522/945))))),o=o*a,this.cgb[2]=o*(56/15+a*(-136/35+a*(-1262/105+a*(73814/2835)))),this.cbg[2]=o*(-26/15+a*(34/21+a*(8/5+a*(-12686/2835)))),o=o*a,this.cgb[3]=o*(4279/630+a*(-332/35+a*(-399572/14175))),this.cbg[3]=o*(1237/630+a*(-12/5+a*(-24832/14175))),o=o*a,this.cgb[4]=o*(4174/315+a*(-144838/6237)),this.cbg[4]=o*(-734/315+a*(109598/31185)),o=o*a,this.cgb[5]=o*(601676/22275),this.cbg[5]=o*(444337/155925),o=Math.pow(a,2),this.Qn=this.k0/(1+a)*(1+o*(1/4+o*(1/64+o/256))),this.utg[0]=a*(-.5+a*(2/3+a*(-37/96+a*(1/360+a*(81/512+a*(-96199/604800)))))),this.gtu[0]=a*(.5+a*(-2/3+a*(5/16+a*(41/180+a*(-127/288+a*(7891/37800)))))),this.utg[1]=o*(-1/48+a*(-1/15+a*(437/1440+a*(-46/105+a*(1118711/3870720))))),this.gtu[1]=o*(13/48+a*(-3/5+a*(557/1440+a*(281/630+a*(-1983433/1935360))))),o=o*a,this.utg[2]=o*(-17/480+a*(37/840+a*(209/4480+a*(-5569/90720)))),this.gtu[2]=o*(61/240+a*(-103/140+a*(15061/26880+a*(167603/181440)))),o=o*a,this.utg[3]=o*(-4397/161280+a*(11/504+a*(830251/7257600))),this.gtu[3]=o*(49561/161280+a*(-179/168+a*(6601661/7257600))),o=o*a,this.utg[4]=o*(-4583/161280+a*(108847/3991680)),this.gtu[4]=o*(34729/80640+a*(-3418889/1995840)),o=o*a,this.utg[5]=o*(-20648693/638668800),this.gtu[5]=o*(212378941/319334400);var d=Yv(this.cbg,this.lat0);this.Zb=-this.Qn*(d+s2(this.gtu,2*d))}function l2(s){var a=Di(s.x-this.long0),o=s.y;o=Yv(this.cbg,o);var d=Math.sin(o),_=Math.cos(o),v=Math.sin(a),E=Math.cos(a);o=Math.atan2(d,E*_),a=Math.atan2(v*_,su(d,_*E)),a=r2(Math.tan(a));var r=db(this.gtu,2*o,2*a);o=o+r[0],a=a+r[1];var I,R;return Math.abs(a)<=2.623395162778?(I=this.a*(this.Qn*a)+this.x0,R=this.a*(this.Qn*o+this.Zb)+this.y0):(I=1/0,R=1/0),s.x=I,s.y=R,s}function c2(s){var a=(s.x-this.x0)*(1/this.a),o=(s.y-this.y0)*(1/this.a);o=(o-this.Zb)/this.Qn,a=a/this.Qn;var d,_;if(Math.abs(a)<=2.623395162778){var v=db(this.utg,2*o,2*a);o=o+v[0],a=a+v[1],a=Math.atan(hb(a));var E=Math.sin(o),r=Math.cos(o),I=Math.sin(a),R=Math.cos(a);o=Math.atan2(E*R,su(I,R*r)),a=Math.atan2(I,R*r),d=Di(a+this.long0),_=Yv(this.cgb,o)}else d=1/0,_=1/0;return s.x=d,s.y=_,s}var u2=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","tmerc"];const py={init:a2,forward:l2,inverse:c2,names:u2};function h2(s,a){if(s===void 0){if(s=Math.floor((Di(a)+Math.PI)*30/Math.PI)+1,s<0)return 0;if(s>60)return 60}return s}var d2="etmerc";function f2(){var s=h2(this.zone,this.long0);if(s===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(s)-183)*la,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,py.init.apply(this),this.forward=py.forward,this.inverse=py.inverse}var p2=["Universal Transverse Mercator System","utm"];const m2={init:f2,names:p2,dependsOn:d2};function Jv(s,a){return Math.pow((1-s)/(1+s),a)}var _2=20;function g2(){var s=Math.sin(this.lat0),a=Math.cos(this.lat0);a*=a,this.rc=Math.sqrt(1-this.es)/(1-this.es*s*s),this.C=Math.sqrt(1+this.es*a*a/(1-this.es)),this.phic0=Math.asin(s/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Vr)/(Math.pow(Math.tan(.5*this.lat0+Vr),this.C)*Jv(this.e*s,this.ratexp))}function y2(s){var a=s.x,o=s.y;return s.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*o+Vr),this.C)*Jv(this.e*Math.sin(o),this.ratexp))-ei,s.x=this.C*a,s}function v2(s){for(var a=1e-14,o=s.x/this.C,d=s.y,_=Math.pow(Math.tan(.5*d+Vr)/this.K,1/this.C),v=_2;v>0&&(d=2*Math.atan(_*Jv(this.e*Math.sin(s.y),-.5*this.e))-ei,!(Math.abs(d-s.y)<a));--v)s.y=d;return v?(s.x=o,s.y=d,s):null}var x2=["gauss"];const Qv={init:g2,forward:y2,inverse:v2,names:x2};function b2(){Qv.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function w2(s){var a,o,d,_;return s.x=Di(s.x-this.long0),Qv.forward.apply(this,[s]),a=Math.sin(s.y),o=Math.cos(s.y),d=Math.cos(s.x),_=this.k0*this.R2/(1+this.sinc0*a+this.cosc0*o*d),s.x=_*o*Math.sin(s.x),s.y=_*(this.cosc0*a-this.sinc0*o*d),s.x=this.a*s.x+this.x0,s.y=this.a*s.y+this.y0,s}function E2(s){var a,o,d,_,v;if(s.x=(s.x-this.x0)/this.a,s.y=(s.y-this.y0)/this.a,s.x/=this.k0,s.y/=this.k0,v=Math.sqrt(s.x*s.x+s.y*s.y)){var E=2*Math.atan2(v,this.R2);a=Math.sin(E),o=Math.cos(E),_=Math.asin(o*this.sinc0+s.y*a*this.cosc0/v),d=Math.atan2(s.x*a,v*this.cosc0*o-s.y*this.sinc0*a)}else _=this.phic0,d=0;return s.x=d,s.y=_,Qv.inverse.apply(this,[s]),s.x=Di(s.x+this.long0),s}var T2=["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const I2={init:b2,forward:w2,inverse:E2,names:T2};function M2(s,a,o){return a*=o,Math.tan(.5*(ei+s))*Math.pow((1-a)/(1+a),.5*o)}function A2(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=wi&&(this.k0=.5*(1+l_(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=wi&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=wi&&(this.k0=.5*this.cons*Hu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/ou(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Hu(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-ei,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function S2(s){var a=s.x,o=s.y,d=Math.sin(o),_=Math.cos(o),v,E,r,I,R,U,V=Di(a-this.long0);return Math.abs(Math.abs(a-this.long0)-Math.PI)<=wi&&Math.abs(o+this.lat0)<=wi?(s.x=NaN,s.y=NaN,s):this.sphere?(v=2*this.k0/(1+this.sinlat0*d+this.coslat0*_*Math.cos(V)),s.x=this.a*v*_*Math.sin(V)+this.x0,s.y=this.a*v*(this.coslat0*d-this.sinlat0*_*Math.cos(V))+this.y0,s):(E=2*Math.atan(this.ssfn_(o,d,this.e))-ei,I=Math.cos(E),r=Math.sin(E),Math.abs(this.coslat0)<=wi?(R=ou(this.e,o*this.con,this.con*d),U=2*this.a*this.k0*R/this.cons,s.x=this.x0+U*Math.sin(a-this.long0),s.y=this.y0-this.con*U*Math.cos(a-this.long0),s):(Math.abs(this.sinlat0)<wi?(v=2*this.a*this.k0/(1+I*Math.cos(V)),s.y=v*r):(v=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*r+this.cosX0*I*Math.cos(V))),s.y=v*(this.cosX0*r-this.sinX0*I*Math.cos(V))+this.y0),s.x=v*I*Math.sin(V)+this.x0,s))}function C2(s){s.x-=this.x0,s.y-=this.y0;var a,o,d,_,v,E=Math.sqrt(s.x*s.x+s.y*s.y);if(this.sphere){var r=2*Math.atan(E/(2*this.a*this.k0));return a=this.long0,o=this.lat0,E<=wi?(s.x=a,s.y=o,s):(o=Math.asin(Math.cos(r)*this.sinlat0+s.y*Math.sin(r)*this.coslat0/E),Math.abs(this.coslat0)<wi?this.lat0>0?a=Di(this.long0+Math.atan2(s.x,-1*s.y)):a=Di(this.long0+Math.atan2(s.x,s.y)):a=Di(this.long0+Math.atan2(s.x*Math.sin(r),E*this.coslat0*Math.cos(r)-s.y*this.sinlat0*Math.sin(r))),s.x=a,s.y=o,s)}else if(Math.abs(this.coslat0)<=wi){if(E<=wi)return o=this.lat0,a=this.long0,s.x=a,s.y=o,s;s.x*=this.con,s.y*=this.con,d=E*this.cons/(2*this.a*this.k0),o=this.con*s_(this.e,d),a=this.con*Di(this.con*this.long0+Math.atan2(s.x,-1*s.y))}else _=2*Math.atan(E*this.cosX0/(2*this.a*this.k0*this.ms1)),a=this.long0,E<=wi?v=this.X0:(v=Math.asin(Math.cos(_)*this.sinX0+s.y*Math.sin(_)*this.cosX0/E),a=Di(this.long0+Math.atan2(s.x*Math.sin(_),E*this.cosX0*Math.cos(_)-s.y*this.sinX0*Math.sin(_)))),o=-1*s_(this.e,Math.tan(.5*(ei+v)));return s.x=a,s.y=o,s}var L2=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"];const D2={init:A2,forward:S2,inverse:C2,names:L2,ssfn_:M2};function P2(){var s=this.lat0;this.lambda0=this.long0;var a=Math.sin(s),o=this.a,d=this.rf,_=1/d,v=2*_-Math.pow(_,2),E=this.e=Math.sqrt(v);this.R=this.k0*o*Math.sqrt(1-v)/(1-v*Math.pow(a,2)),this.alpha=Math.sqrt(1+v/(1-v)*Math.pow(Math.cos(s),4)),this.b0=Math.asin(a/this.alpha);var r=Math.log(Math.tan(Math.PI/4+this.b0/2)),I=Math.log(Math.tan(Math.PI/4+s/2)),R=Math.log((1+E*a)/(1-E*a));this.K=r-this.alpha*I+this.alpha*E/2*R}function O2(s){var a=Math.log(Math.tan(Math.PI/4-s.y/2)),o=this.e/2*Math.log((1+this.e*Math.sin(s.y))/(1-this.e*Math.sin(s.y))),d=-this.alpha*(a+o)+this.K,_=2*(Math.atan(Math.exp(d))-Math.PI/4),v=this.alpha*(s.x-this.lambda0),E=Math.atan(Math.sin(v)/(Math.sin(this.b0)*Math.tan(_)+Math.cos(this.b0)*Math.cos(v))),r=Math.asin(Math.cos(this.b0)*Math.sin(_)-Math.sin(this.b0)*Math.cos(_)*Math.cos(v));return s.y=this.R/2*Math.log((1+Math.sin(r))/(1-Math.sin(r)))+this.y0,s.x=this.R*E+this.x0,s}function R2(s){for(var a=s.x-this.x0,o=s.y-this.y0,d=a/this.R,_=2*(Math.atan(Math.exp(o/this.R))-Math.PI/4),v=Math.asin(Math.cos(this.b0)*Math.sin(_)+Math.sin(this.b0)*Math.cos(_)*Math.cos(d)),E=Math.atan(Math.sin(d)/(Math.cos(this.b0)*Math.cos(d)-Math.sin(this.b0)*Math.tan(_))),r=this.lambda0+E/this.alpha,I=0,R=v,U=-1e3,V=0;Math.abs(R-U)>1e-7;){if(++V>20)return;I=1/this.alpha*(Math.log(Math.tan(Math.PI/4+v/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(R))/2)),U=R,R=2*Math.atan(Math.exp(I))-Math.PI/2}return s.x=r,s.y=R,s}var k2=["somerc"];const z2={init:P2,forward:O2,inverse:R2,names:k2};var wp=1e-7;function B2(s){var a=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],o=typeof s.PROJECTION=="object"?Object.keys(s.PROJECTION)[0]:s.PROJECTION;return"no_uoff"in s||"no_off"in s||a.indexOf(o)!==-1}function F2(){var s,a,o,d,_,v,E,r,I,R,U=0,V,Z=0,Y=0,W=0,te=0,ae=0,Ie=0;this.no_off=B2(this),this.no_rot="no_rot"in this;var ye=!1;"alpha"in this&&(ye=!0);var Ue=!1;if("rectified_grid_angle"in this&&(Ue=!0),ye&&(Ie=this.alpha),Ue&&(U=this.rectified_grid_angle*la),ye||Ue)Z=this.longc;else if(Y=this.long1,te=this.lat1,W=this.long2,ae=this.lat2,Math.abs(te-ae)<=wp||(s=Math.abs(te))<=wp||Math.abs(s-ei)<=wp||Math.abs(Math.abs(this.lat0)-ei)<=wp||Math.abs(Math.abs(ae)-ei)<=wp)throw new Error;var je=1-this.es;a=Math.sqrt(je),Math.abs(this.lat0)>wi?(r=Math.sin(this.lat0),o=Math.cos(this.lat0),s=1-this.es*r*r,this.B=o*o,this.B=Math.sqrt(1+this.es*this.B*this.B/je),this.A=this.B*this.k0*a/s,d=this.B*a/(o*Math.sqrt(s)),_=d*d-1,_<=0?_=0:(_=Math.sqrt(_),this.lat0<0&&(_=-_)),this.E=_+=d,this.E*=Math.pow(ou(this.e,this.lat0,r),this.B)):(this.B=1/a,this.A=this.k0,this.E=d=_=1),ye||Ue?(ye?(V=Math.asin(Math.sin(Ie)/d),Ue||(U=Ie)):(V=U,Ie=Math.asin(d*Math.sin(V))),this.lam0=Z-Math.asin(.5*(_-1/_)*Math.tan(V))/this.B):(v=Math.pow(ou(this.e,te,Math.sin(te)),this.B),E=Math.pow(ou(this.e,ae,Math.sin(ae)),this.B),_=this.E/v,I=(E-v)/(E+v),R=this.E*this.E,R=(R-E*v)/(R+E*v),s=Y-W,s<-Math.pi?W-=n_:s>Math.pi&&(W+=n_),this.lam0=Di(.5*(Y+W)-Math.atan(R*Math.tan(.5*this.B*(Y-W))/I)/this.B),V=Math.atan(2*Math.sin(this.B*Di(Y-this.lam0))/(_-1/_)),U=Ie=Math.asin(d*Math.sin(V))),this.singam=Math.sin(V),this.cosgam=Math.cos(V),this.sinrot=Math.sin(U),this.cosrot=Math.cos(U),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(d*d-1)/Math.cos(Ie))),this.lat0<0&&(this.u_0=-this.u_0)),_=.5*V,this.v_pole_n=this.ArB*Math.log(Math.tan(Vr-_)),this.v_pole_s=this.ArB*Math.log(Math.tan(Vr+_))}function N2(s){var a={},o,d,_,v,E,r,I,R;if(s.x=s.x-this.lam0,Math.abs(Math.abs(s.y)-ei)>wi){if(E=this.E/Math.pow(ou(this.e,s.y,Math.sin(s.y)),this.B),r=1/E,o=.5*(E-r),d=.5*(E+r),v=Math.sin(this.B*s.x),_=(o*this.singam-v*this.cosgam)/d,Math.abs(Math.abs(_)-1)<wi)throw new Error;R=.5*this.ArB*Math.log((1-_)/(1+_)),r=Math.cos(this.B*s.x),Math.abs(r)<wp?I=this.A*s.x:I=this.ArB*Math.atan2(o*this.cosgam+v*this.singam,r)}else R=s.y>0?this.v_pole_n:this.v_pole_s,I=this.ArB*s.y;return this.no_rot?(a.x=I,a.y=R):(I-=this.u_0,a.x=R*this.cosrot+I*this.sinrot,a.y=I*this.cosrot-R*this.sinrot),a.x=this.a*a.x+this.x0,a.y=this.a*a.y+this.y0,a}function U2(s){var a,o,d,_,v,E,r,I={};if(s.x=(s.x-this.x0)*(1/this.a),s.y=(s.y-this.y0)*(1/this.a),this.no_rot?(o=s.y,a=s.x):(o=s.x*this.cosrot-s.y*this.sinrot,a=s.y*this.cosrot+s.x*this.sinrot+this.u_0),d=Math.exp(-this.BrA*o),_=.5*(d-1/d),v=.5*(d+1/d),E=Math.sin(this.BrA*a),r=(E*this.cosgam+_*this.singam)/v,Math.abs(Math.abs(r)-1)<wi)I.x=0,I.y=r<0?-ei:ei;else{if(I.y=this.E/Math.sqrt((1+r)/(1-r)),I.y=s_(this.e,Math.pow(I.y,1/this.B)),I.y===1/0)throw new Error;I.x=-this.rB*Math.atan2(_*this.cosgam-E*this.singam,Math.cos(this.BrA*a))}return I.x+=this.lam0,I}var V2=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const G2={init:F2,forward:N2,inverse:U2,names:V2};function j2(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<wi)){var s=this.b/this.a;this.e=Math.sqrt(1-s*s);var a=Math.sin(this.lat1),o=Math.cos(this.lat1),d=Hu(this.e,a,o),_=ou(this.e,this.lat1,a),v=Math.sin(this.lat2),E=Math.cos(this.lat2),r=Hu(this.e,v,E),I=ou(this.e,this.lat2,v),R=ou(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>wi?this.ns=Math.log(d/r)/Math.log(_/I):this.ns=a,isNaN(this.ns)&&(this.ns=a),this.f0=d/(this.ns*Math.pow(_,this.ns)),this.rh=this.a*this.f0*Math.pow(R,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function q2(s){var a=s.x,o=s.y;Math.abs(2*Math.abs(o)-Math.PI)<=wi&&(o=l_(o)*(ei-2*wi));var d=Math.abs(Math.abs(o)-ei),_,v;if(d>wi)_=ou(this.e,o,Math.sin(o)),v=this.a*this.f0*Math.pow(_,this.ns);else{if(d=o*this.ns,d<=0)return null;v=0}var E=this.ns*Di(a-this.long0);return s.x=this.k0*(v*Math.sin(E))+this.x0,s.y=this.k0*(this.rh-v*Math.cos(E))+this.y0,s}function H2(s){var a,o,d,_,v,E=(s.x-this.x0)/this.k0,r=this.rh-(s.y-this.y0)/this.k0;this.ns>0?(a=Math.sqrt(E*E+r*r),o=1):(a=-Math.sqrt(E*E+r*r),o=-1);var I=0;if(a!==0&&(I=Math.atan2(o*E,o*r)),a!==0||this.ns>0){if(o=1/this.ns,d=Math.pow(a/(this.a*this.f0),o),_=s_(this.e,d),_===-9999)return null}else _=-ei;return v=Di(I/this.ns+this.long0),s.x=v,s.y=_,s}var W2=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const Z2={init:j2,forward:q2,inverse:H2,names:W2};function X2(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function K2(s){var a,o,d,_,v,E,r,I=s.x,R=s.y,U=Di(I-this.long0);return a=Math.pow((1+this.e*Math.sin(R))/(1-this.e*Math.sin(R)),this.alfa*this.e/2),o=2*(Math.atan(this.k*Math.pow(Math.tan(R/2+this.s45),this.alfa)/a)-this.s45),d=-U*this.alfa,_=Math.asin(Math.cos(this.ad)*Math.sin(o)+Math.sin(this.ad)*Math.cos(o)*Math.cos(d)),v=Math.asin(Math.cos(o)*Math.sin(d)/Math.cos(_)),E=this.n*v,r=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(_/2+this.s45),this.n),s.y=r*Math.cos(E)/1,s.x=r*Math.sin(E)/1,this.czech||(s.y*=-1,s.x*=-1),s}function Y2(s){var a,o,d,_,v,E,r,I,R=s.x;s.x=s.y,s.y=R,this.czech||(s.y*=-1,s.x*=-1),E=Math.sqrt(s.x*s.x+s.y*s.y),v=Math.atan2(s.y,s.x),_=v/Math.sin(this.s0),d=2*(Math.atan(Math.pow(this.ro0/E,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),a=Math.asin(Math.cos(this.ad)*Math.sin(d)-Math.sin(this.ad)*Math.cos(d)*Math.cos(_)),o=Math.asin(Math.cos(d)*Math.sin(_)/Math.cos(a)),s.x=this.long0-o/this.alfa,r=a,I=0;var U=0;do s.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(a/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(r))/(1-this.e*Math.sin(r)),this.e/2))-this.s45),Math.abs(r-s.y)<1e-10&&(I=1),r=s.y,U+=1;while(I===0&&U<15);return U>=15?null:s}var J2=["Krovak","krovak"];const Q2={init:X2,forward:K2,inverse:Y2,names:J2};function el(s,a,o,d,_){return s*_-a*Math.sin(2*_)+o*Math.sin(4*_)-d*Math.sin(6*_)}function c_(s){return 1-.25*s*(1+s/16*(3+1.25*s))}function u_(s){return .375*s*(1+.25*s*(1+.46875*s))}function h_(s){return .05859375*s*s*(1+.75*s)}function d_(s){return s*s*s*(35/3072)}function Rp(s,a,o){var d=a*o;return s/Math.sqrt(1-d*d)}function kp(s){return Math.abs(s)<ei?s:s-l_(s)*Math.PI}function Ty(s,a,o,d,_){var v,E;v=s/a;for(var r=0;r<15;r++)if(E=(s-(a*v-o*Math.sin(2*v)+d*Math.sin(4*v)-_*Math.sin(6*v)))/(a-2*o*Math.cos(2*v)+4*d*Math.cos(4*v)-6*_*Math.cos(6*v)),v+=E,Math.abs(E)<=1e-10)return v;return NaN}function $2(){this.sphere||(this.e0=c_(this.es),this.e1=u_(this.es),this.e2=h_(this.es),this.e3=d_(this.es),this.ml0=this.a*el(this.e0,this.e1,this.e2,this.e3,this.lat0))}function eI(s){var a,o,d=s.x,_=s.y;if(d=Di(d-this.long0),this.sphere)a=this.a*Math.asin(Math.cos(_)*Math.sin(d)),o=this.a*(Math.atan2(Math.tan(_),Math.cos(d))-this.lat0);else{var v=Math.sin(_),E=Math.cos(_),r=Rp(this.a,this.e,v),I=Math.tan(_)*Math.tan(_),R=d*Math.cos(_),U=R*R,V=this.es*E*E/(1-this.es),Z=this.a*el(this.e0,this.e1,this.e2,this.e3,_);a=r*R*(1-U*I*(1/6-(8-I+8*V)*U/120)),o=Z-this.ml0+r*v/E*U*(.5+(5-I+6*V)*U/24)}return s.x=a+this.x0,s.y=o+this.y0,s}function tI(s){s.x-=this.x0,s.y-=this.y0;var a=s.x/this.a,o=s.y/this.a,d,_;if(this.sphere){var v=o+this.lat0;d=Math.asin(Math.sin(v)*Math.cos(a)),_=Math.atan2(Math.tan(a),Math.cos(v))}else{var E=this.ml0/this.a+o,r=Ty(E,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(r)-ei)<=wi)return s.x=this.long0,s.y=ei,o<0&&(s.y*=-1),s;var I=Rp(this.a,this.e,Math.sin(r)),R=I*I*I/this.a/this.a*(1-this.es),U=Math.pow(Math.tan(r),2),V=a*this.a/I,Z=V*V;d=r-I*Math.tan(r)/R*V*V*(.5-(1+3*U)*V*V/24),_=V*(1-Z*(U/3+(1+3*U)*U*Z/15))/Math.cos(r)}return s.x=Di(_+this.long0),s.y=kp(d),s}var iI=["Cassini","Cassini_Soldner","cass"];const nI={init:$2,forward:eI,inverse:tI,names:iI};function ad(s,a){var o;return s>1e-7?(o=s*a,(1-s*s)*(a/(1-o*o)-.5/s*Math.log((1-o)/(1+o)))):2*a}var rI=1,sI=2,oI=3,aI=4;function lI(){var s=Math.abs(this.lat0);if(Math.abs(s-ei)<wi?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(s)<wi?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var a;switch(this.qp=ad(this.e,1),this.mmf=.5/(1-this.es),this.apa=gI(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),a=Math.sin(this.lat0),this.sinb1=ad(this.e,a)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*a*a)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function cI(s){var a,o,d,_,v,E,r,I,R,U,V=s.x,Z=s.y;if(V=Di(V-this.long0),this.sphere){if(v=Math.sin(Z),U=Math.cos(Z),d=Math.cos(V),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(o=this.mode===this.EQUIT?1+U*d:1+this.sinph0*v+this.cosph0*U*d,o<=wi)return null;o=Math.sqrt(2/o),a=o*U*Math.sin(V),o*=this.mode===this.EQUIT?v:this.cosph0*v-this.sinph0*U*d}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(d=-d),Math.abs(Z+this.lat0)<wi)return null;o=Vr-Z*.5,o=2*(this.mode===this.S_POLE?Math.cos(o):Math.sin(o)),a=o*Math.sin(V),o*=d}}else{switch(r=0,I=0,R=0,d=Math.cos(V),_=Math.sin(V),v=Math.sin(Z),E=ad(this.e,v),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(r=E/this.qp,I=Math.sqrt(1-r*r)),this.mode){case this.OBLIQ:R=1+this.sinb1*r+this.cosb1*I*d;break;case this.EQUIT:R=1+I*d;break;case this.N_POLE:R=ei+Z,E=this.qp-E;break;case this.S_POLE:R=Z-ei,E=this.qp+E;break}if(Math.abs(R)<wi)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:R=Math.sqrt(2/R),this.mode===this.OBLIQ?o=this.ymf*R*(this.cosb1*r-this.sinb1*I*d):o=(R=Math.sqrt(2/(1+I*d)))*r*this.ymf,a=this.xmf*R*I*_;break;case this.N_POLE:case this.S_POLE:E>=0?(a=(R=Math.sqrt(E))*_,o=d*(this.mode===this.S_POLE?R:-R)):a=o=0;break}}return s.x=this.a*a+this.x0,s.y=this.a*o+this.y0,s}function uI(s){s.x-=this.x0,s.y-=this.y0;var a=s.x/this.a,o=s.y/this.a,d,_,v,E,r,I,R;if(this.sphere){var U=0,V,Z=0;if(V=Math.sqrt(a*a+o*o),_=V*.5,_>1)return null;switch(_=2*Math.asin(_),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(Z=Math.sin(_),U=Math.cos(_)),this.mode){case this.EQUIT:_=Math.abs(V)<=wi?0:Math.asin(o*Z/V),a*=Z,o=U*V;break;case this.OBLIQ:_=Math.abs(V)<=wi?this.lat0:Math.asin(U*this.sinph0+o*Z*this.cosph0/V),a*=Z*this.cosph0,o=(U-Math.sin(_)*this.sinph0)*V;break;case this.N_POLE:o=-o,_=ei-_;break;case this.S_POLE:_-=ei;break}d=o===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(a,o)}else{if(R=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(a/=this.dd,o*=this.dd,I=Math.sqrt(a*a+o*o),I<wi)return s.x=this.long0,s.y=this.lat0,s;E=2*Math.asin(.5*I/this.rq),v=Math.cos(E),a*=E=Math.sin(E),this.mode===this.OBLIQ?(R=v*this.sinb1+o*E*this.cosb1/I,r=this.qp*R,o=I*this.cosb1*v-o*this.sinb1*E):(R=o*E/I,r=this.qp*R,o=I*v)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(o=-o),r=a*a+o*o,!r)return s.x=this.long0,s.y=this.lat0,s;R=1-r/this.qp,this.mode===this.S_POLE&&(R=-R)}d=Math.atan2(a,o),_=yI(Math.asin(R),this.apa)}return s.x=Di(this.long0+d),s.y=_,s}var hI=.3333333333333333,dI=.17222222222222222,fI=.10257936507936508,pI=.06388888888888888,mI=.0664021164021164,_I=.016415012942191543;function gI(s){var a,o=[];return o[0]=s*hI,a=s*s,o[0]+=a*dI,o[1]=a*pI,a*=s,o[0]+=a*fI,o[1]+=a*mI,o[2]=a*_I,o}function yI(s,a){var o=s+s;return s+a[0]*Math.sin(o)+a[1]*Math.sin(o+o)+a[2]*Math.sin(o+o+o)}var vI=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const xI={init:lI,forward:cI,inverse:uI,names:vI,S_POLE:rI,N_POLE:sI,EQUIT:oI,OBLIQ:aI};function cd(s){return Math.abs(s)>1&&(s=s>1?1:-1),Math.asin(s)}function bI(){Math.abs(this.lat1+this.lat2)<wi||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Hu(this.e3,this.sin_po,this.cos_po),this.qs1=ad(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Hu(this.e3,this.sin_po,this.cos_po),this.qs2=ad(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=ad(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>wi?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function wI(s){var a=s.x,o=s.y;this.sin_phi=Math.sin(o),this.cos_phi=Math.cos(o);var d=ad(this.e3,this.sin_phi),_=this.a*Math.sqrt(this.c-this.ns0*d)/this.ns0,v=this.ns0*Di(a-this.long0),E=_*Math.sin(v)+this.x0,r=this.rh-_*Math.cos(v)+this.y0;return s.x=E,s.y=r,s}function EI(s){var a,o,d,_,v,E;return s.x-=this.x0,s.y=this.rh-s.y+this.y0,this.ns0>=0?(a=Math.sqrt(s.x*s.x+s.y*s.y),d=1):(a=-Math.sqrt(s.x*s.x+s.y*s.y),d=-1),_=0,a!==0&&(_=Math.atan2(d*s.x,d*s.y)),d=a*this.ns0/this.a,this.sphere?E=Math.asin((this.c-d*d)/(2*this.ns0)):(o=(this.c-d*d)/this.ns0,E=this.phi1z(this.e3,o)),v=Di(_/this.ns0+this.long0),s.x=v,s.y=E,s}function TI(s,a){var o,d,_,v,E,r=cd(.5*a);if(s<wi)return r;for(var I=s*s,R=1;R<=25;R++)if(o=Math.sin(r),d=Math.cos(r),_=s*o,v=1-_*_,E=.5*v*v/d*(a/(1-I)-o/v+.5/s*Math.log((1-_)/(1+_))),r=r+E,Math.abs(E)<=1e-7)return r;return null}var II=["Albers_Conic_Equal_Area","Albers","aea"];const MI={init:bI,forward:wI,inverse:EI,names:II,phi1z:TI};function AI(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function SI(s){var a,o,d,_,v,E,r,I,R=s.x,U=s.y;return d=Di(R-this.long0),a=Math.sin(U),o=Math.cos(U),_=Math.cos(d),E=this.sin_p14*a+this.cos_p14*o*_,v=1,E>0||Math.abs(E)<=wi?(r=this.x0+this.a*v*o*Math.sin(d)/E,I=this.y0+this.a*v*(this.cos_p14*a-this.sin_p14*o*_)/E):(r=this.x0+this.infinity_dist*o*Math.sin(d),I=this.y0+this.infinity_dist*(this.cos_p14*a-this.sin_p14*o*_)),s.x=r,s.y=I,s}function CI(s){var a,o,d,_,v,E;return s.x=(s.x-this.x0)/this.a,s.y=(s.y-this.y0)/this.a,s.x/=this.k0,s.y/=this.k0,(a=Math.sqrt(s.x*s.x+s.y*s.y))?(_=Math.atan2(a,this.rc),o=Math.sin(_),d=Math.cos(_),E=cd(d*this.sin_p14+s.y*o*this.cos_p14/a),v=Math.atan2(s.x*o,a*this.cos_p14*d-s.y*this.sin_p14*o),v=Di(this.long0+v)):(E=this.phic0,v=0),s.x=v,s.y=E,s}var LI=["gnom"];const DI={init:AI,forward:SI,inverse:CI,names:LI};function PI(s,a){var o=1-(1-s*s)/(2*s)*Math.log((1-s)/(1+s));if(Math.abs(Math.abs(a)-o)<1e-6)return a<0?-1*ei:ei;for(var d=Math.asin(.5*a),_,v,E,r,I=0;I<30;I++)if(v=Math.sin(d),E=Math.cos(d),r=s*v,_=Math.pow(1-r*r,2)/(2*E)*(a/(1-s*s)-v/(1-r*r)+.5/s*Math.log((1-r)/(1+r))),d+=_,Math.abs(_)<=1e-10)return d;return NaN}function OI(){this.sphere||(this.k0=Hu(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function RI(s){var a=s.x,o=s.y,d,_,v=Di(a-this.long0);if(this.sphere)d=this.x0+this.a*v*Math.cos(this.lat_ts),_=this.y0+this.a*Math.sin(o)/Math.cos(this.lat_ts);else{var E=ad(this.e,Math.sin(o));d=this.x0+this.a*this.k0*v,_=this.y0+this.a*E*.5/this.k0}return s.x=d,s.y=_,s}function kI(s){s.x-=this.x0,s.y-=this.y0;var a,o;return this.sphere?(a=Di(this.long0+s.x/this.a/Math.cos(this.lat_ts)),o=Math.asin(s.y/this.a*Math.cos(this.lat_ts))):(o=PI(this.e,2*s.y*this.k0/this.a),a=Di(this.long0+s.x/(this.a*this.k0))),s.x=a,s.y=o,s}var zI=["cea"];const BI={init:OI,forward:RI,inverse:kI,names:zI};function FI(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function NI(s){var a=s.x,o=s.y,d=Di(a-this.long0),_=kp(o-this.lat0);return s.x=this.x0+this.a*d*this.rc,s.y=this.y0+this.a*_,s}function UI(s){var a=s.x,o=s.y;return s.x=Di(this.long0+(a-this.x0)/(this.a*this.rc)),s.y=kp(this.lat0+(o-this.y0)/this.a),s}var VI=["Equirectangular","Equidistant_Cylindrical","eqc"];const GI={init:FI,forward:NI,inverse:UI,names:VI};var $1=20;function jI(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=c_(this.es),this.e1=u_(this.es),this.e2=h_(this.es),this.e3=d_(this.es),this.ml0=this.a*el(this.e0,this.e1,this.e2,this.e3,this.lat0)}function qI(s){var a=s.x,o=s.y,d,_,v,E=Di(a-this.long0);if(v=E*Math.sin(o),this.sphere)Math.abs(o)<=wi?(d=this.a*E,_=-1*this.a*this.lat0):(d=this.a*Math.sin(v)/Math.tan(o),_=this.a*(kp(o-this.lat0)+(1-Math.cos(v))/Math.tan(o)));else if(Math.abs(o)<=wi)d=this.a*E,_=-1*this.ml0;else{var r=Rp(this.a,this.e,Math.sin(o))/Math.tan(o);d=r*Math.sin(v),_=this.a*el(this.e0,this.e1,this.e2,this.e3,o)-this.ml0+r*(1-Math.cos(v))}return s.x=d+this.x0,s.y=_+this.y0,s}function HI(s){var a,o,d,_,v,E,r,I,R;if(d=s.x-this.x0,_=s.y-this.y0,this.sphere)if(Math.abs(_+this.a*this.lat0)<=wi)a=Di(d/this.a+this.long0),o=0;else{E=this.lat0+_/this.a,r=d*d/this.a/this.a+E*E,I=E;var U;for(v=$1;v;--v)if(U=Math.tan(I),R=-1*(E*(I*U+1)-I-.5*(I*I+r)*U)/((I-E)/U-1),I+=R,Math.abs(R)<=wi){o=I;break}a=Di(this.long0+Math.asin(d*Math.tan(I)/this.a)/Math.sin(o))}else if(Math.abs(_+this.ml0)<=wi)o=0,a=Di(this.long0+d/this.a);else{E=(this.ml0+_)/this.a,r=d*d/this.a/this.a+E*E,I=E;var V,Z,Y,W,te;for(v=$1;v;--v)if(te=this.e*Math.sin(I),V=Math.sqrt(1-te*te)*Math.tan(I),Z=this.a*el(this.e0,this.e1,this.e2,this.e3,I),Y=this.e0-2*this.e1*Math.cos(2*I)+4*this.e2*Math.cos(4*I)-6*this.e3*Math.cos(6*I),W=Z/this.a,R=(E*(V*W+1)-W-.5*V*(W*W+r))/(this.es*Math.sin(2*I)*(W*W+r-2*E*W)/(4*V)+(E-W)*(V*Y-2/Math.sin(2*I))-Y),I-=R,Math.abs(R)<=wi){o=I;break}V=Math.sqrt(1-this.es*Math.pow(Math.sin(o),2))*Math.tan(o),a=Di(this.long0+Math.asin(d*V/this.a)/Math.sin(o))}return s.x=a,s.y=o,s}var WI=["Polyconic","poly"];const ZI={init:jI,forward:qI,inverse:HI,names:WI};function XI(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function KI(s){var a,o=s.x,d=s.y,_=d-this.lat0,v=o-this.long0,E=_/Ym*1e-5,r=v,I=1,R=0;for(a=1;a<=10;a++)I=I*E,R=R+this.A[a]*I;var U=R,V=r,Z=1,Y=0,W,te,ae=0,Ie=0;for(a=1;a<=6;a++)W=Z*U-Y*V,te=Y*U+Z*V,Z=W,Y=te,ae=ae+this.B_re[a]*Z-this.B_im[a]*Y,Ie=Ie+this.B_im[a]*Z+this.B_re[a]*Y;return s.x=Ie*this.a+this.x0,s.y=ae*this.a+this.y0,s}function YI(s){var a,o=s.x,d=s.y,_=o-this.x0,v=d-this.y0,E=v/this.a,r=_/this.a,I=1,R=0,U,V,Z=0,Y=0;for(a=1;a<=6;a++)U=I*E-R*r,V=R*E+I*r,I=U,R=V,Z=Z+this.C_re[a]*I-this.C_im[a]*R,Y=Y+this.C_im[a]*I+this.C_re[a]*R;for(var W=0;W<this.iterations;W++){var te=Z,ae=Y,Ie,ye,Ue=E,je=r;for(a=2;a<=6;a++)Ie=te*Z-ae*Y,ye=ae*Z+te*Y,te=Ie,ae=ye,Ue=Ue+(a-1)*(this.B_re[a]*te-this.B_im[a]*ae),je=je+(a-1)*(this.B_im[a]*te+this.B_re[a]*ae);te=1,ae=0;var _e=this.B_re[1],ct=this.B_im[1];for(a=2;a<=6;a++)Ie=te*Z-ae*Y,ye=ae*Z+te*Y,te=Ie,ae=ye,_e=_e+a*(this.B_re[a]*te-this.B_im[a]*ae),ct=ct+a*(this.B_im[a]*te+this.B_re[a]*ae);var lt=_e*_e+ct*ct;Z=(Ue*_e+je*ct)/lt,Y=(je*_e-Ue*ct)/lt}var St=Z,Bt=Y,et=1,ot=0;for(a=1;a<=9;a++)et=et*St,ot=ot+this.D[a]*et;var Nt=this.lat0+ot*Ym*1e5,qt=this.long0+Bt;return s.x=qt,s.y=Nt,s}var JI=["New_Zealand_Map_Grid","nzmg"];const QI={init:XI,forward:KI,inverse:YI,names:JI};function $I(){}function eM(s){var a=s.x,o=s.y,d=Di(a-this.long0),_=this.x0+this.a*d,v=this.y0+this.a*Math.log(Math.tan(Math.PI/4+o/2.5))*1.25;return s.x=_,s.y=v,s}function tM(s){s.x-=this.x0,s.y-=this.y0;var a=Di(this.long0+s.x/this.a),o=2.5*(Math.atan(Math.exp(.8*s.y/this.a))-Math.PI/4);return s.x=a,s.y=o,s}var iM=["Miller_Cylindrical","mill"];const nM={init:$I,forward:eM,inverse:tM,names:iM};var rM=20;function sM(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=cb(this.es)}function oM(s){var a,o,d=s.x,_=s.y;if(d=Di(d-this.long0),this.sphere){if(!this.m)_=this.n!==1?Math.asin(this.n*Math.sin(_)):_;else for(var v=this.n*Math.sin(_),E=rM;E;--E){var r=(this.m*_+Math.sin(_)-v)/(this.m+Math.cos(_));if(_-=r,Math.abs(r)<wi)break}a=this.a*this.C_x*d*(this.m+Math.cos(_)),o=this.a*this.C_y*_}else{var I=Math.sin(_),R=Math.cos(_);o=this.a*Cy(_,I,R,this.en),a=this.a*d*R/Math.sqrt(1-this.es*I*I)}return s.x=a,s.y=o,s}function aM(s){var a,o,d,_;return s.x-=this.x0,d=s.x/this.a,s.y-=this.y0,a=s.y/this.a,this.sphere?(a/=this.C_y,d=d/(this.C_x*(this.m+Math.cos(a))),this.m?a=cd((this.m*a+Math.sin(a))/this.n):this.n!==1&&(a=cd(Math.sin(a)/this.n)),d=Di(d+this.long0),a=kp(a)):(a=ub(s.y/this.a,this.es,this.en),_=Math.abs(a),_<ei?(_=Math.sin(a),o=this.long0+s.x*Math.sqrt(1-this.es*_*_)/(this.a*Math.cos(a)),d=Di(o)):_-wi<ei&&(d=this.long0)),s.x=d,s.y=a,s}var lM=["Sinusoidal","sinu"];const cM={init:sM,forward:oM,inverse:aM,names:lM};function uM(){}function hM(s){for(var a=s.x,o=s.y,d=Di(a-this.long0),_=o,v=Math.PI*Math.sin(o);;){var E=-(_+Math.sin(_)-v)/(1+Math.cos(_));if(_+=E,Math.abs(E)<wi)break}_/=2,Math.PI/2-Math.abs(o)<wi&&(d=0);var r=.900316316158*this.a*d*Math.cos(_)+this.x0,I=1.4142135623731*this.a*Math.sin(_)+this.y0;return s.x=r,s.y=I,s}function dM(s){var a,o;s.x-=this.x0,s.y-=this.y0,o=s.y/(1.4142135623731*this.a),Math.abs(o)>.999999999999&&(o=.999999999999),a=Math.asin(o);var d=Di(this.long0+s.x/(.900316316158*this.a*Math.cos(a)));d<-Math.PI&&(d=-Math.PI),d>Math.PI&&(d=Math.PI),o=(2*a+Math.sin(2*a))/Math.PI,Math.abs(o)>1&&(o=1);var _=Math.asin(o);return s.x=d,s.y=_,s}var fM=["Mollweide","moll"];const pM={init:uM,forward:hM,inverse:dM,names:fM};function mM(){Math.abs(this.lat1+this.lat2)<wi||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=c_(this.es),this.e1=u_(this.es),this.e2=h_(this.es),this.e3=d_(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Hu(this.e,this.sinphi,this.cosphi),this.ml1=el(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<wi?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Hu(this.e,this.sinphi,this.cosphi),this.ml2=el(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=el(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function _M(s){var a=s.x,o=s.y,d;if(this.sphere)d=this.a*(this.g-o);else{var _=el(this.e0,this.e1,this.e2,this.e3,o);d=this.a*(this.g-_)}var v=this.ns*Di(a-this.long0),E=this.x0+d*Math.sin(v),r=this.y0+this.rh-d*Math.cos(v);return s.x=E,s.y=r,s}function gM(s){s.x-=this.x0,s.y=this.rh-s.y+this.y0;var a,o,d,_;this.ns>=0?(o=Math.sqrt(s.x*s.x+s.y*s.y),a=1):(o=-Math.sqrt(s.x*s.x+s.y*s.y),a=-1);var v=0;if(o!==0&&(v=Math.atan2(a*s.x,a*s.y)),this.sphere)return _=Di(this.long0+v/this.ns),d=kp(this.g-o/this.a),s.x=_,s.y=d,s;var E=this.g-o/this.a;return d=Ty(E,this.e0,this.e1,this.e2,this.e3),_=Di(this.long0+v/this.ns),s.x=_,s.y=d,s}var yM=["Equidistant_Conic","eqdc"];const vM={init:mM,forward:_M,inverse:gM,names:yM};function xM(){this.R=this.a}function bM(s){var a=s.x,o=s.y,d=Di(a-this.long0),_,v;Math.abs(o)<=wi&&(_=this.x0+this.R*d,v=this.y0);var E=cd(2*Math.abs(o/Math.PI));(Math.abs(d)<=wi||Math.abs(Math.abs(o)-ei)<=wi)&&(_=this.x0,o>=0?v=this.y0+Math.PI*this.R*Math.tan(.5*E):v=this.y0+Math.PI*this.R*-Math.tan(.5*E));var r=.5*Math.abs(Math.PI/d-d/Math.PI),I=r*r,R=Math.sin(E),U=Math.cos(E),V=U/(R+U-1),Z=V*V,Y=V*(2/R-1),W=Y*Y,te=Math.PI*this.R*(r*(V-W)+Math.sqrt(I*(V-W)*(V-W)-(W+I)*(Z-W)))/(W+I);d<0&&(te=-te),_=this.x0+te;var ae=I+V;return te=Math.PI*this.R*(Y*ae-r*Math.sqrt((W+I)*(I+1)-ae*ae))/(W+I),o>=0?v=this.y0+te:v=this.y0-te,s.x=_,s.y=v,s}function wM(s){var a,o,d,_,v,E,r,I,R,U,V,Z,Y;return s.x-=this.x0,s.y-=this.y0,V=Math.PI*this.R,d=s.x/V,_=s.y/V,v=d*d+_*_,E=-Math.abs(_)*(1+v),r=E-2*_*_+d*d,I=-2*E+1+2*_*_+v*v,Y=_*_/I+(2*r*r*r/I/I/I-9*E*r/I/I)/27,R=(E-r*r/3/I)/I,U=2*Math.sqrt(-R/3),V=3*Y/R/U,Math.abs(V)>1&&(V>=0?V=1:V=-1),Z=Math.acos(V)/3,s.y>=0?o=(-U*Math.cos(Z+Math.PI/3)-r/3/I)*Math.PI:o=-(-U*Math.cos(Z+Math.PI/3)-r/3/I)*Math.PI,Math.abs(d)<wi?a=this.long0:a=Di(this.long0+Math.PI*(v-1+Math.sqrt(1+2*(d*d-_*_)+v*v))/2/d),s.x=a,s.y=o,s}var EM=["Van_der_Grinten_I","VanDerGrinten","vandg"];const TM={init:xM,forward:bM,inverse:wM,names:EM};function IM(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function MM(s){var a=s.x,o=s.y,d=Math.sin(s.y),_=Math.cos(s.y),v=Di(a-this.long0),E,r,I,R,U,V,Z,Y,W,te,ae,Ie,ye,Ue,je,_e,ct,lt,St,Bt,et,ot,Nt;return this.sphere?Math.abs(this.sin_p12-1)<=wi?(s.x=this.x0+this.a*(ei-o)*Math.sin(v),s.y=this.y0-this.a*(ei-o)*Math.cos(v),s):Math.abs(this.sin_p12+1)<=wi?(s.x=this.x0+this.a*(ei+o)*Math.sin(v),s.y=this.y0+this.a*(ei+o)*Math.cos(v),s):(lt=this.sin_p12*d+this.cos_p12*_*Math.cos(v),_e=Math.acos(lt),ct=_e?_e/Math.sin(_e):1,s.x=this.x0+this.a*ct*_*Math.sin(v),s.y=this.y0+this.a*ct*(this.cos_p12*d-this.sin_p12*_*Math.cos(v)),s):(E=c_(this.es),r=u_(this.es),I=h_(this.es),R=d_(this.es),Math.abs(this.sin_p12-1)<=wi?(U=this.a*el(E,r,I,R,ei),V=this.a*el(E,r,I,R,o),s.x=this.x0+(U-V)*Math.sin(v),s.y=this.y0-(U-V)*Math.cos(v),s):Math.abs(this.sin_p12+1)<=wi?(U=this.a*el(E,r,I,R,ei),V=this.a*el(E,r,I,R,o),s.x=this.x0+(U+V)*Math.sin(v),s.y=this.y0+(U+V)*Math.cos(v),s):(Z=d/_,Y=Rp(this.a,this.e,this.sin_p12),W=Rp(this.a,this.e,d),te=Math.atan((1-this.es)*Z+this.es*Y*this.sin_p12/(W*_)),ae=Math.atan2(Math.sin(v),this.cos_p12*Math.tan(te)-this.sin_p12*Math.cos(v)),ae===0?St=Math.asin(this.cos_p12*Math.sin(te)-this.sin_p12*Math.cos(te)):Math.abs(Math.abs(ae)-Math.PI)<=wi?St=-Math.asin(this.cos_p12*Math.sin(te)-this.sin_p12*Math.cos(te)):St=Math.asin(Math.sin(v)*Math.cos(te)/Math.sin(ae)),Ie=this.e*this.sin_p12/Math.sqrt(1-this.es),ye=this.e*this.cos_p12*Math.cos(ae)/Math.sqrt(1-this.es),Ue=Ie*ye,je=ye*ye,Bt=St*St,et=Bt*St,ot=et*St,Nt=ot*St,_e=Y*St*(1-Bt*je*(1-je)/6+et/8*Ue*(1-2*je)+ot/120*(je*(4-7*je)-3*Ie*Ie*(1-7*je))-Nt/48*Ue),s.x=this.x0+_e*Math.sin(ae),s.y=this.y0+_e*Math.cos(ae),s))}function AM(s){s.x-=this.x0,s.y-=this.y0;var a,o,d,_,v,E,r,I,R,U,V,Z,Y,W,te,ae,Ie,ye,Ue,je,_e,ct,lt,St;return this.sphere?(a=Math.sqrt(s.x*s.x+s.y*s.y),a>2*ei*this.a?void 0:(o=a/this.a,d=Math.sin(o),_=Math.cos(o),v=this.long0,Math.abs(a)<=wi?E=this.lat0:(E=cd(_*this.sin_p12+s.y*d*this.cos_p12/a),r=Math.abs(this.lat0)-ei,Math.abs(r)<=wi?this.lat0>=0?v=Di(this.long0+Math.atan2(s.x,-s.y)):v=Di(this.long0-Math.atan2(-s.x,s.y)):v=Di(this.long0+Math.atan2(s.x*d,a*this.cos_p12*_-s.y*this.sin_p12*d))),s.x=v,s.y=E,s)):(I=c_(this.es),R=u_(this.es),U=h_(this.es),V=d_(this.es),Math.abs(this.sin_p12-1)<=wi?(Z=this.a*el(I,R,U,V,ei),a=Math.sqrt(s.x*s.x+s.y*s.y),Y=Z-a,E=Ty(Y/this.a,I,R,U,V),v=Di(this.long0+Math.atan2(s.x,-1*s.y)),s.x=v,s.y=E,s):Math.abs(this.sin_p12+1)<=wi?(Z=this.a*el(I,R,U,V,ei),a=Math.sqrt(s.x*s.x+s.y*s.y),Y=a-Z,E=Ty(Y/this.a,I,R,U,V),v=Di(this.long0+Math.atan2(s.x,s.y)),s.x=v,s.y=E,s):(a=Math.sqrt(s.x*s.x+s.y*s.y),ae=Math.atan2(s.x,s.y),W=Rp(this.a,this.e,this.sin_p12),Ie=Math.cos(ae),ye=this.e*this.cos_p12*Ie,Ue=-ye*ye/(1-this.es),je=3*this.es*(1-Ue)*this.sin_p12*this.cos_p12*Ie/(1-this.es),_e=a/W,ct=_e-Ue*(1+Ue)*Math.pow(_e,3)/6-je*(1+3*Ue)*Math.pow(_e,4)/24,lt=1-Ue*ct*ct/2-_e*ct*ct*ct/6,te=Math.asin(this.sin_p12*Math.cos(ct)+this.cos_p12*Math.sin(ct)*Ie),v=Di(this.long0+Math.asin(Math.sin(ae)*Math.sin(ct)/Math.cos(te))),St=Math.sin(te),E=Math.atan2((St-this.es*lt*this.sin_p12)*Math.tan(te),St*(1-this.es)),s.x=v,s.y=E,s))}var SM=["Azimuthal_Equidistant","aeqd"];const CM={init:IM,forward:MM,inverse:AM,names:SM};function LM(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function DM(s){var a,o,d,_,v,E,r,I,R=s.x,U=s.y;return d=Di(R-this.long0),a=Math.sin(U),o=Math.cos(U),_=Math.cos(d),E=this.sin_p14*a+this.cos_p14*o*_,v=1,(E>0||Math.abs(E)<=wi)&&(r=this.a*v*o*Math.sin(d),I=this.y0+this.a*v*(this.cos_p14*a-this.sin_p14*o*_)),s.x=r,s.y=I,s}function PM(s){var a,o,d,_,v,E,r;return s.x-=this.x0,s.y-=this.y0,a=Math.sqrt(s.x*s.x+s.y*s.y),o=cd(a/this.a),d=Math.sin(o),_=Math.cos(o),E=this.long0,Math.abs(a)<=wi?(r=this.lat0,s.x=E,s.y=r,s):(r=cd(_*this.sin_p14+s.y*d*this.cos_p14/a),v=Math.abs(this.lat0)-ei,Math.abs(v)<=wi?(this.lat0>=0?E=Di(this.long0+Math.atan2(s.x,-s.y)):E=Di(this.long0-Math.atan2(-s.x,s.y)),s.x=E,s.y=r,s):(E=Di(this.long0+Math.atan2(s.x*d,a*this.cos_p14*_-s.y*this.sin_p14*d)),s.x=E,s.y=r,s))}var OM=["ortho"];const RM={init:LM,forward:DM,inverse:PM,names:OM};var Ns={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Gr={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function kM(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=ei-Vr/2?this.face=Ns.TOP:this.lat0<=-(ei-Vr/2)?this.face=Ns.BOTTOM:Math.abs(this.long0)<=Vr?this.face=Ns.FRONT:Math.abs(this.long0)<=ei+Vr?this.face=this.long0>0?Ns.RIGHT:Ns.LEFT:this.face=Ns.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function zM(s){var a={x:0,y:0},o,d,_,v,E,r,I={value:0};if(s.x-=this.long0,this.es!==0?o=Math.atan(this.one_minus_f_squared*Math.tan(s.y)):o=s.y,d=s.x,this.face===Ns.TOP)v=ei-o,d>=Vr&&d<=ei+Vr?(I.value=Gr.AREA_0,_=d-ei):d>ei+Vr||d<=-(ei+Vr)?(I.value=Gr.AREA_1,_=d>0?d-lo:d+lo):d>-(ei+Vr)&&d<=-Vr?(I.value=Gr.AREA_2,_=d+ei):(I.value=Gr.AREA_3,_=d);else if(this.face===Ns.BOTTOM)v=ei+o,d>=Vr&&d<=ei+Vr?(I.value=Gr.AREA_0,_=-d+ei):d<Vr&&d>=-Vr?(I.value=Gr.AREA_1,_=-d):d<-Vr&&d>=-(ei+Vr)?(I.value=Gr.AREA_2,_=-d-ei):(I.value=Gr.AREA_3,_=d>0?-d+lo:-d-lo);else{var R,U,V,Z,Y,W,te;this.face===Ns.RIGHT?d=Dp(d,+ei):this.face===Ns.BACK?d=Dp(d,+lo):this.face===Ns.LEFT&&(d=Dp(d,-ei)),Z=Math.sin(o),Y=Math.cos(o),W=Math.sin(d),te=Math.cos(d),R=Y*te,U=Y*W,V=Z,this.face===Ns.FRONT?(v=Math.acos(R),_=ay(v,V,U,I)):this.face===Ns.RIGHT?(v=Math.acos(U),_=ay(v,V,-R,I)):this.face===Ns.BACK?(v=Math.acos(-R),_=ay(v,V,-U,I)):this.face===Ns.LEFT?(v=Math.acos(-U),_=ay(v,V,R,I)):(v=_=0,I.value=Gr.AREA_0)}return r=Math.atan(12/lo*(_+Math.acos(Math.sin(_)*Math.cos(Vr))-ei)),E=Math.sqrt((1-Math.cos(v))/(Math.cos(r)*Math.cos(r))/(1-Math.cos(Math.atan(1/Math.cos(_))))),I.value===Gr.AREA_1?r+=ei:I.value===Gr.AREA_2?r+=lo:I.value===Gr.AREA_3&&(r+=1.5*lo),a.x=E*Math.cos(r),a.y=E*Math.sin(r),a.x=a.x*this.a+this.x0,a.y=a.y*this.a+this.y0,s.x=a.x,s.y=a.y,s}function BM(s){var a={lam:0,phi:0},o,d,_,v,E,r,I,R,U,V={value:0};if(s.x=(s.x-this.x0)/this.a,s.y=(s.y-this.y0)/this.a,d=Math.atan(Math.sqrt(s.x*s.x+s.y*s.y)),o=Math.atan2(s.y,s.x),s.x>=0&&s.x>=Math.abs(s.y)?V.value=Gr.AREA_0:s.y>=0&&s.y>=Math.abs(s.x)?(V.value=Gr.AREA_1,o-=ei):s.x<0&&-s.x>=Math.abs(s.y)?(V.value=Gr.AREA_2,o=o<0?o+lo:o-lo):(V.value=Gr.AREA_3,o+=ei),U=lo/12*Math.tan(o),E=Math.sin(U)/(Math.cos(U)-1/Math.sqrt(2)),r=Math.atan(E),_=Math.cos(o),v=Math.tan(d),I=1-_*_*v*v*(1-Math.cos(Math.atan(1/Math.cos(r)))),I<-1?I=-1:I>1&&(I=1),this.face===Ns.TOP)R=Math.acos(I),a.phi=ei-R,V.value===Gr.AREA_0?a.lam=r+ei:V.value===Gr.AREA_1?a.lam=r<0?r+lo:r-lo:V.value===Gr.AREA_2?a.lam=r-ei:a.lam=r;else if(this.face===Ns.BOTTOM)R=Math.acos(I),a.phi=R-ei,V.value===Gr.AREA_0?a.lam=-r+ei:V.value===Gr.AREA_1?a.lam=-r:V.value===Gr.AREA_2?a.lam=-r-ei:a.lam=r<0?-r-lo:-r+lo;else{var Z,Y,W;Z=I,U=Z*Z,U>=1?W=0:W=Math.sqrt(1-U)*Math.sin(r),U+=W*W,U>=1?Y=0:Y=Math.sqrt(1-U),V.value===Gr.AREA_1?(U=Y,Y=-W,W=U):V.value===Gr.AREA_2?(Y=-Y,W=-W):V.value===Gr.AREA_3&&(U=Y,Y=W,W=-U),this.face===Ns.RIGHT?(U=Z,Z=-Y,Y=U):this.face===Ns.BACK?(Z=-Z,Y=-Y):this.face===Ns.LEFT&&(U=Z,Z=Y,Y=-U),a.phi=Math.acos(-W)-ei,a.lam=Math.atan2(Y,Z),this.face===Ns.RIGHT?a.lam=Dp(a.lam,-ei):this.face===Ns.BACK?a.lam=Dp(a.lam,-lo):this.face===Ns.LEFT&&(a.lam=Dp(a.lam,+ei))}if(this.es!==0){var te,ae,Ie;te=a.phi<0?1:0,ae=Math.tan(a.phi),Ie=this.b/Math.sqrt(ae*ae+this.one_minus_f_squared),a.phi=Math.atan(Math.sqrt(this.a*this.a-Ie*Ie)/(this.one_minus_f*Ie)),te&&(a.phi=-a.phi)}return a.lam+=this.long0,s.x=a.lam,s.y=a.phi,s}function ay(s,a,o,d){var _;return s<wi?(d.value=Gr.AREA_0,_=0):(_=Math.atan2(a,o),Math.abs(_)<=Vr?d.value=Gr.AREA_0:_>Vr&&_<=ei+Vr?(d.value=Gr.AREA_1,_-=ei):_>ei+Vr||_<=-(ei+Vr)?(d.value=Gr.AREA_2,_=_>=0?_-lo:_+lo):(d.value=Gr.AREA_3,_+=ei)),_}function Dp(s,a){var o=s+a;return o<-lo?o+=n_:o>+lo&&(o-=n_),o}var FM=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const NM={init:kM,forward:zM,inverse:BM,names:FM};var Fv=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],Xm=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],fb=.8487,pb=1.3523,mb=Nu/5,UM=1/mb,Mp=18,Iy=function(s,a){return s[0]+a*(s[1]+a*(s[2]+a*s[3]))},VM=function(s,a){return s[1]+a*(2*s[2]+a*3*s[3])};function GM(s,a,o,d){for(var _=a;d;--d){var v=s(_);if(_-=v,Math.abs(v)<o)break}return _}function jM(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function qM(s){var a=Di(s.x-this.long0),o=Math.abs(s.y),d=Math.floor(o*mb);d<0?d=0:d>=Mp&&(d=Mp-1),o=Nu*(o-UM*d);var _={x:Iy(Fv[d],o)*a,y:Iy(Xm[d],o)};return s.y<0&&(_.y=-_.y),_.x=_.x*this.a*fb+this.x0,_.y=_.y*this.a*pb+this.y0,_}function HM(s){var a={x:(s.x-this.x0)/(this.a*fb),y:Math.abs(s.y-this.y0)/(this.a*pb)};if(a.y>=1)a.x/=Fv[Mp][0],a.y=s.y<0?-ei:ei;else{var o=Math.floor(a.y*Mp);for(o<0?o=0:o>=Mp&&(o=Mp-1);;)if(Xm[o][0]>a.y)--o;else if(Xm[o+1][0]<=a.y)++o;else break;var d=Xm[o],_=5*(a.y-d[0])/(Xm[o+1][0]-d[0]);_=GM(function(v){return(Iy(d,v)-a.y)/VM(d,v)},_,wi,100),a.x/=Iy(Fv[o],_),a.y=(5*o+_)*la,s.y<0&&(a.y=-a.y)}return a.x=Di(a.x+this.long0),a}var WM=["Robinson","robin"];const ZM={init:jM,forward:qM,inverse:HM,names:WM};function XM(){this.name="geocent"}function KM(s){var a=eb(s,this.es,this.a);return a}function YM(s){var a=tb(s,this.es,this.a,this.b);return a}var JM=["Geocentric","geocentric","geocent","Geocent"];const QM={init:XM,forward:KM,inverse:YM,names:JM};var Ca={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},jm={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function $M(){if(Object.keys(jm).forEach(function(o){if(typeof this[o]>"u")this[o]=jm[o].def;else{if(jm[o].num&&isNaN(this[o]))throw new Error("Invalid parameter value, must be numeric "+o+" = "+this[o]);jm[o].num&&(this[o]=parseFloat(this[o]))}jm[o].degrees&&(this[o]=this[o]*la)}.bind(this)),Math.abs(Math.abs(this.lat0)-ei)<wi?this.mode=this.lat0<0?Ca.S_POLE:Ca.N_POLE:Math.abs(this.lat0)<wi?this.mode=Ca.EQUIT:(this.mode=Ca.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var s=this.tilt,a=this.azi;this.cg=Math.cos(a),this.sg=Math.sin(a),this.cw=Math.cos(s),this.sw=Math.sin(s)}function eA(s){s.x-=this.long0;var a=Math.sin(s.y),o=Math.cos(s.y),d=Math.cos(s.x),_,v;switch(this.mode){case Ca.OBLIQ:v=this.sinph0*a+this.cosph0*o*d;break;case Ca.EQUIT:v=o*d;break;case Ca.S_POLE:v=-a;break;case Ca.N_POLE:v=a;break}switch(v=this.pn1/(this.p-v),_=v*o*Math.sin(s.x),this.mode){case Ca.OBLIQ:v*=this.cosph0*a-this.sinph0*o*d;break;case Ca.EQUIT:v*=a;break;case Ca.N_POLE:v*=-(o*d);break;case Ca.S_POLE:v*=o*d;break}var E,r;return E=v*this.cg+_*this.sg,r=1/(E*this.sw*this.h1+this.cw),_=(_*this.cg-v*this.sg)*this.cw*r,v=E*r,s.x=_*this.a,s.y=v*this.a,s}function tA(s){s.x/=this.a,s.y/=this.a;var a={x:s.x,y:s.y},o,d,_;_=1/(this.pn1-s.y*this.sw),o=this.pn1*s.x*_,d=this.pn1*s.y*this.cw*_,s.x=o*this.cg+d*this.sg,s.y=d*this.cg-o*this.sg;var v=su(s.x,s.y);if(Math.abs(v)<wi)a.x=0,a.y=s.y;else{var E,r;switch(r=1-v*v*this.pfact,r=(this.p-Math.sqrt(r))/(this.pn1/v+v/this.pn1),E=Math.sqrt(1-r*r),this.mode){case Ca.OBLIQ:a.y=Math.asin(E*this.sinph0+s.y*r*this.cosph0/v),s.y=(E-this.sinph0*Math.sin(a.y))*v,s.x*=r*this.cosph0;break;case Ca.EQUIT:a.y=Math.asin(s.y*r/v),s.y=E*v,s.x*=r;break;case Ca.N_POLE:a.y=Math.asin(E),s.y=-s.y;break;case Ca.S_POLE:a.y=-Math.asin(E);break}a.x=Math.atan2(s.x,s.y)}return s.x=a.x+this.long0,s.y=a.y,s}var iA=["Tilted_Perspective","tpers"];const nA={init:$M,forward:eA,inverse:tA,names:iA};function rA(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var s=1-this.es,a=1/s;this.radius_p=Math.sqrt(s),this.radius_p2=s,this.radius_p_inv2=a,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function sA(s){var a=s.x,o=s.y,d,_,v,E;if(a=a-this.long0,this.shape==="ellipse"){o=Math.atan(this.radius_p2*Math.tan(o));var r=this.radius_p/su(this.radius_p*Math.cos(o),Math.sin(o));if(_=r*Math.cos(a)*Math.cos(o),v=r*Math.sin(a)*Math.cos(o),E=r*Math.sin(o),(this.radius_g-_)*_-v*v-E*E*this.radius_p_inv2<0)return s.x=Number.NaN,s.y=Number.NaN,s;d=this.radius_g-_,this.flip_axis?(s.x=this.radius_g_1*Math.atan(v/su(E,d)),s.y=this.radius_g_1*Math.atan(E/d)):(s.x=this.radius_g_1*Math.atan(v/d),s.y=this.radius_g_1*Math.atan(E/su(v,d)))}else this.shape==="sphere"&&(d=Math.cos(o),_=Math.cos(a)*d,v=Math.sin(a)*d,E=Math.sin(o),d=this.radius_g-_,this.flip_axis?(s.x=this.radius_g_1*Math.atan(v/su(E,d)),s.y=this.radius_g_1*Math.atan(E/d)):(s.x=this.radius_g_1*Math.atan(v/d),s.y=this.radius_g_1*Math.atan(E/su(v,d))));return s.x=s.x*this.a,s.y=s.y*this.a,s}function oA(s){var a=-1,o=0,d=0,_,v,E,r;if(s.x=s.x/this.a,s.y=s.y/this.a,this.shape==="ellipse"){this.flip_axis?(d=Math.tan(s.y/this.radius_g_1),o=Math.tan(s.x/this.radius_g_1)*su(1,d)):(o=Math.tan(s.x/this.radius_g_1),d=Math.tan(s.y/this.radius_g_1)*su(1,o));var I=d/this.radius_p;if(_=o*o+I*I+a*a,v=2*this.radius_g*a,E=v*v-4*_*this.C,E<0)return s.x=Number.NaN,s.y=Number.NaN,s;r=(-v-Math.sqrt(E))/(2*_),a=this.radius_g+r*a,o*=r,d*=r,s.x=Math.atan2(o,a),s.y=Math.atan(d*Math.cos(s.x)/a),s.y=Math.atan(this.radius_p_inv2*Math.tan(s.y))}else if(this.shape==="sphere"){if(this.flip_axis?(d=Math.tan(s.y/this.radius_g_1),o=Math.tan(s.x/this.radius_g_1)*Math.sqrt(1+d*d)):(o=Math.tan(s.x/this.radius_g_1),d=Math.tan(s.y/this.radius_g_1)*Math.sqrt(1+o*o)),_=o*o+d*d+a*a,v=2*this.radius_g*a,E=v*v-4*_*this.C,E<0)return s.x=Number.NaN,s.y=Number.NaN,s;r=(-v-Math.sqrt(E))/(2*_),a=this.radius_g+r*a,o*=r,d*=r,s.x=Math.atan2(o,a),s.y=Math.atan(d*Math.cos(s.x)/a)}return s.x=s.x+this.long0,s}var aA=["Geostationary Satellite View","Geostationary_Satellite","geos"];const lA={init:rA,forward:sA,inverse:oA,names:aA};function cA(s){s.Proj.projections.add(fy),s.Proj.projections.add(py),s.Proj.projections.add(m2),s.Proj.projections.add(I2),s.Proj.projections.add(D2),s.Proj.projections.add(z2),s.Proj.projections.add(G2),s.Proj.projections.add(Z2),s.Proj.projections.add(Q2),s.Proj.projections.add(nI),s.Proj.projections.add(xI),s.Proj.projections.add(MI),s.Proj.projections.add(DI),s.Proj.projections.add(BI),s.Proj.projections.add(GI),s.Proj.projections.add(ZI),s.Proj.projections.add(QI),s.Proj.projections.add(nM),s.Proj.projections.add(cM),s.Proj.projections.add(pM),s.Proj.projections.add(vM),s.Proj.projections.add(TM),s.Proj.projections.add(CM),s.Proj.projections.add(RM),s.Proj.projections.add(NM),s.Proj.projections.add(ZM),s.Proj.projections.add(QM),s.Proj.projections.add(nA),s.Proj.projections.add(lA)}tc.defaultDatum="WGS84";tc.Proj=Uu;tc.WGS84=new tc.Proj("WGS84");tc.Point=Op;tc.toPoint=ib;tc.defs=$a;tc.nadgrid=gT;tc.transform=Ey;tc.mgrs=OT;tc.version="__VERSION__";cA(tc);function uA(s){const a=Ch.groupBy(s,_=>_.name.split(".")[0]),d=Ch.flatMap(a,_=>{const v=_.find(r=>r.name.endsWith(".shp")),E=_.find(r=>r.name.endsWith(".json"));if(v){const r=_.find(R=>R.name.endsWith(".dbf")),I=_.find(R=>R.name.endsWith(".prj"));return fA(v,r,I)}else if(E)return _.map(dA)}).filter(_=>_!==void 0);return Promise.all(d)}async function hA(s){const o=await(await fetch(`https://epsg.io/${s}.proj4js`)).text(),d=/"([^"]+)"/g,_=o.match(d);if(_&&_.length>1)return _[1].replace(/"/g,"").trim();console.error("Failed to extract Proj4 string.")}function dA(s){if(s.type!=="application/json"){console.error("Not a json file!");return}return new Promise((a,o)=>{const d=new FileReader;d.onload=_=>{if(_.target&&_.target.result){const v=_.target.result,E=JSON.parse(v);kx(E)&&Ch.groupBy(E.features,r=>r.geometry.type),a({id:s.name.replace(".json",""),geojson:{type:"geojson",data:E}})}o("Could not parse geoJSON file")},d.readAsText(s)})}async function fA(s,a,o){const d=await s.arrayBuffer(),_=await DE(d),v=a&&await mA(a);if(v&&_.features.length===v.length)Ch.zip(_.features,v).forEach(([r,I])=>{Ch.merge(r,{properties:I})});else throw new Error(`Mismatch of features and properties (${_.features.length} vs. ${v==null?void 0:v.length})`);const E=o&&await pA(o);return E&&_.features.forEach(r=>{r.geometry=zx(r.geometry,E)}),{id:s.name.split(".")[0],geojson:{type:"geojson",data:_}}}async function pA(s){return new Promise((a,o)=>{const d=new FileReader;d.onload=async _=>{var v;try{const E=(v=_.target)==null?void 0:v.result,r=E==null?void 0:E.toString().trim(),I=await hA("4326"),R=tc(r,I);a(R)}catch(E){o(E)}},d.readAsText(s)})}async function mA(s){const a=await s.arrayBuffer(),o=await LE(a);async function d(_=[]){const v=await o.read();return v.done?_:await d([..._,v.value])}return await d()}/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var _A={LABEL_FLOAT_ABOVE:"mdc-floating-label--float-above",LABEL_REQUIRED:"mdc-floating-label--required",LABEL_SHAKE:"mdc-floating-label--shake",ROOT:"mdc-floating-label"};/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var gA=function(s){au(a,s);function a(o){var d=s.call(this,_s(_s({},a.defaultAdapter),o))||this;return d.shakeAnimationEndHandler=function(){d.handleShakeAnimationEnd()},d}return Object.defineProperty(a,"cssClasses",{get:function(){return _A},enumerable:!1,configurable:!0}),Object.defineProperty(a,"defaultAdapter",{get:function(){return{addClass:function(){},removeClass:function(){},getWidth:function(){return 0},registerInteractionHandler:function(){},deregisterInteractionHandler:function(){}}},enumerable:!1,configurable:!0}),a.prototype.init=function(){this.adapter.registerInteractionHandler("animationend",this.shakeAnimationEndHandler)},a.prototype.destroy=function(){this.adapter.deregisterInteractionHandler("animationend",this.shakeAnimationEndHandler)},a.prototype.getWidth=function(){return this.adapter.getWidth()},a.prototype.shake=function(o){var d=a.cssClasses.LABEL_SHAKE;o?this.adapter.addClass(d):this.adapter.removeClass(d)},a.prototype.float=function(o){var d=a.cssClasses,_=d.LABEL_FLOAT_ABOVE,v=d.LABEL_SHAKE;o?this.adapter.addClass(_):(this.adapter.removeClass(_),this.adapter.removeClass(v))},a.prototype.setRequired=function(o){var d=a.cssClasses.LABEL_REQUIRED;o?this.adapter.addClass(d):this.adapter.removeClass(d)},a.prototype.handleShakeAnimationEnd=function(){var o=a.cssClasses.LABEL_SHAKE;this.adapter.removeClass(o)},a}(lu);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var tf={LINE_RIPPLE_ACTIVE:"mdc-line-ripple--active",LINE_RIPPLE_DEACTIVATING:"mdc-line-ripple--deactivating"};/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var yA=function(s){au(a,s);function a(o){var d=s.call(this,_s(_s({},a.defaultAdapter),o))||this;return d.transitionEndHandler=function(_){d.handleTransitionEnd(_)},d}return Object.defineProperty(a,"cssClasses",{get:function(){return tf},enumerable:!1,configurable:!0}),Object.defineProperty(a,"defaultAdapter",{get:function(){return{addClass:function(){},removeClass:function(){},hasClass:function(){return!1},setStyle:function(){},registerEventHandler:function(){},deregisterEventHandler:function(){}}},enumerable:!1,configurable:!0}),a.prototype.init=function(){this.adapter.registerEventHandler("transitionend",this.transitionEndHandler)},a.prototype.destroy=function(){this.adapter.deregisterEventHandler("transitionend",this.transitionEndHandler)},a.prototype.activate=function(){this.adapter.removeClass(tf.LINE_RIPPLE_DEACTIVATING),this.adapter.addClass(tf.LINE_RIPPLE_ACTIVE)},a.prototype.setRippleCenter=function(o){this.adapter.setStyle("transform-origin",o+"px center")},a.prototype.deactivate=function(){this.adapter.addClass(tf.LINE_RIPPLE_DEACTIVATING)},a.prototype.handleTransitionEnd=function(o){var d=this.adapter.hasClass(tf.LINE_RIPPLE_DEACTIVATING);o.propertyName==="opacity"&&d&&(this.adapter.removeClass(tf.LINE_RIPPLE_ACTIVE),this.adapter.removeClass(tf.LINE_RIPPLE_DEACTIVATING))},a}(lu);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var vA={ANCHOR:"mdc-menu-surface--anchor",ANIMATING_CLOSED:"mdc-menu-surface--animating-closed",ANIMATING_OPEN:"mdc-menu-surface--animating-open",FIXED:"mdc-menu-surface--fixed",IS_OPEN_BELOW:"mdc-menu-surface--is-open-below",OPEN:"mdc-menu-surface--open",ROOT:"mdc-menu-surface"},xA={CLOSED_EVENT:"MDCMenuSurface:closed",CLOSING_EVENT:"MDCMenuSurface:closing",OPENED_EVENT:"MDCMenuSurface:opened",OPENING_EVENT:"MDCMenuSurface:opening",FOCUSABLE_ELEMENTS:["button:not(:disabled)",'[href]:not([aria-disabled="true"])',"input:not(:disabled)","select:not(:disabled)","textarea:not(:disabled)",'[tabindex]:not([tabindex="-1"]):not([aria-disabled="true"])'].join(", ")},qm={TRANSITION_OPEN_DURATION:120,TRANSITION_CLOSE_DURATION:75,MARGIN_TO_EDGE:32,ANCHOR_TO_MENU_SURFACE_WIDTH_RATIO:.67,TOUCH_EVENT_WAIT_MS:30},oo;(function(s){s[s.BOTTOM=1]="BOTTOM",s[s.CENTER=2]="CENTER",s[s.RIGHT=4]="RIGHT",s[s.FLIP_RTL=8]="FLIP_RTL"})(oo||(oo={}));var of;(function(s){s[s.TOP_LEFT=0]="TOP_LEFT",s[s.TOP_RIGHT=4]="TOP_RIGHT",s[s.BOTTOM_LEFT=1]="BOTTOM_LEFT",s[s.BOTTOM_RIGHT=5]="BOTTOM_RIGHT",s[s.TOP_START=8]="TOP_START",s[s.TOP_END=12]="TOP_END",s[s.BOTTOM_START=9]="BOTTOM_START",s[s.BOTTOM_END=13]="BOTTOM_END"})(of||(of={}));/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var sd,Mh,ur={LIST_ITEM_ACTIVATED_CLASS:"mdc-list-item--activated",LIST_ITEM_CLASS:"mdc-list-item",LIST_ITEM_DISABLED_CLASS:"mdc-list-item--disabled",LIST_ITEM_SELECTED_CLASS:"mdc-list-item--selected",LIST_ITEM_TEXT_CLASS:"mdc-list-item__text",LIST_ITEM_PRIMARY_TEXT_CLASS:"mdc-list-item__primary-text",ROOT:"mdc-list"};sd={},sd[""+ur.LIST_ITEM_ACTIVATED_CLASS]="mdc-list-item--activated",sd[""+ur.LIST_ITEM_CLASS]="mdc-list-item",sd[""+ur.LIST_ITEM_DISABLED_CLASS]="mdc-list-item--disabled",sd[""+ur.LIST_ITEM_SELECTED_CLASS]="mdc-list-item--selected",sd[""+ur.LIST_ITEM_PRIMARY_TEXT_CLASS]="mdc-list-item__primary-text",sd[""+ur.ROOT]="mdc-list";var xp=(Mh={},Mh[""+ur.LIST_ITEM_ACTIVATED_CLASS]="mdc-deprecated-list-item--activated",Mh[""+ur.LIST_ITEM_CLASS]="mdc-deprecated-list-item",Mh[""+ur.LIST_ITEM_DISABLED_CLASS]="mdc-deprecated-list-item--disabled",Mh[""+ur.LIST_ITEM_SELECTED_CLASS]="mdc-deprecated-list-item--selected",Mh[""+ur.LIST_ITEM_TEXT_CLASS]="mdc-deprecated-list-item__text",Mh[""+ur.LIST_ITEM_PRIMARY_TEXT_CLASS]="mdc-deprecated-list-item__primary-text",Mh[""+ur.ROOT]="mdc-deprecated-list",Mh),od={ACTION_EVENT:"MDCList:action",SELECTION_CHANGE_EVENT:"MDCList:selectionChange",ARIA_CHECKED:"aria-checked",ARIA_CHECKED_CHECKBOX_SELECTOR:'[role="checkbox"][aria-checked="true"]',ARIA_CHECKED_RADIO_SELECTOR:'[role="radio"][aria-checked="true"]',ARIA_CURRENT:"aria-current",ARIA_DISABLED:"aria-disabled",ARIA_ORIENTATION:"aria-orientation",ARIA_ORIENTATION_HORIZONTAL:"horizontal",ARIA_ROLE_CHECKBOX_SELECTOR:'[role="checkbox"]',ARIA_SELECTED:"aria-selected",ARIA_INTERACTIVE_ROLES_SELECTOR:'[role="listbox"], [role="menu"]',ARIA_MULTI_SELECTABLE_SELECTOR:'[aria-multiselectable="true"]',CHECKBOX_RADIO_SELECTOR:'input[type="checkbox"], input[type="radio"]',CHECKBOX_SELECTOR:'input[type="checkbox"]',CHILD_ELEMENTS_TO_TOGGLE_TABINDEX:`
    .`+ur.LIST_ITEM_CLASS+` button:not(:disabled),
    .`+ur.LIST_ITEM_CLASS+` a,
    .`+xp[ur.LIST_ITEM_CLASS]+` button:not(:disabled),
    .`+xp[ur.LIST_ITEM_CLASS]+` a
  `,DEPRECATED_SELECTOR:".mdc-deprecated-list",FOCUSABLE_CHILD_ELEMENTS:`
    .`+ur.LIST_ITEM_CLASS+` button:not(:disabled),
    .`+ur.LIST_ITEM_CLASS+` a,
    .`+ur.LIST_ITEM_CLASS+` input[type="radio"]:not(:disabled),
    .`+ur.LIST_ITEM_CLASS+` input[type="checkbox"]:not(:disabled),
    .`+xp[ur.LIST_ITEM_CLASS]+` button:not(:disabled),
    .`+xp[ur.LIST_ITEM_CLASS]+` a,
    .`+xp[ur.LIST_ITEM_CLASS]+` input[type="radio"]:not(:disabled),
    .`+xp[ur.LIST_ITEM_CLASS]+` input[type="checkbox"]:not(:disabled)
  `,RADIO_SELECTOR:'input[type="radio"]',SELECTED_ITEM_SELECTOR:'[aria-selected="true"], [aria-current="true"]'},so={UNSET_INDEX:-1,TYPEAHEAD_BUFFER_CLEAR_TIMEOUT_MS:300};/**
 * @license
 * Copyright 2020 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var bA=["input","button","textarea","select"],Oc=function(s){var a=s.target;if(a){var o=(""+a.tagName).toLowerCase();bA.indexOf(o)===-1&&s.preventDefault()}};/**
 * @license
 * Copyright 2020 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */function wA(){var s={bufferClearTimeout:0,currentFirstChar:"",sortedIndexCursor:0,typeaheadBuffer:""};return s}function EA(s,a){for(var o=new Map,d=0;d<s;d++){var _=a(d).trim();if(_){var v=_[0].toLowerCase();o.has(v)||o.set(v,[]),o.get(v).push({text:_.toLowerCase(),index:d})}}return o.forEach(function(E){E.sort(function(r,I){return r.index-I.index})}),o}function Nv(s,a){var o=s.nextChar,d=s.focusItemAtIndex,_=s.sortedIndexByFirstChar,v=s.focusedItemIndex,E=s.skipFocus,r=s.isItemAtIndexDisabled;clearTimeout(a.bufferClearTimeout),a.bufferClearTimeout=setTimeout(function(){gb(a)},so.TYPEAHEAD_BUFFER_CLEAR_TIMEOUT_MS),a.typeaheadBuffer=a.typeaheadBuffer+o;var I;return a.typeaheadBuffer.length===1?I=TA(_,v,r,a):I=IA(_,r,a),I!==-1&&!E&&d(I),I}function TA(s,a,o,d){var _=d.typeaheadBuffer[0],v=s.get(_);if(!v)return-1;if(_===d.currentFirstChar&&v[d.sortedIndexCursor].index===a){d.sortedIndexCursor=(d.sortedIndexCursor+1)%v.length;var E=v[d.sortedIndexCursor].index;if(!o(E))return E}d.currentFirstChar=_;var r=-1,I;for(I=0;I<v.length;I++)if(!o(v[I].index)){r=I;break}for(;I<v.length;I++)if(v[I].index>a&&!o(v[I].index)){r=I;break}return r!==-1?(d.sortedIndexCursor=r,v[d.sortedIndexCursor].index):-1}function IA(s,a,o){var d=o.typeaheadBuffer[0],_=s.get(d);if(!_)return-1;var v=_[o.sortedIndexCursor];if(v.text.lastIndexOf(o.typeaheadBuffer,0)===0&&!a(v.index))return v.index;for(var E=(o.sortedIndexCursor+1)%_.length,r=-1;E!==o.sortedIndexCursor;){var I=_[E],R=I.text.lastIndexOf(o.typeaheadBuffer,0)===0,U=!a(I.index);if(R&&U){r=E;break}E=(E+1)%_.length}return r!==-1?(o.sortedIndexCursor=r,_[o.sortedIndexCursor].index):-1}function _b(s){return s.typeaheadBuffer.length>0}function gb(s){s.typeaheadBuffer=""}function ex(s,a){var o=s.event,d=s.isTargetListItem,_=s.focusedItemIndex,v=s.focusItemAtIndex,E=s.sortedIndexByFirstChar,r=s.isItemAtIndexDisabled,I=ao(o)==="ArrowLeft",R=ao(o)==="ArrowUp",U=ao(o)==="ArrowRight",V=ao(o)==="ArrowDown",Z=ao(o)==="Home",Y=ao(o)==="End",W=ao(o)==="Enter",te=ao(o)==="Spacebar";if(o.altKey||o.ctrlKey||o.metaKey||I||R||U||V||Z||Y||W)return-1;var ae=!te&&o.key.length===1;if(ae){Oc(o);var Ie={focusItemAtIndex:v,focusedItemIndex:_,nextChar:o.key.toLowerCase(),sortedIndexByFirstChar:E,skipFocus:!1,isItemAtIndexDisabled:r};return Nv(Ie,a)}if(!te)return-1;d&&Oc(o);var ye=d&&_b(a);if(ye){var Ie={focusItemAtIndex:v,focusedItemIndex:_,nextChar:" ",sortedIndexByFirstChar:E,skipFocus:!1,isItemAtIndexDisabled:r};return Nv(Ie,a)}return-1}/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */function MA(s){return s instanceof Array}var AA=["Alt","Control","Meta","Shift"];function tx(s){var a=new Set(s?AA.filter(function(o){return s.getModifierState(o)}):[]);return function(o){return o.every(function(d){return a.has(d)})&&o.length===a.size}}var SA=function(s){au(a,s);function a(o){var d=s.call(this,_s(_s({},a.defaultAdapter),o))||this;return d.wrapFocus=!1,d.isVertical=!0,d.isSingleSelectionList=!1,d.areDisabledItemsFocusable=!0,d.selectedIndex=so.UNSET_INDEX,d.focusedItemIndex=so.UNSET_INDEX,d.useActivatedClass=!1,d.useSelectedAttr=!1,d.ariaCurrentAttrValue=null,d.isCheckboxList=!1,d.isRadioList=!1,d.lastSelectedIndex=null,d.hasTypeahead=!1,d.typeaheadState=wA(),d.sortedIndexByFirstChar=new Map,d}return Object.defineProperty(a,"strings",{get:function(){return od},enumerable:!1,configurable:!0}),Object.defineProperty(a,"cssClasses",{get:function(){return ur},enumerable:!1,configurable:!0}),Object.defineProperty(a,"numbers",{get:function(){return so},enumerable:!1,configurable:!0}),Object.defineProperty(a,"defaultAdapter",{get:function(){return{addClassForElementIndex:function(){},focusItemAtIndex:function(){},getAttributeForElementIndex:function(){return null},getFocusedElementIndex:function(){return 0},getListItemCount:function(){return 0},hasCheckboxAtIndex:function(){return!1},hasRadioAtIndex:function(){return!1},isCheckboxCheckedAtIndex:function(){return!1},isFocusInsideList:function(){return!1},isRootFocused:function(){return!1},listItemAtIndexHasClass:function(){return!1},notifyAction:function(){},notifySelectionChange:function(){},removeClassForElementIndex:function(){},setAttributeForElementIndex:function(){},setCheckedCheckboxOrRadioAtIndex:function(){},setTabIndexForListItemChildren:function(){},getPrimaryTextAtIndex:function(){return""}}},enumerable:!1,configurable:!0}),a.prototype.layout=function(){this.adapter.getListItemCount()!==0&&(this.adapter.hasCheckboxAtIndex(0)?this.isCheckboxList=!0:this.adapter.hasRadioAtIndex(0)?this.isRadioList=!0:this.maybeInitializeSingleSelection(),this.hasTypeahead&&(this.sortedIndexByFirstChar=this.typeaheadInitSortedIndex()))},a.prototype.getFocusedItemIndex=function(){return this.focusedItemIndex},a.prototype.setWrapFocus=function(o){this.wrapFocus=o},a.prototype.setVerticalOrientation=function(o){this.isVertical=o},a.prototype.setSingleSelection=function(o){this.isSingleSelectionList=o,o&&(this.maybeInitializeSingleSelection(),this.selectedIndex=this.getSelectedIndexFromDOM())},a.prototype.setDisabledItemsFocusable=function(o){this.areDisabledItemsFocusable=o},a.prototype.maybeInitializeSingleSelection=function(){var o=this.getSelectedIndexFromDOM();if(o!==so.UNSET_INDEX){var d=this.adapter.listItemAtIndexHasClass(o,ur.LIST_ITEM_ACTIVATED_CLASS);d&&this.setUseActivatedClass(!0),this.isSingleSelectionList=!0,this.selectedIndex=o}},a.prototype.getSelectedIndexFromDOM=function(){for(var o=so.UNSET_INDEX,d=this.adapter.getListItemCount(),_=0;_<d;_++){var v=this.adapter.listItemAtIndexHasClass(_,ur.LIST_ITEM_SELECTED_CLASS),E=this.adapter.listItemAtIndexHasClass(_,ur.LIST_ITEM_ACTIVATED_CLASS);if(v||E){o=_;break}}return o},a.prototype.setHasTypeahead=function(o){this.hasTypeahead=o,o&&(this.sortedIndexByFirstChar=this.typeaheadInitSortedIndex())},a.prototype.isTypeaheadInProgress=function(){return this.hasTypeahead&&_b(this.typeaheadState)},a.prototype.setUseActivatedClass=function(o){this.useActivatedClass=o},a.prototype.setUseSelectedAttribute=function(o){this.useSelectedAttr=o},a.prototype.getSelectedIndex=function(){return this.selectedIndex},a.prototype.setSelectedIndex=function(o,d){d===void 0&&(d={}),this.isIndexValid(o)&&(this.isCheckboxList?this.setCheckboxAtIndex(o,d):this.isRadioList?this.setRadioAtIndex(o,d):this.setSingleSelectionAtIndex(o,d))},a.prototype.handleFocusIn=function(o){o>=0&&(this.focusedItemIndex=o,this.adapter.setAttributeForElementIndex(o,"tabindex","0"),this.adapter.setTabIndexForListItemChildren(o,"0"))},a.prototype.handleFocusOut=function(o){var d=this;o>=0&&(this.adapter.setAttributeForElementIndex(o,"tabindex","-1"),this.adapter.setTabIndexForListItemChildren(o,"-1")),setTimeout(function(){d.adapter.isFocusInsideList()||d.setTabindexToFirstSelectedOrFocusedItem()},0)},a.prototype.isIndexDisabled=function(o){return this.adapter.listItemAtIndexHasClass(o,ur.LIST_ITEM_DISABLED_CLASS)},a.prototype.handleKeydown=function(o,d,_){var v=this,E,r=ao(o)==="ArrowLeft",I=ao(o)==="ArrowUp",R=ao(o)==="ArrowRight",U=ao(o)==="ArrowDown",V=ao(o)==="Home",Z=ao(o)==="End",Y=ao(o)==="Enter",W=ao(o)==="Spacebar",te=this.isVertical&&U||!this.isVertical&&R,ae=this.isVertical&&I||!this.isVertical&&r,Ie=o.key==="A"||o.key==="a",ye=tx(o);if(this.adapter.isRootFocused()){if((ae||Z)&&ye([]))o.preventDefault(),this.focusLastElement();else if((te||V)&&ye([]))o.preventDefault(),this.focusFirstElement();else if(ae&&ye(["Shift"])&&this.isCheckboxList){o.preventDefault();var Ue=this.focusLastElement();Ue!==-1&&this.setSelectedIndexOnAction(Ue,!1)}else if(te&&ye(["Shift"])&&this.isCheckboxList){o.preventDefault();var Ue=this.focusFirstElement();Ue!==-1&&this.setSelectedIndexOnAction(Ue,!1)}if(this.hasTypeahead){var je={event:o,focusItemAtIndex:function(lt){v.focusItemAtIndex(lt)},focusedItemIndex:-1,isTargetListItem:d,sortedIndexByFirstChar:this.sortedIndexByFirstChar,isItemAtIndexDisabled:function(lt){return v.isIndexDisabled(lt)}};ex(je,this.typeaheadState)}return}var _e=this.adapter.getFocusedElementIndex();if(!(_e===-1&&(_e=_,_e<0))){if(te&&ye([]))Oc(o),this.focusNextElement(_e);else if(ae&&ye([]))Oc(o),this.focusPrevElement(_e);else if(te&&ye(["Shift"])&&this.isCheckboxList){Oc(o);var Ue=this.focusNextElement(_e);Ue!==-1&&this.setSelectedIndexOnAction(Ue,!1)}else if(ae&&ye(["Shift"])&&this.isCheckboxList){Oc(o);var Ue=this.focusPrevElement(_e);Ue!==-1&&this.setSelectedIndexOnAction(Ue,!1)}else if(V&&ye([]))Oc(o),this.focusFirstElement();else if(Z&&ye([]))Oc(o),this.focusLastElement();else if(V&&ye(["Control","Shift"])&&this.isCheckboxList){if(Oc(o),this.isIndexDisabled(_e))return;this.focusFirstElement(),this.toggleCheckboxRange(0,_e,_e)}else if(Z&&ye(["Control","Shift"])&&this.isCheckboxList){if(Oc(o),this.isIndexDisabled(_e))return;this.focusLastElement(),this.toggleCheckboxRange(_e,this.adapter.getListItemCount()-1,_e)}else if(Ie&&ye(["Control"])&&this.isCheckboxList)o.preventDefault(),this.checkboxListToggleAll(this.selectedIndex===so.UNSET_INDEX?[]:this.selectedIndex,!0);else if((Y||W)&&ye([])){if(d){var ct=o.target;if(ct&&ct.tagName==="A"&&Y||(Oc(o),this.isIndexDisabled(_e)))return;this.isTypeaheadInProgress()||(this.isSelectableList()&&this.setSelectedIndexOnAction(_e,!1),this.adapter.notifyAction(_e))}}else if((Y||W)&&ye(["Shift"])&&this.isCheckboxList){var ct=o.target;if(ct&&ct.tagName==="A"&&Y||(Oc(o),this.isIndexDisabled(_e)))return;this.isTypeaheadInProgress()||(this.toggleCheckboxRange((E=this.lastSelectedIndex)!==null&&E!==void 0?E:_e,_e,_e),this.adapter.notifyAction(_e))}if(this.hasTypeahead){var je={event:o,focusItemAtIndex:function(St){v.focusItemAtIndex(St)},focusedItemIndex:this.focusedItemIndex,isTargetListItem:d,sortedIndexByFirstChar:this.sortedIndexByFirstChar,isItemAtIndexDisabled:function(St){return v.isIndexDisabled(St)}};ex(je,this.typeaheadState)}}},a.prototype.handleClick=function(o,d,_){var v,E=tx(_);o!==so.UNSET_INDEX&&(this.isIndexDisabled(o)||(E([])?(this.isSelectableList()&&this.setSelectedIndexOnAction(o,d),this.adapter.notifyAction(o)):this.isCheckboxList&&E(["Shift"])&&(this.toggleCheckboxRange((v=this.lastSelectedIndex)!==null&&v!==void 0?v:o,o,o),this.adapter.notifyAction(o))))},a.prototype.focusNextElement=function(o){var d=this.adapter.getListItemCount(),_=o,v=null;do{if(_++,_>=d)if(this.wrapFocus)_=0;else return o;if(_===v)return-1;v=v??_}while(!this.areDisabledItemsFocusable&&this.isIndexDisabled(_));return this.focusItemAtIndex(_),_},a.prototype.focusPrevElement=function(o){var d=this.adapter.getListItemCount(),_=o,v=null;do{if(_--,_<0)if(this.wrapFocus)_=d-1;else return o;if(_===v)return-1;v=v??_}while(!this.areDisabledItemsFocusable&&this.isIndexDisabled(_));return this.focusItemAtIndex(_),_},a.prototype.focusFirstElement=function(){return this.focusNextElement(-1)},a.prototype.focusLastElement=function(){return this.focusPrevElement(this.adapter.getListItemCount())},a.prototype.focusInitialElement=function(){var o=this.getFirstSelectedOrFocusedItemIndex();return this.focusItemAtIndex(o),o},a.prototype.setEnabled=function(o,d){this.isIndexValid(o,!1)&&(d?(this.adapter.removeClassForElementIndex(o,ur.LIST_ITEM_DISABLED_CLASS),this.adapter.setAttributeForElementIndex(o,od.ARIA_DISABLED,"false")):(this.adapter.addClassForElementIndex(o,ur.LIST_ITEM_DISABLED_CLASS),this.adapter.setAttributeForElementIndex(o,od.ARIA_DISABLED,"true")))},a.prototype.setSingleSelectionAtIndex=function(o,d){if(d===void 0&&(d={}),!(this.selectedIndex===o&&!d.forceUpdate)){var _=ur.LIST_ITEM_SELECTED_CLASS;this.useActivatedClass&&(_=ur.LIST_ITEM_ACTIVATED_CLASS),this.selectedIndex!==so.UNSET_INDEX&&this.adapter.removeClassForElementIndex(this.selectedIndex,_),this.setAriaForSingleSelectionAtIndex(o),this.setTabindexAtIndex(o),o!==so.UNSET_INDEX&&this.adapter.addClassForElementIndex(o,_),this.selectedIndex=o,d.isUserInteraction&&!d.forceUpdate&&this.adapter.notifySelectionChange([o])}},a.prototype.setAriaForSingleSelectionAtIndex=function(o){this.selectedIndex===so.UNSET_INDEX&&(this.ariaCurrentAttrValue=this.adapter.getAttributeForElementIndex(o,od.ARIA_CURRENT));var d=this.ariaCurrentAttrValue!==null,_=d?od.ARIA_CURRENT:od.ARIA_SELECTED;if(this.selectedIndex!==so.UNSET_INDEX&&this.adapter.setAttributeForElementIndex(this.selectedIndex,_,"false"),o!==so.UNSET_INDEX){var v=d?this.ariaCurrentAttrValue:"true";this.adapter.setAttributeForElementIndex(o,_,v)}},a.prototype.getSelectionAttribute=function(){return this.useSelectedAttr?od.ARIA_SELECTED:od.ARIA_CHECKED},a.prototype.setRadioAtIndex=function(o,d){d===void 0&&(d={});var _=this.getSelectionAttribute();this.adapter.setCheckedCheckboxOrRadioAtIndex(o,!0),!(this.selectedIndex===o&&!d.forceUpdate)&&(this.selectedIndex!==so.UNSET_INDEX&&this.adapter.setAttributeForElementIndex(this.selectedIndex,_,"false"),this.adapter.setAttributeForElementIndex(o,_,"true"),this.selectedIndex=o,d.isUserInteraction&&!d.forceUpdate&&this.adapter.notifySelectionChange([o]))},a.prototype.setCheckboxAtIndex=function(o,d){d===void 0&&(d={});for(var _=this.selectedIndex,v=d.isUserInteraction?new Set(_===so.UNSET_INDEX?[]:_):null,E=this.getSelectionAttribute(),r=[],I=0;I<this.adapter.getListItemCount();I++){var R=v==null?void 0:v.has(I),U=o.indexOf(I)>=0;U!==R&&r.push(I),this.adapter.setCheckedCheckboxOrRadioAtIndex(I,U),this.adapter.setAttributeForElementIndex(I,E,U?"true":"false")}this.selectedIndex=o,d.isUserInteraction&&r.length&&this.adapter.notifySelectionChange(r)},a.prototype.toggleCheckboxRange=function(o,d,_){this.lastSelectedIndex=_;for(var v=new Set(this.selectedIndex===so.UNSET_INDEX?[]:this.selectedIndex),E=!(v!=null&&v.has(_)),r=m1([o,d].sort(),2),I=r[0],R=r[1],U=this.getSelectionAttribute(),V=[],Z=I;Z<=R;Z++)if(!this.isIndexDisabled(Z)){var Y=v.has(Z);E!==Y&&(V.push(Z),this.adapter.setCheckedCheckboxOrRadioAtIndex(Z,E),this.adapter.setAttributeForElementIndex(Z,U,""+E),E?v.add(Z):v.delete(Z))}V.length&&(this.selectedIndex=Yb([],m1(v)),this.adapter.notifySelectionChange(V))},a.prototype.setTabindexAtIndex=function(o){this.focusedItemIndex===so.UNSET_INDEX&&o!==0?this.adapter.setAttributeForElementIndex(0,"tabindex","-1"):this.focusedItemIndex>=0&&this.focusedItemIndex!==o&&this.adapter.setAttributeForElementIndex(this.focusedItemIndex,"tabindex","-1"),!(this.selectedIndex instanceof Array)&&this.selectedIndex!==o&&this.adapter.setAttributeForElementIndex(this.selectedIndex,"tabindex","-1"),o!==so.UNSET_INDEX&&this.adapter.setAttributeForElementIndex(o,"tabindex","0")},a.prototype.isSelectableList=function(){return this.isSingleSelectionList||this.isCheckboxList||this.isRadioList},a.prototype.setTabindexToFirstSelectedOrFocusedItem=function(){var o=this.getFirstSelectedOrFocusedItemIndex();this.setTabindexAtIndex(o)},a.prototype.getFirstSelectedOrFocusedItemIndex=function(){return this.isSelectableList()?typeof this.selectedIndex=="number"&&this.selectedIndex!==so.UNSET_INDEX?this.selectedIndex:MA(this.selectedIndex)&&this.selectedIndex.length>0?this.selectedIndex.reduce(function(o,d){return Math.min(o,d)}):0:Math.max(this.focusedItemIndex,0)},a.prototype.isIndexValid=function(o,d){var _=this;if(d===void 0&&(d=!0),o instanceof Array){if(!this.isCheckboxList&&d)throw new Error("MDCListFoundation: Array of index is only supported for checkbox based list");return o.length===0?!0:o.some(function(v){return _.isIndexInRange(v)})}else if(typeof o=="number"){if(this.isCheckboxList&&d)throw new Error("MDCListFoundation: Expected array of index for checkbox based list but got number: "+o);return this.isIndexInRange(o)||this.isSingleSelectionList&&o===so.UNSET_INDEX}else return!1},a.prototype.isIndexInRange=function(o){var d=this.adapter.getListItemCount();return o>=0&&o<d},a.prototype.setSelectedIndexOnAction=function(o,d){this.lastSelectedIndex=o,this.isCheckboxList?(this.toggleCheckboxAtIndex(o,d),this.adapter.notifySelectionChange([o])):this.setSelectedIndex(o,{isUserInteraction:!0})},a.prototype.toggleCheckboxAtIndex=function(o,d){var _=this.getSelectionAttribute(),v=this.adapter.isCheckboxCheckedAtIndex(o),E;d?E=v:(E=!v,this.adapter.setCheckedCheckboxOrRadioAtIndex(o,E)),this.adapter.setAttributeForElementIndex(o,_,E?"true":"false");var r=this.selectedIndex===so.UNSET_INDEX?[]:this.selectedIndex.slice();E?r.push(o):r=r.filter(function(I){return I!==o}),this.selectedIndex=r},a.prototype.focusItemAtIndex=function(o){this.adapter.focusItemAtIndex(o),this.focusedItemIndex=o},a.prototype.checkboxListToggleAll=function(o,d){var _=this.adapter.getListItemCount();if(o.length===_)this.setCheckboxAtIndex([],{isUserInteraction:d});else{for(var v=[],E=0;E<_;E++)(!this.isIndexDisabled(E)||o.indexOf(E)>-1)&&v.push(E);this.setCheckboxAtIndex(v,{isUserInteraction:d})}},a.prototype.typeaheadMatchItem=function(o,d,_){var v=this;_===void 0&&(_=!1);var E={focusItemAtIndex:function(r){v.focusItemAtIndex(r)},focusedItemIndex:d||this.focusedItemIndex,nextChar:o,sortedIndexByFirstChar:this.sortedIndexByFirstChar,skipFocus:_,isItemAtIndexDisabled:function(r){return v.isIndexDisabled(r)}};return Nv(E,this.typeaheadState)},a.prototype.typeaheadInitSortedIndex=function(){return EA(this.adapter.getListItemCount(),this.adapter.getPrimaryTextAtIndex)},a.prototype.clearTypeaheadBuffer=function(){gb(this.typeaheadState)},a}(lu);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var yb=function(s){au(a,s);function a(o){var d=s.call(this,_s(_s({},a.defaultAdapter),o))||this;return d.isSurfaceOpen=!1,d.isQuickOpen=!1,d.isHoistedElement=!1,d.isFixedPosition=!1,d.isHorizontallyCenteredOnViewport=!1,d.maxHeight=0,d.openBottomBias=0,d.openAnimationEndTimerId=0,d.closeAnimationEndTimerId=0,d.animationRequestId=0,d.anchorCorner=of.TOP_START,d.originCorner=of.TOP_START,d.anchorMargin={top:0,right:0,bottom:0,left:0},d.position={x:0,y:0},d}return Object.defineProperty(a,"cssClasses",{get:function(){return vA},enumerable:!1,configurable:!0}),Object.defineProperty(a,"strings",{get:function(){return xA},enumerable:!1,configurable:!0}),Object.defineProperty(a,"numbers",{get:function(){return qm},enumerable:!1,configurable:!0}),Object.defineProperty(a,"Corner",{get:function(){return of},enumerable:!1,configurable:!0}),Object.defineProperty(a,"defaultAdapter",{get:function(){return{addClass:function(){},removeClass:function(){},hasClass:function(){return!1},hasAnchor:function(){return!1},isElementInContainer:function(){return!1},isFocused:function(){return!1},isRtl:function(){return!1},getInnerDimensions:function(){return{height:0,width:0}},getAnchorDimensions:function(){return null},getWindowDimensions:function(){return{height:0,width:0}},getBodyDimensions:function(){return{height:0,width:0}},getWindowScroll:function(){return{x:0,y:0}},setPosition:function(){},setMaxHeight:function(){},setTransformOrigin:function(){},saveFocus:function(){},restoreFocus:function(){},notifyClose:function(){},notifyClosing:function(){},notifyOpen:function(){},notifyOpening:function(){}}},enumerable:!1,configurable:!0}),a.prototype.init=function(){var o=a.cssClasses,d=o.ROOT,_=o.OPEN;if(!this.adapter.hasClass(d))throw new Error(d+" class required in root element.");this.adapter.hasClass(_)&&(this.isSurfaceOpen=!0)},a.prototype.destroy=function(){clearTimeout(this.openAnimationEndTimerId),clearTimeout(this.closeAnimationEndTimerId),cancelAnimationFrame(this.animationRequestId)},a.prototype.setAnchorCorner=function(o){this.anchorCorner=o},a.prototype.flipCornerHorizontally=function(){this.originCorner=this.originCorner^oo.RIGHT},a.prototype.setAnchorMargin=function(o){this.anchorMargin.top=o.top||0,this.anchorMargin.right=o.right||0,this.anchorMargin.bottom=o.bottom||0,this.anchorMargin.left=o.left||0},a.prototype.setIsHoisted=function(o){this.isHoistedElement=o},a.prototype.setFixedPosition=function(o){this.isFixedPosition=o},a.prototype.isFixed=function(){return this.isFixedPosition},a.prototype.setAbsolutePosition=function(o,d){this.position.x=this.isFinite(o)?o:0,this.position.y=this.isFinite(d)?d:0},a.prototype.setIsHorizontallyCenteredOnViewport=function(o){this.isHorizontallyCenteredOnViewport=o},a.prototype.setQuickOpen=function(o){this.isQuickOpen=o},a.prototype.setMaxHeight=function(o){this.maxHeight=o},a.prototype.setOpenBottomBias=function(o){this.openBottomBias=o},a.prototype.isOpen=function(){return this.isSurfaceOpen},a.prototype.open=function(){var o=this;this.isSurfaceOpen||(this.adapter.notifyOpening(),this.adapter.saveFocus(),this.isQuickOpen?(this.isSurfaceOpen=!0,this.adapter.addClass(a.cssClasses.OPEN),this.dimensions=this.adapter.getInnerDimensions(),this.autoposition(),this.adapter.notifyOpen()):(this.adapter.addClass(a.cssClasses.ANIMATING_OPEN),this.animationRequestId=requestAnimationFrame(function(){o.dimensions=o.adapter.getInnerDimensions(),o.autoposition(),o.adapter.addClass(a.cssClasses.OPEN),o.openAnimationEndTimerId=setTimeout(function(){o.openAnimationEndTimerId=0,o.adapter.removeClass(a.cssClasses.ANIMATING_OPEN),o.adapter.notifyOpen()},qm.TRANSITION_OPEN_DURATION)}),this.isSurfaceOpen=!0))},a.prototype.close=function(o){var d=this;if(o===void 0&&(o=!1),!!this.isSurfaceOpen){if(this.adapter.notifyClosing(),this.isQuickOpen){this.isSurfaceOpen=!1,o||this.maybeRestoreFocus(),this.adapter.removeClass(a.cssClasses.OPEN),this.adapter.removeClass(a.cssClasses.IS_OPEN_BELOW),this.adapter.notifyClose();return}this.adapter.addClass(a.cssClasses.ANIMATING_CLOSED),requestAnimationFrame(function(){d.adapter.removeClass(a.cssClasses.OPEN),d.adapter.removeClass(a.cssClasses.IS_OPEN_BELOW),d.closeAnimationEndTimerId=setTimeout(function(){d.closeAnimationEndTimerId=0,d.adapter.removeClass(a.cssClasses.ANIMATING_CLOSED),d.adapter.notifyClose()},qm.TRANSITION_CLOSE_DURATION)}),this.isSurfaceOpen=!1,o||this.maybeRestoreFocus()}},a.prototype.handleBodyClick=function(o){var d=o.target;this.adapter.isElementInContainer(d)||this.close()},a.prototype.handleKeydown=function(o){var d=o.keyCode,_=o.key,v=_==="Escape"||d===27;v&&this.close()},a.prototype.autoposition=function(){var o;this.measurements=this.getAutoLayoutmeasurements();var d=this.getoriginCorner(),_=this.getMenuSurfaceMaxHeight(d),v=this.hasBit(d,oo.BOTTOM)?"bottom":"top",E=this.hasBit(d,oo.RIGHT)?"right":"left",r=this.getHorizontalOriginOffset(d),I=this.getVerticalOriginOffset(d),R=this.measurements,U=R.anchorSize,V=R.surfaceSize,Z=(o={},o[E]=r,o[v]=I,o);U.width/V.width>qm.ANCHOR_TO_MENU_SURFACE_WIDTH_RATIO&&(E="center"),(this.isHoistedElement||this.isFixedPosition)&&this.adjustPositionForHoistedElement(Z),this.adapter.setTransformOrigin(E+" "+v),this.adapter.setPosition(Z),this.adapter.setMaxHeight(_?_+"px":""),this.hasBit(d,oo.BOTTOM)||this.adapter.addClass(a.cssClasses.IS_OPEN_BELOW)},a.prototype.getAutoLayoutmeasurements=function(){var o=this.adapter.getAnchorDimensions(),d=this.adapter.getBodyDimensions(),_=this.adapter.getWindowDimensions(),v=this.adapter.getWindowScroll();return o||(o={top:this.position.y,right:this.position.x,bottom:this.position.y,left:this.position.x,width:0,height:0}),{anchorSize:o,bodySize:d,surfaceSize:this.dimensions,viewportDistance:{top:o.top,right:_.width-o.right,bottom:_.height-o.bottom,left:o.left},viewportSize:_,windowScroll:v}},a.prototype.getoriginCorner=function(){var o=this.originCorner,d=this.measurements,_=d.viewportDistance,v=d.anchorSize,E=d.surfaceSize,r=a.numbers.MARGIN_TO_EDGE,I=this.hasBit(this.anchorCorner,oo.BOTTOM),R,U;I?(R=_.top-r+this.anchorMargin.bottom,U=_.bottom-r-this.anchorMargin.bottom):(R=_.top-r+this.anchorMargin.top,U=_.bottom-r+v.height-this.anchorMargin.top);var V=U-E.height>0;!V&&R>U+this.openBottomBias&&(o=this.setBit(o,oo.BOTTOM));var Z=this.adapter.isRtl(),Y=this.hasBit(this.anchorCorner,oo.FLIP_RTL),W=this.hasBit(this.anchorCorner,oo.RIGHT)||this.hasBit(o,oo.RIGHT),te=!1;Z&&Y?te=!W:te=W;var ae,Ie;te?(ae=_.left+v.width+this.anchorMargin.right,Ie=_.right-this.anchorMargin.right):(ae=_.left+this.anchorMargin.left,Ie=_.right+v.width-this.anchorMargin.left);var ye=ae-E.width>0,Ue=Ie-E.width>0,je=this.hasBit(o,oo.FLIP_RTL)&&this.hasBit(o,oo.RIGHT);return Ue&&je&&Z||!ye&&je?o=this.unsetBit(o,oo.RIGHT):(ye&&te&&Z||ye&&!te&&W||!Ue&&ae>=Ie)&&(o=this.setBit(o,oo.RIGHT)),o},a.prototype.getMenuSurfaceMaxHeight=function(o){if(this.maxHeight>0)return this.maxHeight;var d=this.measurements.viewportDistance,_=0,v=this.hasBit(o,oo.BOTTOM),E=this.hasBit(this.anchorCorner,oo.BOTTOM),r=a.numbers.MARGIN_TO_EDGE;return v?(_=d.top+this.anchorMargin.top-r,E||(_+=this.measurements.anchorSize.height)):(_=d.bottom-this.anchorMargin.bottom+this.measurements.anchorSize.height-r,E&&(_-=this.measurements.anchorSize.height)),_},a.prototype.getHorizontalOriginOffset=function(o){var d=this.measurements.anchorSize,_=this.hasBit(o,oo.RIGHT),v=this.hasBit(this.anchorCorner,oo.RIGHT);if(_){var E=v?d.width-this.anchorMargin.left:this.anchorMargin.right;return this.isHoistedElement||this.isFixedPosition?E-(this.measurements.viewportSize.width-this.measurements.bodySize.width):E}return v?d.width-this.anchorMargin.right:this.anchorMargin.left},a.prototype.getVerticalOriginOffset=function(o){var d=this.measurements.anchorSize,_=this.hasBit(o,oo.BOTTOM),v=this.hasBit(this.anchorCorner,oo.BOTTOM),E=0;return _?E=v?d.height-this.anchorMargin.top:-this.anchorMargin.bottom:E=v?d.height+this.anchorMargin.bottom:this.anchorMargin.top,E},a.prototype.adjustPositionForHoistedElement=function(o){var d,_,v=this.measurements,E=v.windowScroll,r=v.viewportDistance,I=v.surfaceSize,R=v.viewportSize,U=Object.keys(o);try{for(var V=ec(U),Z=V.next();!Z.done;Z=V.next()){var Y=Z.value,W=o[Y]||0;if(this.isHorizontallyCenteredOnViewport&&(Y==="left"||Y==="right")){o[Y]=(R.width-I.width)/2;continue}W+=r[Y],this.isFixedPosition||(Y==="top"?W+=E.y:Y==="bottom"?W-=E.y:Y==="left"?W+=E.x:W-=E.x),o[Y]=W}}catch(te){d={error:te}}finally{try{Z&&!Z.done&&(_=V.return)&&_.call(V)}finally{if(d)throw d.error}}},a.prototype.maybeRestoreFocus=function(){var o=this,d=this.adapter.isFocused(),_=this.adapter.getOwnerDocument?this.adapter.getOwnerDocument():document,v=_.activeElement&&this.adapter.isElementInContainer(_.activeElement);(d||v)&&setTimeout(function(){o.adapter.restoreFocus()},qm.TOUCH_EVENT_WAIT_MS)},a.prototype.hasBit=function(o,d){return!!(o&d)},a.prototype.setBit=function(o,d){return o|d},a.prototype.unsetBit=function(o,d){return o^d},a.prototype.isFinite=function(o){return typeof o=="number"&&isFinite(o)},a}(lu);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Pp={MENU_SELECTED_LIST_ITEM:"mdc-menu-item--selected",MENU_SELECTION_GROUP:"mdc-menu__selection-group",ROOT:"mdc-menu"},bp={ARIA_CHECKED_ATTR:"aria-checked",ARIA_DISABLED_ATTR:"aria-disabled",CHECKBOX_SELECTOR:'input[type="checkbox"]',LIST_SELECTOR:".mdc-list,.mdc-deprecated-list",SELECTED_EVENT:"MDCMenu:selected",SKIP_RESTORE_FOCUS:"data-menu-item-skip-restore-focus"},CA={FOCUS_ROOT_INDEX:-1},Ap;(function(s){s[s.NONE=0]="NONE",s[s.LIST_ROOT=1]="LIST_ROOT",s[s.FIRST_ITEM=2]="FIRST_ITEM",s[s.LAST_ITEM=3]="LAST_ITEM"})(Ap||(Ap={}));/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var LA=function(s){au(a,s);function a(o){var d=s.call(this,_s(_s({},a.defaultAdapter),o))||this;return d.closeAnimationEndTimerId=0,d.defaultFocusState=Ap.LIST_ROOT,d.selectedIndex=-1,d}return Object.defineProperty(a,"cssClasses",{get:function(){return Pp},enumerable:!1,configurable:!0}),Object.defineProperty(a,"strings",{get:function(){return bp},enumerable:!1,configurable:!0}),Object.defineProperty(a,"numbers",{get:function(){return CA},enumerable:!1,configurable:!0}),Object.defineProperty(a,"defaultAdapter",{get:function(){return{addClassToElementAtIndex:function(){},removeClassFromElementAtIndex:function(){},addAttributeToElementAtIndex:function(){},removeAttributeFromElementAtIndex:function(){},getAttributeFromElementAtIndex:function(){return null},elementContainsClass:function(){return!1},closeSurface:function(){},getElementIndex:function(){return-1},notifySelected:function(){},getMenuItemCount:function(){return 0},focusItemAtIndex:function(){},focusListRoot:function(){},getSelectedSiblingOfItemAtIndex:function(){return-1},isSelectableItemAtIndex:function(){return!1}}},enumerable:!1,configurable:!0}),a.prototype.destroy=function(){this.closeAnimationEndTimerId&&clearTimeout(this.closeAnimationEndTimerId),this.adapter.closeSurface()},a.prototype.handleKeydown=function(o){var d=o.key,_=o.keyCode,v=d==="Tab"||_===9;v&&this.adapter.closeSurface(!0)},a.prototype.handleItemAction=function(o){var d=this,_=this.adapter.getElementIndex(o);if(!(_<0)){this.adapter.notifySelected({index:_});var v=this.adapter.getAttributeFromElementAtIndex(_,bp.SKIP_RESTORE_FOCUS)==="true";this.adapter.closeSurface(v),this.closeAnimationEndTimerId=setTimeout(function(){var E=d.adapter.getElementIndex(o);E>=0&&d.adapter.isSelectableItemAtIndex(E)&&d.setSelectedIndex(E)},yb.numbers.TRANSITION_CLOSE_DURATION)}},a.prototype.handleMenuSurfaceOpened=function(){switch(this.defaultFocusState){case Ap.FIRST_ITEM:this.adapter.focusItemAtIndex(0);break;case Ap.LAST_ITEM:this.adapter.focusItemAtIndex(this.adapter.getMenuItemCount()-1);break;case Ap.NONE:break;default:this.adapter.focusListRoot();break}},a.prototype.setDefaultFocusState=function(o){this.defaultFocusState=o},a.prototype.getSelectedIndex=function(){return this.selectedIndex},a.prototype.setSelectedIndex=function(o){if(this.validatedIndex(o),!this.adapter.isSelectableItemAtIndex(o))throw new Error("MDCMenuFoundation: No selection group at specified index.");var d=this.adapter.getSelectedSiblingOfItemAtIndex(o);d>=0&&(this.adapter.removeAttributeFromElementAtIndex(d,bp.ARIA_CHECKED_ATTR),this.adapter.removeClassFromElementAtIndex(d,Pp.MENU_SELECTED_LIST_ITEM)),this.adapter.addClassToElementAtIndex(o,Pp.MENU_SELECTED_LIST_ITEM),this.adapter.addAttributeToElementAtIndex(o,bp.ARIA_CHECKED_ATTR,"true"),this.selectedIndex=o},a.prototype.setEnabled=function(o,d){this.validatedIndex(o),d?(this.adapter.removeClassFromElementAtIndex(o,ur.LIST_ITEM_DISABLED_CLASS),this.adapter.addAttributeToElementAtIndex(o,bp.ARIA_DISABLED_ATTR,"false")):(this.adapter.addClassToElementAtIndex(o,ur.LIST_ITEM_DISABLED_CLASS),this.adapter.addAttributeToElementAtIndex(o,bp.ARIA_DISABLED_ATTR,"true"))},a.prototype.validatedIndex=function(o){var d=this.adapter.getMenuItemCount(),_=o>=0&&o<d;if(!_)throw new Error("MDCMenuFoundation: No list item at specified index.")},a}(lu);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var DA={NOTCH_ELEMENT_SELECTOR:".mdc-notched-outline__notch"},ix={NOTCH_ELEMENT_PADDING:8},PA={NO_LABEL:"mdc-notched-outline--no-label",OUTLINE_NOTCHED:"mdc-notched-outline--notched",OUTLINE_UPGRADED:"mdc-notched-outline--upgraded"};/**
 * @license
 * Copyright 2017 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var OA=function(s){au(a,s);function a(o){return s.call(this,_s(_s({},a.defaultAdapter),o))||this}return Object.defineProperty(a,"strings",{get:function(){return DA},enumerable:!1,configurable:!0}),Object.defineProperty(a,"cssClasses",{get:function(){return PA},enumerable:!1,configurable:!0}),Object.defineProperty(a,"numbers",{get:function(){return ix},enumerable:!1,configurable:!0}),Object.defineProperty(a,"defaultAdapter",{get:function(){return{addClass:function(){},removeClass:function(){},setNotchWidthProperty:function(){},removeNotchWidthProperty:function(){}}},enumerable:!1,configurable:!0}),a.prototype.notch=function(o){var d=a.cssClasses.OUTLINE_NOTCHED;o>0&&(o+=ix.NOTCH_ELEMENT_PADDING),this.adapter.setNotchWidthProperty(o),this.adapter.addClass(d)},a.prototype.closeNotch=function(){var o=a.cssClasses.OUTLINE_NOTCHED;this.adapter.removeClass(o),this.adapter.removeNotchWidthProperty()},a}(lu);/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Fs={ACTIVATED:"mdc-select--activated",DISABLED:"mdc-select--disabled",FOCUSED:"mdc-select--focused",INVALID:"mdc-select--invalid",MENU_INVALID:"mdc-select__menu--invalid",OUTLINED:"mdc-select--outlined",REQUIRED:"mdc-select--required",ROOT:"mdc-select",WITH_LEADING_ICON:"mdc-select--with-leading-icon"},Cv={ARIA_CONTROLS:"aria-controls",ARIA_DESCRIBEDBY:"aria-describedby",ARIA_SELECTED_ATTR:"aria-selected",CHANGE_EVENT:"MDCSelect:change",HIDDEN_INPUT_SELECTOR:'input[type="hidden"]',LABEL_SELECTOR:".mdc-floating-label",LEADING_ICON_SELECTOR:".mdc-select__icon",LINE_RIPPLE_SELECTOR:".mdc-line-ripple",MENU_SELECTOR:".mdc-select__menu",OUTLINE_SELECTOR:".mdc-notched-outline",SELECTED_TEXT_SELECTOR:".mdc-select__selected-text",SELECT_ANCHOR_SELECTOR:".mdc-select__anchor",VALUE_ATTR:"data-value"},nf={LABEL_SCALE:.75,UNSET_INDEX:-1,CLICK_DEBOUNCE_TIMEOUT_MS:330};/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var RA=function(s){au(a,s);function a(o,d){d===void 0&&(d={});var _=s.call(this,_s(_s({},a.defaultAdapter),o))||this;return _.disabled=!1,_.isMenuOpen=!1,_.useDefaultValidation=!0,_.customValidity=!0,_.lastSelectedIndex=nf.UNSET_INDEX,_.clickDebounceTimeout=0,_.recentlyClicked=!1,_.leadingIcon=d.leadingIcon,_.helperText=d.helperText,_}return Object.defineProperty(a,"cssClasses",{get:function(){return Fs},enumerable:!1,configurable:!0}),Object.defineProperty(a,"numbers",{get:function(){return nf},enumerable:!1,configurable:!0}),Object.defineProperty(a,"strings",{get:function(){return Cv},enumerable:!1,configurable:!0}),Object.defineProperty(a,"defaultAdapter",{get:function(){return{addClass:function(){},removeClass:function(){},hasClass:function(){return!1},activateBottomLine:function(){},deactivateBottomLine:function(){},getSelectedIndex:function(){return-1},setSelectedIndex:function(){},hasLabel:function(){return!1},floatLabel:function(){},getLabelWidth:function(){return 0},setLabelRequired:function(){},hasOutline:function(){return!1},notchOutline:function(){},closeOutline:function(){},setRippleCenter:function(){},notifyChange:function(){},setSelectedText:function(){},isSelectAnchorFocused:function(){return!1},getSelectAnchorAttr:function(){return""},setSelectAnchorAttr:function(){},removeSelectAnchorAttr:function(){},addMenuClass:function(){},removeMenuClass:function(){},openMenu:function(){},closeMenu:function(){},getAnchorElement:function(){return null},setMenuAnchorElement:function(){},setMenuAnchorCorner:function(){},setMenuWrapFocus:function(){},focusMenuItemAtIndex:function(){},getMenuItemCount:function(){return 0},getMenuItemValues:function(){return[]},getMenuItemTextAtIndex:function(){return""},isTypeaheadInProgress:function(){return!1},typeaheadMatchItem:function(){return-1}}},enumerable:!1,configurable:!0}),a.prototype.getSelectedIndex=function(){return this.adapter.getSelectedIndex()},a.prototype.setSelectedIndex=function(o,d,_){d===void 0&&(d=!1),_===void 0&&(_=!1),!(o>=this.adapter.getMenuItemCount())&&(o===nf.UNSET_INDEX?this.adapter.setSelectedText(""):this.adapter.setSelectedText(this.adapter.getMenuItemTextAtIndex(o).trim()),this.adapter.setSelectedIndex(o),d&&this.adapter.closeMenu(),!_&&this.lastSelectedIndex!==o&&this.handleChange(),this.lastSelectedIndex=o)},a.prototype.setValue=function(o,d){d===void 0&&(d=!1);var _=this.adapter.getMenuItemValues().indexOf(o);this.setSelectedIndex(_,!1,d)},a.prototype.getValue=function(){var o=this.adapter.getSelectedIndex(),d=this.adapter.getMenuItemValues();return o!==nf.UNSET_INDEX?d[o]:""},a.prototype.getDisabled=function(){return this.disabled},a.prototype.setDisabled=function(o){this.disabled=o,this.disabled?(this.adapter.addClass(Fs.DISABLED),this.adapter.closeMenu()):this.adapter.removeClass(Fs.DISABLED),this.leadingIcon&&this.leadingIcon.setDisabled(this.disabled),this.disabled?this.adapter.removeSelectAnchorAttr("tabindex"):this.adapter.setSelectAnchorAttr("tabindex","0"),this.adapter.setSelectAnchorAttr("aria-disabled",this.disabled.toString())},a.prototype.openMenu=function(){this.adapter.addClass(Fs.ACTIVATED),this.adapter.openMenu(),this.isMenuOpen=!0,this.adapter.setSelectAnchorAttr("aria-expanded","true")},a.prototype.setHelperTextContent=function(o){this.helperText&&this.helperText.setContent(o)},a.prototype.layout=function(){if(this.adapter.hasLabel()){var o=this.getValue().length>0,d=this.adapter.hasClass(Fs.FOCUSED),_=o||d,v=this.adapter.hasClass(Fs.REQUIRED);this.notchOutline(_),this.adapter.floatLabel(_),this.adapter.setLabelRequired(v)}},a.prototype.layoutOptions=function(){var o=this.adapter.getMenuItemValues(),d=o.indexOf(this.getValue());this.setSelectedIndex(d,!1,!0)},a.prototype.handleMenuOpened=function(){if(this.adapter.getMenuItemValues().length!==0){var o=this.getSelectedIndex(),d=o>=0?o:0;this.adapter.focusMenuItemAtIndex(d)}},a.prototype.handleMenuClosing=function(){this.adapter.setSelectAnchorAttr("aria-expanded","false")},a.prototype.handleMenuClosed=function(){this.adapter.removeClass(Fs.ACTIVATED),this.isMenuOpen=!1,this.adapter.isSelectAnchorFocused()||this.blur()},a.prototype.handleChange=function(){this.layout(),this.adapter.notifyChange(this.getValue());var o=this.adapter.hasClass(Fs.REQUIRED);o&&this.useDefaultValidation&&this.setValid(this.isValid())},a.prototype.handleMenuItemAction=function(o){this.setSelectedIndex(o,!0)},a.prototype.handleFocus=function(){this.adapter.addClass(Fs.FOCUSED),this.layout(),this.adapter.activateBottomLine()},a.prototype.handleBlur=function(){this.isMenuOpen||this.blur()},a.prototype.handleClick=function(o){if(!(this.disabled||this.recentlyClicked)){if(this.setClickDebounceTimeout(),this.isMenuOpen){this.adapter.closeMenu();return}this.adapter.setRippleCenter(o),this.openMenu()}},a.prototype.handleKeydown=function(o){if(!(this.isMenuOpen||!this.adapter.hasClass(Fs.FOCUSED))){var d=ao(o)===Gn.ENTER,_=ao(o)===Gn.SPACEBAR,v=ao(o)===Gn.ARROW_UP,E=ao(o)===Gn.ARROW_DOWN,r=o.ctrlKey||o.metaKey;if(!r&&(!_&&o.key&&o.key.length===1||_&&this.adapter.isTypeaheadInProgress())){var I=_?" ":o.key,R=this.adapter.typeaheadMatchItem(I,this.getSelectedIndex());R>=0&&this.setSelectedIndex(R),o.preventDefault();return}!d&&!_&&!v&&!E||(this.openMenu(),o.preventDefault())}},a.prototype.notchOutline=function(o){if(this.adapter.hasOutline()){var d=this.adapter.hasClass(Fs.FOCUSED);if(o){var _=nf.LABEL_SCALE,v=this.adapter.getLabelWidth()*_;this.adapter.notchOutline(v)}else d||this.adapter.closeOutline()}},a.prototype.setLeadingIconAriaLabel=function(o){this.leadingIcon&&this.leadingIcon.setAriaLabel(o)},a.prototype.setLeadingIconContent=function(o){this.leadingIcon&&this.leadingIcon.setContent(o)},a.prototype.getUseDefaultValidation=function(){return this.useDefaultValidation},a.prototype.setUseDefaultValidation=function(o){this.useDefaultValidation=o},a.prototype.setValid=function(o){this.useDefaultValidation||(this.customValidity=o),this.adapter.setSelectAnchorAttr("aria-invalid",(!o).toString()),o?(this.adapter.removeClass(Fs.INVALID),this.adapter.removeMenuClass(Fs.MENU_INVALID)):(this.adapter.addClass(Fs.INVALID),this.adapter.addMenuClass(Fs.MENU_INVALID)),this.syncHelperTextValidity(o)},a.prototype.isValid=function(){return this.useDefaultValidation&&this.adapter.hasClass(Fs.REQUIRED)&&!this.adapter.hasClass(Fs.DISABLED)?this.getSelectedIndex()!==nf.UNSET_INDEX&&(this.getSelectedIndex()!==0||!!this.getValue()):this.customValidity},a.prototype.setRequired=function(o){o?this.adapter.addClass(Fs.REQUIRED):this.adapter.removeClass(Fs.REQUIRED),this.adapter.setSelectAnchorAttr("aria-required",o.toString()),this.adapter.setLabelRequired(o)},a.prototype.getRequired=function(){return this.adapter.getSelectAnchorAttr("aria-required")==="true"},a.prototype.init=function(){var o=this.adapter.getAnchorElement();o&&(this.adapter.setMenuAnchorElement(o),this.adapter.setMenuAnchorCorner(of.BOTTOM_START)),this.adapter.setMenuWrapFocus(!1),this.setDisabled(this.adapter.hasClass(Fs.DISABLED)),this.syncHelperTextValidity(!this.adapter.hasClass(Fs.INVALID)),this.layout(),this.layoutOptions()},a.prototype.blur=function(){this.adapter.removeClass(Fs.FOCUSED),this.layout(),this.adapter.deactivateBottomLine();var o=this.adapter.hasClass(Fs.REQUIRED);o&&this.useDefaultValidation&&this.setValid(this.isValid())},a.prototype.syncHelperTextValidity=function(o){if(this.helperText){this.helperText.setValidity(o);var d=this.helperText.isVisible(),_=this.helperText.getId();d&&_?this.adapter.setSelectAnchorAttr(Cv.ARIA_DESCRIBEDBY,_):this.adapter.removeSelectAnchorAttr(Cv.ARIA_DESCRIBEDBY)}},a.prototype.setClickDebounceTimeout=function(){var o=this;clearTimeout(this.clickDebounceTimeout),this.clickDebounceTimeout=setTimeout(function(){o.recentlyClicked=!1},nf.CLICK_DEBOUNCE_TIMEOUT_MS),this.recentlyClicked=!0},a}(lu);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var rf={ARIA_HIDDEN:"aria-hidden",ROLE:"role"},Ah={HELPER_TEXT_VALIDATION_MSG:"mdc-select-helper-text--validation-msg",HELPER_TEXT_VALIDATION_MSG_PERSISTENT:"mdc-select-helper-text--validation-msg-persistent"};/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var kA=function(s){au(a,s);function a(o){return s.call(this,_s(_s({},a.defaultAdapter),o))||this}return Object.defineProperty(a,"cssClasses",{get:function(){return Ah},enumerable:!1,configurable:!0}),Object.defineProperty(a,"strings",{get:function(){return rf},enumerable:!1,configurable:!0}),Object.defineProperty(a,"defaultAdapter",{get:function(){return{addClass:function(){},removeClass:function(){},hasClass:function(){return!1},setAttr:function(){},getAttr:function(){return null},removeAttr:function(){},setContent:function(){}}},enumerable:!1,configurable:!0}),a.prototype.getId=function(){return this.adapter.getAttr("id")},a.prototype.isVisible=function(){return this.adapter.getAttr(rf.ARIA_HIDDEN)!=="true"},a.prototype.setContent=function(o){this.adapter.setContent(o)},a.prototype.setValidation=function(o){o?this.adapter.addClass(Ah.HELPER_TEXT_VALIDATION_MSG):this.adapter.removeClass(Ah.HELPER_TEXT_VALIDATION_MSG)},a.prototype.setValidationMsgPersistent=function(o){o?this.adapter.addClass(Ah.HELPER_TEXT_VALIDATION_MSG_PERSISTENT):this.adapter.removeClass(Ah.HELPER_TEXT_VALIDATION_MSG_PERSISTENT)},a.prototype.getIsValidation=function(){return this.adapter.hasClass(Ah.HELPER_TEXT_VALIDATION_MSG)},a.prototype.getIsValidationMsgPersistent=function(){return this.adapter.hasClass(Ah.HELPER_TEXT_VALIDATION_MSG_PERSISTENT)},a.prototype.setValidity=function(o){var d=this.adapter.hasClass(Ah.HELPER_TEXT_VALIDATION_MSG);if(d){var _=this.adapter.hasClass(Ah.HELPER_TEXT_VALIDATION_MSG_PERSISTENT),v=!o||_;if(v){this.showToScreenReader(),o?this.adapter.removeAttr(rf.ROLE):this.adapter.setAttr(rf.ROLE,"alert");return}this.adapter.removeAttr(rf.ROLE),this.hide()}},a.prototype.showToScreenReader=function(){this.adapter.removeAttr(rf.ARIA_HIDDEN)},a.prototype.hide=function(){this.adapter.setAttr(rf.ARIA_HIDDEN,"true")},a}(lu);const{document:zA}=Rb;function BA(s){let a,o,d,_,v,E,r,I;const R=s[34].default,U=Ss(R,s,s[33],null);let V=[{class:d=Un({[s[1]]:!0,"mdc-menu-surface":!0,"mdc-menu-surface--fixed":s[4],"mdc-menu-surface--open":s[3],"smui-menu-surface--static":s[3],"mdc-menu-surface--fullwidth":s[5],...s[8]})},{style:_=Object.entries(s[9]).map(nx).concat([s[2]]).join(" ")},s[12]],Z={};for(let Y=0;Y<V.length;Y+=1)Z=Ai(Z,V[Y]);return{c(){a=ir(),o=pn("div"),U&&U.c(),this.h()},l(Y){a=nr(Y),o=mn(Y,"DIV",{class:!0,style:!0});var W=xn(o);U&&U.l(W),W.forEach(Tt),this.h()},h(){Cr(o,Z)},m(Y,W){pi(Y,a,W),pi(Y,o,W),U&&U.m(o,null),s[35](o),E=!0,r||(I=[xo(zA.body,"click",s[11],!0),Lr(v=ca.call(null,o,s[0])),Lr(s[10].call(null,o)),xo(o,"keydown",function(){As(s[7]&&s[7].handleKeydown.bind(s[7]))&&(s[7]&&s[7].handleKeydown.bind(s[7])).apply(this,arguments)})],r=!0)},p(Y,W){s=Y,U&&U.p&&(!E||W[1]&4)&&Cs(U,R,s,s[33],E?Ds(R,s[33],W,null):Ls(s[33]),null),Cr(o,Z=yr(V,[(!E||W[0]&314&&d!==(d=Un({[s[1]]:!0,"mdc-menu-surface":!0,"mdc-menu-surface--fixed":s[4],"mdc-menu-surface--open":s[3],"smui-menu-surface--static":s[3],"mdc-menu-surface--fullwidth":s[5],...s[8]})))&&{class:d},(!E||W[0]&516&&_!==(_=Object.entries(s[9]).map(nx).concat([s[2]]).join(" ")))&&{style:_},W[0]&4096&&s[12]])),v&&As(v.update)&&W[0]&1&&v.update.call(null,s[0])},i(Y){E||(Ot(U,Y),E=!0)},o(Y){jt(U,Y),E=!1},d(Y){Y&&Tt(a),Y&&Tt(o),U&&U.d(Y),s[35](null),r=!1,Al(I)}}}const nx=([s,a])=>`${s}: ${a};`;function FA(s,a,o){const d=["use","class","style","static","anchor","fixed","open","managed","fullWidth","quickOpen","anchorElement","anchorCorner","anchorMargin","maxHeight","horizontallyCenteredOnViewport","openBottomBias","neverRestoreFocus","isOpen","setOpen","setAbsolutePosition","setIsHoisted","isFixed","getElement"];let _=hr(a,d),{$$slots:v={},$$scope:E}=a;var r,I,R;const U=Wo(qo());let{use:V=[]}=a,{class:Z=""}=a,{style:Y=""}=a,{static:W=!1}=a,{anchor:te=!0}=a,{fixed:ae=!1}=a,{open:Ie=W}=a,{managed:ye=!1}=a,{fullWidth:Ue=!1}=a,{quickOpen:je=!1}=a,{anchorElement:_e=void 0}=a,{anchorCorner:ct=void 0}=a,{anchorMargin:lt={top:0,right:0,bottom:0,left:0}}=a,{maxHeight:St=0}=a,{horizontallyCenteredOnViewport:Bt=!1}=a,{openBottomBias:et=0}=a,{neverRestoreFocus:ot=!1}=a,Nt,qt,_t={},dt={},ti;Xs("SMUI:list:role","menu"),Xs("SMUI:list:item:role","menuitem");const Vi=of;ic(()=>(o(7,qt=new yb({addClass:Yi,removeClass:Gi,hasClass:Gt,hasAnchor:()=>!!_e,notifyClose:()=>{ye||o(13,Ie=W),Ie||Us(Nt,"SMUIMenuSurface:closed",void 0,void 0,!0)},notifyClosing:()=>{ye||o(13,Ie=W),Ie||Us(Nt,"SMUIMenuSurface:closing",void 0,void 0,!0)},notifyOpen:()=>{ye||o(13,Ie=!0),Ie&&Us(Nt,"SMUIMenuSurface:opened",void 0,void 0,!0)},notifyOpening:()=>{Ie||Us(Nt,"SMUIMenuSurface:opening",void 0,void 0,!0)},isElementInContainer:wt=>Nt.contains(wt),isRtl:()=>getComputedStyle(Nt).getPropertyValue("direction")==="rtl",setTransformOrigin:wt=>{o(9,dt["transform-origin"]=wt,dt)},isFocused:()=>document.activeElement===Nt,saveFocus:()=>{var wt;ti=(wt=document.activeElement)!==null&&wt!==void 0?wt:void 0},restoreFocus:()=>{!ot&&(!Nt||Nt.contains(document.activeElement))&&ti&&document.contains(ti)&&"focus"in ti&&ti.focus()},getInnerDimensions:()=>({width:Nt.offsetWidth,height:Nt.offsetHeight}),getAnchorDimensions:()=>_e?_e.getBoundingClientRect():null,getWindowDimensions:()=>({width:window.innerWidth,height:window.innerHeight}),getBodyDimensions:()=>({width:document.body.clientWidth,height:document.body.clientHeight}),getWindowScroll:()=>({x:window.pageXOffset,y:window.pageYOffset}),setPosition:wt=>{o(9,dt.left="left"in wt?`${wt.left}px`:"",dt),o(9,dt.right="right"in wt?`${wt.right}px`:"",dt),o(9,dt.top="top"in wt?`${wt.top}px`:"",dt),o(9,dt.bottom="bottom"in wt?`${wt.bottom}px`:"",dt)},setMaxHeight:wt=>{o(9,dt["max-height"]=wt,dt)}})),Us(Nt,"SMUIMenuSurface:mount",{get open(){return Ie},set open(wt){o(13,Ie=wt)},closeProgrammatic:ki}),qt.init(),()=>{var wt;const Ii=qt.isHoistedElement;qt.destroy(),Ii&&((wt=Nt.parentNode)===null||wt===void 0||wt.removeChild(Nt))})),ud(()=>{var It;te&&Nt&&((It=Nt.parentElement)===null||It===void 0||It.classList.remove("mdc-menu-surface--anchor"))});function Gt(It){return It in _t?_t[It]:Wt().classList.contains(It)}function Yi(It){_t[It]||o(8,_t[It]=!0,_t)}function Gi(It){(!(It in _t)||_t[It])&&o(8,_t[It]=!1,_t)}function ki(It){qt.close(It),o(13,Ie=!1)}function Ni(It){qt&&Ie&&!ye&&qt.handleBodyClick(It)}function Dn(){return Ie}function bn(It){o(13,Ie=It)}function ui(It,wt){return qt.setAbsolutePosition(It,wt)}function Wi(It){return qt.setIsHoisted(It)}function Ei(){return qt.isFixed()}function Wt(){return Nt}function Vn(It){Dr[It?"unshift":"push"](()=>{Nt=It,o(6,Nt)})}return s.$$set=It=>{a=Ai(Ai({},a),Ho(It)),o(12,_=hr(a,d)),"use"in It&&o(0,V=It.use),"class"in It&&o(1,Z=It.class),"style"in It&&o(2,Y=It.style),"static"in It&&o(3,W=It.static),"anchor"in It&&o(15,te=It.anchor),"fixed"in It&&o(4,ae=It.fixed),"open"in It&&o(13,Ie=It.open),"managed"in It&&o(16,ye=It.managed),"fullWidth"in It&&o(5,Ue=It.fullWidth),"quickOpen"in It&&o(17,je=It.quickOpen),"anchorElement"in It&&o(14,_e=It.anchorElement),"anchorCorner"in It&&o(18,ct=It.anchorCorner),"anchorMargin"in It&&o(19,lt=It.anchorMargin),"maxHeight"in It&&o(20,St=It.maxHeight),"horizontallyCenteredOnViewport"in It&&o(21,Bt=It.horizontallyCenteredOnViewport),"openBottomBias"in It&&o(22,et=It.openBottomBias),"neverRestoreFocus"in It&&o(23,ot=It.neverRestoreFocus),"$$scope"in It&&o(33,E=It.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&1073774656|s.$$.dirty[1]&3&&Nt&&te&&!(!(o(30,r=Nt.parentElement)===null||r===void 0)&&r.classList.contains("mdc-menu-surface--anchor"))&&(o(31,I=Nt.parentElement)===null||I===void 0||I.classList.add("mdc-menu-surface--anchor"),o(14,_e=o(32,R=Nt.parentElement)!==null&&R!==void 0?R:void 0)),s.$$.dirty[0]&8320&&qt&&qt.isOpen()!==Ie&&(Ie?qt.open():qt.close()),s.$$.dirty[0]&131200&&qt&&qt.setQuickOpen(je),s.$$.dirty[0]&144&&qt&&qt.setFixedPosition(ae),s.$$.dirty[0]&1048704&&qt&&qt.setMaxHeight(St),s.$$.dirty[0]&2097280&&qt&&qt.setIsHorizontallyCenteredOnViewport(Bt),s.$$.dirty[0]&262272&&qt&&ct!=null&&(typeof ct=="string"?qt.setAnchorCorner(Vi[ct]):qt.setAnchorCorner(ct)),s.$$.dirty[0]&524416&&qt&&qt.setAnchorMargin(lt),s.$$.dirty[0]&4194432&&qt&&qt.setOpenBottomBias(et)},[V,Z,Y,W,ae,Ue,Nt,qt,_t,dt,U,Ni,_,Ie,_e,te,ye,je,ct,lt,St,Bt,et,ot,Dn,bn,ui,Wi,Ei,Wt,r,I,R,E,v,Vn]}class NA extends gs{constructor(a){super(),ys(this,a,FA,BA,ts,{use:0,class:1,style:2,static:3,anchor:15,fixed:4,open:13,managed:16,fullWidth:5,quickOpen:17,anchorElement:14,anchorCorner:18,anchorMargin:19,maxHeight:20,horizontallyCenteredOnViewport:21,openBottomBias:22,neverRestoreFocus:23,isOpen:24,setOpen:25,setAbsolutePosition:26,setIsHoisted:27,isFixed:28,getElement:29},null,[-1,-1])}get isOpen(){return this.$$.ctx[24]}get setOpen(){return this.$$.ctx[25]}get setAbsolutePosition(){return this.$$.ctx[26]}get setIsHoisted(){return this.$$.ctx[27]}get isFixed(){return this.$$.ctx[28]}get getElement(){return this.$$.ctx[29]}}function UA(s,{addClass:a=d=>s.classList.add(d),removeClass:o=d=>s.classList.remove(d)}={}){return a("mdc-menu-surface--anchor"),{destroy(){o("mdc-menu-surface--anchor")}}}function VA(s){let a;const o=s[17].default,d=Ss(o,s,s[22],null);return{c(){d&&d.c()},l(_){d&&d.l(_)},m(_,v){d&&d.m(_,v),a=!0},p(_,v){d&&d.p&&(!a||v&4194304)&&Cs(d,o,_,_[22],a?Ds(o,_[22],v,null):Ls(_[22]),null)},i(_){a||(Ot(d,_),a=!0)},o(_){jt(d,_),a=!1},d(_){d&&d.d(_)}}}function GA(s){let a,o,d;const _=[{use:s[5]},{class:Un({[s[1]]:!0,"mdc-menu":!0})},s[9]];function v(r){s[19](r)}let E={$$slots:{default:[VA]},$$scope:{ctx:s}};for(let r=0;r<_.length;r+=1)E=Ai(E,_[r]);return s[0]!==void 0&&(E.open=s[0]),a=new NA({props:E}),s[18](a),Dr.push(()=>$m(a,"open",v)),a.$on("SMUIMenuSurface:mount",s[7]),a.$on("SMUIList:mount",s[8]),a.$on("SMUIMenuSurface:opened",s[20]),a.$on("keydown",s[6]),a.$on("SMUIList:action",s[21]),{c(){Sn(a.$$.fragment)},l(r){Zn(a.$$.fragment,r)},m(r,I){Cn(a,r,I),d=!0},p(r,[I]){const R=I&546?yr(_,[I&32&&{use:r[5]},I&2&&{class:Un({[r[1]]:!0,"mdc-menu":!0})},I&512&&ms(r[9])]):{};I&4194304&&(R.$$scope={dirty:I,ctx:r}),!o&&I&1&&(o=!0,R.open=r[0],e_(()=>o=!1)),a.$set(R)},i(r){d||(Ot(a.$$.fragment,r),d=!0)},o(r){jt(a.$$.fragment,r),d=!1},d(r){s[18](null),Ln(a,r)}}}function jA(s,a,o){let d;const _=["use","class","open","isOpen","setOpen","setDefaultFocusState","getSelectedIndex","getMenuSurface","getElement"];let v=hr(a,_),{$$slots:E={},$$scope:r}=a;const{closest:I}=Hv,R=Wo(qo());let{use:U=[]}=a,{class:V=""}=a,{open:Z=!1}=a,Y,W,te,ae;ic(()=>(o(3,W=new LA({addClassToElementAtIndex:(_t,dt)=>{ae.addClassForElementIndex(_t,dt)},removeClassFromElementAtIndex:(_t,dt)=>{ae.removeClassForElementIndex(_t,dt)},addAttributeToElementAtIndex:(_t,dt,ti)=>{ae.setAttributeForElementIndex(_t,dt,ti)},removeAttributeFromElementAtIndex:(_t,dt)=>{ae.removeAttributeForElementIndex(_t,dt)},getAttributeFromElementAtIndex:(_t,dt)=>ae.getAttributeFromElementIndex(_t,dt),elementContainsClass:(_t,dt)=>_t.classList.contains(dt),closeSurface:_t=>{te.closeProgrammatic(_t),Us(Bt(),"SMUIMenu:closedProgrammatically")},getElementIndex:_t=>ae.getOrderedList().map(dt=>dt.element).indexOf(_t),notifySelected:_t=>Us(Bt(),"SMUIMenu:selected",{index:_t.index,item:ae.getOrderedList()[_t.index].element},void 0,!0),getMenuItemCount:()=>ae.items.length,focusItemAtIndex:_t=>ae.focusItemAtIndex(_t),focusListRoot:()=>"focus"in ae.element&&ae.element.focus(),isSelectableItemAtIndex:_t=>!!I(ae.getOrderedList()[_t].element,`.${Pp.MENU_SELECTION_GROUP}`),getSelectedSiblingOfItemAtIndex:_t=>{const dt=ae.getOrderedList(),ti=I(dt[_t].element,`.${Pp.MENU_SELECTION_GROUP}`),Vi=ti==null?void 0:ti.querySelector(`.${Pp.MENU_SELECTED_LIST_ITEM}`);return Vi?dt.map(Gt=>Gt.element).indexOf(Vi):-1}})),Us(Bt(),"SMUIMenu:mount",W),W.init(),()=>{W.destroy()}));function Ie(_t){W&&W.handleKeydown(_t)}function ye(_t){te||(te=_t.detail)}function Ue(_t){ae||o(4,ae=_t.detail)}function je(){return Z}function _e(_t){o(0,Z=_t)}function ct(_t){W.setDefaultFocusState(_t)}function lt(){return W.getSelectedIndex()}function St(){return Y}function Bt(){return Y.getElement()}function et(_t){Dr[_t?"unshift":"push"](()=>{Y=_t,o(2,Y)})}function ot(_t){Z=_t,o(0,Z)}const Nt=()=>W&&W.handleMenuSurfaceOpened(),qt=_t=>W&&W.handleItemAction(ae.getOrderedList()[_t.detail.index].element);return s.$$set=_t=>{a=Ai(Ai({},a),Ho(_t)),o(9,v=hr(a,_)),"use"in _t&&o(10,U=_t.use),"class"in _t&&o(1,V=_t.class),"open"in _t&&o(0,Z=_t.open),"$$scope"in _t&&o(22,r=_t.$$scope)},s.$$.update=()=>{s.$$.dirty&1024&&o(5,d=[R,...U])},[Z,V,Y,W,ae,d,Ie,ye,Ue,v,U,je,_e,ct,lt,St,Bt,E,et,ot,Nt,qt,r]}class qA extends gs{constructor(a){super(),ys(this,a,jA,GA,ts,{use:10,class:1,open:0,isOpen:11,setOpen:12,setDefaultFocusState:13,getSelectedIndex:14,getMenuSurface:15,getElement:16})}get isOpen(){return this.$$.ctx[11]}get setOpen(){return this.$$.ctx[12]}get setDefaultFocusState(){return this.$$.ctx[13]}get getSelectedIndex(){return this.$$.ctx[14]}get getMenuSurface(){return this.$$.ctx[15]}get getElement(){return this.$$.ctx[16]}}function HA(s){let a;const o=s[42].default,d=Ss(o,s,s[44],null);return{c(){d&&d.c()},l(_){d&&d.l(_)},m(_,v){d&&d.m(_,v),a=!0},p(_,v){d&&d.p&&(!a||v[1]&8192)&&Cs(d,o,_,_[44],a?Ds(o,_[44],v,null):Ls(_[44]),null)},i(_){a||(Ot(d,_),a=!0)},o(_){jt(d,_),a=!1},d(_){d&&d.d(_)}}}function WA(s){let a,o,d;const _=[{tag:s[13]},{use:[s[16],...s[0]]},{class:Un({[s[1]]:!0,"mdc-deprecated-list":!0,"mdc-deprecated-list--non-interactive":s[2],"mdc-deprecated-list--dense":s[3],"mdc-deprecated-list--textual-list":s[4],"mdc-deprecated-list--avatar-list":s[5]||s[17],"mdc-deprecated-list--icon-list":s[6],"mdc-deprecated-list--image-list":s[7],"mdc-deprecated-list--thumbnail-list":s[8],"mdc-deprecated-list--video-list":s[9],"mdc-deprecated-list--two-line":s[10],"smui-list--three-line":s[11]&&!s[10]})},{role:s[15]},s[25]];var v=s[12];function E(r){let I={$$slots:{default:[HA]},$$scope:{ctx:r}};for(let R=0;R<_.length;R+=1)I=Ai(I,_[R]);return{props:I}}return v&&(a=Gu(v,E(s)),s[43](a),a.$on("keydown",s[20]),a.$on("focusin",s[21]),a.$on("focusout",s[22]),a.$on("click",s[23]),a.$on("SMUIListItem:mount",s[18]),a.$on("SMUIListItem:unmount",s[19]),a.$on("SMUI:action",s[24])),{c(){a&&Sn(a.$$.fragment),o=rr()},l(r){a&&Zn(a.$$.fragment,r),o=rr()},m(r,I){a&&Cn(a,r,I),pi(r,o,I),d=!0},p(r,I){const R=I[0]&33796095?yr(_,[I[0]&8192&&{tag:r[13]},I[0]&65537&&{use:[r[16],...r[0]]},I[0]&135166&&{class:Un({[r[1]]:!0,"mdc-deprecated-list":!0,"mdc-deprecated-list--non-interactive":r[2],"mdc-deprecated-list--dense":r[3],"mdc-deprecated-list--textual-list":r[4],"mdc-deprecated-list--avatar-list":r[5]||r[17],"mdc-deprecated-list--icon-list":r[6],"mdc-deprecated-list--image-list":r[7],"mdc-deprecated-list--thumbnail-list":r[8],"mdc-deprecated-list--video-list":r[9],"mdc-deprecated-list--two-line":r[10],"smui-list--three-line":r[11]&&!r[10]})},I[0]&32768&&{role:r[15]},I[0]&33554432&&ms(r[25])]):{};if(I[1]&8192&&(R.$$scope={dirty:I,ctx:r}),I[0]&4096&&v!==(v=r[12])){if(a){Vs();const U=a;jt(U.$$.fragment,1,0,()=>{Ln(U,1)}),Gs()}v?(a=Gu(v,E(r)),r[43](a),a.$on("keydown",r[20]),a.$on("focusin",r[21]),a.$on("focusout",r[22]),a.$on("click",r[23]),a.$on("SMUIListItem:mount",r[18]),a.$on("SMUIListItem:unmount",r[19]),a.$on("SMUI:action",r[24]),Sn(a.$$.fragment),Ot(a.$$.fragment,1),Cn(a,o.parentNode,o)):a=null}else v&&a.$set(R)},i(r){d||(a&&Ot(a.$$.fragment,r),d=!0)},o(r){a&&jt(a.$$.fragment,r),d=!1},d(r){s[43](null),r&&Tt(o),a&&Ln(a,r)}}}function ZA(s,a,o){const d=["use","class","nonInteractive","dense","textualList","avatarList","iconList","imageList","thumbnailList","videoList","twoLine","threeLine","vertical","wrapFocus","singleSelection","disabledItemsFocusable","selectedIndex","radioList","checkList","hasTypeahead","component","tag","layout","setEnabled","getTypeaheadInProgress","getSelectedIndex","getFocusedItemIndex","focusItemAtIndex","getElement"];let _=hr(a,d),{$$slots:v={},$$scope:E}=a;var r;const{closest:I,matches:R}=Hv,U=Wo(qo());let{use:V=[]}=a,{class:Z=""}=a,{nonInteractive:Y=!1}=a,{dense:W=!1}=a,{textualList:te=!1}=a,{avatarList:ae=!1}=a,{iconList:Ie=!1}=a,{imageList:ye=!1}=a,{thumbnailList:Ue=!1}=a,{videoList:je=!1}=a,{twoLine:_e=!1}=a,{threeLine:ct=!1}=a,{vertical:lt=!0}=a,{wrapFocus:St=(r=Ks("SMUI:list:wrapFocus"))!==null&&r!==void 0?r:!1}=a,{singleSelection:Bt=!1}=a,{disabledItemsFocusable:et=!1}=a,{selectedIndex:ot=-1}=a,{radioList:Nt=!1}=a,{checkList:qt=!1}=a,{hasTypeahead:_t=!1}=a,dt,ti,Vi=[],Gt=Ks("SMUI:list:role"),Yi=Ks("SMUI:list:nav");const Gi=new WeakMap;let ki=Ks("SMUI:dialog:selection"),Ni=Ks("SMUI:addLayoutListener"),Dn,{component:bn=qu}=a,{tag:ui=bn===qu?Yi?"nav":"ul":void 0}=a;Xs("SMUI:list:nonInteractive",Y),Xs("SMUI:separator:context","list"),Gt||(Bt?(Gt="listbox",Xs("SMUI:list:item:role","option")):Nt?(Gt="radiogroup",Xs("SMUI:list:item:role","radio")):qt?(Gt="group",Xs("SMUI:list:item:role","checkbox")):(Gt="list",Xs("SMUI:list:item:role",void 0))),Ni&&(Dn=Ni(sr)),ic(()=>{o(41,ti=new SA({addClassForElementIndex:gt,focusItemAtIndex:Jt,getAttributeForElementIndex:(fi,xi)=>{var yn,ls;return(ls=(yn=dn()[fi])===null||yn===void 0?void 0:yn.getAttr(xi))!==null&&ls!==void 0?ls:null},getFocusedElementIndex:()=>document.activeElement?dn().map(fi=>fi.element).indexOf(document.activeElement):-1,getListItemCount:()=>Vi.length,getPrimaryTextAtIndex:Ji,hasCheckboxAtIndex:fi=>{var xi,yn;return(yn=(xi=dn()[fi])===null||xi===void 0?void 0:xi.hasCheckbox)!==null&&yn!==void 0?yn:!1},hasRadioAtIndex:fi=>{var xi,yn;return(yn=(xi=dn()[fi])===null||xi===void 0?void 0:xi.hasRadio)!==null&&yn!==void 0?yn:!1},isCheckboxCheckedAtIndex:fi=>{var xi;const yn=dn()[fi];return(xi=(yn==null?void 0:yn.hasCheckbox)&&yn.checked)!==null&&xi!==void 0?xi:!1},isFocusInsideList:()=>dt!=null&&nn()!==document.activeElement&&nn().contains(document.activeElement),isRootFocused:()=>dt!=null&&document.activeElement===nn(),listItemAtIndexHasClass:$t,notifyAction:fi=>{o(26,ot=fi),dt!=null&&Us(nn(),"SMUIList:action",{index:fi},void 0,!0)},notifySelectionChange:fi=>{dt!=null&&Us(nn(),"SMUIList:selectionChange",{changedIndices:fi})},removeClassForElementIndex:Si,setAttributeForElementIndex:Pi,setCheckedCheckboxOrRadioAtIndex:(fi,xi)=>{dn()[fi].checked=xi},setTabIndexForListItemChildren:(fi,xi)=>{const yn=dn()[fi],ls="button:not(:disabled), a";Array.prototype.forEach.call(yn.element.querySelectorAll(ls),js=>{js.setAttribute("tabindex",xi)})}}));const yt={get element(){return nn()},get items(){return Vi},get typeaheadInProgress(){return ti.isTypeaheadInProgress()},typeaheadMatchItem(fi,xi){return ti.typeaheadMatchItem(fi,xi,!0)},getOrderedList:dn,focusItemAtIndex:Jt,addClassForElementIndex:gt,removeClassForElementIndex:Si,setAttributeForElementIndex:Pi,removeAttributeForElementIndex:Pr,getAttributeFromElementIndex:Ir,getPrimaryTextAtIndex:Ji};return Us(nn(),"SMUIList:mount",yt),ti.init(),ti.layout(),()=>{ti.destroy()}}),ud(()=>{Dn&&Dn()});function Wi(yt){Vi.push(yt.detail),Gi.set(yt.detail.element,yt.detail),Bt&&yt.detail.selected&&o(26,ot=jn(yt.detail.element)),yt.stopPropagation()}function Ei(yt){var fi;const xi=(fi=yt.detail&&Vi.indexOf(yt.detail))!==null&&fi!==void 0?fi:-1;xi!==-1&&(Vi.splice(xi,1),Vi=Vi,Gi.delete(yt.detail.element)),yt.stopPropagation()}function Wt(yt){ti&&yt.target&&ti.handleKeydown(yt,yt.target.classList.contains("mdc-deprecated-list-item"),jn(yt.target))}function Vn(yt){ti&&yt.target&&ti.handleFocusIn(jn(yt.target))}function It(yt){ti&&yt.target&&ti.handleFocusOut(jn(yt.target))}function wt(yt){ti&&yt.target&&ti.handleClick(jn(yt.target),!R(yt.target,'input[type="checkbox"], input[type="radio"]'),yt)}function Ii(yt){if(Nt||qt){const fi=jn(yt.target);if(fi!==-1){const xi=dn()[fi];xi&&(Nt&&!xi.checked||qt)&&(R(yt.detail.target,'input[type="checkbox"], input[type="radio"]')||(xi.checked=!xi.checked),xi.activateRipple(),window.requestAnimationFrame(()=>{xi.deactivateRipple()}))}}}function dn(){return dt==null?[]:[...nn().children].map(yt=>Gi.get(yt)).filter(yt=>yt&&yt._smui_list_item_accessor)}function $t(yt,fi){var xi;const yn=dn()[yt];return(xi=yn&&yn.hasClass(fi))!==null&&xi!==void 0?xi:!1}function gt(yt,fi){const xi=dn()[yt];xi&&xi.addClass(fi)}function Si(yt,fi){const xi=dn()[yt];xi&&xi.removeClass(fi)}function Pi(yt,fi,xi){const yn=dn()[yt];yn&&yn.addAttr(fi,xi)}function Pr(yt,fi){const xi=dn()[yt];xi&&xi.removeAttr(fi)}function Ir(yt,fi){const xi=dn()[yt];return xi?xi.getAttr(fi):null}function Ji(yt){var fi;const xi=dn()[yt];return(fi=xi&&xi.getPrimaryText())!==null&&fi!==void 0?fi:""}function jn(yt){const fi=I(yt,".mdc-deprecated-list-item, .mdc-deprecated-list");return fi&&R(fi,".mdc-deprecated-list-item")?dn().map(xi=>xi==null?void 0:xi.element).indexOf(fi):-1}function sr(){return ti.layout()}function Be(yt,fi){return ti.setEnabled(yt,fi)}function li(){return ti.isTypeaheadInProgress()}function qi(){return ti.getSelectedIndex()}function Ci(){return ti.getFocusedItemIndex()}function Jt(yt){const fi=dn()[yt];fi&&"focus"in fi.element&&fi.element.focus()}function nn(){return dt.getElement()}function vs(yt){Dr[yt?"unshift":"push"](()=>{dt=yt,o(14,dt)})}return s.$$set=yt=>{a=Ai(Ai({},a),Ho(yt)),o(25,_=hr(a,d)),"use"in yt&&o(0,V=yt.use),"class"in yt&&o(1,Z=yt.class),"nonInteractive"in yt&&o(2,Y=yt.nonInteractive),"dense"in yt&&o(3,W=yt.dense),"textualList"in yt&&o(4,te=yt.textualList),"avatarList"in yt&&o(5,ae=yt.avatarList),"iconList"in yt&&o(6,Ie=yt.iconList),"imageList"in yt&&o(7,ye=yt.imageList),"thumbnailList"in yt&&o(8,Ue=yt.thumbnailList),"videoList"in yt&&o(9,je=yt.videoList),"twoLine"in yt&&o(10,_e=yt.twoLine),"threeLine"in yt&&o(11,ct=yt.threeLine),"vertical"in yt&&o(27,lt=yt.vertical),"wrapFocus"in yt&&o(28,St=yt.wrapFocus),"singleSelection"in yt&&o(29,Bt=yt.singleSelection),"disabledItemsFocusable"in yt&&o(30,et=yt.disabledItemsFocusable),"selectedIndex"in yt&&o(26,ot=yt.selectedIndex),"radioList"in yt&&o(31,Nt=yt.radioList),"checkList"in yt&&o(32,qt=yt.checkList),"hasTypeahead"in yt&&o(33,_t=yt.hasTypeahead),"component"in yt&&o(12,bn=yt.component),"tag"in yt&&o(13,ui=yt.tag),"$$scope"in yt&&o(44,E=yt.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&134217728|s.$$.dirty[1]&1024&&ti&&ti.setVerticalOrientation(lt),s.$$.dirty[0]&268435456|s.$$.dirty[1]&1024&&ti&&ti.setWrapFocus(St),s.$$.dirty[1]&1028&&ti&&ti.setHasTypeahead(_t),s.$$.dirty[0]&536870912|s.$$.dirty[1]&1024&&ti&&ti.setSingleSelection(Bt),s.$$.dirty[0]&1073741824|s.$$.dirty[1]&1024&&ti&&ti.setDisabledItemsFocusable(et),s.$$.dirty[0]&603979776|s.$$.dirty[1]&1024&&ti&&Bt&&qi()!==ot&&ti.setSelectedIndex(ot)},[V,Z,Y,W,te,ae,Ie,ye,Ue,je,_e,ct,bn,ui,dt,Gt,U,ki,Wi,Ei,Wt,Vn,It,wt,Ii,_,ot,lt,St,Bt,et,Nt,qt,_t,sr,Be,li,qi,Ci,Jt,nn,ti,v,vs,E]}class XA extends gs{constructor(a){super(),ys(this,a,ZA,WA,ts,{use:0,class:1,nonInteractive:2,dense:3,textualList:4,avatarList:5,iconList:6,imageList:7,thumbnailList:8,videoList:9,twoLine:10,threeLine:11,vertical:27,wrapFocus:28,singleSelection:29,disabledItemsFocusable:30,selectedIndex:26,radioList:31,checkList:32,hasTypeahead:33,component:12,tag:13,layout:34,setEnabled:35,getTypeaheadInProgress:36,getSelectedIndex:37,getFocusedItemIndex:38,focusItemAtIndex:39,getElement:40},null,[-1,-1])}get layout(){return this.$$.ctx[34]}get setEnabled(){return this.$$.ctx[35]}get getTypeaheadInProgress(){return this.$$.ctx[36]}get getSelectedIndex(){return this.$$.ctx[37]}get getFocusedItemIndex(){return this.$$.ctx[38]}get focusItemAtIndex(){return this.$$.ctx[39]}get getElement(){return this.$$.ctx[40]}}function rx(s){let a;return{c(){a=pn("span"),this.h()},l(o){a=mn(o,"SPAN",{class:!0}),xn(a).forEach(Tt),this.h()},h(){tn(a,"class","mdc-deprecated-list-item__ripple")},m(o,d){pi(o,a,d)},d(o){o&&Tt(a)}}}function KA(s){let a,o,d=s[7]&&rx();const _=s[34].default,v=Ss(_,s,s[37],null);return{c(){d&&d.c(),a=rr(),v&&v.c()},l(E){d&&d.l(E),a=rr(),v&&v.l(E)},m(E,r){d&&d.m(E,r),pi(E,a,r),v&&v.m(E,r),o=!0},p(E,r){E[7]?d||(d=rx(),d.c(),d.m(a.parentNode,a)):d&&(d.d(1),d=null),v&&v.p&&(!o||r[1]&64)&&Cs(v,_,E,E[37],o?Ds(_,E[37],r,null):Ls(E[37]),null)},i(E){o||(Ot(v,E),o=!0)},o(E){jt(v,E),o=!1},d(E){d&&d.d(E),E&&Tt(a),v&&v.d(E)}}}function YA(s){let a,o,d;const _=[{tag:s[14]},{use:[...s[6]?[]:[[t_,{ripple:!s[16],unbounded:!1,color:(s[1]||s[0])&&s[5]==null?"primary":s[5],disabled:s[10],addClass:s[24],removeClass:s[25],addStyle:s[26]}]],s[22],...s[2]]},{class:Un({[s[3]]:!0,"mdc-deprecated-list-item":!s[8],"mdc-deprecated-list-item__wrapper":s[8],"mdc-deprecated-list-item--activated":s[1],"mdc-deprecated-list-item--selected":s[0],"mdc-deprecated-list-item--disabled":s[10],"mdc-menu-item--selected":!s[23]&&s[9]==="menuitem"&&s[0],"smui-menu-item--non-interactive":s[6],...s[18]})},{style:Object.entries(s[19]).map(sx).concat([s[4]]).join(" ")},s[23]&&s[1]?{"aria-current":"page"}:{},!s[23]||s[8]?{role:s[9]}:{},!s[23]&&s[9]==="option"?{"aria-selected":s[0]?"true":"false"}:{},!s[23]&&(s[9]==="radio"||s[9]==="checkbox")?{"aria-checked":s[16]&&s[16].checked?"true":"false"}:{},s[23]?{}:{"aria-disabled":s[10]?"true":"false"},{"data-menu-item-skip-restore-focus":s[11]||void 0},{tabindex:s[21]},{href:s[12]},s[20],s[29]];var v=s[13];function E(r){let I={$$slots:{default:[KA]},$$scope:{ctx:r}};for(let R=0;R<_.length;R+=1)I=Ai(I,_[R]);return{props:I}}return v&&(a=Gu(v,E(s)),s[35](a),a.$on("click",s[15]),a.$on("keydown",s[27]),a.$on("SMUIGenericInput:mount",s[28]),a.$on("SMUIGenericInput:unmount",s[36])),{c(){a&&Sn(a.$$.fragment),o=rr()},l(r){a&&Zn(a.$$.fragment,r),o=rr()},m(r,I){a&&Cn(a,r,I),pi(r,o,I),d=!0},p(r,I){const R=I[0]&670916479?yr(_,[I[0]&16384&&{tag:r[14]},I[0]&121701479&&{use:[...r[6]?[]:[[t_,{ripple:!r[16],unbounded:!1,color:(r[1]||r[0])&&r[5]==null?"primary":r[5],disabled:r[10],addClass:r[24],removeClass:r[25],addStyle:r[26]}]],r[22],...r[2]]},I[0]&8652619&&{class:Un({[r[3]]:!0,"mdc-deprecated-list-item":!r[8],"mdc-deprecated-list-item__wrapper":r[8],"mdc-deprecated-list-item--activated":r[1],"mdc-deprecated-list-item--selected":r[0],"mdc-deprecated-list-item--disabled":r[10],"mdc-menu-item--selected":!r[23]&&r[9]==="menuitem"&&r[0],"smui-menu-item--non-interactive":r[6],...r[18]})},I[0]&524304&&{style:Object.entries(r[19]).map(sx).concat([r[4]]).join(" ")},I[0]&8388610&&ms(r[23]&&r[1]?{"aria-current":"page"}:{}),I[0]&8389376&&ms(!r[23]||r[8]?{role:r[9]}:{}),I[0]&8389121&&ms(!r[23]&&r[9]==="option"?{"aria-selected":r[0]?"true":"false"}:{}),I[0]&8454656&&ms(!r[23]&&(r[9]==="radio"||r[9]==="checkbox")?{"aria-checked":r[16]&&r[16].checked?"true":"false"}:{}),I[0]&8389632&&ms(r[23]?{}:{"aria-disabled":r[10]?"true":"false"}),I[0]&2048&&{"data-menu-item-skip-restore-focus":r[11]||void 0},I[0]&2097152&&{tabindex:r[21]},I[0]&4096&&{href:r[12]},I[0]&1048576&&ms(r[20]),I[0]&536870912&&ms(r[29])]):{};if(I[0]&128|I[1]&64&&(R.$$scope={dirty:I,ctx:r}),I[0]&8192&&v!==(v=r[13])){if(a){Vs();const U=a;jt(U.$$.fragment,1,0,()=>{Ln(U,1)}),Gs()}v?(a=Gu(v,E(r)),r[35](a),a.$on("click",r[15]),a.$on("keydown",r[27]),a.$on("SMUIGenericInput:mount",r[28]),a.$on("SMUIGenericInput:unmount",r[36]),Sn(a.$$.fragment),Ot(a.$$.fragment,1),Cn(a,o.parentNode,o)):a=null}else v&&a.$set(R)},i(r){d||(a&&Ot(a.$$.fragment,r),d=!0)},o(r){a&&jt(a.$$.fragment,r),d=!1},d(r){s[35](null),r&&Tt(o),a&&Ln(a,r)}}}let JA=0;const sx=([s,a])=>`${s}: ${a};`;function QA(s,a,o){let d;const _=["use","class","style","color","nonInteractive","ripple","wrapper","activated","role","selected","disabled","skipRestoreFocus","tabindex","inputId","href","component","tag","action","getPrimaryText","getElement"];let v=hr(a,_),{$$slots:E={},$$scope:r}=a;var I;const R=Wo(qo());let U=()=>{};function V(gt){return gt===U}let{use:Z=[]}=a,{class:Y=""}=a,{style:W=""}=a,{color:te=void 0}=a,{nonInteractive:ae=(I=Ks("SMUI:list:nonInteractive"))!==null&&I!==void 0?I:!1}=a;Xs("SMUI:list:nonInteractive",void 0);let{ripple:Ie=!ae}=a,{wrapper:ye=!1}=a,{activated:Ue=!1}=a,{role:je=ye?"presentation":Ks("SMUI:list:item:role")}=a;Xs("SMUI:list:item:role",void 0);let{selected:_e=!1}=a,{disabled:ct=!1}=a,{skipRestoreFocus:lt=!1}=a,{tabindex:St=U}=a,{inputId:Bt="SMUI-form-field-list-"+JA++}=a,{href:et=void 0}=a,ot,Nt={},qt={},_t={},dt,ti,Vi=Ks("SMUI:list:item:nav"),{component:Gt=qu}=a,{tag:Yi=Gt===qu?Vi?et?"a":"span":"li":void 0}=a;Xs("SMUI:generic:input:props",{id:Bt}),Xs("SMUI:separator:context",void 0),ic(()=>{if(!_e&&!ae){let Si=!0,Pi=ot.getElement();for(;Pi.previousSibling;)if(Pi=Pi.previousSibling,Pi.nodeType===1&&Pi.classList.contains("mdc-deprecated-list-item")&&!Pi.classList.contains("mdc-deprecated-list-item--disabled")){Si=!1;break}Si&&(ti=window.requestAnimationFrame(()=>Ei(Pi)))}const gt={_smui_list_item_accessor:!0,get element(){return Ii()},get selected(){return _e},set selected(Si){o(0,_e=Si)},hasClass:Gi,addClass:ki,removeClass:Ni,getAttr:bn,addAttr:ui,removeAttr:Wi,getPrimaryText:wt,get checked(){var Si;return(Si=dt&&dt.checked)!==null&&Si!==void 0?Si:!1},set checked(Si){dt&&o(16,dt.checked=!!Si,dt)},get hasCheckbox(){return!!(dt&&"_smui_checkbox_accessor"in dt)},get hasRadio(){return!!(dt&&"_smui_radio_accessor"in dt)},activateRipple(){dt&&dt.activateRipple()},deactivateRipple(){dt&&dt.deactivateRipple()},getValue(){return v.value},action:It,get tabindex(){return d},set tabindex(Si){o(30,St=Si)},get disabled(){return ct},get activated(){return Ue},set activated(Si){o(1,Ue=Si)}};return Us(Ii(),"SMUIListItem:mount",gt),()=>{Us(Ii(),"SMUIListItem:unmount",gt)}}),ud(()=>{ti&&window.cancelAnimationFrame(ti)});function Gi(gt){return gt in Nt?Nt[gt]:Ii().classList.contains(gt)}function ki(gt){Nt[gt]||o(18,Nt[gt]=!0,Nt)}function Ni(gt){(!(gt in Nt)||Nt[gt])&&o(18,Nt[gt]=!1,Nt)}function Dn(gt,Si){qt[gt]!=Si&&(Si===""||Si==null?(delete qt[gt],o(19,qt)):o(19,qt[gt]=Si,qt))}function bn(gt){var Si;return gt in _t?(Si=_t[gt])!==null&&Si!==void 0?Si:null:Ii().getAttribute(gt)}function ui(gt,Si){_t[gt]!==Si&&o(20,_t[gt]=Si,_t)}function Wi(gt){(!(gt in _t)||_t[gt]!=null)&&o(20,_t[gt]=void 0,_t)}function Ei(gt){let Si=!0;for(;gt.nextElementSibling;)if(gt=gt.nextElementSibling,gt.nodeType===1&&gt.classList.contains("mdc-deprecated-list-item")){const Pi=gt.attributes.getNamedItem("tabindex");if(Pi&&Pi.value==="0"){Si=!1;break}}Si&&o(21,d=0)}function Wt(gt){const Si=gt.key==="Enter",Pi=gt.key==="Space";(Si||Pi)&&It(gt)}function Vn(gt){("_smui_checkbox_accessor"in gt.detail||"_smui_radio_accessor"in gt.detail)&&o(16,dt=gt.detail)}function It(gt){ct||Us(Ii(),"SMUI:action",gt)}function wt(){var gt,Si,Pi;const Pr=Ii(),Ir=Pr.querySelector(".mdc-deprecated-list-item__primary-text");if(Ir)return(gt=Ir.textContent)!==null&&gt!==void 0?gt:"";const Ji=Pr.querySelector(".mdc-deprecated-list-item__text");return Ji?(Si=Ji.textContent)!==null&&Si!==void 0?Si:"":(Pi=Pr.textContent)!==null&&Pi!==void 0?Pi:""}function Ii(){return ot.getElement()}function dn(gt){Dr[gt?"unshift":"push"](()=>{ot=gt,o(17,ot)})}const $t=()=>o(16,dt=void 0);return s.$$set=gt=>{a=Ai(Ai({},a),Ho(gt)),o(29,v=hr(a,_)),"use"in gt&&o(2,Z=gt.use),"class"in gt&&o(3,Y=gt.class),"style"in gt&&o(4,W=gt.style),"color"in gt&&o(5,te=gt.color),"nonInteractive"in gt&&o(6,ae=gt.nonInteractive),"ripple"in gt&&o(7,Ie=gt.ripple),"wrapper"in gt&&o(8,ye=gt.wrapper),"activated"in gt&&o(1,Ue=gt.activated),"role"in gt&&o(9,je=gt.role),"selected"in gt&&o(0,_e=gt.selected),"disabled"in gt&&o(10,ct=gt.disabled),"skipRestoreFocus"in gt&&o(11,lt=gt.skipRestoreFocus),"tabindex"in gt&&o(30,St=gt.tabindex),"inputId"in gt&&o(31,Bt=gt.inputId),"href"in gt&&o(12,et=gt.href),"component"in gt&&o(13,Gt=gt.component),"tag"in gt&&o(14,Yi=gt.tag),"$$scope"in gt&&o(37,r=gt.$$scope)},s.$$.update=()=>{s.$$.dirty[0]&1073808449&&o(21,d=V(St)?!ae&&!ct&&(_e||dt&&dt.checked)?0:-1:St)},[_e,Ue,Z,Y,W,te,ae,Ie,ye,je,ct,lt,et,Gt,Yi,It,dt,ot,Nt,qt,_t,d,R,Vi,ki,Ni,Dn,Wt,Vn,v,St,Bt,wt,Ii,E,dn,$t,r]}class $A extends gs{constructor(a){super(),ys(this,a,QA,YA,ts,{use:2,class:3,style:4,color:5,nonInteractive:6,ripple:7,wrapper:8,activated:1,role:9,selected:0,disabled:10,skipRestoreFocus:11,tabindex:30,inputId:31,href:12,component:13,tag:14,action:15,getPrimaryText:32,getElement:33},null,[-1,-1])}get action(){return this.$$.ctx[15]}get getPrimaryText(){return this.$$.ctx[32]}get getElement(){return this.$$.ctx[33]}}cu({class:"mdc-deprecated-list-item__text",tag:"span"});cu({class:"mdc-deprecated-list-item__primary-text",tag:"span"});cu({class:"mdc-deprecated-list-item__secondary-text",tag:"span"});function eS(s){let a,o,d,_,v,E;const r=s[8].default,I=Ss(r,s,s[7],null);let R=[{class:o=Un({[s[1]]:!0,"mdc-deprecated-list-item__graphic":!0,"mdc-menu__selection-group-icon":s[4]})},s[5]],U={};for(let V=0;V<R.length;V+=1)U=Ai(U,R[V]);return{c(){a=pn("span"),I&&I.c(),this.h()},l(V){a=mn(V,"SPAN",{class:!0});var Z=xn(a);I&&I.l(Z),Z.forEach(Tt),this.h()},h(){Cr(a,U)},m(V,Z){pi(V,a,Z),I&&I.m(a,null),s[9](a),_=!0,v||(E=[Lr(d=ca.call(null,a,s[0])),Lr(s[3].call(null,a))],v=!0)},p(V,[Z]){I&&I.p&&(!_||Z&128)&&Cs(I,r,V,V[7],_?Ds(r,V[7],Z,null):Ls(V[7]),null),Cr(a,U=yr(R,[(!_||Z&2&&o!==(o=Un({[V[1]]:!0,"mdc-deprecated-list-item__graphic":!0,"mdc-menu__selection-group-icon":V[4]})))&&{class:o},Z&32&&V[5]])),d&&As(d.update)&&Z&1&&d.update.call(null,V[0])},i(V){_||(Ot(I,V),_=!0)},o(V){jt(I,V),_=!1},d(V){V&&Tt(a),I&&I.d(V),s[9](null),v=!1,Al(E)}}}function tS(s,a,o){const d=["use","class","getElement"];let _=hr(a,d),{$$slots:v={},$$scope:E}=a;const r=Wo(qo());let{use:I=[]}=a,{class:R=""}=a,U,V=Ks("SMUI:list:graphic:menu-selection-group");function Z(){return U}function Y(W){Dr[W?"unshift":"push"](()=>{U=W,o(2,U)})}return s.$$set=W=>{a=Ai(Ai({},a),Ho(W)),o(5,_=hr(a,d)),"use"in W&&o(0,I=W.use),"class"in W&&o(1,R=W.class),"$$scope"in W&&o(7,E=W.$$scope)},[I,R,U,r,V,_,Z,E,v,Y]}class iS extends gs{constructor(a){super(),ys(this,a,tS,eS,ts,{use:0,class:1,getElement:6})}get getElement(){return this.$$.ctx[6]}}cu({class:"mdc-deprecated-list-item__meta",tag:"span"});cu({class:"mdc-deprecated-list-group",tag:"div"});cu({class:"mdc-deprecated-list-group__subheader",tag:"h3"});cu({class:"mdc-menu__selection-group-icon",component:iS});function nS(s){let a,o,d,_,v,E,r,I;const R=s[22].default,U=Ss(R,s,s[21],null);let V=[{class:o=Un({[s[3]]:!0,"mdc-floating-label":!0,"mdc-floating-label--float-above":s[0],"mdc-floating-label--required":s[1],...s[8]})},{style:d=Object.entries(s[9]).map(ax).concat([s[4]]).join(" ")},{for:_=s[5]||(s[11]?s[11].id:void 0)},s[12]],Z={};for(let Y=0;Y<V.length;Y+=1)Z=Ai(Z,V[Y]);return{c(){a=pn("label"),U&&U.c(),this.h()},l(Y){a=mn(Y,"LABEL",{class:!0,style:!0,for:!0});var W=xn(a);U&&U.l(W),W.forEach(Tt),this.h()},h(){Cr(a,Z)},m(Y,W){pi(Y,a,W),U&&U.m(a,null),s[24](a),E=!0,r||(I=[Lr(v=ca.call(null,a,s[2])),Lr(s[10].call(null,a))],r=!0)},p(Y,W){U&&U.p&&(!E||W&2097152)&&Cs(U,R,Y,Y[21],E?Ds(R,Y[21],W,null):Ls(Y[21]),null),Cr(a,Z=yr(V,[(!E||W&267&&o!==(o=Un({[Y[3]]:!0,"mdc-floating-label":!0,"mdc-floating-label--float-above":Y[0],"mdc-floating-label--required":Y[1],...Y[8]})))&&{class:o},(!E||W&528&&d!==(d=Object.entries(Y[9]).map(ax).concat([Y[4]]).join(" ")))&&{style:d},(!E||W&32&&_!==(_=Y[5]||(Y[11]?Y[11].id:void 0)))&&{for:_},W&4096&&Y[12]])),v&&As(v.update)&&W&4&&v.update.call(null,Y[2])},i(Y){E||(Ot(U,Y),E=!0)},o(Y){jt(U,Y),E=!1},d(Y){Y&&Tt(a),U&&U.d(Y),s[24](null),r=!1,Al(I)}}}function rS(s){let a,o,d,_,v,E,r;const I=s[22].default,R=Ss(I,s,s[21],null);let U=[{class:o=Un({[s[3]]:!0,"mdc-floating-label":!0,"mdc-floating-label--float-above":s[0],"mdc-floating-label--required":s[1],...s[8]})},{style:d=Object.entries(s[9]).map(ox).concat([s[4]]).join(" ")},s[12]],V={};for(let Z=0;Z<U.length;Z+=1)V=Ai(V,U[Z]);return{c(){a=pn("span"),R&&R.c(),this.h()},l(Z){a=mn(Z,"SPAN",{class:!0,style:!0});var Y=xn(a);R&&R.l(Y),Y.forEach(Tt),this.h()},h(){Cr(a,V)},m(Z,Y){pi(Z,a,Y),R&&R.m(a,null),s[23](a),v=!0,E||(r=[Lr(_=ca.call(null,a,s[2])),Lr(s[10].call(null,a))],E=!0)},p(Z,Y){R&&R.p&&(!v||Y&2097152)&&Cs(R,I,Z,Z[21],v?Ds(I,Z[21],Y,null):Ls(Z[21]),null),Cr(a,V=yr(U,[(!v||Y&267&&o!==(o=Un({[Z[3]]:!0,"mdc-floating-label":!0,"mdc-floating-label--float-above":Z[0],"mdc-floating-label--required":Z[1],...Z[8]})))&&{class:o},(!v||Y&528&&d!==(d=Object.entries(Z[9]).map(ox).concat([Z[4]]).join(" ")))&&{style:d},Y&4096&&Z[12]])),_&&As(_.update)&&Y&4&&_.update.call(null,Z[2])},i(Z){v||(Ot(R,Z),v=!0)},o(Z){jt(R,Z),v=!1},d(Z){Z&&Tt(a),R&&R.d(Z),s[23](null),E=!1,Al(r)}}}function sS(s){let a,o,d,_;const v=[rS,nS],E=[];function r(I,R){return I[6]?0:1}return a=r(s),o=E[a]=v[a](s),{c(){o.c(),d=rr()},l(I){o.l(I),d=rr()},m(I,R){E[a].m(I,R),pi(I,d,R),_=!0},p(I,[R]){let U=a;a=r(I),a===U?E[a].p(I,R):(Vs(),jt(E[U],1,1,()=>{E[U]=null}),Gs(),o=E[a],o?o.p(I,R):(o=E[a]=v[a](I),o.c()),Ot(o,1),o.m(d.parentNode,d))},i(I){_||(Ot(o),_=!0)},o(I){jt(o),_=!1},d(I){E[a].d(I),I&&Tt(d)}}}const ox=([s,a])=>`${s}: ${a};`,ax=([s,a])=>`${s}: ${a};`;function oS(s,a,o){const d=["use","class","style","for","floatAbove","required","wrapped","shake","float","setRequired","getWidth","getElement"];let _=hr(a,d),{$$slots:v={},$$scope:E}=a;var r;const I=Wo(qo());let{use:R=[]}=a,{class:U=""}=a,{style:V=""}=a,{for:Z=void 0}=a,{floatAbove:Y=!1}=a,{required:W=!1}=a,{wrapped:te=!1}=a,ae,Ie,ye={},Ue={},je=(r=Ks("SMUI:generic:input:props"))!==null&&r!==void 0?r:{},_e=Y,ct=W;ic(()=>{o(18,Ie=new gA({addClass:lt,removeClass:St,getWidth:()=>{var Yi,Gi;const ki=dt(),Ni=ki.cloneNode(!0);(Yi=ki.parentNode)===null||Yi===void 0||Yi.appendChild(Ni),Ni.classList.add("smui-floating-label--remove-transition"),Ni.classList.add("smui-floating-label--force-size"),Ni.classList.remove("mdc-floating-label--float-above");const Dn=Ni.scrollWidth;return(Gi=ki.parentNode)===null||Gi===void 0||Gi.removeChild(Ni),Dn},registerInteractionHandler:(Yi,Gi)=>dt().addEventListener(Yi,Gi),deregisterInteractionHandler:(Yi,Gi)=>dt().removeEventListener(Yi,Gi)}));const Gt={get element(){return dt()},addStyle:Bt,removeStyle:et};return Us(ae,"SMUIFloatingLabel:mount",Gt),Ie.init(),()=>{Us(ae,"SMUIFloatingLabel:unmount",Gt),Ie.destroy()}});function lt(Gt){ye[Gt]||o(8,ye[Gt]=!0,ye)}function St(Gt){(!(Gt in ye)||ye[Gt])&&o(8,ye[Gt]=!1,ye)}function Bt(Gt,Yi){Ue[Gt]!=Yi&&(Yi===""||Yi==null?(delete Ue[Gt],o(9,Ue)):o(9,Ue[Gt]=Yi,Ue))}function et(Gt){Gt in Ue&&(delete Ue[Gt],o(9,Ue))}function ot(Gt){Ie.shake(Gt)}function Nt(Gt){o(0,Y=Gt)}function qt(Gt){o(1,W=Gt)}function _t(){return Ie.getWidth()}function dt(){return ae}function ti(Gt){Dr[Gt?"unshift":"push"](()=>{ae=Gt,o(7,ae)})}function Vi(Gt){Dr[Gt?"unshift":"push"](()=>{ae=Gt,o(7,ae)})}return s.$$set=Gt=>{a=Ai(Ai({},a),Ho(Gt)),o(12,_=hr(a,d)),"use"in Gt&&o(2,R=Gt.use),"class"in Gt&&o(3,U=Gt.class),"style"in Gt&&o(4,V=Gt.style),"for"in Gt&&o(5,Z=Gt.for),"floatAbove"in Gt&&o(0,Y=Gt.floatAbove),"required"in Gt&&o(1,W=Gt.required),"wrapped"in Gt&&o(6,te=Gt.wrapped),"$$scope"in Gt&&o(21,E=Gt.$$scope)},s.$$.update=()=>{s.$$.dirty&786433&&Ie&&_e!==Y&&(o(19,_e=Y),Ie.float(Y)),s.$$.dirty&1310722&&Ie&&ct!==W&&(o(20,ct=W),Ie.setRequired(W))},[Y,W,R,U,V,Z,te,ae,ye,Ue,I,je,_,ot,Nt,qt,_t,dt,Ie,_e,ct,E,v,ti,Vi]}class vb extends gs{constructor(a){super(),ys(this,a,oS,sS,ts,{use:2,class:3,style:4,for:5,floatAbove:0,required:1,wrapped:6,shake:13,float:14,setRequired:15,getWidth:16,getElement:17})}get shake(){return this.$$.ctx[13]}get float(){return this.$$.ctx[14]}get setRequired(){return this.$$.ctx[15]}get getWidth(){return this.$$.ctx[16]}get getElement(){return this.$$.ctx[17]}}function aS(s){let a,o,d,_,v,E,r=[{class:o=Un({[s[1]]:!0,"mdc-line-ripple":!0,"mdc-line-ripple--active":s[3],...s[5]})},{style:d=Object.entries(s[6]).map(lx).concat([s[2]]).join(" ")},s[8]],I={};for(let R=0;R<r.length;R+=1)I=Ai(I,r[R]);return{c(){a=pn("div"),this.h()},l(R){a=mn(R,"DIV",{class:!0,style:!0}),xn(a).forEach(Tt),this.h()},h(){Cr(a,I)},m(R,U){pi(R,a,U),s[13](a),v||(E=[Lr(_=ca.call(null,a,s[0])),Lr(s[7].call(null,a))],v=!0)},p(R,[U]){Cr(a,I=yr(r,[U&42&&o!==(o=Un({[R[1]]:!0,"mdc-line-ripple":!0,"mdc-line-ripple--active":R[3],...R[5]}))&&{class:o},U&68&&d!==(d=Object.entries(R[6]).map(lx).concat([R[2]]).join(" "))&&{style:d},U&256&&R[8]])),_&&As(_.update)&&U&1&&_.update.call(null,R[0])},i:ju,o:ju,d(R){R&&Tt(a),s[13](null),v=!1,Al(E)}}}const lx=([s,a])=>`${s}: ${a};`;function lS(s,a,o){const d=["use","class","style","active","activate","deactivate","setRippleCenter","getElement"];let _=hr(a,d);const v=Wo(qo());let{use:E=[]}=a,{class:r=""}=a,{style:I=""}=a,{active:R=!1}=a,U,V,Z={},Y={};ic(()=>(V=new yA({addClass:te,removeClass:ae,hasClass:W,setStyle:Ie,registerEventHandler:(lt,St)=>_e().addEventListener(lt,St),deregisterEventHandler:(lt,St)=>_e().removeEventListener(lt,St)}),V.init(),()=>{V.destroy()}));function W(lt){return lt in Z?Z[lt]:_e().classList.contains(lt)}function te(lt){Z[lt]||o(5,Z[lt]=!0,Z)}function ae(lt){(!(lt in Z)||Z[lt])&&o(5,Z[lt]=!1,Z)}function Ie(lt,St){Y[lt]!=St&&(St===""||St==null?(delete Y[lt],o(6,Y)):o(6,Y[lt]=St,Y))}function ye(){V.activate()}function Ue(){V.deactivate()}function je(lt){V.setRippleCenter(lt)}function _e(){return U}function ct(lt){Dr[lt?"unshift":"push"](()=>{U=lt,o(4,U)})}return s.$$set=lt=>{a=Ai(Ai({},a),Ho(lt)),o(8,_=hr(a,d)),"use"in lt&&o(0,E=lt.use),"class"in lt&&o(1,r=lt.class),"style"in lt&&o(2,I=lt.style),"active"in lt&&o(3,R=lt.active)},[E,r,I,R,U,Z,Y,v,_,ye,Ue,je,_e,ct]}class cS extends gs{constructor(a){super(),ys(this,a,lS,aS,ts,{use:0,class:1,style:2,active:3,activate:9,deactivate:10,setRippleCenter:11,getElement:12})}get activate(){return this.$$.ctx[9]}get deactivate(){return this.$$.ctx[10]}get setRippleCenter(){return this.$$.ctx[11]}get getElement(){return this.$$.ctx[12]}}function cx(s){let a,o,d;const _=s[15].default,v=Ss(_,s,s[14],null);return{c(){a=pn("div"),v&&v.c(),this.h()},l(E){a=mn(E,"DIV",{class:!0,style:!0});var r=xn(a);v&&v.l(r),r.forEach(Tt),this.h()},h(){tn(a,"class","mdc-notched-outline__notch"),tn(a,"style",o=Object.entries(s[7]).map(ux).join(" "))},m(E,r){pi(E,a,r),v&&v.m(a,null),d=!0},p(E,r){v&&v.p&&(!d||r&16384)&&Cs(v,_,E,E[14],d?Ds(_,E[14],r,null):Ls(E[14]),null),(!d||r&128&&o!==(o=Object.entries(E[7]).map(ux).join(" ")))&&tn(a,"style",o)},i(E){d||(Ot(v,E),d=!0)},o(E){jt(v,E),d=!1},d(E){E&&Tt(a),v&&v.d(E)}}}function uS(s){let a,o,d,_,v,E,r,I,R,U,V=!s[3]&&cx(s),Z=[{class:E=Un({[s[1]]:!0,"mdc-notched-outline":!0,"mdc-notched-outline--notched":s[2],"mdc-notched-outline--no-label":s[3],...s[6]})},s[10]],Y={};for(let W=0;W<Z.length;W+=1)Y=Ai(Y,Z[W]);return{c(){a=pn("div"),o=pn("div"),d=ir(),V&&V.c(),_=ir(),v=pn("div"),this.h()},l(W){a=mn(W,"DIV",{class:!0});var te=xn(a);o=mn(te,"DIV",{class:!0}),xn(o).forEach(Tt),d=nr(te),V&&V.l(te),_=nr(te),v=mn(te,"DIV",{class:!0}),xn(v).forEach(Tt),te.forEach(Tt),this.h()},h(){tn(o,"class","mdc-notched-outline__leading"),tn(v,"class","mdc-notched-outline__trailing"),Cr(a,Y)},m(W,te){pi(W,a,te),ln(a,o),ln(a,d),V&&V.m(a,null),ln(a,_),ln(a,v),s[16](a),I=!0,R||(U=[Lr(r=ca.call(null,a,s[0])),Lr(s[8].call(null,a)),xo(a,"SMUIFloatingLabel:mount",s[9]),xo(a,"SMUIFloatingLabel:unmount",s[17])],R=!0)},p(W,[te]){W[3]?V&&(Vs(),jt(V,1,1,()=>{V=null}),Gs()):V?(V.p(W,te),te&8&&Ot(V,1)):(V=cx(W),V.c(),Ot(V,1),V.m(a,_)),Cr(a,Y=yr(Z,[(!I||te&78&&E!==(E=Un({[W[1]]:!0,"mdc-notched-outline":!0,"mdc-notched-outline--notched":W[2],"mdc-notched-outline--no-label":W[3],...W[6]})))&&{class:E},te&1024&&W[10]])),r&&As(r.update)&&te&1&&r.update.call(null,W[0])},i(W){I||(Ot(V),I=!0)},o(W){jt(V),I=!1},d(W){W&&Tt(a),V&&V.d(),s[16](null),R=!1,Al(U)}}}const ux=([s,a])=>`${s}: ${a};`;function hS(s,a,o){const d=["use","class","notched","noLabel","notch","closeNotch","getElement"];let _=hr(a,d),{$$slots:v={},$$scope:E}=a;const r=Wo(qo());let{use:I=[]}=a,{class:R=""}=a,{notched:U=!1}=a,{noLabel:V=!1}=a,Z,Y,W,te={},ae={};ic(()=>(Y=new OA({addClass:ye,removeClass:Ue,setNotchWidthProperty:ot=>je("width",ot+"px"),removeNotchWidthProperty:()=>_e("width")}),Y.init(),()=>{Y.destroy()}));function Ie(ot){o(4,W=ot.detail)}function ye(ot){te[ot]||o(6,te[ot]=!0,te)}function Ue(ot){(!(ot in te)||te[ot])&&o(6,te[ot]=!1,te)}function je(ot,Nt){ae[ot]!=Nt&&(Nt===""||Nt==null?(delete ae[ot],o(7,ae)):o(7,ae[ot]=Nt,ae))}function _e(ot){ot in ae&&(delete ae[ot],o(7,ae))}function ct(ot){Y.notch(ot)}function lt(){Y.closeNotch()}function St(){return Z}function Bt(ot){Dr[ot?"unshift":"push"](()=>{Z=ot,o(5,Z)})}const et=()=>o(4,W=void 0);return s.$$set=ot=>{a=Ai(Ai({},a),Ho(ot)),o(10,_=hr(a,d)),"use"in ot&&o(0,I=ot.use),"class"in ot&&o(1,R=ot.class),"notched"in ot&&o(2,U=ot.notched),"noLabel"in ot&&o(3,V=ot.noLabel),"$$scope"in ot&&o(14,E=ot.$$scope)},s.$$.update=()=>{s.$$.dirty&16&&(W?(W.addStyle("transition-duration","0s"),ye("mdc-notched-outline--upgraded"),requestAnimationFrame(()=>{W&&W.removeStyle("transition-duration")})):Ue("mdc-notched-outline--upgraded"))},[I,R,U,V,W,Z,te,ae,r,Ie,_,ct,lt,St,E,v,Bt,et]}class dS extends gs{constructor(a){super(),ys(this,a,hS,uS,ts,{use:0,class:1,notched:2,noLabel:3,notch:11,closeNotch:12,getElement:13})}get notch(){return this.$$.ctx[11]}get closeNotch(){return this.$$.ctx[12]}get getElement(){return this.$$.ctx[13]}}function fS(s){let a;return{c(){a=co(s[8])},l(o){a=uo(o,s[8])},m(o,d){pi(o,a,d)},p(o,d){d&256&&Sl(a,o[8])},i:ju,o:ju,d(o){o&&Tt(a)}}}function pS(s){let a;const o=s[13].default,d=Ss(o,s,s[12],null);return{c(){d&&d.c()},l(_){d&&d.l(_)},m(_,v){d&&d.m(_,v),a=!0},p(_,v){d&&d.p&&(!a||v&4096)&&Cs(d,o,_,_[12],a?Ds(o,_[12],v,null):Ls(_[12]),null)},i(_){a||(Ot(d,_),a=!0)},o(_){jt(d,_),a=!1},d(_){d&&d.d(_)}}}function mS(s){let a,o,d,_,v,E,r,I,R;const U=[pS,fS],V=[];function Z(te,ae){return te[8]==null?0:1}o=Z(s),d=V[o]=U[o](s);let Y=[{class:_=Un({[s[1]]:!0,"mdc-select-helper-text":!0,"mdc-select-helper-text--validation-msg":s[4],"mdc-select-helper-text--validation-msg-persistent":s[3],...s[6]})},{"aria-hidden":v=s[3]?void 0:"true"},{id:s[2]},s[7],s[10]],W={};for(let te=0;te<Y.length;te+=1)W=Ai(W,Y[te]);return{c(){a=pn("div"),d.c(),this.h()},l(te){a=mn(te,"DIV",{class:!0,"aria-hidden":!0,id:!0});var ae=xn(a);d.l(ae),ae.forEach(Tt),this.h()},h(){Cr(a,W)},m(te,ae){pi(te,a,ae),V[o].m(a,null),s[14](a),r=!0,I||(R=[Lr(E=ca.call(null,a,s[0])),Lr(s[9].call(null,a))],I=!0)},p(te,[ae]){let Ie=o;o=Z(te),o===Ie?V[o].p(te,ae):(Vs(),jt(V[Ie],1,1,()=>{V[Ie]=null}),Gs(),d=V[o],d?d.p(te,ae):(d=V[o]=U[o](te),d.c()),Ot(d,1),d.m(a,null)),Cr(a,W=yr(Y,[(!r||ae&90&&_!==(_=Un({[te[1]]:!0,"mdc-select-helper-text":!0,"mdc-select-helper-text--validation-msg":te[4],"mdc-select-helper-text--validation-msg-persistent":te[3],...te[6]})))&&{class:_},(!r||ae&8&&v!==(v=te[3]?void 0:"true"))&&{"aria-hidden":v},(!r||ae&4)&&{id:te[2]},ae&128&&te[7],ae&1024&&te[10]])),E&&As(E.update)&&ae&1&&E.update.call(null,te[0])},i(te){r||(Ot(d),r=!0)},o(te){jt(d),r=!1},d(te){te&&Tt(a),V[o].d(),s[14](null),I=!1,Al(R)}}}let _S=0;function gS(s,a,o){const d=["use","class","id","persistent","validationMsg","getElement"];let _=hr(a,d),{$$slots:v={},$$scope:E}=a;const r=Wo(qo());let{use:I=[]}=a,{class:R=""}=a,{id:U="SMUI-select-helper-text-"+_S++}=a,{persistent:V=!1}=a,{validationMsg:Z=!1}=a,Y,W,te={},ae={},Ie;ic(()=>(W=new kA({addClass:Ue,removeClass:je,hasClass:ye,getAttr:_e,setAttr:ct,removeAttr:lt,setContent:et=>{o(8,Ie=et)}}),U.startsWith("SMUI-select-helper-text-")&&Us(St(),"SMUISelectHelperText:id",U),Us(St(),"SMUISelectHelperText:mount",W),W.init(),()=>{Us(St(),"SMUISelectHelperText:unmount",W),W.destroy()}));function ye(et){return et in te?te[et]:St().classList.contains(et)}function Ue(et){te[et]||o(6,te[et]=!0,te)}function je(et){(!(et in te)||te[et])&&o(6,te[et]=!1,te)}function _e(et){var ot;return et in ae?(ot=ae[et])!==null&&ot!==void 0?ot:null:St().getAttribute(et)}function ct(et,ot){ae[et]!==ot&&o(7,ae[et]=ot,ae)}function lt(et){(!(et in ae)||ae[et]!=null)&&o(7,ae[et]=void 0,ae)}function St(){return Y}function Bt(et){Dr[et?"unshift":"push"](()=>{Y=et,o(5,Y)})}return s.$$set=et=>{a=Ai(Ai({},a),Ho(et)),o(10,_=hr(a,d)),"use"in et&&o(0,I=et.use),"class"in et&&o(1,R=et.class),"id"in et&&o(2,U=et.id),"persistent"in et&&o(3,V=et.persistent),"validationMsg"in et&&o(4,Z=et.validationMsg),"$$scope"in et&&o(12,E=et.$$scope)},[I,R,U,V,Z,Y,te,ae,Ie,r,_,St,E,v,Bt]}class yS extends gs{constructor(a){super(),ys(this,a,gS,mS,ts,{use:0,class:1,id:2,persistent:3,validationMsg:4,getElement:11})}get getElement(){return this.$$.ctx[11]}}const vS=s=>({}),hx=s=>({}),xS=s=>({}),dx=s=>({}),bS=s=>({}),fx=s=>({}),wS=s=>({}),px=s=>({});function mx(s){let a,o=[{type:"hidden"},{required:s[10]},{disabled:s[6]},{value:s[0]},as(s[53],"input$")],d={};for(let _=0;_<o.length;_+=1)d=Ai(d,o[_]);return{c(){a=pn("input"),this.h()},l(_){a=mn(_,"INPUT",{type:!0}),this.h()},h(){Cr(a,d)},m(_,v){pi(_,a,v),a.autofocus&&a.focus()},p(_,v){Cr(a,d=yr(o,[{type:"hidden"},v[0]&1024&&{required:_[10]},v[0]&64&&{disabled:_[6]},v[0]&1&&{value:_[0]},v[1]&4194304&&as(_[53],"input$")]))},d(_){_&&Tt(a)}}}function _x(s){let a;return{c(){a=pn("span"),this.h()},l(o){a=mn(o,"SPAN",{class:!0}),xn(a).forEach(Tt),this.h()},h(){tn(a,"class","mdc-select__ripple")},m(o,d){pi(o,a,d)},d(o){o&&Tt(a)}}}function gx(s){let a,o;const d=[{id:s[11]+"-smui-label"},{floatAbove:s[42]!==""},{required:s[10]},as(s[53],"label$")];let _={$$slots:{default:[ES]},$$scope:{ctx:s}};for(let v=0;v<d.length;v+=1)_=Ai(_,d[v]);return a=new vb({props:_}),s[66](a),{c(){Sn(a.$$.fragment)},l(v){Zn(a.$$.fragment,v)},m(v,E){Cn(a,v,E),o=!0},p(v,E){const r=E[0]&3072|E[1]&4196352?yr(d,[E[0]&2048&&{id:v[11]+"-smui-label"},E[1]&2048&&{floatAbove:v[42]!==""},E[0]&1024&&{required:v[10]},E[1]&4194304&&ms(as(v[53],"label$"))]):{};E[0]&512|E[2]&16777216&&(r.$$scope={dirty:E,ctx:v}),a.$set(r)},i(v){o||(Ot(a.$$.fragment,v),o=!0)},o(v){jt(a.$$.fragment,v),o=!1},d(v){s[66](null),Ln(a,v)}}}function ES(s){let a=(s[9]==null?"":s[9])+"",o,d;const _=s[63].label,v=Ss(_,s,s[86],px);return{c(){o=co(a),v&&v.c()},l(E){o=uo(E,a),v&&v.l(E)},m(E,r){pi(E,o,r),v&&v.m(E,r),d=!0},p(E,r){(!d||r[0]&512)&&a!==(a=(E[9]==null?"":E[9])+"")&&Sl(o,a),v&&v.p&&(!d||r[2]&16777216)&&Cs(v,_,E,E[86],d?Ds(_,E[86],r,wS):Ls(E[86]),px)},i(E){d||(Ot(v,E),d=!0)},o(E){jt(v,E),d=!1},d(E){E&&Tt(o),v&&v.d(E)}}}function yx(s){let a,o;const d=[{noLabel:s[8]||s[9]==null&&!s[52].label},as(s[53],"outline$")];let _={$$slots:{default:[IS]},$$scope:{ctx:s}};for(let v=0;v<d.length;v+=1)_=Ai(_,d[v]);return a=new dS({props:_}),s[68](a),{c(){Sn(a.$$.fragment)},l(v){Zn(a.$$.fragment,v)},m(v,E){Cn(a,v,E),o=!0},p(v,E){const r=E[0]&768|E[1]&6291456?yr(d,[E[0]&768|E[1]&2097152&&{noLabel:v[8]||v[9]==null&&!v[52].label},E[1]&4194304&&ms(as(v[53],"outline$"))]):{};E[0]&3840|E[1]&6293760|E[2]&16777216&&(r.$$scope={dirty:E,ctx:v}),a.$set(r)},i(v){o||(Ot(a.$$.fragment,v),o=!0)},o(v){jt(a.$$.fragment,v),o=!1},d(v){s[68](null),Ln(a,v)}}}function vx(s){let a,o;const d=[{id:s[11]+"-smui-label"},{floatAbove:s[42]!==""},{required:s[10]},as(s[53],"label$")];let _={$$slots:{default:[TS]},$$scope:{ctx:s}};for(let v=0;v<d.length;v+=1)_=Ai(_,d[v]);return a=new vb({props:_}),s[67](a),{c(){Sn(a.$$.fragment)},l(v){Zn(a.$$.fragment,v)},m(v,E){Cn(a,v,E),o=!0},p(v,E){const r=E[0]&3072|E[1]&4196352?yr(d,[E[0]&2048&&{id:v[11]+"-smui-label"},E[1]&2048&&{floatAbove:v[42]!==""},E[0]&1024&&{required:v[10]},E[1]&4194304&&ms(as(v[53],"label$"))]):{};E[0]&512|E[2]&16777216&&(r.$$scope={dirty:E,ctx:v}),a.$set(r)},i(v){o||(Ot(a.$$.fragment,v),o=!0)},o(v){jt(a.$$.fragment,v),o=!1},d(v){s[67](null),Ln(a,v)}}}function TS(s){let a=(s[9]==null?"":s[9])+"",o,d;const _=s[63].label,v=Ss(_,s,s[86],fx);return{c(){o=co(a),v&&v.c()},l(E){o=uo(E,a),v&&v.l(E)},m(E,r){pi(E,o,r),v&&v.m(E,r),d=!0},p(E,r){(!d||r[0]&512)&&a!==(a=(E[9]==null?"":E[9])+"")&&Sl(o,a),v&&v.p&&(!d||r[2]&16777216)&&Cs(v,_,E,E[86],d?Ds(_,E[86],r,bS):Ls(E[86]),fx)},i(E){d||(Ot(v,E),d=!0)},o(E){jt(v,E),d=!1},d(E){E&&Tt(o),v&&v.d(E)}}}function IS(s){let a,o,d=!s[8]&&(s[9]!=null||s[52].label)&&vx(s);return{c(){d&&d.c(),a=rr()},l(_){d&&d.l(_),a=rr()},m(_,v){d&&d.m(_,v),pi(_,a,v),o=!0},p(_,v){!_[8]&&(_[9]!=null||_[52].label)?d?(d.p(_,v),v[0]&768|v[1]&2097152&&Ot(d,1)):(d=vx(_),d.c(),Ot(d,1),d.m(a.parentNode,a)):d&&(Vs(),jt(d,1,1,()=>{d=null}),Gs())},i(_){o||(Ot(d),o=!0)},o(_){jt(d),o=!1},d(_){d&&d.d(_),_&&Tt(a)}}}function xx(s){let a,o;const d=[as(s[53],"ripple$")];let _={};for(let v=0;v<d.length;v+=1)_=Ai(_,d[v]);return a=new cS({props:_}),s[69](a),{c(){Sn(a.$$.fragment)},l(v){Zn(a.$$.fragment,v)},m(v,E){Cn(a,v,E),o=!0},p(v,E){const r=E[1]&4194304?yr(d,[ms(as(v[53],"ripple$"))]):{};a.$set(r)},i(v){o||(Ot(a.$$.fragment,v),o=!0)},o(v){jt(a.$$.fragment,v),o=!1},d(v){s[69](null),Ln(a,v)}}}function MS(s){let a;const o=s[63].default,d=Ss(o,s,s[86],null);return{c(){d&&d.c()},l(_){d&&d.l(_)},m(_,v){d&&d.m(_,v),a=!0},p(_,v){d&&d.p&&(!a||v[2]&16777216)&&Cs(d,o,_,_[86],a?Ds(o,_[86],v,null):Ls(_[86]),null)},i(_){a||(Ot(d,_),a=!0)},o(_){jt(d,_),a=!1},d(_){d&&d.d(_)}}}function AS(s){let a,o,d;const _=[{role:"listbox"},{wrapFocus:s[35]},as(s[53],"list$")];function v(r){s[74](r)}let E={$$slots:{default:[MS]},$$scope:{ctx:s}};for(let r=0;r<_.length;r+=1)E=Ai(E,_[r]);return s[24]!==void 0&&(E.selectedIndex=s[24]),a=new XA({props:E}),Dr.push(()=>$m(a,"selectedIndex",v)),a.$on("SMUIList:mount",s[75]),{c(){Sn(a.$$.fragment)},l(r){Zn(a.$$.fragment,r)},m(r,I){Cn(a,r,I),d=!0},p(r,I){const R=I[1]&4194320?yr(_,[_[0],I[1]&16&&{wrapFocus:r[35]},I[1]&4194304&&ms(as(r[53],"list$"))]):{};I[2]&16777216&&(R.$$scope={dirty:I,ctx:r}),!o&&I[0]&16777216&&(o=!0,R.selectedIndex=r[24],e_(()=>o=!1)),a.$set(R)},i(r){d||(Ot(a.$$.fragment,r),d=!0)},o(r){jt(a.$$.fragment,r),d=!1},d(r){Ln(a,r)}}}function bx(s){let a,o;const d=[as(s[53],"helperText$")];let _={$$slots:{default:[SS]},$$scope:{ctx:s}};for(let v=0;v<d.length;v+=1)_=Ai(_,d[v]);return a=new yS({props:_}),a.$on("SMUISelectHelperText:id",s[83]),a.$on("SMUISelectHelperText:mount",s[84]),a.$on("SMUISelectHelperText:unmount",s[85]),{c(){Sn(a.$$.fragment)},l(v){Zn(a.$$.fragment,v)},m(v,E){Cn(a,v,E),o=!0},p(v,E){const r=E[1]&4194304?yr(d,[ms(as(v[53],"helperText$"))]):{};E[2]&16777216&&(r.$$scope={dirty:E,ctx:v}),a.$set(r)},i(v){o||(Ot(a.$$.fragment,v),o=!0)},o(v){jt(a.$$.fragment,v),o=!1},d(v){Ln(a,v)}}}function SS(s){let a;const o=s[63].helperText,d=Ss(o,s,s[86],hx);return{c(){d&&d.c()},l(_){d&&d.l(_)},m(_,v){d&&d.m(_,v),a=!0},p(_,v){d&&d.p&&(!a||v[2]&16777216)&&Cs(d,o,_,_[86],a?Ds(o,_[86],v,vS):Ls(_[86]),hx)},i(_){a||(Ot(d,_),a=!0)},o(_){jt(d,_),a=!1},d(_){d&&d.d(_)}}}function CS(s){let a,o,d,_,v,E,r,I,R,U,V,Z,Y,W,te,ae,Ie,ye,Ue,je,_e,ct,lt,St,Bt,et,ot,Nt,qt,_t,dt,ti,Vi,Gt,Yi,Gi,ki,Ni,Dn,bn,ui=s[12]&&mx(s),Wi=s[7]==="filled"&&_x(),Ei=s[7]!=="outlined"&&!s[8]&&(s[9]!=null||s[52].label)&&gx(s),Wt=s[7]==="outlined"&&yx(s);const Vn=s[63].leadingIcon,It=Ss(Vn,s,s[86],dx);let wt=[{id:V=s[11]+"-smui-selected-text"},{class:Z=Un({[s[19]]:!0,"mdc-select__selected-text":!0})},{role:"button"},{"aria-haspopup":"listbox"},{"aria-labelledby":Y=s[11]+"-smui-label"},as(s[53],"selectedText$")],Ii={};for(let Ci=0;Ci<wt.length;Ci+=1)Ii=Ai(Ii,wt[Ci]);let dn=[{class:te=Un({[s[17]]:!0,"mdc-select__selected-text-container":!0})},as(s[53],"selectedTextContainer$")],$t={};for(let Ci=0;Ci<dn.length;Ci+=1)$t=Ai($t,dn[Ci]);let gt=[{class:ct=Un({[s[21]]:!0,"mdc-select__dropdown-icon":!0})},as(s[53],"dropdownIcon$")],Si={};for(let Ci=0;Ci<gt.length;Ci+=1)Si=Ai(Si,gt[Ci]);let Pi=s[7]!=="outlined"&&s[5]&&xx(s),Pr=[{class:Bt=Un({[s[15]]:!0,"mdc-select__anchor":!0})},{"aria-required":et=s[10]?"true":void 0},{"aria-disabled":ot=s[6]?"true":void 0},{"aria-controls":s[30]},{"aria-describedby":s[30]},s[29],as(s[53],"anchor$")],Ir={};for(let Ci=0;Ci<Pr.length;Ci+=1)Ir=Ai(Ir,Pr[Ci]);const Ji=[{class:Un({[s[22]]:!0,"mdc-select__menu":!0,...s[32]})},{fullWidth:!0},{anchor:!1},{anchorElement:s[33]},{anchorCorner:s[34]},as(s[53],"menu$")];function jn(Ci){s[76](Ci)}let sr={$$slots:{default:[AS]},$$scope:{ctx:s}};for(let Ci=0;Ci<Ji.length;Ci+=1)sr=Ai(sr,Ji[Ci]);s[31]!==void 0&&(sr.open=s[31]),_t=new qA({props:sr}),Dr.push(()=>$m(_t,"open",jn)),_t.$on("SMUIMenu:selected",s[77]),_t.$on("SMUIMenuSurface:closing",s[78]),_t.$on("SMUIMenuSurface:closed",s[79]),_t.$on("SMUIMenuSurface:opened",s[80]);let Be=[{class:ti=Un({[s[3]]:!0,"mdc-select":!0,"mdc-select--required":s[10],"mdc-select--disabled":s[6],"mdc-select--filled":s[7]==="filled","mdc-select--outlined":s[7]==="outlined","smui-select--standard":s[7]==="standard","mdc-select--with-leading-icon":s[44](s[13])?s[52].leadingIcon:s[13],"mdc-select--no-label":s[8]||s[9]==null&&!s[52].label,"mdc-select--invalid":s[1],"mdc-select--activated":s[31],"mdc-data-table__pagination-rows-per-page-select":s[45]==="data-table:pagination",...s[26]})},{style:Vi=Object.entries(s[27]).map(wx).concat([s[4]]).join(" ")},xy(s[53],["input$","anchor$","label$","outline$","selectedTextContainer$","selectedText$","dropdownIcon$","ripple$","menu$","list$","helperText$"])],li={};for(let Ci=0;Ci<Be.length;Ci+=1)li=Ai(li,Be[Ci]);let qi=s[52].helperText&&bx(s);return{c(){a=pn("div"),ui&&ui.c(),o=ir(),d=pn("div"),Wi&&Wi.c(),_=ir(),Ei&&Ei.c(),v=ir(),Wt&&Wt.c(),E=ir(),It&&It.c(),r=ir(),I=pn("span"),R=pn("span"),U=co(s[42]),Ie=ir(),ye=pn("span"),Ue=ly("svg"),je=ly("polygon"),_e=ly("polygon"),St=ir(),Pi&&Pi.c(),qt=ir(),Sn(_t.$$.fragment),Gi=ir(),qi&&qi.c(),ki=rr(),this.h()},l(Ci){a=mn(Ci,"DIV",{class:!0,style:!0});var Jt=xn(a);ui&&ui.l(Jt),o=nr(Jt),d=mn(Jt,"DIV",{class:!0,"aria-required":!0,"aria-disabled":!0,"aria-controls":!0,"aria-describedby":!0});var nn=xn(d);Wi&&Wi.l(nn),_=nr(nn),Ei&&Ei.l(nn),v=nr(nn),Wt&&Wt.l(nn),E=nr(nn),It&&It.l(nn),r=nr(nn),I=mn(nn,"SPAN",{class:!0});var vs=xn(I);R=mn(vs,"SPAN",{id:!0,class:!0,role:!0,"aria-haspopup":!0,"aria-labelledby":!0});var yt=xn(R);U=uo(yt,s[42]),yt.forEach(Tt),vs.forEach(Tt),Ie=nr(nn),ye=mn(nn,"SPAN",{class:!0});var fi=xn(ye);Ue=cy(fi,"svg",{class:!0,viewBox:!0,focusable:!0});var xi=xn(Ue);je=cy(xi,"polygon",{class:!0,stroke:!0,"fill-rule":!0,points:!0}),xn(je).forEach(Tt),_e=cy(xi,"polygon",{class:!0,stroke:!0,"fill-rule":!0,points:!0}),xn(_e).forEach(Tt),xi.forEach(Tt),fi.forEach(Tt),St=nr(nn),Pi&&Pi.l(nn),nn.forEach(Tt),qt=nr(Jt),Zn(_t.$$.fragment,Jt),Jt.forEach(Tt),Gi=nr(Ci),qi&&qi.l(Ci),ki=rr(),this.h()},h(){Cr(R,Ii),Cr(I,$t),tn(je,"class","mdc-select__dropdown-icon-inactive"),tn(je,"stroke","none"),tn(je,"fill-rule","evenodd"),tn(je,"points","7 10 12 15 17 10"),tn(_e,"class","mdc-select__dropdown-icon-active"),tn(_e,"stroke","none"),tn(_e,"fill-rule","evenodd"),tn(_e,"points","7 15 12 10 17 15"),tn(Ue,"class","mdc-select__dropdown-icon-graphic"),tn(Ue,"viewBox","7 10 10 5"),tn(Ue,"focusable","false"),Cr(ye,Si),Cr(d,Ir),Cr(a,li)},m(Ci,Jt){pi(Ci,a,Jt),ui&&ui.m(a,null),ln(a,o),ln(a,d),Wi&&Wi.m(d,null),ln(d,_),Ei&&Ei.m(d,null),ln(d,v),Wt&&Wt.m(d,null),ln(d,E),It&&It.m(d,null),ln(d,r),ln(d,I),ln(I,R),ln(R,U),ln(d,Ie),ln(d,ye),ln(ye,Ue),ln(Ue,je),ln(Ue,_e),ln(d,St),Pi&&Pi.m(d,null),s[70](d),ln(a,qt),Cn(_t,a,null),s[81](a),pi(Ci,Gi,Jt),qi&&qi.m(Ci,Jt),pi(Ci,ki,Jt),Ni=!0,Dn||(bn=[Lr(W=ca.call(null,R,s[18])),Lr(ae=ca.call(null,I,s[16])),Lr(lt=ca.call(null,ye,s[20])),Lr(Nt=ca.call(null,d,s[14])),xo(d,"focus",s[71]),xo(d,"blur",s[72]),xo(d,"click",s[73]),xo(d,"keydown",function(){As(s[23]&&s[23].handleKeydown.bind(s[23]))&&(s[23]&&s[23].handleKeydown.bind(s[23])).apply(this,arguments)}),xo(d,"focus",s[64]),xo(d,"blur",s[65]),Lr(Gt=t_.call(null,a,{ripple:s[7]==="filled",unbounded:!1,addClass:s[49],removeClass:s[50],addStyle:s[51]})),Lr(UA.call(null,a,{addClass:s[49],removeClass:s[50]})),Lr(Yi=ca.call(null,a,s[2])),Lr(s[43].call(null,a)),xo(a,"SMUISelectLeadingIcon:mount",s[48]),xo(a,"SMUISelectLeadingIcon:unmount",s[82])],Dn=!0)},p(Ci,Jt){s=Ci,s[12]?ui?ui.p(s,Jt):(ui=mx(s),ui.c(),ui.m(a,o)):ui&&(ui.d(1),ui=null),s[7]==="filled"?Wi||(Wi=_x(),Wi.c(),Wi.m(d,_)):Wi&&(Wi.d(1),Wi=null),s[7]!=="outlined"&&!s[8]&&(s[9]!=null||s[52].label)?Ei?(Ei.p(s,Jt),Jt[0]&896|Jt[1]&2097152&&Ot(Ei,1)):(Ei=gx(s),Ei.c(),Ot(Ei,1),Ei.m(d,v)):Ei&&(Vs(),jt(Ei,1,1,()=>{Ei=null}),Gs()),s[7]==="outlined"?Wt?(Wt.p(s,Jt),Jt[0]&128&&Ot(Wt,1)):(Wt=yx(s),Wt.c(),Ot(Wt,1),Wt.m(d,E)):Wt&&(Vs(),jt(Wt,1,1,()=>{Wt=null}),Gs()),It&&It.p&&(!Ni||Jt[2]&16777216)&&Cs(It,Vn,s,s[86],Ni?Ds(Vn,s[86],Jt,xS):Ls(s[86]),dx),(!Ni||Jt[1]&2048)&&Sl(U,s[42]),Cr(R,Ii=yr(wt,[(!Ni||Jt[0]&2048&&V!==(V=s[11]+"-smui-selected-text"))&&{id:V},(!Ni||Jt[0]&524288&&Z!==(Z=Un({[s[19]]:!0,"mdc-select__selected-text":!0})))&&{class:Z},{role:"button"},{"aria-haspopup":"listbox"},(!Ni||Jt[0]&2048&&Y!==(Y=s[11]+"-smui-label"))&&{"aria-labelledby":Y},Jt[1]&4194304&&as(s[53],"selectedText$")])),W&&As(W.update)&&Jt[0]&262144&&W.update.call(null,s[18]),Cr(I,$t=yr(dn,[(!Ni||Jt[0]&131072&&te!==(te=Un({[s[17]]:!0,"mdc-select__selected-text-container":!0})))&&{class:te},Jt[1]&4194304&&as(s[53],"selectedTextContainer$")])),ae&&As(ae.update)&&Jt[0]&65536&&ae.update.call(null,s[16]),Cr(ye,Si=yr(gt,[(!Ni||Jt[0]&2097152&&ct!==(ct=Un({[s[21]]:!0,"mdc-select__dropdown-icon":!0})))&&{class:ct},Jt[1]&4194304&&as(s[53],"dropdownIcon$")])),lt&&As(lt.update)&&Jt[0]&1048576&&lt.update.call(null,s[20]),s[7]!=="outlined"&&s[5]?Pi?(Pi.p(s,Jt),Jt[0]&160&&Ot(Pi,1)):(Pi=xx(s),Pi.c(),Ot(Pi,1),Pi.m(d,null)):Pi&&(Vs(),jt(Pi,1,1,()=>{Pi=null}),Gs()),Cr(d,Ir=yr(Pr,[(!Ni||Jt[0]&32768&&Bt!==(Bt=Un({[s[15]]:!0,"mdc-select__anchor":!0})))&&{class:Bt},(!Ni||Jt[0]&1024&&et!==(et=s[10]?"true":void 0))&&{"aria-required":et},(!Ni||Jt[0]&64&&ot!==(ot=s[6]?"true":void 0))&&{"aria-disabled":ot},(!Ni||Jt[0]&1073741824)&&{"aria-controls":s[30]},(!Ni||Jt[0]&1073741824)&&{"aria-describedby":s[30]},Jt[0]&536870912&&s[29],Jt[1]&4194304&&as(s[53],"anchor$")])),Nt&&As(Nt.update)&&Jt[0]&16384&&Nt.update.call(null,s[14]);const nn=Jt[0]&4194304|Jt[1]&4194318?yr(Ji,[Jt[0]&4194304|Jt[1]&2&&{class:Un({[s[22]]:!0,"mdc-select__menu":!0,...s[32]})},Ji[1],Ji[2],Jt[1]&4&&{anchorElement:s[33]},Jt[1]&8&&{anchorCorner:s[34]},Jt[1]&4194304&&ms(as(s[53],"menu$"))]):{};Jt[0]&16777216|Jt[1]&4194352|Jt[2]&16777216&&(nn.$$scope={dirty:Jt,ctx:s}),!dt&&Jt[1]&1&&(dt=!0,nn.open=s[31],e_(()=>dt=!1)),_t.$set(nn),Cr(a,li=yr(Be,[(!Ni||Jt[0]&67119050|Jt[1]&2097153&&ti!==(ti=Un({[s[3]]:!0,"mdc-select":!0,"mdc-select--required":s[10],"mdc-select--disabled":s[6],"mdc-select--filled":s[7]==="filled","mdc-select--outlined":s[7]==="outlined","smui-select--standard":s[7]==="standard","mdc-select--with-leading-icon":s[44](s[13])?s[52].leadingIcon:s[13],"mdc-select--no-label":s[8]||s[9]==null&&!s[52].label,"mdc-select--invalid":s[1],"mdc-select--activated":s[31],"mdc-data-table__pagination-rows-per-page-select":s[45]==="data-table:pagination",...s[26]})))&&{class:ti},(!Ni||Jt[0]&134217744&&Vi!==(Vi=Object.entries(s[27]).map(wx).concat([s[4]]).join(" ")))&&{style:Vi},Jt[1]&4194304&&xy(s[53],["input$","anchor$","label$","outline$","selectedTextContainer$","selectedText$","dropdownIcon$","ripple$","menu$","list$","helperText$"])])),Gt&&As(Gt.update)&&Jt[0]&128&&Gt.update.call(null,{ripple:s[7]==="filled",unbounded:!1,addClass:s[49],removeClass:s[50],addStyle:s[51]}),Yi&&As(Yi.update)&&Jt[0]&4&&Yi.update.call(null,s[2]),s[52].helperText?qi?(qi.p(s,Jt),Jt[1]&2097152&&Ot(qi,1)):(qi=bx(s),qi.c(),Ot(qi,1),qi.m(ki.parentNode,ki)):qi&&(Vs(),jt(qi,1,1,()=>{qi=null}),Gs())},i(Ci){Ni||(Ot(Ei),Ot(Wt),Ot(It,Ci),Ot(Pi),Ot(_t.$$.fragment,Ci),Ot(qi),Ni=!0)},o(Ci){jt(Ei),jt(Wt),jt(It,Ci),jt(Pi),jt(_t.$$.fragment,Ci),jt(qi),Ni=!1},d(Ci){Ci&&Tt(a),ui&&ui.d(),Wi&&Wi.d(),Ei&&Ei.d(),Wt&&Wt.d(),It&&It.d(Ci),Pi&&Pi.d(),s[70](null),Ln(_t),s[81](null),Ci&&Tt(Gi),qi&&qi.d(Ci),Ci&&Tt(ki),Dn=!1,Al(bn)}}}let LS=0;function DS(s){const a=s.currentTarget.getBoundingClientRect();return(PS(s)?s.touches[0].clientX:s.clientX)-a.left}function PS(s){return"touches"in s}const wx=([s,a])=>`${s}: ${a};`;function OS(s,a,o){const d=["use","class","style","ripple","disabled","variant","noLabel","label","value","key","dirty","invalid","updateInvalid","required","inputId","hiddenInput","withLeadingIcon","anchor$use","anchor$class","selectedTextContainer$use","selectedTextContainer$class","selectedText$use","selectedText$class","dropdownIcon$use","dropdownIcon$class","menu$class","getUseDefaultValidation","setUseDefaultValidation","focus","layout","getElement"];let _=hr(a,d),v,E,{$$slots:r={},$$scope:I}=a;const R=kb(r),U=Wo(qo());let V=()=>{};function Z(Le){return Le===V}let{use:Y=[]}=a,{class:W=""}=a,{style:te=""}=a,{ripple:ae=!0}=a,{disabled:Ie=!1}=a,{variant:ye="standard"}=a,{noLabel:Ue=!1}=a,{label:je=void 0}=a,{value:_e=""}=a,{key:ct=Le=>Le}=a,{dirty:lt=!1}=a,{invalid:St=V}=a,{updateInvalid:Bt=Z(St)}=a;const et=Z(St);Z(St)&&(St=!1);let{required:ot=!1}=a,{inputId:Nt="SMUI-select-"+LS++}=a,{hiddenInput:qt=!1}=a,{withLeadingIcon:_t=V}=a,{anchor$use:dt=[]}=a,{anchor$class:ti=""}=a,{selectedTextContainer$use:Vi=[]}=a,{selectedTextContainer$class:Gt=""}=a,{selectedText$use:Yi=[]}=a,{selectedText$class:Gi=""}=a,{dropdownIcon$use:ki=[]}=a,{dropdownIcon$class:Ni=""}=a,{menu$class:Dn=""}=a,bn,ui,Wi={},Ei={},Wt,Vn={},It=-1,wt,Ii=Ks("SMUI:addLayoutListener"),dn,$t=!1,gt={},Si,Pi,Pr=!1,Ir,Ji=Ks("SMUI:select:context"),jn,sr,Be,li,qi;Xs("SMUI:list:role",""),Xs("SMUI:list:nav",!1);const Ci=af("");Vu(s,Ci,Le=>o(42,v=Le)),Xs("SMUI:select:selectedText",Ci);const Jt=af(_e);Vu(s,Jt,Le=>o(88,E=Le)),Xs("SMUI:select:value",Jt);let nn=It;Ii&&(dn=Ii(Dl)),ic(()=>(o(23,ui=new RA({setSelectedText:Le=>{Qm(Ci,v=Le,v)},isSelectAnchorFocused:()=>document.activeElement===Wt,getSelectAnchorAttr:Xo,setSelectAnchorAttr:bo,removeSelectAnchorAttr:cs,addMenuClass:ls,removeMenuClass:js,openMenu:()=>{o(31,$t=!0)},closeMenu:()=>{o(31,$t=!1)},getAnchorElement:()=>Wt,setMenuAnchorElement:Le=>{o(33,Si=Le)},setMenuAnchorCorner:Le=>{o(34,Pi=Le)},setMenuWrapFocus:Le=>{o(35,Pr=Le)},getSelectedIndex:()=>It,setSelectedIndex:Le=>{o(62,nn=Le),o(24,It=Le),o(0,_e=ho()[It])},focusMenuItemAtIndex:Le=>{Ir.focusItemAtIndex(Le)},getMenuItemCount:()=>Ir.items.length,getMenuItemValues:()=>ho().map(ct),getMenuItemTextAtIndex:Le=>Ir.getPrimaryTextAtIndex(Le),isTypeaheadInProgress:()=>Ir.typeaheadInProgress,typeaheadMatchItem:(Le,hi)=>Ir.typeaheadMatchItem(Le,hi),addClass:fi,removeClass:xi,hasClass:yt,setRippleCenter:Le=>li&&li.setRippleCenter(Le),activateBottomLine:()=>li&&li.activate(),deactivateBottomLine:()=>li&&li.deactivate(),notifyChange:Le=>{o(54,lt=!0),Bt&&o(1,St=!ui.isValid()),Us(Da(),"SMUISelect:change",{value:_e,index:It},void 0,!0)},hasOutline:()=>!!qi,notchOutline:Le=>qi&&qi.notch(Le),closeOutline:()=>qi&&qi.closeNotch(),hasLabel:()=>!!Be,floatLabel:Le=>Be&&Be.float(Le),getLabelWidth:()=>Be?Be.getWidth():0,setLabelRequired:Le=>Be&&Be.setRequired(Le)},{get helperText(){return sr},get leadingIcon(){return jn}})),o(24,It=ho().indexOf(_e)),ui.init(),qs(et),()=>{ui.destroy()})),ud(()=>{dn&&dn()});function vs(Le){o(37,jn=Le.detail)}function yt(Le){return Le in Wi?Wi[Le]:Da().classList.contains(Le)}function fi(Le){Wi[Le]||o(26,Wi[Le]=!0,Wi)}function xi(Le){(!(Le in Wi)||Wi[Le])&&o(26,Wi[Le]=!1,Wi)}function yn(Le,hi){Ei[Le]!=hi&&(hi===""||hi==null?(delete Ei[Le],o(27,Ei)):o(27,Ei[Le]=hi,Ei))}function ls(Le){gt[Le]||o(32,gt[Le]=!0,gt)}function js(Le){(!(Le in gt)||gt[Le])&&o(32,gt[Le]=!1,gt)}function Xo(Le){var hi;return Le in Vn?(hi=Vn[Le])!==null&&hi!==void 0?hi:null:Da().getAttribute(Le)}function bo(Le,hi){Vn[Le]!==hi&&o(29,Vn[Le]=hi,Vn)}function cs(Le){(!(Le in Vn)||Vn[Le]!=null)&&o(29,Vn[Le]=void 0,Vn)}function ho(){return Ir.getOrderedList().map(Le=>Le.getValue())}function La(){return ui.getUseDefaultValidation()}function qs(Le){ui.setUseDefaultValidation(Le)}function ua(){Wt.focus()}function Dl(){ui.layout()}function Da(){return bn}function Ko(Le){Jm.call(this,s,Le)}function Pa(Le){Jm.call(this,s,Le)}function xs(Le){Dr[Le?"unshift":"push"](()=>{Be=Le,o(39,Be)})}function ha(Le){Dr[Le?"unshift":"push"](()=>{Be=Le,o(39,Be)})}function Ps(Le){Dr[Le?"unshift":"push"](()=>{qi=Le,o(41,qi)})}function da(Le){Dr[Le?"unshift":"push"](()=>{li=Le,o(40,li)})}function he(Le){Dr[Le?"unshift":"push"](()=>{Wt=Le,o(28,Wt)})}const q=()=>ui&&ui.handleFocus(),K=()=>ui&&ui.handleBlur(),ue=Le=>{Wt.focus(),ui&&ui.handleClick(DS(Le))};function ve(Le){It=Le,o(24,It)}const Ce=Le=>o(36,Ir=Le.detail);function qe(Le){$t=Le,o(31,$t)}const Fe=Le=>ui&&ui.handleMenuItemAction(Le.detail.index),Re=()=>ui&&ui.handleMenuClosing(),Ke=()=>ui&&ui.handleMenuClosed(),vt=()=>ui&&ui.handleMenuOpened();function Xt(Le){Dr[Le?"unshift":"push"](()=>{bn=Le,o(25,bn)})}const Dt=()=>o(37,jn=void 0),Mi=Le=>o(30,wt=Le.detail),gi=Le=>o(38,sr=Le.detail),yi=()=>{o(30,wt=void 0),o(38,sr=void 0)};return s.$$set=Le=>{a=Ai(Ai({},a),Ho(Le)),o(53,_=hr(a,d)),"use"in Le&&o(2,Y=Le.use),"class"in Le&&o(3,W=Le.class),"style"in Le&&o(4,te=Le.style),"ripple"in Le&&o(5,ae=Le.ripple),"disabled"in Le&&o(6,Ie=Le.disabled),"variant"in Le&&o(7,ye=Le.variant),"noLabel"in Le&&o(8,Ue=Le.noLabel),"label"in Le&&o(9,je=Le.label),"value"in Le&&o(0,_e=Le.value),"key"in Le&&o(55,ct=Le.key),"dirty"in Le&&o(54,lt=Le.dirty),"invalid"in Le&&o(1,St=Le.invalid),"updateInvalid"in Le&&o(56,Bt=Le.updateInvalid),"required"in Le&&o(10,ot=Le.required),"inputId"in Le&&o(11,Nt=Le.inputId),"hiddenInput"in Le&&o(12,qt=Le.hiddenInput),"withLeadingIcon"in Le&&o(13,_t=Le.withLeadingIcon),"anchor$use"in Le&&o(14,dt=Le.anchor$use),"anchor$class"in Le&&o(15,ti=Le.anchor$class),"selectedTextContainer$use"in Le&&o(16,Vi=Le.selectedTextContainer$use),"selectedTextContainer$class"in Le&&o(17,Gt=Le.selectedTextContainer$class),"selectedText$use"in Le&&o(18,Yi=Le.selectedText$use),"selectedText$class"in Le&&o(19,Gi=Le.selectedText$class),"dropdownIcon$use"in Le&&o(20,ki=Le.dropdownIcon$use),"dropdownIcon$class"in Le&&o(21,Ni=Le.dropdownIcon$class),"menu$class"in Le&&o(22,Dn=Le.menu$class),"$$scope"in Le&&o(86,I=Le.$$scope)},s.$$.update=()=>{if(s.$$.dirty[0]&25165825|s.$$.dirty[2]&1&&nn!==It)if(o(62,nn=It),ui)ui.setSelectedIndex(It,!1,!0);else{const Le=ho();_e!==Le[It]&&o(0,_e=Le[It])}s.$$.dirty[0]&1&&Qm(Jt,E=_e,E),s.$$.dirty[0]&8388609|s.$$.dirty[1]&16777216&&ui&&ui.getValue()!==ct(_e)&&ui.setValue(ct(_e)),s.$$.dirty[0]&8388672&&ui&&ui.getDisabled()!==Ie&&ui.setDisabled(Ie),s.$$.dirty[0]&8388610|s.$$.dirty[1]&41943040&&ui&&lt&&ui.isValid()!==!St&&(Bt?o(1,St=!ui.isValid()):ui.setValid(!St)),s.$$.dirty[0]&8389632&&ui&&ui.getRequired()!==ot&&ui.setRequired(ot)},[_e,St,Y,W,te,ae,Ie,ye,Ue,je,ot,Nt,qt,_t,dt,ti,Vi,Gt,Yi,Gi,ki,Ni,Dn,ui,It,bn,Wi,Ei,Wt,Vn,wt,$t,gt,Si,Pi,Pr,Ir,jn,sr,Be,li,qi,v,U,Z,Ji,Ci,Jt,vs,fi,xi,yn,R,_,lt,ct,Bt,La,qs,ua,Dl,Da,nn,r,Ko,Pa,xs,ha,Ps,da,he,q,K,ue,ve,Ce,qe,Fe,Re,Ke,vt,Xt,Dt,Mi,gi,yi,I]}class Ex extends gs{constructor(a){super(),ys(this,a,OS,CS,ts,{use:2,class:3,style:4,ripple:5,disabled:6,variant:7,noLabel:8,label:9,value:0,key:55,dirty:54,invalid:1,updateInvalid:56,required:10,inputId:11,hiddenInput:12,withLeadingIcon:13,anchor$use:14,anchor$class:15,selectedTextContainer$use:16,selectedTextContainer$class:17,selectedText$use:18,selectedText$class:19,dropdownIcon$use:20,dropdownIcon$class:21,menu$class:22,getUseDefaultValidation:57,setUseDefaultValidation:58,focus:59,layout:60,getElement:61},null,[-1,-1,-1,-1])}get getUseDefaultValidation(){return this.$$.ctx[57]}get setUseDefaultValidation(){return this.$$.ctx[58]}get focus(){return this.$$.ctx[59]}get layout(){return this.$$.ctx[60]}get getElement(){return this.$$.ctx[61]}}function RS(s){let a;const o=s[11].default,d=Ss(o,s,s[13],null);return{c(){d&&d.c()},l(_){d&&d.l(_)},m(_,v){d&&d.m(_,v),a=!0},p(_,v){d&&d.p&&(!a||v&8192)&&Cs(d,o,_,_[13],a?Ds(o,_[13],v,null):Ls(_[13]),null)},i(_){a||(Ot(d,_),a=!0)},o(_){jt(d,_),a=!1},d(_){d&&d.d(_)}}}function kS(s){let a,o;const d=[{use:s[3]},{"data-value":s[0]},{value:s[0]},{selected:s[2]},s[6]];let _={$$slots:{default:[RS]},$$scope:{ctx:s}};for(let v=0;v<d.length;v+=1)_=Ai(_,d[v]);return a=new $A({props:_}),s[12](a),{c(){Sn(a.$$.fragment)},l(v){Zn(a.$$.fragment,v)},m(v,E){Cn(a,v,E),o=!0},p(v,[E]){const r=E&77?yr(d,[E&8&&{use:v[3]},E&1&&{"data-value":v[0]},E&1&&{value:v[0]},E&4&&{selected:v[2]},E&64&&ms(v[6])]):{};E&8192&&(r.$$scope={dirty:E,ctx:v}),a.$set(r)},i(v){o||(Ot(a.$$.fragment,v),o=!0)},o(v){jt(a.$$.fragment,v),o=!1},d(v){s[12](null),Ln(a,v)}}}function zS(s,a,o){let d,_;const v=["use","class","value","getElement"];let E=hr(a,v),r,I,{$$slots:R={},$$scope:U}=a;const V=Wo(qo());let{use:Z=[]}=a;const Y="";let{value:W=""}=a,te;const ae=Ks("SMUI:select:selectedText");Vu(s,ae,_e=>o(14,r=_e));const Ie=Ks("SMUI:select:value");Vu(s,Ie,_e=>o(10,I=_e)),Xs("SMUI:list:item:role","option"),ic(ye),ud(ye);function ye(){_&&te&&Qm(ae,r=te.getPrimaryText(),r)}function Ue(){return te.getElement()}function je(_e){Dr[_e?"unshift":"push"](()=>{te=_e,o(1,te)})}return s.$$set=_e=>{a=Ai(Ai({},a),Ho(_e)),o(6,E=hr(a,v)),"use"in _e&&o(7,Z=_e.use),"value"in _e&&o(0,W=_e.value),"$$scope"in _e&&o(13,U=_e.$$scope)},s.$$.update=()=>{s.$$.dirty&128&&o(3,d=[V,...Z]),s.$$.dirty&1025&&o(2,_=W!=null&&W!==""&&I===W)},[W,te,_,d,ae,Ie,E,Z,Y,Ue,I,R,je,U]}class Ly extends gs{constructor(a){super(),ys(this,a,zS,kS,ts,{use:7,class:8,value:0,getElement:9})}get class(){return this.$$.ctx[8]}get getElement(){return this.$$.ctx[9]}}function Tx(s,a,o){const d=s.slice();return d[16]=a[o],d}function Ix(s,a,o){const d=s.slice();return d[16]=a[o],d}function BS(s){let a;return{c(){a=co("layers")},l(o){a=uo(o,"layers")},m(o,d){pi(o,a,d)},d(o){o&&Tt(a)}}}function Mx(s){let a,o=s[1].toUpperCase()+"",d,_,v,E,r=s[1]==="difference"&&Ax(s);return{c(){a=pn("h3"),d=co(o),_=ir(),r&&r.c(),v=rr()},l(I){a=mn(I,"H3",{});var R=xn(a);d=uo(R,o),R.forEach(Tt),_=nr(I),r&&r.l(I),v=rr()},m(I,R){pi(I,a,R),ln(a,d),pi(I,_,R),r&&r.m(I,R),pi(I,v,R),E=!0},p(I,R){(!E||R&2)&&o!==(o=I[1].toUpperCase()+"")&&Sl(d,o),I[1]==="difference"?r?(r.p(I,R),R&2&&Ot(r,1)):(r=Ax(I),r.c(),Ot(r,1),r.m(v.parentNode,v)):r&&(Vs(),jt(r,1,1,()=>{r=null}),Gs())},i(I){E||(Ot(r),E=!0)},o(I){jt(r),E=!1},d(I){I&&Tt(a),I&&Tt(_),r&&r.d(I),I&&Tt(v)}}}function Ax(s){let a,o,d,_,v,E,r,I;function R(Y){s[8](Y)}let U={key:$S,label:"Layer 1",$$slots:{default:[NS]},$$scope:{ctx:s}};s[4]!==void 0&&(U.value=s[4]),a=new Ex({props:U}),Dr.push(()=>$m(a,"value",R));function V(Y){s[9](Y)}let Z={key:eC,label:"Layer 2",$$slots:{default:[VS]},$$scope:{ctx:s}};return s[5]!==void 0&&(Z.value=s[5]),_=new Ex({props:Z}),Dr.push(()=>$m(_,"value",V)),{c(){Sn(a.$$.fragment),d=ir(),Sn(_.$$.fragment),E=ir(),r=pn("span"),this.h()},l(Y){Zn(a.$$.fragment,Y),d=nr(Y),Zn(_.$$.fragment,Y),E=nr(Y),r=mn(Y,"SPAN",{style:!0}),xn(r).forEach(Tt),this.h()},h(){Hm(r,"margin-top","20px")},m(Y,W){Cn(a,Y,W),pi(Y,d,W),Cn(_,Y,W),pi(Y,E,W),pi(Y,r,W),I=!0},p(Y,W){const te={};W&2097216&&(te.$$scope={dirty:W,ctx:Y}),!o&&W&16&&(o=!0,te.value=Y[4],e_(()=>o=!1)),a.$set(te);const ae={};W&2097216&&(ae.$$scope={dirty:W,ctx:Y}),!v&&W&32&&(v=!0,ae.value=Y[5],e_(()=>v=!1)),_.$set(ae)},i(Y){I||(Ot(a.$$.fragment,Y),Ot(_.$$.fragment,Y),I=!0)},o(Y){jt(a.$$.fragment,Y),jt(_.$$.fragment,Y),I=!1},d(Y){Ln(a,Y),Y&&Tt(d),Ln(_,Y),Y&&Tt(E),Y&&Tt(r)}}}function FS(s){let a=s[16].displayName+"",o;return{c(){o=co(a)},l(d){o=uo(d,a)},m(d,_){pi(d,o,_)},p(d,_){_&64&&a!==(a=d[16].displayName+"")&&Sl(o,a)},d(d){d&&Tt(o)}}}function Sx(s){let a,o;return a=new Ly({props:{value:s[16],$$slots:{default:[FS]},$$scope:{ctx:s}}}),{c(){Sn(a.$$.fragment)},l(d){Zn(a.$$.fragment,d)},m(d,_){Cn(a,d,_),o=!0},p(d,_){const v={};_&64&&(v.value=d[16]),_&2097216&&(v.$$scope={dirty:_,ctx:d}),a.$set(v)},i(d){o||(Ot(a.$$.fragment,d),o=!0)},o(d){jt(a.$$.fragment,d),o=!1},d(d){Ln(a,d)}}}function NS(s){let a,o,d,_;a=new Ly({props:{value:null}});let v=s[6],E=[];for(let I=0;I<v.length;I+=1)E[I]=Sx(Ix(s,v,I));const r=I=>jt(E[I],1,1,()=>{E[I]=null});return{c(){Sn(a.$$.fragment),o=ir();for(let I=0;I<E.length;I+=1)E[I].c();d=rr()},l(I){Zn(a.$$.fragment,I),o=nr(I);for(let R=0;R<E.length;R+=1)E[R].l(I);d=rr()},m(I,R){Cn(a,I,R),pi(I,o,R);for(let U=0;U<E.length;U+=1)E[U]&&E[U].m(I,R);pi(I,d,R),_=!0},p(I,R){if(R&64){v=I[6];let U;for(U=0;U<v.length;U+=1){const V=Ix(I,v,U);E[U]?(E[U].p(V,R),Ot(E[U],1)):(E[U]=Sx(V),E[U].c(),Ot(E[U],1),E[U].m(d.parentNode,d))}for(Vs(),U=v.length;U<E.length;U+=1)r(U);Gs()}},i(I){if(!_){Ot(a.$$.fragment,I);for(let R=0;R<v.length;R+=1)Ot(E[R]);_=!0}},o(I){jt(a.$$.fragment,I),E=E.filter(Boolean);for(let R=0;R<E.length;R+=1)jt(E[R]);_=!1},d(I){Ln(a,I),I&&Tt(o),Uv(E,I),I&&Tt(d)}}}function US(s){let a=s[16].displayName+"",o;return{c(){o=co(a)},l(d){o=uo(d,a)},m(d,_){pi(d,o,_)},p(d,_){_&64&&a!==(a=d[16].displayName+"")&&Sl(o,a)},d(d){d&&Tt(o)}}}function Cx(s){let a,o;return a=new Ly({props:{value:s[16],$$slots:{default:[US]},$$scope:{ctx:s}}}),{c(){Sn(a.$$.fragment)},l(d){Zn(a.$$.fragment,d)},m(d,_){Cn(a,d,_),o=!0},p(d,_){const v={};_&64&&(v.value=d[16]),_&2097216&&(v.$$scope={dirty:_,ctx:d}),a.$set(v)},i(d){o||(Ot(a.$$.fragment,d),o=!0)},o(d){jt(a.$$.fragment,d),o=!1},d(d){Ln(a,d)}}}function VS(s){let a,o,d,_;a=new Ly({props:{value:null}});let v=s[6],E=[];for(let I=0;I<v.length;I+=1)E[I]=Cx(Tx(s,v,I));const r=I=>jt(E[I],1,1,()=>{E[I]=null});return{c(){Sn(a.$$.fragment),o=ir();for(let I=0;I<E.length;I+=1)E[I].c();d=rr()},l(I){Zn(a.$$.fragment,I),o=nr(I);for(let R=0;R<E.length;R+=1)E[R].l(I);d=rr()},m(I,R){Cn(a,I,R),pi(I,o,R);for(let U=0;U<E.length;U+=1)E[U]&&E[U].m(I,R);pi(I,d,R),_=!0},p(I,R){if(R&64){v=I[6];let U;for(U=0;U<v.length;U+=1){const V=Tx(I,v,U);E[U]?(E[U].p(V,R),Ot(E[U],1)):(E[U]=Cx(V),E[U].c(),Ot(E[U],1),E[U].m(d.parentNode,d))}for(Vs(),U=v.length;U<E.length;U+=1)r(U);Gs()}},i(I){if(!_){Ot(a.$$.fragment,I);for(let R=0;R<v.length;R+=1)Ot(E[R]);_=!0}},o(I){jt(a.$$.fragment,I),E=E.filter(Boolean);for(let R=0;R<E.length;R+=1)jt(E[R]);_=!1},d(I){Ln(a,I),I&&Tt(o),Uv(E,I),I&&Tt(d)}}}function GS(s){let a,o;return a=new iE({props:{layer:s[15],selectModeEnabled:s[3]!==null,map:s[0]}}),{c(){Sn(a.$$.fragment)},l(d){Zn(a.$$.fragment,d)},m(d,_){Cn(a,d,_),o=!0},p(d,_){const v={};_&32768&&(v.layer=d[15]),_&8&&(v.selectModeEnabled=d[3]!==null),_&1&&(v.map=d[0]),a.$set(v)},i(d){o||(Ot(a.$$.fragment,d),o=!0)},o(d){jt(a.$$.fragment,d),o=!1},d(d){Ln(a,d)}}}function jS(s){let a;return{c(){a=co("upload_file")},l(o){a=uo(o,"upload_file")},m(o,d){pi(o,a,d)},d(o){o&&Tt(a)}}}function qS(s){let a;return{c(){a=co("Upload layers")},l(o){a=uo(o,"Upload layers")},m(o,d){pi(o,a,d)},d(o){o&&Tt(a)}}}function HS(s){let a,o,d,_;return a=new a_({props:{class:"material-icons",$$slots:{default:[jS]},$$scope:{ctx:s}}}),a.$on("click",s[10]),d=new My({props:{$$slots:{default:[qS]},$$scope:{ctx:s}}}),{c(){Sn(a.$$.fragment),o=ir(),Sn(d.$$.fragment)},l(v){Zn(a.$$.fragment,v),o=nr(v),Zn(d.$$.fragment,v)},m(v,E){Cn(a,v,E),pi(v,o,E),Cn(d,v,E),_=!0},p(v,E){const r={};E&2097152&&(r.$$scope={dirty:E,ctx:v}),a.$set(r);const I={};E&2097152&&(I.$$scope={dirty:E,ctx:v}),d.$set(I)},i(v){_||(Ot(a.$$.fragment,v),Ot(d.$$.fragment,v),_=!0)},o(v){jt(a.$$.fragment,v),jt(d.$$.fragment,v),_=!1},d(v){Ln(a,v),v&&Tt(o),Ln(d,v)}}}function WS(s){let a;return{c(){a=co("download")},l(o){a=uo(o,"download")},m(o,d){pi(o,a,d)},d(o){o&&Tt(a)}}}function ZS(s){let a;return{c(){a=co("Download layer(s)")},l(o){a=uo(o,"Download layer(s)")},m(o,d){pi(o,a,d)},d(o){o&&Tt(a)}}}function XS(s){let a,o,d,_;return a=new a_({props:{class:"material-icons",$$slots:{default:[WS]},$$scope:{ctx:s}}}),d=new My({props:{$$slots:{default:[ZS]},$$scope:{ctx:s}}}),{c(){Sn(a.$$.fragment),o=ir(),Sn(d.$$.fragment)},l(v){Zn(a.$$.fragment,v),o=nr(v),Zn(d.$$.fragment,v)},m(v,E){Cn(a,v,E),pi(v,o,E),Cn(d,v,E),_=!0},p(v,E){const r={};E&2097152&&(r.$$scope={dirty:E,ctx:v}),a.$set(r);const I={};E&2097152&&(I.$$scope={dirty:E,ctx:v}),d.$set(I)},i(v){_||(Ot(a.$$.fragment,v),Ot(d.$$.fragment,v),_=!0)},o(v){jt(a.$$.fragment,v),jt(d.$$.fragment,v),_=!1},d(v){Ln(a,v),v&&Tt(o),Ln(d,v)}}}function KS(s){let a=s[3]?"check":"rule",o;return{c(){o=co(a)},l(d){o=uo(d,a)},m(d,_){pi(d,o,_)},p(d,_){_&8&&a!==(a=d[3]?"check":"rule")&&Sl(o,a)},d(d){d&&Tt(o)}}}function YS(s){let a;return{c(){a=co("Select layers")},l(o){a=uo(o,"Select layers")},m(o,d){pi(o,a,d)},d(o){o&&Tt(a)}}}function JS(s){let a,o,d,_;return a=new a_({props:{class:"material-icons",$$slots:{default:[KS]},$$scope:{ctx:s}}}),a.$on("click",s[12]),d=new My({props:{$$slots:{default:[YS]},$$scope:{ctx:s}}}),{c(){Sn(a.$$.fragment),o=ir(),Sn(d.$$.fragment)},l(v){Zn(a.$$.fragment,v),o=nr(v),Zn(d.$$.fragment,v)},m(v,E){Cn(a,v,E),pi(v,o,E),Cn(d,v,E),_=!0},p(v,E){const r={};E&2097160&&(r.$$scope={dirty:E,ctx:v}),a.$set(r);const I={};E&2097152&&(I.$$scope={dirty:E,ctx:v}),d.$set(I)},i(v){_||(Ot(a.$$.fragment,v),Ot(d.$$.fragment,v),_=!0)},o(v){jt(a.$$.fragment,v),jt(d.$$.fragment,v),_=!1},d(v){Ln(a,v),v&&Tt(o),Ln(d,v)}}}function QS(s){let a,o,d,_,v,E,r,I,R,U,V,Z,Y,W,te,ae,Ie,ye,Ue,je,_e,ct,lt,St,Bt;r=new fw({props:{class:"material-icons",$$slots:{default:[BS]},$$scope:{ctx:s}}});let et=s[1]&&Mx(s);return Z=new Xw({props:{list:s[6],key:null,$$slots:{default:[GS,({item:ot})=>({15:ot}),({item:ot})=>ot?32768:0]},$$scope:{ctx:s}}}),Z.$on("sort",s[7]),Ie=new Km({props:{$$slots:{default:[HS]},$$scope:{ctx:s}}}),_e=new Km({props:{$$slots:{default:[XS]},$$scope:{ctx:s}}}),St=new Km({props:{$$slots:{default:[JS]},$$scope:{ctx:s}}}),{c(){a=pn("div"),o=pn("div"),d=pn("span"),_=pn("h2"),v=co("Layers"),E=ir(),Sn(r.$$.fragment),I=ir(),R=pn("hr"),U=ir(),et&&et.c(),V=ir(),Sn(Z.$$.fragment),Y=ir(),W=pn("hr"),te=ir(),ae=pn("span"),Sn(Ie.$$.fragment),ye=ir(),Ue=pn("input"),je=ir(),Sn(_e.$$.fragment),ct=ir(),lt=pn("span"),Sn(St.$$.fragment),this.h()},l(ot){a=mn(ot,"DIV",{class:!0});var Nt=xn(a);o=mn(Nt,"DIV",{class:!0});var qt=xn(o);d=mn(qt,"SPAN",{class:!0});var _t=xn(d);_=mn(_t,"H2",{style:!0});var dt=xn(_);v=uo(dt,"Layers"),dt.forEach(Tt),E=nr(_t),Zn(r.$$.fragment,_t),_t.forEach(Tt),I=nr(qt),R=mn(qt,"HR",{class:!0}),U=nr(qt),et&&et.l(qt),V=nr(qt),Zn(Z.$$.fragment,qt),Y=nr(qt),W=mn(qt,"HR",{style:!0,class:!0}),te=nr(qt),ae=mn(qt,"SPAN",{class:!0});var ti=xn(ae);Zn(Ie.$$.fragment,ti),ye=nr(ti),Ue=mn(ti,"INPUT",{id:!0,type:!0,style:!0}),je=nr(ti),Zn(_e.$$.fragment,ti),ct=nr(ti),lt=mn(ti,"SPAN",{style:!0});var Vi=xn(lt);Zn(St.$$.fragment,Vi),Vi.forEach(Tt),ti.forEach(Tt),qt.forEach(Tt),Nt.forEach(Tt),this.h()},h(){Hm(_,"margin","0"),tn(d,"class","layer-title svelte-mi2azc"),tn(R,"class","svelte-mi2azc"),Hm(W,"margin-top","auto"),tn(W,"class","svelte-mi2azc"),tn(Ue,"id","file-upload"),Ue.multiple=!0,tn(Ue,"type","file"),Hm(Ue,"display","none"),Hm(lt,"margin-left","auto"),tn(ae,"class","file-action-row svelte-mi2azc"),tn(o,"class","content svelte-mi2azc"),tn(a,"class","container pulsating-border svelte-mi2azc")},m(ot,Nt){pi(ot,a,Nt),ln(a,o),ln(o,d),ln(d,_),ln(_,v),ln(d,E),Cn(r,d,null),ln(o,I),ln(o,R),ln(o,U),et&&et.m(o,null),ln(o,V),Cn(Z,o,null),ln(o,Y),ln(o,W),ln(o,te),ln(o,ae),Cn(Ie,ae,null),ln(ae,ye),ln(ae,Ue),s[11](Ue),ln(ae,je),Cn(_e,ae,null),ln(ae,ct),ln(ae,lt),Cn(St,lt,null),Bt=!0},p(ot,[Nt]){const qt={};Nt&2097152&&(qt.$$scope={dirty:Nt,ctx:ot}),r.$set(qt),ot[1]?et?(et.p(ot,Nt),Nt&2&&Ot(et,1)):(et=Mx(ot),et.c(),Ot(et,1),et.m(o,V)):et&&(Vs(),jt(et,1,1,()=>{et=null}),Gs());const _t={};Nt&64&&(_t.list=ot[6]),Nt&2129929&&(_t.$$scope={dirty:Nt,ctx:ot}),Z.$set(_t);const dt={};Nt&2097156&&(dt.$$scope={dirty:Nt,ctx:ot}),Ie.$set(dt);const ti={};Nt&2097152&&(ti.$$scope={dirty:Nt,ctx:ot}),_e.$set(ti);const Vi={};Nt&2097160&&(Vi.$$scope={dirty:Nt,ctx:ot}),St.$set(Vi)},i(ot){Bt||(Ot(r.$$.fragment,ot),Ot(et),Ot(Z.$$.fragment,ot),Ot(Ie.$$.fragment,ot),Ot(_e.$$.fragment,ot),Ot(St.$$.fragment,ot),Bt=!0)},o(ot){jt(r.$$.fragment,ot),jt(et),jt(Z.$$.fragment,ot),jt(Ie.$$.fragment,ot),jt(_e.$$.fragment,ot),jt(St.$$.fragment,ot),Bt=!1},d(ot){ot&&Tt(a),Ln(r),et&&et.d(),Ln(Z),Ln(Ie),s[11](null),Ln(_e),Ln(St)}}}const $S=s=>`${s?s.id:""}`,eC=s=>`${s?s.id:""}`;function tC(s,a,o){let d;Vu(s,Rc,ye=>o(6,d=ye));let{map:_}=a,{selectedTool:v}=a;const E=ye=>{const{newList:Ue,from:je,to:_e}=ye.detail,ct=Ue[_e];Rc.set(Ue),Rc.setNewLayerIndex({layerId:ct,index:parseInt(_e)})};let r,I,R=!1;async function U(ye){const Ue=ye.target;if(Ue.files&&Ue.files.length>0){I=Ue.files;const je=await uA(I);Rx.add(je),Ue.value=""}}ic(()=>{r.addEventListener("change",U)});let V,Z;function Y(ye){V=ye,o(4,V)}function W(ye){Z=ye,o(5,Z)}const te=()=>r.click();function ae(ye){Dr[ye?"unshift":"push"](()=>{r=ye,o(2,r)})}const Ie=()=>{o(3,R=!R)};return s.$$set=ye=>{"map"in ye&&o(0,_=ye.map),"selectedTool"in ye&&o(1,v=ye.selectedTool)},[_,v,r,R,V,Z,d,E,Y,W,te,ae,Ie]}class iC extends gs{constructor(a){super(),ys(this,a,tC,QS,ts,{map:0,selectedTool:1})}}function nC(s){let a,o,d,_,v,E=s[1].toUpperCase()+"",r,I,R;return{c(){a=pn("button"),o=pn("img"),_=ir(),v=pn("p"),r=co(E),this.h()},l(U){a=mn(U,"BUTTON",{class:!0});var V=xn(a);o=mn(V,"IMG",{class:!0,alt:!0,src:!0}),_=nr(V),v=mn(V,"P",{class:!0});var Z=xn(v);r=uo(Z,E),Z.forEach(Tt),V.forEach(Tt),this.h()},h(){tn(o,"class","button-icon svelte-dbbhwe"),tn(o,"alt","button"),gy(o.src,d=s[2]||"button-icons/intersection.png")||tn(o,"src",d),tn(v,"class","svelte-dbbhwe"),tn(a,"class","svelte-dbbhwe"),_y(a,"selected",s[0])},m(U,V){pi(U,a,V),ln(a,o),ln(a,_),ln(a,v),ln(v,r),I||(R=xo(a,"click",s[3]),I=!0)},p(U,[V]){V&4&&!gy(o.src,d=U[2]||"button-icons/intersection.png")&&tn(o,"src",d),V&2&&E!==(E=U[1].toUpperCase()+"")&&Sl(r,E),V&1&&_y(a,"selected",U[0])},i:ju,o:ju,d(U){U&&Tt(a),I=!1,R()}}}function rC(s,a,o){let{name:d}=a,{iconPath:_}=a,{selected:v=!1}=a;const E=Px();function r(){o(0,v=!v),E("toolSelected",v?d:null)}return s.$$set=I=>{"name"in I&&o(1,d=I.name),"iconPath"in I&&o(2,_=I.iconPath),"selected"in I&&o(0,v=I.selected)},[v,d,_,r]}class sC extends gs{constructor(a){super(),ys(this,a,rC,nC,ts,{name:1,iconPath:2,selected:0})}}function Lx(s,a,o){const d=s.slice();return d[4]=a[o],d}function Dx(s){let a,o;const d=[s[4],{selected:s[4].name===s[0]}];let _={};for(let v=0;v<d.length;v+=1)_=Ai(_,d[v]);return a=new sC({props:_}),a.$on("toolSelected",s[3]),{c(){Sn(a.$$.fragment)},l(v){Zn(a.$$.fragment,v)},m(v,E){Cn(a,v,E),o=!0},p(v,E){const r=E&3?yr(d,[E&2&&ms(v[4]),{selected:v[4].name===v[0]}]):{};a.$set(r)},i(v){o||(Ot(a.$$.fragment,v),o=!0)},o(v){jt(a.$$.fragment,v),o=!1},d(v){Ln(a,v)}}}function oC(s){let a,o,d=s[1],_=[];for(let E=0;E<d.length;E+=1)_[E]=Dx(Lx(s,d,E));const v=E=>jt(_[E],1,1,()=>{_[E]=null});return{c(){a=pn("div");for(let E=0;E<_.length;E+=1)_[E].c();this.h()},l(E){a=mn(E,"DIV",{class:!0});var r=xn(a);for(let I=0;I<_.length;I+=1)_[I].l(r);r.forEach(Tt),this.h()},h(){tn(a,"class","container svelte-1lqfry2")},m(E,r){pi(E,a,r);for(let I=0;I<_.length;I+=1)_[I]&&_[I].m(a,null);o=!0},p(E,[r]){if(r&3){d=E[1];let I;for(I=0;I<d.length;I+=1){const R=Lx(E,d,I);_[I]?(_[I].p(R,r),Ot(_[I],1)):(_[I]=Dx(R),_[I].c(),Ot(_[I],1),_[I].m(a,null))}for(Vs(),I=d.length;I<_.length;I+=1)v(I);Gs()}},i(E){if(!o){for(let r=0;r<d.length;r+=1)Ot(_[r]);o=!0}},o(E){_=_.filter(Boolean);for(let r=0;r<_.length;r+=1)jt(_[r]);o=!1},d(E){E&&Tt(a),Uv(_,E)}}}function aC(s,a,o){let{map:d}=a,{selectedTool:_}=a;const v=[{name:"bbox",iconPath:"button-icons/bbox.png"},{name:"buffer",iconPath:"button-icons/buffer.png"},{name:"clip",iconPath:"button-icons/clip.png"},{name:"difference",iconPath:"button-icons/difference.png"},{name:"intersect",iconPath:"button-icons/intersection.png"},{name:"union",iconPath:"button-icons/union.png"},{name:"voronoi",iconPath:"button-icons/vornoi.png"}];function E(r){Jm.call(this,s,r)}return s.$$set=r=>{"map"in r&&o(2,d=r.map),"selectedTool"in r&&o(0,_=r.selectedTool)},[_,v,d,E]}class lC extends gs{constructor(a){super(),ys(this,a,aC,oC,ts,{map:2,selectedTool:0})}}function cC(s){let a,o,d,_,v,E,r;return _=new iC({props:{map:s[0],selectedTool:s[1]}}),E=new lC({props:{map:s[0],selectedTool:s[1]}}),E.$on("toolSelected",s[2]),{c(){a=pn("div"),o=ir(),d=pn("div"),Sn(_.$$.fragment),v=ir(),Sn(E.$$.fragment),this.h()},l(I){a=mn(I,"DIV",{id:!0,class:!0}),xn(a).forEach(Tt),o=nr(I),d=mn(I,"DIV",{id:!0,class:!0});var R=xn(d);Zn(_.$$.fragment,R),v=nr(R),Zn(E.$$.fragment,R),R.forEach(Tt),this.h()},h(){tn(a,"id","map"),tn(a,"class","svelte-7s216m"),tn(d,"id","overlay"),tn(d,"class","svelte-7s216m")},m(I,R){pi(I,a,R),pi(I,o,R),pi(I,d,R),Cn(_,d,null),ln(d,v),Cn(E,d,null),r=!0},p(I,[R]){const U={};R&1&&(U.map=I[0]),R&2&&(U.selectedTool=I[1]),_.$set(U);const V={};R&1&&(V.map=I[0]),R&2&&(V.selectedTool=I[1]),E.$set(V)},i(I){r||(Ot(_.$$.fragment,I),Ot(E.$$.fragment,I),r=!0)},o(I){jt(_.$$.fragment,I),jt(E.$$.fragment,I),r=!1},d(I){I&&Tt(a),I&&Tt(o),I&&Tt(d),Ln(_),Ln(E)}}}function uC(s,a,o){let d;Vu(s,Rc,R=>o(4,d=R));let _,v;const E={type:"Feature",properties:{capacity:"10",type:"U-Rack",mount:"Surface"},geometry:{type:"Point",coordinates:[-71.073283,42.4175]}},r={type:"GeometryCollection",geometries:[{type:"MultiPolygon",coordinates:[[[[-73,45],[-76,46],[-75,47],[-73,45]]],[[[-70,42],[-73,43],[-72,44],[-70,42]]]]},{type:"MultiPoint",coordinates:[[-72,44],[-75,45],[-74,46]]}]};return ic(()=>{f1.accessToken="pk.eyJ1Ijoia29ob2xtIiwiYSI6ImNremUzM2tsMzJmZWsybm54d20xazFicWQifQ.uZRVptXit_O5hkkSFBKXug",o(0,_=new f1.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[10.345053,63.430515],zoom:11})),new Nb({displayControlsDefault:!1,controls:{point:!0,line_string:!0,polygon:!0,trash:!0},defaultMode:"draw_polygon"}),_.on("load",function(){Rc.subscribeNewLayerIndex(U=>{if(!U)return;const{index:V}=U,Z=d[V],Y=d[V-1];Y?_.moveLayer(Z.id,Y.id):_.moveLayer(Z.id)}),uy(_,{id:"source",geojson:{type:"geojson",data:r}}),_.addSource("point-source",{type:"geojson",data:E}),uy(_,{id:"point-source",geojson:{type:"geojson",data:E}})}),Rc.subscribe(R=>{R.forEach(U=>{_.getLayer(U.id)&&_.setLayoutProperty(U.id,"visibility",U.isVisible?"visible":"none")})})}),Rx.subscribe(R=>{R.forEach(U=>{if(_.getSource(U.id))return;const V=U.geojson.data;if(!o_(V))return;const Z={type:"geojson",data:V};_.addSource(U.id,Z),uy(_,U)})}),[_,v,R=>o(1,v=R.detail)]}let hC=class extends gs{constructor(a){super(),ys(this,a,uC,cC,ts,{})}};function dC(s){let a,o;return a=new hC({}),a.$on("variableUpdated",s[0]),{c(){Sn(a.$$.fragment)},l(d){Zn(a.$$.fragment,d)},m(d,_){Cn(a,d,_),o=!0},p:ju,i(d){o||(Ot(a.$$.fragment,d),o=!0)},o(d){jt(a.$$.fragment,d),o=!1},d(d){Ln(a,d)}}}function fC(s){function a(o){Jm.call(this,s,o)}return[a]}class gC extends gs{constructor(a){super(),ys(this,a,fC,dC,ts,{})}}export{gC as component};
