var M0=Object.defineProperty;var D0=(D,x,g)=>x in D?M0(D,x,{enumerable:!0,configurable:!0,writable:!0,value:g}):D[x]=g;var $y=(D,x,g)=>(D0(D,typeof x!="symbol"?x+"":x,g),g);import{S as Os,i as Rs,s as Qo,k as Yn,l as Jn,m as xr,h as Xt,n as wn,b as Ni,H as Nl,o as Dy,J as y0,K as id,L as v0,M as L0,N as P0,C as fc,O as Qn,P as gf,G as bn,Q as Hc,D as pc,E as mc,F as _c,R as hc,T as od,g as xi,d as wi,U as xf,V as Jo,W as Ou,X as uc,I as Cp,Y as x0,Z as Ly,_ as $c,w as dc,e as Ir,v as Ru,f as zu,$ as rd,x as Xc,y as Tn,z as qn,A as En,a0 as ll,B as An,a1 as A_,a2 as O0,a3 as R0,a4 as Xy,a as yr,c as vr,a5 as z0,a6 as Ky,a7 as k0,a8 as B0,a9 as F0,aa as N0,ab as U0,ac as V0,ad as G0,q as Oa,r as Ra,u as Py,ae as Ey,p as m_}from"../chunks/index.2ac1c35c.js";import{w as Ay}from"../chunks/index.cec85b4b.js";var cc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function j0(D){return D&&D.__esModule&&Object.prototype.hasOwnProperty.call(D,"default")?D.default:D}var Sy={},W0={get exports(){return Sy},set exports(D){Sy=D}};(function(D,x){(function(g,M){D.exports=M()})(cc,function(){var g,M,P;function N(o,B){if(!g)g=B;else if(!M)M=B;else{var ce="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+g+")(sharedChunk); ("+M+")(sharedChunk); self.onerror = null;",_e={};g(_e),P=B(_e),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(P.workerUrl=window.URL.createObjectURL(new Blob([ce],{type:"text/javascript"})))}}N(["exports"],function(o){var B=typeof self<"u"?self:{},ce="2.13.0";let _e;const de={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(_e==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{_e={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{_e=t}}return _e},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Re={supported:!1,testSupport:function(t){!qe&&Ce&&(rt?Je(t):tt=t)}};let tt,Ce,qe=!1,rt=!1;function Je(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ce),t.isContextLost())return;Re.supported=!0}catch{}t.deleteTexture(e),qe=!0}B.document&&(Ce=B.document.createElement("img"),Ce.onload=function(){tt&&Je(tt),tt=null,rt=!0},Ce.onerror=function(){qe=!0,tt=null},Ce.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Qe="01";var Mt=lt;function lt(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}lt.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var a=this.sampleCurveX(i)-t;if(Math.abs(a)<e)return i;var u=this.sampleCurveDerivativeX(i);if(Math.abs(u)<1e-6)break;i-=a/u}var d=0,m=1;for(i=t,r=0;r<20&&(a=this.sampleCurveX(i),!(Math.abs(a-t)<e));r++)t>a?d=i:m=i,i=.5*(m-d)+d;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var $e=Wt;function Wt(t,e){this.x=t,this.y=e}Wt.prototype={clone:function(){return new Wt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),a=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Wt.convert=function(t){return t instanceof Wt?t:Array.isArray(t)?new Wt(t[0],t[1]):t};const ti=Math.PI/180,Pi=180/Math.PI;function Ht(t){return t*ti}function Ut(t){return t*Pi}const qt=[[0,0],[1,0],[1,1],[0,1]];function Ti(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function ki(t,e,i,r){const a=new Mt(t,e,i,r);return function(u){return a.solve(u)}}const fn=ki(.25,.1,.25,1);function ii(t,e,i){return Math.min(i,Math.max(e,t))}function Mn(t,e,i){return(i=ii((i-t)/(e-t),0,1))*i*(3-2*i)}function pn(t,e,i){const r=i-e,a=((t-e)%r+r)%r+e;return a===e?i:a}function nn(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const a=new Array(t.length);let u=null;t.forEach((d,m)=>{e(d,(y,v)=>{y&&(u=y),a[m]=v,--r==0&&i(u,a)})})}function Kt(t){const e=[];for(const i in t)e.push(t[i]);return e}function rn(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}let en=1;function Wr(){return en++}function or(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Zn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function no(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Rr(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function hn(t,e){return t.indexOf(e,t.length-e.length)!==-1}function fi(t,e,i){const r={};for(const a in t)r[a]=e.call(i||this,t[a],a,t);return r}function Yr(t,e,i){const r={};for(const a in t)e.call(i||this,t[a],a,t)&&(r[a]=t[a]);return r}function zr(t){return Array.isArray(t)?t.map(zr):typeof t=="object"&&t?fi(t,zr):t}const Bt={};function Oi(t){Bt[t]||(typeof console<"u"&&console.warn(t),Bt[t]=!0)}function ro(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Gt(t){let e=0;for(let i,r,a=0,u=t.length,d=u-1;a<u;d=a++)i=t[a],r=t[d],e+=(r.x-i.x)*(i.y+r.y);return e}function Cr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function kr(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,a,u)=>{const d=a||u;return e[r]=!d||d.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let oo=null;function Wo(t){if(oo==null){const e=t.navigator?t.navigator.userAgent:null;oo=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return oo}function ka(t){try{const e=B[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function tn(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const dr="mapbox-tiles";let Br,Le,ri=500,br=50;function zs(){try{return B.caches}catch{}}function Jr(){zs()&&!Br&&(Br=B.caches.open(dr))}function vo(t){const e=t.indexOf("?");if(e<0)return t;const i=function(a){const u=a.indexOf("?");return u>0?a.slice(u+1).split("&"):[]}(t),r=i.filter(a=>{const u=a.split("=");return u[0]==="language"||u[0]==="worldview"});return r.length?`${t.slice(0,e)}?${r.join("&")}`:t.slice(0,e)}let es=1/0;const ts={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(ts);class so extends Error{constructor(e,i,r){i===401&&aa(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ba=Cr()?()=>self.worker&&self.worker.referrer:()=>(B.location.protocol==="blob:"?B.parent:B).location.href,ao=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Ba())&&!/^\w+:/.test(i))){if(B.fetch&&B.Request&&B.AbortController&&B.Request.prototype.hasOwnProperty("signal"))return function(r,a){const u=new B.AbortController,d=new B.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:Ba(),signal:u.signal});let m=!1,y=!1;const v=(A=d.url).indexOf("sku=")>0&&aa(A);var A;r.type==="json"&&d.headers.set("Accept","application/json");const I=(k,F,G)=>{if(y)return;if(k&&k.message!=="SecurityError"&&Oi(k),F&&G)return L(F);const X=Date.now();B.fetch(d).then(se=>{if(se.ok){const pe=v?se.clone():null;return L(se,pe,X)}return a(new so(se.statusText,se.status,r.url))}).catch(se=>{se.name!=="AbortError"&&a(new Error(`${se.message} ${r.url}`))})},L=(k,F,G)=>{(r.type==="arrayBuffer"?k.arrayBuffer():r.type==="json"?k.json():k.text()).then(X=>{y||(F&&G&&function(se,pe,re){if(Jr(),!Br)return;const fe={status:pe.status,statusText:pe.statusText,headers:new B.Headers};pe.headers.forEach((We,Ge)=>fe.headers.set(Ge,We));const xe=kr(pe.headers.get("Cache-Control")||"");if(xe["no-store"])return;xe["max-age"]&&fe.headers.set("Expires",new Date(re+1e3*xe["max-age"]).toUTCString());const ye=fe.headers.get("Expires");ye&&(new Date(ye).getTime()-re<42e4||function(We,Ge){if(Le===void 0)try{new Response(new ReadableStream),Le=!0}catch{Le=!1}Le?Ge(We.body):We.blob().then(Ge)}(pe,We=>{const Ge=new B.Response(We,fe);Jr(),Br&&Br.then(nt=>nt.put(vo(se.url),Ge)).catch(nt=>Oi(nt.message))}))}(d,F,G),m=!0,a(null,X,k.headers.get("Cache-Control"),k.headers.get("Expires")))}).catch(X=>{y||a(new Error(X.message))})};return v?function(k,F){if(Jr(),!Br)return F(null);const G=vo(k.url);Br.then(X=>{X.match(G).then(se=>{const pe=function(re){if(!re)return!1;const fe=new Date(re.headers.get("Expires")||0),xe=kr(re.headers.get("Cache-Control")||"");return fe>Date.now()&&!xe["no-cache"]}(se);X.delete(G),pe&&X.put(G,se.clone()),F(null,se,pe)}).catch(F)}).catch(F)}(d,I):I(null,null),{cancel:()=>{y=!0,m||u.abort()}}}(t,e);if(Cr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(r,a){const u=new B.XMLHttpRequest;u.open(r.method||"GET",r.url,!0),r.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const d in r.headers)u.setRequestHeader(d,r.headers[d]);return r.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=r.credentials==="include",u.onerror=()=>{a(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let d=u.response;if(r.type==="json")try{d=JSON.parse(u.response)}catch(m){return a(m)}a(null,d,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else a(new so(u.statusText,u.status,r.url))},u.send(r.body),{cancel:()=>u.abort()}}(t,e)},is=function(t,e){return ao(rn(t,{type:"arrayBuffer"}),e)};function qo(t){const e=B.document.createElement("a");return e.href=t,e.protocol===B.document.location.protocol&&e.host===B.document.location.host}const ks="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ns,qr;ns=[],qr=0;const Bs=function(t,e){if(Re.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),qr>=de.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ns.push(u),u}qr++;let i=!1;const r=()=>{if(!i)for(i=!0,qr--;ns.length&&qr<de.MAX_PARALLEL_IMAGE_REQUESTS;){const u=ns.shift(),{requestParameters:d,callback:m,cancelled:y}=u;y||(u.cancel=Bs(d,m).cancel)}},a=is(t,(u,d,m,y)=>{r(),u?e(u):d&&(B.createImageBitmap?function(v,A){const I=new B.Blob([new Uint8Array(v)],{type:"image/png"});B.createImageBitmap(I).then(L=>{A(null,L)}).catch(L=>{A(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(v,A)=>e(v,A,m,y)):function(v,A){const I=new B.Image,L=B.URL;I.onload=()=>{A(null,I),L.revokeObjectURL(I.src),I.onload=null,B.requestAnimationFrame(()=>{I.src=ks})},I.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const k=new B.Blob([new Uint8Array(v)],{type:"image/png"});I.src=v.byteLength?L.createObjectURL(k):ks}(d,(v,A)=>e(v,A,m,y)))});return{cancel:()=>{a.cancel(),r()}}},Fa="NO_ACCESS_TOKEN";function Io(t){return t.indexOf("mapbox:")===0}function aa(t){return de.API_URL_REGEX.test(t)}function gc(t){return de.API_CDN_URL_REGEX.test(t)}function yc(t){return de.API_STYLE_REGEX.test(t)&&!Fs(t)}function Fs(t){return de.API_SPRITE_REGEX.test(t)}const Na=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qr(t){const e=t.match(Na);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function la(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function lo(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(B.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ca{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=lo(de.ACCESS_TOKEN);let r="";return r=i&&i.u?B.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(a,u)=>String.fromCharCode(+("0x"+u)))):de.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${r}`:`mapbox.eventData:${r}`}fetchEventData(){const e=ka("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const a=B.localStorage.getItem(i);a&&(this.eventData=JSON.parse(a));const u=B.localStorage.getItem(r);u&&(this.anonId=u)}catch{Oi("Unable to read from LocalStorage")}}saveEventData(){const e=ka("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{B.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&B.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Oi("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,r,a){if(!de.EVENTS_URL)return;const u=Qr(de.EVENTS_URL);u.params.push(`access_token=${a||de.ACCESS_TOKEN||""}`);const d={event:this.type,created:new Date(e).toISOString()},m=i?rn(d,i):d,y={url:la(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([m])};this.pendingRequest=function(v,A){return ao(rn(v,{method:"POST"}),A)}(y,v=>{this.pendingRequest=null,r(v),this.saveEventData(),this.processRequests(a)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const ne=new class extends ca{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){de.EVENTS_URL&&de.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>Io(i)||aa(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=lo(de.ACCESS_TOKEN),i=e?e.u:de.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;no(this.anonId)||(this.anonId=or(),r=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const u=new Date(this.eventData.lastSuccess),d=new Date(a),m=(a-this.eventData.lastSuccess)/864e5;r=r||m>=1||m<-1||u.getDate()!==d.getDate()}else r=!0;r?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ce,skuId:Qe,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=a,this.eventData.tokenU=i)},t):this.processRequests()}},V=ne.postTurnstileEvent.bind(ne),j=new class extends ca{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,de.EVENTS_URL&&(i||de.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Fa)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),no(this.anonId)||(this.anonId=or()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ce,skuId:Qe,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t))}},ie=j.postMapLoadEvent.bind(j),ue=new class extends ca{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){de.EVENTS_URL&&(t||de.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),r=function(a){const u=B.performance.getEntriesByType("resource"),d=B.performance.getEntriesByType("mark"),m=function(L){const k={};if(L){for(const F in L)if(F!=="other")for(const G of L[F]){const X=`${F}ResolveRangeMin`,se=`${F}ResolveRangeMax`,pe=`${F}RequestCount`,re=`${F}RequestCachedCount`;k[X]=Math.min(k[X]||1/0,G.startTime),k[se]=Math.max(k[se]||-1/0,G.responseEnd);const fe=xe=>{k[xe]===void 0&&(k[xe]=0),++k[xe]};G.transferSize!==void 0&&G.transferSize===0&&fe(re),fe(pe)}}return k}(function(L,k){const F={};if(L)for(const G of L){const X=k(G);F[X]===void 0&&(F[X]=[]),F[X].push(G)}return F}(u,Dt)),y=B.devicePixelRatio,v=B.navigator.connection||B.navigator.mozConnection||B.navigator.webkitConnection,A={counters:[],metadata:[],attributes:[]},I=(L,k,F)=>{F!=null&&L.push({name:k,value:F.toString()})};for(const L in m)I(A.counters,L,m[L]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(I(A.counters,"interactionRangeMin",a.interactionRange[0]),I(A.counters,"interactionRangeMax",a.interactionRange[1])),d)for(const L of Object.keys(Ue)){const k=Ue[L],F=d.find(G=>G.name===k);F&&I(A.counters,k,F.startTime)}return I(A.counters,"visibilityHidden",a.visibilityHidden),I(A.attributes,"style",function(L){if(L)for(const k of L){const F=k.name.split("?")[0];if(yc(F)){const G=F.split("/").slice(-2);if(G.length===2)return`mapbox://styles/${G[0]}/${G[1]}`}}}(u)),I(A.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),I(A.attributes,"fogEnabled",a.fogEnabled?"true":"false"),I(A.attributes,"projection",a.projection),I(A.attributes,"zoom",a.zoom),I(A.metadata,"devicePixelRatio",y),I(A.metadata,"connectionEffectiveType",v?v.effectiveType:void 0),I(A.metadata,"navigatorUserAgent",B.navigator.userAgent),I(A.metadata,"screenWidth",B.screen.width),I(A.metadata,"screenHeight",B.screen.height),I(A.metadata,"windowWidth",B.innerWidth),I(A.metadata,"windowHeight",B.innerHeight),I(A.metadata,"mapWidth",a.width/y),I(A.metadata,"mapHeight",a.height/y),I(A.metadata,"webglRenderer",a.renderer),I(A.metadata,"webglVendor",a.vendor),I(A.metadata,"sdkVersion",ce),I(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(i);for(const a of r.metadata);for(const a of r.counters);for(const a of r.attributes);this.postEvent(e,r,()=>{},t)}},be=ue.postPerformanceEvent.bind(ue),ze=new class extends ca{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!de.API_URL||!de.SESSION_PATH)return;const a=Qr(de.API_URL+de.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${r||de.ACCESS_TOKEN||""}`);const u={url:la(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(d,m){return ao(rn(d,{method:"GET"}),m)}(u,d=>{this.pendingRequest=null,i(d),this.saveEventData(),this.processRequests(r)})}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,de.SESSION_PATH&&de.API_URL&&(i||de.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Fa)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t)}},Me=ze.getSessionAPI.bind(ze),Ae=new Set,Ue={create:"create",load:"load",fullLoad:"fullLoad"},ht={mark(t){B.performance.mark(t)},measure(t,e,i){B.performance.measure(t,e,i)}};function Dt(t){const e=t.name.split("?")[0];return gc(e)&&e.includes("mapbox-gl.js")?"javascript":gc(e)&&e.includes("mapbox-gl.css")?"css":function(i){return de.API_FONTS_REGEX.test(i)}(e)?"fontRange":Fs(e)?"sprite":yc(e)?"style":function(i){return de.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const yt=B.performance;function ni(t){const e=t?t.url.toString():void 0;return yt.getEntriesByName(e)}let Jt,Qt,ai,oi;const Hi={now:()=>ai!==void 0?ai:B.performance.now(),setNow(t){ai=t},restoreNow(){ai=void 0},frame(t){const e=B.requestAnimationFrame(t);return{cancel:()=>B.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:r}=t;oi||(oi=B.document.createElement("canvas"));const a=oi.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>oi.width||r>oi.height)&&(oi.width=i,oi.height=r),a.clearRect(-e,-e,i+2*e,r+2*e),a.drawImage(t,0,0,i,r),a.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:t=>(Jt||(Jt=B.document.createElement("a")),Jt.href=t,Jt.href),get devicePixelRatio(){return B.devicePixelRatio},get prefersReducedMotion(){return!!B.matchMedia&&(Qt==null&&(Qt=B.matchMedia("(prefers-reduced-motion: reduce)")),Qt.matches)}};function li(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function Vi(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);r!==-1&&i[t].splice(r,1)}}class Wi{constructor(e,i={}){rn(this,i),this.type=e}}class rs extends Wi{constructor(e,i={}){super("error",rn({error:e},i))}}class co{on(e,i){return this._listeners=this._listeners||{},li(e,i,this._listeners),this}off(e,i){return Vi(e,i,this._listeners),Vi(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},li(e,i,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,i){typeof e=="string"&&(e=new Wi(e,i||{}));const r=e.type;if(this.listens(r)){e.target=this;const a=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const m of a)m.call(this,e);const u=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const m of u)Vi(r,m,this._oneTimeListeners),m.call(this,e);const d=this._eventedParent;d&&(rn(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof rs&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Ye=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function os(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}function sr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ua(t){if(Array.isArray(t))return t.map(ua);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=ua(t[i]);return e}return sr(t)}class Bu extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var ss=Bu;class Ns{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[r,a]of i)this.bindings[r]=a}concat(e){return new Ns(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Yc=Ns;const ha={kind:"null"},At={kind:"number"},Bi={kind:"string"},Ui={kind:"boolean"},xo={kind:"color"},T={kind:"object"},C={kind:"value"},H={kind:"collator"},he={kind:"formatted"},Ee={kind:"resolvedImage"};function Te(t,e){return{kind:"array",itemType:t,N:e}}function Ie(t){if(t.kind==="array"){const e=Ie(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const wt=[ha,At,Bi,Ui,xo,he,T,Te(C),Ee];function xt(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!xt(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of wt)if(!xt(i,e))return null}}return`Expected ${Ie(t)} but found ${Ie(e)} instead.`}function Ft(t,e){return e.some(i=>i.kind===t.kind)}function St(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}var Lt,_i={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function kn(t){return(t=Math.round(t))<0?0:t>255?255:t}function gi(t){return kn(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Gn(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function dt(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{Lt={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in _i)return _i[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),a=i.indexOf(")");if(r!==-1&&a+1===i.length){var u=i.substr(0,r),d=i.substr(r+1,a-(r+1)).split(","),m=1;switch(u){case"rgba":if(d.length!==4)return null;m=Gn(d.pop());case"rgb":return d.length!==3?null:[gi(d[0]),gi(d[1]),gi(d[2]),m];case"hsla":if(d.length!==4)return null;m=Gn(d.pop());case"hsl":if(d.length!==3)return null;var y=(parseFloat(d[0])%360+360)%360/360,v=Gn(d[1]),A=Gn(d[2]),I=A<=.5?A*(v+1):A+v-A*v,L=2*A-I;return[kn(255*dt(L,I,y+1/3)),kn(255*dt(L,I,y)),kn(255*dt(L,I,y-1/3)),m];default:return null}}return null}}catch{}class Nt{constructor(e,i,r,a=1){this.r=e,this.g=i,this.b=r,this.a=a}static parse(e){if(!e)return;if(e instanceof Nt)return e;if(typeof e!="string")return;const i=Lt(e);return i?new Nt(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,r,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${a})`}toArray(){const{r:e,g:i,b:r,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*i/a,255*r/a,a]}toArray01(){const{r:e,g:i,b:r,a}=this;return a===0?[0,0,0,0]:[e/a,i/a,r/a,a]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:r,a}=this;return[e,i,r,a]}}Nt.black=new Nt(0,0,0,1),Nt.white=new Nt(1,1,1,1),Nt.transparent=new Nt(0,0,0,0),Nt.red=new Nt(1,0,0,1),Nt.blue=new Nt(0,0,1,1);var bi=Nt;class fr{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class er{constructor(e,i,r,a,u){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=a,this.textColor=u}}class Zr{constructor(e){this.sections=e}static fromString(e){return new Zr([new er(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Zr?e:Zr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(r)}return e}}class uo{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new uo({name:e,available:!1}):null}serialize(){return["image",this.name]}}function jn(t,e,i,r){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?r===void 0||typeof r=="number"&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof r=="number"?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ul(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof bi||t instanceof fr||t instanceof Zr||t instanceof uo)return!0;if(Array.isArray(t)){for(const e of t)if(!Ul(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Ul(t[e]))return!1;return!0}return!1}function wr(t){if(t===null)return ha;if(typeof t=="string")return Bi;if(typeof t=="boolean")return Ui;if(typeof t=="number")return At;if(t instanceof bi)return xo;if(t instanceof fr)return H;if(t instanceof Zr)return he;if(t instanceof uo)return Ee;if(Array.isArray(t)){const e=t.length;let i;for(const r of t){const a=wr(r);if(i){if(i===a)continue;i=C;break}i=a}return Te(i||C,e)}return T}function ho(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof bi||t instanceof Zr||t instanceof uo?t.toString():JSON.stringify(t)}class vc{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ul(e[1]))return i.error("invalid value");const r=e[1];let a=wr(r);const u=i.expectedType;return a.kind!=="array"||a.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(a=u),new vc(a,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof bi?["rgba"].concat(this.value.toArray()):this.value instanceof Zr?this.value.serialize():this.value}}var cl=vc,Fr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const ul={string:Bi,number:At,boolean:Ui,object:T};class Ua{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,a=1;const u=e[0];if(u==="array"){let m,y;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in ul)||v==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);m=ul[v],a++}else m=C;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);y=e[2],a++}r=Te(m,y)}else r=ul[u];const d=[];for(;a<e.length;a++){const m=i.parse(e[a],a,C);if(!m)return null;d.push(m)}return new Ua(r,d)}evaluate(e){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(e);if(!xt(this.type,wr(r)))return r;if(i===this.args.length-1)throw new Fr(`Expected value to be of type ${Ie(this.type)}, but found ${Ie(wr(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){i.push(r.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(r=>r.serialize()))}}var ln=Ua;class Sn{constructor(e){this.type=he,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&typeof r=="object")return i.error("First argument must be an image or text section.");const a=[];let u=!1;for(let d=1;d<=e.length-1;++d){const m=e[d];if(u&&typeof m=="object"&&!Array.isArray(m)){u=!1;let y=null;if(m["font-scale"]&&(y=i.parse(m["font-scale"],1,At),!y))return null;let v=null;if(m["text-font"]&&(v=i.parse(m["text-font"],1,Te(Bi)),!v))return null;let A=null;if(m["text-color"]&&(A=i.parse(m["text-color"],1,xo),!A))return null;const I=a[a.length-1];I.scale=y,I.font=v,I.textColor=A}else{const y=i.parse(e[d],1,C);if(!y)return null;const v=y.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,a.push({content:y,scale:null,font:null,textColor:null})}}return new Sn(a)}evaluate(e){return new Zr(this.sections.map(i=>{const r=i.content.evaluate(e);return wr(r)===Ee?new er("",r,null,null,null):new er(ho(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class xc{constructor(e){this.type=Ee,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const r=i.parse(e[1],1,Bi);return r?new xc(r):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),r=uo.fromString(i);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(i)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const dh={"to-boolean":Ui,"to-color":xo,"to-number":At,"to-string":Bi};class bc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return i.error("Expected one argument.");const a=dh[r],u=[];for(let d=1;d<e.length;d++){const m=i.parse(e[d],d,C);if(!m)return null;u.push(m)}return new bc(a,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,r;for(const a of this.args){if(i=a.evaluate(e),r=null,i instanceof bi)return i;if(typeof i=="string"){const u=e.parseColor(i);if(u)return u}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:jn(i[0],i[1],i[2],i[3]),!r))return new bi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Fr(r||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const r of this.args){if(i=r.evaluate(e),i===null)return 0;const a=Number(i);if(!isNaN(a))return a}throw new Fr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Zr.fromString(ho(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?uo.fromString(ho(this.args[0].evaluate(e))):ho(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Sn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new xc(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Va=bc;const Jc=["Unknown","Point","LineString","Polygon"];var Vl=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Jc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=bi.parse(t)),e}};class Ga{constructor(e,i,r,a){this.name=e,this.type=i,this._evaluate=r,this.args=a}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const r=e[0],a=Ga.definitions[r];if(!a)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(a)?a[0]:a.type,d=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,m=d.filter(([v])=>!Array.isArray(v)||v.length===e.length-1);let y=null;for(const[v,A]of m){y=new eu(i.registry,i.path,null,i.scope);const I=[];let L=!1;for(let k=1;k<e.length;k++){const F=e[k],G=Array.isArray(v)?v[k-1]:v.type,X=y.parse(F,1+I.length,G);if(!X){L=!0;break}I.push(X)}if(!L)if(Array.isArray(v)&&v.length!==I.length)y.error(`Expected ${v.length} arguments, but found ${I.length} instead.`);else{for(let k=0;k<I.length;k++){const F=Array.isArray(v)?v[k]:v.type,G=I[k];y.concat(k+1).checkSubtype(F,G.type)}if(y.errors.length===0)return new Ga(r,u,A,I)}}if(m.length===1)i.errors.push(...y.errors);else{const v=(m.length?m:d).map(([I])=>{return L=I,Array.isArray(L)?`(${L.map(Ie).join(", ")})`:`(${Ie(L.type)}...)`;var L}).join(" | "),A=[];for(let I=1;I<e.length;I++){const L=i.parse(e[I],1+A.length);if(!L)return null;A.push(Ie(L.type))}i.error(`Expected arguments of type ${v}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){Ga.definitions=i;for(const r in i)e[r]=Ga}}var as=Ga;class ar{constructor(e,i,r){this.type=H,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const r=e[1];if(typeof r!="object"||Array.isArray(r))return i.error("Collator options argument must be an object.");const a=i.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,Ui);if(!a)return null;const u=i.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,Ui);if(!u)return null;let d=null;return r.locale&&(d=i.parse(r.locale,1,Bi),!d)?null:new ar(a,u,d)}evaluate(e){return new fr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ls=8192;function Bn(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ja(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Gl(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*ls),Math.round(r*a*ls)]}function Co(t,e,i){const r=t[0]-e[0],a=t[1]-e[1],u=t[0]-i[0],d=t[1]-i[1];return r*d-u*a==0&&r*u<=0&&a*d<=0}function hl(t,e){let i=!1;for(let d=0,m=e.length;d<m;d++){const y=e[d];for(let v=0,A=y.length;v<A-1;v++){if(Co(t,y[v],y[v+1]))return!1;(a=y[v])[1]>(r=t)[1]!=(u=y[v+1])[1]>r[1]&&r[0]<(u[0]-a[0])*(r[1]-a[1])/(u[1]-a[1])+a[0]&&(i=!i)}}var r,a,u;return i}function dl(t,e){for(let i=0;i<e.length;i++)if(hl(t,e[i]))return!0;return!1}function jl(t,e,i,r){const a=r[0]-i[0],u=r[1]-i[1],d=(t[0]-i[0])*u-a*(t[1]-i[1]),m=(e[0]-i[0])*u-a*(e[1]-i[1]);return d>0&&m<0||d<0&&m>0}function Wl(t,e,i){for(const v of i)for(let A=0;A<v.length-1;++A)if((m=[(d=v[A+1])[0]-(u=v[A])[0],d[1]-u[1]])[0]*(y=[(a=e)[0]-(r=t)[0],a[1]-r[1]])[1]-m[1]*y[0]!=0&&jl(r,a,u,d)&&jl(u,d,r,a))return!0;var r,a,u,d,m,y;return!1}function Wa(t,e){for(let i=0;i<t.length;++i)if(!hl(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Wl(t[i],t[i+1],e))return!1;return!0}function Us(t,e){for(let i=0;i<e.length;i++)if(Wa(t,e[i]))return!0;return!1}function Hr(t,e,i){const r=[];for(let a=0;a<t.length;a++){const u=[];for(let d=0;d<t[a].length;d++){const m=Gl(t[a][d],i);Bn(e,m),u.push(m)}r.push(u)}return r}function wc(t,e,i){const r=[];for(let a=0;a<t.length;a++){const u=Hr(t[a],e,i);r.push(u)}return r}function bo(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const a=.5*r;let u=t[0]-i[0]>a?-r:i[0]-t[0]>a?r:0;u===0&&(u=t[0]-i[2]>a?-r:i[2]-t[0]>a?r:0),t[0]+=u}Bn(e,t)}function Vs(t,e,i,r){const a=Math.pow(2,r.z)*ls,u=[r.x*ls,r.y*ls],d=[];if(!t)return d;for(const m of t)for(const y of m){const v=[y.x+u[0],y.y+u[1]];bo(v,e,i,a),d.push(v)}return d}function $i(t,e,i,r){const a=Math.pow(2,r.z)*ls,u=[r.x*ls,r.y*ls],d=[];if(!t)return d;for(const y of t){const v=[];for(const A of y){const I=[A.x+u[0],A.y+u[1]];Bn(e,I),v.push(I)}d.push(v)}if(e[2]-e[0]<=a/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const y of d)for(const v of y)bo(v,e,i,a)}var m;return d}class wo{constructor(e,i){this.type=Ui,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ul(e[1])){const r=e[1];if(r.type==="FeatureCollection")for(let a=0;a<r.features.length;++a){const u=r.features[a].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new wo(r,r.features[a].geometry)}else if(r.type==="Feature"){const a=r.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new wo(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new wo(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,r){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(r.type==="Polygon"){const m=Hr(r.coordinates,u,d),y=Vs(i.geometry(),a,u,d);if(!ja(a,u))return!1;for(const v of y)if(!hl(v,m))return!1}if(r.type==="MultiPolygon"){const m=wc(r.coordinates,u,d),y=Vs(i.geometry(),a,u,d);if(!ja(a,u))return!1;for(const v of y)if(!dl(v,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,r){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(r.type==="Polygon"){const m=Hr(r.coordinates,u,d),y=$i(i.geometry(),a,u,d);if(!ja(a,u))return!1;for(const v of y)if(!Wa(v,m))return!1}if(r.type==="MultiPolygon"){const m=wc(r.coordinates,u,d),y=$i(i.geometry(),a,u,d);if(!ja(a,u))return!1;for(const v of y)if(!Us(v,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var da=wo;function Gs(t){if(t instanceof as&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof da)return!1;let e=!0;return t.eachChild(i=>{e&&!Gs(i)&&(e=!1)}),e}function mn(t){if(t instanceof as&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!mn(i)&&(e=!1)}),e}function cs(t,e){if(t instanceof as&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(r=>{i&&!cs(r,e)&&(i=!1)}),i}class fl{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const r=e[1];return i.scope.has(r)?new fl(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Qc=fl;class pl{constructor(e,i=[],r,a=new Yc,u=[]){this.registry=e,this.path=i,this.key=i.map(d=>`[${d}]`).join(""),this.scope=a,this.errors=u,this.expectedType=r}parse(e,i,r,a,u={}){return i?this.concat(i,r,a)._parse(e,u):this._parse(e,u)}_parse(e,i){function r(a,u,d){return d==="assert"?new ln(u,[a]):d==="coerce"?new Va(u,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=e[0];if(typeof a!="string")return this.error(`Expression name must be a string, but found ${typeof a} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const u=this.registry[a];if(u){let d=u.parse(e,this);if(!d)return null;if(this.expectedType){const m=this.expectedType,y=d.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||y.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(m,y))return null}else d=r(d,m,i.typeAnnotation||"coerce");else d=r(d,m,i.typeAnnotation||"assert")}if(!(d instanceof cl)&&d.type.kind!=="resolvedImage"&&js(d)){const m=new Vl;try{d=new cl(d.type,d.evaluate(m))}catch(y){return this.error(y.message),null}}return d}return this.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r){const a=typeof e=="number"?this.path.concat(e):this.path,u=r?this.scope.concat(r):this.scope;return new pl(this.registry,a,i||null,u,this.errors)}error(e,...i){const r=`${this.key}${i.map(a=>`[${a}]`).join("")}`;this.errors.push(new ss(r,e))}checkSubtype(e,i){const r=xt(e,i);return r&&this.error(r),r}}var eu=pl;function js(t){if(t instanceof Qc)return js(t.boundExpression);if(t instanceof as&&t.name==="error"||t instanceof ar||t instanceof da)return!1;const e=t instanceof Va||t instanceof ln;let i=!0;return t.eachChild(r=>{i=e?i&&js(r):i&&r instanceof cl}),!!i&&Gs(t)&&cs(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ws(t,e){const i=t.length-1;let r,a,u=0,d=i,m=0;for(;u<=d;)if(m=Math.floor((u+d)/2),r=t[m],a=t[m+1],r<=e){if(m===i||e<a)return m;u=m+1}else{if(!(r>e))throw new Fr("Input is not a number.");d=m-1}return 0}class us{constructor(e,i,r){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[a,u]of r)this.labels.push(a),this.outputs.push(u)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(e[1],1,At);if(!r)return null;const a=[];let u=null;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);for(let d=1;d<e.length;d+=2){const m=d===1?-1/0:e[d],y=e[d+1],v=d,A=d+1;if(typeof m!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(a.length&&a[a.length-1][0]>=m)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const I=i.parse(y,A,u);if(!I)return null;u=u||I.type,a.push([m,I])}return new us(u,r,a)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return r[0].evaluate(e);const u=i.length;return a>=i[u-1]?r[u-1].evaluate(e):r[Ws(i,a)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var To=us;function Ei(t,e,i){return t*(1-i)+e*i}var fa=Object.freeze({__proto__:null,number:Ei,color:function(t,e,i){return new bi(Ei(t.r,e.r,i),Ei(t.g,e.g,i),Ei(t.b,e.b,i),Ei(t.a,e.a,i))},array:function(t,e,i){return t.map((r,a)=>Ei(r,e[a],i))}});const _s=.95047,tu=1.08883,pa=4/29,qs=6/29,ql=3*qs*qs,iu=Math.PI/180,nu=180/Math.PI;function ml(t){return t>.008856451679035631?Math.pow(t,1/3):t/ql+pa}function Tc(t){return t>qs?t*t*t:ql*(t-pa)}function _l(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Mr(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Zs(t){const e=Mr(t.r),i=Mr(t.g),r=Mr(t.b),a=ml((.4124564*e+.3575761*i+.1804375*r)/_s),u=ml((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*u-16,a:500*(a-u),b:200*(u-ml((.0193339*e+.119192*i+.9503041*r)/tu)),alpha:t.a}}function gl(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Tc(e),i=_s*Tc(i),r=tu*Tc(r),new bi(_l(3.2404542*i-1.5371385*e-.4985314*r),_l(-.969266*i+1.8760108*e+.041556*r),_l(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function Hs(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const yl={forward:Zs,reverse:gl,interpolate:function(t,e,i){return{l:Ei(t.l,e.l,i),a:Ei(t.a,e.a,i),b:Ei(t.b,e.b,i),alpha:Ei(t.alpha,e.alpha,i)}}},hs={forward:function(t){const{l:e,a:i,b:r}=Zs(t),a=Math.atan2(r,i)*nu;return{h:a<0?a+360:a,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*iu,i=t.c;return gl({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:Hs(t.h,e.h,i),c:Ei(t.c,e.c,i),l:Ei(t.l,e.l,i),alpha:Ei(t.alpha,e.alpha,i)}}};var ru=Object.freeze({__proto__:null,lab:yl,hcl:hs});class Zl{constructor(e,i,r,a,u){this.type=e,this.operator=i,this.interpolation=r,this.input=a,this.labels=[],this.outputs=[];for(const[d,m]of u)this.labels.push(d),this.outputs.push(m)}static interpolationFactor(e,i,r,a){let u=0;if(e.name==="exponential")u=vl(i,e.base,r,a);else if(e.name==="linear")u=vl(i,1,r,a);else if(e.name==="cubic-bezier"){const d=e.controlPoints;u=new Mt(d[0],d[1],d[2],d[3]).solve(vl(i,1,r,a))}return u}static parse(e,i){let[r,a,u,...d]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const v=a[1];if(typeof v!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:v}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const v=a.slice(1);if(v.length!==4||v.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(u=i.parse(u,2,At),!u)return null;const m=[];let y=null;r==="interpolate-hcl"||r==="interpolate-lab"?y=xo:i.expectedType&&i.expectedType.kind!=="value"&&(y=i.expectedType);for(let v=0;v<d.length;v+=2){const A=d[v],I=d[v+1],L=v+3,k=v+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(m.length&&m[m.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const F=i.parse(I,k,y);if(!F)return null;y=y||F.type,m.push([A,F])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new Zl(y,r,a,u,m):i.error(`Type ${Ie(y)} is not interpolatable.`)}evaluate(e){const i=this.labels,r=this.outputs;if(i.length===1)return r[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return r[0].evaluate(e);const u=i.length;if(a>=i[u-1])return r[u-1].evaluate(e);const d=Ws(i,a),m=Zl.interpolationFactor(this.interpolation,a,i[d],i[d+1]),y=r[d].evaluate(e),v=r[d+1].evaluate(e);return this.operator==="interpolate"?fa[this.type.kind.toLowerCase()](y,v,m):this.operator==="interpolate-hcl"?hs.reverse(hs.interpolate(hs.forward(y),hs.forward(v),m)):yl.reverse(yl.interpolate(yl.forward(y),yl.forward(v),m))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function vl(t,e,i,r){const a=r-i,u=t-i;return a===0?0:e===1?u/a:(Math.pow(e,u)-1)/(Math.pow(e,a)-1)}var Zo=Zl;class $s{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null;const a=i.expectedType;a&&a.kind!=="value"&&(r=a);const u=[];for(const m of e.slice(1)){const y=i.parse(m,1+u.length,r,void 0,{typeAnnotation:"omit"});if(!y)return null;r=r||y.type,u.push(y)}const d=a&&u.some(m=>xt(a,m.type));return new $s(d?C:r,u)}evaluate(e){let i,r=null,a=0;for(const u of this.args){if(a++,r=u.evaluate(e),r&&r instanceof uo&&!r.available&&(i||(i=r),r=null,a===this.args.length))return i;if(r!==null)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ou=$s;class Hl{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let u=1;u<e.length-1;u+=2){const d=e[u];if(typeof d!="string")return i.error(`Expected string, but found ${typeof d} instead.`,u);if(/[^a-zA-Z0-9_]/.test(d))return i.error("Variable names must contain only alphanumeric characters or '_'.",u);const m=i.parse(e[u+1],u+1);if(!m)return null;r.push([d,m])}const a=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return a?new Hl(r,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}var Xs=Hl;class xl{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,At),a=i.parse(e[2],2,Te(i.expectedType||C));return r&&a?new xl(a.type.itemType,r,a):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new Fr(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new Fr(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new Fr(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var ma=xl;class Pe{constructor(e,i){this.type=Ui,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,C),a=i.parse(e[2],2,C);return r&&a?Ft(r.type,[Ui,Bi,At,ha,C])?new Pe(r,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ie(r.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(r==null)return!1;if(!St(i,["boolean","string","number","null"]))throw new Fr(`Expected first argument to be of type boolean, string, number or null, but found ${Ie(wr(i))} instead.`);if(!St(r,["string","array"]))throw new Fr(`Expected second argument to be of type array or string, but found ${Ie(wr(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var it=Pe;class Pt{constructor(e,i,r){this.type=At,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,C),a=i.parse(e[2],2,C);if(!r||!a)return null;if(!Ft(r.type,[Ui,Bi,At,ha,C]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ie(r.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,At);return u?new Pt(r,a,u):null}return new Pt(r,a)}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!St(i,["boolean","string","number","null"]))throw new Fr(`Expected first argument to be of type boolean, string, number or null, but found ${Ie(wr(i))} instead.`);if(!St(r,["string","array"]))throw new Fr(`Expected second argument to be of type array or string, but found ${Ie(wr(r))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return r.indexOf(i,a)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ci=Pt;class _n{constructor(e,i,r,a,u,d){this.inputType=e,this.type=i,this.input=r,this.cases=a,this.outputs=u,this.otherwise=d}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let r,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const u={},d=[];for(let v=2;v<e.length-1;v+=2){let A=e[v];const I=e[v+1];Array.isArray(A)||(A=[A]);const L=i.concat(v);if(A.length===0)return L.error("Expected at least one branch label.");for(const F of A){if(typeof F!="number"&&typeof F!="string")return L.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return L.error("Numeric branch labels must be integer values.");if(r){if(L.checkSubtype(r,wr(F)))return null}else r=wr(F);if(u[String(F)]!==void 0)return L.error("Branch labels must be unique.");u[String(F)]=d.length}const k=i.parse(I,v,a);if(!k)return null;a=a||k.type,d.push(k)}const m=i.parse(e[1],1,C);if(!m)return null;const y=i.parse(e[e.length-1],e.length-1,a);return y?m.type.kind!=="value"&&i.concat(1).checkSubtype(r,m.type)?null:new _n(r,a,m,u,d,y):null}evaluate(e){const i=this.input.evaluate(e);return(wr(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],a={};for(const d of i){const m=a[this.cases[d]];m===void 0?(a[this.cases[d]]=r.length,r.push([this.cases[d],[d]])):r[m][1].push(d)}const u=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,m]of r)e.push(m.length===1?u(m[0]):m.map(u)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}var Di=_n;class Hn{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&i.expectedType.kind!=="value"&&(r=i.expectedType);const a=[];for(let d=1;d<e.length-1;d+=2){const m=i.parse(e[d],d,Ui);if(!m)return null;const y=i.parse(e[d+1],d+1,r);if(!y)return null;a.push([m,y]),r=r||y.type}const u=i.parse(e[e.length-1],e.length-1,r);return u?new Hn(r,a,u):null}evaluate(e){for(const[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Tr=Hn;class $r{constructor(e,i,r,a){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,C),a=i.parse(e[2],2,At);if(!r||!a)return null;if(!Ft(r.type,[Te(C),Bi,C]))return i.error(`Expected first argument to be of type array or string, but found ${Ie(r.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,At);return u?new $r(r.type,r,a,u):null}return new $r(r.type,r,a)}evaluate(e){const i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!St(i,["string","array"]))throw new Fr(`Expected first argument to be of type array or string, but found ${Ie(wr(i))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return i.slice(r,a)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Er=$r;function pr(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function ds(t,e,i,r){return r.compare(e,i)===0}function Dr(t,e,i){const r=t!=="=="&&t!=="!=";return class b0{constructor(u,d,m){this.type=Ui,this.lhs=u,this.rhs=d,this.collator=m,this.hasUntypedArgument=u.type.kind==="value"||d.type.kind==="value"}static parse(u,d){if(u.length!==3&&u.length!==4)return d.error("Expected two or three arguments.");const m=u[0];let y=d.parse(u[1],1,C);if(!y)return null;if(!pr(m,y.type))return d.concat(1).error(`"${m}" comparisons are not supported for type '${Ie(y.type)}'.`);let v=d.parse(u[2],2,C);if(!v)return null;if(!pr(m,v.type))return d.concat(2).error(`"${m}" comparisons are not supported for type '${Ie(v.type)}'.`);if(y.type.kind!==v.type.kind&&y.type.kind!=="value"&&v.type.kind!=="value")return d.error(`Cannot compare types '${Ie(y.type)}' and '${Ie(v.type)}'.`);r&&(y.type.kind==="value"&&v.type.kind!=="value"?y=new ln(v.type,[y]):y.type.kind!=="value"&&v.type.kind==="value"&&(v=new ln(y.type,[v])));let A=null;if(u.length===4){if(y.type.kind!=="string"&&v.type.kind!=="string"&&y.type.kind!=="value"&&v.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(A=d.parse(u[3],3,H),!A)return null}return new b0(y,v,A)}evaluate(u){const d=this.lhs.evaluate(u),m=this.rhs.evaluate(u);if(r&&this.hasUntypedArgument){const y=wr(d),v=wr(m);if(y.kind!==v.kind||y.kind!=="string"&&y.kind!=="number")throw new Fr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${v.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const y=wr(d),v=wr(m);if(y.kind!=="string"||v.kind!=="string")return e(u,d,m)}return this.collator?i(u,d,m,this.collator.evaluate(u)):e(u,d,m)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[t];return this.eachChild(d=>{u.push(d.serialize())}),u}}}const De=Dr("==",function(t,e,i){return e===i},ds),ot=Dr("!=",function(t,e,i){return e!==i},function(t,e,i,r){return!ds(0,e,i,r)}),et=Dr("<",function(t,e,i){return e<i},function(t,e,i,r){return r.compare(e,i)<0}),Zt=Dr(">",function(t,e,i){return e>i},function(t,e,i,r){return r.compare(e,i)>0}),yi=Dr("<=",function(t,e,i){return e<=i},function(t,e,i,r){return r.compare(e,i)<=0}),on=Dr(">=",function(t,e,i){return e>=i},function(t,e,i,r){return r.compare(e,i)>=0});class lr{constructor(e,i,r,a,u,d){this.type=Bi,this.number=e,this.locale=i,this.currency=r,this.unit=a,this.minFractionDigits=u,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const r=i.parse(e[1],1,At);if(!r)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let u=null;if(a.locale&&(u=i.parse(a.locale,1,Bi),!u))return null;let d=null;if(a.currency&&(d=i.parse(a.currency,1,Bi),!d))return null;let m=null;if(a.unit&&(m=i.parse(a.unit,1,Bi),!m))return null;let y=null;if(a["min-fraction-digits"]&&(y=i.parse(a["min-fraction-digits"],1,At),!y))return null;let v=null;return a["max-fraction-digits"]&&(v=i.parse(a["max-fraction-digits"],1,At),!v)?null:new lr(r,u,d,m,y,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Dn{constructor(e){this.type=At,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=i.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Ie(r.type)} instead.`):new Dn(r):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Fr(`Expected value to be of type string or array, but found ${Ie(wr(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Ec={"==":De,"!=":ot,">":Zt,"<":et,">=":on,"<=":yi,array:ln,at:ma,boolean:ln,case:Tr,coalesce:ou,collator:ar,format:Sn,image:xc,in:it,"index-of":ci,interpolate:Zo,"interpolate-hcl":Zo,"interpolate-lab":Zo,length:Dn,let:Xs,literal:cl,match:Di,number:ln,"number-format":lr,object:ln,slice:Er,step:To,string:ln,"to-boolean":Va,"to-color":Va,"to-number":Va,"to-string":Va,var:Qc,within:da};function On(t,[e,i,r,a]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const u=a?a.evaluate(t):1,d=jn(e,i,r,u);if(d)throw new Fr(d);return new bi(e/255*u,i/255*u,r/255*u,u)}function Gi(t,e){return t in e}function Ks(t,e){const i=e[t];return i===void 0?null:i}function fo(t){return{type:t}}as.register(Ec,{error:[{kind:"error"},[Bi],(t,[e])=>{throw new Fr(e.evaluate(t))}],typeof:[Bi,[C],(t,[e])=>Ie(wr(e.evaluate(t)))],"to-rgba":[Te(At,4),[xo],(t,[e])=>e.evaluate(t).toArray()],rgb:[xo,[At,At,At],On],rgba:[xo,[At,At,At,At],On],has:{type:Ui,overloads:[[[Bi],(t,[e])=>Gi(e.evaluate(t),t.properties())],[[Bi,T],(t,[e,i])=>Gi(e.evaluate(t),i.evaluate(t))]]},get:{type:C,overloads:[[[Bi],(t,[e])=>Ks(e.evaluate(t),t.properties())],[[Bi,T],(t,[e,i])=>Ks(e.evaluate(t),i.evaluate(t))]]},"feature-state":[C,[Bi],(t,[e])=>Ks(e.evaluate(t),t.featureState||{})],properties:[T,[],t=>t.properties()],"geometry-type":[Bi,[],t=>t.geometryType()],id:[C,[],t=>t.id()],zoom:[At,[],t=>t.globals.zoom],pitch:[At,[],t=>t.globals.pitch||0],"distance-from-center":[At,[],t=>t.distanceFromCenter()],"heatmap-density":[At,[],t=>t.globals.heatmapDensity||0],"line-progress":[At,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[At,[],t=>t.globals.skyRadialProgress||0],accumulated:[C,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[At,fo(At),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[At,fo(At),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:At,overloads:[[[At,At],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[At],(t,[e])=>-e.evaluate(t)]]},"/":[At,[At,At],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[At,[At,At],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[At,[],()=>Math.LN2],pi:[At,[],()=>Math.PI],e:[At,[],()=>Math.E],"^":[At,[At,At],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[At,[At],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[At,[At],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[At,[At],(t,[e])=>Math.log(e.evaluate(t))],log2:[At,[At],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[At,[At],(t,[e])=>Math.sin(e.evaluate(t))],cos:[At,[At],(t,[e])=>Math.cos(e.evaluate(t))],tan:[At,[At],(t,[e])=>Math.tan(e.evaluate(t))],asin:[At,[At],(t,[e])=>Math.asin(e.evaluate(t))],acos:[At,[At],(t,[e])=>Math.acos(e.evaluate(t))],atan:[At,[At],(t,[e])=>Math.atan(e.evaluate(t))],min:[At,fo(At),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[At,fo(At),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[At,[At],(t,[e])=>Math.abs(e.evaluate(t))],round:[At,[At],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[At,[At],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[At,[At],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Ui,[Bi,C],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Ui,[C],(t,[e])=>t.id()===e.value],"filter-type-==":[Ui,[Bi],(t,[e])=>t.geometryType()===e.value],"filter-<":[Ui,[Bi,C],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r<a}],"filter-id-<":[Ui,[C],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[Ui,[Bi,C],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r>a}],"filter-id->":[Ui,[C],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[Ui,[Bi,C],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r<=a}],"filter-id-<=":[Ui,[C],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[Ui,[Bi,C],(t,[e,i])=>{const r=t.properties()[e.value],a=i.value;return typeof r==typeof a&&r>=a}],"filter-id->=":[Ui,[C],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[Ui,[C],(t,[e])=>e.value in t.properties()],"filter-has-id":[Ui,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Ui,[Te(Bi)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Ui,[Te(C)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Ui,[Bi,Te(C)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Ui,[Bi,Te(C)],(t,[e,i])=>function(r,a,u,d){for(;u<=d;){const m=u+d>>1;if(a[m]===r)return!0;a[m]>r?d=m-1:u=m+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ui,overloads:[[[Ui,Ui],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[fo(Ui),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Ui,overloads:[[[Ui,Ui],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[fo(Ui),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Ui,[Ui],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Ui,[Bi],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Bi,[Bi],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Bi,[Bi],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Bi,fo(C),(t,e)=>e.map(i=>ho(i.evaluate(t))).join("")],"resolved-locale":[Bi,[H],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Mo=Ec;function Lr(t){return{result:"success",value:t}}function Xr(t){return{result:"error",value:t}}function ji(t){return t["property-type"]==="data-driven"}function Do(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function _a(t){return!!t.expression&&t.expression.interpolated}function Ci(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function gs(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Fu(t){return t}function bl(t,e){const i=e.type==="color",r=t.stops&&typeof t.stops[0][0]=="object",a=r||!(r||t.property!==void 0),u=t.type||(_a(e)?"exponential":"interval");if(i&&((t=os({},t)).stops&&(t.stops=t.stops.map(v=>[v[0],bi.parse(v[1])])),t.default=bi.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!ru[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let d,m,y;if(u==="exponential")d=wl;else if(u==="interval")d=ga;else if(u==="categorical"){d=Lo,m=Object.create(null);for(const v of t.stops)m[v[0]]=v[1];y=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);d=ya}if(r){const v={},A=[];for(let k=0;k<t.stops.length;k++){const F=t.stops[k],G=F[0].zoom;v[G]===void 0&&(v[G]={zoom:G,type:t.type,property:t.property,default:t.default,stops:[]},A.push(G)),v[G].stops.push([F[0].value,F[1]])}const I=[];for(const k of A)I.push([v[k].zoom,bl(v[k],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Zo.interpolationFactor.bind(void 0,L),zoomStops:I.map(k=>k[0]),evaluate:({zoom:k},F)=>wl({stops:I,base:t.base},e,k).evaluate(k,F)}}if(a){const v=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:v,interpolationFactor:Zo.interpolationFactor.bind(void 0,v),zoomStops:t.stops.map(A=>A[0]),evaluate:({zoom:A})=>d(t,e,A,m,y)}}return{kind:"source",evaluate(v,A){const I=A&&A.properties?A.properties[t.property]:void 0;return I===void 0?ys(t.default,e.default):d(t,e,I,m,y)}}}function ys(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function Lo(t,e,i,r,a){return ys(typeof i===a?r[i]:void 0,t.default,e.default)}function ga(t,e,i){if(Ci(i)!=="number")return ys(t.default,e.default);const r=t.stops.length;if(r===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const a=Ws(t.stops.map(u=>u[0]),i);return t.stops[a][1]}function wl(t,e,i){const r=t.base!==void 0?t.base:1;if(Ci(i)!=="number")return ys(t.default,e.default);const a=t.stops.length;if(a===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[a-1][0])return t.stops[a-1][1];const u=Ws(t.stops.map(A=>A[0]),i),d=function(A,I,L,k){const F=k-L,G=A-L;return F===0?0:I===1?G/F:(Math.pow(I,G)-1)/(Math.pow(I,F)-1)}(i,r,t.stops[u][0],t.stops[u+1][0]),m=t.stops[u][1],y=t.stops[u+1][1];let v=fa[e.type]||Fu;if(t.colorSpace&&t.colorSpace!=="rgb"){const A=ru[t.colorSpace];v=(I,L)=>A.reverse(A.interpolate(A.forward(I),A.forward(L),d))}return typeof m.evaluate=="function"?{evaluate(...A){const I=m.evaluate.apply(void 0,A),L=y.evaluate.apply(void 0,A);if(I!==void 0&&L!==void 0)return v(I,L,d)}}:v(m,y,d)}function ya(t,e,i){return e.type==="color"?i=bi.parse(i):e.type==="formatted"?i=Zr.fromString(i.toString()):e.type==="resolvedImage"?i=uo.fromString(i.toString()):Ci(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ys(i,t.default,e.default)}class va{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new Vl,this._defaultValue=i?function(r){return r.type==="color"&&(gs(r.default)||Array.isArray(r.default))?new bi(0,0,0,0):r.type==="color"?bi.parse(r.default)||null:r.default===void 0?null:r.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,r,a,u,d,m,y){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,a,u,d,m,y){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=y||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Fr(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function $l(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Mo}function qa(t,e){const i=new eu(Mo,[],e?function(a){const u={color:xo,string:Bi,number:At,enum:Bi,boolean:Ui,formatted:he,resolvedImage:Ee};return a.type==="array"?Te(u[a.value]||C,a.length):u[a.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?Lr(new va(r,e)):Xr(i.errors)}class su{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!mn(i.expression)}evaluateWithoutErrorHandling(e,i,r,a,u,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,a,u,d)}evaluate(e,i,r,a,u,d){return this._styleExpression.evaluate(e,i,r,a,u,d)}}class Ys{constructor(e,i,r,a){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!mn(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,r,a,u,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,a,u,d)}evaluate(e,i,r,a,u,d){return this._styleExpression.evaluate(e,i,r,a,u,d)}interpolationFactor(e,i,r){return this.interpolationType?Zo.interpolationFactor(this.interpolationType,e,i,r):0}}function fs(t,e){if((t=qa(t,e)).result==="error")return t;const i=t.value.expression,r=Gs(i);if(!r&&!ji(e))return Xr([new ss("","data expressions not supported")]);const a=cs(i,["zoom","pitch","distance-from-center"]);if(!a&&!Do(e))return Xr([new ss("","zoom expressions not supported")]);const u=au(i);return u||a?u instanceof ss?Xr([u]):u instanceof Zo&&!_a(e)?Xr([new ss("",'"interpolate" expressions cannot be used with this property')]):Lr(u?new Ys(r?"camera":"composite",t.value,u.labels,u instanceof Zo?u.interpolation:void 0):new su(r?"constant":"source",t.value)):Xr([new ss("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Tl{constructor(e,i){this._parameters=e,this._specification=i,os(this,bl(this._parameters,this._specification))}static deserialize(e){return new Tl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function au(t){let e=null;if(t instanceof Xs)e=au(t.result);else if(t instanceof ou){for(const i of t.args)if(e=au(i),e)break}else(t instanceof To||t instanceof Zo)&&t.input instanceof as&&t.input.name==="zoom"&&(e=t);return e instanceof ss||t.eachChild(i=>{const r=au(i);r instanceof ss?e=r:!e&&r?e=new ss("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new ss("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Ot{constructor(e,i,r,a){this.message=(e?`${e}: `:"")+r,a&&(this.identifier=a),i!=null&&i.__line__&&(this.line=i.__line__)}}function vs(t){const e=t.key,i=t.value,r=t.valueSpec||{},a=t.objectElementValidators||{},u=t.style,d=t.styleSpec;let m=[];const y=Ci(i);if(y!=="object")return[new Ot(e,i,`object expected, ${y} found`)];for(const v in i){const A=v.split(".")[0],I=r[A]||r["*"];let L;a[A]?L=a[A]:r[A]?L=Ai:a["*"]?L=a["*"]:r["*"]&&(L=Ai),L?m=m.concat(L({key:(e&&`${e}.`)+v,value:i[v],valueSpec:I,style:u,styleSpec:d,object:i,objectKey:v},i)):m.push(new Ot(e,i[v],`unknown property "${v}"`))}for(const v in r)a[v]||r[v].required&&r[v].default===void 0&&i[v]===void 0&&m.push(new Ot(e,i,`missing required property "${v}"`));return m}function lu(t){const e=t.value,i=t.valueSpec,r=t.style,a=t.styleSpec,u=t.key,d=t.arrayElementValidator||Ai;if(Ci(e)!=="array")return[new Ot(u,e,`array expected, ${Ci(e)} found`)];if(i.length&&e.length!==i.length)return[new Ot(u,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Ot(u,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let m={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};a.$version<7&&(m.function=i.function),Ci(i.value)==="object"&&(m=i.value);let y=[];for(let v=0;v<e.length;v++)y=y.concat(d({array:e,arrayIndex:v,value:e[v],valueSpec:m,style:r,styleSpec:a,key:`${u}[${v}]`}));return y}function Ac(t){const e=t.key,i=t.value,r=t.valueSpec;let a=Ci(i);if(a==="number"&&i!=i&&(a="NaN"),a!=="number")return[new Ot(e,i,`number expected, ${a} found`)];if("minimum"in r){let u=r.minimum;if(Ci(r.minimum)==="array"&&(u=r.minimum[t.arrayIndex]),i<u)return[new Ot(e,i,`${i} is less than the minimum value ${u}`)]}if("maximum"in r){let u=r.maximum;if(Ci(r.maximum)==="array"&&(u=r.maximum[t.arrayIndex]),i>u)return[new Ot(e,i,`${i} is greater than the maximum value ${u}`)]}return[]}function Xl(t){const e=t.valueSpec,i=sr(t.value.type);let r,a,u,d={};const m=i!=="categorical"&&t.value.property===void 0,y=!m,v=Ci(t.value.stops)==="array"&&Ci(t.value.stops[0])==="array"&&Ci(t.value.stops[0][0])==="object",A=vs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(k){if(i==="identity")return[new Ot(k.key,k.value,'identity function may not have a "stops" property')];let F=[];const G=k.value;return F=F.concat(lu({key:k.key,value:G,valueSpec:k.valueSpec,style:k.style,styleSpec:k.styleSpec,arrayElementValidator:I})),Ci(G)==="array"&&G.length===0&&F.push(new Ot(k.key,G,"array must have at least one stop")),F},default:function(k){return Ai({key:k.key,value:k.value,valueSpec:e,style:k.style,styleSpec:k.styleSpec})}}});return i==="identity"&&m&&A.push(new Ot(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||A.push(new Ot(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!_a(t.valueSpec)&&A.push(new Ot(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(y&&!ji(t.valueSpec)?A.push(new Ot(t.key,t.value,"property functions not supported")):m&&!Do(t.valueSpec)&&A.push(new Ot(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!v||t.value.property!==void 0||A.push(new Ot(t.key,t.value,'"property" property is required')),A;function I(k){let F=[];const G=k.value,X=k.key;if(Ci(G)!=="array")return[new Ot(X,G,`array expected, ${Ci(G)} found`)];if(G.length!==2)return[new Ot(X,G,`array length 2 expected, length ${G.length} found`)];if(v){if(Ci(G[0])!=="object")return[new Ot(X,G,`object expected, ${Ci(G[0])} found`)];if(G[0].zoom===void 0)return[new Ot(X,G,"object stop key must have zoom")];if(G[0].value===void 0)return[new Ot(X,G,"object stop key must have value")];const se=sr(G[0].zoom);if(typeof se!="number")return[new Ot(X,G[0].zoom,"stop zoom values must be numbers")];if(u&&u>se)return[new Ot(X,G[0].zoom,"stop zoom values must appear in ascending order")];se!==u&&(u=se,a=void 0,d={}),F=F.concat(vs({key:`${X}[0]`,value:G[0],valueSpec:{zoom:{}},style:k.style,styleSpec:k.styleSpec,objectElementValidators:{zoom:Ac,value:L}}))}else F=F.concat(L({key:`${X}[0]`,value:G[0],valueSpec:{},style:k.style,styleSpec:k.styleSpec},G));return $l(ua(G[1]))?F.concat([new Ot(`${X}[1]`,G[1],"expressions are not allowed in function stops.")]):F.concat(Ai({key:`${X}[1]`,value:G[1],valueSpec:e,style:k.style,styleSpec:k.styleSpec}))}function L(k,F){const G=Ci(k.value),X=sr(k.value),se=k.value!==null?k.value:F;if(r){if(G!==r)return[new Ot(k.key,se,`${G} stop domain type must match previous stop domain type ${r}`)]}else r=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new Ot(k.key,se,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&i!=="categorical"){let pe=`number expected, ${G} found`;return ji(e)&&i===void 0&&(pe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ot(k.key,se,pe)]}return i!=="categorical"||G!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?i!=="categorical"&&G==="number"&&typeof X=="number"&&typeof a=="number"&&a!==void 0&&X<a?[new Ot(k.key,se,"stop domain values must appear in ascending order")]:(a=X,i==="categorical"&&X in d?[new Ot(k.key,se,"stop domain values must be unique")]:(d[X]=!0,[])):[new Ot(k.key,se,`integer expected, found ${String(X)}`)]}}function Sc(t){const e=(t.expressionContext==="property"?fs:qa)(ua(t.value),t.valueSpec);if(e.result==="error")return e.value.map(r=>new Ot(`${t.key}${r.key}`,t.value,r.message));const i=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!i.outputDefined())return[new Ot(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!mn(i))return[new Ot(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return fh(i,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!cs(i,["zoom","feature-state"]))return[new Ot(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Gs(i))return[new Ot(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fh(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const a of e.valueSpec.expression.parameters)i.delete(a);if(i.size===0)return[];const r=[];return t instanceof as&&i.has(t.name)?[new Ot(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(a=>{r.push(...fh(a,e))}),r)}function Nu(t){const e=t.key,i=t.value,r=t.valueSpec,a=[];return Array.isArray(r.values)?r.values.indexOf(sr(i))===-1&&a.push(new Ot(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(r.values).indexOf(sr(i))===-1&&a.push(new Ot(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),a}function ph(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ph(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ar(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ph(t)||(t=El(t));const i=t;let r=!0;try{r=function(v){if(!eo(v))return v;let A=ua(v);return cu(A),A=Nr(A),A}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const a=Ye[`filter_${e}`],u=qa(r,a);let d=null;if(u.result==="error")throw new Error(u.value.map(v=>`${v.key}: ${v.message}`).join(", "));d=(v,A,I)=>u.value.evaluate(v,A,{},I);let m=null,y=null;if(r!==i){const v=qa(i,a);if(v.result==="error")throw new Error(v.value.map(A=>`${A.key}: ${A.message}`).join(", "));m=(A,I,L,k,F)=>v.value.evaluate(A,I,{},L,void 0,void 0,k,F),y=!Gs(v.value.expression)}return{filter:d,dynamicFilter:m||void 0,needGeometry:Uu(r),needFeature:!!y}}function Nr(t){if(!Array.isArray(t))return t;const e=function(i){if(uu.has(i[0])){for(let r=1;r<i.length;r++)if(eo(i[r]))return!0}return i}(t);return e===!0?e:e.map(i=>Nr(i))}function cu(t){let e=!1;const i=[];if(t[0]==="case"){for(let r=1;r<t.length-1;r+=2)e=e||eo(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||eo(t[1]);for(let r=2;r<t.length-1;r+=2)i.push(t[r+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||eo(t[1]);for(let r=1;r<t.length-1;r+=2)i.push(t[r+1])}e&&(t.length=0,t.push("any",...i));for(let r=1;r<t.length;r++)cu(t[r])}function eo(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(eo(t[i]))return!0;return!1}const uu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function bf(t,e){return t<e?-1:t>e?1:0}function Uu(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(Uu(t[e]))return!0;return!1}function El(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?hu(t[1],t[2],"=="):e==="!="?xa(hu(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?hu(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(El))):e==="all"?["all"].concat(t.slice(1).map(El)):e==="none"?["all"].concat(t.slice(1).map(El).map(xa)):e==="in"?Za(t[1],t.slice(2)):e==="!in"?xa(Za(t[1],t.slice(2))):e==="has"?Ic(t[1]):e==="!has"?xa(Ic(t[1])):e!=="within"||t;var i}function hu(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Za(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(bf)]]:["filter-in-small",t,["literal",e]]}}function Ic(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function xa(t){return["!",t]}function Cc(t){return ph(ua(t.value))?Sc(os({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Kl(t)}function Kl(t){const e=t.value,i=t.key;if(Ci(e)!=="array")return[new Ot(i,e,`array expected, ${Ci(e)} found`)];const r=t.styleSpec;let a,u=[];if(e.length<1)return[new Ot(i,e,"filter array must have at least 1 element")];switch(u=u.concat(Nu({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),sr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&sr(e[1])==="$type"&&u.push(new Ot(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new Ot(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(a=Ci(e[1]),a!=="string"&&u.push(new Ot(`${i}[1]`,e[1],`string expected, ${a} found`)));for(let d=2;d<e.length;d++)a=Ci(e[d]),sr(e[1])==="$type"?u=u.concat(Nu({key:`${i}[${d}]`,value:e[d],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):a!=="string"&&a!=="number"&&a!=="boolean"&&u.push(new Ot(`${i}[${d}]`,e[d],`string, number, or boolean expected, ${a} found`));break;case"any":case"all":case"none":for(let d=1;d<e.length;d++)u=u.concat(Kl({key:`${i}[${d}]`,value:e[d],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":a=Ci(e[1]),e.length!==2?u.push(new Ot(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="string"&&u.push(new Ot(`${i}[1]`,e[1],`string expected, ${a} found`));break;case"within":a=Ci(e[1]),e.length!==2?u.push(new Ot(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):a!=="object"&&u.push(new Ot(`${i}[1]`,e[1],`object expected, ${a} found`))}return u}function Vu(t,e){const i=t.key,r=t.style,a=t.styleSpec,u=t.value,d=t.objectKey,m=a[`${e}_${t.layerType}`];if(!m)return[];const y=d.match(/^(.*)-transition$/);if(e==="paint"&&y&&m[y[1]]&&m[y[1]].transition)return Ai({key:i,value:u,valueSpec:a.transition,style:r,styleSpec:a});const v=t.valueSpec||m[d];if(!v)return[new Ot(i,u,`unknown property "${d}"`)];let A;if(Ci(u)==="string"&&ji(v)&&!v.tokens&&(A=/^{([^}]+)}$/.exec(u)))return[new Ot(i,u,`"${d}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(A[1])} }\`.`)];const I=[];return t.layerType==="symbol"&&(d==="text-field"&&r&&!r.glyphs&&I.push(new Ot(i,u,'use of "text-field" requires a style "glyphs" property')),d==="text-font"&&gs(ua(u))&&sr(u.type)==="identity"&&I.push(new Ot(i,u,'"text-font" does not support identity functions'))),I.concat(Ai({key:t.key,value:u,valueSpec:v,style:r,styleSpec:a,expressionContext:"property",propertyType:e,propertyKey:d}))}function sd(t){return Vu(t,"paint")}function mh(t){return Vu(t,"layout")}function _h(t){let e=[];const i=t.value,r=t.key,a=t.style,u=t.styleSpec;i.type||i.ref||e.push(new Ot(r,i,'either "type" or "ref" is required'));let d=sr(i.type);const m=sr(i.ref);if(i.id){const y=sr(i.id);for(let v=0;v<t.arrayIndex;v++){const A=a.layers[v];sr(A.id)===y&&e.push(new Ot(r,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let y;["type","source","source-layer","filter","layout"].forEach(v=>{v in i&&e.push(new Ot(r,i[v],`"${v}" is prohibited for ref layers`))}),a.layers.forEach(v=>{sr(v.id)===m&&(y=v)}),y?y.ref?e.push(new Ot(r,i.ref,"ref cannot reference another ref layer")):d=sr(y.type):typeof m=="string"&&e.push(new Ot(r,i.ref,`ref layer "${m}" not found`))}else if(d!=="background"&&d!=="sky")if(i.source){const y=a.sources&&a.sources[i.source],v=y&&sr(y.type);y?v==="vector"&&d==="raster"?e.push(new Ot(r,i.source,`layer "${i.id}" requires a raster source`)):v==="raster"&&d!=="raster"?e.push(new Ot(r,i.source,`layer "${i.id}" requires a vector source`)):v!=="vector"||i["source-layer"]?v==="raster-dem"&&d!=="hillshade"?e.push(new Ot(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):d!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||v==="geojson"&&y.lineMetrics||e.push(new Ot(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ot(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Ot(r,i.source,`source "${i.source}" not found`))}else e.push(new Ot(r,i,'missing required property "source"'));return e=e.concat(vs({key:r,value:i,valueSpec:u.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ai({key:`${r}.type`,value:i.type,valueSpec:u.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:y=>Cc(os({layerType:d},y)),layout:y=>vs({layer:i,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":v=>mh(os({layerType:d},v))}}),paint:y=>vs({layer:i,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":v=>sd(os({layerType:d},v))}})}})),e}function Mc(t){const e=t.value,i=t.key,r=Ci(e);return r!=="string"?[new Ot(i,e,`string expected, ${r} found`)]:[]}const Yl={promoteId:function({key:t,value:e}){if(Ci(e)==="string")return Mc({key:t,value:e});{const i=[];for(const r in e)i.push(...Mc({key:`${t}.${r}`,value:e[r]}));return i}}};function Ha(t){const e=t.value,i=t.key,r=t.styleSpec,a=t.style;if(!e.type)return[new Ot(i,e,'"type" is required')];const u=sr(e.type);let d;switch(u){case"vector":case"raster":case"raster-dem":return d=vs({key:i,value:e,valueSpec:r[`source_${u.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:Yl}),d;case"geojson":if(d=vs({key:i,value:e,valueSpec:r.source_geojson,style:a,styleSpec:r,objectElementValidators:Yl}),e.cluster)for(const m in e.clusterProperties){const[y,v]=e.clusterProperties[m],A=typeof y=="string"?[y,["accumulated"],["get",m]]:y;d.push(...Sc({key:`${i}.${m}.map`,value:v,expressionContext:"cluster-map"})),d.push(...Sc({key:`${i}.${m}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return d;case"video":return vs({key:i,value:e,valueSpec:r.source_video,style:a,styleSpec:r});case"image":return vs({key:i,value:e,valueSpec:r.source_image,style:a,styleSpec:r});case"canvas":return[new Ot(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Nu({key:`${i}.type`,value:e.type,valueSpec:{values:gh(r)},style:a,styleSpec:r})}}function gh(t){return t.source.reduce((e,i)=>{const r=t[i];return r.type.type==="enum"&&(e=e.concat(Object.keys(r.type.values))),e},[])}function K(t){const e=t.value,i=t.styleSpec,r=i.light,a=t.style;let u=[];const d=Ci(e);if(e===void 0)return u;if(d!=="object")return u=u.concat([new Ot("light",e,`object expected, ${d} found`)]),u;for(const m in e){const y=m.match(/^(.*)-transition$/);u=u.concat(y&&r[y[1]]&&r[y[1]].transition?Ai({key:m,value:e[m],valueSpec:i.transition,style:a,styleSpec:i}):r[m]?Ai({key:m,value:e[m],valueSpec:r[m],style:a,styleSpec:i}):[new Ot(m,e[m],`unknown property "${m}"`)])}return u}function Al(t){const e=t.value,i=t.key,r=t.style,a=t.styleSpec,u=a.terrain;let d=[];const m=Ci(e);if(e===void 0)return d;if(m!=="object")return d=d.concat([new Ot("terrain",e,`object expected, ${m} found`)]),d;for(const y in e){const v=y.match(/^(.*)-transition$/);d=d.concat(v&&u[v[1]]&&u[v[1]].transition?Ai({key:y,value:e[y],valueSpec:a.transition,style:r,styleSpec:a}):u[y]?Ai({key:y,value:e[y],valueSpec:u[y],style:r,styleSpec:a}):[new Ot(y,e[y],`unknown property "${y}"`)])}if(e.source){const y=r.sources&&r.sources[e.source],v=y&&sr(y.type);y?v!=="raster-dem"&&d.push(new Ot(i,e.source,`terrain cannot be used with a source of type ${String(v)}, it only be used with a "raster-dem" source type`)):d.push(new Ot(i,e.source,`source "${e.source}" not found`))}else d.push(new Ot(i,e,'terrain is missing required property "source"'));return d}function du(t){const e=t.value,i=t.style,r=t.styleSpec,a=r.fog;let u=[];const d=Ci(e);if(e===void 0)return u;if(d!=="object")return u=u.concat([new Ot("fog",e,`object expected, ${d} found`)]),u;for(const m in e){const y=m.match(/^(.*)-transition$/);u=u.concat(y&&a[y[1]]&&a[y[1]].transition?Ai({key:m,value:e[m],valueSpec:r.transition,style:i,styleSpec:r}):a[m]?Ai({key:m,value:e[m],valueSpec:a[m],style:i,styleSpec:r}):[new Ot(m,e[m],`unknown property "${m}"`)])}return u}const Po={"*":()=>[],array:lu,boolean:function(t){const e=t.value,i=t.key,r=Ci(e);return r!=="boolean"?[new Ot(i,e,`boolean expected, ${r} found`)]:[]},number:Ac,color:function(t){const e=t.key,i=t.value,r=Ci(i);return r!=="string"?[new Ot(e,i,`color expected, ${r} found`)]:Lt(i)===null?[new Ot(e,i,`color expected, "${i}" found`)]:[]},enum:Nu,filter:Cc,function:Xl,layer:_h,object:vs,source:Ha,light:K,terrain:Al,fog:du,string:Mc,formatted:function(t){return Mc(t).length===0?[]:Sc(t)},resolvedImage:function(t){return Mc(t).length===0?[]:Sc(t)},projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,a=t.style;let u=[];const d=Ci(e);if(d==="object")for(const m in e)u=u.concat(Ai({key:m,value:e[m],valueSpec:r[m],style:a,styleSpec:i}));else d!=="string"&&(u=u.concat([new Ot("projection",e,`object or string expected, ${d} found`)]));return u}};function Ai(t){const e=t.value,i=t.valueSpec,r=t.styleSpec;return i.expression&&gs(sr(e))?Xl(t):i.expression&&$l(ua(e))?Sc(t):i.type&&Po[i.type]?Po[i.type](t):vs(os({},t,{valueSpec:i.type?r[i.type]:i}))}function wf(t){const e=t.value,i=t.key,r=Mc(t);return r.length||(e.indexOf("{fontstack}")===-1&&r.push(new Ot(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&r.push(new Ot(i,e,'"glyphs" url must include a "{range}" token'))),r}function ad(t,e=Ye){return $a(Ai({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:wf,"*":()=>[]}}))}const Tf=t=>$a(sd(t)),Sl=t=>$a(mh(t));function $a(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function ld(t,e){let i=!1;if(e&&e.length)for(const r of e)t.fire(new rs(new Error(r.message))),i=!0;return i}var Dc=ba;function ba(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(i=a[2]);for(var u=0;u<this.d*this.d;u++){var d=a[3+u],m=a[3+u+1];r.push(d===m?null:a.subarray(d,m))}var y=a[3+r.length+1];this.keys=a.subarray(a[3+r.length],y),this.bboxes=a.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var v=0;v<this.d*this.d;v++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var A=i/e*t;this.min=-A,this.max=t+A}ba.prototype.insert=function(t,e,i,r,a){this._forEachCell(e,i,r,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(a)},ba.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ba.prototype._insertCell=function(t,e,i,r,a,u){this.cells[a].push(u)},ba.prototype.query=function(t,e,i,r,a){var u=this.min,d=this.max;if(t<=u&&e<=u&&d<=i&&d<=r&&!a)return Array.prototype.slice.call(this.keys);var m=[];return this._forEachCell(t,e,i,r,this._queryCell,m,{},a),m},ba.prototype._queryCell=function(t,e,i,r,a,u,d,m){var y=this.cells[a];if(y!==null)for(var v=this.keys,A=this.bboxes,I=0;I<y.length;I++){var L=y[I];if(d[L]===void 0){var k=4*L;(m?m(A[k+0],A[k+1],A[k+2],A[k+3]):t<=A[k+2]&&e<=A[k+3]&&i>=A[k+0]&&r>=A[k+1])?(d[L]=!0,u.push(v[L])):d[L]=!1}}},ba.prototype._forEachCell=function(t,e,i,r,a,u,d,m){for(var y=this._convertToCellCoord(t),v=this._convertToCellCoord(e),A=this._convertToCellCoord(i),I=this._convertToCellCoord(r),L=y;L<=A;L++)for(var k=v;k<=I;k++){var F=this.d*k+L;if((!m||m(this._convertFromCellCoord(L),this._convertFromCellCoord(k),this._convertFromCellCoord(L+1),this._convertFromCellCoord(k+1)))&&a.call(this,t,e,i,r,F,u,d,m))return}},ba.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ba.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ba.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var a=new Int32Array(e+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var u=e,d=0;d<t.length;d++){var m=t[d];a[3+d]=u,a.set(m,u),u+=m.length}return a[3+t.length]=u,a.set(this.keys,u),a[3+t.length+1]=u+=this.keys.length,a.set(this.bboxes,u),u+=this.bboxes.length,a.buffer};const Gu={};function Rt(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Gu[e]={klass:t,omit:i.omit||[]}}Rt(Object,"Object"),Dc.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},Dc.deserialize=function(t){return new Dc(t.buffer)},Object.defineProperty(Dc,"name",{value:"Grid"}),Rt(Dc,"Grid"),Rt(bi,"Color"),Rt(Error,"Error"),Rt(so,"AJAXError"),Rt(uo,"ResolvedImage"),Rt(Tl,"StylePropertyFunction"),Rt(va,"StyleExpression",{omit:["_evaluator"]}),Rt(Ys,"ZoomDependentExpression"),Rt(su,"ZoomConstantExpression"),Rt(as,"CompoundExpression",{omit:["_evaluate"]});for(const t in Mo)Gu[Mo[t]._classRegistryKey]||Rt(Mo[t],`Expression${t}`);function cd(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function fu(t){return B.ImageBitmap&&t instanceof B.ImageBitmap}function pu(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(cd(t)||fu(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof B.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(pu(r,e));return i}if(typeof t=="object"){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const a=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const u in t)t.hasOwnProperty(u)&&(Gu[r].omit.indexOf(u)>=0||(a[u]=pu(t[u],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(a.$name=r),a}throw new Error("can't serialize object of type "+typeof t)}function mu(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||cd(t)||fu(t)||ArrayBuffer.isView(t)||t instanceof B.ImageData)return t;if(Array.isArray(t))return t.map(mu);if(typeof t=="object"){const e=t.$name||"Object",{klass:i}=Gu[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const a of Object.keys(t))a!=="$name"&&(r[a]=mu(t[a]));return r}throw new Error("can't deserialize object of type "+typeof t)}const _u=t=>t>=1536&&t<=1791,wa=t=>t>=1872&&t<=1919,yh=t=>t>=2208&&t<=2303,ud=t=>t>=11904&&t<=12031,vh=t=>t>=12032&&t<=12255,xh=t=>t>=12272&&t<=12287,gu=t=>t>=12288&&t<=12351,Ta=t=>t>=12352&&t<=12447,Lc=t=>t>=12448&&t<=12543,ju=t=>t>=12544&&t<=12591,xs=t=>t>=12704&&t<=12735,hd=t=>t>=12736&&t<=12783,bh=t=>t>=12784&&t<=12799,dd=t=>t>=12800&&t<=13055,fd=t=>t>=13056&&t<=13311,pd=t=>t>=13312&&t<=19903,Wu=t=>t>=19968&&t<=40959,wh=t=>t>=40960&&t<=42127,md=t=>t>=42128&&t<=42191,_d=t=>t>=44032&&t<=55215,qu=t=>t>=63744&&t<=64255,Il=t=>t>=64336&&t<=65023,Cl=t=>t>=65040&&t<=65055,c=t=>t>=65072&&t<=65103,n=t=>t>=65104&&t<=65135,s=t=>t>=65136&&t<=65279,h=t=>t>=65280&&t<=65519;function p(t){for(const e of t)if(E(e.charCodeAt(0)))return!0;return!1}function _(t){for(const e of t)if(!b(e.charCodeAt(0)))return!1;return!0}function b(t){return!(_u(t)||wa(t)||yh(t)||Il(t)||s(t))}function E(t){return!(t!==746&&t!==747&&(t<4352||!(xs(t)||ju(t)||c(t)&&!(t>=65097&&t<=65103)||qu(t)||fd(t)||ud(t)||hd(t)||!(!gu(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||pd(t)||Wu(t)||dd(t)||(e=>e>=12592&&e<=12687)(t)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||_d(t)||Ta(t)||xh(t)||(e=>e>=12688&&e<=12703)(t)||vh(t)||bh(t)||Lc(t)&&t!==12540||!(!h(t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!n(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||Cl(t)||(e=>e>=19904&&e<=19967)(t)||wh(t)||md(t))))}function S(t){return!(E(t)||function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||gu(e)||Lc(e)||(i=>i>=57344&&i<=63743)(e)||c(e)||n(e)||h(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function O(t){return t>=1424&&t<=2303||Il(t)||s(t)}function R(t,e){return!(!e&&O(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(i=>i>=6016&&i<=6143)(t))}function U(t){for(const e of t)if(O(e.charCodeAt(0)))return!0;return!1}const $="deferred",J="loading",Y="loaded";let Q=null,ee="unavailable",W=null;const ae=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(ee="error"),Q&&Q(t)};function oe(){le.fire(new Wi("pluginStateChange",{pluginStatus:ee,pluginURL:W}))}const le=new co,ve=function(){return ee},ge=function(){if(ee!==$||!W)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ee=J,oe(),W&&is({url:W},t=>{t?ae(t):(ee=Y,oe())})},we={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ee===Y||we.applyArabicShaping!=null,isLoading:()=>ee===J,setState(t){ee=t.pluginStatus,W=t.pluginURL},isParsed:()=>we.applyArabicShaping!=null&&we.processBidirectionalText!=null&&we.processStyledBidirectionalText!=null,getPluginURL:()=>W};class ke{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,r){for(const a of i)if(!R(a.charCodeAt(0),r))return!1;return!0}(e,we.isLoaded())}}class Be{constructor(e,i){this.property=e,this.value=i,this.expression=function(r,a){if(gs(r))return new Tl(r,a);if($l(r)){const u=fs(r,a);if(u.result==="error")throw new Error(u.value.map(d=>`${d.key}: ${d.message}`).join(", "));return u.value}{let u=r;return typeof r=="string"&&a.type==="color"&&(u=bi.parse(r)),{kind:"constant",evaluate:()=>u}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class je{constructor(e){this.property=e,this.value=new Be(e,void 0)}transitioned(e,i){return new Ne(this.property,this.value,i,rn({},e.transition,this.transition),e.now)}untransitioned(){return new Ne(this.property,this.value,null,{},0)}}class Tt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return zr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new je(this._values[e].property)),this._values[e].value=new Be(this._values[e].property,i===null?void 0:zr(i))}getTransition(e){return zr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new je(this._values[e].property)),this._values[e].transition=zr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r);const a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){const r=new st(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].transitioned(e,i._values[a]);return r}untransitioned(){const e=new st(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Ne{constructor(e,i,r,a,u){const d=a.delay||0,m=a.duration||0;u=u||0,this.property=e,this.value=i,this.begin=u+d,this.end=this.begin+m,e.specification.transition&&(a.delay||a.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){const a=e.now||0,u=this.value.possiblyEvaluate(e,i,r),d=this.prior;if(d){if(a>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(a<this.begin)return d.possiblyEvaluate(e,i,r);{const m=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,i,r),u,Ti(m))}}return u}}class st{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){const a=new Ve(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,i,r);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class He{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return zr(this._values[e].value)}setValue(e,i){this._values[e]=new Be(this._values[e].property,i===null?void 0:zr(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);r!==void 0&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){const a=new Ve(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,i,r);return a}}class mt{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,r,a){return this.property.evaluate(this.value,this.parameters,e,i,r,a)}}class Ve{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Oe{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){const a=fa[this.specification.type];return a?a(e,i,r):e}}class Ze{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,a){return new mt(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},r,a)}:e.expression,i)}interpolate(e,i,r){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new mt(this,{kind:"constant",value:void 0},e.parameters);const a=fa[this.specification.type];return a?new mt(this,{kind:"constant",value:a(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,a,u,d){return e.kind==="constant"?e.value:e.evaluate(i,r,a,u,d)}}class ut{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,a){return!!e.expression.evaluate(i,null,{},r,a)}interpolate(){return!1}}class pt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new ke(0,{});for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const u=this.defaultPropertyValues[r]=new Be(a,void 0),d=this.defaultTransitionablePropertyValues[r]=new je(a);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=u.possiblyEvaluate(i)}}}function Yt(t,e){return 256*(t=ii(Math.floor(t),0,255))+ii(Math.floor(e),0,255)}Rt(Ze,"DataDrivenProperty"),Rt(Oe,"DataConstantProperty"),Rt(ut,"ColorRampProperty");const zi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Vt{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ei(t,e=1){let i=0,r=0;return{members:t.map(a=>{const u=zi[a.type].BYTES_PER_ELEMENT,d=i=qi(i,Math.max(e,u)),m=a.components||1;return r=Math.max(r,u),i+=u*m,{name:a.name,type:a.type,components:m,offset:d}}),size:qi(i,Math.max(r,e)),alignment:e}}function qi(t,e){return Math.ceil(t/e)*e}class si extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const a=2*e;return this.int16[a+0]=i,this.int16[a+1]=r,e}}si.prototype.bytesPerElement=4,Rt(si,"StructArrayLayout2i4");class dn extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r)}emplace(e,i,r,a){const u=3*e;return this.int16[u+0]=i,this.int16[u+1]=r,this.int16[u+2]=a,e}}dn.prototype.bytesPerElement=6,Rt(dn,"StructArrayLayout3i6");class xn extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,a)}emplace(e,i,r,a,u){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=r,this.int16[d+2]=a,this.int16[d+3]=u,e}}xn.prototype.bytesPerElement=8,Rt(xn,"StructArrayLayout4i8");class Fn extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,u,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,r,a,u,d,m)}emplace(e,i,r,a,u,d,m,y){const v=6*e,A=12*e,I=3*e;return this.int16[v+0]=i,this.int16[v+1]=r,this.uint8[A+4]=a,this.uint8[A+5]=u,this.uint8[A+6]=d,this.uint8[A+7]=m,this.float32[I+2]=y,e}}Fn.prototype.bytesPerElement=12,Rt(Fn,"StructArrayLayout2i4ub1f12");class In extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,a)}emplace(e,i,r,a,u){const d=4*e;return this.float32[d+0]=i,this.float32[d+1]=r,this.float32[d+2]=a,this.float32[d+3]=u,e}}In.prototype.bytesPerElement=16,Rt(In,"StructArrayLayout4f16");class Sr extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,r,a,u)}emplace(e,i,r,a,u,d){const m=6*e,y=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=r,this.uint16[m+2]=a,this.uint16[m+3]=u,this.float32[y+2]=d,e}}Sr.prototype.bytesPerElement=12,Rt(Sr,"StructArrayLayout4ui1f12");class Oo extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,a)}emplace(e,i,r,a,u){const d=4*e;return this.uint16[d+0]=i,this.uint16[d+1]=r,this.uint16[d+2]=a,this.uint16[d+3]=u,e}}Oo.prototype.bytesPerElement=8,Rt(Oo,"StructArrayLayout4ui8");class bs extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,r,a,u,d)}emplace(e,i,r,a,u,d,m){const y=6*e;return this.int16[y+0]=i,this.int16[y+1]=r,this.int16[y+2]=a,this.int16[y+3]=u,this.int16[y+4]=d,this.int16[y+5]=m,e}}bs.prototype.bytesPerElement=12,Rt(bs,"StructArrayLayout6i12");class ws extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,u,d,m,y,v,A,I,L){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,r,a,u,d,m,y,v,A,I,L)}emplace(e,i,r,a,u,d,m,y,v,A,I,L,k){const F=12*e;return this.int16[F+0]=i,this.int16[F+1]=r,this.int16[F+2]=a,this.int16[F+3]=u,this.uint16[F+4]=d,this.uint16[F+5]=m,this.uint16[F+6]=y,this.uint16[F+7]=v,this.int16[F+8]=A,this.int16[F+9]=I,this.int16[F+10]=L,this.int16[F+11]=k,e}}ws.prototype.bytesPerElement=24,Rt(ws,"StructArrayLayout4i4ui4i24");class $n extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,u,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,r,a,u,d)}emplace(e,i,r,a,u,d,m){const y=10*e,v=5*e;return this.int16[y+0]=i,this.int16[y+1]=r,this.int16[y+2]=a,this.float32[v+2]=u,this.float32[v+3]=d,this.float32[v+4]=m,e}}$n.prototype.bytesPerElement=20,Rt($n,"StructArrayLayout3i3f20");class Ln extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Ln.prototype.bytesPerElement=4,Rt(Ln,"StructArrayLayout1ul4");class sn extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,u,d,m,y,v,A,I,L,k){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,r,a,u,d,m,y,v,A,I,L,k)}emplace(e,i,r,a,u,d,m,y,v,A,I,L,k,F){const G=20*e,X=10*e;return this.int16[G+0]=i,this.int16[G+1]=r,this.int16[G+2]=a,this.int16[G+3]=u,this.int16[G+4]=d,this.float32[X+3]=m,this.float32[X+4]=y,this.float32[X+5]=v,this.float32[X+6]=A,this.int16[G+14]=I,this.uint32[X+8]=L,this.uint16[G+18]=k,this.uint16[G+19]=F,e}}sn.prototype.bytesPerElement=40,Rt(sn,"StructArrayLayout5i4f1i1ul2ui40");class mr extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,u,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,r,a,u,d,m)}emplace(e,i,r,a,u,d,m,y){const v=8*e;return this.int16[v+0]=i,this.int16[v+1]=r,this.int16[v+2]=a,this.int16[v+4]=u,this.int16[v+5]=d,this.int16[v+6]=m,this.int16[v+7]=y,e}}mr.prototype.bytesPerElement=16,Rt(mr,"StructArrayLayout3i2i2i16");class po extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,r,a,u)}emplace(e,i,r,a,u,d){const m=4*e,y=8*e;return this.float32[m+0]=i,this.float32[m+1]=r,this.float32[m+2]=a,this.int16[y+6]=u,this.int16[y+7]=d,e}}po.prototype.bytesPerElement=16,Rt(po,"StructArrayLayout2f1f2i16");class Wn extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,a)}emplace(e,i,r,a,u){const d=12*e,m=3*e;return this.uint8[d+0]=i,this.uint8[d+1]=r,this.float32[m+1]=a,this.float32[m+2]=u,e}}Wn.prototype.bytesPerElement=12,Rt(Wn,"StructArrayLayout2ub2f12");class to extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r)}emplace(e,i,r,a){const u=3*e;return this.float32[u+0]=i,this.float32[u+1]=r,this.float32[u+2]=a,e}}to.prototype.bytesPerElement=12,Rt(to,"StructArrayLayout3f12");class mo extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,r)}emplace(e,i,r,a){const u=3*e;return this.uint16[u+0]=i,this.uint16[u+1]=r,this.uint16[u+2]=a,e}}mo.prototype.bytesPerElement=6,Rt(mo,"StructArrayLayout3ui6");class Ea extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,u,d,m,y,v,A,I,L,k,F,G,X,se,pe,re,fe,xe){const ye=this.length;return this.resize(ye+1),this.emplace(ye,e,i,r,a,u,d,m,y,v,A,I,L,k,F,G,X,se,pe,re,fe,xe)}emplace(e,i,r,a,u,d,m,y,v,A,I,L,k,F,G,X,se,pe,re,fe,xe,ye){const We=30*e,Ge=15*e,nt=60*e;return this.int16[We+0]=i,this.int16[We+1]=r,this.int16[We+2]=a,this.float32[Ge+2]=u,this.float32[Ge+3]=d,this.uint16[We+8]=m,this.uint16[We+9]=y,this.uint32[Ge+5]=v,this.uint32[Ge+6]=A,this.uint32[Ge+7]=I,this.uint16[We+16]=L,this.uint16[We+17]=k,this.uint16[We+18]=F,this.float32[Ge+10]=G,this.float32[Ge+11]=X,this.uint8[nt+48]=se,this.uint8[nt+49]=pe,this.uint8[nt+50]=re,this.uint32[Ge+13]=fe,this.int16[We+28]=xe,this.uint8[nt+58]=ye,e}}Ea.prototype.bytesPerElement=60,Rt(Ea,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Pc extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,u,d,m,y,v,A,I,L,k,F,G,X,se,pe,re,fe,xe,ye,We,Ge,nt,vt,Xe,at,ct,gt){const bt=this.length;return this.resize(bt+1),this.emplace(bt,e,i,r,a,u,d,m,y,v,A,I,L,k,F,G,X,se,pe,re,fe,xe,ye,We,Ge,nt,vt,Xe,at,ct,gt)}emplace(e,i,r,a,u,d,m,y,v,A,I,L,k,F,G,X,se,pe,re,fe,xe,ye,We,Ge,nt,vt,Xe,at,ct,gt,bt){const Ke=38*e,It=19*e;return this.int16[Ke+0]=i,this.int16[Ke+1]=r,this.int16[Ke+2]=a,this.float32[It+2]=u,this.float32[It+3]=d,this.int16[Ke+8]=m,this.int16[Ke+9]=y,this.int16[Ke+10]=v,this.int16[Ke+11]=A,this.int16[Ke+12]=I,this.int16[Ke+13]=L,this.uint16[Ke+14]=k,this.uint16[Ke+15]=F,this.uint16[Ke+16]=G,this.uint16[Ke+17]=X,this.uint16[Ke+18]=se,this.uint16[Ke+19]=pe,this.uint16[Ke+20]=re,this.uint16[Ke+21]=fe,this.uint16[Ke+22]=xe,this.uint16[Ke+23]=ye,this.uint16[Ke+24]=We,this.uint16[Ke+25]=Ge,this.uint16[Ke+26]=nt,this.uint16[Ke+27]=vt,this.uint16[Ke+28]=Xe,this.uint32[It+15]=at,this.float32[It+16]=ct,this.float32[It+17]=gt,this.float32[It+18]=bt,e}}Pc.prototype.bytesPerElement=76,Rt(Pc,"StructArrayLayout3i2f6i15ui1ul3f76");class Ro extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ro.prototype.bytesPerElement=4,Rt(Ro,"StructArrayLayout1f4");class Si extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,r,a,u)}emplace(e,i,r,a,u,d){const m=5*e;return this.float32[m+0]=i,this.float32[m+1]=r,this.float32[m+2]=a,this.float32[m+3]=u,this.float32[m+4]=d,e}}Si.prototype.bytesPerElement=20,Rt(Si,"StructArrayLayout5f20");class Xa extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,a)}emplace(e,i,r,a,u){const d=6*e;return this.uint32[3*e+0]=i,this.uint16[d+2]=r,this.uint16[d+3]=a,this.uint16[d+4]=u,e}}Xa.prototype.bytesPerElement=12,Rt(Xa,"StructArrayLayout1ul3ui12");class Ml extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=r,e}}Ml.prototype.bytesPerElement=4,Rt(Ml,"StructArrayLayout2ui4");class Ts extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Ts.prototype.bytesPerElement=2,Rt(Ts,"StructArrayLayout1ui2");class Jl extends zt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const a=2*e;return this.float32[a+0]=i,this.float32[a+1]=r,e}}Jl.prototype.bytesPerElement=8,Rt(Jl,"StructArrayLayout2f8");class Dp extends Vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Dp.prototype.size=40;class Ef extends sn{get(e){return new Dp(this,e)}}Rt(Ef,"CollisionBoxArray");class Js extends Vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Js.prototype.size=60;class Lp extends Ea{get(e){return new Js(this,e)}}Rt(Lp,"PlacedSymbolArray");class Th extends Vt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Th.prototype.size=76;class gd extends Pc{get(e){return new Th(this,e)}}Rt(gd,"SymbolInstanceArray");class Af extends Ro{getoffsetX(e){return this.float32[1*e+0]}}Rt(Af,"GlyphOffsetArray");class Sf extends si{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Rt(Sf,"SymbolLineVertexArray");class Es extends Vt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Es.prototype.size=12;class Ql extends Xa{get(e){return new Es(this,e)}}Rt(Ql,"FeatureIndexArray");class yd extends Ml{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Rt(yd,"FillExtrusionCentroidArray");const Pp=ei([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),vd=ei([{name:"a_dash",components:4,type:"Uint16"}]);var Oc={},If={get exports(){return Oc},set exports(t){Oc=t}},xd={};({get exports(){return xd},set exports(t){xd=t}}).exports=function(t,e){var i,r,a,u,d,m,y,v;for(r=t.length-(i=3&t.length),a=e,d=3432918353,m=461845907,v=0;v<r;)y=255&t.charCodeAt(v)|(255&t.charCodeAt(++v))<<8|(255&t.charCodeAt(++v))<<16|(255&t.charCodeAt(++v))<<24,++v,a=27492+(65535&(u=5*(65535&(a=(a^=y=(65535&(y=(y=(65535&y)*d+(((y>>>16)*d&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(u>>>16)&65535)<<16);switch(y=0,i){case 3:y^=(255&t.charCodeAt(v+2))<<16;case 2:y^=(255&t.charCodeAt(v+1))<<8;case 1:a^=y=(65535&(y=(y=(65535&(y^=255&t.charCodeAt(v)))*d+(((y>>>16)*d&65535)<<16)&4294967295)<<15|y>>>17))*m+(((y>>>16)*m&65535)<<16)&4294967295}return a^=t.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0};var Eh={};({get exports(){return Eh},set exports(t){Eh=t}}).exports=function(t,e){for(var i,r=t.length,a=e^r,u=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(u)|(255&t.charCodeAt(++u))<<8|(255&t.charCodeAt(++u))<<16|(255&t.charCodeAt(++u))<<24))+((1540483477*(i>>>16)&65535)<<16),a=1540483477*(65535&a)+((1540483477*(a>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++u;switch(r){case 3:a^=(255&t.charCodeAt(u+2))<<16;case 2:a^=(255&t.charCodeAt(u+1))<<8;case 1:a=1540483477*(65535&(a^=255&t.charCodeAt(u)))+((1540483477*(a>>>16)&65535)<<16)}return a=1540483477*(65535&(a^=a>>>13))+((1540483477*(a>>>16)&65535)<<16),(a^=a>>>15)>>>0};var bd=xd,Rc=Eh;If.exports=bd,Oc.murmur3=bd,Oc.murmur2=Rc;class wd{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,r,a){this.ids.push(ec(e)),this.positions.push(i,r,a)}getPositions(e){const i=ec(e);let r=0,a=this.ids.length-1;for(;r<a;){const d=r+a>>1;this.ids[d]>=i?a=d:r=d+1}const u=[];for(;this.ids[r]===i;)u.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return u}static serialize(e,i){const r=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Td(r,a,0,r.length-1),i&&i.push(r.buffer,a.buffer),{ids:r,positions:a}}static deserialize(e){const i=new wd;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function ec(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Oc(String(t))}function Td(t,e,i,r){for(;i<r;){const a=t[i+r>>1];let u=i-1,d=r+1;for(;;){do u++;while(t[u]<a);do d--;while(t[d]>a);if(u>=d)break;Ah(t,u,d),Ah(e,3*u,3*d),Ah(e,3*u+1,3*d+1),Ah(e,3*u+2,3*d+2)}d-i<r-d?(Td(t,e,i,d),i=d+1):(Td(t,e,d+1,r),r=d)}}function Ah(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}Rt(wd,"FeaturePositionMap");class Ka{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Ed extends Ka{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Op extends Ka{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class Rp extends Ka{constructor(e){super(e),this.current=bi.transparent}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const zp=new Float32Array(16),kp=new Float32Array(9),P_=new Float32Array(4);function Ad(t){return[Yt(255*t.r,255*t.g),Yt(255*t.b,255*t.a)]}class Zu{constructor(e,i,r){this.value=e,this.uniformNames=i.map(a=>`u_${a}`),this.type=r}setUniform(e,i,r,a,u){i.set(e,u,a.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new Rp(e):new Ed(e)}}class _o{constructor(e,i){this.uniformNames=i.map(r=>`u_${r}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,r,a,u){const d=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;d&&i.set(e,u,d)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Op(e):new Ed(e)}}class Eo{constructor(e,i,r,a){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(u=>({name:`a_${u}`,type:"Float32",components:r==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,r,a,u,d){const m=this.paintVertexArray.length,y=this.expression.evaluate(new ke(0),i,{},u,a,d);this.paintVertexArray.resize(e),this._setPaintValue(m,e,y)}updatePaintArray(e,i,r,a,u){const d=this.expression.evaluate({zoom:0},r,a,void 0,u);this._setPaintValue(e,i,d)}_setPaintValue(e,i,r){if(this.type==="color"){const a=Ad(r);for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,a[0],a[1])}else{for(let a=e;a<i;a++)this.paintVertexArray.emplace(a,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ya{constructor(e,i,r,a,u,d){this.expression=e,this.uniformNames=i.map(m=>`u_${m}_t`),this.type=r,this.useIntegerZoom=a,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:`a_${m}`,type:"Float32",components:r==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,r,a,u,d){const m=this.expression.evaluate(new ke(this.zoom),i,{},u,a,d),y=this.expression.evaluate(new ke(this.zoom+1),i,{},u,a,d),v=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(v,e,m,y)}updatePaintArray(e,i,r,a,u){const d=this.expression.evaluate({zoom:this.zoom},r,a,void 0,u),m=this.expression.evaluate({zoom:this.zoom+1},r,a,void 0,u);this._setPaintValue(e,i,d,m)}_setPaintValue(e,i,r,a){if(this.type==="color"){const u=Ad(r),d=Ad(a);for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,u[0],u[1],d[0],d[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,r,a);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,a,u){const d=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,m=ii(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);i.set(e,u,m)}getBinding(e,i){return new Ed(e)}}class zc{constructor(e,i,r,a,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(r==="array"?vd:Pp).members;for(let d=0;d<i.length;++d);this.paintVertexArray=new a}populatePaintArray(e,i,r){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,a,u,d){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],d)}_setPaintValues(e,i,r,a){if(!a||!r)return;const u=a[r];if(!u)return;const{tl:d,br:m,pixelRatio:y}=u;for(let v=e;v<i;v++)this.paintVertexArray.emplace(v,d[0],d[1],m[0],m[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ja{constructor(e,i,r=()=>!0){this.binders={},this._buffers=[];const a=[];for(const u in e.paint._values){if(!r(u))continue;const d=e.paint.get(u);if(!(d instanceof mt&&ji(d.property.specification)))continue;const m=Fp(u,e.type),y=d.value,v=d.property.specification.type,A=d.property.useIntegerZoom,I=u==="line-dasharray"||u.endsWith("pattern"),L=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||L)if(y.kind==="source"||L||I){const k=yu(u,v,"source");this.binders[u]=I?new zc(y,m,v,k,e.id):new Eo(y,m,v,k),a.push(`/a_${u}`)}else{const k=yu(u,v,"composite");this.binders[u]=new Ya(y,m,v,A,i,k),a.push(`/z_${u}`)}else this.binders[u]=I?new _o(y.value,m):new Zu(y.value,m,v),a.push(`/u_${u}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Eo||i instanceof Ya?i.maxValue:0}populatePaintArrays(e,i,r,a,u,d){for(const m in this.binders){const y=this.binders[m];(y instanceof Eo||y instanceof Ya||y instanceof zc)&&y.populatePaintArray(e,i,r,a,u,d)}}setConstantPatternPositions(e){for(const i in this.binders){const r=this.binders[i];r instanceof _o&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,i,r,a,u,d){let m=!1;for(const y in e){const v=i.getPositions(y);for(const A of v){const I=r.feature(A.index);for(const L in this.binders){const k=this.binders[L];if((k instanceof Eo||k instanceof Ya||k instanceof zc)&&k.expression.isStateDependent===!0){const F=a.paint.get(L);k.expression=F.value,k.updatePaintArray(A.start,A.end,I,e[y],u,d),m=!0}}}}return m}defines(){const e=[];for(const i in this.binders){const r=this.binders[i];(r instanceof Zu||r instanceof _o)&&e.push(...r.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Eo||r instanceof Ya||r instanceof zc)for(let a=0;a<r.paintVertexAttributes.length;a++)e.push(r.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Zu||r instanceof _o||r instanceof Ya)for(const a of r.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Zu||a instanceof _o||a instanceof Ya)for(const u of a.uniformNames)i.push({name:u,property:r,binding:a.getBinding(e,u)})}return i}setUniforms(e,i,r,a,u){for(const{name:d,property:m,binding:y}of r)this.binders[m].setUniform(e,y,u,a.get(m),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Eo||i instanceof Ya||i instanceof zc)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const r=this.binders[i];(r instanceof Eo||r instanceof Ya||r instanceof zc)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Eo||i instanceof Ya||i instanceof zc)&&i.destroy()}}}class Aa{constructor(e,i,r=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new Ja(a,i,r);this.needsUpload=!1,this._featureMap=new wd,this._bufferOffset=0}populatePaintArrays(e,i,r,a,u,d,m){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,i,a,u,d,m);i.id!==void 0&&this._featureMap.add(i.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,a,u){for(const d of r)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,i,d,a,u)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Bp={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Fp(t,e){return Bp[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const O_={"line-pattern":{source:Sr,composite:Sr},"fill-pattern":{source:Sr,composite:Sr},"fill-extrusion-pattern":{source:Sr,composite:Sr},"line-dasharray":{source:Oo,composite:Oo}},Np={color:{source:Jl,composite:In},number:{source:Ro,composite:Jl}};function yu(t,e,i){const r=O_[t];return r&&r[i]||Np[e][i]}Rt(Zu,"ConstantBinder"),Rt(_o,"PatternConstantBinder"),Rt(Eo,"SourceExpressionBinder"),Rt(zc,"PatternCompositeBinder"),Rt(Ya,"CompositeExpressionBinder"),Rt(Ja,"ProgramConfiguration",{omit:["_buffers"]}),Rt(Aa,"ProgramConfigurationSet");const kc="-transition";class Qa extends co{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new He(i.layout)),i.paint)){this._transitionablePaint=new Tt(i.paint);for(const r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(const r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ve(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,r={}){i!=null&&this._validate(Sl,`layers.${this.id}.layout.${e}`,e,i,r)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return hn(e,kc)?this._transitionablePaint.getTransition(e.slice(0,-kc.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,r={}){if(i!=null&&this._validate(Tf,`layers.${this.id}.paint.${e}`,e,i,r))return!1;if(hn(e,kc))return this._transitionablePaint.setTransition(e.slice(0,-kc.length),i||void 0),!1;{const a=this._transitionablePaint._values[e],u=a.value.isDataDriven(),d=a.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const m=this._transitionablePaint._values[e].value,y=m.isDataDriven(),v=hn(e,"pattern")||e==="line-dasharray";return y||u||v||this._handleOverridablePaintPropertyUpdate(e,d,m)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Yr(e,(i,r)=>!(i===void 0||r==="layout"&&!Object.keys(i).length||r==="paint"&&!Object.keys(i).length))}_validate(e,i,r,a,u={}){return(!u||u.validate!==!1)&&ld(this,e.call(ad,{key:i,layerType:this.type,objectKey:r,value:a,styleSpec:Ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof mt&&ji(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ar(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Up=ei([{name:"a_pos",components:2,type:"Int16"}],4),Vp=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class cr{constructor(e=[]){this.segments=e}prepareSegment(e,i,r,a){let u=this.segments[this.segments.length-1];return e>cr.MAX_VERTEX_ARRAY_LENGTH&&Oi(`Max vertices per segment is ${cr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>cr.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==a)&&(u={vertexOffset:i.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},a!==void 0&&(u.sortKey=a),this.segments.push(u)),u}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,a){return new cr([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:a,vaos:{},sortKey:0}])}}cr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Rt(cr,"SegmentVector");var di=8192;class el{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof an?new an(e.lng,e.lat):an.convert(e),this}setSouthWest(e){return this._sw=e instanceof an?new an(e.lng,e.lat):an.convert(e),this}extend(e){const i=this._sw,r=this._ne;let a,u;if(e instanceof an)a=e,u=e;else{if(!(e instanceof el))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(el.convert(e)):this.extend(an.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(an.convert(e)):this;if(a=e._sw,u=e._ne,!a||!u)return this}return i||r?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),r.lng=Math.max(u.lng,r.lng),r.lat=Math.max(u.lat,r.lat)):(this._sw=new an(a.lng,a.lat),this._ne=new an(u.lng,u.lat)),this}getCenter(){return new an((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new an(this.getWest(),this.getNorth())}getSouthEast(){return new an(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=an.convert(e);let a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&a}static convert(e){return!e||e instanceof el?e:new el(e)}}var Hu=1e-6,zo=typeof Float32Array<"u"?Float32Array:Array;function Gp(){var t=new zo(9);return zo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Cf(t,e,i){var r=e[0],a=e[1],u=e[2],d=e[3],m=e[4],y=e[5],v=e[6],A=e[7],I=e[8],L=i[0],k=i[1],F=i[2],G=i[3],X=i[4],se=i[5],pe=i[6],re=i[7],fe=i[8];return t[0]=L*r+k*d+F*v,t[1]=L*a+k*m+F*A,t[2]=L*u+k*y+F*I,t[3]=G*r+X*d+se*v,t[4]=G*a+X*m+se*A,t[5]=G*u+X*y+se*I,t[6]=pe*r+re*d+fe*v,t[7]=pe*a+re*m+fe*A,t[8]=pe*u+re*y+fe*I,t}function As(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Sd(t,e){var i=e[0],r=e[1],a=e[2],u=e[3],d=e[4],m=e[5],y=e[6],v=e[7],A=e[8],I=e[9],L=e[10],k=e[11],F=e[12],G=e[13],X=e[14],se=e[15],pe=i*m-r*d,re=i*y-a*d,fe=i*v-u*d,xe=r*y-a*m,ye=r*v-u*m,We=a*v-u*y,Ge=A*G-I*F,nt=A*X-L*F,vt=A*se-k*F,Xe=I*X-L*G,at=I*se-k*G,ct=L*se-k*X,gt=pe*ct-re*at+fe*Xe+xe*vt-ye*nt+We*Ge;return gt?(t[0]=(m*ct-y*at+v*Xe)*(gt=1/gt),t[1]=(a*at-r*ct-u*Xe)*gt,t[2]=(G*We-X*ye+se*xe)*gt,t[3]=(L*ye-I*We-k*xe)*gt,t[4]=(y*vt-d*ct-v*nt)*gt,t[5]=(i*ct-a*vt+u*nt)*gt,t[6]=(X*fe-F*We-se*re)*gt,t[7]=(A*We-L*fe+k*re)*gt,t[8]=(d*at-m*vt+v*Ge)*gt,t[9]=(r*vt-i*at-u*Ge)*gt,t[10]=(F*ye-G*fe+se*pe)*gt,t[11]=(I*fe-A*ye-k*pe)*gt,t[12]=(m*nt-d*Xe-y*Ge)*gt,t[13]=(i*Xe-r*nt+a*Ge)*gt,t[14]=(G*re-F*xe-X*pe)*gt,t[15]=(A*xe-I*re+L*pe)*gt,t):null}function tc(t,e,i){var r=e[0],a=e[1],u=e[2],d=e[3],m=e[4],y=e[5],v=e[6],A=e[7],I=e[8],L=e[9],k=e[10],F=e[11],G=e[12],X=e[13],se=e[14],pe=e[15],re=i[0],fe=i[1],xe=i[2],ye=i[3];return t[0]=re*r+fe*m+xe*I+ye*G,t[1]=re*a+fe*y+xe*L+ye*X,t[2]=re*u+fe*v+xe*k+ye*se,t[3]=re*d+fe*A+xe*F+ye*pe,t[4]=(re=i[4])*r+(fe=i[5])*m+(xe=i[6])*I+(ye=i[7])*G,t[5]=re*a+fe*y+xe*L+ye*X,t[6]=re*u+fe*v+xe*k+ye*se,t[7]=re*d+fe*A+xe*F+ye*pe,t[8]=(re=i[8])*r+(fe=i[9])*m+(xe=i[10])*I+(ye=i[11])*G,t[9]=re*a+fe*y+xe*L+ye*X,t[10]=re*u+fe*v+xe*k+ye*se,t[11]=re*d+fe*A+xe*F+ye*pe,t[12]=(re=i[12])*r+(fe=i[13])*m+(xe=i[14])*I+(ye=i[15])*G,t[13]=re*a+fe*y+xe*L+ye*X,t[14]=re*u+fe*v+xe*k+ye*se,t[15]=re*d+fe*A+xe*F+ye*pe,t}function Sh(t,e,i){var r,a,u,d,m,y,v,A,I,L,k,F,G=i[0],X=i[1],se=i[2];return e===t?(t[12]=e[0]*G+e[4]*X+e[8]*se+e[12],t[13]=e[1]*G+e[5]*X+e[9]*se+e[13],t[14]=e[2]*G+e[6]*X+e[10]*se+e[14],t[15]=e[3]*G+e[7]*X+e[11]*se+e[15]):(a=e[1],u=e[2],d=e[3],m=e[4],y=e[5],v=e[6],A=e[7],I=e[8],L=e[9],k=e[10],F=e[11],t[0]=r=e[0],t[1]=a,t[2]=u,t[3]=d,t[4]=m,t[5]=y,t[6]=v,t[7]=A,t[8]=I,t[9]=L,t[10]=k,t[11]=F,t[12]=r*G+m*X+I*se+e[12],t[13]=a*G+y*X+L*se+e[13],t[14]=u*G+v*X+k*se+e[14],t[15]=d*G+A*X+F*se+e[15]),t}function Bc(t,e,i){var r=i[0],a=i[1],u=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function tl(t,e,i){var r=Math.sin(i),a=Math.cos(i),u=e[4],d=e[5],m=e[6],y=e[7],v=e[8],A=e[9],I=e[10],L=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*a+v*r,t[5]=d*a+A*r,t[6]=m*a+I*r,t[7]=y*a+L*r,t[8]=v*a-u*r,t[9]=A*a-d*r,t[10]=I*a-m*r,t[11]=L*a-y*r,t}function Ih(t,e,i){var r=Math.sin(i),a=Math.cos(i),u=e[0],d=e[1],m=e[2],y=e[3],v=e[8],A=e[9],I=e[10],L=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*a-v*r,t[1]=d*a-A*r,t[2]=m*a-I*r,t[3]=y*a-L*r,t[8]=u*r+v*a,t[9]=d*r+A*a,t[10]=m*r+I*a,t[11]=y*r+L*a,t}function Mf(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function jp(t,e,i){var r,a,u,d=i[0],m=i[1],y=i[2],v=Math.hypot(d,m,y);return v<Hu?null:(d*=v=1/v,m*=v,y*=v,r=Math.sin(e),a=Math.cos(e),t[0]=d*d*(u=1-a)+a,t[1]=m*d*u+y*r,t[2]=y*d*u-m*r,t[3]=0,t[4]=d*m*u-y*r,t[5]=m*m*u+a,t[6]=y*m*u+d*r,t[7]=0,t[8]=d*y*u+m*r,t[9]=m*y*u-d*r,t[10]=y*y*u+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Wp=tc;function Df(){var t=new zo(3);return zo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function qp(t){var e=new zo(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Qs(t){return Math.hypot(t[0],t[1],t[2])}function Fc(t,e,i){var r=new zo(3);return r[0]=t,r[1]=e,r[2]=i,r}function il(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function Ch(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Mh(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Dl(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function vi(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function Ho(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function vu(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Ur(t,e){var i=e[0],r=e[1],a=e[2],u=i*i+r*r+a*a;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t}function Sa(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Dh(t,e,i){var r=e[0],a=e[1],u=e[2],d=i[0],m=i[1],y=i[2];return t[0]=a*y-u*m,t[1]=u*d-r*y,t[2]=r*m-a*d,t}function _r(t,e,i){var r=e[0],a=e[1],u=e[2],d=i[3]*r+i[7]*a+i[11]*u+i[15];return t[0]=(i[0]*r+i[4]*a+i[8]*u+i[12])/(d=d||1),t[1]=(i[1]*r+i[5]*a+i[9]*u+i[13])/d,t[2]=(i[2]*r+i[6]*a+i[10]*u+i[14])/d,t}function ko(t,e,i){var r=i[0],a=i[1],u=i[2],d=e[0],m=e[1],y=e[2],v=a*y-u*m,A=u*d-r*y,I=r*m-a*d,L=a*I-u*A,k=u*v-r*I,F=r*A-a*v,G=2*i[3];return A*=G,I*=G,k*=2,F*=2,t[0]=d+(v*=G)+(L*=2),t[1]=m+A+k,t[2]=y+I+F,t}var Lh,nl=Ch,Zp=Mh,R_=Qs;function Lf(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Hp(t,e){var i=e[0],r=e[1],a=e[2],u=e[3],d=i*i+r*r+a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),t[0]=i*d,t[1]=r*d,t[2]=a*d,t[3]=u*d,t}function xu(t,e,i){var r=e[0],a=e[1],u=e[2],d=e[3];return t[0]=i[0]*r+i[4]*a+i[8]*u+i[12]*d,t[1]=i[1]*r+i[5]*a+i[9]*u+i[13]*d,t[2]=i[2]*r+i[6]*a+i[10]*u+i[14]*d,t[3]=i[3]*r+i[7]*a+i[11]*u+i[15]*d,t}function $p(){var t=new zo(4);return zo!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Ll(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function $o(t,e,i){i*=.5;var r=e[0],a=e[1],u=e[2],d=e[3],m=Math.sin(i),y=Math.cos(i);return t[0]=r*y+d*m,t[1]=a*y+u*m,t[2]=u*y-a*m,t[3]=d*y-r*m,t}function Id(t,e,i){i*=.5;var r=e[0],a=e[1],u=e[2],d=e[3],m=Math.sin(i),y=Math.cos(i);return t[0]=r*y-u*m,t[1]=a*y+d*m,t[2]=u*y+r*m,t[3]=d*y-a*m,t}Df(),Lh=new zo(4),zo!=Float32Array&&(Lh[0]=0,Lh[1]=0,Lh[2]=0,Lh[3]=0);var z_=Hp;Df(),Fc(1,0,0),Fc(0,1,0),$p(),$p(),Gp();const Pf=ei([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Xp}=Pf,Kp=ei([{name:"a_pos_3",components:3,type:"Int16"}]);var ic=ei([{name:"a_pos",type:"Int16",components:2}]);class Cd{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const a=Sa(i,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return r[0]=this.pos[0]+this.dir[0]*u,r[1]=this.pos[1]+this.dir[1]*u,r[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,i,r){if(function(k,F){var G=k[0],X=k[1],se=k[2],pe=F[0],re=F[1],fe=F[2];return Math.abs(G-pe)<=Hu*Math.max(1,Math.abs(G),Math.abs(pe))&&Math.abs(X-re)<=Hu*Math.max(1,Math.abs(X),Math.abs(re))&&Math.abs(se-fe)<=Hu*Math.max(1,Math.abs(se),Math.abs(fe))}(this.pos,e)||i===0)return r[0]=r[1]=r[2]=0,!1;const[a,u,d]=this.dir,m=this.pos[0]-e[0],y=this.pos[1]-e[1],v=this.pos[2]-e[2],A=a*a+u*u+d*d,I=2*(m*a+y*u+v*d),L=I*I-4*A*(m*m+y*y+v*v-i*i);if(L<0){const k=Math.max(-I/2,0),F=m+a*k,G=y+u*k,X=v+d*k,se=Math.hypot(F,G,X);return r[0]=F*i/se,r[1]=G*i/se,r[2]=X*i/se,!1}{const k=(-I-Math.sqrt(L))/(2*A);if(k<0){const F=Math.hypot(m,y,v);return r[0]=m*i/F,r[1]=y*i/F,r[2]=v*i/F,!1}return r[0]=m+a*k,r[1]=y+u*k,r[2]=v+d*k,!0}}}class Md{constructor(e,i,r,a,u){this.TL=e,this.TR=i,this.BR=r,this.BL=a,this.horizon=u}static fromInvProjectionMatrix(e,i,r){const a=[-1,1,1],u=[1,1,1],d=[1,-1,1],m=[-1,-1,1],y=_r(a,a,e),v=_r(u,u,e),A=_r(d,d,e),I=_r(m,m,e);return new Md(y,v,A,I,i/r)}}class Of{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,r,a){const u=Math.pow(2,r),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const v=xu([],y,e),A=1/v[3]/i*u;return function(I,L,k){return I[0]=L[0]*k[0],I[1]=L[1]*k[1],I[2]=L[2]*k[2],I[3]=L[3]*k[3],I}(v,v,[A,A,a?1/v[3]:A,A])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const v=Ur([],Dh([],nl([],d[y[0]],d[y[1]]),nl([],d[y[2]],d[y[1]]))),A=-Sa(v,d[y[1]]);return v.concat(A)});return new Of(d,m)}}class Xo{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const a of e)Dl(i,i,a),vi(r,r,a);return new Xo(i,r)}static applyTransform(e,i){const r=e.getCorners();for(let a=0;a<r.length;++a)_r(r[a],r[a],i);return Xo.fromPoints(r)}constructor(e,i){this.min=e,this.max=i,this.center=Ho([],il([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=qp(this.min),a=qp(this.max);for(let u=0;u<i.length;u++)r[u]=i[u]?this.min[u]:this.center[u],a[u]=i[u]?this.center[u]:this.max[u];return a[2]=this.max[2],new Xo(r,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let r=!0;for(let a=0;a<e.planes.length;a++){const u=e.planes[a];let d=0;for(let m=0;m<i.length;m++)d+=Sa(u,i[m])+u[3]>=0;if(d===0)return 0;d!==i.length&&(r=!1)}if(r)return 2;for(let a=0;a<3;a++){let u=Number.MAX_VALUE,d=-Number.MAX_VALUE;for(let m=0;m<e.points.length;m++){const y=e.points[m][a]-this.min[a];u=Math.min(u,y),d=Math.max(d,y)}if(d<0||u>this.max[a]-this.min[a])return 0}return 1}}const Pl=di/Math.PI/2,bu=64,$u=[bu,32,16],ea=-Pl,Ia=Pl,Rf=[new Xo([ea,ea,ea],[Ia,Ia,Ia]),new Xo([ea,ea,ea],[0,0,Ia]),new Xo([0,ea,ea],[Ia,0,Ia]),new Xo([ea,0,ea],[0,Ia,Ia]),new Xo([0,0,ea],[Ia,Ia,Ia])];function Ph(t){return t*Pl/zh}function Xu(t,e,i,r=!0){const a=Ho([],t._camera.position,t.worldSize),u=[e,i,1,1];xu(u,u,t.pixelMatrixInverse),Lf(u,u,1/u[3]);const d=Ur([],nl([],u,a)),m=t.globeMatrix,y=[m[12],m[13],m[14]],v=nl([],y,a),A=Qs(v),I=Ur([],v),L=t.worldSize/(2*Math.PI),k=Sa(I,d),F=Math.asin(L/A);if(F<Math.acos(k)){if(!r)return null;const vt=[],Xe=[];Ho(vt,d,A/k),Ur(Xe,nl(Xe,vt,v)),Ur(d,il(d,v,Ho(d,Xe,Math.tan(F)*A)))}const G=[];new Cd(a,d).closestPointOnSphere(y,L,G);const X=Ur([],tn(m,0)),se=Ur([],tn(m,1)),pe=Ur([],tn(m,2)),re=Sa(X,G),fe=Sa(se,G),xe=Sa(pe,G),ye=Ut(Math.asin(-fe/L));let We=Ut(Math.atan2(re,xe));We=t.center.lng+function(vt,Xe){const at=(Xe-vt+180)%360-180;return at<-180?at+360:at}(t.center.lng,We);const Ge=Rl(We),nt=ii(zl(ye),0,1);return new Qu(Ge,nt)}class zf{constructor(e,i,r){this.a=nl([],e,r),this.b=nl([],i,r),this.center=r;const a=Ur([],this.a),u=Ur([],this.b);this.angle=Math.acos(Sa(a,u))}}function Dd(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(r,a,u,d){const m=Math.sin(u);return r*(Math.sin((1-d)*u)/m)+a*(Math.sin(d*u)/m)}(t.a[e],t.b[e],t.angle,ii(i,0,1))+t.center[e]}function rl(t){if(t.z<=1)return Rf[t.z+2*t.y+t.x];const e=Pd(Ld(t));return Xo.fromPoints(e)}function Ol(t,e,i){return Ho(t,t,1-i),vu(t,t,e,i)}function kf(t,e){const i=Ju(e.zoom);if(i===0)return rl(t);const r=Ld(t),a=Pd(r),u=Rl(r.getWest())*e.worldSize,d=Rl(r.getEast())*e.worldSize,m=zl(r.getNorth())*e.worldSize,y=zl(r.getSouth())*e.worldSize,v=[u,m,0],A=[d,m,0],I=[u,y,0],L=[d,y,0],k=Sd([],e.globeMatrix);return _r(v,v,k),_r(A,A,k),_r(I,I,k),_r(L,L,k),a[0]=Ol(a[0],I,i),a[1]=Ol(a[1],L,i),a[2]=Ol(a[2],A,i),a[3]=Ol(a[3],v,i),Xo.fromPoints(a)}function ol(t,e,i){for(const r of t)_r(r,r,e),Ho(r,r,i)}function wu(t,e,i){const r=e/t.worldSize,a=t.globeMatrix;if(i.z<=1){const Ge=rl(i).getCorners();return ol(Ge,a,r),Xo.fromPoints(Ge)}const u=Ld(i),d=Pd(u);ol(d,a,r);const m=Number.MAX_VALUE,y=[-m,-m,-m],v=[m,m,m];if(u.contains(t.center)){for(const vt of d)Dl(v,v,vt),vi(y,y,vt);y[2]=0;const Ge=t.point,nt=[Ge.x*r,Ge.y*r,0];return Dl(v,v,nt),vi(y,y,nt),new Xo(v,y)}const A=[a[12]*r,a[13]*r,a[14]*r],I=u.getCenter(),L=ii(t.center.lat,-Xn,Xn),k=ii(I.lat,-Xn,Xn),F=Rl(t.center.lng),G=zl(L);let X=F-Rl(I.lng);const se=G-zl(k);X>.5?X-=1:X<-.5&&(X+=1);let pe=0;Math.abs(X)>Math.abs(se)?pe=X>=0?1:3:(pe=se>=0?0:2,vu(A,A,[a[4]*r,a[5]*r,a[6]*r],-Math.sin(Ht(se>=0?u.getSouth():u.getNorth()))*Pl));const re=d[pe],fe=d[(pe+1)%4],xe=new zf(re,fe,A),ye=[Dd(xe,0)||re[0],Dd(xe,1)||re[1],Dd(xe,2)||re[2]],We=Ju(t.zoom);if(We>0){const Ge=function({x:vt,y:Xe,z:at},ct,gt,bt,Ke){const It=1/(1<<at);let hi=vt*It,kt=hi+It,$t=Xe*It,Ct=$t+It,pi=0;const Ji=(hi+kt)/2-bt;return Ji>.5?pi=-1:Ji<-.5&&(pi=1),hi=((hi+pi)*ct-(bt*=ct))*gt+bt,kt=((kt+pi)*ct-bt)*gt+bt,$t=($t*ct-(Ke*=ct))*gt+Ke,Ct=(Ct*ct-Ke)*gt+Ke,[[hi,Ct,0],[kt,Ct,0],[kt,$t,0],[hi,$t,0]]}(i,e,t._pixelsPerMercatorPixel,F,G);for(let vt=0;vt<d.length;vt++)Ol(d[vt],Ge[vt],We);const nt=il([],Ge[pe],Ge[(pe+1)%4]);Ho(nt,nt,.5),Ol(ye,nt,We)}for(const Ge of d)Dl(v,v,Ge),vi(y,y,Ge);return v[2]=Math.min(re[2],fe[2]),Dl(v,v,ye),vi(y,y,ye),new Xo(v,y)}function Ld({x:t,y:e,z:i}){const r=1/(1<<i),a=new an(ta(t*r),Ao((e+1)*r)),u=new an(ta((t+1)*r),Ao(e*r));return new el(a,u)}function Pd(t){const e=Ht(t.getNorth()),i=Ht(t.getSouth()),r=Math.cos(e),a=Math.cos(i),u=Math.sin(e),d=Math.sin(i),m=t.getWest(),y=t.getEast();return[Ku(a,d,m),Ku(a,d,y),Ku(r,u,y),Ku(r,u,m)]}function Ku(t,e,i,r=Pl){return i=Ht(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function Yu(t,e,i){return Ku(Math.cos(Ht(t)),Math.sin(Ht(t)),e,i)}function Oh(t,e,i,r){const a=1<<i.z,u=(t/di+i.x)/a;return Yu(Ao((e/di+i.y)/a),ta(u),r)}function Od({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Yp=new Float64Array(16);function Rh(t){const e=Od(t),i=Mf(Yp,[e,e,e]);return Sh(i,i,((r=[])[0]=-(a=t.min)[0],r[1]=-a[1],r[2]=-a[2],r));var r,a}function Bf(t){const e=(r=t.min,(i=Yp)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i);var i,r;const a=1/Od(t);return Bc(e,e,[a,a,a])}function Jp(t,e,i,r,a){const u=function(y){const v=di/(2*Math.PI);return y/(2*Math.PI)/v}(i),d=[t,e,-i/(2*Math.PI)],m=As(new Float64Array(16));return Sh(m,m,d),Bc(m,m,[u,u,u]),tl(m,m,Ht(-a)),Ih(m,m,Ht(-r)),m}function Ju(t){return Mn(5,6,t)}function Qp(t,e){const i=Yu(e.lat,e.lng),r=function(F){const G=Yu(F._center.lat,F._center.lng);let X=Dh([],Fc(0,1,0),G);const se=jp([],-F.angle,G);X=_r(X,X,se),jp(se,-F._pitch,X);const pe=Ur([],G);return Ho(pe,pe,Ph(F.cameraToCenterDistance/F.pixelsPerMeter)),_r(pe,pe,se),il([],G,pe)}(t);return d=(a=Ch([],r,i))[0],m=a[1],y=a[2],v=(u=i)[0],A=u[1],I=u[2],k=(L=Math.sqrt(d*d+m*m+y*y)*Math.sqrt(v*v+A*A+I*I))&&Sa(a,u)/L,Math.acos(Math.min(Math.max(k,-1),1));var a,u,d,m,y,v,A,I,L,k}function Ff(t,e){return Qp(t,e)>Math.PI/2*1.01}const Nf=Ht(85),em=Math.cos(Nf),tm=Math.sin(Nf),zh=63710088e-1,im=2*Math.PI*zh;class an{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new an(pn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,r=this.lat*i,a=e.lat*i,u=Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return zh*Math.acos(Math.min(u,1))}toBounds(e=0){const i=360*e/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new el(new an(this.lng-r,this.lat-i),new an(this.lng+r,this.lat+i))}toEcef(e){const i=Ph(e);return Yu(this.lat,this.lng,Pl+i)}static convert(e){if(e instanceof an)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new an(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new an(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function Rd(t){return im*Math.cos(t*Math.PI/180)}function Rl(t){return(180+t)/360}function zl(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function sl(t,e){return t/Rd(e)}function ta(t){return 360*t-180}function Ao(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function nm(t,e){return t*Rd(Ao(e))}const Xn=85.051129;function rm(t){return 1/Math.cos(t*Math.PI/180)}class Qu{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){const r=an.convert(e);return new Qu(Rl(r.lng),zl(r.lat),sl(i,r.lat))}toLngLat(){return new an(ta(this.x),Ao(this.y))}toAltitude(){return nm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/im*rm(Ao(this.y))}}function Uf(t,e,i,r,a,u,d,m,y){const v=(e+r)/2,A=(i+a)/2,I=new $e(v,A);m(I),function(L,k,F,G,X,se){const pe=F-X,re=G-se;return Math.abs((G-k)*pe-(F-L)*re)/Math.hypot(pe,re)}(I.x,I.y,u.x,u.y,d.x,d.y)>=y?(Uf(t,e,i,v,A,u,I,m,y),Uf(t,v,A,r,a,I,d,m,y)):t.push(d)}function Vf(t,e,i){let r=t[0],a=r.x,u=r.y;e(r);const d=[r];for(let m=1;m<t.length;m++){const y=t[m],{x:v,y:A}=y;e(y),Uf(d,a,u,v,A,r,y,e,i),a=v,u=A,r=y}return d}function Gf(t,e,i,r){if(r(e,i)){const a=e.add(i)._mult(.5);Gf(t,e,a,r),Gf(t,a,i,r)}else t.push(i)}function k_(t,e){let i=t[0];const r=[i];for(let a=1;a<t.length;a++){const u=t[a];Gf(r,i,u,e),i=u}return r}const jf=Math.pow(2,14)-1,om=-jf-1;function Wf(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=ii(i,om,jf),t.y=ii(r,om,jf),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&Oi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function nc(t,e,i){const r=t.loadGeometry(),a=t.extent,u=di/a;if(e&&i&&i.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:m,x:y,y:v,projection:A}=i,I=L=>{const k=ta((e.x+L.x/a)/d),F=Ao((e.y+L.y/a)/d),G=A.project(k,F);L.x=(G.x*m-y)*a,L.y=(G.y*m-v)*a};for(let L=0;L<r.length;L++)if(t.type!==1)r[L]=Vf(r[L],I,1);else{const k=[];for(const F of r[L])F.x<0||F.x>=a||F.y<0||F.y>=a||(I(F),k.push(F));r[L]=k}}for(const d of r)for(const m of d)Wf(m,u);return r}function Tu(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?nc(t):[]}}function zd(t,e,i,r,a){t.emplaceBack(2*e+(r+1)/2,2*i+(a+1)/2)}function kd(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class qf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new si,this.indexArray=new mo,this.segments=new cr,this.programConfigurations=new Aa(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,a){const u=this.layers[0],d=[];let m=null;u.type==="circle"&&(m=u.layout.get("circle-sort-key"));for(const{feature:v,id:A,index:I,sourceLayerIndex:L}of e){const k=this.layers[0]._featureFilter.needGeometry,F=Tu(v,k);if(!this.layers[0]._featureFilter.filter(new ke(this.zoom),F,r))continue;const G=m?m.evaluate(F,{},r):void 0,X={id:A,properties:v.properties,type:v.type,sourceLayerIndex:L,index:I,geometry:k?F.geometry:nc(v,r,a),patterns:{},sortKey:G};d.push(X)}m&&d.sort((v,A)=>v.sortKey-A.sortKey);let y=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new bs,y=a.projection);for(const v of d){const{geometry:A,index:I,sourceLayerIndex:L}=v,k=e[I].feature;this.addFeature(v,A,I,i.availableImages,r,y),i.featureIndex.insert(k,A,I,L,this.index)}}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Up.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Vp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,r,a,u,d){for(const m of i)for(const y of m){const v=y.x,A=y.y;if(v<0||v>=di||A<0||A>=di)continue;if(d){const k=d.projectTilePoint(v,A,u),F=d.upVector(u,v,A),G=this.globeExtVertexArray;kd(G,k,F),kd(G,k,F),kd(G,k,F),kd(G,k,F)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=I.vertexLength;zd(this.layoutVertexArray,v,A,-1,-1),zd(this.layoutVertexArray,v,A,1,-1),zd(this.layoutVertexArray,v,A,1,1),zd(this.layoutVertexArray,v,A,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},a,u)}}function sm(t,e){for(let i=0;i<t.length;i++)if(Eu(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Eu(t,e[i]))return!0;return!!Zf(t,e)}function B_(t,e,i){return!!Eu(t,e)||!!Hf(e,t,i)}function am(t,e){if(t.length===1)return cm(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let a=0;a<r.length;a++)if(Eu(t,r[a]))return!0}for(let i=0;i<t.length;i++)if(cm(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Zf(t,e[i]))return!0;return!1}function F_(t,e,i){if(t.length>1){if(Zf(t,e))return!0;for(let r=0;r<e.length;r++)if(Hf(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(Hf(t[r],e,i))return!0;return!1}function Zf(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],a=t[i+1];for(let u=0;u<e.length-1;u++)if(N_(r,a,e[u],e[u+1]))return!0}return!1}function N_(t,e,i,r){return ro(t,i,r)!==ro(e,i,r)&&ro(t,e,i)!==ro(t,e,r)}function Hf(t,e,i){const r=i*i;if(e.length===1)return t.distSqr(e[0])<r;for(let a=1;a<e.length;a++)if(lm(t,e[a-1],e[a])<r)return!0;return!1}function lm(t,e,i){const r=e.distSqr(i);if(r===0)return t.distSqr(e);const a=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function cm(t,e){let i,r,a,u=!1;for(let d=0;d<t.length;d++){i=t[d];for(let m=0,y=i.length-1;m<i.length;y=m++)r=i[m],a=i[y],r.y>e.y!=a.y>e.y&&e.x<(a.x-r.x)*(e.y-r.y)/(a.y-r.y)+r.x&&(u=!u)}return u}function Eu(t,e){let i=!1;for(let r=0,a=t.length-1;r<t.length;a=r++){const u=t[r],d=t[a];u.y>e.y!=d.y>e.y&&e.x<(d.x-u.x)*(e.y-u.y)/(d.y-u.y)+u.x&&(i=!i)}return i}function um(t,e,i,r,a){for(const d of t)if(e<=d.x&&i<=d.y&&r>=d.x&&a>=d.y)return!0;const u=[new $e(e,i),new $e(e,a),new $e(r,a),new $e(r,i)];if(t.length>2){for(const d of u)if(Eu(t,d))return!0}for(let d=0;d<t.length-1;d++)if(U_(t[d],t[d+1],u))return!0;return!1}function U_(t,e,i){const r=i[0],a=i[2];if(t.x<r.x&&e.x<r.x||t.x>a.x&&e.x>a.x||t.y<r.y&&e.y<r.y||t.y>a.y&&e.y>a.y)return!1;const u=ro(t,e,i[0]);return u!==ro(t,e,i[1])||u!==ro(t,e,i[2])||u!==ro(t,e,i[3])}function eh(t,e,i){const r=e.paint.get(t).value;return r.kind==="constant"?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function Bd(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function hm(t,e,i,r,a){if(!e[0]&&!e[1])return t;const u=$e.convert(e)._mult(a);i==="viewport"&&u._rotate(-r);const d=[];for(let m=0;m<t.length;m++)d.push(t[m].sub(u));return d}function Fd(t,e,i,r){const a=$e.convert(t)._mult(r);return e==="viewport"&&a._rotate(-i),a}Rt(qf,"CircleBucket",{omit:["layers"]});const dm=new pt({"circle-sort-key":new Ze(Ye.layout_circle["circle-sort-key"])});var V_={paint:new pt({"circle-radius":new Ze(Ye.paint_circle["circle-radius"]),"circle-color":new Ze(Ye.paint_circle["circle-color"]),"circle-blur":new Ze(Ye.paint_circle["circle-blur"]),"circle-opacity":new Ze(Ye.paint_circle["circle-opacity"]),"circle-translate":new Oe(Ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Oe(Ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Oe(Ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Oe(Ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ze(Ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ze(Ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ze(Ye.paint_circle["circle-stroke-opacity"])}),layout:dm};function fm(t,e,i,r,a,u,d,m,y){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(y*=t.pixelToTileUnitsFactor);const v=t.tileID.canonical,A=i.projection.upVectorScale(v,i.center.lat,i.worldSize).metersToTile;for(const I of e)for(const L of I){const k=L.add(m),F=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(k.x,k.y,!0):0,G=i.projection.projectTilePoint(k.x,k.y,v);if(F>0){const re=i.projection.upVector(v,k.x,k.y);G.x+=re[0]*A*F,G.y+=re[1]*A*F,G.z+=re[2]*A*F}const X=u?k:G_(G.x,G.y,G.z,r),se=u?t.tilespaceRays.map(re=>W_(re,F)):t.queryGeometry.screenGeometry,pe=xu([],[G.x,G.y,G.z,1],r);if(!d&&u?y*=pe[3]/i.cameraToCenterDistance:d&&!u&&(y*=i.cameraToCenterDistance/pe[3]),u){const re=Ao((L.y/di+v.y)/(1<<v.z));y/=i.projection.pixelsPerMeter(re,1)/sl(1,re)}if(B_(se,X,y))return!0}return!1}function G_(t,e,i,r){const a=xu([],[t,e,i,1],r);return new $e(a[0]/a[3],a[1]/a[3])}const pm=Fc(0,0,0),j_=Fc(0,0,1);function W_(t,e){const i=Df();return pm[2]=e,t.intersectsPlane(pm,j_,i),new $e(i[0],i[1])}class mm extends qf{}function _m(t,{width:e,height:i},r,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*r)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=a,t}function $f(t,e,i){const{width:r,height:a}=e;r===t.width&&a===t.height||(Xf(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,a)},i),t.width=r,t.height=a,t.data=e.data)}function Xf(t,e,i,r,a,u){if(a.width===0||a.height===0)return e;if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||r.x>e.width-a.width||r.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const d=t.data,m=e.data;for(let y=0;y<a.height;y++){const v=((i.y+y)*t.width+i.x)*u,A=((r.y+y)*e.width+r.x)*u;for(let I=0;I<a.width*u;I++)m[A+I]=d[v+I]}return e}Rt(mm,"HeatmapBucket",{omit:["layers"]});class Ca{constructor(e,i){_m(this,e,1,i)}resize(e){$f(this,new Ca(e),1)}clone(){return new Ca({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,a,u){Xf(e,i,r,a,u,1)}}class Ss{constructor(e,i){_m(this,e,4,i)}resize(e){$f(this,new Ss(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ss({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,a,u){Xf(e,i,r,a,u,4)}}Rt(Ca,"AlphaImage"),Rt(Ss,"RGBAImage");var q_={paint:new pt({"heatmap-radius":new Ze(Ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ze(Ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Oe(Ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ut(Ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Oe(Ye.paint_heatmap["heatmap-opacity"])})};function Kf(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,a=t.image||new Ss({width:i,height:r}),u=(d,m,y)=>{e[t.evaluationKey]=y;const v=t.expression.evaluate(e);a.data[d+m+0]=Math.floor(255*v.r/v.a),a.data[d+m+1]=Math.floor(255*v.g/v.a),a.data[d+m+2]=Math.floor(255*v.b/v.a),a.data[d+m+3]=Math.floor(255*v.a)};if(t.clips)for(let d=0,m=0;d<r;++d,m+=4*i)for(let y=0,v=0;y<i;y++,v+=4){const A=y/(i-1),{start:I,end:L}=t.clips[d];u(m,v,I*(1-A)+L*A)}else for(let d=0,m=0;d<i;d++,m+=4)u(0,m,d/(i-1));return a}var Z_={paint:new pt({"hillshade-illumination-direction":new Oe(Ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Oe(Ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Oe(Ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Oe(Ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Oe(Ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Oe(Ye.paint_hillshade["hillshade-accent-color"])})};const H_=ei([{name:"a_pos",components:2,type:"Int16"}],4),{members:$_}=H_;var th={};function Nd(t,e,i){i=i||2;var r,a,u,d,m,y,v,A=e&&e.length,I=A?e[0]*i:t.length,L=gm(t,0,I,i,!0),k=[];if(!L||L.next===L.prev)return k;if(A&&(L=function(G,X,se,pe){var re,fe,xe,ye=[];for(re=0,fe=X.length;re<fe;re++)(xe=gm(G,X[re]*pe,re<fe-1?X[re+1]*pe:G.length,pe,!1))===xe.next&&(xe.steiner=!0),ye.push(eg(xe));for(ye.sort(Q_),re=0;re<ye.length;re++)se=ym(ye[re],se);return se}(t,e,L,i)),t.length>80*i){r=u=t[0],a=d=t[1];for(var F=i;F<I;F+=i)(m=t[F])<r&&(r=m),(y=t[F+1])<a&&(a=y),m>u&&(u=m),y>d&&(d=y);v=(v=Math.max(u-r,d-a))!==0?32767/v:0}return kh(L,k,i,r,a,v,0),k}function gm(t,e,i,r,a){var u,d;if(a===Qf(t,e,i,r)>0)for(u=e;u<i;u+=r)d=wm(u,t[u],t[u+1],d);else for(u=i-r;u>=e;u-=r)d=wm(u,t[u],t[u+1],d);return d&&Ud(d,d.next)&&(Fh(d),d=d.next),d}function Au(t,e){if(!t)return t;e||(e=t);var i,r=t;do if(i=!1,r.steiner||!Ud(r,r.next)&&ur(r.prev,r,r.next)!==0)r=r.next;else{if(Fh(r),(r=e=r.prev)===r.next)break;i=!0}while(i||r!==e);return e}function kh(t,e,i,r,a,u,d){if(t){!d&&u&&function(A,I,L,k){var F=A;do F.z===0&&(F.z=Yf(F.x,F.y,I,L,k)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==A);F.prevZ.nextZ=null,F.prevZ=null,function(G){var X,se,pe,re,fe,xe,ye,We,Ge=1;do{for(se=G,G=null,fe=null,xe=0;se;){for(xe++,pe=se,ye=0,X=0;X<Ge&&(ye++,pe=pe.nextZ);X++);for(We=Ge;ye>0||We>0&&pe;)ye!==0&&(We===0||!pe||se.z<=pe.z)?(re=se,se=se.nextZ,ye--):(re=pe,pe=pe.nextZ,We--),fe?fe.nextZ=re:G=re,re.prevZ=fe,fe=re;se=pe}fe.nextZ=null,Ge*=2}while(xe>1)}(F)}(t,r,a,u);for(var m,y,v=t;t.prev!==t.next;)if(m=t.prev,y=t.next,u?K_(t,r,a,u):X_(t))e.push(m.i/i|0),e.push(t.i/i|0),e.push(y.i/i|0),Fh(t),t=y.next,v=y.next;else if((t=y)===v){d?d===1?kh(t=Y_(Au(t),e,i),e,i,r,a,u,2):d===2&&J_(t,e,i,r,a,u):kh(Au(t),e,i,r,a,u,1);break}}}function X_(t){var e=t.prev,i=t,r=t.next;if(ur(e,i,r)>=0)return!1;for(var a=e.x,u=i.x,d=r.x,m=e.y,y=i.y,v=r.y,A=a<u?a<d?a:d:u<d?u:d,I=m<y?m<v?m:v:y<v?y:v,L=a>u?a>d?a:d:u>d?u:d,k=m>y?m>v?m:v:y>v?y:v,F=r.next;F!==e;){if(F.x>=A&&F.x<=L&&F.y>=I&&F.y<=k&&ih(a,m,u,y,d,v,F.x,F.y)&&ur(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function K_(t,e,i,r){var a=t.prev,u=t,d=t.next;if(ur(a,u,d)>=0)return!1;for(var m=a.x,y=u.x,v=d.x,A=a.y,I=u.y,L=d.y,k=m<y?m<v?m:v:y<v?y:v,F=A<I?A<L?A:L:I<L?I:L,G=m>y?m>v?m:v:y>v?y:v,X=A>I?A>L?A:L:I>L?I:L,se=Yf(k,F,e,i,r),pe=Yf(G,X,e,i,r),re=t.prevZ,fe=t.nextZ;re&&re.z>=se&&fe&&fe.z<=pe;){if(re.x>=k&&re.x<=G&&re.y>=F&&re.y<=X&&re!==a&&re!==d&&ih(m,A,y,I,v,L,re.x,re.y)&&ur(re.prev,re,re.next)>=0||(re=re.prevZ,fe.x>=k&&fe.x<=G&&fe.y>=F&&fe.y<=X&&fe!==a&&fe!==d&&ih(m,A,y,I,v,L,fe.x,fe.y)&&ur(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;re&&re.z>=se;){if(re.x>=k&&re.x<=G&&re.y>=F&&re.y<=X&&re!==a&&re!==d&&ih(m,A,y,I,v,L,re.x,re.y)&&ur(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;fe&&fe.z<=pe;){if(fe.x>=k&&fe.x<=G&&fe.y>=F&&fe.y<=X&&fe!==a&&fe!==d&&ih(m,A,y,I,v,L,fe.x,fe.y)&&ur(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function Y_(t,e,i){var r=t;do{var a=r.prev,u=r.next.next;!Ud(a,u)&&xm(a,r,r.next,u)&&Bh(a,u)&&Bh(u,a)&&(e.push(a.i/i|0),e.push(r.i/i|0),e.push(u.i/i|0),Fh(r),Fh(r.next),r=t=u),r=r.next}while(r!==t);return Au(r)}function J_(t,e,i,r,a,u){var d=t;do{for(var m=d.next.next;m!==d.prev;){if(d.i!==m.i&&tg(d,m)){var y=bm(d,m);return d=Au(d,d.next),y=Au(y,y.next),kh(d,e,i,r,a,u,0),void kh(y,e,i,r,a,u,0)}m=m.next}d=d.next}while(d!==t)}function Q_(t,e){return t.x-e.x}function ym(t,e){var i=function(a,u){var d,m=u,y=a.x,v=a.y,A=-1/0;do{if(v<=m.y&&v>=m.next.y&&m.next.y!==m.y){var I=m.x+(v-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(I<=y&&I>A&&(A=I,d=m.x<m.next.x?m:m.next,I===y))return d}m=m.next}while(m!==u);if(!d)return null;var L,k=d,F=d.x,G=d.y,X=1/0;m=d;do y>=m.x&&m.x>=F&&y!==m.x&&ih(v<G?y:A,v,F,G,v<G?A:y,v,m.x,m.y)&&(L=Math.abs(v-m.y)/(y-m.x),Bh(m,a)&&(L<X||L===X&&(m.x>d.x||m.x===d.x&&vm(d,m)))&&(d=m,X=L)),m=m.next;while(m!==k);return d}(t,e);if(!i)return e;var r=bm(i,t);return Au(r,r.next),Au(i,i.next)}function vm(t,e){return ur(t.prev,t,e.prev)<0&&ur(e.next,t,t.next)<0}function Yf(t,e,i,r,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function eg(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function ih(t,e,i,r,a,u,d,m){return(a-d)*(e-m)>=(t-d)*(u-m)&&(t-d)*(r-m)>=(i-d)*(e-m)&&(i-d)*(u-m)>=(a-d)*(r-m)}function tg(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,r){var a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==r.i&&a.next.i!==r.i&&xm(a,a.next,i,r))return!0;a=a.next}while(a!==i);return!1}(t,e)&&(Bh(t,e)&&Bh(e,t)&&function(i,r){var a=i,u=!1,d=(i.x+r.x)/2,m=(i.y+r.y)/2;do a.y>m!=a.next.y>m&&a.next.y!==a.y&&d<(a.next.x-a.x)*(m-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next;while(a!==i);return u}(t,e)&&(ur(t.prev,t,e.prev)||ur(t,e.prev,e))||Ud(t,e)&&ur(t.prev,t,t.next)>0&&ur(e.prev,e,e.next)>0)}function ur(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Ud(t,e){return t.x===e.x&&t.y===e.y}function xm(t,e,i,r){var a=Gd(ur(t,e,i)),u=Gd(ur(t,e,r)),d=Gd(ur(i,r,t)),m=Gd(ur(i,r,e));return a!==u&&d!==m||!(a!==0||!Vd(t,i,e))||!(u!==0||!Vd(t,r,e))||!(d!==0||!Vd(i,t,r))||!(m!==0||!Vd(i,e,r))}function Vd(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Gd(t){return t>0?1:t<0?-1:0}function Bh(t,e){return ur(t.prev,t,t.next)<0?ur(t,e,t.next)>=0&&ur(t,t.prev,e)>=0:ur(t,e,t.prev)<0||ur(t,t.next,e)<0}function bm(t,e){var i=new Jf(t.i,t.x,t.y),r=new Jf(e.i,e.x,e.y),a=t.next,u=e.prev;return t.next=e,e.prev=t,i.next=a,a.prev=i,r.next=i,i.prev=r,u.next=r,r.prev=u,r}function wm(t,e,i,r){var a=new Jf(t,e,i);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function Fh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Jf(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qf(t,e,i,r){for(var a=0,u=e,d=i-r;u<i;u+=r)a+=(t[d]-t[u])*(t[u+1]+t[d+1]),d=u;return a}function ig(t,e,i,r,a){Nh(t,e,i||0,r||t.length-1,a||Tm)}function Nh(t,e,i,r,a){for(;r>i;){if(r-i>600){var u=r-i+1,d=e-i+1,m=Math.log(u),y=.5*Math.exp(2*m/3),v=.5*Math.sqrt(m*y*(u-y)/u)*(d-u/2<0?-1:1);Nh(t,e,Math.max(i,Math.floor(e-d*y/u+v)),Math.min(r,Math.floor(e+(u-d)*y/u+v)),a)}var A=t[e],I=i,L=r;for(Uh(t,i,e),a(t[r],A)>0&&Uh(t,i,r);I<L;){for(Uh(t,I,L),I++,L--;a(t[I],A)<0;)I++;for(;a(t[L],A)>0;)L--}a(t[i],A)===0?Uh(t,i,L):Uh(t,++L,r),L<=e&&(i=L+1),e<=L&&(r=L-1)}}function Uh(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function Tm(t,e){return t<e?-1:t>e?1:0}function jd(t,e){const i=t.length;if(i<=1)return[t];const r=[];let a,u;for(let d=0;d<i;d++){const m=Gt(t[d]);m!==0&&(t[d].area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(a&&r.push(a),a=[t[d]]):a.push(t[d]))}if(a&&r.push(a),e>1)for(let d=0;d<r.length;d++)r[d].length<=e||(ig(r[d],e,1,r[d].length-1,ep),r[d]=r[d].slice(0,e));return r}function ep(t,e){return e.area-t.area}function Wd(t,e,i){const r=i.patternDependencies;let a=!1;for(const u of e){const d=u.paint.get(`${t}-pattern`);d.isConstant()||(a=!0);const m=d.constantOr(null);m&&(a=!0,r[m]=!0)}return a}function qd(t,e,i,r,a){const u=a.patternDependencies;for(const d of e){const m=d.paint.get(`${t}-pattern`).value;if(m.kind!=="constant"){let y=m.evaluate({zoom:r},i,{},a.availableImages);y=y&&y.name?y.name:y,u[y]=!0,i.patterns[d.id]=y}}return i}({get exports(){return th},set exports(t){th=t}}).exports=Nd,th.default=Nd,Nd.deviation=function(t,e,i,r){var a=e&&e.length,u=Math.abs(Qf(t,0,a?e[0]*i:t.length,i));if(a)for(var d=0,m=e.length;d<m;d++)u-=Math.abs(Qf(t,e[d]*i,d<m-1?e[d+1]*i:t.length,i));var y=0;for(d=0;d<r.length;d+=3){var v=r[d]*i,A=r[d+1]*i,I=r[d+2]*i;y+=Math.abs((t[v]-t[I])*(t[A+1]-t[v+1])-(t[v]-t[A])*(t[I+1]-t[v+1]))}return u===0&&y===0?0:Math.abs((y-u)/u)},Nd.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,a=0;a<t.length;a++){for(var u=0;u<t[a].length;u++)for(var d=0;d<e;d++)i.vertices.push(t[a][u][d]);a>0&&i.holes.push(r+=t[a-1].length)}return i};class Vh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new si,this.indexArray=new mo,this.indexArray2=new Ml,this.programConfigurations=new Aa(e.layers,e.zoom),this.segments=new cr,this.segments2=new cr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,r,a){this.hasPattern=Wd("fill",this.layers,i);const u=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:m,id:y,index:v,sourceLayerIndex:A}of e){const I=this.layers[0]._featureFilter.needGeometry,L=Tu(m,I);if(!this.layers[0]._featureFilter.filter(new ke(this.zoom),L,r))continue;const k=u?u.evaluate(L,{},r,i.availableImages):void 0,F={id:y,properties:m.properties,type:m.type,sourceLayerIndex:A,index:v,geometry:I?L.geometry:nc(m,r,a),patterns:{},sortKey:k};d.push(F)}u&&d.sort((m,y)=>m.sortKey-y.sortKey);for(const m of d){const{geometry:y,index:v,sourceLayerIndex:A}=m;if(this.hasPattern){const I=qd("fill",this.layers,m,this.zoom,i);this.patternFeatures.push(I)}else this.addFeature(m,y,v,r,{},i.availableImages);i.featureIndex.insert(e[v].feature,y,v,A,this.index)}}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}addFeatures(e,i,r,a,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,r,a,u,d=[]){for(const m of jd(i,500)){let y=0;for(const F of m)y+=F.length;const v=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),A=v.vertexLength,I=[],L=[];for(const F of m){if(F.length===0)continue;F!==m[0]&&L.push(I.length/2);const G=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),X=G.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(X+F.length-1,X),I.push(F[0].x),I.push(F[0].y);for(let se=1;se<F.length;se++)this.layoutVertexArray.emplaceBack(F[se].x,F[se].y),this.indexArray2.emplaceBack(X+se-1,X+se),I.push(F[se].x),I.push(F[se].y);G.vertexLength+=F.length,G.primitiveLength+=F.length}const k=th(I,L);for(let F=0;F<k.length;F+=3)this.indexArray.emplaceBack(A+k[F],A+k[F+1],A+k[F+2]);v.vertexLength+=y,v.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,d,a)}}Rt(Vh,"FillBucket",{omit:["layers","patternFeatures"]});const Em=new pt({"fill-sort-key":new Ze(Ye.layout_fill["fill-sort-key"])});var ng={paint:new pt({"fill-antialias":new Oe(Ye.paint_fill["fill-antialias"]),"fill-opacity":new Ze(Ye.paint_fill["fill-opacity"]),"fill-color":new Ze(Ye.paint_fill["fill-color"]),"fill-outline-color":new Ze(Ye.paint_fill["fill-outline-color"]),"fill-translate":new Oe(Ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Oe(Ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ze(Ye.paint_fill["fill-pattern"])}),layout:Em};const rg=ei([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),og=ei([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Zd=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Hd}=rg;var $d={},sg=$e,Xd=Su;function Su(t,e,i,r,a){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=a,t.readFields(ag,this,e)}function ag(t,e,i){t==1?e.id=i.readVarint():t==2?function(r,a){for(var u=r.readVarint()+r.pos;r.pos<u;){var d=a._keys[r.readVarint()],m=a._values[r.readVarint()];a.properties[d]=m}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function lg(t){for(var e,i,r=0,a=0,u=t.length,d=u-1;a<u;d=a++)r+=((i=t[d]).x-(e=t[a]).x)*(e.y+i.y);return r}Su.types=["Unknown","Point","LineString","Polygon"],Su.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,a=0,u=0,d=0,m=[];t.pos<i;){if(a<=0){var y=t.readVarint();r=7&y,a=y>>3}if(a--,r===1||r===2)u+=t.readSVarint(),d+=t.readSVarint(),r===1&&(e&&m.push(e),e=[]),e.push(new sg(u,d));else{if(r!==7)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&m.push(e),m},Su.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,a=0,u=0,d=1/0,m=-1/0,y=1/0,v=-1/0;t.pos<e;){if(r<=0){var A=t.readVarint();i=7&A,r=A>>3}if(r--,i===1||i===2)(a+=t.readSVarint())<d&&(d=a),a>m&&(m=a),(u+=t.readSVarint())<y&&(y=u),u>v&&(v=u);else if(i!==7)throw new Error("unknown command "+i)}return[d,y,m,v]},Su.prototype.toGeoJSON=function(t,e,i){var r,a,u=this.extent*Math.pow(2,i),d=this.extent*t,m=this.extent*e,y=this.loadGeometry(),v=Su.types[this.type];function A(k){for(var F=0;F<k.length;F++){var G=k[F];k[F]=[360*(G.x+d)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(G.y+m)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(r=0;r<y.length;r++)I[r]=y[r][0];A(y=I);break;case 2:for(r=0;r<y.length;r++)A(y[r]);break;case 3:for(y=function(k){var F=k.length;if(F<=1)return[k];for(var G,X,se=[],pe=0;pe<F;pe++){var re=lg(k[pe]);re!==0&&(X===void 0&&(X=re<0),X===re<0?(G&&se.push(G),G=[k[pe]]):G.push(k[pe]))}return G&&se.push(G),se}(y),r=0;r<y.length;r++)for(a=0;a<y[r].length;a++)A(y[r][a])}y.length===1?y=y[0]:v="Multi"+v;var L={type:"Feature",geometry:{type:v,coordinates:y},properties:this.properties};return"id"in this&&(L.id=this.id),L};var cg=Xd,Am=Sm;function Sm(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ug,this,e),this.length=this._features.length}function ug(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(r){for(var a=null,u=r.readVarint()+r.pos;r.pos<u;){var d=r.readVarint()>>3;a=d===1?r.readString():d===2?r.readFloat():d===3?r.readDouble():d===4?r.readVarint64():d===5?r.readVarint():d===6?r.readSVarint():d===7?r.readBoolean():null}return a}(i))}Sm.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new cg(this._pbf,e,this.extent,this._keys,this._values)};var hg=Am;function dg(t,e,i){if(t===3){var r=new hg(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var tp=$d.VectorTile=function(t,e){this.layers=t.readFields(dg,{},e)},Kd=$d.VectorTileFeature=Xd;function Yd(t,e,i,r){const a=[],u=r===0?(d,m,y,v,A,I)=>{d.push(new $e(I,y+(I-m)/(v-m)*(A-y)))}:(d,m,y,v,A,I)=>{d.push(new $e(m+(I-y)/(A-y)*(v-m),I))};for(const d of t){const m=[];for(const y of d){if(y.length<=2)continue;const v=[];for(let L=0;L<y.length-1;L++){const k=y[L].x,F=y[L].y,G=y[L+1].x,X=y[L+1].y,se=r===0?k:F,pe=r===0?G:X;se<e?pe>e&&u(v,k,F,G,X,e):se>i?pe<i&&u(v,k,F,G,X,i):v.push(y[L]),pe<e&&se>=e&&u(v,k,F,G,X,e),pe>i&&se<=i&&u(v,k,F,G,X,i)}let A=y[y.length-1];const I=r===0?A.x:A.y;I>=e&&I<=i&&v.push(A),v.length&&(A=v[v.length-1],v[0].x===A.x&&v[0].y===A.y||v.push(v[0]),m.push(v))}m.length&&a.push(m)}return a}$d.VectorTileLayer=Am;const fg=Kd.types,al=Math.pow(2,13);function Gh(t,e,i,r,a,u,d,m){t.emplaceBack((e<<1)+d,(i<<1)+u,(Math.floor(r*al)<<1)+a,Math.round(m))}function jh(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Nc{constructor(){this.acc=new $e(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new $e(e.x,e.y),this.max=new $e(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,a=this.max;e.x<r.x?r.x=e.x:e.x>a.x&&(a.x=e.x),e.y<r.y?r.y=e.y:e.y>a.y&&(a.y=e.y),((e.x===0||e.x===di)&&e.x===i.x)!=((e.y===0||e.y===di)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,Ei(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>di!=e.x>di&&this.addBorderIntersection(1,Ei(i.y,e.y,(di-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ei(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>di!=e.y>di&&this.addBorderIntersection(3,Ei(i.x,e.x,(di-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const r=e.x===0?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{const r=e.y===0?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce((i,r)=>i+r.edges,0);return e!==0?this.acc.div(e)._round():new $e(0,0)}span(){return new $e(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Fi{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new xn,this.centroidVertexArray=new yd,this.indexArray=new mo,this.programConfigurations=new Aa(e.layers,e.zoom),this.segments=new cr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,r,a){this.features=[],this.hasPattern=Wd("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(u){const d=Math.exp(Math.PI*(1-u.y/(1<<u.z)*2));return 80150034*d/(d*d+1)/di/(1<<u.z)}(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:u,id:d,index:m,sourceLayerIndex:y}of e){const v=this.layers[0]._featureFilter.needGeometry,A=Tu(u,v);if(!this.layers[0]._featureFilter.filter(new ke(this.zoom),A,r))continue;const I={id:d,sourceLayerIndex:y,index:m,geometry:v?A.geometry:nc(u,r,a),properties:u.properties,type:u.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(qd("fill-extrusion",this.layers,I,this.zoom,i)):this.addFeature(I,I.geometry,m,r,{},i.availableImages,a),i.featureIndex.insert(u,I.geometry,m,y,this.index,L)}this.sortBorders()}addFeatures(e,i,r,a,u){for(const d of this.features){const{geometry:m}=d;this.addFeature(d,m,d.index,i,r,a,u)}this.sortBorders()}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Hd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Zd.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,og.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,a,u,d,m){const y=[new $e(0,0),new $e(di,di)],v=m.projection,A=v.name==="globe",I=this.enableTerrain&&!A?new Nc:null,L=fg[e.type]==="Polygon";A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new bs);const k=jd(i,500);for(let se=k.length-1;se>=0;se--){const pe=k[se];(pe.length===0||(F=pe[0]).every(re=>re.x<=0)||F.every(re=>re.x>=di)||F.every(re=>re.y<=0)||F.every(re=>re.y>=di))&&k.splice(se,1)}var F;let G;if(A)G=Lm(k,y,a);else{G=[];for(const se of k)G.push({polygon:se,bounds:y})}const X=L?this.edgeRadius:0;for(const{polygon:se,bounds:pe}of G){let re=0,fe=0;for(const ye of se)L&&!ye[0].equals(ye[ye.length-1])&&ye.push(ye[0]),fe+=L?ye.length-1:ye.length;const xe=this.segments.prepareSegment((L?5:4)*fe,this.layoutVertexArray,this.indexArray);if(L){const ye=[],We=[];re=xe.vertexLength;for(const nt of se){let vt,Xe;nt.length&&nt!==se[0]&&We.push(ye.length/2),vt=nt[1].sub(nt[0])._perp()._unit();for(let at=1;at<nt.length;at++){const ct=nt[at],gt=nt[at===nt.length-1?1:at+1];let{x:bt,y:Ke}=ct;if(X){Xe=gt.sub(ct)._perp()._unit();const It=vt.add(Xe)._unit(),hi=X*Math.min(4,1/(vt.x*It.x+vt.y*It.y));bt+=hi*It.x,Ke+=hi*It.y,vt=Xe}Gh(this.layoutVertexArray,bt,Ke,0,0,1,1,0),xe.vertexLength++,ye.push(ct.x,ct.y),A&&jh(this.layoutVertexExtArray,v.projectTilePoint(bt,Ke,a),v.upVector(a,bt,Ke))}}const Ge=th(ye,We);for(let nt=0;nt<Ge.length;nt+=3)this.indexArray.emplaceBack(re+Ge[nt],re+Ge[nt+2],re+Ge[nt+1]),xe.primitiveLength++}for(const ye of se){I&&ye.length&&I.startRing(ye[0]);let We,Ge,nt,vt=ye.length>4&&rc(ye[ye.length-2],ye[0],ye[1]),Xe=X?Is(ye[ye.length-2],ye[0],ye[1],X):0;Ge=ye[1].sub(ye[0])._perp()._unit();let at=!0;for(let ct=1,gt=0;ct<ye.length;ct++){let bt=ye[ct-1],Ke=ye[ct];const It=ye[ct===ye.length-1?1:ct+1];if(I&&L&&I.currentPolyCount.top++,Cm(Ke,bt,pe)){X&&(Ge=It.sub(Ke)._perp()._unit(),at=!at);continue}I&&I.append(Ke,bt);const hi=Ke.sub(bt)._perp(),kt=hi.x/(Math.abs(hi.x)+Math.abs(hi.y)),$t=hi.y>0?1:0,Ct=bt.dist(Ke);if(gt+Ct>32768&&(gt=0),X){nt=It.sub(Ke)._perp()._unit();let Zi=Vr(bt,Ke,It,Im(Ge,nt),X);isNaN(Zi)&&(Zi=0);const mi=Ke.sub(bt)._unit();bt=bt.add(mi.mult(Xe))._round(),Ke=Ke.add(mi.mult(-Zi))._round(),Xe=Zi,Ge=nt}const pi=xe.vertexLength,Ji=ye.length>4&&rc(bt,Ke,It);let Ki=Mm(gt,vt,at);if(Gh(this.layoutVertexArray,bt.x,bt.y,kt,$t,0,0,Ki),Gh(this.layoutVertexArray,bt.x,bt.y,kt,$t,0,1,Ki),gt+=Ct,Ki=Mm(gt,Ji,!at),vt=Ji,Gh(this.layoutVertexArray,Ke.x,Ke.y,kt,$t,0,0,Ki),Gh(this.layoutVertexArray,Ke.x,Ke.y,kt,$t,0,1,Ki),xe.vertexLength+=4,this.indexArray.emplaceBack(pi+0,pi+1,pi+2),this.indexArray.emplaceBack(pi+1,pi+3,pi+2),xe.primitiveLength+=2,X){const Zi=re+(ct===1?ye.length-2:ct-2),mi=ct===1?re:Zi+1;if(this.indexArray.emplaceBack(pi+1,Zi,pi+3),this.indexArray.emplaceBack(Zi,mi,pi+3),xe.primitiveLength+=2,We===void 0&&(We=pi),!Cm(It,ye[ct],pe)){const Rn=ct===ye.length-1?We:xe.vertexLength;this.indexArray.emplaceBack(pi+2,pi+3,Rn),this.indexArray.emplaceBack(pi+3,Rn+1,Rn),this.indexArray.emplaceBack(pi+3,mi,Rn+1),xe.primitiveLength+=3}at=!at}if(A){const Zi=this.layoutVertexExtArray,mi=v.projectTilePoint(bt.x,bt.y,a),Rn=v.projectTilePoint(Ke.x,Ke.y,a),Ii=v.upVector(a,bt.x,bt.y),Qi=v.upVector(a,Ke.x,Ke.y);jh(Zi,mi,Ii),jh(Zi,mi,Ii),jh(Zi,Rn,Qi),jh(Zi,Rn,Qi)}}L&&(re+=ye.length-1)}}if(I&&I.polyCount.length>0){if(I.borders){I.vertexArrayOffset=this.centroidVertexArray.length;const se=I.borders,pe=this.featuresOnBorder.push(I)-1;for(let re=0;re<4;re++)se[re][0]!==Number.MAX_VALUE&&this.borders[re].push(pe)}this.encodeCentroid(I.borders?void 0:I.centroid(),I)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,d,a)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}encodeCentroid(e,i,r=!0){let a,u;if(e)if(e.y!==0){const m=i.span()._mult(this.tileToMeter);a=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(m.x/10)),u=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(m.y/10))}else a=Math.ceil(7*(e.x+450)),u=0;else a=0,u=+r;let d=r?this.centroidVertexArray.length:i.vertexArrayOffset;for(const m of i.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*m.edges+m.top);for(let y=0;y<m.top;y++)this.centroidVertexArray.emplace(d++,a,u);for(let y=0;y<2*m.edges;y++)this.centroidVertexArray.emplace(d++,0,u),this.centroidVertexArray.emplace(d++,a,u)}}}function Im(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function Is(t,e,i,r){const a=e.sub(t)._perp()._unit(),u=i.sub(e)._perp()._unit();return Vr(t,e,i,Im(a,u),r)}function Vr(t,e,i,r,a){const u=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,a*u/r)}function Cm(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function rc(t,e,i){if(t.x<0||t.x>=di||e.x<0||e.x>=di||i.x<0||i.x>=di)return!1;const r=i.sub(e),a=r.perp(),u=t.sub(e);return(r.x*u.x+r.y*u.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(u.x*u.x+u.y*u.y))>-.866&&a.x*u.x+a.y*u.y<0}function Mm(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function Dm(){const t=Math.PI/32,e=Math.tan(t),i=zh;return i*Math.sqrt(1+2*e*e)-i}function Lm(t,e,i){const r=1<<i.z,a=ta(i.x/r),u=ta((i.x+1)/r),d=Ao(i.y/r),m=Ao((i.y+1)/r);return function(y,v,A,I,L=0,k){const F=[];if(!y.length||!A||!I)return F;const G=(ye,We)=>{for(const Ge of ye)F.push({polygon:Ge,bounds:We})},X=Math.ceil(Math.log2(A)),se=Math.ceil(Math.log2(I)),pe=X-se,re=[];for(let ye=0;ye<Math.abs(pe);ye++)re.push(pe>0?0:1);for(let ye=0;ye<Math.min(X,se);ye++)re.push(0),re.push(1);let fe=y;if(fe=Yd(fe,v[0].y-L,v[1].y+L,1),fe=Yd(fe,v[0].x-L,v[1].x+L,0),!fe.length)return F;const xe=[];for(re.length?xe.push({polygons:fe,bounds:v,depth:0}):G(fe,v);xe.length;){const ye=xe.pop(),We=ye.depth,Ge=re[We],nt=ye.bounds[0],vt=ye.bounds[1],Xe=Ge===0?nt.x:nt.y,at=Ge===0?vt.x:vt.y,ct=k?k(Ge,Xe,at):.5*(Xe+at),gt=Yd(ye.polygons,Xe-L,ct+L,Ge),bt=Yd(ye.polygons,ct-L,at+L,Ge);if(gt.length){const Ke=[nt,new $e(Ge===0?ct:vt.x,Ge===1?ct:vt.y)];re.length>We+1?xe.push({polygons:gt,bounds:Ke,depth:We+1}):G(gt,Ke)}if(bt.length){const Ke=[new $e(Ge===0?ct:nt.x,Ge===1?ct:nt.y),vt];re.length>We+1?xe.push({polygons:bt,bounds:Ke,depth:We+1}):G(bt,Ke)}}return F}(t,e,Math.ceil((u-a)/11.25),Math.ceil((d-m)/11.25),1,(y,v,A)=>{if(y===0)return .5*(v+A);{const I=Ao((i.y+v/di)/r);return(zl(.5*(Ao((i.y+A/di)/r)+I))*r-i.y)*di}})}Rt(Fi,"FillExtrusionBucket",{omit:["layers","features"]}),Rt(Nc,"PartMetadata");const pg=new pt({"fill-extrusion-edge-radius":new Oe(Ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var mg={paint:new pt({"fill-extrusion-opacity":new Oe(Ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ze(Ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Oe(Ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Oe(Ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ze(Ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ze(Ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ze(Ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Oe(Ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Oe(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Oe(Ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:pg};function Jd(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class Qd{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=Uc(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const r=function(u,d,m){var y=Jd(256*u,256*(d=Math.pow(2,m)-d-1),m),v=Jd(256*(u+1),256*(d+1),m);return y[0]+","+y[1]+","+v[0]+","+v[1]}(this.x,this.y,this.z),a=function(u,d,m){let y,v="";for(let A=u;A>0;A--)y=1<<A-1,v+=(d&y?1:0)+(m&y?2:0);return v}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kl{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Uc(e,i.z,i.z,i.x,i.y)}}class Bo{constructor(e,i,r,a,u){this.overscaledZ=e,this.wrap=i,this.canonical=new Qd(r,+a,+u),this.key=i===0&&e===r?this.canonical.key:Uc(i,e,r,a,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Bo(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Bo(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Uc(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return Uc(this.wrap*+i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Bo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,a=2*this.canonical.y;return[new Bo(i,this.wrap,i,r,a),new Bo(i,this.wrap,i,r+1,a),new Bo(i,this.wrap,i,r,a+1),new Bo(i,this.wrap,i,r+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Bo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Bo(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kl(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Uc(t,e,i,r,a){const u=1<<Math.min(i,22);let d=u*(a%u)+r%u;return t&&i<22&&(d+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*d+i)+(e-i)}Rt(Qd,"CanonicalTileID"),Rt(Bo,"OverscaledTileID",{omit:["projMatrix"]});class tr extends $e{constructor(e,i,r){super(e,i),this.z=r}}function hr(t,e){return t.x*e.x+t.y*e.y}function ip(t,e){if(t.length===1){let i=0;const r=e[i++];let a;for(;!a||r.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){const u=e[i],d=t[0],m=a.sub(r),y=u.sub(r),v=d.sub(r),A=hr(m,m),I=hr(m,y),L=hr(y,y),k=hr(v,m),F=hr(v,y),G=A*L-I*I,X=(L*k-I*F)/G,se=(A*F-I*k)/G,pe=r.z*(1-X-se)+a.z*X+u.z*se;if(isFinite(pe))return pe}return 1/0}{let i=1/0;for(const r of e)i=Math.min(i,r.z);return i}}function Pm(t,e,i,r,a,u,d,m){const y=d*a.getElevationAt(t,e,!0,!0),v=u[0]!==0,A=v?u[1]===0?d*(u[0]/7-450):d*function(I,L,k){const F=Math.floor(L[0]/8),G=Math.floor(L[1]/8),X=10*(L[0]-8*F),se=10*(L[1]-8*G),pe=I.getElevationAt(F,G,!0,!0),re=I.getMeterToDEM(k),fe=Math.floor(.5*(X*re-1)),xe=Math.floor(.5*(se*re-1)),ye=I.tileCoordToPixel(F,G),We=2*fe+1,Ge=2*xe+1,nt=function(bt,Ke,It,hi,kt){return[bt.getElevationAtPixel(Ke,It,!0),bt.getElevationAtPixel(Ke+kt,It,!0),bt.getElevationAtPixel(Ke,It+kt,!0),bt.getElevationAtPixel(Ke+hi,It+kt,!0)]}(I,ye.x-fe,ye.y-xe,We,Ge),vt=Math.abs(nt[0]-nt[1]),Xe=Math.abs(nt[2]-nt[3]),at=Math.abs(nt[0]-nt[2])+Math.abs(nt[1]-nt[3]),ct=Math.min(.25,.5*re*(vt+Xe)/We),gt=Math.min(.25,.5*re*at/Ge);return pe+Math.max(ct*X,gt*se)}(a,u,m):y;return{base:y+(i===0)?-1:i,top:v?Math.max(A+r,y+i+2):y+r}}const _g=ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:gg}=_g,yg=ei([{name:"a_packed",components:4,type:"Float32"}]),{members:vg}=yg,xg=Kd.types,Om=Math.cos(Math.PI/180*37.5);class Vc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Fn,this.layoutVertexArray2=new In,this.indexArray=new mo,this.programConfigurations=new Aa(e.layers,e.zoom),this.segments=new cr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,a){this.hasPattern=Wd("line",this.layers,i);const u=this.layers[0].layout.get("line-sort-key"),d=[];for(const{feature:A,id:I,index:L,sourceLayerIndex:k}of e){const F=this.layers[0]._featureFilter.needGeometry,G=Tu(A,F);if(!this.layers[0]._featureFilter.filter(new ke(this.zoom),G,r))continue;const X=u?u.evaluate(G,{},r):void 0,se={id:I,properties:A.properties,type:A.type,sourceLayerIndex:k,index:L,geometry:F?G.geometry:nc(A,r,a),patterns:{},sortKey:X};d.push(se)}u&&d.sort((A,I)=>A.sortKey-I.sortKey);const{lineAtlas:m,featureIndex:y}=i,v=this.addConstantDashes(m);for(const A of d){const{geometry:I,index:L,sourceLayerIndex:k}=A;if(v&&this.addFeatureDashes(A,m),this.hasPattern){const F=qd("line",this.layers,A,this.zoom,i);this.patternFeatures.push(F)}else this.addFeature(A,I,L,r,m.positions,i.availableImages);y.insert(e[L].feature,I,L,k,this.index)}}addConstantDashes(e){let i=!1;for(const r of this.layers){const a=r.paint.get("line-dasharray").value,u=r.layout.get("line-cap").value;if(a.kind!=="constant"||u.kind!=="constant")i=!0;else{const d=u.value,m=a.value;if(!m)continue;e.addDash(m,d)}}return i}addFeatureDashes(e,i){const r=this.zoom;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(u.kind==="constant"&&d.kind==="constant")continue;let m,y;if(u.kind==="constant"){if(m=u.value,!m)continue}else m=u.evaluate({zoom:r},e);y=d.kind==="constant"?d.value:d.evaluate({zoom:r},e),i.addDash(m,y),e.patterns[a.id]=i.getKey(m,y)}}update(e,i,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,a)}addFeatures(e,i,r,a,u){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,vg)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gg),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,a,u,d){const m=this.layers[0].layout,y=m.get("line-join").evaluate(e,{}),v=m.get("line-cap").evaluate(e,{}),A=m.get("line-miter-limit"),I=m.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of i)this.addLine(L,e,y,v,A,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,u,d,a)}addLine(e,i,r,a,u,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let se=0;se<e.length-1;se++)this.totalDistance+=e[se].dist(e[se+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=xg[i.type]==="Polygon";let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let v=0;for(;v<y-1&&e[v].equals(e[v+1]);)v++;if(y<(m?3:2))return;r==="bevel"&&(u=1.05);const A=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let L,k,F,G,X;this.e1=this.e2=-1,m&&(L=e[y-2],X=e[v].sub(L)._unit()._perp());for(let se=v;se<y;se++){if(F=se===y-1?m?e[v+1]:void 0:e[se+1],F&&e[se].equals(F))continue;X&&(G=X),L&&(k=L),L=e[se],X=F?F.sub(L)._unit()._perp():G,G=G||X;let pe=G.add(X);pe.x===0&&pe.y===0||pe._unit();const re=G.x*X.x+G.y*X.y,fe=pe.x*X.x+pe.y*X.y,xe=fe!==0?1/fe:1/0,ye=2*Math.sqrt(2-2*fe),We=fe<Om&&k&&F,Ge=G.x*X.y-G.y*X.x>0;if(We&&se>v){const Xe=L.dist(k);if(Xe>2*A){const at=L.sub(L.sub(k)._mult(A/Xe)._round());this.updateDistance(k,at),this.addCurrentVertex(at,G,0,0,I),k=at}}const nt=k&&F;let vt=nt?r:m?"butt":a;if(nt&&vt==="round"&&(xe<d?vt="miter":xe<=2&&(vt="fakeround")),vt==="miter"&&xe>u&&(vt="bevel"),vt==="bevel"&&(xe>2&&(vt="flipbevel"),xe<u&&(vt="miter")),k&&this.updateDistance(k,L),vt==="miter")pe._mult(xe),this.addCurrentVertex(L,pe,0,0,I);else if(vt==="flipbevel"){if(xe>100)pe=X.mult(-1);else{const Xe=xe*G.add(X).mag()/G.sub(X).mag();pe._perp()._mult(Xe*(Ge?-1:1))}this.addCurrentVertex(L,pe,0,0,I),this.addCurrentVertex(L,pe.mult(-1),0,0,I)}else if(vt==="bevel"||vt==="fakeround"){const Xe=-Math.sqrt(xe*xe-1),at=Ge?Xe:0,ct=Ge?0:Xe;if(k&&this.addCurrentVertex(L,G,at,ct,I),vt==="fakeround"){const gt=Math.round(180*ye/Math.PI/20);for(let bt=1;bt<gt;bt++){let Ke=bt/gt;if(Ke!==.5){const hi=Ke-.5;Ke+=Ke*hi*(Ke-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*hi*hi+(.848013+re*(.215638*re-1.06021)))}const It=X.sub(G)._mult(Ke)._add(G)._unit()._mult(Ge?-1:1);this.addHalfVertex(L,It.x,It.y,!1,Ge,0,I)}}F&&this.addCurrentVertex(L,X,-at,-ct,I)}else if(vt==="butt")this.addCurrentVertex(L,pe,0,0,I);else if(vt==="square"){const Xe=k?1:-1;k||this.addCurrentVertex(L,pe,Xe,Xe,I),this.addCurrentVertex(L,pe,0,0,I),k&&this.addCurrentVertex(L,pe,Xe,Xe,I)}else vt==="round"&&(k&&(this.addCurrentVertex(L,G,0,0,I),this.addCurrentVertex(L,G,1,1,I,!0)),F&&(this.addCurrentVertex(L,X,-1,-1,I,!0),this.addCurrentVertex(L,X,0,0,I)));if(We&&se<y-1){const Xe=L.dist(F);if(Xe>2*A){const at=L.add(F.sub(L)._mult(A/Xe)._round());this.updateDistance(L,at),this.addCurrentVertex(at,X,0,0,I),L=at}}}}addCurrentVertex(e,i,r,a,u,d=!1){const m=i.y*a-i.x,y=-i.y-i.x*a;this.addHalfVertex(e,i.x+i.y*r,i.y-i.x*r,d,!1,r,u),this.addHalfVertex(e,m,y,d,!0,-a,u)}addHalfVertex({x:e,y:i},r,a,u,d,m,y){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(i<<1)+(d?1:0),Math.round(63*r)+128,Math.round(63*a)+128,1+(m===0?0:m<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const v=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,v),y.primitiveLength++),d?this.e2=v:this.e1=v}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Rt(Vc,"LineBucket",{omit:["layers","patternFeatures"]});const np=new pt({"line-cap":new Ze(Ye.layout_line["line-cap"]),"line-join":new Ze(Ye.layout_line["line-join"]),"line-miter-limit":new Oe(Ye.layout_line["line-miter-limit"]),"line-round-limit":new Oe(Ye.layout_line["line-round-limit"]),"line-sort-key":new Ze(Ye.layout_line["line-sort-key"])});var Rm={paint:new pt({"line-opacity":new Ze(Ye.paint_line["line-opacity"]),"line-color":new Ze(Ye.paint_line["line-color"]),"line-translate":new Oe(Ye.paint_line["line-translate"]),"line-translate-anchor":new Oe(Ye.paint_line["line-translate-anchor"]),"line-width":new Ze(Ye.paint_line["line-width"]),"line-gap-width":new Ze(Ye.paint_line["line-gap-width"]),"line-offset":new Ze(Ye.paint_line["line-offset"]),"line-blur":new Ze(Ye.paint_line["line-blur"]),"line-dasharray":new Ze(Ye.paint_line["line-dasharray"]),"line-pattern":new Ze(Ye.paint_line["line-pattern"]),"line-gradient":new ut(Ye.paint_line["line-gradient"]),"line-trim-offset":new Oe(Ye.paint_line["line-trim-offset"])}),layout:np};const rp=new class extends Ze{possiblyEvaluate(t,e){return e=new ke(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=rn({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(Rm.paint.properties["line-width"].specification);function Wh(t,e){return e>0?e+2*t:t}rp.useIntegerZoom=!0;const ia=ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nh=ei([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),bg=ei([{name:"a_projected_pos",components:4,type:"Float32"}],4);ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const wg=ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Tg=ei([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zm=ei([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Eg=ei([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ei([{name:"triangle",components:3,type:"Uint16"}]),ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ei([{type:"Float32",name:"offsetX"}]),ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var go=24;const So=128;function Xi(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new ke(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:r,interpolationType:a}=i;let u=0;for(;u<r.length&&r[u]<=t;)u++;u=Math.max(0,u-1);let d=u;for(;d<r.length&&r[d]<t+1;)d++;d=Math.min(r.length-1,d);const m=r[u],y=r[d];return i.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:y,interpolationType:a}:{kind:"camera",minZoom:m,maxZoom:y,minSize:i.evaluate(new ke(m)),maxSize:i.evaluate(new ke(y)),interpolationType:a}}}function qh(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:a}){return t.kind==="source"?r/So:t.kind==="composite"?Ei(r/So,a/So,i):e}function Fo(t,e){let i=0,r=0;if(t.kind==="constant")r=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:a,minZoom:u,maxZoom:d}=t,m=a?ii(Zo.interpolationFactor(a,e,u,d),0,1):0;t.kind==="camera"?r=Ei(t.minSize,t.maxSize,m):i=m}return{uSizeT:i,uSize:r}}var km=Object.freeze({__proto__:null,getSizeData:Xi,evaluateSizeForFeature:qh,evaluateSizeForZoom:Fo,SIZE_PACK_FACTOR:So});function Ag(t,e,i){return t.sections.forEach(r=>{r.text=function(a,u,d){const m=u.layout.get("text-transform").evaluate(d,{});return m==="uppercase"?a=a.toLocaleUpperCase():m==="lowercase"&&(a=a.toLocaleLowerCase()),we.applyArabicShaping&&(a=we.applyArabicShaping(a)),a}(r.text,e,i)}),t}const Cn={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Sg(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}function Bm(t){return t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""||t===""}var Gc=Nn,Fm=function(t,e,i,r,a){var u,d,m=8*a-r-1,y=(1<<m)-1,v=y>>1,A=-7,I=i?a-1:0,L=i?-1:1,k=t[e+I];for(I+=L,u=k&(1<<-A)-1,k>>=-A,A+=m;A>0;u=256*u+t[e+I],I+=L,A-=8);for(d=u&(1<<-A)-1,u>>=-A,A+=r;A>0;d=256*d+t[e+I],I+=L,A-=8);if(u===0)u=1-v;else{if(u===y)return d?NaN:1/0*(k?-1:1);d+=Math.pow(2,r),u-=v}return(k?-1:1)*d*Math.pow(2,u-r)},Nm=function(t,e,i,r,a,u){var d,m,y,v=8*u-a-1,A=(1<<v)-1,I=A>>1,L=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,k=r?0:u-1,F=r?1:-1,G=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,d=A):(d=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-d))<1&&(d--,y*=2),(e+=d+I>=1?L/y:L*Math.pow(2,1-I))*y>=2&&(d++,y/=2),d+I>=A?(m=0,d=A):d+I>=1?(m=(e*y-1)*Math.pow(2,a),d+=I):(m=e*Math.pow(2,I-1)*Math.pow(2,a),d=0));a>=8;t[i+k]=255&m,k+=F,m/=256,a-=8);for(d=d<<a|m,v+=a;v>0;t[i+k]=255&d,k+=F,d/=256,v-=8);t[i+k-F]|=128*G};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Nn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Nn.Varint=0,Nn.Fixed64=1,Nn.Bytes=2,Nn.Fixed32=5;var op=4294967296,Um=1/op,Vm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function oc(t){return t.type===Nn.Bytes?t.readVarint()+t.pos:t.pos+1}function rh(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Gm(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var a=i.pos-1;a>=t;a--)i.buf[a+r]=i.buf[a]}function Ig(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Cg(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Mg(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Dg(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function sp(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Lg(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function ap(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Pg(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function Og(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function ef(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Pr(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function ps(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Rg(t,e,i){e.glyphs=[],t===1&&i.readMessage(zg,e)}function zg(t,e,i){if(t===3){const{id:r,bitmap:a,width:u,height:d,left:m,top:y,advance:v}=i.readMessage(kg,{});e.glyphs.push({id:r,bitmap:new Ca({width:u+6,height:d+6},a),metrics:{width:u,height:d,left:m,top:y,advance:v}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function kg(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}function tf(t){let e=0,i=0;for(const d of t)e+=d.w*d.h,i=Math.max(i,d.w);t.sort((d,m)=>m.h-d.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,u=0;for(const d of t)for(let m=r.length-1;m>=0;m--){const y=r[m];if(!(d.w>y.w||d.h>y.h)){if(d.x=y.x,d.y=y.y,u=Math.max(u,d.y+d.h),a=Math.max(a,d.x+d.w),d.w===y.w&&d.h===y.h){const v=r.pop();m<r.length&&(r[m]=v)}else d.h===y.h?(y.x+=d.w,y.w-=d.w):d.w===y.w?(y.y+=d.h,y.h-=d.h):(r.push({x:y.x+d.w,y:y.y,w:y.w-d.w,h:d.h}),y.y+=d.h,y.h-=d.h);break}}return{w:a,h:u,fill:e/(a*u)||0}}Nn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),a=r>>3,u=this.pos;this.type=7&r,t(a,e,this),this.pos===u&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=ef(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=ps(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=ef(this.buf,this.pos)+ef(this.buf,this.pos+4)*op;return this.pos+=8,t},readSFixed64:function(){var t=ef(this.buf,this.pos)+ps(this.buf,this.pos+4)*op;return this.pos+=8,t},readFloat:function(){var t=Fm(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Fm(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(a,u,d){var m,y,v=d.buf;if(m=(112&(y=v[d.pos++]))>>4,y<128||(m|=(127&(y=v[d.pos++]))<<3,y<128)||(m|=(127&(y=v[d.pos++]))<<10,y<128)||(m|=(127&(y=v[d.pos++]))<<17,y<128)||(m|=(127&(y=v[d.pos++]))<<24,y<128)||(m|=(1&(y=v[d.pos++]))<<31,y<128))return rh(a,m,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Vm?function(i,r,a){return Vm.decode(i.subarray(r,a))}(this.buf,e,t):function(i,r,a){for(var u="",d=r;d<a;){var m,y,v,A=i[d],I=null,L=A>239?4:A>223?3:A>191?2:1;if(d+L>a)break;L===1?A<128&&(I=A):L===2?(192&(m=i[d+1]))==128&&(I=(31&A)<<6|63&m)<=127&&(I=null):L===3?(y=i[d+2],(192&(m=i[d+1]))==128&&(192&y)==128&&((I=(15&A)<<12|(63&m)<<6|63&y)<=2047||I>=55296&&I<=57343)&&(I=null)):L===4&&(y=i[d+2],v=i[d+3],(192&(m=i[d+1]))==128&&(192&y)==128&&(192&v)==128&&((I=(15&A)<<18|(63&m)<<12|(63&y)<<6|63&v)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,L=1):I>65535&&(I-=65536,u+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),u+=String.fromCharCode(I),d+=L}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Nn.Bytes)return t.push(this.readVarint(e));var i=oc(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Nn.Bytes)return t.push(this.readSVarint());var e=oc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Nn.Bytes)return t.push(this.readBoolean());var e=oc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Nn.Bytes)return t.push(this.readFloat());var e=oc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Nn.Bytes)return t.push(this.readDouble());var e=oc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Nn.Bytes)return t.push(this.readFixed32());var e=oc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Nn.Bytes)return t.push(this.readSFixed32());var e=oc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Nn.Bytes)return t.push(this.readFixed64());var e=oc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Nn.Bytes)return t.push(this.readSFixed64());var e=oc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Nn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Nn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Nn.Fixed32)this.pos+=4;else{if(e!==Nn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Pr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Pr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Pr(this.buf,-1&t,this.pos),Pr(this.buf,Math.floor(t*Um),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Pr(this.buf,-1&t,this.pos),Pr(this.buf,Math.floor(t*Um),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var r,a;if(e>=0?(r=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(u,d,m){m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,m.buf[m.pos]=127&(u>>>=7)}(r,0,i),function(u,d){var m=(7&u)<<4;d.buf[d.pos++]|=m|((u>>>=3)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u|((u>>>=7)?128:0),u&&(d.buf[d.pos++]=127&u)))))}(a,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(r,a,u){for(var d,m,y=0;y<a.length;y++){if((d=a.charCodeAt(y))>55295&&d<57344){if(!m){d>56319||y+1===a.length?(r[u++]=239,r[u++]=191,r[u++]=189):m=d;continue}if(d<56320){r[u++]=239,r[u++]=191,r[u++]=189,m=d;continue}d=m-55296<<10|d-56320|65536,m=null}else m&&(r[u++]=239,r[u++]=191,r[u++]=189,m=null);d<128?r[u++]=d:(d<2048?r[u++]=d>>6|192:(d<65536?r[u++]=d>>12|224:(r[u++]=d>>18|240,r[u++]=d>>12&63|128),r[u++]=d>>6&63|128),r[u++]=63&d|128)}return u}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Gm(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Nm(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Nm(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Gm(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Nn.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ig,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Cg,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,sp,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Mg,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Dg,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Lg,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,ap,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Pg,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Og,e)},writeBytesField:function(t,e){this.writeTag(t,Nn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Nn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Nn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Nn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Nn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Nn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Nn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Nn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Nn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Nn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};class lp{constructor(e,{pixelRatio:i,version:r,stretchX:a,stretchY:u,content:d}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=a,this.stretchY=u,this.content=d,this.version=r}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class jm{constructor(e,i){const r={},a={};this.haveRenderCallbacks=[];const u=[];this.addImages(e,r,u),this.addImages(i,a,u);const{w:d,h:m}=tf(u),y=new Ss({width:d||1,height:m||1});for(const v in e){const A=e[v],I=r[v].paddedRect;Ss.copy(A.data,y,{x:0,y:0},{x:I.x+1,y:I.y+1},A.data)}for(const v in i){const A=i[v],I=a[v].paddedRect,L=I.x+1,k=I.y+1,F=A.data.width,G=A.data.height;Ss.copy(A.data,y,{x:0,y:0},{x:L,y:k},A.data),Ss.copy(A.data,y,{x:0,y:G-1},{x:L,y:k-1},{width:F,height:1}),Ss.copy(A.data,y,{x:0,y:0},{x:L,y:k+G},{width:F,height:1}),Ss.copy(A.data,y,{x:F-1,y:0},{x:L-1,y:k},{width:1,height:G}),Ss.copy(A.data,y,{x:0,y:0},{x:L+F,y:k},{width:1,height:G})}this.image=y,this.iconPositions=r,this.patternPositions=a}addImages(e,i,r){for(const a in e){const u=e[a],d={x:0,y:0,w:u.data.width+2,h:u.data.height+2};r.push(d),i[a]=new lp(d,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(r=>e.hasImage(r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),i),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),i)}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;const[a,u]=e.tl;r.update(i.data,void 0,{x:a,y:u})}}Rt(lp,"ImagePosition"),Rt(jm,"ImageAtlas");const na={horizontal:1,vertical:2,horizontalOnly:3};class oh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const r=new oh;return r.scale=e||1,r.fontStack=i,r}static forImage(e){const i=new oh;return i.imageName=e,i}}class sh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const r=new sh;for(let a=0;a<e.sections.length;a++){const u=e.sections[a];u.image?r.addImageSection(u):r.addTextSection(u,i)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,r){let a="";for(let u=0;u<i.length;u++){const d=i.charCodeAt(u+1)||null,m=i.charCodeAt(u-1)||null;a+=!r&&(d&&S(d)&&!Cn[i[u+1]]||m&&S(m)&&!Cn[i[u-1]])||!Cn[i[u]]?i[u]:Cn[i[u]]}return a}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&nf[this.text.charCodeAt(r)];r++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&nf[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const r=new sh;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(oh.forText(e.scale,e.fontStack||i));const r=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(r)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Oi("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(oh.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Oi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function cp(t,e,i,r,a,u,d,m,y,v,A,I,L,k,F){const G=sh.fromFeature(t,a);I===na.vertical&&G.verticalizePunctuation(L);let X=[];const se=function(ye,We,Ge,nt,vt,Xe){if(!ye)return[];const at=[],ct=function(It,hi,kt,$t,Ct,pi){let Ji=0;for(let Ki=0;Ki<It.length();Ki++){const Zi=It.getSection(Ki);Ji+=up(It.getCharCode(Ki),Zi,$t,Ct,hi,pi)}return Ji/Math.max(1,Math.ceil(Ji/kt))}(ye,We,Ge,nt,vt,Xe),gt=ye.text.indexOf("")>=0;let bt=0;for(let It=0;It<ye.length();It++){const hi=ye.getSection(It),kt=ye.getCharCode(It);if(nf[kt]||(bt+=up(kt,hi,nt,vt,We,Xe)),It<ye.length()-1){const $t=!((Ke=kt)<11904||!(xs(Ke)||ju(Ke)||c(Ke)||qu(Ke)||fd(Ke)||ud(Ke)||hd(Ke)||gu(Ke)||pd(Ke)||Wu(Ke)||dd(Ke)||h(Ke)||Ta(Ke)||xh(Ke)||vh(Ke)||bh(Ke)||Lc(Ke)||Cl(Ke)||md(Ke)||wh(Ke)));(Wm[kt]||$t||hi.imageName)&&at.push(Zm(It+1,bt,ct,at,Bg(kt,ye.getCharCode(It+1),$t&&gt),!1))}}var Ke;return Hm(Zm(ye.length(),bt,ct,at,0,!0))}(G,v,u,e,r,k),{processBidirectionalText:pe,processStyledBidirectionalText:re}=we;if(pe&&G.sections.length===1){const ye=pe(G.toString(),se);for(const We of ye){const Ge=new sh;Ge.text=We,Ge.sections=G.sections;for(let nt=0;nt<We.length;nt++)Ge.sectionIndex.push(0);X.push(Ge)}}else if(re){const ye=re(G.text,G.sectionIndex,se);for(const We of ye){const Ge=new sh;Ge.text=We[0],Ge.sectionIndex=We[1],Ge.sections=G.sections,X.push(Ge)}}else X=function(ye,We){const Ge=[],nt=ye.text;let vt=0;for(const Xe of We)Ge.push(ye.substring(vt,Xe)),vt=Xe;return vt<nt.length&&Ge.push(ye.substring(vt,nt.length)),Ge}(G,se);const fe=[],xe={positionedLines:fe,text:G.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ye,We,Ge,nt,vt,Xe,at,ct,gt,bt,Ke,It){let hi=0,kt=0,$t=0;const Ct=ct==="right"?1:ct==="left"?0:.5;let pi=!1;for(const Ii of vt){const Qi=Ii.getSections();for(const Un of Qi){if(Un.imageName)continue;const ir=We[Un.fontStack];if(ir&&(pi=ir.ascender!==void 0&&ir.descender!==void 0,!pi))break}if(!pi)break}let Ji=0;for(const Ii of vt){Ii.trim();const Qi=Ii.getMaxScale(),Un=(Qi-1)*go,ir={positionedGlyphs:[],lineOffset:0};ye.positionedLines[Ji]=ir;const Kn=ir.positionedGlyphs;let nr=0;if(!Ii.length()){kt+=Xe,++Ji;continue}let rr=0,Or=0;for(let zn=0;zn<Ii.length();zn++){const io=Ii.getSection(zn),Kr=Ii.getSectionIndex(zn),yn=Ii.getCharCode(zn);let gr=io.scale,yo=null,Vn=null,jr=null,ms=go,Uo=0;const Vo=!(gt===na.horizontal||!Ke&&!E(yn)||Ke&&(nf[yn]||(Ki=yn,_u(Ki)||wa(Ki)||yh(Ki)||Il(Ki)||s(Ki))));if(io.imageName){const Ls=nt[io.imageName];if(!Ls)continue;jr=io.imageName,ye.iconsInText=ye.iconsInText||!0,Vn=Ls.paddedRect;const Go=Ls.displaySize;gr=gr*go/It,yo={width:Go[0],height:Go[1],left:1,top:-3,advance:Vo?Go[1]:Go[0],localGlyph:!1},Uo=pi?-yo.height*gr:Qi*go-17-Go[1]*gr,ms=yo.advance;const Mu=(Vo?Go[0]:Go[1])*gr-go*Qi;Mu>0&&Mu>nr&&(nr=Mu)}else{const Ls=Ge[io.fontStack];if(!Ls)continue;Ls[yn]&&(Vn=Ls[yn]);const Go=We[io.fontStack];if(!Go)continue;const Mu=Go.glyphs[yn];if(!Mu)continue;if(yo=Mu.metrics,ms=yn!==8203?go:0,pi){const _f=Go.ascender!==void 0?Math.abs(Go.ascender):0,Ep=Go.descender!==void 0?Math.abs(Go.descender):0,Ap=(_f+Ep)*gr;rr<Ap&&(rr=Ap,Or=(_f-Ep)/2*gr),Uo=-_f*gr}else Uo=(Qi-gr)*go-17}Vo?(ye.verticalizable=!0,Kn.push({glyph:yn,imageName:jr,x:hi,y:kt+Uo,vertical:Vo,scale:gr,localGlyph:yo.localGlyph,fontStack:io.fontStack,sectionIndex:Kr,metrics:yo,rect:Vn}),hi+=ms*gr+bt):(Kn.push({glyph:yn,imageName:jr,x:hi,y:kt+Uo,vertical:Vo,scale:gr,localGlyph:yo.localGlyph,fontStack:io.fontStack,sectionIndex:Kr,metrics:yo,rect:Vn}),hi+=yo.advance*gr+bt)}Kn.length!==0&&($t=Math.max(hi-bt,$t),pi?$m(Kn,Ct,nr,Or,Xe*Qi/2):$m(Kn,Ct,nr,0,Xe/2)),hi=0;const No=Xe*Qi+nr;ir.lineOffset=Math.max(nr,Un),kt+=No,++Ji}var Ki;const Zi=kt,{horizontalAlign:mi,verticalAlign:Rn}=jc(at);(function(Ii,Qi,Un,ir,Kn,nr){const rr=(Qi-Un)*Kn,Or=-nr*ir;for(const No of Ii)for(const zn of No.positionedGlyphs)zn.x+=rr,zn.y+=Or})(ye.positionedLines,Ct,mi,Rn,$t,Zi),ye.top+=-Rn*Zi,ye.bottom=ye.top+Zi,ye.left+=-mi*$t,ye.right=ye.left+$t,ye.hasBaseline=pi}(xe,e,i,r,X,d,m,y,I,v,L,F),!function(ye){for(const We of ye)if(We.positionedGlyphs.length!==0)return!1;return!0}(fe)&&xe}const nf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Wm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function up(t,e,i,r,a,u){if(e.imageName){const d=r[e.imageName];return d?d.displaySize[0]*e.scale*go/u+a:0}{const d=i[e.fontStack],m=d&&d.glyphs[t];return m?m.metrics.advance*e.scale+a:0}}function qm(t,e,i,r){const a=Math.pow(t-e,2);return r?t<e?a/2:2*a:a+Math.abs(i)*i}function Bg(t,e,i){let r=0;return t===10&&(r-=1e4),i&&(r+=150),t!==40&&t!==65288||(r+=50),e!==41&&e!==65289||(r+=50),r}function Zm(t,e,i,r,a,u){let d=null,m=qm(e,i,a,u);for(const y of r){const v=qm(e-y.x,i,a,u)+y.badness;v<=m&&(d=y,m=v)}return{index:t,x:e,priorBreak:d,badness:m}}function Hm(t){return t?Hm(t.priorBreak).concat(t.index):[]}function jc(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function $m(t,e,i,r,a){if(!(e||i||r||a))return;const u=t.length-1,d=t[u],m=(d.x+d.metrics.advance*d.scale)*e;for(let y=0;y<=u;y++)t[y].x-=m,t[y].y+=i+r+a}function Fg(t,e,i){const{horizontalAlign:r,verticalAlign:a}=jc(i),u=e[0]-t.displaySize[0]*r,d=e[1]-t.displaySize[1]*a;return{image:t,top:d,bottom:d+t.displaySize[1],left:u,right:u+t.displaySize[0]}}function Xm(t,e,i,r,a,u){const d=t.image;let m;if(d.content){const X=d.content,se=d.pixelRatio||1;m=[X[0]/se,X[1]/se,d.displaySize[0]-X[2]/se,d.displaySize[1]-X[3]/se]}const y=e.left*u,v=e.right*u;let A,I,L,k;i==="width"||i==="both"?(k=a[0]+y-r[3],I=a[0]+v+r[1]):(k=a[0]+(y+v-d.displaySize[0])/2,I=k+d.displaySize[0]);const F=e.top*u,G=e.bottom*u;return i==="height"||i==="both"?(A=a[1]+F-r[0],L=a[1]+G+r[2]):(A=a[1]+(F+G-d.displaySize[1])/2,L=A+d.displaySize[1]),{image:d,top:A,right:I,bottom:L,left:k,collisionPadding:m}}class sc extends $e{constructor(e,i,r,a,u){super(e,i),this.angle=a,this.z=r,u!==void 0&&(this.segment=u)}clone(){return new sc(this.x,this.y,this.z,this.angle,this.segment)}}function Km(t,e,i,r,a){if(e.segment===void 0)return!0;let u=e,d=e.segment+1,m=0;for(;m>-i/2;){if(d--,d<0)return!1;m-=t[d].dist(u),u=t[d]}m+=t[d].dist(t[d+1]),d++;const y=[];let v=0;for(;m<i/2;){const A=t[d],I=t[d+1];if(!I)return!1;let L=t[d-1].angleTo(A)-A.angleTo(I);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:m,angleDelta:L}),v+=L;m-y[0].distance>r;)v-=y.shift().angleDelta;if(v>a)return!1;d++,m+=A.dist(I)}return!0}function hp(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function dp(t,e,i){return t?.6*e*i:0}function Ym(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Ng(t,e,i,r,a,u){const d=dp(i,a,u),m=Ym(i,r)*u;let y=0;const v=hp(t)/2;for(let A=0;A<t.length-1;A++){const I=t[A],L=t[A+1],k=I.dist(L);if(y+k>v){const F=(v-y)/k,G=Ei(I.x,L.x,F),X=Ei(I.y,L.y,F),se=new sc(G,X,0,L.angleTo(I),A);return!d||Km(t,se,m,d,e)?se:void 0}y+=k}}function Ug(t,e,i,r,a,u,d,m,y){const v=dp(r,u,d),A=Ym(r,a),I=A*d,L=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-I<e/4&&(e=I+e/4),Jm(t,L?e/2*m%e:(A/2+2*u)*d*m%e,e,v,i,I,L,!1,y)}function Jm(t,e,i,r,a,u,d,m,y){const v=u/2,A=hp(t);let I=0,L=e-i,k=[];for(let F=0;F<t.length-1;F++){const G=t[F],X=t[F+1],se=G.dist(X),pe=X.angleTo(G);for(;L+i<I+se;){L+=i;const re=(L-I)/se,fe=Ei(G.x,X.x,re),xe=Ei(G.y,X.y,re);if(fe>=0&&fe<y&&xe>=0&&xe<y&&L-v>=0&&L+v<=A){const ye=new sc(fe,xe,0,pe,F);ye._round(),r&&!Km(t,ye,u,r,a)||k.push(ye)}}I+=se}return m||k.length||d||(k=Jm(t,I/2,i,r,a,u,d,!0,y)),k}function Qm(t,e,i,r,a){const u=[];for(let d=0;d<t.length;d++){const m=t[d];let y;for(let v=0;v<m.length-1;v++){let A=m[v],I=m[v+1];A.x<e&&I.x<e||(A.x<e?A=new $e(e,A.y+(e-A.x)/(I.x-A.x)*(I.y-A.y))._round():I.x<e&&(I=new $e(e,A.y+(e-A.x)/(I.x-A.x)*(I.y-A.y))._round()),A.y<i&&I.y<i||(A.y<i?A=new $e(A.x+(i-A.y)/(I.y-A.y)*(I.x-A.x),i)._round():I.y<i&&(I=new $e(A.x+(i-A.y)/(I.y-A.y)*(I.x-A.x),i)._round()),A.x>=r&&I.x>=r||(A.x>=r?A=new $e(r,A.y+(r-A.x)/(I.x-A.x)*(I.y-A.y))._round():I.x>=r&&(I=new $e(r,A.y+(r-A.x)/(I.x-A.x)*(I.y-A.y))._round()),A.y>=a&&I.y>=a||(A.y>=a?A=new $e(A.x+(a-A.y)/(I.y-A.y)*(I.x-A.x),a)._round():I.y>=a&&(I=new $e(A.x+(a-A.y)/(I.y-A.y)*(I.x-A.x),a)._round()),y&&A.equals(y[y.length-1])||(y=[A],u.push(y)),y.push(I)))))}}return u}Rt(sc,"Anchor");const Zh=1e20;function e_(t,e,i,r,a,u,d,m,y){for(let v=e;v<e+r;v++)t_(t,i*u+v,u,a,d,m,y);for(let v=i;v<i+a;v++)t_(t,v*u+e,1,r,d,m,y)}function t_(t,e,i,r,a,u,d){u[0]=0,d[0]=-Zh,d[1]=Zh,a[0]=t[e];for(let m=1,y=0,v=0;m<r;m++){a[m]=t[e+m*i];const A=m*m;do{const I=u[y];v=(a[m]-a[I]+A-I*I)/(m-I)/2}while(v<=d[y]&&--y>-1);y++,u[y]=m,d[y]=v,d[y+1]=Zh}for(let m=0,y=0;m<r;m++){for(;d[y+1]<m;)y++;const v=u[y],A=m-v;t[e+m*i]=a[v]+A*A}}const fp={none:0,ideographs:1,all:2};class ah{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const r=[];for(const a in e)for(const u of e[a])r.push({stack:a,id:u});nn(r,({stack:a,id:u},d)=>{let m=this.entries[a];m||(m=this.entries[a]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=m.glyphs[u];if(y!==void 0)return void d(null,{stack:a,id:u,glyph:y});if(y=this._tinySDF(m,a,u),y)return m.glyphs[u]=y,void d(null,{stack:a,id:u,glyph:y});const v=Math.floor(u/256);if(256*v>65535)return void d(new Error("glyphs > 65535 not supported"));if(m.ranges[v])return void d(null,{stack:a,id:u,glyph:y});let A=m.requests[v];A||(A=m.requests[v]=[],ah.loadGlyphRange(a,v,this.url,this.requestManager,(I,L)=>{if(L){m.ascender=L.ascender,m.descender=L.descender;for(const k in L.glyphs)this._doesCharSupportLocalGlyph(+k)||(m.glyphs[+k]=L.glyphs[+k]);m.ranges[v]=!0}for(const k of A)k(I,L);delete m.requests[v]})),A.push((I,L)=>{I?d(I):L&&d(null,{stack:a,id:u,glyph:L.glyphs[u]||null})})},(a,u)=>{if(a)i(a);else if(u){const d={};for(const{stack:m,id:y,glyph:v}of u)d[m]===void 0&&(d[m]={}),d[m].glyphs===void 0&&(d[m].glyphs={}),d[m].glyphs[y]=v&&{id:v.id,bitmap:v.bitmap.clone(),metrics:v.metrics},d[m].ascender=this.entries[m].ascender,d[m].descender=this.entries[m].descender;i(null,d)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==fp.none&&(this.localGlyphMode===fp.all?!!this.localFontFamily:!!this.localFontFamily&&(Wu(e)||_d(e)||Ta(e)||Lc(e)||gu(e)))}_tinySDF(e,i,r){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(r))return;let u=e.tinySDF;if(!u){let G="400";/bold/i.test(i)?G="900":/medium/i.test(i)?G="500":/light/i.test(i)&&(G="200"),u=e.tinySDF=new ah.TinySDF({fontFamily:a,fontWeight:G,fontSize:48,buffer:6,radius:16}),u.fontWeight=G}if(this.localGlyphs[u.fontWeight][r])return this.localGlyphs[u.fontWeight][r];const d=String.fromCharCode(r),{data:m,width:y,height:v,glyphWidth:A,glyphHeight:I,glyphLeft:L,glyphTop:k,glyphAdvance:F}=u.draw(d);return this.localGlyphs[u.fontWeight][r]={id:r,bitmap:new Ca({width:y,height:v},m),metrics:{width:A/2,height:I/2,left:L/2,top:k/2-27,advance:F/2,localGlyph:!0}}}}function i_(t,e,i,r){const a=[],u=t.image,d=u.pixelRatio,m=u.paddedRect.w-2,y=u.paddedRect.h-2,v=t.right-t.left,A=t.bottom-t.top,I=u.stretchX||[[0,m]],L=u.stretchY||[[0,y]],k=(Xe,at)=>Xe+at[1]-at[0],F=I.reduce(k,0),G=L.reduce(k,0),X=m-F,se=y-G;let pe=0,re=F,fe=0,xe=G,ye=0,We=X,Ge=0,nt=se;if(u.content&&r){const Xe=u.content;pe=rf(I,0,Xe[0]),fe=rf(L,0,Xe[1]),re=rf(I,Xe[0],Xe[2]),xe=rf(L,Xe[1],Xe[3]),ye=Xe[0]-pe,Ge=Xe[1]-fe,We=Xe[2]-Xe[0]-re,nt=Xe[3]-Xe[1]-xe}const vt=(Xe,at,ct,gt)=>{const bt=of(Xe.stretch-pe,re,v,t.left),Ke=sf(Xe.fixed-ye,We,Xe.stretch,F),It=of(at.stretch-fe,xe,A,t.top),hi=sf(at.fixed-Ge,nt,at.stretch,G),kt=of(ct.stretch-pe,re,v,t.left),$t=sf(ct.fixed-ye,We,ct.stretch,F),Ct=of(gt.stretch-fe,xe,A,t.top),pi=sf(gt.fixed-Ge,nt,gt.stretch,G),Ji=new $e(bt,It),Ki=new $e(kt,It),Zi=new $e(kt,Ct),mi=new $e(bt,Ct),Rn=new $e(Ke/d,hi/d),Ii=new $e($t/d,pi/d),Qi=e*Math.PI/180;if(Qi){const Kn=Math.sin(Qi),nr=Math.cos(Qi),rr=[nr,-Kn,Kn,nr];Ji._matMult(rr),Ki._matMult(rr),mi._matMult(rr),Zi._matMult(rr)}const Un=Xe.stretch+Xe.fixed,ir=at.stretch+at.fixed;return{tl:Ji,tr:Ki,bl:mi,br:Zi,tex:{x:u.paddedRect.x+1+Un,y:u.paddedRect.y+1+ir,w:ct.stretch+ct.fixed-Un,h:gt.stretch+gt.fixed-ir},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Rn,pixelOffsetBR:Ii,minFontScaleX:We/d/v,minFontScaleY:nt/d/A,isSDF:i}};if(r&&(u.stretchX||u.stretchY)){const Xe=n_(I,X,F),at=n_(L,se,G);for(let ct=0;ct<Xe.length-1;ct++){const gt=Xe[ct],bt=Xe[ct+1];for(let Ke=0;Ke<at.length-1;Ke++)a.push(vt(gt,at[Ke],bt,at[Ke+1]))}}else a.push(vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:y+1}));return a}function rf(t,e,i){let r=0;for(const a of t)r+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return r}function n_(t,e,i){const r=[{fixed:-1,stretch:0}];for(const[a,u]of t){const d=r[r.length-1];r.push({fixed:a-d.stretch,stretch:d.stretch}),r.push({fixed:a-d.stretch,stretch:d.stretch+(u-a)})}return r.push({fixed:e+1,stretch:i}),r}function of(t,e,i,r){return t/e*i+r}function sf(t,e,i,r){return t-e*i/r}function Vg(t,e,i,r){const a=e+t.positionedLines[r].lineOffset;return r===0?i+a/2:i+(a+(e+t.positionedLines[r-1].lineOffset))/2}ah.loadGlyphRange=function(t,e,i,r,a){const u=256*e,d=u+255,m=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${u}-${d}`),ts.Glyphs);is(m,(y,v)=>{if(y)a(y);else if(v){const A={},I=function(L){return new Gc(L).readFields(Rg,{})}(v);for(const L of I.glyphs)A[L.id]=L;a(null,{glyphs:A,ascender:I.ascender,descender:I.descender})}})},ah.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:a="sans-serif",fontWeight:u="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const m=this.size=t+4*e,y=this._createCanvas(m),v=this.ctx=y.getContext("2d",{willReadFrequently:!0});v.font=`${d} ${u} ${t}px ${a}`,v.textBaseline="alphabetic",v.textAlign="left",v.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:a,actualBoundingBoxRight:u}=this.ctx.measureText(t),d=Math.ceil(i),m=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-a))),y=Math.min(this.size-this.buffer,d+Math.ceil(r)),v=m+2*this.buffer,A=y+2*this.buffer,I=Math.max(v*A,0),L=new Uint8ClampedArray(I),k={data:L,width:v,height:A,glyphWidth:m,glyphHeight:y,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(m===0||y===0)return k;const{ctx:F,buffer:G,gridInner:X,gridOuter:se}=this;F.clearRect(G,G,m,y),F.fillText(t,G,G+d);const pe=F.getImageData(G,G,m,y);se.fill(Zh,0,I),X.fill(0,0,I);for(let re=0;re<y;re++)for(let fe=0;fe<m;fe++){const xe=pe.data[4*(re*m+fe)+3]/255;if(xe===0)continue;const ye=(re+G)*v+fe+G;if(xe===1)se[ye]=0,X[ye]=Zh;else{const We=.5-xe;se[ye]=We>0?We*We:0,X[ye]=We<0?We*We:0}}e_(se,0,0,v,A,v,this.f,this.v,this.z),e_(X,G,G,m,y,v,this.f,this.v,this.z);for(let re=0;re<I;re++){const fe=Math.sqrt(se[re])-Math.sqrt(X[re]);L[re]=Math.round(255-255*(fe/this.radius+this.cutoff))}return k}};class Gg{constructor(e=[],i=jg){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:r}=this,a=i[e];for(;e>0;){const u=e-1>>1,d=i[u];if(r(a,d)>=0)break;i[e]=d,e=u}i[e]=a}_down(e){const{data:i,compare:r}=this,a=this.length>>1,u=i[e];for(;e<a;){let d=1+(e<<1),m=i[d];const y=d+1;if(y<this.length&&r(i[y],m)<0&&(d=y,m=i[y]),r(m,u)>=0)break;i[e]=m,e=d}i[e]=u}}function jg(t,e){return t<e?-1:t>e?1:0}function Wg(t,e=1,i=!1){let r=1/0,a=1/0,u=-1/0,d=-1/0;const m=t[0];for(let k=0;k<m.length;k++){const F=m[k];(!k||F.x<r)&&(r=F.x),(!k||F.y<a)&&(a=F.y),(!k||F.x>u)&&(u=F.x),(!k||F.y>d)&&(d=F.y)}const y=Math.min(u-r,d-a);let v=y/2;const A=new Gg([],qg);if(y===0)return new $e(r,a);for(let k=r;k<u;k+=y)for(let F=a;F<d;F+=y)A.push(new lh(k+v,F+v,v,t));let I=function(k){let F=0,G=0,X=0;const se=k[0];for(let pe=0,re=se.length,fe=re-1;pe<re;fe=pe++){const xe=se[pe],ye=se[fe],We=xe.x*ye.y-ye.x*xe.y;G+=(xe.x+ye.x)*We,X+=(xe.y+ye.y)*We,F+=3*We}return new lh(G/F,X/F,0,k)}(t),L=A.length;for(;A.length;){const k=A.pop();(k.d>I.d||!I.d)&&(I=k,i&&console.log("found best %d after %d probes",Math.round(1e4*k.d)/1e4,L)),k.max-I.d<=e||(v=k.h/2,A.push(new lh(k.p.x-v,k.p.y-v,v,t)),A.push(new lh(k.p.x+v,k.p.y-v,v,t)),A.push(new lh(k.p.x-v,k.p.y+v,v,t)),A.push(new lh(k.p.x+v,k.p.y+v,v,t)),L+=4)}return i&&(console.log(`num probes: ${L}`),console.log(`best distance: ${I.d}`)),I.p}function qg(t,e){return e.max-t.max}function lh(t,e,i,r){this.p=new $e(t,e),this.h=i,this.d=function(a,u){let d=!1,m=1/0;for(let y=0;y<u.length;y++){const v=u[y];for(let A=0,I=v.length,L=I-1;A<I;L=A++){const k=v[A],F=v[L];k.y>a.y!=F.y>a.y&&a.x<(F.x-k.x)*(a.y-k.y)/(F.y-k.y)+k.x&&(d=!d),m=Math.min(m,lm(a,k,F))}}return(d?1:-1)*Math.sqrt(m)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}const pp=Number.POSITIVE_INFINITY,Zg=Math.sqrt(2);function r_(t,[e,i]){let r=0,a=0;if(i===pp){e<0&&(e=0);const u=e/Zg;switch(t){case"top-right":case"top-left":a=u-7;break;case"bottom-right":case"bottom-left":a=7-u;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(t){case"top-right":case"bottom-right":r=-u;break;case"top-left":case"bottom-left":r=u;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":a=i-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-i}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,a]}function Hg(t,e,i,r,a,u,d,m,y,v){t.createArrays(),t.tilePixelRatio=di/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const A=t.layers[0].layout,I=t.layers[0]._unevaluatedLayout._values,L={};if(t.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:X}=t.textSizeData;L.compositeTextSizes=[I["text-size"].possiblyEvaluate(new ke(G),m),I["text-size"].possiblyEvaluate(new ke(X),m)]}if(t.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:X}=t.iconSizeData;L.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new ke(G),m),I["icon-size"].possiblyEvaluate(new ke(X),m)]}L.layoutTextSize=I["text-size"].possiblyEvaluate(new ke(y+1),m),L.layoutIconSize=I["icon-size"].possiblyEvaluate(new ke(y+1),m),L.textMaxSize=I["text-size"].possiblyEvaluate(new ke(18),m);const k=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",F=A.get("text-size");for(const G of t.features){const X=A.get("text-font").evaluate(G,{},m).join(","),se=F.evaluate(G,{},m),pe=L.layoutTextSize.evaluate(G,{},m),re=(L.layoutIconSize.evaluate(G,{},m),{horizontal:{},vertical:void 0}),fe=G.text;let xe,ye=[0,0];if(fe){const nt=fe.toString(),vt=A.get("text-letter-spacing").evaluate(G,{},m)*go,Xe=A.get("text-line-height").evaluate(G,{},m)*go,at=_(nt)?vt:0,ct=A.get("text-anchor").evaluate(G,{},m),gt=A.get("text-variable-anchor");if(!gt){const kt=A.get("text-radial-offset").evaluate(G,{},m);ye=kt?r_(ct,[kt*go,pp]):A.get("text-offset").evaluate(G,{},m).map($t=>$t*go)}let bt=k?"center":A.get("text-justify").evaluate(G,{},m);const Ke=A.get("symbol-placement")==="point",It=Ke?A.get("text-max-width").evaluate(G,{},m)*go:1/0,hi=kt=>{t.allowVerticalPlacement&&p(nt)&&(re.vertical=cp(fe,e,i,a,X,It,Xe,ct,kt,at,ye,na.vertical,!0,pe,se))};if(!k&&gt){const kt=bt==="auto"?gt.map(Ct=>Hh(Ct)):[bt];let $t=!1;for(let Ct=0;Ct<kt.length;Ct++){const pi=kt[Ct];if(!re.horizontal[pi])if($t)re.horizontal[pi]=re.horizontal[0];else{const Ji=cp(fe,e,i,a,X,It,Xe,"center",pi,at,ye,na.horizontal,!1,pe,se);Ji&&(re.horizontal[pi]=Ji,$t=Ji.positionedLines.length===1)}}hi("left")}else{if(bt==="auto"&&(bt=Hh(ct)),Ke||A.get("text-writing-mode").indexOf("horizontal")>=0||!p(nt)){const kt=cp(fe,e,i,a,X,It,Xe,ct,bt,at,ye,na.horizontal,!1,pe,se);kt&&(re.horizontal[bt]=kt)}hi(Ke?"left":bt)}}let We=!1;if(G.icon&&G.icon.name){const nt=r[G.icon.name];nt&&(xe=Fg(a[G.icon.name],A.get("icon-offset").evaluate(G,{},m),A.get("icon-anchor").evaluate(G,{},m)),We=nt.sdf,t.sdfIcons===void 0?t.sdfIcons=nt.sdf:t.sdfIcons!==nt.sdf&&Oi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(nt.pixelRatio!==t.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ge=a_(re.horizontal)||re.vertical;t.iconsInText||(t.iconsInText=!!Ge&&Ge.iconsInText),(Ge||xe)&&o_(t,G,re,xe,r,L,pe,0,ye,We,d,m,v)}u&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)}function Hh(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function o_(t,e,i,r,a,u,d,m,y,v,A,I,L){let k=u.textMaxSize.evaluate(e,{},I);k===void 0&&(k=d);const F=t.layers[0].layout,G=F.get("icon-offset").evaluate(e,{},I),X=a_(i.horizontal)||i.vertical,se=L.name==="globe",pe=d/24,re=t.tilePixelRatio*k/24,fe=(at=t.overscaling,t.zoom>18&&at>2&&(at>>=1),Math.max(di/(512*at),1)*F.get("symbol-spacing")),xe=F.get("text-padding")*t.tilePixelRatio,ye=F.get("icon-padding")*t.tilePixelRatio,We=Ht(F.get("text-max-angle")),Ge=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",nt=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",vt=F.get("symbol-placement"),Xe=fe/2;var at;const ct=F.get("icon-text-fit");let gt;r&&ct!=="none"&&(t.allowVerticalPlacement&&i.vertical&&(gt=Xm(r,i.vertical,ct,F.get("icon-text-fit-padding"),G,pe)),X&&(r=Xm(r,X,ct,F.get("icon-text-fit-padding"),G,pe)));const bt=(Ke,It,hi)=>{if(It.x<0||It.x>=di||It.y<0||It.y>=di)return;let kt=null;if(se){const{x:$t,y:Ct,z:pi}=L.projectTilePoint(It.x,It.y,hi);kt={anchor:new sc($t,Ct,pi,0,void 0),up:L.upVector(hi,It.x,It.y)}}(function($t,Ct,pi,Ji,Ki,Zi,mi,Rn,Ii,Qi,Un,ir,Kn,nr,rr,Or,No,zn,io,Kr,yn,gr,yo,Vn,jr){const ms=$t.addToLineVertexArray(Ct,Ji);let Uo,Vo,Ls,Go,Mu,_f,Ep,Ap=0,jy=0,Wy=0,qy=0,py=-1,my=-1;const Zc={};let Zy=Oc("");const Qh=pi?pi.anchor:Ct;let _y=0,gy=0;if(Ii._unevaluatedLayout.getValue("text-radial-offset")===void 0?[_y,gy]=Ii.layout.get("text-offset").evaluate(yn,{},jr).map(Da=>Da*go):(_y=Ii.layout.get("text-radial-offset").evaluate(yn,{},jr)*go,gy=pp),$t.allowVerticalPlacement&&Ki.vertical){const Da=Ki.vertical;if(rr)_f=$h(Da),Rn&&(Ep=$h(Rn));else{const La=Ii.layout.get("text-rotate").evaluate(yn,{},jr)+90;Ls=af(Qi,Qh,Ct,Un,ir,Kn,Da,nr,La,Or),Rn&&(Go=af(Qi,Qh,Ct,Un,ir,Kn,Rn,zn,La))}}if(Zi){const Da=Ii.layout.get("icon-rotate").evaluate(yn,{},jr),La=Ii.layout.get("icon-text-fit")!=="none",Sp=i_(Zi,Da,yo,La),vy=Rn?i_(Rn,Da,yo,La):void 0;Vo=af(Qi,Qh,Ct,Un,ir,Kn,Zi,zn,Da),Ap=4*Sp.length;const Hy=$t.iconSizeData;let ed=null;Hy.kind==="source"?(ed=[So*Ii.layout.get("icon-size").evaluate(yn,{},jr)],ed[0]>ac&&Oi(`${$t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Hy.kind==="composite"&&(ed=[So*gr.compositeIconSizes[0].evaluate(yn,{},jr),So*gr.compositeIconSizes[1].evaluate(yn,{},jr)],(ed[0]>ac||ed[1]>ac)&&Oi(`${$t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),$t.addSymbols($t.icon,Sp,ed,Kr,io,yn,!1,pi,Ct,ms.lineStartIndex,ms.lineLength,-1,Vn,jr),py=$t.icon.placedSymbolArray.length-1,vy&&(jy=4*vy.length,$t.addSymbols($t.icon,vy,ed,Kr,io,yn,na.vertical,pi,Ct,ms.lineStartIndex,ms.lineLength,-1,Vn,jr),my=$t.icon.placedSymbolArray.length-1)}for(const Da in Ki.horizontal){const La=Ki.horizontal[Da];Uo||(Zy=Oc(La.text),rr?Mu=$h(La):Uo=af(Qi,Qh,Ct,Un,ir,Kn,La,nr,Ii.layout.get("text-rotate").evaluate(yn,{},jr),Or));const Sp=La.positionedLines.length===1;if(Wy+=s_($t,pi,Ct,La,mi,Ii,rr,yn,Or,ms,Ki.vertical?na.horizontal:na.horizontalOnly,Sp?Object.keys(Ki.horizontal):[Da],Zc,py,gr,Vn,jr),Sp)break}Ki.vertical&&(qy+=s_($t,pi,Ct,Ki.vertical,mi,Ii,rr,yn,Or,ms,na.vertical,["vertical"],Zc,my,gr,Vn,jr));let uh=-1;const yy=(Da,La)=>Da?Math.max(Da,La):La;uh=yy(Mu,uh),uh=yy(_f,uh),uh=yy(Ep,uh);const C0=uh>-1?1:0;$t.glyphOffsetArray.length>=Wc.MAX_GLYPHS&&Oi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yn.sortKey!==void 0&&$t.addToSortKeyRanges($t.symbolInstances.length,yn.sortKey),$t.symbolInstances.emplaceBack(Qh.x,Qh.y,Qh.z,Ct.x,Ct.y,Zc.right>=0?Zc.right:-1,Zc.center>=0?Zc.center:-1,Zc.left>=0?Zc.left:-1,Zc.vertical>=0?Zc.vertical:-1,py,my,Zy,Uo!==void 0?Uo:$t.collisionBoxArray.length,Uo!==void 0?Uo+1:$t.collisionBoxArray.length,Ls!==void 0?Ls:$t.collisionBoxArray.length,Ls!==void 0?Ls+1:$t.collisionBoxArray.length,Vo!==void 0?Vo:$t.collisionBoxArray.length,Vo!==void 0?Vo+1:$t.collisionBoxArray.length,Go||$t.collisionBoxArray.length,Go?Go+1:$t.collisionBoxArray.length,Un,Wy,qy,Ap,jy,C0,0,_y,gy,uh)})(t,It,kt,Ke,i,r,a,gt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,xe,Ge,y,0,ye,nt,G,e,u,v,A,I)};if(vt==="line")for(const Ke of Qm(e.geometry,0,0,di,di)){const It=Ug(Ke,fe,We,i.vertical||X,r,24,re,t.overscaling,di);for(const hi of It){const kt=X;kt&&$g(t,kt.text,Xe,hi)||bt(Ke,hi,I)}}else if(vt==="line-center"){for(const Ke of e.geometry)if(Ke.length>1){const It=Ng(Ke,We,i.vertical||X,r,24,re);It&&bt(Ke,It,I)}}else if(e.type==="Polygon")for(const Ke of jd(e.geometry,0)){const It=Wg(Ke,16);bt(Ke[0],new sc(It.x,It.y,0,0,void 0),I)}else if(e.type==="LineString")for(const Ke of e.geometry)bt(Ke,new sc(Ke[0].x,Ke[0].y,0,0,void 0),I);else if(e.type==="Point")for(const Ke of e.geometry)for(const It of Ke)bt([It],new sc(It.x,It.y,0,0,void 0),I)}const ac=32640;function s_(t,e,i,r,a,u,d,m,y,v,A,I,L,k,F,G,X){const se=function(fe,xe,ye,We,Ge,nt,vt,Xe){const at=[];if(xe.positionedLines.length===0)return at;const ct=We.layout.get("text-rotate").evaluate(nt,{})*Math.PI/180,gt=function(kt){const $t=kt[0],Ct=kt[1],pi=$t*Ct;return pi>0?[$t,-Ct]:pi<0?[-$t,Ct]:$t===0?[Ct,$t]:[Ct,-$t]}(ye);let bt=Math.abs(xe.top-xe.bottom);for(const kt of xe.positionedLines)bt-=kt.lineOffset;const Ke=xe.positionedLines.length,It=bt/Ke;let hi=xe.top-ye[1];for(let kt=0;kt<Ke;++kt){const $t=xe.positionedLines[kt];hi=Vg(xe,It,hi,kt);for(const Ct of $t.positionedGlyphs){if(!Ct.rect)continue;const pi=Ct.rect||{};let Ji=4,Ki=!0,Zi=1,mi=0;if(Ct.imageName){const Vn=vt[Ct.imageName];if(!Vn)continue;if(Vn.sdf){Oi("SDF images are not supported in formatted text and will be ignored.");continue}Ki=!1,Zi=Vn.pixelRatio,Ji=1/Zi}const Rn=(Ge||Xe)&&Ct.vertical,Ii=Ct.metrics.advance*Ct.scale/2,Qi=Ct.metrics,Un=Ct.rect;if(Un===null)continue;Xe&&xe.verticalizable&&(mi=Ct.imageName?Ii-Ct.metrics.width*Ct.scale/2:0);const ir=Ge?[Ct.x+Ii,Ct.y]:[0,0];let Kn=[0,0],nr=[0,0],rr=!1;Ge||(Rn?(nr=[Ct.x+Ii+gt[0],Ct.y+gt[1]-mi],rr=!0):Kn=[Ct.x+Ii+ye[0],Ct.y+ye[1]-mi]);const Or=Un.w*Ct.scale/(Zi*(Ct.localGlyph?2:1)),No=Un.h*Ct.scale/(Zi*(Ct.localGlyph?2:1));let zn,io,Kr,yn;if(Rn){const Vn=Ct.y-hi,jr=new $e(-Ii,Ii-Vn),ms=-Math.PI/2,Uo=new $e(...nr);zn=new $e(-Ii+Kn[0],Kn[1]),zn._rotateAround(ms,jr)._add(Uo),zn.x+=-Vn+Ii,zn.y-=(Qi.left-Ji)*Ct.scale;const Vo=Ct.imageName?Qi.advance*Ct.scale:go*Ct.scale,Ls=String.fromCharCode(Ct.glyph);Sg(Ls)?zn.x+=(1-Ji)*Ct.scale:Bm(Ls)?zn.x+=Vo-Qi.height*Ct.scale+(-Ji-1)*Ct.scale:zn.x+=Ct.imageName||Qi.width+2*Ji===Un.w&&Qi.height+2*Ji===Un.h?(Vo-No)/2:(Vo-(Qi.height+2*Ji)*Ct.scale)/2,io=new $e(zn.x,zn.y-Or),Kr=new $e(zn.x+No,zn.y),yn=new $e(zn.x+No,zn.y-Or)}else{const Vn=(Qi.left-Ji)*Ct.scale-Ii+Kn[0],jr=(-Qi.top-Ji)*Ct.scale+Kn[1],ms=Vn+Or,Uo=jr+No;zn=new $e(Vn,jr),io=new $e(ms,jr),Kr=new $e(Vn,Uo),yn=new $e(ms,Uo)}if(ct){let Vn;Vn=Ge?new $e(0,0):rr?new $e(gt[0],gt[1]):new $e(ye[0],ye[1]),zn._rotateAround(ct,Vn),io._rotateAround(ct,Vn),Kr._rotateAround(ct,Vn),yn._rotateAround(ct,Vn)}const gr=new $e(0,0),yo=new $e(0,0);at.push({tl:zn,tr:io,bl:Kr,br:yn,tex:pi,writingMode:xe.writingMode,glyphOffset:ir,sectionIndex:Ct.sectionIndex,isSDF:Ki,pixelOffsetTL:gr,pixelOffsetBR:yo,minFontScaleX:0,minFontScaleY:0})}}return at}(0,r,y,u,d,m,a,t.allowVerticalPlacement),pe=t.textSizeData;let re=null;pe.kind==="source"?(re=[So*u.layout.get("text-size").evaluate(m,{},X)],re[0]>ac&&Oi(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):pe.kind==="composite"&&(re=[So*F.compositeTextSizes[0].evaluate(m,{},X),So*F.compositeTextSizes[1].evaluate(m,{},X)],(re[0]>ac||re[1]>ac)&&Oi(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,se,re,y,d,m,A,e,i,v.lineStartIndex,v.lineLength,k,G,X);for(const fe of I)L[fe]=t.text.placedSymbolArray.length-1;return 4*se.length}function a_(t){for(const e in t)return t[e];return null}function af(t,e,i,r,a,u,d,m,y,v){let A=d.top,I=d.bottom,L=d.left,k=d.right;const F=d.collisionPadding;if(F&&(L-=F[0],A-=F[1],k+=F[2],I+=F[3]),y){const G=new $e(L,A),X=new $e(k,A),se=new $e(L,I),pe=new $e(k,I),re=Ht(y);let fe=new $e(0,0);v&&(fe=new $e(v[0],v[1])),G._rotateAround(re,fe),X._rotateAround(re,fe),se._rotateAround(re,fe),pe._rotateAround(re,fe),L=Math.min(G.x,X.x,se.x,pe.x),k=Math.max(G.x,X.x,se.x,pe.x),A=Math.min(G.y,X.y,se.y,pe.y),I=Math.max(G.y,X.y,se.y,pe.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,L,A,k,I,m,r,a,u),t.length-1}function $h(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function $g(t,e,i,r){const a=t.compareText;if(e in a){const u=a[e];for(let d=u.length-1;d>=0;d--)if(r.dist(u[d])<i)return!0}else a[e]=[];return a[e].push(r),!1}function l_(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),u=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),d=Math.sin(t._pitch)*u+a;return Math.min(1.01*d,a*(1/t._horizonShift))}function Iu(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,a=(t.x+1)*i,u=t.y*i,d=(t.y+1)*i,m=ta(r),y=ta(a),v=Ao(u),A=Ao(d),I=e.project(m,v),L=e.project(y,v),k=e.project(y,A),F=e.project(m,A);let G=Math.min(I.x,L.x,k.x,F.x),X=Math.min(I.y,L.y,k.y,F.y),se=Math.max(I.x,L.x,k.x,F.x),pe=Math.max(I.y,L.y,k.y,F.y);const re=i/16;function fe(ye,We,Ge,nt,vt,Xe){const at=(Ge+vt)/2,ct=(nt+Xe)/2,gt=e.project(ta(at),Ao(ct)),bt=Math.max(0,G-gt.x,X-gt.y,gt.x-se,gt.y-pe);G=Math.min(G,gt.x),se=Math.max(se,gt.x),X=Math.min(X,gt.y),pe=Math.max(pe,gt.y),bt>re&&(fe(ye,gt,Ge,nt,at,ct),fe(gt,We,at,ct,vt,Xe))}fe(I,L,r,u,a,u),fe(L,k,a,u,a,d),fe(k,F,a,d,r,d),fe(F,I,r,d,r,u),G-=re,X-=re,se+=re,pe+=re;const xe=1/Math.max(se-G,pe-X);return{scale:xe,x:G*xe,y:X*xe,x2:se*xe,y2:pe*xe,projection:e}}const Cs=As(new Float32Array(16));class Bl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new an(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r=!0){return e._coordinatePoint(e.locationCoordinate(i),r)}pixelsPerMeter(e,i){return sl(1,e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return l_(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,a){const u=e.horizonLineFromTop(!1),d=new $e(i,Math.max(u,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,a))}pointCoordinate3D(e,i,r){const a=new $e(i,r);if(e.elevation)return e.elevation.pointCoordinate(a);{const u=this.pointCoordinate(e,a.x,a.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return Cs}createTileMatrix(e,i,r){let a,u,d;const m=r.canonical,y=As(new Float64Array(16));if(this.isReprojectedInTileSpace){const v=Iu(m,this);a=1,u=v.x+r.wrap*v.scale,d=v.y,Bc(y,y,[a/v.scale,a/v.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(m.z),u=(m.x+Math.pow(2,m.z)*r.wrap)*a,d=m.y*a;return Sh(y,y,[u,d,0]),Bc(y,y,[a/di,a/di,1]),y}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class Xg extends Bl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,r]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(Ht(i));this.n=(a+Math.sin(Ht(r)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:r,c:a,r0:u}=this,d=Ht(e-this.center[0]),m=Ht(i),y=Math.sqrt(a-2*r*Math.sin(m))/r;return{x:y*Math.sin(d*r),y:y*Math.cos(d*r)-u,z:0}}unproject(e,i){const{n:r,c:a,r0:u}=this,d=u+i;let m=Math.atan2(e,Math.abs(d))*Math.sign(d);d*r<0&&(m-=Math.PI*Math.sign(e)*Math.sign(d));const y=Ht(this.center[0])*r;m=pn(m,-Math.PI-y,Math.PI-y);const v=ii(Ut(m/r)+this.center[0],-180,180),A=Math.asin(ii((a-(e*e+d*d)*r*r)/(2*r),-1,1)),I=ii(Ut(A),-Xn,Xn);return new an(v,I)}}const Xh=1.340264,Kh=-.081106,Yh=893e-6,Cu=.003796,lf=Math.sqrt(3)/2;class mp extends Bl{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(lf*Math.sin(i)),a=r*r,u=a*a*a;return{x:.5*(e*Math.cos(r)/(lf*(Xh+3*Kh*a+u*(7*Yh+9*Cu*a)))/Math.PI+.5),y:1-.5*(r*(Xh+Kh*a+u*(Yh+Cu*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,a=r*r,u=a*a*a;for(let A,I,L,k=0;k<12&&(I=r*(Xh+Kh*a+u*(Yh+Cu*a))-i,L=Xh+3*Kh*a+u*(7*Yh+9*Cu*a),A=I/L,r=ii(r-A,-Math.PI/3,Math.PI/3),a=r*r,u=a*a*a,!(Math.abs(A)<1e-12));++k);const d=lf*e*(Xh+3*Kh*a+u*(7*Yh+9*Cu*a))/Math.cos(r),m=Math.asin(Math.sin(r)/lf),y=ii(180*d/Math.PI,-180,180),v=ii(180*m/Math.PI,-Xn,Xn);return new an(y,v)}}class Kg extends Bl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const r=360*(e-.5),a=ii(360*(.5-i),-Xn,Xn);return new an(r,a)}}const ch=Math.PI/2;function cf(t){return Math.tan((ch+t)/2)}class Yg extends Bl{constructor(e){super(e),this.center=e.center||[0,30];const[i,r]=this.parallels=e.parallels||[30,30];let a=Ht(i),u=Ht(r);this.southernCenter=a+u<0,this.southernCenter&&(a=-a,u=-u);const d=Math.cos(a),m=cf(a);this.n=a===u?Math.sin(a):Math.log(d/Math.cos(u))/Math.log(cf(u)/m),this.f=d*Math.pow(cf(a),this.n)/this.n}project(e,i){i=Ht(i),this.southernCenter&&(i=-i),e=Ht(e-this.center[0]);const r=1e-6,{n:a,f:u}=this;u>0?i<-ch+r&&(i=-ch+r):i>ch-r&&(i=ch-r);const d=u/Math.pow(cf(i),a);let m=d*Math.sin(a*e),y=u-d*Math.cos(a*e);return m=.5*(m/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:m,y:this.southernCenter?y:1-y,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:a}=this,u=a-i,d=Math.sign(u),m=Math.sign(r)*Math.sqrt(e*e+u*u);let y=Math.atan2(e,Math.abs(u))*d;u*r<0&&(y-=Math.PI*Math.sign(e)*d);const v=ii(Ut(y/r)+this.center[0],-180,180),A=ii(Ut(2*Math.atan(Math.pow(a/m,1/r))-ch),-Xn,Xn);return new an(v,this.southernCenter?-A:A)}}class _p extends Bl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Rl(e),y:zl(i),z:0}}unproject(e,i){const r=ta(e),a=Ao(i);return new an(r,a)}}const c_=Ht(Xn);class Jg extends Bl{project(e,i){const r=(i=Ht(i))*i,a=r*r;return{x:.5*((e=Ht(e))*(.8707-.131979*r+a*(a*(.003971*r-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+a*(.028874*r-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,a=25,u=0,d=r*r;do{d=r*r;const v=d*d;u=(r*(1.007226+d*(.015085+v*(.028874*d-.044475-.005916*v)))-i)/(1.007226+d*(.045255+v*(.259866*d-.311325-.005916*11*v))),r=ii(r-u,-c_,c_)}while(Math.abs(u)>1e-6&&--a>0);d=r*r;const m=ii(Ut(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),y=Ut(r);return new an(m,y)}}const u_=Ht(Xn);class gp extends Bl{project(e,i){i=Ht(i),e=Ht(e);const r=Math.cos(i),a=2/Math.PI,u=Math.acos(r*Math.cos(e/2)),d=Math.sin(u)/u,m=.5*(e*a+2*r*Math.sin(e/2)/d)||0,y=.5*(i+Math.sin(i)/d)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,u=25;const d=1e-6;let m=0,y=0;do{const v=Math.cos(a),A=Math.sin(a),I=2*A*v,L=A*A,k=v*v,F=Math.cos(r/2),G=Math.sin(r/2),X=2*F*G,se=G*G,pe=1-k*F*F,re=pe?1/pe:0,fe=pe?Math.acos(v*F)*Math.sqrt(1/pe):0,xe=.5*(2*fe*v*G+2*r/Math.PI)-e,ye=.5*(fe*A+a)-i,We=.5*re*(k*se+fe*v*F*L)+1/Math.PI,Ge=re*(X*I/4-fe*A*G),nt=.125*re*(I*G-fe*A*k*X),vt=.5*re*(L*F+fe*se*v)+.5,Xe=Ge*nt-vt*We;m=(ye*Ge-xe*vt)/Xe,y=(xe*nt-ye*We)/Xe,r=ii(r-m,-Math.PI,Math.PI),a=ii(a-y,-u_,u_)}while((Math.abs(m)>d||Math.abs(y)>d)&&--u>0);return new an(Ut(r),Ut(a))}}class uf extends Bl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ht(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:r,cosPhi:a}=this;return{x:Ht(e)*a*r+.5,y:-Math.sin(Ht(i))/a*r+.5,z:0}}unproject(e,i){const{scale:r,cosPhi:a}=this,u=-(i-.5)/r,d=ii(Ut((e-.5)/r)/a,-180,180),m=Math.asin(ii(u*a,-1,1)),y=ii(Ut(m),-Xn,Xn);return new an(d,y)}}class Qg extends _p{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,r){const a=Oh(e,i,r);return _r(a,a,Rh(rl(r))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i){const r=Yu(i.lat,i.lng),a=Ur([],r),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;vu(r,r,a,sl(1,0)*di*u);const d=As(new Float64Array(16));return tc(d,e.pixelMatrix,e.globeMatrix),_r(r,r,d),new $e(r[0],r[1])}pixelsPerMeter(e,i){return sl(1,0)*i}pixelSpaceConversion(e,i,r){const a=sl(1,e)*i,u=Ei(sl(1,45)*i,a,r);return this.pixelsPerMeter(e,i)/u}createTileMatrix(e,i,r){const a=Bf(rl(r.canonical));return tc(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){const{center:r}=e,a=Rh(rl(i));return Ih(a,a,Ht(r.lng)),tl(a,a,Ht(r.lat)),Bc(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,r,a){return Xu(e,i,r,!0)||new Qu(0,0)}pointCoordinate3D(e,i,r){const a=this.pointCoordinate(e,i,r,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!Xu(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(a,u){const d=a.cameraToCenterDistance,m=a._centerAltitude*u,y=a._camera,v=a._camera.forward(),A=il([],Ho([],v,-d),[0,0,m]),I=a.worldSize/(2*Math.PI),L=[0,0,-I],k=a.width/a.height,F=Math.tan(a.fovAboveCenter),G=Ho([],y.up(),F),X=Ho([],y.right(),F*k),se=Ur([],il([],il([],v,G),X)),pe=[];let re;if(new Cd(A,se).closestPointOnSphere(L,I,pe)){const fe=il([],pe,L),xe=nl([],fe,A);re=Math.cos(a.fovAboveCenter)*Qs(xe)}else{const fe=nl([],A,L),xe=nl([],L,A);Ur(xe,xe);const ye=Qs(fe)-I;re=Math.sqrt(ye*(ye+2*I));const We=Math.acos(re/(I+ye))-Math.acos(Sa(v,xe));re*=Math.cos(We)}return 1.01*re}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=Ju(e.zoom);if(r>0){const a=l_(e,sl(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ei(i,a+u*(1-Math.cos(d)),Math.pow(r,10))}return i}upVector(e,i,r){return Oh(i,r,e,1)}upVectorScale(e){return{metersToTile:Ph(Od(rl(e)))}}}function h_(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new _p(t);case"equirectangular":return new Kg(t);case"naturalEarth":return new Jg(t);case"equalEarth":return new mp(t);case"winkelTripel":return new gp(t);case"albers":return i?new uf(t):new Xg(t);case"lambertConformalConic":return i?new uf(t):new Yg(t);case"globe":return new Qg(t)}throw new Error(`Invalid projection name: ${t.name}`)}const ey=Kd.types,ty=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hf(t,e,i,r,a,u,d,m,y,v,A,I,L){const k=m?Math.min(ac,Math.round(m[0])):0,F=m?Math.min(ac,Math.round(m[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*a),u,d,(k<<1)+(y?1:0),F,16*v,16*A,256*I,256*L)}function df(t,e,i,r,a,u,d){t.emplaceBack(e,i,r,a,u,d)}function ff(t,e,i,r,a){t.emplaceBack(e,i,r,a),t.emplaceBack(e,i,r,a),t.emplaceBack(e,i,r,a),t.emplaceBack(e,i,r,a)}function iy(t){for(const e of t.sections)if(U(e.text))return!0;return!1}class yp{constructor(e){this.layoutVertexArray=new ws,this.indexArray=new mo,this.programConfigurations=e,this.segments=new cr,this.dynamicLayoutVertexArray=new In,this.opacityVertexArray=new Ln,this.placedSymbolArray=new Lp,this.globeExtVertexArray=new $n}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,r,a){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ia.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,bg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ty,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,nh.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}Rt(yp,"SymbolBuffers");class vp{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new cr,this.collisionVertexArray=new Wn,this.collisionVertexArrayExt=new to}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,wg.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Tg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Rt(vp,"CollisionBuffers");class Wc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=As([]),this.placementViewportMatrix=As([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Xi(this.zoom,i["text-size"]),this.iconSizeData=Xi(this.zoom,i["icon-size"]);const r=this.layers[0].layout,a=r.get("symbol-sort-key"),u=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(d=>na[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new yp(new Aa(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new yp(new Aa(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Af,this.lineVertexArray=new Sf,this.symbolInstances=new gd}calculateGlyphDependencies(e,i,r,a,u){for(let d=0;d<e.length;d++)if(i[e.charCodeAt(d)]=!0,a&&u){const m=Cn[e.charAt(d)];m&&(i[m.charCodeAt(0)]=!0)}}populate(e,i,r,a){const u=this.layers[0],d=u.layout,m=this.projection.name==="globe",y=d.get("text-font"),v=d.get("text-field"),A=d.get("icon-image"),I=(v.value.kind!=="constant"||v.value.value instanceof Zr&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),L=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,k=d.get("symbol-sort-key");if(this.features=[],!I&&!L)return;const F=i.iconDependencies,G=i.glyphDependencies,X=i.availableImages,se=new ke(this.zoom);for(const{feature:pe,id:re,index:fe,sourceLayerIndex:xe}of e){const ye=u._featureFilter.needGeometry,We=Tu(pe,ye);if(!u._featureFilter.filter(se,We,r))continue;if(ye||(We.geometry=nc(pe,r,a)),m&&pe.type!==1&&r.z<=5){const Xe=We.geometry,at=.98078528056,ct=(gt,bt)=>Sa(Oh(gt.x,gt.y,r,1),Oh(bt.x,bt.y,r,1))<at;for(let gt=0;gt<Xe.length;gt++)Xe[gt]=k_(Xe[gt],ct)}let Ge,nt;if(I){const Xe=u.getValueAndResolveTokens("text-field",We,r,X),at=Zr.factory(Xe);iy(at)&&(this.hasRTLText=!0),(!this.hasRTLText||ve()==="unavailable"||this.hasRTLText&&we.isParsed())&&(Ge=Ag(at,u,We))}if(L){const Xe=u.getValueAndResolveTokens("icon-image",We,r,X);nt=Xe instanceof uo?Xe:uo.fromString(Xe)}if(!Ge&&!nt)continue;const vt=this.sortFeaturesByKey?k.evaluate(We,{},r):void 0;if(this.features.push({id:re,text:Ge,icon:nt,index:fe,sourceLayerIndex:xe,geometry:We.geometry,properties:pe.properties,type:ey[pe.type],sortKey:vt}),nt&&(F[nt.name]=!0),Ge){const Xe=y.evaluate(We,{},r).join(","),at=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(na.vertical)>=0;for(const ct of Ge.sections)if(ct.image)F[ct.image.name]=!0;else{const gt=p(Ge.toString()),bt=ct.fontStack||Xe,Ke=G[bt]=G[bt]||{};this.calculateGlyphDependencies(ct.text,Ke,at,this.allowVerticalPlacement,gt)}}}d.get("symbol-placement")==="line"&&(this.features=function(pe){const re={},fe={},xe=[];let ye=0;function We(Xe){xe.push(pe[Xe]),ye++}function Ge(Xe,at,ct){const gt=fe[Xe];return delete fe[Xe],fe[at]=gt,xe[gt].geometry[0].pop(),xe[gt].geometry[0]=xe[gt].geometry[0].concat(ct[0]),gt}function nt(Xe,at,ct){const gt=re[at];return delete re[at],re[Xe]=gt,xe[gt].geometry[0].shift(),xe[gt].geometry[0]=ct[0].concat(xe[gt].geometry[0]),gt}function vt(Xe,at,ct){const gt=ct?at[0][at[0].length-1]:at[0][0];return`${Xe}:${gt.x}:${gt.y}`}for(let Xe=0;Xe<pe.length;Xe++){const at=pe[Xe],ct=at.geometry,gt=at.text?at.text.toString():null;if(!gt){We(Xe);continue}const bt=vt(gt,ct),Ke=vt(gt,ct,!0);if(bt in fe&&Ke in re&&fe[bt]!==re[Ke]){const It=nt(bt,Ke,ct),hi=Ge(bt,Ke,xe[It].geometry);delete re[bt],delete fe[Ke],fe[vt(gt,xe[hi].geometry,!0)]=hi,xe[It].geometry=null}else bt in fe?Ge(bt,Ke,ct):Ke in re?nt(bt,Ke,ct):(We(Xe),re[bt]=ye-1,fe[Ke]=ye-1)}return xe.filter(Xe=>Xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((pe,re)=>pe.sortKey-re.sortKey)}update(e,i,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,r,a),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,r,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=h_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const r=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:u}of i)this.lineVertexArray.emplaceBack(a,u);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,a,u,d,m,y,v,A,I,L,k,F){const G=e.indexArray,X=e.layoutVertexArray,se=e.globeExtVertexArray,pe=e.segments.prepareSegment(4*i.length,X,G,this.canOverlap?d.sortKey:void 0),re=this.glyphOffsetArray.length,fe=pe.vertexLength,xe=this.allowVerticalPlacement&&m===na.vertical?Math.PI/2:0,ye=d.text&&d.text.sections;for(let Ge=0;Ge<i.length;Ge++){const{tl:nt,tr:vt,bl:Xe,br:at,tex:ct,pixelOffsetTL:gt,pixelOffsetBR:bt,minFontScaleX:Ke,minFontScaleY:It,glyphOffset:hi,isSDF:kt,sectionIndex:$t}=i[Ge],Ct=pe.vertexLength,pi=hi[1];if(hf(X,v.x,v.y,nt.x,pi+nt.y,ct.x,ct.y,r,kt,gt.x,gt.y,Ke,It),hf(X,v.x,v.y,vt.x,pi+vt.y,ct.x+ct.w,ct.y,r,kt,bt.x,gt.y,Ke,It),hf(X,v.x,v.y,Xe.x,pi+Xe.y,ct.x,ct.y+ct.h,r,kt,gt.x,bt.y,Ke,It),hf(X,v.x,v.y,at.x,pi+at.y,ct.x+ct.w,ct.y+ct.h,r,kt,bt.x,bt.y,Ke,It),y){const{x:Ji,y:Ki,z:Zi}=y.anchor,[mi,Rn,Ii]=y.up;df(se,Ji,Ki,Zi,mi,Rn,Ii),df(se,Ji,Ki,Zi,mi,Rn,Ii),df(se,Ji,Ki,Zi,mi,Rn,Ii),df(se,Ji,Ki,Zi,mi,Rn,Ii),ff(e.dynamicLayoutVertexArray,Ji,Ki,Zi,xe)}else ff(e.dynamicLayoutVertexArray,v.x,v.y,v.z,xe);G.emplaceBack(Ct,Ct+1,Ct+2),G.emplaceBack(Ct+1,Ct+2,Ct+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(hi[0]),Ge!==i.length-1&&$t===i[Ge+1].sectionIndex||e.programConfigurations.populatePaintArrays(X.length,d,d.index,{},k,F,ye&&ye[$t])}const We=y?y.anchor:v;e.placedSymbolArray.emplaceBack(We.x,We.y,We.z,v.x,v.y,re,this.glyphOffsetArray.length-re,fe,A,I,v.segment,r?r[0]:0,r?r[1]:0,a[0],a[1],m,0,!1,0,L,0)}_commitLayoutVertex(e,i,r,a,u,d,m){e.emplaceBack(i,r,a,u,d,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,i,r,a,u,d,m){const y=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),v=y.vertexLength,A=m.tileAnchorX,I=m.tileAnchorY;for(let k=0;k<4;k++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,a,u,d,A,I,new $e(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,a,u,d,A,I,new $e(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,a,u,d,A,I,new $e(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,a,u,d,A,I,new $e(e.x1,e.y2)),y.vertexLength+=4;const L=r.indexArray;L.emplaceBack(v,v+1),L.emplaceBack(v+1,v+2),L.emplaceBack(v+2,v+3),L.emplaceBack(v+3,v),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,a,u,d){for(let m=a;m<u;m++){const y=r.get(m),v=this.getSymbolInstanceTextSize(e,d,i,m);this._addCollisionDebugVertices(y,v,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,i,r,a,u,d){for(let m=a;m<u;m++){const y=r.get(m),v=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._addCollisionDebugVertices(y,v,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vp(mr,zm.members,Ml),this.iconCollisionBox=new vp(mr,zm.members,Ml);const r=Fo(this.iconSizeData,e),a=Fo(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const d=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(a,e,i,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(a,e,i,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(r,e,i,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(r,e,i,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(e,i,r,a){const u=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),d=qh(this.textSizeData,e,u)/go;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,i,r){const a=this.icon.placedSymbolArray.get(r),u=qh(this.iconSizeData,e,a);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,i,r){e.emplaceBack(i,-r,-r),e.emplaceBack(i,r,-r),e.emplaceBack(i,r,r),e.emplaceBack(i,-r,r)}_updateTextDebugCollisionBoxes(e,i,r,a,u,d){for(let m=a;m<u;m++){const y=r.get(m),v=this.getSymbolInstanceTextSize(e,d,i,m);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,v,y.padding)}}_updateIconDebugCollisionBoxes(e,i,r,a,u,d){for(let m=a;m<u;m++){const y=r.get(m),v=this.getSymbolInstanceIconSize(e,i,d);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,v,y.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Fo(this.iconSizeData,e),a=Fo(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){const d=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(a,e,i,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(a,e,i,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(r,e,i,d.iconBoxStartIndex,d.iconBoxEndIndex,d.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(r,e,i,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,a,u,d,m,y,v){const A={};if(i<r){const{x1:I,y1:L,x2:k,y2:F,padding:G,projectedAnchorX:X,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:re,tileAnchorY:fe,featureIndex:xe}=e.get(i);A.textBox={x1:I,y1:L,x2:k,y2:F,padding:G,projectedAnchorX:X,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:re,tileAnchorY:fe},A.textFeatureIndex=xe}if(a<u){const{x1:I,y1:L,x2:k,y2:F,padding:G,projectedAnchorX:X,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:re,tileAnchorY:fe,featureIndex:xe}=e.get(a);A.verticalTextBox={x1:I,y1:L,x2:k,y2:F,padding:G,projectedAnchorX:X,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:re,tileAnchorY:fe},A.verticalTextFeatureIndex=xe}if(d<m){const{x1:I,y1:L,x2:k,y2:F,padding:G,projectedAnchorX:X,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:re,tileAnchorY:fe,featureIndex:xe}=e.get(d);A.iconBox={x1:I,y1:L,x2:k,y2:F,padding:G,projectedAnchorX:X,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:re,tileAnchorY:fe},A.iconFeatureIndex=xe}if(y<v){const{x1:I,y1:L,x2:k,y2:F,padding:G,projectedAnchorX:X,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:re,tileAnchorY:fe,featureIndex:xe}=e.get(y);A.verticalIconBox={x1:I,y1:L,x2:k,y2:F,padding:G,projectedAnchorX:X,projectedAnchorY:se,projectedAnchorZ:pe,tileAnchorX:re,tileAnchorY:fe},A.verticalIconFeatureIndex=xe}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const r=e.placedSymbolArray.get(i),a=r.vertexStartIndex+4*r.numGlyphs;for(let u=r.vertexStartIndex;u<a;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),r=Math.cos(e),a=[],u=[],d=[];for(let m=0;m<this.symbolInstances.length;++m){d.push(m);const y=this.symbolInstances.get(m);a.push(0|Math.round(i*y.tileAnchorX+r*y.tileAnchorY)),u.push(y.featureIndex)}return d.sort((m,y)=>a[m]-a[y]||u[y]-u[m]),d}addToSortKeyRanges(e,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:m,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:v}=r;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),u>=0&&u!==a&&this.addIndicesForPlacedSymbol(this.text,u),d>=0&&d!==u&&d!==a&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Rt(Wc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Wc.MAX_GLYPHS=65535,Wc.addDynamicAttributes=ff;const ny=new pt({"symbol-placement":new Oe(Ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Oe(Ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Oe(Ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ze(Ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Oe(Ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Oe(Ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Oe(Ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Oe(Ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Oe(Ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ze(Ye.layout_symbol["icon-size"]),"icon-text-fit":new Oe(Ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Oe(Ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ze(Ye.layout_symbol["icon-image"]),"icon-rotate":new Ze(Ye.layout_symbol["icon-rotate"]),"icon-padding":new Oe(Ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Oe(Ye.layout_symbol["icon-keep-upright"]),"icon-offset":new Ze(Ye.layout_symbol["icon-offset"]),"icon-anchor":new Ze(Ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Oe(Ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Oe(Ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Oe(Ye.layout_symbol["text-rotation-alignment"]),"text-field":new Ze(Ye.layout_symbol["text-field"]),"text-font":new Ze(Ye.layout_symbol["text-font"]),"text-size":new Ze(Ye.layout_symbol["text-size"]),"text-max-width":new Ze(Ye.layout_symbol["text-max-width"]),"text-line-height":new Ze(Ye.layout_symbol["text-line-height"]),"text-letter-spacing":new Ze(Ye.layout_symbol["text-letter-spacing"]),"text-justify":new Ze(Ye.layout_symbol["text-justify"]),"text-radial-offset":new Ze(Ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Oe(Ye.layout_symbol["text-variable-anchor"]),"text-anchor":new Ze(Ye.layout_symbol["text-anchor"]),"text-max-angle":new Oe(Ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Oe(Ye.layout_symbol["text-writing-mode"]),"text-rotate":new Ze(Ye.layout_symbol["text-rotate"]),"text-padding":new Oe(Ye.layout_symbol["text-padding"]),"text-keep-upright":new Oe(Ye.layout_symbol["text-keep-upright"]),"text-transform":new Ze(Ye.layout_symbol["text-transform"]),"text-offset":new Ze(Ye.layout_symbol["text-offset"]),"text-allow-overlap":new Oe(Ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Oe(Ye.layout_symbol["text-ignore-placement"]),"text-optional":new Oe(Ye.layout_symbol["text-optional"])});var xp={paint:new pt({"icon-opacity":new Ze(Ye.paint_symbol["icon-opacity"]),"icon-color":new Ze(Ye.paint_symbol["icon-color"]),"icon-halo-color":new Ze(Ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ze(Ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ze(Ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Oe(Ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Oe(Ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ze(Ye.paint_symbol["text-opacity"]),"text-color":new Ze(Ye.paint_symbol["text-color"],{runtimeType:xo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Ze(Ye.paint_symbol["text-halo-color"]),"text-halo-width":new Ze(Ye.paint_symbol["text-halo-width"]),"text-halo-blur":new Ze(Ye.paint_symbol["text-halo-blur"]),"text-translate":new Oe(Ye.paint_symbol["text-translate"]),"text-translate-anchor":new Oe(Ye.paint_symbol["text-translate-anchor"])}),layout:ny};class d_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ha,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Rt(d_,"FormatSectionOverride",{omit:["defaultValue"]});class pf extends Qa{constructor(e){super(e,xp)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const a=[];for(const u of r)a.indexOf(u)<0&&a.push(u);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,r,a){const u=this.layout.get(e).evaluate(i,{},r,a),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||$l(d.value)||!u?u:function(m,y){return y.replace(/{([^{}]+)}/g,(v,A)=>A in m?String(m[A]):"")}(i.properties,u)}createBucket(e){return new Wc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of xp.paint.overridableProperties){if(!pf.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),r=new d_(i),a=new va(r,i.property.specification);let u=null;u=i.value.kind==="constant"||i.value.kind==="source"?new su("source",a):new Ys("composite",a,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new mt(i.property,u,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&pf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const r=e.get("text-field"),a=xp.paint.properties[i];let u=!1;const d=m=>{for(const y of m)if(a.overrides&&a.overrides.hasOverride(y))return void(u=!0)};if(r.value.kind==="constant"&&r.value.value instanceof Zr)d(r.value.value.sections);else if(r.value.kind==="source"){const m=v=>{u||(v instanceof cl&&wr(v.value)===he?d(v.value.sections):v instanceof Sn?d(v.sections):v.eachChild(m))},y=r.value;y._styleExpression&&m(y._styleExpression.expression)}return u}getProgramConfiguration(e){return new Ja(this,e)}}var ry={paint:new pt({"background-color":new Oe(Ye.paint_background["background-color"]),"background-pattern":new Oe(Ye.paint_background["background-pattern"]),"background-opacity":new Oe(Ye.paint_background["background-opacity"])})},oy={paint:new pt({"raster-opacity":new Oe(Ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new Oe(Ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Oe(Ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Oe(Ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Oe(Ye.paint_raster["raster-saturation"]),"raster-contrast":new Oe(Ye.paint_raster["raster-contrast"]),"raster-resampling":new Oe(Ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Oe(Ye.paint_raster["raster-fade-duration"])})};class sy extends Qa{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var ay={paint:new pt({"sky-type":new Oe(Ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new Oe(Ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Oe(Ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Oe(Ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Oe(Ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new ut(Ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Oe(Ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Oe(Ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Oe(Ye.paint_sky["sky-opacity"])})};function bp(t,e,i){const r=[0,0,1],a=Ll([]);return Id(a,a,i?-Ht(t)+Math.PI:Ht(t)),$o(a,a,-Ht(e)),ko(r,r,a),Ur(r,r)}const ly={circle:class extends Qa{constructor(t){super(t,V_)}createBucket(t){return new qf(t)}queryRadius(t){const e=t;return eh("circle-radius",this,e)+eh("circle-stroke-width",this,e)+Bd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,a,u,d,m){const y=Fd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),v=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return fm(t,r,u,d,m,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,v)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Ja(this,t)}},heatmap:class extends Qa{createBucket(t){return new mm(t)}constructor(t){super(t,q_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Kf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return eh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,a,u,d,m){const y=this.paint.get("heatmap-radius").evaluate(e,i);return fm(t,r,u,d,m,!0,!0,new $e(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Ja(this,t)}},hillshade:class extends Qa{constructor(t){super(t,Z_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Qa{constructor(t){super(t,ng)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new Ja(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Vh(t)}queryRadius(){return Bd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,a,u){return!t.queryGeometry.isAboveHorizon&&am(hm(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends Qa{constructor(t){super(t,mg)}createBucket(t){return new Fi(t)}queryRadius(){return Bd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Ja(this,t)}queryIntersectsFeature(t,e,i,r,a,u,d,m,y){const v=Fd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,i),I=this.paint.get("fill-extrusion-base").evaluate(e,i),L=[0,0],k=m&&u.elevation,F=u.elevation?u.elevation.exaggeration():1,G=t.tile.getBucket(this);if(k&&G instanceof Fi){const fe=G.centroidVertexArray,xe=y+1;xe<fe.length&&(L[0]=fe.geta_centroid_pos0(xe),L[1]=fe.geta_centroid_pos1(xe))}if(L[0]===0&&L[1]===1)return!1;u.projection.name==="globe"&&(r=Lm([r],[new $e(0,0),new $e(di,di)],t.tileID.canonical).map(fe=>fe.polygon).flat());const X=k?m:null,[se,pe]=function(fe,xe,ye,We,Ge,nt,vt,Xe,at,ct,gt){return fe.projection.name==="globe"?function(bt,Ke,It,hi,kt,$t,Ct,pi,Ji,Ki,Zi){const mi=[],Rn=[],Ii=bt.projection.upVectorScale(Zi,bt.center.lat,bt.worldSize).metersToTile,Qi=[0,0,0,1],Un=[0,0,0,1],ir=(nr,rr,Or,No)=>{nr[0]=rr,nr[1]=Or,nr[2]=No,nr[3]=1},Kn=Dm();It>0&&(It+=Kn),hi+=Kn;for(const nr of Ke){const rr=[],Or=[];for(const No of nr){const zn=No.x+kt.x,io=No.y+kt.y,Kr=bt.projection.projectTilePoint(zn,io,Zi),yn=bt.projection.upVector(Zi,No.x,No.y);let gr=It,yo=hi;if(Ct){const Vn=Pm(zn,io,It,hi,Ct,pi,Ji,Ki);gr+=Vn.base,yo+=Vn.top}It!==0?ir(Qi,Kr.x+yn[0]*Ii*gr,Kr.y+yn[1]*Ii*gr,Kr.z+yn[2]*Ii*gr):ir(Qi,Kr.x,Kr.y,Kr.z),ir(Un,Kr.x+yn[0]*Ii*yo,Kr.y+yn[1]*Ii*yo,Kr.z+yn[2]*Ii*yo),_r(Qi,Qi,$t),_r(Un,Un,$t),rr.push(new tr(Qi[0],Qi[1],Qi[2])),Or.push(new tr(Un[0],Un[1],Un[2]))}mi.push(rr),Rn.push(Or)}return[mi,Rn]}(fe,xe,ye,We,Ge,nt,vt,Xe,at,ct,gt):vt?function(bt,Ke,It,hi,kt,$t,Ct,pi,Ji){const Ki=[],Zi=[],mi=[0,0,0,1];for(const Rn of bt){const Ii=[],Qi=[];for(const Un of Rn){const ir=Un.x+hi.x,Kn=Un.y+hi.y,nr=Pm(ir,Kn,Ke,It,$t,Ct,pi,Ji);mi[0]=ir,mi[1]=Kn,mi[2]=nr.base,mi[3]=1,xu(mi,mi,kt),mi[3]=Math.max(mi[3],1e-5);const rr=new tr(mi[0]/mi[3],mi[1]/mi[3],mi[2]/mi[3]);mi[0]=ir,mi[1]=Kn,mi[2]=nr.top,mi[3]=1,xu(mi,mi,kt),mi[3]=Math.max(mi[3],1e-5);const Or=new tr(mi[0]/mi[3],mi[1]/mi[3],mi[2]/mi[3]);Ii.push(rr),Qi.push(Or)}Ki.push(Ii),Zi.push(Qi)}return[Ki,Zi]}(xe,ye,We,Ge,nt,vt,Xe,at,ct):function(bt,Ke,It,hi,kt){const $t=[],Ct=[],pi=kt[8]*Ke,Ji=kt[9]*Ke,Ki=kt[10]*Ke,Zi=kt[11]*Ke,mi=kt[8]*It,Rn=kt[9]*It,Ii=kt[10]*It,Qi=kt[11]*It;for(const Un of bt){const ir=[],Kn=[];for(const nr of Un){const rr=nr.x+hi.x,Or=nr.y+hi.y,No=kt[0]*rr+kt[4]*Or+kt[12],zn=kt[1]*rr+kt[5]*Or+kt[13],io=kt[2]*rr+kt[6]*Or+kt[14],Kr=kt[3]*rr+kt[7]*Or+kt[15],yn=No+pi,gr=zn+Ji,yo=io+Ki,Vn=Math.max(Kr+Zi,1e-5),jr=No+mi,ms=zn+Rn,Uo=io+Ii,Vo=Math.max(Kr+Qi,1e-5);ir.push(new tr(yn/Vn,gr/Vn,yo/Vn)),Kn.push(new tr(jr/Vo,ms/Vo,Uo/Vo))}$t.push(ir),Ct.push(Kn)}return[$t,Ct]}(xe,ye,We,Ge,nt)}(u,r,I,A,v,d,X,L,F,u.center.lat,t.tileID.canonical),re=t.queryGeometry;return function(fe,xe,ye){let We=1/0;am(ye,xe)&&(We=ip(ye,xe[0]));for(let Ge=0;Ge<xe.length;Ge++){const nt=xe[Ge],vt=fe[Ge];for(let Xe=0;Xe<nt.length-1;Xe++){const at=nt[Xe],ct=[at,nt[Xe+1],vt[Xe+1],vt[Xe],at];sm(ye,ct)&&(We=Math.min(We,ip(ye,ct)))}}return We!==1/0&&We}(se,pe,re.isPointQuery()?re.screenBounds:re.screenGeometry)}},line:class extends Qa{constructor(t){super(t,Rm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof To,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=rp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Vc(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Ja(this,t)}queryRadius(t){const e=t,i=Wh(eh("line-width",this,e),eh("line-gap-width",this,e)),r=eh("line-offset",this,e);return i/2+Math.abs(r)+Bd(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,a,u){if(t.queryGeometry.isAboveHorizon)return!1;const d=hm(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),m=t.pixelToTileUnitsFactor/2*Wh(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),y=this.paint.get("line-offset").evaluate(e,i);return y&&(r=function(v,A){const I=[],L=new $e(0,0);for(let k=0;k<v.length;k++){const F=v[k],G=[];for(let X=0;X<F.length;X++){const se=F[X-1],pe=F[X],re=F[X+1],fe=X===0?L:pe.sub(se)._unit()._perp(),xe=X===F.length-1?L:re.sub(pe)._unit()._perp(),ye=fe._add(xe)._unit();ye._mult(1/(ye.x*xe.x+ye.y*xe.y)),G.push(ye._mult(A)._add(pe))}I.push(G)}return I}(r,y*t.pixelToTileUnitsFactor)),function(v,A,I){for(let L=0;L<A.length;L++){const k=A[L];if(v.length>=3){for(let F=0;F<k.length;F++)if(Eu(v,k[F]))return!0}if(F_(v,k,I))return!0}return!1}(d,r,m)}isTileClipped(){return!0}},symbol:pf,background:class extends Qa{constructor(t){super(t,ry)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Qa{constructor(t){super(t,oy)}getProgramIds(){return["raster"]}},sky:class extends Qa{constructor(t){super(t,ay),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Kf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const r=this.paint.get("sky-atmosphere-sun"),a=!r,u=t.style.light,d=u.properties.get("position");return a&&u.properties.get("anchor")==="viewport"&&Oi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?bp(d.azimuthal,90-d.polar,e):bp(r[0],90-r[1],e)}const i=this.paint.get("sky-gradient-center");return bp(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class l{constructor(e,i,r,a){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(i,a)}update(e,i,r){const{width:a,height:u}=e,{context:d}=this,{gl:m}=d,{HTMLImageElement:y,HTMLCanvasElement:v,HTMLVideoElement:A,ImageData:I,ImageBitmap:L}=B;if(m.bindTexture(m.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!i||i.premultiply!==!1)),r||this.size&&this.size[0]===a&&this.size[1]===u){const{x:k,y:F}=r||{x:0,y:0};e instanceof y||e instanceof v||e instanceof A||e instanceof I||L&&e instanceof L?m.texSubImage2D(m.TEXTURE_2D,0,k,F,m.RGBA,m.UNSIGNED_BYTE,e):m.texSubImage2D(m.TEXTURE_2D,0,k,F,a,u,m.RGBA,m.UNSIGNED_BYTE,e.data)}else this.size=[a,u],e instanceof y||e instanceof v||e instanceof A||e instanceof I||L&&e instanceof L?m.texImage2D(m.TEXTURE_2D,0,this.format,this.format,m.UNSIGNED_BYTE,e):m.texImage2D(m.TEXTURE_2D,0,this.format,a,u,0,this.format,m.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,i){const{context:r}=this,{gl:a}=r;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.filter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class f{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class w{constructor(){this.tasks={},this.taskQueue=[],Rr(["process"],this),this.invoker=new f(this.process),this.nextId=0}add(e,i){const r=this.nextId++,a=function({type:u,isSymbolTile:d,zoom:m}){return m=m||0,u==="message"?0:u!=="maybePrepare"||d?u!=="parseTile"||d?u==="parseTile"&&d?300-m:u==="maybePrepare"&&d?400-m:500:200-m:100-m}(i);if(a===0){Cr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:i,priority:a,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){Cr();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){const u=this.tasks[this.taskQueue[a]];u.priority<i&&(i=u.priority,e=a)}if(e===null)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class z{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const q=["tile","layer","source","sourceLayer","state"];class te{constructor(e,i,r,a,u){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=a,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of q)this[i]!==void 0&&(e[i]=this[i]);return e}}const me=32,Se=33,Fe=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,a=0,u=0,d=0,m=0;for(1&e?a=u=d=me:i=r=m=me;(e>>=1)>1;){const v=i+a>>1,A=r+u>>1;1&e?(a=i,u=r,i=d,r=m):(i=a,r=u,a=d,u=m),d=v,m=A}const y=4*t;Fe[y+0]=i,Fe[y+1]=r,Fe[y+2]=a,Fe[y+3]=u}const ft=new Uint16Array(2178),_t=new Uint8Array(1089),Et=new Uint16Array(1089);function jt(t){return t===0?-.03125:t===32?.03125:0}var ui=ei([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Mi={type:2,extent:di,loadGeometry:()=>[[new $e(0,0),new $e(8193,0),new $e(8193,8193),new $e(0,8193),new $e(0,0)]]};class Yi{constructor(e,i,r,a,u){this.tileID=e,this.uid=Wr(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,this.expiredRequestCount=0,this.state="loading",a&&a.transform&&(this.projection=a.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Hi.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Iu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(a,u){const d={};if(!u)return d;for(const m of a){const y=m.layerIds.map(v=>u.getLayer(v)).filter(Boolean);if(y.length!==0){m.layers=y,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(v=>y.filter(A=>A.id===v)[0]));for(const v of y)d[v.id]=m}}return d}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const a in this.buckets){const u=this.buckets[a];if(u instanceof Wc){if(this.hasSymbolBuckets=!0,!r)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const a in this.buckets){const u=this.buckets[a];if(u instanceof Wc&&u.hasRTLText){this.hasRTLText=!0,we.isLoading()||we.isLoaded()||ve()!=="deferred"||ge();break}}this.queryPadding=0;for(const a in this.buckets){const u=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(a).queryRadius(u))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ef}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const r in this.buckets){const a=this.buckets[r];a.uploadPending()&&a.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new l(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new l(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new l(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,r,a,u,d,m,y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:a,pixelPosMatrix:m,transform:d,params:u,tileTransform:this.tileTransform},e,i,r):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const a=r.loadVTLayers(),u=i?i.sourceLayer:"",d=a._geojsonTileLayer||a[u];if(!d)return;const m=Ar(i&&i.filter),{z:y,x:v,y:A}=this.tileID.canonical,I={z:y,x:v,y:A};for(let L=0;L<d.length;L++){const k=d.feature(L);if(m.needGeometry){const X=Tu(k,!0);if(!m.filter(new ke(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!m.filter(new ke(this.tileID.overscaledZ),k))continue;const F=r.getId(k,u),G=new te(k,y,v,A,F);G.tile=I,e.push(G)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const r=kr(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let a=!1;if(this.expirationTime>r)a=!1;else if(i)if(this.expirationTime<i)a=!0;else{const u=this.expirationTime-i;u?this.expirationTime=r+Math.max(u,3e4):a=!0}else a=!0;a?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const r=this.latestFeatureIndex.loadVTLayers(),a=i.style.listImages();for(const u in this.buckets){if(!i.style.hasLayer(u))continue;const d=this.buckets[u],m=d.layers[0].sourceLayer||"_geojsonTileLayer",y=r[m],v=e[m];if(!y||!v||Object.keys(v).length===0)continue;if(d.update(v,y,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),d instanceof Vc||d instanceof Vh){const I=i.style._getSourceCache(d.layers[0].source);i._terrain&&i._terrain.enabled&&I&&d.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(I.id,this.tileID)}const A=i&&i.style&&i.style.getLayer(u);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Hi.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Hi.now()+e}setTexture(e,i){const r=i.context,a=r.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new l(r,e,a.RGBA,{useMipmap:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax))}setDependencies(e,i){const r={};for(const a of i)r[a]=!0;this.dependencies[e]=r}hasDependency(e,i){for(const r of e){const a=this.dependencies[r];if(a){for(const u of i)if(a[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const r=nc(Mi,this.tileID.canonical,this.tileTransform)[0],a=new si,u=new Ts;for(let d=0;d<r.length;d++){const{x:m,y}=r[d];a.emplaceBack(m,y),u.emplaceBack(d)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(a,ic.members),this._tileDebugSegments=cr.simpleSegment(0,0,a.length,u.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const r=nc(Mi,this.tileID.canonical,this.tileTransform)[0];let a,u;if(this.isRaster){const d=function(m,y){const v=Iu(m,y),A=Math.pow(2,m.z);for(let X=0;X<Se;X++)for(let se=0;se<Se;se++){const pe=ta((m.x+(se+jt(se))/me)/A),re=Ao((m.y+(X+jt(X))/me)/A),fe=y.project(pe,re),xe=X*Se+se;ft[2*xe+0]=Math.round((fe.x*v.scale-v.x)*di),ft[2*xe+1]=Math.round((fe.y*v.scale-v.y)*di)}_t.fill(0),Et.fill(0);for(let X=2045;X>=0;X--){const se=4*X,pe=Fe[se+0],re=Fe[se+1],fe=Fe[se+2],xe=Fe[se+3],ye=pe+fe>>1,We=re+xe>>1,Ge=ye+We-re,nt=We+pe-ye,vt=re*Se+pe,Xe=xe*Se+fe,at=We*Se+ye,ct=Math.hypot((ft[2*vt+0]+ft[2*Xe+0])/2-ft[2*at+0],(ft[2*vt+1]+ft[2*Xe+1])/2-ft[2*at+1])>=16;if(_t[at]=_t[at]||(ct?1:0),X<1022){const gt=(re+nt>>1)*Se+(pe+Ge>>1),bt=(xe+nt>>1)*Se+(fe+Ge>>1);_t[at]=_t[at]||_t[gt]||_t[bt]}}const I=new xn,L=new mo;let k=0;function F(X,se){const pe=se*Se+X;return Et[pe]===0&&(I.emplaceBack(ft[2*pe+0],ft[2*pe+1],X*di/me,se*di/me),Et[pe]=++k),Et[pe]-1}function G(X,se,pe,re,fe,xe){const ye=X+pe>>1,We=se+re>>1;if(Math.abs(X-fe)+Math.abs(se-xe)>1&&_t[We*Se+ye])G(fe,xe,X,se,ye,We),G(pe,re,fe,xe,ye,We);else{const Ge=F(X,se),nt=F(pe,re),vt=F(fe,xe);L.emplaceBack(Ge,nt,vt)}}return G(0,0,me,me,me,0),G(me,me,0,0,0,me),{vertices:I,indices:L}}(this.tileID.canonical,i);a=d.vertices,u=d.indices}else{a=new xn,u=new mo;for(const{x:m,y}of r)a.emplaceBack(m,y,0,0);const d=th(a.int16,void 0,4);for(let m=0;m<d.length;m+=3)u.emplaceBack(d[m],d[m+1],d[m+2])}this._tileBoundsBuffer=e.createVertexBuffer(a,ui.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=cr.simpleSegment(0,0,a.length,u.length)}_makeGlobeTileDebugBuffers(e,i){const r=i.projection;if(!r||r.name!=="globe"||i.freezeTileCoverage)return;const a=this.tileID.canonical,u=Rh(kf(a,i)),d=Ju(i.zoom);let m;d>0&&(m=Sd(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,a,i,u,m,d),this._makeGlobeTileDebugTextBuffer(e,a,i,u,m,d)}_globePoint(e,i,r,a,u,d,m){let y=Oh(e,i,r);if(d){const v=1<<r.z,A=Rl(a.center.lng),I=zl(a.center.lat),L=(r.x+.5)/v-A;let k=0;L>.5?k=-1:L<-.5&&(k=1);let F=(e/di+r.x)/v+k,G=(i/di+r.y)/v;F=(F-A)*a._pixelsPerMercatorPixel+A,G=(G-I)*a._pixelsPerMercatorPixel+I;const X=[F*a.worldSize,G*a.worldSize,0];_r(X,X,d),y=Ol(y,X,m)}return _r(y,y,u)}_makeGlobeTileDebugBorderBuffer(e,i,r,a,u,d){const m=new si,y=new Ts,v=new dn,A=(L,k,F,G,X)=>{const se=(F-L)/(X-1),pe=(G-k)/(X-1),re=m.length;for(let fe=0;fe<X;fe++){const xe=L+fe*se,ye=k+fe*pe;m.emplaceBack(xe,ye);const We=this._globePoint(xe,ye,i,r,a,u,d);v.emplaceBack(We[0],We[1],We[2]),y.emplaceBack(re+fe)}},I=di;A(0,0,I,0,16),A(I,0,I,I,16),A(I,I,0,I,16),A(0,I,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(m,ic.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(v,Kp.members),this._tileDebugSegments=cr.simpleSegment(0,0,m.length,y.length)}_makeGlobeTileDebugTextBuffer(e,i,r,a,u,d){const m=new si,y=new mo,v=new dn,A=25;y.reserve(32),m.reserve(A),v.reserve(A);const I=(L,k)=>A*L+k;for(let L=0;L<A;L++){const k=2048*L;for(let F=0;F<A;F++){const G=2048*F;m.emplaceBack(G,k);const X=this._globePoint(G,k,i,r,a,u,d);v.emplaceBack(X[0],X[1],X[2])}}for(let L=0;L<4;L++)for(let k=0;k<4;k++){const F=I(L,k),G=I(L,k+1),X=I(L+1,k),se=I(L+1,k+1);y.emplaceBack(F,G,X),y.emplaceBack(X,G,se)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(y),this._tileDebugTextBuffer=e.createVertexBuffer(m,ic.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(v,Kp.members),this._tileDebugTextSegments=cr.simpleSegment(0,0,A,32)}}class Li{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const a=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][a]=this.stateChanges[e][a]||{},rn(this.stateChanges[e][a],r),this.deletedStates[e]===null){this.deletedStates[e]={};for(const u in this.state[e])u!==a&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][a]===null){this.deletedStates[e][a]={};for(const u in this.state[e][a])r[u]||(this.deletedStates[e][a][u]=null)}else for(const u in r)this.deletedStates[e]&&this.deletedStates[e][a]&&this.deletedStates[e][a][u]===null&&delete this.deletedStates[e][a][u]}removeFeatureState(e,i,r){if(this.deletedStates[e]===null)return;const a=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&i!==void 0)this.deletedStates[e][a]!==null&&(this.deletedStates[e][a]=this.deletedStates[e][a]||{},this.deletedStates[e][a][r]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][a])for(r in this.deletedStates[e][a]={},this.stateChanges[e][a])this.deletedStates[e][a][r]=null;else this.deletedStates[e][a]=null;else this.deletedStates[e]=null}getState(e,i){const r=String(i),a=rn({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const u=this.deletedStates[e][i];if(u===null)return{};for(const d in u)delete a[d]}return a}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const r={};for(const a in this.stateChanges){this.state[a]=this.state[a]||{};const u={};for(const d in this.stateChanges[a])this.state[a][d]||(this.state[a][d]={}),rn(this.state[a][d],this.stateChanges[a][d]),u[d]=this.state[a][d];r[a]=u}for(const a in this.deletedStates){this.state[a]=this.state[a]||{};const u={};if(this.deletedStates[a]===null)for(const d in this.state[a])u[d]={},this.state[a][d]={};else for(const d in this.deletedStates[a]){if(this.deletedStates[a][d]===null)this.state[a][d]={};else if(this.state[a][d])for(const m of Object.keys(this.deletedStates[a][d]))delete this.state[a][d][m];u[d]=this.state[a][d]}r[a]=r[a]||{},rn(r[a],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(const a in e)e[a].setFeatureState(r,i)}}class cn{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function gn(t,e,i,r){let a=0,u=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(r[d])<1e-15){if(i[d]<t[d]||i[d]>e[d])return null}else{const m=1/r[d];let y=(t[d]-i[d])*m,v=(e[d]-i[d])*m;if(y>v){const A=y;y=v,v=A}if(y>a&&(a=y),v<u&&(u=v),a>u)return null}return a}function Ms(t,e,i,r,a,u,d,m,y,v,A){const I=r-t,L=a-e,k=u-i,F=d-t,G=m-e,X=y-i,se=A[1]*X-A[2]*G,pe=A[2]*F-A[0]*X,re=A[0]*G-A[1]*F,fe=I*se+L*pe+k*re;if(Math.abs(fe)<1e-15)return null;const xe=1/fe,ye=v[0]-t,We=v[1]-e,Ge=v[2]-i,nt=(ye*se+We*pe+Ge*re)*xe;if(nt<0||nt>1)return null;const vt=We*k-Ge*L,Xe=Ge*I-ye*k,at=ye*L-We*I,ct=(A[0]*vt+A[1]*Xe+A[2]*at)*xe;return ct<0||nt+ct>1?null:(F*vt+G*Xe+X*at)*xe}function Ko(t,e,i){return(t-e)/(i-e)}function Ds(t,e,i,r,a,u,d,m,y){const v=1<<i,A=u-r,I=d-a,L=(t+1)/v*A+r,k=(e+0)/v*I+a,F=(e+1)/v*I+a;m[0]=(t+0)/v*A+r,m[1]=k,y[0]=L,y[1]=F}class Gr{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(u){const d=Math.ceil(Math.log2(u.dim/8)),m=[];let y=Math.ceil(Math.pow(2,d));const v=1/y,A=(k,F,G,X,se)=>{const pe=X?1:0,re=(k+1)*G-pe,fe=F*G,xe=(F+1)*G-pe;se[0]=k*G,se[1]=fe,se[2]=re,se[3]=xe};let I=new cn(y);const L=[];for(let k=0;k<y*y;k++){A(k%y,Math.floor(k/y),v,!1,L);const F=Yo(L[0],L[1],u),G=Yo(L[2],L[1],u),X=Yo(L[2],L[3],u),se=Yo(L[0],L[3],u);I.minimums.push(Math.min(F,G,X,se)),I.maximums.push(Math.max(F,G,X,se)),I.leaves.push(1)}for(m.push(I),y/=2;y>=1;y/=2){const k=m[m.length-1];I=new cn(y);for(let F=0;F<y*y;F++){A(F%y,Math.floor(F/y),2,!0,L);const G=k.getElevation(L[0],L[1]),X=k.getElevation(L[2],L[1]),se=k.getElevation(L[2],L[3]),pe=k.getElevation(L[0],L[3]),re=k.isLeaf(L[0],L[1]),fe=k.isLeaf(L[2],L[1]),xe=k.isLeaf(L[2],L[3]),ye=k.isLeaf(L[0],L[3]),We=Math.min(G.min,X.min,se.min,pe.min),Ge=Math.max(G.max,X.max,se.max,pe.max),nt=re&&fe&&xe&&ye;I.maximums.push(Ge),I.minimums.push(We),I.leaves.push(Ge-We<=5&&nt?1:0)}m.push(I)}return m}(this.dem),r=i.length-1,a=i[r];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,a,u,d,m=1){return gn([e,i,-100],[r,a,this.maximums[0]*m],u,d)}raycast(e,i,r,a,u,d,m=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,i,r,a,u,d,m);if(y==null)return null;const v=[],A=[],I=[],L=[],k=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;k.length>0;){const{idx:F,t:G,nodex:X,nodey:se,depth:pe}=k.pop();if(this.leaves[F]){Ds(X,se,pe,e,i,r,a,I,L);const fe=1<<pe,xe=(X+0)/fe,ye=(X+1)/fe,We=(se+0)/fe,Ge=(se+1)/fe,nt=Yo(xe,We,this.dem)*m,vt=Yo(ye,We,this.dem)*m,Xe=Yo(ye,Ge,this.dem)*m,at=Yo(xe,Ge,this.dem)*m,ct=Ms(I[0],I[1],nt,L[0],I[1],vt,L[0],L[1],Xe,u,d),gt=Ms(L[0],L[1],Xe,I[0],L[1],at,I[0],I[1],nt,u,d),bt=Math.min(ct!==null?ct:Number.MAX_VALUE,gt!==null?gt:Number.MAX_VALUE);if(bt!==Number.MAX_VALUE)return bt;{const Ke=vu([],u,d,G);if(Ma(nt,vt,at,Xe,Ko(Ke[0],I[0],L[0]),Ko(Ke[1],I[1],L[1]))>=Ke[2])return G}continue}let re=0;for(let fe=0;fe<this._siblingOffset.length;fe++){Ds((X<<1)+this._siblingOffset[fe][0],(se<<1)+this._siblingOffset[fe][1],pe+1,e,i,r,a,I,L),I[2]=-100,L[2]=this.maximums[this.childOffsets[F]+fe]*m;const xe=gn(I,L,u,d);if(xe!=null){const ye=xe;v[fe]=ye;let We=!1;for(let Ge=0;Ge<re&&!We;Ge++)ye>=v[A[Ge]]&&(A.splice(Ge,0,fe),We=!0);We||(A[re]=fe),re++}}for(let fe=0;fe<re;fe++){const xe=A[fe];k.push({idx:this.childOffsets[F]+xe,t:v[xe],nodex:(X<<1)+this._siblingOffset[xe][0],nodey:(se<<1)+this._siblingOffset[xe][1],depth:pe+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,a,u){if(e[a].isLeaf(i,r)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const d=a-1,m=e[d];let y=0,v=0;for(let A=0;A<this._siblingOffset.length;A++){const I=2*i+this._siblingOffset[A][0],L=2*r+this._siblingOffset[A][1],k=m.getElevation(I,L),F=m.isLeaf(I,L),G=this._addNode(k.min,k.max,F);F&&(y|=1<<A),v||(v=G)}for(let A=0;A<this._siblingOffset.length;A++)y&1<<A||this._construct(e,2*i+this._siblingOffset[A][0],2*r+this._siblingOffset[A][1],d,v+A)}}function Ma(t,e,i,r,a,u){return Ei(Ei(t,i,u),Ei(e,r,u),a)}function Yo(t,e,i){const r=i.dim,a=ii(t*r-.5,0,r-1),u=ii(e*r-.5,0,r-1),d=Math.floor(a),m=Math.floor(u),y=Math.min(d+1,r-1),v=Math.min(m+1,r-1);return Ma(i.get(d,m),i.get(y,m),i.get(d,v),i.get(y,v),a-d,u-m)}const wp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class f_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,a=!1,u=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Oi(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2,m=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=r||"mapbox",this.borderReady=a,!a){for(let y=0;y<d;y++)m[this._idx(-1,y)]=m[this._idx(0,y)],m[this._idx(d,y)]=m[this._idx(d-1,y)],m[this._idx(y,-1)]=m[this._idx(y,0)],m[this._idx(y,d)]=m[this._idx(y,d-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(d,-1)]=m[this._idx(d-1,0)],m[this._idx(-1,d)]=m[this._idx(0,d-1)],m[this._idx(d,d)]=m[this._idx(d-1,d-1)],u&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Gr(this)}get(e,i,r=!1){r&&(e=ii(e,-1,this.dim),i=ii(i,-1,this.dim));const a=4*this._idx(e,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[a],this.pixels[a+1],this.pixels[a+2])}static getUnpackVector(e){return wp[e]}get unpackVector(){return wp[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,r){return(256*e*256+256*i+r)/10-1e4}_unpackTerrarium(e,i,r){return 256*e+i+r/256-32768}static pack(e,i){const r=[0,0,0,0],a=f_.getUnpackVector(i);let u=Math.floor((e+a[3])/a[2]);return r[2]=u%256,u=Math.floor(u/256),r[1]=u%256,u=Math.floor(u/256),r[0]=u,r}getPixels(){return new Ss({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,u=i*this.dim+this.dim,d=r*this.dim,m=r*this.dim+this.dim;switch(i){case-1:a=u-1;break;case 1:u=a+1}switch(r){case-1:d=m-1;break;case 1:m=d+1}const y=-i*this.dim,v=-r*this.dim;for(let A=d;A<m;A++)for(let I=a;I<u;I++){const L=4*this._idx(I,A),k=4*this._idx(I+y,A+v);this.pixels[L+0]=e.pixels[k+0],this.pixels[L+1]=e.pixels[k+1],this.pixels[L+2]=e.pixels[k+2],this.pixels[L+3]=e.pixels[k+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Rt(f_,"DEMData"),Rt(Gr,"DemMinMaxQuadTree",{omit:["dem"]});class A0{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,r){const a=e.wrapped().key;this.data[a]===void 0&&(this.data[a]=[]);const u={value:i,timeout:void 0};if(r!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},r)),this.data[a].push(u),this.order.push(a),this.order.length>this.max){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const r=e.wrapped().key,a=i===void 0?0:this.data[r].indexOf(i),u=this.data[r][a];return this.data[r].splice(a,1),u.timeout&&clearTimeout(u.timeout),this.data[r].length===0&&delete this.data[r],this.onRemove(u.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const r in this.data)for(const a of this.data[r])e(a.value)||i.push(a);for(const r of i)this.remove(r.value.tileID,r)}}class mf{constructor(e,i,r){this.func=e,this.mask=i,this.range=r}}mf.ReadOnly=!1,mf.ReadWrite=!0,mf.disabled=new mf(519,mf.ReadOnly,[0,1]);const cy=7680;class uy{constructor(e,i,r,a,u,d){this.test=e,this.ref=i,this.mask=r,this.fail=a,this.depthFail=u,this.pass=d}}uy.disabled=new uy({func:519,mask:0},0,0,cy,cy,cy);class qc{constructor(e,i,r){this.blendFunction=e,this.blendColor=i,this.mask=r}}qc.Replace=[1,0],qc.disabled=new qc(qc.Replace,bi.transparent,[!1,!1,!1,!1]),qc.unblended=new qc(qc.Replace,bi.transparent,[!0,!0,!0,!0]),qc.alphaBlended=new qc([1,771],bi.transparent,[!0,!0,!0,!0]);const hy=1029,dy=2305;class lc{constructor(e,i,r){this.enable=e,this.mode=i,this.frontFace=r}}lc.disabled=new lc(!1,hy,dy),lc.backCCW=new lc(!0,hy,dy),lc.backCW=new lc(!0,hy,2304),lc.frontCW=new lc(!0,1028,2304),lc.frontCCW=new lc(!0,1028,dy);class Jh extends co{constructor(e,i,r){super(),this.id=e,this._onlySymbols=r,i.on("data",a=>{a.dataType==="source"&&a.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&a.dataType==="source"&&a.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new A0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Li,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const r=this._tiles[i];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return Kt(this._tiles).map(e=>e.tileID).sort(zy).map(e=>e.key)}getRenderableIds(e){const i=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&i.push(this._tiles[r]);return e?i.sort((r,a)=>{const u=r.tileID,d=a.tileID,m=new $e(u.canonical.x,u.canonical.y)._rotate(this.transform.angle),y=new $e(d.canonical.x,d.canonical.y)._rotate(this.transform.angle);return u.overscaledZ-d.overscaledZ||y.y-m.y||y.x-m.x}).map(r=>r.tileID.key):i.map(r=>r.tileID).sort(zy).map(r=>r.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const r=this._tiles[e];r&&(r.state!=="loading"&&(r.state=i),this._loadTile(r,this._tileLoaded.bind(this,r,e,i)))}_tileLoaded(e,i,r,a){if(a)if(e.state="errored",a.status!==404)this._source.fire(new rs(a,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Hi.now(),r==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Wi("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let a=0;a<i.length;a++){const u=i[a];if(e.neighboringTiles&&e.neighboringTiles[u]){const d=this.getTileByID(u);r(e,d),r(d,e)}}function r(a,u){if(!a.dem||a.dem.borderReady)return;a.needsHillshadePrepare=!0,a.needsDEMTextureUpload=!0;let d=u.tileID.canonical.x-a.tileID.canonical.x;const m=u.tileID.canonical.y-a.tileID.canonical.y,y=Math.pow(2,a.tileID.canonical.z),v=u.tileID.key;d===0&&m===0||Math.abs(m)>1||(Math.abs(d)>1&&(Math.abs(d+y)===1?d+=y:Math.abs(d-y)===1&&(d-=y)),u.dem&&a.dem&&(a.dem.backfillBorder(u.dem,d,m),a.neighboringTiles&&a.neighboringTiles[v]&&(a.neighboringTiles[v].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,r,a){for(const u in this._tiles){let d=this._tiles[u];if(a[u]||!d.hasData()||d.tileID.overscaledZ<=i||d.tileID.overscaledZ>r)continue;let m=d.tileID;for(;d&&d.tileID.overscaledZ>i+1;){const v=d.tileID.scaledTo(d.tileID.overscaledZ-1);d=this._tiles[v.key],d&&d.hasData()&&(m=v)}let y=m;for(;y.overscaledZ>i;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){a[m.key]=m;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=i?r:null}for(let r=e.overscaledZ-1;r>=i;r--){const a=e.scaledTo(r),u=this._getLoadedTile(a);if(u)return u}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const r=Math.ceil(e.width/i)+1,a=Math.ceil(e.height/i)+1,u=Math.floor(r*a*5),d=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(m)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const r={};for(const a in this._tiles){const u=this._tiles[a];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+i),r[u.tileID.key]=u}this._tiles=r;for(const a in this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(const a in this._tiles)this._setTileReloadTimer(+a,this._tiles[a])}}update(e,i,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let a;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(m=>new Bo(m.canonical.z,m.wrap,m.canonical.z,m.canonical.x,m.canonical.y)):(a=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter(m=>this._source.hasTile(m)))):a=[];const u=this._updateRetainedTiles(a);if(ky(this._source.type)&&a.length!==0){const m={},y={},v=Object.keys(u);for(const I of v){const L=u[I],k=this._tiles[I];if(!k||k.fadeEndTime&&k.fadeEndTime<=Hi.now())continue;const F=this.findLoadedParent(L,Math.max(L.overscaledZ-Jh.maxOverzooming,this._source.minzoom));F&&(this._addTile(F.tileID),m[F.tileID.key]=F.tileID),y[I]=L}const A=a[a.length-1].overscaledZ;for(const I in this._tiles){const L=this._tiles[I];if(u[I]||!L.hasData())continue;let k=L.tileID;for(;k.overscaledZ>A;){k=k.scaledTo(k.overscaledZ-1);const F=this._tiles[k.key];if(F&&F.hasData()&&y[k.key]){u[I]=L.tileID;break}}}for(const I in m)u[I]||(this._coveredTiles[I]=!0,u[I]=m[I])}for(const m in u)this._tiles[m].clearFadeHold();const d=function(m,y){const v=[];for(const A in m)A in y||v.push(A);return v}(this._tiles,u);for(const m of d){const y=this._tiles[m];y.hasSymbolBuckets&&!y.holdingForFade()?y.setHoldDuration(this.map._fadeDuration):y.hasSymbolBuckets&&!y.symbolFadeFinished()||this._removeTile(+m)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const r={},a=e.reduce((v,A)=>Math.min(v,A.overscaledZ),1/0),u=e[0].overscaledZ,d=Math.max(u-Jh.maxOverzooming,this._source.minzoom),m=Math.max(u+Jh.maxUnderzooming,this._source.minzoom),y={};for(const v of e){const A=this._addTile(v);i[v.key]=v,A.hasData()||a<this._source.maxzoom&&(y[v.key]=v)}this._retainLoadedChildren(y,a,m,i);for(const v of e){let A=this._tiles[v.key];if(A.hasData())continue;if(v.canonical.z>=this._source.maxzoom){const L=v.children(this._source.maxzoom)[0],k=this.getTile(L);if(k&&k.hasData()){i[L.key]=L;continue}}else{const L=v.children(this._source.maxzoom);if(i[L[0].key]&&i[L[1].key]&&i[L[2].key]&&i[L[3].key])continue}let I=A.wasRequested();for(let L=v.overscaledZ-1;L>=d;--L){const k=v.scaledTo(L);if(r[k.key]||(r[k.key]=!0,A=this.getTile(k),!A&&I&&(A=this._addTile(k)),A&&(i[k.key]=k,I=A.wasRequested(),A.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let r,a=this._tiles[e].tileID;for(;a.overscaledZ>0;){if(a.key in this._loadedParentTiles){r=this._loadedParentTiles[a.key];break}i.push(a.key);const u=a.scaledTo(a.overscaledZ-1);if(r=this._getLoadedTile(u),r)break;a=u}for(const u of i)this._loadedParentTiles[u]=r}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=!!i;if(!r){const a=this.map?this.map.painter:null;i=new Yi(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,a,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,r||this._source.fire(new Wi("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=i.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,r){const a=[],u=this.transform;if(!u)return a;const d=u.projection.name==="globe",m=Rl(u.center.lng);for(const y in this._tiles){const v=this._tiles[y];if(r&&v.clearQueryDebugViz(),v.holdingForFade())continue;let A;if(d){const I=v.tileID.canonical;if(I.z===0){const L=[Math.abs(ii(m,...Tp(I,-1))-m),Math.abs(ii(m,...Tp(I,1))-m)];A=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(ii(m,...Tp(I,-1))-m),Math.abs(ii(m,...Tp(I,0))-m),Math.abs(ii(m,...Tp(I,1))-m)];A=[L.indexOf(Math.min(...L))-1]}}else A=[0];for(const I of A){const L=e.containsTile(v,u,i,I);L&&a.push(L)}}return a}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(r=>this._tiles[r].tileID);for(const r of i)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(ky(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Hi.now())return!0}return!1}setFeatureState(e,i,r){this._state.updateState(e=e||"_geojsonTileLayer",i,r)}removeFeatureState(e,i,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,r)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,r){const a=this._tiles[e];a&&a.setDependencies(i,r)}reloadTilesForDependencies(e,i){for(const r in this._tiles)this._tiles[r].hasDependency(e,i)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,i))}_preloadTiles(e,i){const r=new Map,a=Array.isArray(e)?e:[e],u=this.map.painter.terrain,d=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(const m of a){const y=m.coveringTiles({tileSize:d,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const v of y)r.set(v.key,v);this.usedForTerrain&&m.updateElevation(!1)}nn(Array.from(r.values()),(m,y)=>{const v=new Yi(m,this._source.tileSize*m.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(v,A=>{this._source.type==="raster-dem"&&v.dem&&this._backfillDEM(v),y(A,v)})},i)}}function zy(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function ky(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Tp(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Jh.maxOverzooming=10,Jh.maxUnderzooming=3;class p_{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){const a=r||e.findDEMTileFor(i);if(!a||!a.dem)return;const u=a.dem,d=a.tileID,m=1<<i.canonical.z-d.canonical.z;return new p_(a,a.tileSize/di/m,[(i.canonical.x/m-d.canonical.x)*u.dim,(i.canonical.y/m-d.canonical.y)*u.dim])}tileCoordToPixel(e,i){const r=i*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(r);return new $e(a,u)}getElevationAt(e,i,r,a){const u=e*this._scale+this._offset[0],d=i*this._scale+this._offset[1],m=Math.floor(u),y=Math.floor(d),v=this._dem;return a=!!a,r?Ei(Ei(v.get(m,y,a),v.get(m,y+1,a),d-y),Ei(v.get(m+1,y,a),v.get(m+1,y+1,a),d-y),u-m):v.get(m,y,a)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*sl(1,e)*this._dem.stride}}class By{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Dc(di,16,0),this.featureIndexArray=new Ql,this.promoteId=i}insert(e,i,r,a,u,d=0){const m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,a,u,d);const y=this.grid;for(let v=0;v<i.length;v++){const A=i[v],I=[1/0,1/0,-1/0,-1/0];for(let L=0;L<A.length;L++){const k=A[L];I[0]=Math.min(I[0],k.x),I[1]=Math.min(I[1],k.y),I[2]=Math.max(I[2],k.x),I[3]=Math.max(I[3],k.y)}I[0]<di&&I[1]<di&&I[2]>=0&&I[3]>=0&&y.insert(m,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new tp(new Gc(this.rawTileData)).layers,this.sourceLayerCoder=new z(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,r,a){this.loadVTLayers();const u=e.params||{},d=Ar(u.filter),m=e.tileResult,y=e.transform,v=m.bufferedTilespaceBounds,A=this.grid.query(v.min.x,v.min.y,v.max.x,v.max.y,(F,G,X,se)=>um(m.bufferedTilespaceGeometry,F,G,X,se));A.sort(S0);let I=null;y.elevation&&A.length>0&&(I=p_.create(y.elevation,this.tileID));const L={};let k;for(let F=0;F<A.length;F++){const G=A[F];if(G===k)continue;k=G;const X=this.featureIndexArray.get(G);let se=null;this.loadMatchingFeature(L,X,d,u.layers,u.availableImages,i,r,a,(pe,re,fe,xe=0)=>(se||(se=nc(pe,this.tileID.canonical,e.tileTransform)),re.queryIntersectsFeature(m,pe,fe,se,this.z,e.transform,e.pixelPosMatrix,I,xe)))}return L}loadMatchingFeature(e,i,r,a,u,d,m,y,v){const{featureIndex:A,bucketIndex:I,sourceLayerIndex:L,layoutVertexArrayOffset:k}=i,F=this.bucketLayerIDs[I];if(a&&!function(pe,re){for(let fe=0;fe<pe.length;fe++)if(re.indexOf(pe[fe])>=0)return!0;return!1}(a,F))return;const G=this.sourceLayerCoder.decode(L),X=this.vtLayers[G].feature(A);if(r.needGeometry){const pe=Tu(X,!0);if(!r.filter(new ke(this.tileID.overscaledZ),pe,this.tileID.canonical))return}else if(!r.filter(new ke(this.tileID.overscaledZ),X))return;const se=this.getId(X,G);for(let pe=0;pe<F.length;pe++){const re=F[pe];if(a&&a.indexOf(re)<0)continue;const fe=d[re];if(!fe)continue;let xe={};se!==void 0&&y&&(xe=y.getState(fe.sourceLayer||"_geojsonTileLayer",se));const ye=rn({},m[re]);ye.paint=Fy(ye.paint,fe.paint,X,xe,u),ye.layout=Fy(ye.layout,fe.layout,X,xe,u);const We=!v||v(X,fe,xe,k);if(!We)continue;const Ge=new te(X,this.z,this.x,this.y,se);Ge.layer=ye;let nt=e[re];nt===void 0&&(nt=e[re]=[]),nt.push({featureIndex:A,feature:Ge,intersectionZ:We})}}lookupSymbolFeatures(e,i,r,a,u,d,m,y){const v={};this.loadVTLayers();const A=Ar(u);for(const I of e)this.loadMatchingFeature(v,{bucketIndex:r,sourceLayerIndex:a,featureIndex:I,layoutVertexArrayOffset:0},A,d,m,y,i);return v}loadFeature(e){const{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(r),u=this.vtFeatures[a];if(u[i])return u[i];const d=this.vtLayers[a].feature(i);return u[i]=d,d}hasLayer(e){for(const i of this.bucketLayerIDs)for(const r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){const a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];a!=null&&(r=e.properties[a]),typeof r=="boolean"&&(r=Number(r))}return r}}function Fy(t,e,i,r,a){return fi(t,(u,d)=>{const m=e instanceof Ve?e.get(d):null;return m&&m.evaluate?m.evaluate(i,r,a):m})}function S0(t,e){return e-t}Rt(By,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Ny{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Ca({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const r=this.getKey(e,i);return this.positions[r]}trim(){const e=this.width,i=this.height=Zn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){const a=[];let u=e.length%2==1?-e[e.length-1]*r:0,d=e[0]*r,m=!0;a.push({left:u,right:d,isDash:m,zeroLength:e[0]===0});let y=e[0];for(let v=1;v<e.length;v++){m=!m;const A=e[v];u=y*r,y+=A,d=y*r,a.push({left:u,right:d,isDash:m,zeroLength:A===0})}return a}addRoundDash(e,i,r){const a=i/2;for(let u=-r;u<=r;u++){const d=this.width*(this.nextRow+r+u);let m=0,y=e[m];for(let v=0;v<this.width;v++){v/y.right>1&&(y=e[++m]);const A=Math.abs(v-y.left),I=Math.abs(v-y.right),L=Math.min(A,I);let k;const F=u/r*(a+1);if(y.isDash){const G=a-Math.abs(F);k=Math.sqrt(L*L+G*G)}else k=a-Math.sqrt(L*L+F*F);this.image.data[d+v]=Math.max(0,Math.min(255,k+128))}}}addRegularDash(e,i){for(let y=e.length-1;y>=0;--y){const v=e[y],A=e[y+1];v.zeroLength?e.splice(y,1):A&&A.isDash===v.isDash&&(A.left=v.left,e.splice(y,1))}const r=e[0],a=e[e.length-1];r.isDash===a.isDash&&(r.left=a.left-this.width,a.right=r.right+this.width);const u=this.width*this.nextRow;let d=0,m=e[d];for(let y=0;y<this.width;y++){y/m.right>1&&(m=e[++d]);const v=Math.abs(y-m.left),A=Math.abs(y-m.right),I=Math.min(v,A);this.image.data[u+y]=Math.max(0,Math.min(255,(m.isDash?I:-I)+i+128))}}addDash(e,i){const r=this.getKey(e,i);if(this.positions[r])return this.positions[r];const a=i==="round",u=a?7:0,d=2*u+1;if(this.nextRow+d>this.height)return Oi("LineAtlas out of space"),null;e.length===0&&e.push(1);let m=0;for(let A=0;A<e.length;A++)e[A]<0&&(Oi("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),m+=e[A];if(m!==0){const A=this.width/m,I=this.getDashRanges(e,this.width,A);a?this.addRoundDash(I,A,u):this.addRegularDash(I,i==="square"?.5*A:0)}const y=this.nextRow+u;this.nextRow+=d;const v={tl:[y,u],br:[m,0]};return this.positions[r]=v,v}}Rt(Ny,"LineAtlas");class Uy{constructor(e){const i={},r=[];for(const m in e){const y=e[m],v=i[m]={};for(const A in y.glyphs){const I=y.glyphs[+A];if(!I||I.bitmap.width===0||I.bitmap.height===0)continue;const L=I.metrics.localGlyph?2:1,k={x:0,y:0,w:I.bitmap.width+2*L,h:I.bitmap.height+2*L};r.push(k),v[A]=k}}const{w:a,h:u}=tf(r),d=new Ca({width:a||1,height:u||1});for(const m in e){const y=e[m];for(const v in y.glyphs){const A=y.glyphs[+v];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const I=i[m][v],L=A.metrics.localGlyph?2:1;Ca.copy(A.bitmap,d,{x:0,y:0},{x:I.x+L,y:I.y+L},A.bitmap)}}this.image=d,this.positions=i}}Rt(Uy,"GlyphAtlas");class I0{constructor(e){this.tileID=new Bo(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Iu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,r,a,u){this.status="parsing",this.data=e,this.collisionBoxArray=new Ef;const d=new z(Object.keys(e.layers).sort()),m=new By(this.tileID,this.promoteId);m.bucketLayerIDs=[];const y={},v=new Ny(256,256),A={featureIndex:m,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:v,availableImages:r},I=i.familiesBySource[this.source];for(const xe in I){const ye=e.layers[xe];if(!ye)continue;let We=!1,Ge=!1;for(const Xe of I[xe])Xe[0].type==="symbol"?We=!0:Ge=!0;if(this.isSymbolTile===!0&&!We||this.isSymbolTile===!1&&!Ge)continue;ye.version===1&&Oi(`Vector tile source "${this.source}" layer "${xe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const nt=d.encode(xe),vt=[];for(let Xe=0;Xe<ye.length;Xe++){const at=ye.feature(Xe),ct=m.getId(at,xe);vt.push({feature:at,id:ct,index:Xe,sourceLayerIndex:nt})}for(const Xe of I[xe]){const at=Xe[0];this.isSymbolTile!==void 0&&at.type==="symbol"!==this.isSymbolTile||at.minzoom&&this.zoom<Math.floor(at.minzoom)||at.maxzoom&&this.zoom>=at.maxzoom||at.visibility!=="none"&&(fy(Xe,this.zoom,r),(y[at.id]=at.createBucket({index:m.bucketLayerIDs.length,layers:Xe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:r})).populate(vt,A,this.tileID.canonical,this.tileTransform),m.bucketLayerIDs.push(Xe.map(ct=>ct.id)))}}let L,k,F,G;v.trim();const X={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},se=fi(A.glyphDependencies,xe=>Object.keys(xe).map(Number));Object.keys(se).length?a.send("getGlyphs",{uid:this.uid,stacks:se},(xe,ye)=>{L||(L=xe,k=ye,fe.call(this))},void 0,!1,X):k={};const pe=Object.keys(A.iconDependencies);pe.length?a.send("getImages",{icons:pe,source:this.source,tileID:this.tileID,type:"icons"},(xe,ye)=>{L||(L=xe,F=ye,fe.call(this))},void 0,!1,X):F={};const re=Object.keys(A.patternDependencies);function fe(){if(L)return u(L);if(k&&F&&G){const xe=new Uy(k),ye=new jm(F,G);for(const We in y){const Ge=y[We];Ge instanceof Wc?(fy(Ge.layers,this.zoom,r),Hg(Ge,k,xe.positions,F,ye.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):Ge.hasPattern&&(Ge instanceof Vc||Ge instanceof Vh||Ge instanceof Fi)&&(fy(Ge.layers,this.zoom,r),Ge.addFeatures(A,this.tileID.canonical,ye.patternPositions,r,this.tileTransform))}this.status="done",u(null,{buckets:Kt(y).filter(We=>!We.isEmpty()),featureIndex:m,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xe.image,lineAtlas:v,imageAtlas:ye,glyphMap:this.returnDependencies?k:null,iconMap:this.returnDependencies?F:null,glyphPositions:this.returnDependencies?xe.positions:null})}}re.length?a.send("getImages",{icons:re,source:this.source,tileID:this.tileID,type:"patterns"},(xe,ye)=>{L||(L=xe,G=ye,fe.call(this))},void 0,!1,X):G={},fe.call(this)}}function fy(t,e,i){const r=new ke(e);for(const a of t)a.recalculate(r,i)}class Vy{constructor(e){this.entries={},this.scheduler=e}request(e,i,r,a){const u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){const[d,m]=u.result;return this.scheduler?this.scheduler.add(()=>{a(d,m)},i):a(d,m),()=>{}}return u.callbacks.push(a),u.cancel||(u.cancel=r((d,m)=>{u.result=[d,m];for(const y of u.callbacks)this.scheduler?this.scheduler.add(()=>{y(d,m)},i):y(d,m);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(d=>d!==a),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function Gy(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const u=is(t.request,(d,m,y,v)=>{d?a(d):m&&a(null,{vectorTile:i?void 0:new tp(new Gc(m)),rawData:m,cacheControl:y,expires:v})});return()=>{u.cancel(),a()}},e)}o.ARRAY_TYPE=zo,o.AUTH_ERR_MSG=Fa,o.Aabb=Xo,o.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Rr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Cr()?t:B,this.scheduler=new w}send(t,e,i,r,a=!1,u){const d=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=u,this.callbacks[d]=i);const m=Wo(this.globalScope)?void 0:[];return this.target.postMessage({id:d,type:t,hasCallback:!!i,targetMapId:r,mustQueue:a,sourceMapId:this.mapId,data:pu(e,m)},m),{cancel:()=>{i&&delete this.callbacks[d],this.target.postMessage({id:d,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const r=this.cancelCallbacks[i];delete this.cancelCallbacks[i],r&&r.cancel()}else if(e.mustQueue||Cr()){const r=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),r&&r.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if(e.type==="<response>"){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(mu(e.error)):i(null,mu(e.data)))}else{const i=Wo(this.globalScope)?void 0:[],r=e.hasCallback?(u,d)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:u?pu(u):null,data:pu(d,i)},i)}:u=>{},a=mu(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,a,r);else if(this.parent.getWorkerSource){const u=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,u[0],a.source)[u[1]](a,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},o.CanonicalTileID=Qd,o.Color=bi,o.ColorMode=qc,o.CullFaceMode=lc,o.DEMData=f_,o.DataConstantProperty=Oe,o.DedupedRequest=Vy,o.DepthMode=mf,o.EXTENT=di,o.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,a=Math.floor(t.x),u=Math.floor((t.x-a)*r),d=Math.floor(t.y*r),m=this.findDEMTileFor(new Bo(i,a,i,u,d));return!(!m||!m.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const r=this._source();if(!r||t.y<0||t.y>1)return e;const a=r.getSource().maxzoom,u=1<<a,d=Math.floor(t.x),m=t.x-d,y=new Bo(a,d,a,Math.floor(m*u),Math.floor(t.y*u)),v=this.findDEMTileFor(y);if(!v||!v.dem)return e;const A=v.dem,I=1<<v.tileID.canonical.z,L=(m*I-v.tileID.canonical.x)*A.dim,k=(t.y*I-v.tileID.canonical.y)*A.dim,F=Math.floor(L),G=Math.floor(k);return(i?this.exaggeration():1)*Ei(Ei(A.get(F,G),A.get(F,G+1),k-G),Ei(A.get(F+1,G),A.get(F+1,G+1),k-G),L-F)}getAtTileOffset(t,e,i){const r=1<<t.canonical.z;return this.getAtPointOrZero(new Qu(t.wrap+(t.canonical.x+e/di)/r,(t.canonical.y+i/di)/r))}getAtTileOffsetFunc(t,e,i,r){return a=>{const u=this.getAtTileOffset(t,a.x,a.y),d=r.upVector(t.canonical,a.x,a.y);return Ho(d,d,u*r.upVectorScale(t.canonical,e,i).metersToTile),d}}getForTilePoints(t,e,i,r){if(this.isUsingMockSource())return!1;const a=p_.create(this,t,r);return!!a&&(e.forEach(u=>{u[2]=this.exaggeration()*a.getElevationAt(u[0],u[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,a=1<<t.canonical.z-r.canonical.z;let u=t.canonical.x/a-r.canonical.x,d=t.canonical.y/a-r.canonical.y,m=0;for(let y=0;y<t.canonical.z-r.canonical.z&&!i.leaves[m];y++){u*=2,d*=2;const v=2*Math.floor(d)+Math.floor(u);m=i.childOffsets[m]+v,u%=1,d%=1}return{min:this.exaggeration()*i.minimums[m],max:this.exaggeration()*i.maximums[m]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},o.ErrorEvent=rs,o.EvaluationParameters=ke,o.Event=Wi,o.Evented=co,o.FillExtrusionBucket=Fi,o.Frustum=Of,o.FrustumCorners=Md,o.GLOBE_RADIUS=Pl,o.GLOBE_SCALE_MATCH_LATITUDE=45,o.GLOBE_ZOOM_THRESHOLD_MAX=6,o.GLOBE_ZOOM_THRESHOLD_MIN=5,o.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const i=new si,r=new mo,a=[],u=t+1+2,d=e[0]+1,m=e[0]+1+(1+e.length),y=(v,A,I)=>{let L=v===u-1?v-2:v===0?v:v-1;return L+=I?24575:0,[L,A]};for(let v=0;v<u;++v)i.emplaceBack(...y(v,0,!0));for(let v=0;v<d;++v)for(let A=0;A<u;++A)i.emplaceBack(...y(A,v,(A===0||A===u-1)&&!0));for(let v=0;v<e.length;++v){const A=e[v];for(let I=0;I<u;++I)i.emplaceBack(...y(I,A,!0))}for(let v=0;v<e.length;++v){const A=r.length,I=e[v]+1+2,L=new mo;for(let G=0;G<I-1;G++){const X=G===I-2,se=X?u*(m-e.length+v-G):u;for(let pe=0;pe<u-1;pe++){const re=G*u+pe;G===0||X||pe===0||pe===u-2?(L.emplaceBack(re+1,re,re+se),L.emplaceBack(re+se,re+se+1,re+1)):(r.emplaceBack(re+1,re,re+se),r.emplaceBack(re+se,re+se+1,re+1))}}const k=cr.simpleSegment(0,A,i.length,r.length-A);for(let G=0;G<L.uint16.length;G+=3)r.emplaceBack(L.uint16[G],L.uint16[G+1],L.uint16[G+2]);const F=cr.simpleSegment(0,A,i.length,r.length-A);a.push({withoutSkirts:k,withSkirts:F})}return{vertices:i,indices:r,segments:a}}_createGrid(t){const e=this._fillGridMeshWithLods(bu,$u);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,ic.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new mo;for(let a=0;a<=bu;a++)e.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new Si,r=new Si;this._poleSegments=[];for(let a=0,u=0;a<5;a++){const d=360/(1<<a);i.emplaceBack(0,-Pl,0,.5,0),r.emplaceBack(0,-Pl,0,.5,1);for(let m=0;m<=bu;m++){const y=m/bu,v=Ei(0,d,y),[A,I,L]=Ku(em,tm,v,Pl);i.emplaceBack(A,I,L,y,0),r.emplaceBack(A,I,L,y,1)}this._poleSegments.push(cr.simpleSegment(u,0,66,64)),u+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Xp,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,Xp,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new Ml,r=bu,a=r+1+2,u=1;this._wireframeSegments=[];for(let d=0,m=0;d<$u.length;d++){const y=$u[d];for(let A=u;A<y+u;A++)for(let I=u;I<r+u;I++){const L=A*a+I;i.emplaceBack(L,L+1),i.emplaceBack(L,L+a),i.emplaceBack(L,L+a+1)}const v=y*r*3;this._wireframeSegments.push(cr.simpleSegment(0,m,(y+1)*a,v)),m+=v}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},o.GlyphManager=ah,o.ImagePosition=lp,o.LivePerformanceUtils=ht,o.LngLat=an,o.LngLatBounds=el,o.LocalGlyphMode=fp,o.MAX_MERCATOR_LATITUDE=Xn,o.MercatorCoordinate=Qu,o.ONE_EM=go,o.OverscaledTileID=Bo,o.PerformanceMarkers=Ue,o.Properties=pt,o.RGBAImage=Ss,o.Ray=Cd,o.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Qe,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Io(t))return t;const i=Qr(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Io(t))return t;const i=Qr(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,r){if(!Io(t))return t;const a=Qr(t);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),i&&a.params.push(`language=${i}`),r&&a.params.push(`worldview=${r}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,r){const a=Qr(t);return Io(t)?(a.path=`/styles/v1${a.path}/sprite${e}${i}`,this._makeAPIURL(a,this._customAccessToken||r)):(a.path+=`${e}${i}`,la(a))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Io(t))return t;const r=Qr(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&r.authority!=="raster"&&i===512?"@2x":""}${Re.supported?".webp":"$1"}`),r.authority==="raster"?r.path=`/${de.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${de.TILE_URL_VERSION}${r.path}`);const a=this._customAccessToken||function(u){for(const d of u){const m=d.match(/^access_token=(.*)$/);if(m)return m[1]}return null}(r.params)||de.ACCESS_TOKEN;return de.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,a)}canonicalizeTileURL(t,e){const i=Qr(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${de.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${de.TILE_URL_VERSION}/`,"")}`;let a=i.params;return e&&(a=a.filter(u=>!u.match(/^access_token=/))),a.length&&(r+=`?${a.join("&")}`),r}canonicalizeTileset(t,e){const i=!!e&&Io(e),r=[];for(const a of t.tiles||[])aa(a)?r.push(this.canonicalizeTileURL(a,i)):r.push(a);return r}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=Qr(de.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,t.protocol==="http"){const a=t.params.indexOf("secure");a>=0&&t.params.splice(a,1)}if(r.path!=="/"&&(t.path=`${r.path}${t.path}`),!de.REQUIRE_ACCESS_TOKEN)return la(t);if(e=e||de.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(a=>a.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),la(t)}},o.ResourceType=ts,o.SegmentVector=cr,o.SourceCache=Jh,o.StencilMode=uy,o.StructArrayLayout1ui2=Ts,o.StructArrayLayout2f1f2i16=po,o.StructArrayLayout2i4=si,o.StructArrayLayout2ui4=Ml,o.StructArrayLayout3f12=to,o.StructArrayLayout3ui6=mo,o.StructArrayLayout4i8=xn,o.StructArrayLayout5f20=Si,o.Texture=l,o.Tile=Yi,o.Transitionable=Tt,o.Uniform1f=Ed,o.Uniform1i=class extends Ka{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},o.Uniform2f=class extends Ka{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},o.Uniform3f=class extends Ka{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},o.Uniform4f=Op,o.UniformColor=Rp,o.UniformMatrix2f=class extends Ka{constructor(t){super(t),this.current=P_}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},o.UniformMatrix3f=class extends Ka{constructor(t){super(t),this.current=kp}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.UniformMatrix4f=class extends Ka{constructor(t){super(t),this.current=zp}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let r=1;r<16;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},o.UnwrappedTileID=kl,o.ValidationError=Ot,o.VectorTileFeature=Kd,o.VectorTileWorkerSource=class extends co{constructor(t,e,i,r,a){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=a||Gy,this.loading={},this.loaded={},this.deduped=new Vy(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,r=t&&t.request,a=r&&r.collectResourceTiming,u=this.loading[i]=new I0(t);u.abort=this.loadVectorData(t,(d,m)=>{const y=!this.loading[i];if(delete this.loading[i],y||d||!m)return u.status="done",y||(this.loaded[i]=u),e(d);const v=m.rawData,A={};m.expires&&(A.expires=m.expires),m.cacheControl&&(A.cacheControl=m.cacheControl),u.vectorTile=m.vectorTile||new tp(new Gc(v));const I=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,k)=>{if(L||!k)return e(L);const F={};if(a){const G=ni(r);G.length>0&&(F.resourceTiming=JSON.parse(JSON.stringify(G)))}e(null,rn({rawTileData:v.slice(0)},k,A,F))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[i]=u})}reloadTile(t,e){const i=this.loaded,r=t.uid,a=this;if(i&&i[r]){const u=i[r];u.showCollisionBoxes=t.showCollisionBoxes,u.enableTerrain=!!t.enableTerrain,u.projection=t.projection,u.tileTransform=Iu(t.tileID.canonical,t.projection);const d=(m,y)=>{const v=u.reloadCallback;v&&(delete u.reloadCallback,u.parse(u.vectorTile,a.layerIndex,this.availableImages,a.actor,v)),e(m,y)};u.status==="parsing"?u.reloadCallback=d:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,d):d())}}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}},o.WritingMode=na,o.ZoomDependentExpression=Ys,o.add=il,o.addDynamicAttributes=ff,o.adjoint=function(t,e){var i=e[0],r=e[1],a=e[2],u=e[3],d=e[4],m=e[5],y=e[6],v=e[7],A=e[8];return t[0]=d*A-m*v,t[1]=a*v-r*A,t[2]=r*m-a*d,t[3]=m*y-u*A,t[4]=i*A-a*y,t[5]=a*u-i*m,t[6]=u*v-d*y,t[7]=r*y-i*v,t[8]=i*d-r*u,t},o.asyncAll=nn,o.bezier=ki,o.bindAll=Rr,o.boundsAttributes=ui,o.bufferConvexPolygon=function(t,e){const i=[];for(let r=0;r<t.length;r++){const a=pn(r-1,-1,t.length-1),u=pn(r+1,-1,t.length-1),d=t[r],m=t[u],y=t[a].sub(d).unit(),v=m.sub(d).unit(),A=v.angleWithSep(y.x,y.y),I=y.add(v).unit().mult(-1*e/Math.sin(A/2));i.push(d.add(I))}return i},o.cacheEntryPossiblyAdded=function(t){es++,es>br&&(t.getActor().send("enforceCacheSizeLimit",ri),es=0)},o.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:r}=t.point,a=Jp(i,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return tc(a,a,Bf(rl(e)))},o.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:r,lat:a}=t._center;return Jp(e,i,t.worldSize,r,a)},o.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/sl(1,t.center.lat),r=As(new Float64Array(16));return Sh(r,r,[t.point.x,t.point.y,0]),Bc(r,r,[i,i,e]),Float32Array.from(r)},o.circumferenceAtLatitude=Rd,o.clamp=ii,o.clearTileCache=function(t){if(!zs())return;const e=B.caches.delete(dr);t&&e.catch(t).then(()=>t())},o.clipLine=Qm,o.clone=function(t){var e=new zo(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},o.clone$1=zr,o.collisionCircleLayout=Eg,o.config=de,o.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},o.create=function(){var t=new zo(16);return zo!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},o.create$1=Gp,o.createExpression=qa,o.createLayout=ei,o.createStyleLayer=function(t){return t.type==="custom"?new sy(t):new ly[t.type](t)},o.cross=Dh,o.degToRad=Ht,o.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},o.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},o.dot=Sa,o.earthRadius=zh,o.ease=fn,o.easeCubicInOut=Ti,o.ecefToLatLng=function([t,e,i]){const r=Math.hypot(t,e,i),a=Math.atan2(t,i),u=.5*Math.PI-Math.acos(-e/r);return new an(Ut(a),Ut(u))},o.emitValidationErrors=ld,o.endsWith=hn,o.enforceCacheSizeLimit=function(t){Jr(),Br&&Br.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])})})},o.evaluateSizeForFeature=qh,o.evaluateSizeForZoom=Fo,o.evaluateVariableOffset=r_,o.evented=le,o.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},o.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},o.exported=Hi,o.exported$1=Re,o.extend=rn,o.extend$1=os,o.fillExtrusionHeightLift=Dm,o.filterObject=Yr,o.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},o.fromQuat=function(t,e){var i=e[0],r=e[1],a=e[2],u=e[3],d=i+i,m=r+r,y=a+a,v=i*d,A=r*d,I=r*m,L=a*d,k=a*m,F=a*y,G=u*d,X=u*m,se=u*y;return t[0]=1-I-F,t[1]=A+se,t[2]=L-X,t[3]=0,t[4]=A-se,t[5]=1-v-F,t[6]=k+G,t[7]=0,t[8]=L+X,t[9]=k-G,t[10]=1-v-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},o.fromScaling=Mf,o.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return qt[e]},o.getAABBPointSquareDist=function(t,e,i){let r=0;for(let a=0;a<2;++a){const u=i?i[a]:0;t[a]>u&&(r+=(t[a]-u)*(t[a]-u)),e[a]<u&&(r+=(u-e[a])*(u-e[a]))}return r},o.getAnchorAlignment=jc,o.getAnchorJustification=Hh,o.getBounds=function(t){let e=1/0,i=1/0,r=-1/0,a=-1/0;for(const u of t)e=Math.min(e,u.x),i=Math.min(i,u.y),r=Math.max(r,u.x),a=Math.max(a,u.y);return{min:new $e(e,i),max:new $e(r,a)}},o.getColumn=tn,o.getGridMatrix=function(t,e,i,r){const a=e.getNorth(),u=e.getSouth(),d=e.getWest(),m=e.getEast(),y=1<<t.z,v=m-d,A=a-u,I=v/bu,L=-A/$u[i],k=[0,I,0,L,0,0,a,d,0];if(t.z>0){const F=180/r;Cf(k,k,[F/v+1,0,0,0,F/A+1,0,-.5*F/I,.5*F/L,1])}return k[2]=y,k[5]=t.x,k[8]=t.y,k},o.getImage=Bs,o.getJSON=function(t,e){return ao(rn(t,{type:"json"}),e)},o.getLatitudinalLod=function(t){const e=Xn-5;t=ii(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Ht(t))),3);return Math.round(i*($u.length-1))},o.getMapSessionAPI=Me,o.getPerformanceMeasurement=ni,o.getProjection=h_,o.getRTLTextPluginStatus=ve,o.getReferrer=Ba,o.getTilePoint=function(t,{x:e,y:i},r=0){return new $e(((e-r)*t.scale-t.x)*di,(i*t.scale-t.y)*di)},o.getTileVec3=function(t,e,i=0){return Fc(((e.x-i)*t.scale-t.x)*di,(e.y*t.scale-t.y)*di,nm(e.z,e.y))},o.getVideo=function(t,e){const i=B.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let r=0;r<t.length;r++){const a=B.document.createElement("source");qo(t[r])||(i.crossOrigin="Anonymous"),a.src=t[r],i.appendChild(a)}return{cancel:()=>{}}},o.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=As(new Float64Array(16));return tc(i,t.pixelMatrix,t.globeMatrix),_r(e,e,i),new $e(e[0],e[1])},o.globeDenormalizeECEF=Bf,o.globeECEFOrigin=function(t,e){const i=[0,0,0];return _r(i,i,Rh(rl(e.canonical))),_r(i,i,t),i},o.globeMetersToEcef=Ph,o.globeNormalizeECEF=Rh,o.globePixelsToTileUnits=function(t,e){return di/(512*Math.pow(2,t))*Od(rl(e))},o.globePoleMatrixForTile=function(t,e,i){const r=As(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return Ih(r,i.globeMatrix,a),Float32Array.from(r)},o.globeTileBounds=rl,o.globeTiltAtLngLat=Qp,o.globeToMercatorTransition=Ju,o.globeUseCustomAntiAliasing=function(t,e,i){const r=Ju(i.zoom),a=t.style.map._antialias,u=!!e.extStandardDerivatives,d=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return r===0&&!a&&!d&&u},o.identity=As,o.identity$1=Ll,o.invert=Sd,o.isFullscreen=function(){return!!B.document.fullscreenElement||!!B.document.webkitFullscreenElement},o.isLngLatBehindGlobe=Ff,o.isMapAuthenticated=function(t){return Ae.has(t)},o.isMapboxURL=Io,o.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Wo(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.latFromMercatorY=Ao,o.latLngToECEF=Yu,o.len=R_,o.length=Qs,o.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},o.lngFromMercatorX=ta,o.loadVectorTile=Gy,o.makeRequest=ao,o.mapValue=function(t,e,i,r,a){return ii((t-e)/(i-e)*(a-r)+r,r,a)},o.mercatorScale=rm,o.mercatorXfromLng=Rl,o.mercatorYfromLat=zl,o.mercatorZfromAltitude=sl,o.mul=Wp,o.mul$1=Zp,o.multiply=tc,o.multiply$1=Cf,o.multiply$2=Mh,o.nextPowerOfTwo=Zn,o.normalize=Ur,o.normalize$1=z_,o.normalize$2=Hp,o.number=Ei,o.ortho=function(t,e,i,r,a,u,d){var m=1/(e-i),y=1/(r-a),v=1/(u-d);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*v,t[11]=0,t[12]=(e+i)*m,t[13]=(a+r)*y,t[14]=(d+u)*v,t[15]=1,t},o.pbf=Gc,o.perspective=function(t,e,i,r,a){var u,d=1/Math.tan(e/2);return t[0]=d/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=(a+r)*(u=1/(r-a)),t[14]=2*a*r*u):(t[10]=-1,t[14]=-2*r),t},o.pick=function(t,e){const i={};for(let r=0;r<e.length;r++){const a=e[r];a in t&&(i[a]=t[a])}return i},o.plugin=we,o.pointGeometry=$e,o.polesInViewport=function(t){const e=As(new Float64Array(16));tc(e,t.pixelMatrix,t.globeMatrix);const i=[0,ea,0],r=[0,Ia,0];return _r(i,i,e),_r(r,r,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Ff(t,new an(t.center.lat,90)),r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!Ff(t,new an(t.center.lat,-90))]},o.polygonContainsPoint=Eu,o.polygonIntersectsBox=um,o.polygonIntersectsPolygon=sm,o.polygonizeBounds=function(t,e,i=0,r=!0){const a=new $e(i,i),u=t.sub(a),d=e.add(a),m=[u,new $e(d.x,u.y),d,new $e(u.x,d.y)];return r&&m.push(u.clone()),m},o.posAttributes=ic,o.postMapLoadEvent=ie,o.postPerformanceEvent=be,o.postTurnstileEvent=V,o.potpack=tf,o.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.radToDeg=Ut,o.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.registerForPluginStateChange=function(t){return t({pluginStatus:ee,pluginURL:W}),le.on("pluginStateChange",t),t},o.removeAuthState=function(t){Ae.delete(t)},o.renderColorRamp=Kf,o.resample=Vf,o.rotateX=tl,o.rotateX$1=$o,o.rotateY=Ih,o.rotateY$1=Id,o.rotateZ=function(t,e,i){var r=Math.sin(i),a=Math.cos(i),u=e[0],d=e[1],m=e[2],y=e[3],v=e[4],A=e[5],I=e[6],L=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*a+v*r,t[1]=d*a+A*r,t[2]=m*a+I*r,t[3]=y*a+L*r,t[4]=v*a-u*r,t[5]=A*a-d*r,t[6]=I*a-m*r,t[7]=L*a-y*r,t},o.rotateZ$1=function(t,e,i){i*=.5;var r=e[0],a=e[1],u=e[2],d=e[3],m=Math.sin(i),y=Math.cos(i);return t[0]=r*y+a*m,t[1]=a*y-r*m,t[2]=u*y+d*m,t[3]=d*y-u*m,t},o.scale=Bc,o.scale$1=Lf,o.scale$2=Ho,o.scaleAndAdd=vu,o.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},o.setCacheLimits=function(t,e){ri=t,br=e},o.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},o.setRTLTextPlugin=function(t,e,i=!1){if(ee===$||ee===J||ee===Y)throw new Error("setRTLTextPlugin cannot be called multiple times.");W=Hi.resolveURL(t),ee=$,Q=e,oe(),i||ge()},o.smoothstep=Mn,o.spec=Ye,o.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},o.storeAuthState=function(t,e){e?Ae.add(t):Ae.delete(t)},o.sub=nl,o.subtract=Ch,o.symbolSize=km,o.tileAABB=function(t,e,i,r,a,u,d,m,y){if(y.name==="globe")return wu(t,e,new Qd(i,r,a));const v=Iu({z:i,x:r,y:a},y);return new Xo([(u+v.x/v.scale)*e,e*(v.y/v.scale),d],[(u+v.x2/v.scale)*e,e*(v.y2/v.scale),m])},o.tileCornersToBounds=Ld,o.tileTransform=Iu,o.transformMat3=function(t,e,i){var r=e[0],a=e[1],u=e[2];return t[0]=r*i[0]+a*i[3]+u*i[6],t[1]=r*i[1]+a*i[4]+u*i[7],t[2]=r*i[2]+a*i[5]+u*i[8],t},o.transformMat4=_r,o.transformMat4$1=xu,o.transformQuat=ko,o.transitionTileAABBinECEF=kf,o.translate=Sh,o.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},o.triggerPluginCompletionEvent=ae,o.uniqueId=Wr,o.updateGlobeVertexNormal=function(t,e,i,r,a){const u=5*e+2;t.float32[u+0]=i,t.float32[u+1]=r,t.float32[u+2]=a},o.validateCustomStyleLayer=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.validateFilter=t=>$a(Cc(t)),o.validateFog=t=>$a(du(t)),o.validateLayer=t=>$a(_h(t)),o.validateLight=t=>$a(K(t)),o.validateSource=t=>$a(Ha(t)),o.validateStyle=ad,o.validateTerrain=t=>$a(Al(t)),o.values=Kt,o.vectorTile=$d,o.version=ce,o.warnOnce=Oi,o.window=B,o.wrap=pn}),N(["./shared"],function(o){function B(ne){if(typeof ne=="number"||typeof ne=="boolean"||typeof ne=="string"||ne==null)return JSON.stringify(ne);if(Array.isArray(ne)){let j="[";for(const ie of ne)j+=`${B(ie)},`;return`${j}]`}let V="{";for(const j of Object.keys(ne).sort())V+=`${j}:${B(ne[j])},`;return`${V}}`}function ce(ne){let V="";for(const j of o.refProperties)V+=`/${B(ne[j])}`;return V}class _e{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,j){for(const ue of V)this._layerConfigs[ue.id]=ue,(this._layers[ue.id]=o.createStyleLayer(ue)).compileFilter(),this.keyCache[ue.id]&&delete this.keyCache[ue.id];for(const ue of j)delete this.keyCache[ue],delete this._layerConfigs[ue],delete this._layers[ue];this.familiesBySource={};const ie=function(ue,be){const ze={};for(let Ae=0;Ae<ue.length;Ae++){const Ue=be&&be[ue[Ae].id]||ce(ue[Ae]);be&&(be[ue[Ae].id]=Ue);let ht=ze[Ue];ht||(ht=ze[Ue]=[]),ht.push(ue[Ae])}const Me=[];for(const Ae in ze)Me.push(ze[Ae]);return Me}(o.values(this._layerConfigs),this.keyCache);for(const ue of ie){const be=ue.map(Dt=>this._layers[Dt.id]),ze=be[0];if(ze.visibility==="none")continue;const Me=ze.source||"";let Ae=this.familiesBySource[Me];Ae||(Ae=this.familiesBySource[Me]={});const Ue=ze.sourceLayer||"_geojsonTileLayer";let ht=Ae[Ue];ht||(ht=Ae[Ue]=[]),ht.push(be)}}}class de{loadTile(V,j){const{uid:ie,encoding:ue,rawImageData:be,padding:ze,buildQuadTree:Me}=V,Ae=o.window.ImageBitmap&&be instanceof o.window.ImageBitmap?this.getImageData(be,ze):be;j(null,new o.DEMData(ie,Ae,ue,ze<1,Me))}getImageData(V,j){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const ie=this.offscreenCanvasContext.getImageData(-j,-j,V.width+2*j,V.height+2*j);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ie}}var Re=function ne(V,j){var ie,ue=V&&V.type;if(ue==="FeatureCollection")for(ie=0;ie<V.features.length;ie++)ne(V.features[ie],j);else if(ue==="GeometryCollection")for(ie=0;ie<V.geometries.length;ie++)ne(V.geometries[ie],j);else if(ue==="Feature")ne(V.geometry,j);else if(ue==="Polygon")tt(V.coordinates,j);else if(ue==="MultiPolygon")for(ie=0;ie<V.coordinates.length;ie++)tt(V.coordinates[ie],j);return V};function tt(ne,V){if(ne.length!==0){Ce(ne[0],V);for(var j=1;j<ne.length;j++)Ce(ne[j],!V)}}function Ce(ne,V){for(var j=0,ie=0,ue=0,be=ne.length,ze=be-1;ue<be;ze=ue++){var Me=(ne[ue][0]-ne[ze][0])*(ne[ze][1]+ne[ue][1]),Ae=j+Me;ie+=Math.abs(j)>=Math.abs(Me)?j-Ae+Me:Me-Ae+j,j=Ae}j+ie>=0!=!!V&&ne.reverse()}const qe=o.VectorTileFeature.prototype.toGeoJSON;class rt{constructor(V){this._feature=V,this.extent=o.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(this._feature.type===1){const V=[];for(const j of this._feature.geometry)V.push([new o.pointGeometry(j[0],j[1])]);return V}{const V=[];for(const j of this._feature.geometry){const ie=[];for(const ue of j)ie.push(new o.pointGeometry(ue[0],ue[1]));V.push(ie)}return V}}toGeoJSON(V,j,ie){return qe.call(this,V,j,ie)}}class Je{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.EXTENT,this.length=V.length,this._features=V}feature(V){return new rt(this._features[V])}}var Qe={},Mt={get exports(){return Qe},set exports(ne){Qe=ne}},lt=o.pointGeometry,$e=o.vectorTile.VectorTileFeature,Wt=ti;function ti(ne,V){this.options=V||{},this.features=ne,this.length=ne.length}function Pi(ne,V){this.id=typeof ne.id=="number"?ne.id:void 0,this.type=ne.type,this.rawGeometry=ne.type===1?[ne.geometry]:ne.geometry,this.properties=ne.tags,this.extent=V||4096}ti.prototype.feature=function(ne){return new Pi(this.features[ne],this.options.extent)},Pi.prototype.loadGeometry=function(){var ne=this.rawGeometry;this.geometry=[];for(var V=0;V<ne.length;V++){for(var j=ne[V],ie=[],ue=0;ue<j.length;ue++)ie.push(new lt(j[ue][0],j[ue][1]));this.geometry.push(ie)}return this.geometry},Pi.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ne=this.geometry,V=1/0,j=-1/0,ie=1/0,ue=-1/0,be=0;be<ne.length;be++)for(var ze=ne[be],Me=0;Me<ze.length;Me++){var Ae=ze[Me];V=Math.min(V,Ae.x),j=Math.max(j,Ae.x),ie=Math.min(ie,Ae.y),ue=Math.max(ue,Ae.y)}return[V,ie,j,ue]},Pi.prototype.toGeoJSON=$e.prototype.toGeoJSON;var Ht=o.pbf,Ut=Wt;function qt(ne){var V=new Ht;return function(j,ie){for(var ue in j.layers)ie.writeMessage(3,Ti,j.layers[ue])}(ne,V),V.finish()}function Ti(ne,V){var j;V.writeVarintField(15,ne.version||1),V.writeStringField(1,ne.name||""),V.writeVarintField(5,ne.extent||4096);var ie={keys:[],values:[],keycache:{},valuecache:{}};for(j=0;j<ne.length;j++)ie.feature=ne.feature(j),V.writeMessage(2,ki,ie);var ue=ie.keys;for(j=0;j<ue.length;j++)V.writeStringField(3,ue[j]);var be=ie.values;for(j=0;j<be.length;j++)V.writeMessage(4,nn,be[j])}function ki(ne,V){var j=ne.feature;j.id!==void 0&&V.writeVarintField(1,j.id),V.writeMessage(2,fn,ne),V.writeVarintField(3,j.type),V.writeMessage(4,pn,j)}function fn(ne,V){var j=ne.feature,ie=ne.keys,ue=ne.values,be=ne.keycache,ze=ne.valuecache;for(var Me in j.properties){var Ae=j.properties[Me],Ue=be[Me];if(Ae!==null){Ue===void 0&&(ie.push(Me),be[Me]=Ue=ie.length-1),V.writeVarint(Ue);var ht=typeof Ae;ht!=="string"&&ht!=="boolean"&&ht!=="number"&&(Ae=JSON.stringify(Ae));var Dt=ht+":"+Ae,yt=ze[Dt];yt===void 0&&(ue.push(Ae),ze[Dt]=yt=ue.length-1),V.writeVarint(yt)}}}function ii(ne,V){return(V<<3)+(7&ne)}function Mn(ne){return ne<<1^ne>>31}function pn(ne,V){for(var j=ne.loadGeometry(),ie=ne.type,ue=0,be=0,ze=j.length,Me=0;Me<ze;Me++){var Ae=j[Me],Ue=1;ie===1&&(Ue=Ae.length),V.writeVarint(ii(1,Ue));for(var ht=ie===3?Ae.length-1:Ae.length,Dt=0;Dt<ht;Dt++){Dt===1&&ie!==1&&V.writeVarint(ii(2,ht-1));var yt=Ae[Dt].x-ue,ni=Ae[Dt].y-be;V.writeVarint(Mn(yt)),V.writeVarint(Mn(ni)),ue+=yt,be+=ni}ie===3&&V.writeVarint(ii(7,1))}}function nn(ne,V){var j=typeof ne;j==="string"?V.writeStringField(1,ne):j==="boolean"?V.writeBooleanField(7,ne):j==="number"&&(ne%1!=0?V.writeDoubleField(3,ne):ne<0?V.writeSVarintField(6,ne):V.writeVarintField(5,ne))}function Kt(ne,V,j,ie,ue,be){if(ue-ie<=j)return;const ze=ie+ue>>1;rn(ne,V,ze,ie,ue,be%2),Kt(ne,V,j,ie,ze-1,be+1),Kt(ne,V,j,ze+1,ue,be+1)}function rn(ne,V,j,ie,ue,be){for(;ue>ie;){if(ue-ie>600){const Ue=ue-ie+1,ht=j-ie+1,Dt=Math.log(Ue),yt=.5*Math.exp(2*Dt/3),ni=.5*Math.sqrt(Dt*yt*(Ue-yt)/Ue)*(ht-Ue/2<0?-1:1);rn(ne,V,j,Math.max(ie,Math.floor(j-ht*yt/Ue+ni)),Math.min(ue,Math.floor(j+(Ue-ht)*yt/Ue+ni)),be)}const ze=V[2*j+be];let Me=ie,Ae=ue;for(en(ne,V,ie,j),V[2*ue+be]>ze&&en(ne,V,ie,ue);Me<Ae;){for(en(ne,V,Me,Ae),Me++,Ae--;V[2*Me+be]<ze;)Me++;for(;V[2*Ae+be]>ze;)Ae--}V[2*ie+be]===ze?en(ne,V,ie,Ae):(Ae++,en(ne,V,Ae,ue)),Ae<=j&&(ie=Ae+1),j<=Ae&&(ue=Ae-1)}}function en(ne,V,j,ie){Wr(ne,j,ie),Wr(V,2*j,2*ie),Wr(V,2*j+1,2*ie+1)}function Wr(ne,V,j){const ie=ne[V];ne[V]=ne[j],ne[j]=ie}function or(ne,V,j,ie){const ue=ne-j,be=V-ie;return ue*ue+be*be}Mt.exports=qt,Qe.fromVectorTileJs=qt,Qe.fromGeojsonVt=function(ne,V){V=V||{};var j={};for(var ie in ne)j[ie]=new Ut(ne[ie].features,V),j[ie].name=ie,j[ie].version=V.version,j[ie].extent=V.extent;return qt({layers:j})},Qe.GeoJSONWrapper=Ut;const Zn=ne=>ne[0],no=ne=>ne[1];class Rr{constructor(V,j=Zn,ie=no,ue=64,be=Float64Array){this.nodeSize=ue,this.points=V;const ze=V.length<65536?Uint16Array:Uint32Array,Me=this.ids=new ze(V.length),Ae=this.coords=new be(2*V.length);for(let Ue=0;Ue<V.length;Ue++)Me[Ue]=Ue,Ae[2*Ue]=j(V[Ue]),Ae[2*Ue+1]=ie(V[Ue]);Kt(Me,Ae,ue,0,Me.length-1,0)}range(V,j,ie,ue){return function(be,ze,Me,Ae,Ue,ht,Dt){const yt=[0,be.length-1,0],ni=[];let Jt,Qt;for(;yt.length;){const ai=yt.pop(),oi=yt.pop(),Hi=yt.pop();if(oi-Hi<=Dt){for(let Wi=Hi;Wi<=oi;Wi++)Jt=ze[2*Wi],Qt=ze[2*Wi+1],Jt>=Me&&Jt<=Ue&&Qt>=Ae&&Qt<=ht&&ni.push(be[Wi]);continue}const li=Math.floor((Hi+oi)/2);Jt=ze[2*li],Qt=ze[2*li+1],Jt>=Me&&Jt<=Ue&&Qt>=Ae&&Qt<=ht&&ni.push(be[li]);const Vi=(ai+1)%2;(ai===0?Me<=Jt:Ae<=Qt)&&(yt.push(Hi),yt.push(li-1),yt.push(Vi)),(ai===0?Ue>=Jt:ht>=Qt)&&(yt.push(li+1),yt.push(oi),yt.push(Vi))}return ni}(this.ids,this.coords,V,j,ie,ue,this.nodeSize)}within(V,j,ie){return function(ue,be,ze,Me,Ae,Ue){const ht=[0,ue.length-1,0],Dt=[],yt=Ae*Ae;for(;ht.length;){const ni=ht.pop(),Jt=ht.pop(),Qt=ht.pop();if(Jt-Qt<=Ue){for(let Vi=Qt;Vi<=Jt;Vi++)or(be[2*Vi],be[2*Vi+1],ze,Me)<=yt&&Dt.push(ue[Vi]);continue}const ai=Math.floor((Qt+Jt)/2),oi=be[2*ai],Hi=be[2*ai+1];or(oi,Hi,ze,Me)<=yt&&Dt.push(ue[ai]);const li=(ni+1)%2;(ni===0?ze-Ae<=oi:Me-Ae<=Hi)&&(ht.push(Qt),ht.push(ai-1),ht.push(li)),(ni===0?ze+Ae>=oi:Me+Ae>=Hi)&&(ht.push(ai+1),ht.push(Jt),ht.push(li))}return Dt}(this.ids,this.coords,V,j,ie,this.nodeSize)}}const hn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ne=>ne},fi=Math.fround||(Yr=new Float32Array(1),ne=>(Yr[0]=+ne,Yr[0]));var Yr;class zr{constructor(V){this.options=Wo(Object.create(hn),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:j,minZoom:ie,maxZoom:ue,nodeSize:be}=this.options;j&&console.time("total time");const ze=`prepare ${V.length} points`;j&&console.time(ze),this.points=V;let Me=[];for(let Ae=0;Ae<V.length;Ae++)V[Ae].geometry&&Me.push(Oi(V[Ae],Ae));this.trees[ue+1]=new Rr(Me,ka,tn,be,Float32Array),j&&console.timeEnd(ze);for(let Ae=ue;Ae>=ie;Ae--){const Ue=+Date.now();Me=this._cluster(Me,Ae),this.trees[Ae]=new Rr(Me,ka,tn,be,Float32Array),j&&console.log("z%d: %d clusters in %dms",Ae,Me.length,+Date.now()-Ue)}return j&&console.timeEnd("total time"),this}getClusters(V,j){let ie=((V[0]+180)%360+360)%360-180;const ue=Math.max(-90,Math.min(90,V[1]));let be=V[2]===180?180:((V[2]+180)%360+360)%360-180;const ze=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)ie=-180,be=180;else if(ie>be){const ht=this.getClusters([ie,ue,180,ze],j),Dt=this.getClusters([-180,ue,be,ze],j);return ht.concat(Dt)}const Me=this.trees[this._limitZoom(j)],Ae=Me.range(Cr(ie),kr(ze),Cr(be),kr(ue)),Ue=[];for(const ht of Ae){const Dt=Me.points[ht];Ue.push(Dt.numPoints?ro(Dt):this.points[Dt.index])}return Ue}getChildren(V){const j=this._getOriginId(V),ie=this._getOriginZoom(V),ue="No cluster with the specified id.",be=this.trees[ie];if(!be)throw new Error(ue);const ze=be.points[j];if(!ze)throw new Error(ue);const Me=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),Ae=be.within(ze.x,ze.y,Me),Ue=[];for(const ht of Ae){const Dt=be.points[ht];Dt.parentId===V&&Ue.push(Dt.numPoints?ro(Dt):this.points[Dt.index])}if(Ue.length===0)throw new Error(ue);return Ue}getLeaves(V,j,ie){const ue=[];return this._appendLeaves(ue,V,j=j||10,ie=ie||0,0),ue}getTile(V,j,ie){const ue=this.trees[this._limitZoom(V)],be=Math.pow(2,V),{extent:ze,radius:Me}=this.options,Ae=Me/ze,Ue=(ie-Ae)/be,ht=(ie+1+Ae)/be,Dt={features:[]};return this._addTileFeatures(ue.range((j-Ae)/be,Ue,(j+1+Ae)/be,ht),ue.points,j,ie,be,Dt),j===0&&this._addTileFeatures(ue.range(1-Ae/be,Ue,1,ht),ue.points,be,ie,be,Dt),j===be-1&&this._addTileFeatures(ue.range(0,Ue,Ae/be,ht),ue.points,-1,ie,be,Dt),Dt.features.length?Dt:null}getClusterExpansionZoom(V){let j=this._getOriginZoom(V)-1;for(;j<=this.options.maxZoom;){const ie=this.getChildren(V);if(j++,ie.length!==1)break;V=ie[0].properties.cluster_id}return j}_appendLeaves(V,j,ie,ue,be){const ze=this.getChildren(j);for(const Me of ze){const Ae=Me.properties;if(Ae&&Ae.cluster?be+Ae.point_count<=ue?be+=Ae.point_count:be=this._appendLeaves(V,Ae.cluster_id,ie,ue,be):be<ue?be++:V.push(Me),V.length===ie)break}return be}_addTileFeatures(V,j,ie,ue,be,ze){for(const Me of V){const Ae=j[Me],Ue=Ae.numPoints;let ht,Dt,yt;if(Ue)ht=Gt(Ae),Dt=Ae.x,yt=Ae.y;else{const Qt=this.points[Ae.index];ht=Qt.properties,Dt=Cr(Qt.geometry.coordinates[0]),yt=kr(Qt.geometry.coordinates[1])}const ni={type:1,geometry:[[Math.round(this.options.extent*(Dt*be-ie)),Math.round(this.options.extent*(yt*be-ue))]],tags:ht};let Jt;Ue?Jt=Ae.id:this.options.generateId?Jt=Ae.index:this.points[Ae.index].id&&(Jt=this.points[Ae.index].id),Jt!==void 0&&(ni.id=Jt),ze.features.push(ni)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,j){const ie=[],{radius:ue,extent:be,reduce:ze,minPoints:Me}=this.options,Ae=ue/(be*Math.pow(2,j));for(let Ue=0;Ue<V.length;Ue++){const ht=V[Ue];if(ht.zoom<=j)continue;ht.zoom=j;const Dt=this.trees[j+1],yt=Dt.within(ht.x,ht.y,Ae),ni=ht.numPoints||1;let Jt=ni;for(const Qt of yt){const ai=Dt.points[Qt];ai.zoom>j&&(Jt+=ai.numPoints||1)}if(Jt>ni&&Jt>=Me){let Qt=ht.x*ni,ai=ht.y*ni,oi=ze&&ni>1?this._map(ht,!0):null;const Hi=(Ue<<5)+(j+1)+this.points.length;for(const li of yt){const Vi=Dt.points[li];if(Vi.zoom<=j)continue;Vi.zoom=j;const Wi=Vi.numPoints||1;Qt+=Vi.x*Wi,ai+=Vi.y*Wi,Vi.parentId=Hi,ze&&(oi||(oi=this._map(ht,!0)),ze(oi,this._map(Vi)))}ht.parentId=Hi,ie.push(Bt(Qt/Jt,ai/Jt,Hi,Jt,oi))}else if(ie.push(ht),Jt>1)for(const Qt of yt){const ai=Dt.points[Qt];ai.zoom<=j||(ai.zoom=j,ie.push(ai))}}return ie}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,j){if(V.numPoints)return j?Wo({},V.properties):V.properties;const ie=this.points[V.index].properties,ue=this.options.map(ie);return j&&ue===ie?Wo({},ue):ue}}function Bt(ne,V,j,ie,ue){return{x:fi(ne),y:fi(V),zoom:1/0,id:j,parentId:-1,numPoints:ie,properties:ue}}function Oi(ne,V){const[j,ie]=ne.geometry.coordinates;return{x:fi(Cr(j)),y:fi(kr(ie)),zoom:1/0,index:V,parentId:-1}}function ro(ne){return{type:"Feature",id:ne.id,properties:Gt(ne),geometry:{type:"Point",coordinates:[(V=ne.x,360*(V-.5)),oo(ne.y)]}};var V}function Gt(ne){const V=ne.numPoints,j=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return Wo(Wo({},ne.properties),{cluster:!0,cluster_id:ne.id,point_count:V,point_count_abbreviated:j})}function Cr(ne){return ne/360+.5}function kr(ne){const V=Math.sin(ne*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function oo(ne){const V=(180-360*ne)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function Wo(ne,V){for(const j in V)ne[j]=V[j];return ne}function ka(ne){return ne.x}function tn(ne){return ne.y}function dr(ne,V,j,ie){for(var ue,be=ie,ze=j-V>>1,Me=j-V,Ae=ne[V],Ue=ne[V+1],ht=ne[j],Dt=ne[j+1],yt=V+3;yt<j;yt+=3){var ni=Br(ne[yt],ne[yt+1],Ae,Ue,ht,Dt);if(ni>be)ue=yt,be=ni;else if(ni===be){var Jt=Math.abs(yt-ze);Jt<Me&&(ue=yt,Me=Jt)}}be>ie&&(ue-V>3&&dr(ne,V,ue,ie),ne[ue+2]=be,j-ue>3&&dr(ne,ue,j,ie))}function Br(ne,V,j,ie,ue,be){var ze=ue-j,Me=be-ie;if(ze!==0||Me!==0){var Ae=((ne-j)*ze+(V-ie)*Me)/(ze*ze+Me*Me);Ae>1?(j=ue,ie=be):Ae>0&&(j+=ze*Ae,ie+=Me*Ae)}return(ze=ne-j)*ze+(Me=V-ie)*Me}function Le(ne,V,j,ie){var ue={id:ne===void 0?null:ne,type:V,geometry:j,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(be){var ze=be.geometry,Me=be.type;if(Me==="Point"||Me==="MultiPoint"||Me==="LineString")ri(be,ze);else if(Me==="Polygon"||Me==="MultiLineString")for(var Ae=0;Ae<ze.length;Ae++)ri(be,ze[Ae]);else if(Me==="MultiPolygon")for(Ae=0;Ae<ze.length;Ae++)for(var Ue=0;Ue<ze[Ae].length;Ue++)ri(be,ze[Ae][Ue])}(ue),ue}function ri(ne,V){for(var j=0;j<V.length;j+=3)ne.minX=Math.min(ne.minX,V[j]),ne.minY=Math.min(ne.minY,V[j+1]),ne.maxX=Math.max(ne.maxX,V[j]),ne.maxY=Math.max(ne.maxY,V[j+1])}function br(ne,V,j,ie){if(V.geometry){var ue=V.geometry.coordinates,be=V.geometry.type,ze=Math.pow(j.tolerance/((1<<j.maxZoom)*j.extent),2),Me=[],Ae=V.id;if(j.promoteId?Ae=V.properties[j.promoteId]:j.generateId&&(Ae=ie||0),be==="Point")zs(ue,Me);else if(be==="MultiPoint")for(var Ue=0;Ue<ue.length;Ue++)zs(ue[Ue],Me);else if(be==="LineString")Jr(ue,Me,ze,!1);else if(be==="MultiLineString"){if(j.lineMetrics){for(Ue=0;Ue<ue.length;Ue++)Jr(ue[Ue],Me=[],ze,!1),ne.push(Le(Ae,"LineString",Me,V.properties));return}vo(ue,Me,ze,!1)}else if(be==="Polygon")vo(ue,Me,ze,!0);else{if(be!=="MultiPolygon"){if(be==="GeometryCollection"){for(Ue=0;Ue<V.geometry.geometries.length;Ue++)br(ne,{id:Ae,geometry:V.geometry.geometries[Ue],properties:V.properties},j,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ue=0;Ue<ue.length;Ue++){var ht=[];vo(ue[Ue],ht,ze,!0),Me.push(ht)}}ne.push(Le(Ae,be,Me,V.properties))}}function zs(ne,V){V.push(es(ne[0])),V.push(ts(ne[1])),V.push(0)}function Jr(ne,V,j,ie){for(var ue,be,ze=0,Me=0;Me<ne.length;Me++){var Ae=es(ne[Me][0]),Ue=ts(ne[Me][1]);V.push(Ae),V.push(Ue),V.push(0),Me>0&&(ze+=ie?(ue*Ue-Ae*be)/2:Math.sqrt(Math.pow(Ae-ue,2)+Math.pow(Ue-be,2))),ue=Ae,be=Ue}var ht=V.length-3;V[2]=1,dr(V,0,ht,j),V[ht+2]=1,V.size=Math.abs(ze),V.start=0,V.end=V.size}function vo(ne,V,j,ie){for(var ue=0;ue<ne.length;ue++){var be=[];Jr(ne[ue],be,j,ie),V.push(be)}}function es(ne){return ne/360+.5}function ts(ne){var V=Math.sin(ne*Math.PI/180),j=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return j<0?0:j>1?1:j}function so(ne,V,j,ie,ue,be,ze,Me){if(ie/=V,be>=(j/=V)&&ze<ie)return ne;if(ze<j||be>=ie)return null;for(var Ae=[],Ue=0;Ue<ne.length;Ue++){var ht=ne[Ue],Dt=ht.geometry,yt=ht.type,ni=ue===0?ht.minX:ht.minY,Jt=ue===0?ht.maxX:ht.maxY;if(ni>=j&&Jt<ie)Ae.push(ht);else if(!(Jt<j||ni>=ie)){var Qt=[];if(yt==="Point"||yt==="MultiPoint")Ba(Dt,Qt,j,ie,ue);else if(yt==="LineString")ao(Dt,Qt,j,ie,ue,!1,Me.lineMetrics);else if(yt==="MultiLineString")qo(Dt,Qt,j,ie,ue,!1);else if(yt==="Polygon")qo(Dt,Qt,j,ie,ue,!0);else if(yt==="MultiPolygon")for(var ai=0;ai<Dt.length;ai++){var oi=[];qo(Dt[ai],oi,j,ie,ue,!0),oi.length&&Qt.push(oi)}if(Qt.length){if(Me.lineMetrics&&yt==="LineString"){for(ai=0;ai<Qt.length;ai++)Ae.push(Le(ht.id,yt,Qt[ai],ht.tags));continue}yt!=="LineString"&&yt!=="MultiLineString"||(Qt.length===1?(yt="LineString",Qt=Qt[0]):yt="MultiLineString"),yt!=="Point"&&yt!=="MultiPoint"||(yt=Qt.length===3?"Point":"MultiPoint"),Ae.push(Le(ht.id,yt,Qt,ht.tags))}}}return Ae.length?Ae:null}function Ba(ne,V,j,ie,ue){for(var be=0;be<ne.length;be+=3){var ze=ne[be+ue];ze>=j&&ze<=ie&&(V.push(ne[be]),V.push(ne[be+1]),V.push(ne[be+2]))}}function ao(ne,V,j,ie,ue,be,ze){for(var Me,Ae,Ue=is(ne),ht=ue===0?ns:qr,Dt=ne.start,yt=0;yt<ne.length-3;yt+=3){var ni=ne[yt],Jt=ne[yt+1],Qt=ne[yt+2],ai=ne[yt+3],oi=ne[yt+4],Hi=ue===0?ni:Jt,li=ue===0?ai:oi,Vi=!1;ze&&(Me=Math.sqrt(Math.pow(ni-ai,2)+Math.pow(Jt-oi,2))),Hi<j?li>j&&(Ae=ht(Ue,ni,Jt,ai,oi,j),ze&&(Ue.start=Dt+Me*Ae)):Hi>ie?li<ie&&(Ae=ht(Ue,ni,Jt,ai,oi,ie),ze&&(Ue.start=Dt+Me*Ae)):ks(Ue,ni,Jt,Qt),li<j&&Hi>=j&&(Ae=ht(Ue,ni,Jt,ai,oi,j),Vi=!0),li>ie&&Hi<=ie&&(Ae=ht(Ue,ni,Jt,ai,oi,ie),Vi=!0),!be&&Vi&&(ze&&(Ue.end=Dt+Me*Ae),V.push(Ue),Ue=is(ne)),ze&&(Dt+=Me)}var Wi=ne.length-3;ni=ne[Wi],Jt=ne[Wi+1],Qt=ne[Wi+2],(Hi=ue===0?ni:Jt)>=j&&Hi<=ie&&ks(Ue,ni,Jt,Qt),Wi=Ue.length-3,be&&Wi>=3&&(Ue[Wi]!==Ue[0]||Ue[Wi+1]!==Ue[1])&&ks(Ue,Ue[0],Ue[1],Ue[2]),Ue.length&&V.push(Ue)}function is(ne){var V=[];return V.size=ne.size,V.start=ne.start,V.end=ne.end,V}function qo(ne,V,j,ie,ue,be){for(var ze=0;ze<ne.length;ze++)ao(ne[ze],V,j,ie,ue,be,!1)}function ks(ne,V,j,ie){ne.push(V),ne.push(j),ne.push(ie)}function ns(ne,V,j,ie,ue,be){var ze=(be-V)/(ie-V);return ne.push(be),ne.push(j+(ue-j)*ze),ne.push(1),ze}function qr(ne,V,j,ie,ue,be){var ze=(be-j)/(ue-j);return ne.push(V+(ie-V)*ze),ne.push(be),ne.push(1),ze}function Bs(ne,V){for(var j=[],ie=0;ie<ne.length;ie++){var ue,be=ne[ie],ze=be.type;if(ze==="Point"||ze==="MultiPoint"||ze==="LineString")ue=Fa(be.geometry,V);else if(ze==="MultiLineString"||ze==="Polygon"){ue=[];for(var Me=0;Me<be.geometry.length;Me++)ue.push(Fa(be.geometry[Me],V))}else if(ze==="MultiPolygon")for(ue=[],Me=0;Me<be.geometry.length;Me++){for(var Ae=[],Ue=0;Ue<be.geometry[Me].length;Ue++)Ae.push(Fa(be.geometry[Me][Ue],V));ue.push(Ae)}j.push(Le(be.id,ze,ue,be.tags))}return j}function Fa(ne,V){var j=[];j.size=ne.size,ne.start!==void 0&&(j.start=ne.start,j.end=ne.end);for(var ie=0;ie<ne.length;ie+=3)j.push(ne[ie]+V,ne[ie+1],ne[ie+2]);return j}function Io(ne,V){if(ne.transformed)return ne;var j,ie,ue,be=1<<ne.z,ze=ne.x,Me=ne.y;for(j=0;j<ne.features.length;j++){var Ae=ne.features[j],Ue=Ae.geometry,ht=Ae.type;if(Ae.geometry=[],ht===1)for(ie=0;ie<Ue.length;ie+=2)Ae.geometry.push(aa(Ue[ie],Ue[ie+1],V,be,ze,Me));else for(ie=0;ie<Ue.length;ie++){var Dt=[];for(ue=0;ue<Ue[ie].length;ue+=2)Dt.push(aa(Ue[ie][ue],Ue[ie][ue+1],V,be,ze,Me));Ae.geometry.push(Dt)}}return ne.transformed=!0,ne}function aa(ne,V,j,ie,ue,be){return[Math.round(j*(ne*ie-ue)),Math.round(j*(V*ie-be))]}function gc(ne,V,j,ie,ue){for(var be=V===ue.maxZoom?0:ue.tolerance/((1<<V)*ue.extent),ze={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:j,y:ie,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Me=0;Me<ne.length;Me++){ze.numFeatures++,yc(ze,ne[Me],be,ue);var Ae=ne[Me].minX,Ue=ne[Me].minY,ht=ne[Me].maxX,Dt=ne[Me].maxY;Ae<ze.minX&&(ze.minX=Ae),Ue<ze.minY&&(ze.minY=Ue),ht>ze.maxX&&(ze.maxX=ht),Dt>ze.maxY&&(ze.maxY=Dt)}return ze}function yc(ne,V,j,ie){var ue=V.geometry,be=V.type,ze=[];if(be==="Point"||be==="MultiPoint")for(var Me=0;Me<ue.length;Me+=3)ze.push(ue[Me]),ze.push(ue[Me+1]),ne.numPoints++,ne.numSimplified++;else if(be==="LineString")Fs(ze,ue,ne,j,!1,!1);else if(be==="MultiLineString"||be==="Polygon")for(Me=0;Me<ue.length;Me++)Fs(ze,ue[Me],ne,j,be==="Polygon",Me===0);else if(be==="MultiPolygon")for(var Ae=0;Ae<ue.length;Ae++){var Ue=ue[Ae];for(Me=0;Me<Ue.length;Me++)Fs(ze,Ue[Me],ne,j,!0,Me===0)}if(ze.length){var ht=V.tags||null;if(be==="LineString"&&ie.lineMetrics){for(var Dt in ht={},V.tags)ht[Dt]=V.tags[Dt];ht.mapbox_clip_start=ue.start/ue.size,ht.mapbox_clip_end=ue.end/ue.size}var yt={geometry:ze,type:be==="Polygon"||be==="MultiPolygon"?3:be==="LineString"||be==="MultiLineString"?2:1,tags:ht};V.id!==null&&(yt.id=V.id),ne.features.push(yt)}}function Fs(ne,V,j,ie,ue,be){var ze=ie*ie;if(ie>0&&V.size<(ue?ze:ie))j.numPoints+=V.length/3;else{for(var Me=[],Ae=0;Ae<V.length;Ae+=3)(ie===0||V[Ae+2]>ze)&&(j.numSimplified++,Me.push(V[Ae]),Me.push(V[Ae+1])),j.numPoints++;ue&&function(Ue,ht){for(var Dt=0,yt=0,ni=Ue.length,Jt=ni-2;yt<ni;Jt=yt,yt+=2)Dt+=(Ue[yt]-Ue[Jt])*(Ue[yt+1]+Ue[Jt+1]);if(Dt>0===ht)for(yt=0,ni=Ue.length;yt<ni/2;yt+=2){var Qt=Ue[yt],ai=Ue[yt+1];Ue[yt]=Ue[ni-2-yt],Ue[yt+1]=Ue[ni-1-yt],Ue[ni-2-yt]=Qt,Ue[ni-1-yt]=ai}}(Me,be),ne.push(Me)}}function Na(ne,V){var j=(V=this.options=function(ue,be){for(var ze in be)ue[ze]=be[ze];return ue}(Object.create(this.options),V)).debug;if(j&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var ie=function(ue,be){var ze=[];if(ue.type==="FeatureCollection")for(var Me=0;Me<ue.features.length;Me++)br(ze,ue.features[Me],be,Me);else br(ze,ue.type==="Feature"?ue:{geometry:ue},be);return ze}(ne,V);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=function(ue,be){var ze=be.buffer/be.extent,Me=ue,Ae=so(ue,1,-1-ze,ze,0,-1,2,be),Ue=so(ue,1,1-ze,2+ze,0,-1,2,be);return(Ae||Ue)&&(Me=so(ue,1,-ze,1+ze,0,-1,2,be)||[],Ae&&(Me=Bs(Ae,1).concat(Me)),Ue&&(Me=Me.concat(Bs(Ue,-1)))),Me}(ie,V),ie.length&&this.splitTile(ie,0,0,0),j&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qr(ne,V,j){return 32*((1<<ne)*j+V)+ne}function la(ne,V){const j=ne.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const ie=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!ie)return V(null,null);const ue=new Je(ie.features);let be=Qe(ue);be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),V(null,{vectorTile:ue,rawData:be.buffer})}Na.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Na.prototype.splitTile=function(ne,V,j,ie,ue,be,ze){for(var Me=[ne,V,j,ie],Ae=this.options,Ue=Ae.debug;Me.length;){ie=Me.pop(),j=Me.pop(),V=Me.pop(),ne=Me.pop();var ht=1<<V,Dt=Qr(V,j,ie),yt=this.tiles[Dt];if(!yt&&(Ue>1&&console.time("creation"),yt=this.tiles[Dt]=gc(ne,V,j,ie,Ae),this.tileCoords.push({z:V,x:j,y:ie}),Ue)){Ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,j,ie,yt.numFeatures,yt.numPoints,yt.numSimplified),console.timeEnd("creation"));var ni="z"+V;this.stats[ni]=(this.stats[ni]||0)+1,this.total++}if(yt.source=ne,ue){if(V===Ae.maxZoom||V===ue)continue;var Jt=1<<ue-V;if(j!==Math.floor(be/Jt)||ie!==Math.floor(ze/Jt))continue}else if(V===Ae.indexMaxZoom||yt.numPoints<=Ae.indexMaxPoints)continue;if(yt.source=null,ne.length!==0){Ue>1&&console.time("clipping");var Qt,ai,oi,Hi,li,Vi,Wi=.5*Ae.buffer/Ae.extent,rs=.5-Wi,co=.5+Wi,Ye=1+Wi;Qt=ai=oi=Hi=null,li=so(ne,ht,j-Wi,j+co,0,yt.minX,yt.maxX,Ae),Vi=so(ne,ht,j+rs,j+Ye,0,yt.minX,yt.maxX,Ae),ne=null,li&&(Qt=so(li,ht,ie-Wi,ie+co,1,yt.minY,yt.maxY,Ae),ai=so(li,ht,ie+rs,ie+Ye,1,yt.minY,yt.maxY,Ae),li=null),Vi&&(oi=so(Vi,ht,ie-Wi,ie+co,1,yt.minY,yt.maxY,Ae),Hi=so(Vi,ht,ie+rs,ie+Ye,1,yt.minY,yt.maxY,Ae),Vi=null),Ue>1&&console.timeEnd("clipping"),Me.push(Qt||[],V+1,2*j,2*ie),Me.push(ai||[],V+1,2*j,2*ie+1),Me.push(oi||[],V+1,2*j+1,2*ie),Me.push(Hi||[],V+1,2*j+1,2*ie+1)}}},Na.prototype.getTile=function(ne,V,j){var ie=this.options,ue=ie.extent,be=ie.debug;if(ne<0||ne>24)return null;var ze=1<<ne,Me=Qr(ne,V=(V%ze+ze)%ze,j);if(this.tiles[Me])return Io(this.tiles[Me],ue);be>1&&console.log("drilling down to z%d-%d-%d",ne,V,j);for(var Ae,Ue=ne,ht=V,Dt=j;!Ae&&Ue>0;)Ue--,ht=Math.floor(ht/2),Dt=Math.floor(Dt/2),Ae=this.tiles[Qr(Ue,ht,Dt)];return Ae&&Ae.source?(be>1&&console.log("found parent tile z%d-%d-%d",Ue,ht,Dt),be>1&&console.time("drilling down"),this.splitTile(Ae.source,Ue,ht,Dt,ne,V,j),be>1&&console.timeEnd("drilling down"),this.tiles[Me]?Io(this.tiles[Me],ue):null):null};class lo extends o.VectorTileWorkerSource{constructor(V,j,ie,ue,be){super(V,j,ie,ue,la),be&&(this.loadGeoJSON=be)}loadData(V,j){const ie=V&&V.request,ue=ie&&ie.collectResourceTiming;this.loadGeoJSON(V,(be,ze)=>{if(be||!ze)return j(be);if(typeof ze!="object")return j(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{Re(ze,!0);try{if(V.filter){const Ae=o.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ae.result==="error")throw new Error(Ae.value.map(ht=>`${ht.key}: ${ht.message}`).join(", "));ze={type:"FeatureCollection",features:ze.features.filter(ht=>Ae.value.evaluate({zoom:0},ht))}}this._geoJSONIndex=V.cluster?new zr(function({superclusterOptions:Ae,clusterProperties:Ue}){if(!Ue||!Ae)return Ae;const ht={},Dt={},yt={accumulated:null,zoom:0},ni={properties:null},Jt=Object.keys(Ue);for(const Qt of Jt){const[ai,oi]=Ue[Qt],Hi=o.createExpression(oi),li=o.createExpression(typeof ai=="string"?[ai,["accumulated"],["get",Qt]]:ai);ht[Qt]=Hi.value,Dt[Qt]=li.value}return Ae.map=Qt=>{ni.properties=Qt;const ai={};for(const oi of Jt)ai[oi]=ht[oi].evaluate(yt,ni);return ai},Ae.reduce=(Qt,ai)=>{ni.properties=ai;for(const oi of Jt)yt.accumulated=Qt[oi],Qt[oi]=Dt[oi].evaluate(yt,ni)},Ae}(V)).load(ze.features):function(Ae,Ue){return new Na(Ae,Ue)}(ze,V.geojsonVtOptions)}catch(Ae){return j(Ae)}this.loaded={};const Me={};if(ue){const Ae=o.getPerformanceMeasurement(ie);Ae&&(Me.resourceTiming={},Me.resourceTiming[V.source]=JSON.parse(JSON.stringify(Ae)))}j(null,Me)}})}reloadTile(V,j){const ie=this.loaded;return ie&&ie[V.uid]?super.reloadTile(V,j):this.loadTile(V,j)}loadGeoJSON(V,j){if(V.request)o.getJSON(V.request,j);else{if(typeof V.data!="string")return j(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return j(null,JSON.parse(V.data))}catch{return j(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,j){try{j(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(ie){j(ie)}}getClusterChildren(V,j){try{j(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(ie){j(ie)}}getClusterLeaves(V,j){try{j(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(ie){j(ie)}}}class ca{constructor(V){this.self=V,this.actor=new o.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.getProjection({name:"mercator"}),this.workerSourceTypes={vector:o.VectorTileWorkerSource,geojson:lo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(j,ie)=>{if(this.workerSourceTypes[j])throw new Error(`Worker source with name "${j}" already registered.`);this.workerSourceTypes[j]=ie},this.self.registerRTLTextPlugin=j=>{if(o.plugin.isParsed())throw new Error("RTL text plugin already registered.");o.plugin.applyArabicShaping=j.applyArabicShaping,o.plugin.processBidirectionalText=j.processBidirectionalText,o.plugin.processStyledBidirectionalText=j.processStyledBidirectionalText}}clearCaches(V,j,ie){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],ie()}checkIfReady(V,j,ie){ie()}setReferrer(V,j){this.referrer=j}spriteLoaded(V,j){this.isSpriteLoaded[V]=j;for(const ie in this.workerSources[V]){const ue=this.workerSources[V][ie];for(const be in ue)ue[be]instanceof o.VectorTileWorkerSource&&(ue[be].isSpriteLoaded=j,ue[be].fire(new o.Event("isSpriteLoaded")))}}setImages(V,j,ie){this.availableImages[V]=j;for(const ue in this.workerSources[V]){const be=this.workerSources[V][ue];for(const ze in be)be[ze].availableImages=j}ie()}enableTerrain(V,j,ie){this.terrain=j,ie()}setProjection(V,j){this.projections[V]=o.getProjection(j)}setLayers(V,j,ie){this.getLayerIndex(V).replace(j),ie()}updateLayers(V,j,ie){this.getLayerIndex(V).update(j.layers,j.removedIds),ie()}loadTile(V,j,ie){const ue=this.enableTerrain?o.extend({enableTerrain:this.terrain},j):j;ue.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,j.type,j.source).loadTile(ue,ie)}loadDEMTile(V,j,ie){const ue=this.enableTerrain?o.extend({buildQuadTree:this.terrain},j):j;this.getDEMWorkerSource(V,j.source).loadTile(ue,ie)}reloadTile(V,j,ie){const ue=this.enableTerrain?o.extend({enableTerrain:this.terrain},j):j;ue.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,j.type,j.source).reloadTile(ue,ie)}abortTile(V,j,ie){this.getWorkerSource(V,j.type,j.source).abortTile(j,ie)}removeTile(V,j,ie){this.getWorkerSource(V,j.type,j.source).removeTile(j,ie)}removeSource(V,j,ie){if(!this.workerSources[V]||!this.workerSources[V][j.type]||!this.workerSources[V][j.type][j.source])return;const ue=this.workerSources[V][j.type][j.source];delete this.workerSources[V][j.type][j.source],ue.removeSource!==void 0?ue.removeSource(j,ie):ie()}loadWorkerSource(V,j,ie){try{this.self.importScripts(j.url),ie()}catch(ue){ie(ue.toString())}}syncRTLPluginState(V,j,ie){try{o.plugin.setState(j);const ue=o.plugin.getPluginURL();if(o.plugin.isLoaded()&&!o.plugin.isParsed()&&ue!=null){this.self.importScripts(ue);const be=o.plugin.isParsed();ie(be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ue}`),be)}}catch(ue){ie(ue.toString())}}getAvailableImages(V){let j=this.availableImages[V];return j||(j=[]),j}getLayerIndex(V){let j=this.layerIndexes[V];return j||(j=this.layerIndexes[V]=new _e),j}getWorkerSource(V,j,ie){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][j]||(this.workerSources[V][j]={}),!this.workerSources[V][j][ie]){const ue={send:(be,ze,Me,Ae,Ue,ht)=>{this.actor.send(be,ze,Me,V,Ue,ht)},scheduler:this.actor.scheduler};this.workerSources[V][j][ie]=new this.workerSourceTypes[j](ue,this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])}return this.workerSources[V][j][ie]}getDEMWorkerSource(V,j){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][j]||(this.demWorkerSources[V][j]=new de),this.demWorkerSources[V][j]}enforceCacheSizeLimit(V,j){o.enforceCacheSizeLimit(j)}getWorkerPerformanceMetrics(V,j,ie){ie(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ca(self)),ca}),N(["./shared"],function(o){function B(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let s=0;s<c.length;s++)if(!B(c[s],n[s]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(const s in c)if(!B(c[s],n[s]))return!1;return!0}return c===n}var ce=_e;function _e(c){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,p,_=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(_);try{p=new Worker(b),h=!0}catch{h=!1}return p&&p.terminate(),URL.revokeObjectURL(b),h}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var h=document.createElement("canvas");h.width=h.height=1;var p=h.getContext("2d");if(!p)return!1;var _=p.getImageData(0,0,1,1);return _&&_.width===h.width}()?(de[s=n&&n.failIfMajorPerformanceCaveat]===void 0&&(de[s]=function(h){var p,_=function(b){var E=document.createElement("canvas"),S=Object.create(_e.webGLContextAttributes);return S.failIfMajorPerformanceCaveat=b,E.getContext("webgl",S)||E.getContext("experimental-webgl",S)}(h);if(!_)return!1;try{p=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!p||_.isContextLost())&&(_.shaderSource(p,"void main() {}"),_.compileShader(p),_.getShaderParameter(p,_.COMPILE_STATUS)===!0)}(s)),de[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(c)}var de={};function Re(c,n,s){const h=o.window.document.createElement(c);return n!==void 0&&(h.className=n),s&&s.appendChild(h),h}function tt(c,n,s){const h=o.window.document.createElementNS("http://www.w3.org/2000/svg",c);for(const p of Object.keys(n))h.setAttributeNS(null,p,n[p]);return s&&s.appendChild(h),h}_e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ce=o.window.document&&o.window.document.documentElement.style,qe=Ce&&Ce.userSelect!==void 0?"userSelect":"WebkitUserSelect";let rt;function Je(){Ce&&qe&&(rt=Ce[qe],Ce[qe]="none")}function Qe(){Ce&&qe&&(Ce[qe]=rt)}function Mt(c){c.preventDefault(),c.stopPropagation(),o.window.removeEventListener("click",Mt,!0)}function lt(){o.window.addEventListener("click",Mt,!0),o.window.setTimeout(()=>{o.window.removeEventListener("click",Mt,!0)},0)}function $e(c,n){const s=c.getBoundingClientRect();return Pi(c,s,n)}function Wt(c,n){const s=c.getBoundingClientRect(),h=[];for(let p=0;p<n.length;p++)h.push(Pi(c,s,n[p]));return h}function ti(c){return o.window.InstallTrigger!==void 0&&c.button===2&&c.ctrlKey&&o.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:c.button}function Pi(c,n,s){const h=c.offsetWidth===n.width?1:c.offsetWidth/n.width;return new o.pointGeometry((s.clientX-n.left)*h,(s.clientY-n.top)*h)}function Ht(c,n){var s=n[0],h=n[1],p=n[2],_=n[3],b=s*_-p*h;return b?(c[0]=_*(b=1/b),c[1]=-h*b,c[2]=-p*b,c[3]=s*b,c):null}function Ut(c){const{userImage:n}=c;return!!(n&&n.render&&n.render())&&(c.data.replace(new Uint8Array(n.data.buffer)),!0)}class qt extends o.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:s,callback:h}of this.requestors)this._notify(s,h);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,s){this._validate(n,s)&&(this.images[n]=s)}_validate(n,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new o.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),h=!1),h}_validateStretch(n,s){if(!n)return!0;let h=0;for(const p of n){if(p[0]<h||p[1]<p[0]||s<p[1])return!1;h=p[1]}return!0}_validateContent(n,s){return!(n&&(n.length!==4||n[0]<0||s.data.width<n[0]||n[1]<0||s.data.height<n[1]||n[2]<0||s.data.width<n[2]||n[3]<0||s.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,s){s.version=this.images[n].version+1,this.images[n]=s,this.updatedImages[n]=!0}removeImage(n){const s=this.images[n];delete this.images[n],delete this.patterns[n],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,s){let h=!0;if(!this.isLoaded())for(const p of n)this.images[p]||(h=!1);this.isLoaded()||h?this._notify(n,s):this.requestors.push({ids:n,callback:s})}_notify(n,s){const h={};for(const p of n){this.images[p]||this.fire(new o.Event("styleimagemissing",{id:p}));const _=this.images[p];_?h[p]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:!!(_.userImage&&_.userImage.render)}:o.warnOnce(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,h)}getPixelSize(){const{width:n,height:s}=this.atlasImage;return{width:n,height:s}}getPattern(n){const s=this.patterns[n],h=this.getImage(n);if(!h)return null;if(s&&s.position.version===h.version)return s.position;if(s)s.position.version=h.version;else{const p={w:h.data.width+2,h:h.data.height+2,x:0,y:0},_=new o.ImagePosition(p,h);this.patterns[n]={bin:p,position:_}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const s=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.Texture(n,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const _ in this.patterns)n.push(this.patterns[_].bin);const{w:s,h}=o.potpack(n),p=this.atlasImage;p.resize({width:s||1,height:h||1});for(const _ in this.patterns){const{bin:b}=this.patterns[_],E=b.x+1,S=b.y+1,O=this.images[_].data,R=O.width,U=O.height;o.RGBAImage.copy(O,p,{x:0,y:0},{x:E,y:S},{width:R,height:U}),o.RGBAImage.copy(O,p,{x:0,y:U-1},{x:E,y:S-1},{width:R,height:1}),o.RGBAImage.copy(O,p,{x:0,y:0},{x:E,y:S+U},{width:R,height:1}),o.RGBAImage.copy(O,p,{x:R-1,y:0},{x:E-1,y:S},{width:1,height:U}),o.RGBAImage.copy(O,p,{x:0,y:0},{x:E+R,y:S},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const s of n){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const h=this.images[s];Ut(h)&&this.updateImage(s,h)}}}const Ti=new o.Properties({anchor:new o.DataConstantProperty(o.spec.light.anchor),position:new class{constructor(){this.specification=o.spec.light.position}possiblyEvaluate(c,n){return function([s,h,p]){const _=o.degToRad(h+90),b=o.degToRad(p);return{x:s*Math.cos(_)*Math.sin(b),y:s*Math.sin(_)*Math.sin(b),z:s*Math.cos(b),azimuthal:h,polar:p}}(c.expression.evaluate(n))}interpolate(c,n,s){return{x:o.number(c.x,n.x,s),y:o.number(c.y,n.y,s),z:o.number(c.z,n.z,s),azimuthal:o.number(c.azimuthal,n.azimuthal,s),polar:o.number(c.polar,n.polar,s)}}},color:new o.DataConstantProperty(o.spec.light.color),intensity:new o.DataConstantProperty(o.spec.light.intensity)}),ki="-transition";class fn extends o.Evented{constructor(n){super(),this._transitionable=new o.Transitionable(Ti),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,s={}){if(!this._validate(o.validateLight,n,s))for(const h in n){const p=n[h];o.endsWith(h,ki)?this._transitionable.setTransition(h.slice(0,-ki.length),p):this._transitionable.setValue(h,p)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}const ii=new o.Properties({source:new o.DataConstantProperty(o.spec.terrain.source),exaggeration:new o.DataConstantProperty(o.spec.terrain.exaggeration)}),Mn="-transition";class pn extends o.Evented{constructor(n,s){super(),this._transitionable=new o.Transitionable(ii),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(n){for(const s in n){const h=n[s];o.endsWith(s,Mn)?this._transitionable.setTransition(s.slice(0,-Mn.length),h):this._transitionable.setValue(s,h)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function nn(c,n,s,h){const p=o.smoothstep(45,65,s),[_,b]=Kt(c,h),E=o.length(n);let S=1-Math.min(1,Math.exp((E-_)/(b-_)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*p*c.alpha}function Kt(c,n){const s=.5/Math.tan(.5*n);return[c.range[0]+s,c.range[1]+s]}const rn=new o.Properties({range:new o.DataConstantProperty(o.spec.fog.range),color:new o.DataConstantProperty(o.spec.fog.color),"high-color":new o.DataConstantProperty(o.spec.fog["high-color"]),"space-color":new o.DataConstantProperty(o.spec.fog["space-color"]),"horizon-blend":new o.DataConstantProperty(o.spec.fog["horizon-blend"]),"star-intensity":new o.DataConstantProperty(o.spec.fog["star-intensity"])}),en="-transition";class Wr extends o.Evented{constructor(n,s){super(),this._transitionable=new o.Transitionable(rn),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=s}get state(){const n=this._transform,s=n.projection.name==="globe",h=o.globeToMercatorTransition(n.zoom),p=this.properties.get("range"),_=[.5,3];return{range:s?[o.number(_[0],p[0],h),o.number(_[1],p[1],h)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,s={}){if(!this._validate(o.validateFog,n,s)){for(const h of Object.keys(o.spec.fog))n&&n[h]===void 0&&(n[h]=o.spec.fog[h].default);for(const h in n){const p=n[h];o.endsWith(h,en)?this._transitionable.setTransition(h.slice(0,-en.length),p):this._transitionable.setValue(h,p)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.smoothstep(45,65,n))*s.a}getOpacityAtLatLng(n,s){return this._transform.projection.supportsFog?function(h,p,_){const b=o.MercatorCoordinate.fromLngLat(p),E=_.elevation?_.elevation.getAtPointOrZero(b):0,S=[b.x,b.y,E];return o.transformMat4(S,S,_.mercatorFogMatrix),nn(h,S,_.pitch,_._fov)}(this.state,n,s):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Kt(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,s,h){return(!h||h.validate!==!1)&&o.emitValidationErrors(this,n.call(o.validateStyle,o.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.spec})))}}class or{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=o.uniqueId();const h=this.workerPool.acquire(this.id);for(let p=0;p<h.length;p++){const _=new or.Actor(h[p],s,this.id);_.name=`Worker ${p}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,s,h){o.asyncAll(this.actors,(p,_)=>{p.send(n,s,_)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Zn(c,n,s){return n*(o.EXTENT/(c.tileSize*Math.pow(2,s-c.tileID.overscaledZ)))}or.Actor=o.Actor;class no{constructor(n,s,h,p){this.screenBounds=n,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(n,s){let h,p;if(n instanceof o.pointGeometry||typeof n[0]=="number"){const _=o.pointGeometry.convert(n);h=[_],p=s.isPointAboveHorizon(_)}else{const _=o.pointGeometry.convert(n[0]),b=o.pointGeometry.convert(n[1]);h=[_,b],p=o.polygonizeBounds(_,b).every(E=>s.isPointAboveHorizon(E))}return new no(h,s.getCameraPoint(),p,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return o.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],p=o.polygonizeBounds(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?p[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(p[3]=this.cameraPoint)),o.bufferConvexPolygon(p,n)}bufferedCameraGeometryGlobe(n){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.pointGeometry(1,1)):this.screenBounds[1],p=o.polygonizeBounds(s,h,n),_=this.cameraPoint.clone();switch(3*((_.y>s.y)+(_.y>h.y))+((_.x>s.x)+(_.x>h.x))){case 0:p[0]=_,p[4]=_.clone();break;case 1:p.splice(1,0,_);break;case 2:p[1]=_;break;case 3:p.splice(4,0,_);break;case 5:p.splice(2,0,_);break;case 6:p[3]=_;break;case 7:p.splice(3,0,_);break;case 8:p[2]=_}return p}containsTile(n,s,h,p=0){const _=n.queryPadding/s._pixelsPerMercatorPixel+1,b=h?this._bufferedCameraMercator(_,s):this._bufferedScreenMercator(_,s);let E=n.tileID.wrap+(b.unwrapped?p:0);const S=b.polygon.map(ee=>o.getTilePoint(n.tileTransform,ee,E));if(!o.polygonIntersectsBox(S,0,0,o.EXTENT,o.EXTENT))return;E=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const O=this.screenGeometryMercator.polygon.map(ee=>o.getTileVec3(n.tileTransform,ee,E)),R=O.map(ee=>new o.pointGeometry(ee[0],ee[1])),U=s.getFreeCameraOptions().position||new o.MercatorCoordinate(0,0,0),$=o.getTileVec3(n.tileTransform,U,E),J=O.map(ee=>{const W=o.sub(ee,ee,$);return o.normalize(W,W),new o.Ray($,W)}),Y=Zn(n,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:J,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(Q=o.getBounds(S),Q.min.x=o.clamp(Q.min.x,0,o.EXTENT),Q.min.y=o.clamp(Q.min.y,0,o.EXTENT),Q.max.x=o.clamp(Q.max.x,0,o.EXTENT),Q.max.y=o.clamp(Q.max.y,0,o.EXTENT),Q),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:Y};var Q}_bufferedScreenMercator(n,s){const h=fi(n);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let p;return p=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),s):{polygon:this.bufferedScreenGeometry(n).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[h]=p,p}}_bufferedCameraMercator(n,s){const h=fi(n);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let p;return p=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),s):{polygon:this.bufferedCameraGeometry(n).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[h]=p,p}}_projectAndResample(n,s){const h=function(_,b){const E=o.multiply([],b.pixelMatrix,b.globeMatrix),S=[0,-o.GLOBE_RADIUS,0,1],O=[0,o.GLOBE_RADIUS,0,1],R=[0,0,0,1];o.transformMat4$1(S,S,E),o.transformMat4$1(O,O,E),o.transformMat4$1(R,R,E);const U=new o.pointGeometry(S[0]/S[3],S[1]/S[3]),$=new o.pointGeometry(O[0]/O[3],O[1]/O[3]),J=o.polygonContainsPoint(_,U)&&S[3]<R[3],Y=o.polygonContainsPoint(_,$)&&O[3]<R[3];if(!J&&!Y)return null;const Q=function(we,ke,Be){for(let je=1;je<we.length;je++){const Tt=hn(ke.pointCoordinate3D(we[je-1]).x),Ne=hn(ke.pointCoordinate3D(we[je]).x);if(Be<0){if(Tt<Ne)return{idx:je,t:-Tt/(Ne-1-Tt)}}else if(Ne<Tt)return{idx:je,t:(1-Tt)/(Ne+1-Tt)}}return null}(_,b,J?-1:1);if(!Q)return null;const{idx:ee,t:W}=Q;let ae=ee>1?Rr(_.slice(0,ee),b):[],oe=ee<_.length?Rr(_.slice(ee),b):[];ae=ae.map(we=>new o.pointGeometry(hn(we.x),we.y)),oe=oe.map(we=>new o.pointGeometry(hn(we.x),we.y));const le=[...ae];le.length===0&&le.push(oe[oe.length-1]);const ve=o.number(le[le.length-1].y,(oe.length===0?ae[0]:oe[0]).y,W);let ge;return ge=J?[new o.pointGeometry(0,ve),new o.pointGeometry(0,0),new o.pointGeometry(1,0),new o.pointGeometry(1,ve)]:[new o.pointGeometry(1,ve),new o.pointGeometry(1,1),new o.pointGeometry(0,1),new o.pointGeometry(0,ve)],le.push(...ge),oe.length===0?le.push(ae[0]):le.push(...oe),{polygon:le.map(we=>new o.MercatorCoordinate(we.x,we.y)),unwrapped:!1}}(n,s);if(h)return h;const p=function(_,b){let E=!1,S=-1/0,O=0;for(let U=0;U<_.length-1;U++)_[U].x>S&&(S=_[U].x,O=U);for(let U=0;U<_.length-1;U++){const $=(O+U)%(_.length-1),J=_[$],Y=_[$+1];Math.abs(J.x-Y.x)>.5&&(J.x<Y.x?(J.x+=1,$===0&&(_[_.length-1].x+=1)):(Y.x+=1,$+1===_.length-1&&(_[0].x+=1)),E=!0)}const R=o.mercatorXfromLng(b.center.lng);return E&&R<Math.abs(R-1)&&_.forEach(U=>{U.x-=1}),{polygon:_,unwrapped:E}}(Rr(n,s).map(_=>new o.pointGeometry(hn(_.x),_.y)),s);return{polygon:p.polygon.map(_=>new o.MercatorCoordinate(_.x,_.y)),unwrapped:p.unwrapped}}}function Rr(c,n){return o.resample(c,s=>{const h=n.pointCoordinate3D(s);s.x=h.x,s.y=h.y},1/256)}function hn(c){return c<0?1+c%1:c%1}function fi(c){return 100*c|0}function Yr(c,n,s,h,p){const _=function(b,E){if(b)return p(b);if(E){c.url&&E.tiles&&c.tiles&&delete c.tiles;const S=o.pick(o.extend(E,c),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(S.vectorLayers=E.vector_layers,S.vectorLayerIds=S.vectorLayers.map(O=>O.id)),S.tiles=n.canonicalizeTileset(S,c.url),p(null,S)}};return c.url?o.getJSON(n.transformRequest(n.normalizeSourceURL(c.url,null,s,h),o.ResourceType.Source),_):o.exported.frame(()=>_(null,c))}class zr{constructor(n,s,h){this.bounds=o.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const s=Math.pow(2,n.z),h=Math.floor(o.mercatorXfromLng(this.bounds.getWest())*s),p=Math.floor(o.mercatorYfromLat(this.bounds.getNorth())*s),_=Math.ceil(o.mercatorXfromLng(this.bounds.getEast())*s),b=Math.ceil(o.mercatorYfromLat(this.bounds.getSouth())*s);return n.x>=h&&n.x<_&&n.y>=p&&n.y<b}}class Bt{constructor(n,s,h){this.context=n;const p=n.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Oi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ro{constructor(n,s,h,p){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=n;const _=n.gl;this.buffer=_.createBuffer(),n.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,s){for(let h=0;h<this.attributes.length;h++){const p=s.attributes[this.attributes[h].name];p!==void 0&&n.enableVertexAttribArray(p)}}setVertexAttribPointers(n,s,h){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],b=s.attributes[_.name];b!==void 0&&n.vertexAttribPointer(b,_.components,n[Oi[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Gt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Cr extends Gt{getDefault(){return o.Color.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class kr extends Gt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class oo extends Gt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Wo extends Gt{getDefault(){return[!0,!0,!0,!0]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ka extends Gt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class tn extends Gt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class dr extends Gt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const s=this.current;(n.func!==s.func||n.ref!==s.ref||n.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Br extends Gt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Le extends Gt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=n,this.dirty=!1}}class ri extends Gt{getDefault(){return[0,1]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class br extends Gt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=n,this.dirty=!1}}class zs extends Gt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Jr extends Gt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.BLEND):s.disable(s.BLEND),this.current=n,this.dirty=!1}}class vo extends Gt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class es extends Gt{getDefault(){return o.Color.transparent}set(n){const s=this.current;(n.r!==s.r||n.g!==s.g||n.b!==s.b||n.a!==s.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class ts extends Gt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class so extends Gt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;n?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=n,this.dirty=!1}}class Ba extends Gt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class ao extends Gt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class is extends Gt{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class qo extends Gt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class ks extends Gt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const s=this.current;(n[0]!==s[0]||n[1]!==s[1]||n[2]!==s[2]||n[3]!==s[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ns extends Gt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class qr extends Gt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Bs extends Gt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Fa extends Gt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Io extends Gt{getDefault(){return null}set(n){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class aa extends Gt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class gc extends Gt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class yc extends Gt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class Fs extends Gt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class Na extends Gt{constructor(n,s){super(n),this.context=n,this.parent=s}getDefault(){return null}}class Qr extends Na{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class la extends Na{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class lo extends la{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ca{constructor(n,s,h,p){this.context=n,this.width=s,this.height=h;const _=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Qr(n,_),p&&(this.depthAttachment=new la(n,_))}destroy(){const n=this.context.gl,s=this.colorAttachment.get();if(s&&n.deleteTexture(s),this.depthAttachment){const h=this.depthAttachment.get();h&&n.deleteRenderbuffer(h)}n.deleteFramebuffer(this.framebuffer)}}class ne{constructor(n,s=!1){if(this.gl=n,this.isWebGL2=s,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),s){const h=n;this.extVertexArrayObject={createVertexArrayOES:h.createVertexArray.bind(n),deleteVertexArrayOES:h.deleteVertexArray.bind(n),bindVertexArrayOES:h.bindVertexArray.bind(n)}}this.clearColor=new Cr(this),this.clearDepth=new kr(this),this.clearStencil=new oo(this),this.colorMask=new Wo(this),this.depthMask=new ka(this),this.stencilMask=new tn(this),this.stencilFunc=new dr(this),this.stencilOp=new Br(this),this.stencilTest=new Le(this),this.depthRange=new ri(this),this.depthTest=new br(this),this.depthFunc=new zs(this),this.blend=new Jr(this),this.blendFunc=new vo(this),this.blendColor=new es(this),this.blendEquation=new ts(this),this.cullFace=new so(this),this.cullFaceSide=new Ba(this),this.frontFace=new ao(this),this.program=new is(this),this.activeTexture=new qo(this),this.viewport=new ks(this),this.bindFramebuffer=new ns(this),this.bindRenderbuffer=new qr(this),this.bindTexture=new Bs(this),this.bindVertexBuffer=new Fa(this),this.bindElementBuffer=new Io(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new aa(this),this.pixelStoreUnpack=new gc(this),this.pixelStoreUnpackPremultiplyAlpha=new yc(this),this.pixelStoreUnpackFlipY=new Fs(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),s||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(s||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=s||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,s){return new Bt(this,n,s)}createVertexBuffer(n,s,h){return new ro(this,n,s,h)}createRenderbuffer(n,s,h){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,n,s,h),this.bindRenderbuffer.set(null),_}createFramebuffer(n,s,h){return new ca(this,n,s,h)}clear({color:n,depth:s,stencil:h}){const p=this.gl;let _=0;n&&(_|=p.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(_|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(_|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),p.clear(_)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){B(n.blendFunction,o.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class V extends o.Evented{constructor(n,s,h,p){if(super(),this.id=n,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.extend(this,o.pick(s,["url","scheme","tileSize","promoteId"])),this._options=o.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new o.DedupedRequest}load(n){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=Yr(this._options,this.map._requestManager,s,h,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new o.ErrorEvent(p))):_&&(o.extend(this,_),_.bounds&&(this.tileBounds=new zr(_.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(p)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}loadTile(n,s){const h=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(h,o.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=s:n.request=n.actor.send("reloadTile",p,_.bind(this));else if(n.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const b=o.loadVectorTile.call({deduped:this._deduped},p,(E,S)=>{E||!S?_.call(this,E):(p.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},n.actor&&n.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);n.request={cancel:b}}function _(b,E){return delete n.request,n.aborted?s(null):b&&b.status!==404?s(b):(E&&E.resourceTiming&&(n.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&n.setExpiryData(E),n.loadVectorData(E,this.map.painter),o.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class j extends o.Evented{constructor(n,s,h,p){super(),this.id=n,this.dispatcher=h,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.extend({type:"raster"},s),o.extend(this,o.pick(s,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Yr(this._options,this.map._requestManager,null,null,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new o.ErrorEvent(s)):h&&(o.extend(this,h),h.bounds&&(this.tileBounds=new zr(h.bounds,this.minzoom,this.maxzoom)),o.postTurnstileEvent(h.tiles),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(s)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,s){const h=o.exported.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);n.request=o.getImage(this.map._requestManager.transformRequest(p,o.ResourceType.Tile),(_,b,E,S)=>(delete n.request,n.aborted?(n.state="unloaded",s(null)):_?(n.state="errored",s(_)):b?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:E,expires:S}),n.setTexture(b,this.map.painter),n.state="loaded",o.cacheEntryPossiblyAdded(this.dispatcher),void s(null)):s(null)))}static loadTileData(n,s,h){n.setTexture(s,h)}static unloadTileData(n,s){n.texture&&s.saveTileTexture(n.texture)}abortTile(n,s){n.request&&(n.request.cancel(),delete n.request),s()}unloadTile(n,s){n.texture&&this.map.painter.saveTileTexture(n.texture),s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let ie;function ue(c,n,s,h,p,_,b,E){const S=[c,s,p,n,h,_,1,1,1],O=[b,E,1],R=o.adjoint([],S),[U,$,J]=o.transformMat3(O,O,o.transpose(R,R));return o.multiply$1(S,[U,0,0,0,$,0,0,0,J],S)}class be extends o.Evented{constructor(n,s,h,p){super(),this.id=n,this.dispatcher=h,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s,this._dirty=!1}load(n,s){this._loaded=s||!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=o.getImage(this.map._requestManager.transformRequest(this.url,o.ResourceType.Image),(h,p)=>{if(this._imageRequest=null,this._loaded=!0,h)this.fire(new o.ErrorEvent(h));else if(p){const{HTMLImageElement:_}=o.window;this.image=p instanceof _?o.exported.getImageData(p):p,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const s=n.map(o.MercatorCoordinate.fromLngLat);return this.tileID=function(h){let p=1/0,_=1/0,b=-1/0,E=-1/0;for(const U of h)p=Math.min(p,U.x),_=Math.min(_,U.y),b=Math.max(b,U.x),E=Math.max(E,U.y);const S=Math.max(b-p,E-_),O=Math.max(0,Math.floor(-Math.log(S)/Math.LN2)),R=Math.pow(2,O);return new o.CanonicalTileID(O,Math.floor((p+b)/2*R),Math.floor((_+E)/2*R))}(s),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const S in this.tiles){const O=this.tiles[S];O.state!=="loaded"&&(O.state="loaded",O.texture=this.texture)}if(this._boundsArray)return;const s=o.tileTransform(this.tileID,this.map.transform.projection),[h,p,_,b]=this.coordinates.map(S=>{const O=s.projection.project(S[0],S[1]);return o.getTilePoint(s,O)._round()});this.perspectiveTransform=function(S,O,R,U,$,J,Y,Q,ee,W){const ae=ue(0,0,S,0,0,O,S,O),oe=ue(R,U,$,J,Y,Q,ee,W);return o.multiply$1(oe,o.adjoint(ae,ae),oe),[oe[6]/oe[8]*S/o.EXTENT,oe[7]/oe[8]*O/o.EXTENT]}(this.width,this.height,h.x,h.y,p.x,p.y,b.x,b.y,_.x,_.y);const E=this._boundsArray=new o.StructArrayLayout4i8;E.emplaceBack(h.x,h.y,0,0),E.emplaceBack(p.x,p.y,o.EXTENT,0),E.emplaceBack(b.x,b.y,0,o.EXTENT),E.emplaceBack(_.x,_.y,o.EXTENT,o.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(E,o.boundsAttributes.members),this.boundsSegments=o.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,s=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new o.Texture(n,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,s){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},s(null)):(n.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ze={vector:V,raster:j,"raster-dem":class extends j{constructor(c,n,s,h){super(c,n,s,h),this.type="raster-dem",this.maxzoom=22,this._options=o.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(c,n){const s=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(p,_){p&&(c.state="errored",n(p)),_&&(c.dem=_,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",n(null))}c.request=o.getImage(this.map._requestManager.transformRequest(s,o.ResourceType.Tile),function(p,_,b,E){if(delete c.request,c.aborted)c.state="unloaded",n(null);else if(p)c.state="errored",n(p);else if(_){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:b,expires:E});const S=o.window.ImageBitmap&&_ instanceof o.window.ImageBitmap&&(ie==null&&(ie=o.window.OffscreenCanvas&&new o.window.OffscreenCanvas(1,1).getContext("2d")&&typeof o.window.createImageBitmap=="function"),ie),O=1-(_.width-o.prevPowerOfTwo(_.width))/2;O<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const R=S?_:o.exported.getImageData(_,O),U={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:O};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",U,h.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(c){const n=c.canonical,s=Math.pow(2,n.z),h=(n.x-1+s)%s,p=n.x===0?c.wrap-1:c.wrap,_=(n.x+1+s)%s,b=n.x+1===s?c.wrap+1:c.wrap,E={};return E[new o.OverscaledTileID(c.overscaledZ,p,n.z,h,n.y).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,b,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(E[new o.OverscaledTileID(c.overscaledZ,p,n.z,h,n.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,b,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<s&&(E[new o.OverscaledTileID(c.overscaledZ,p,n.z,h,n.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,c.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},E[new o.OverscaledTileID(c.overscaledZ,b,n.z,_,n.y+1).key]={backfilled:!1}),E}unloadTile(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded"}},geojson:class extends o.Evented{constructor(c,n,s,h){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=n.data,this._options=o.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const p=o.EXTENT/this.tileSize;this.workerOptions=o.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*p,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*p,extent:o.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*p,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}getClusterExpansionZoom(c,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},n),this}getClusterChildren(c,n){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},n),this}getClusterLeaves(c,n,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:n,offset:s},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.Event("dataloading",{dataType:"source"})),this._loaded=!1;const c=o.extend({},this.workerOptions),n=this._data;typeof n=="string"?(c.request=this.map._requestManager.transformRequest(o.exported.resolveURL(n),o.ResourceType.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,c,(s,h)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.ErrorEvent(s));else{const p={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(p.resourceTiming=h.resourceTiming[this.id]),this.fire(new o.Event("data",p)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(c,n){const s=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(s,{type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:o.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(h,p)=>(delete c.request,c.unloadVectorData(),c.aborted?n(null):h?n(h):(c.loadVectorData(p,this.map.painter,s==="reloadTile"),n(null))),void 0,s==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends be{constructor(c,n,s,h){super(c,n,s,h),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const n of c.urls)this.urls.push(this.map._requestManager.transformRequest(n,o.ResourceType.Source).url);o.getVideo(this.urls,(n,s)=>{this._loaded=!0,n?this.fire(new o.ErrorEvent(n)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const n=this.video.seekable;c<n.start(0)||c>n.end(0)?this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,n=c.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.Texture(c,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:be,canvas:class extends be{constructor(c,n,s,h){super(c,n,s,h),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(_=>typeof _!="number"))||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof o.window.HTMLCanvasElement||this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.ErrorEvent(new o.ValidationError(`sources.${c}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof o.window.HTMLCanvasElement?this.options.canvas:o.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends o.Evented{constructor(c,n,s,h){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=n,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new zr(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),o.extend(this,o.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this._map=c,this._loaded=!1,this.fire(new o.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:n,y:s,z:h}=c.canonical;return this._implementation.hasTile({x:n,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,n){const{x:s,y:h,z:p}=c.tileID.canonical,_=new o.window.AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:s,y:h,z:p},{signal:_.signal})).then(function(b){return delete c.request,c.aborted?(c.state="unloaded",n(null)):b===void 0?(c.state="errored",n(null)):b===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",n(null)):function(E){return E instanceof o.window.ImageData||E instanceof o.window.HTMLCanvasElement||E instanceof o.window.ImageBitmap||E instanceof o.window.HTMLImageElement}(b)?(this.loadTileData(c,b),c.state="loaded",void n(null)):(c.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}.bind(this)).catch(b=>{b.code!==20&&(c.state="errored",n(b))}),c.request.cancel=()=>_.abort()}loadTileData(c,n){j.loadTileData(c,n,this._map.painter)}unloadTileData(c){j.unloadTileData(c,this._map.painter)}unloadTile(c,n){if(this.unloadTileData(c),this._implementation.unloadTile){const{x:s,y:h,z:p}=c.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:p})}n()}abortTile(c,n){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new o.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Me=function(c,n,s,h){const p=new ze[n.type](c,n,s,h);if(p.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${p.id}`);return o.bindAll(["load","abort","unload","serialize","prepare"],p),p};function Ae(c,n){const s=o.identity([]);return o.scale(s,s,[.5*c.width,.5*-c.height,1]),o.translate(s,s,[1,-1,0]),o.multiply(s,s,c.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(s)}function Ue(c,n,s,h,p,_,b,E=!1){const S=c.tilesIn(h,b,E);S.sort(Dt);const O=[];for(const U of S)O.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(n,s,c._state,U,p,_,Ae(c.transform,U.tile.tileID),E)});const R=function(U){const $={},J={};for(const Y of U){const Q=Y.queryResults,ee=Y.wrappedTileID,W=J[ee]=J[ee]||{};for(const ae in Q){const oe=Q[ae],le=W[ae]=W[ae]||{},ve=$[ae]=$[ae]||[];for(const ge of oe)le[ge.featureIndex]||(le[ge.featureIndex]=!0,ve.push(ge))}}return $}(O);for(const U in R)R[U].forEach($=>{const J=$.feature,Y=J.layer;Y&&Y.type!=="background"&&Y.type!=="sky"&&(J.source=Y.source,Y["source-layer"]&&(J.sourceLayer=Y["source-layer"]),J.state=J.id!==void 0?c.getFeatureState(Y["source-layer"],J.id):{})});return R}function ht(c,n){const s=c.getRenderableIds().map(_=>c.getTileByID(_)),h=[],p={};for(let _=0;_<s.length;_++){const b=s[_],E=b.tileID.canonical.key;p[E]||(p[E]=!0,b.querySourceFeatures(h,n))}return h}function Dt(c,n){const s=c.tileID,h=n.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function yt(){return Cl.workerClass!=null?new Cl.workerClass:new o.window.Worker(Cl.workerUrl)}const ni="mapboxgl_preloaded_worker_pool";class Jt{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Jt.workerCount;)this.workers.push(new yt);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ni]}numActive(){return Object.keys(this.active).length}}let Qt;function ai(){return Qt||(Qt=new Jt),Qt}function oi(c,n){const s={};for(const h in c)h!=="ref"&&(s[h]=c[h]);return o.refProperties.forEach(h=>{h in n&&(s[h]=n[h])}),s}function Hi(c){c=c.slice();const n=Object.create(null);for(let s=0;s<c.length;s++)n[c[s].id]=c[s];for(let s=0;s<c.length;s++)"ref"in c[s]&&(c[s]=oi(c[s],n[c[s].ref]));return c}Jt.workerCount=2;const li={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Vi(c,n,s){s.push({command:li.addSource,args:[c,n[c]]})}function Wi(c,n,s){n.push({command:li.removeSource,args:[c]}),s[c]=!0}function rs(c,n,s,h){Wi(c,s,h),Vi(c,n,s)}function co(c,n,s){let h;for(h in c[s])if(c[s].hasOwnProperty(h)&&h!=="data"&&!B(c[s][h],n[s][h]))return!1;for(h in n[s])if(n[s].hasOwnProperty(h)&&h!=="data"&&!B(c[s][h],n[s][h]))return!1;return!0}function Ye(c,n,s,h,p,_){let b;for(b in n=n||{},c=c||{})c.hasOwnProperty(b)&&(B(c[b],n[b])||s.push({command:_,args:[h,b,n[b],p]}));for(b in n)n.hasOwnProperty(b)&&!c.hasOwnProperty(b)&&(B(c[b],n[b])||s.push({command:_,args:[h,b,n[b],p]}))}function os(c){return c.id}function sr(c,n){return c[n.id]=n,c}class ua{constructor(n,s){this.reset(n,s)}reset(n,s){this.points=n||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=o.clamp(n,0,1);let s=1,h=this._distances[s];const p=n*this.paddedLength+this.padding;for(;h<p&&s<this._distances.length;)h=this._distances[++s];const _=s-1,b=this._distances[_],E=h-b,S=E>0?(p-b)/E:0;return this.points[_].mult(1-S).add(this.points[s].mult(S))}}class Bu{constructor(n,s,h){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(n/h),this.yCellCount=Math.ceil(s/h);for(let b=0;b<this.xCellCount*this.yCellCount;b++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=s,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,s,h,p,_){this._forEachCell(s,h,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(n,s,h,p){this._forEachCell(s-p,h-p,s+p,h+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(s),this.circles.push(h),this.circles.push(p)}_insertBoxCell(n,s,h,p,_,b){this.boxCells[_].push(b)}_insertCircleCell(n,s,h,p,_,b){this.circleCells[_].push(b)}_query(n,s,h,p,_,b){if(h<0||n>this.width||p<0||s>this.height)return!_&&[];const E=[];if(n<=0&&s<=0&&this.width<=h&&this.height<=p){if(_)return!0;for(let S=0;S<this.boxKeys.length;S++)E.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const O=this.circles[3*S],R=this.circles[3*S+1],U=this.circles[3*S+2];E.push({key:this.circleKeys[S],x1:O-U,y1:R-U,x2:O+U,y2:R+U})}return b?E.filter(b):E}return this._forEachCell(n,s,h,p,this._queryCell,E,{hitTest:_,seenUids:{box:{},circle:{}}},b),_?E.length>0:E}_queryCircle(n,s,h,p,_){const b=n-h,E=n+h,S=s-h,O=s+h;if(E<0||b>this.width||O<0||S>this.height)return!p&&[];const R=[];return this._forEachCell(b,S,E,O,this._queryCellCircle,R,{hitTest:p,circle:{x:n,y:s,radius:h},seenUids:{box:{},circle:{}}},_),p?R.length>0:R}query(n,s,h,p,_){return this._query(n,s,h,p,!1,_)}hitTest(n,s,h,p,_){return this._query(n,s,h,p,!0,_)}hitTestCircle(n,s,h,p){return this._queryCircle(n,s,h,!0,p)}_queryCell(n,s,h,p,_,b,E,S){const O=E.seenUids,R=this.boxCells[_];if(R!==null){const $=this.bboxes;for(const J of R)if(!O.box[J]){O.box[J]=!0;const Y=4*J;if(n<=$[Y+2]&&s<=$[Y+3]&&h>=$[Y+0]&&p>=$[Y+1]&&(!S||S(this.boxKeys[J]))){if(E.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[J],x1:$[Y],y1:$[Y+1],x2:$[Y+2],y2:$[Y+3]})}}}const U=this.circleCells[_];if(U!==null){const $=this.circles;for(const J of U)if(!O.circle[J]){O.circle[J]=!0;const Y=3*J;if(this._circleAndRectCollide($[Y],$[Y+1],$[Y+2],n,s,h,p)&&(!S||S(this.circleKeys[J]))){if(E.hitTest)return b.push(!0),!0;{const Q=$[Y],ee=$[Y+1],W=$[Y+2];b.push({key:this.circleKeys[J],x1:Q-W,y1:ee-W,x2:Q+W,y2:ee+W})}}}}}_queryCellCircle(n,s,h,p,_,b,E,S){const O=E.circle,R=E.seenUids,U=this.boxCells[_];if(U!==null){const J=this.bboxes;for(const Y of U)if(!R.box[Y]){R.box[Y]=!0;const Q=4*Y;if(this._circleAndRectCollide(O.x,O.y,O.radius,J[Q+0],J[Q+1],J[Q+2],J[Q+3])&&(!S||S(this.boxKeys[Y])))return b.push(!0),!0}}const $=this.circleCells[_];if($!==null){const J=this.circles;for(const Y of $)if(!R.circle[Y]){R.circle[Y]=!0;const Q=3*Y;if(this._circlesCollide(J[Q],J[Q+1],J[Q+2],O.x,O.y,O.radius)&&(!S||S(this.circleKeys[Y])))return b.push(!0),!0}}}_forEachCell(n,s,h,p,_,b,E,S){const O=this._convertToXCellCoord(n),R=this._convertToYCellCoord(s),U=this._convertToXCellCoord(h),$=this._convertToYCellCoord(p);for(let J=O;J<=U;J++)for(let Y=R;Y<=$;Y++)if(_.call(this,n,s,h,p,this.xCellCount*Y+J,b,E,S))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,s,h,p,_,b){const E=p-n,S=_-s,O=h+b;return O*O>E*E+S*S}_circleAndRectCollide(n,s,h,p,_,b,E){const S=(b-p)/2,O=Math.abs(n-(p+S));if(O>S+h)return!1;const R=(E-_)/2,U=Math.abs(s-(_+R));if(U>R+h)return!1;if(O<=S||U<=R)return!0;const $=O-S,J=U-R;return $*$+J*J<=h*h}}const ss=Math.tan(85*Math.PI/180);function Ns(c,n,s,h,p,_,b){const E=o.create();if(s)if(_.name==="globe"){const S=o.calculateGlobeLabelMatrix(p,n);o.multiply(E,E,S)}else{const S=Ht([],b);E[0]=S[0],E[1]=S[1],E[4]=S[2],E[5]=S[3],h||o.rotateZ(E,E,p.angle)}else o.multiply(E,p.labelPlaneMatrix,c);return E}function Yc(c,n,s,h,p,_,b){const E=Ns(c,n,s,h,p,_,b);return _.name==="globe"&&s||(E[2]=E[6]=E[10]=E[14]=0),E}function ha(c,n,s,h,p,_,b){if(s){if(_.name==="globe"){const E=Ns(c,n,s,h,p,_,b);return o.invert(E,E),o.multiply(E,c,E),E}{const E=o.clone(c),S=o.identity([]);return S[0]=b[0],S[1]=b[1],S[4]=b[2],S[5]=b[3],o.multiply(E,E,S),h||o.rotateZ(E,E,-p.angle),E}}return p.glCoordMatrix}function At(c,n,s,h){const p=[c,n,s,1];s?o.transformMat4$1(p,p,h):wt(p,p,h);const _=p[3];return p[0]/=_,p[1]/=_,p[2]/=_,p}function Bi(c,n){return Math.min(.5+c/n*.5,1.5)}function Ui(c,n){const s=c[0]/c[3],h=c[1]/c[3];return s>=-n[0]&&s<=n[0]&&h>=-n[1]&&h<=n[1]}function xo(c,n,s,h,p,_,b,E,S,O){const R=s.transform,U=h?c.textSizeData:c.iconSizeData,$=o.evaluateSizeForZoom(U,s.transform.zoom),J=R.projection.name==="globe",Y=[256/s.width*2+1,256/s.height*2+1],Q=h?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;Q.clear();let ee=null;J&&(ee=h?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const W=c.lineVertexArray,ae=h?c.text.placedSymbolArray:c.icon.placedSymbolArray,oe=s.transform.width/s.transform.height;let le,ve=!1;for(let ge=0;ge<ae.length;ge++){const we=ae.get(ge),{numGlyphs:ke,writingMode:Be}=we;if(Be!==o.WritingMode.vertical||ve||le===o.WritingMode.horizontal||(ve=!0),le=Be,(we.hidden||Be===o.WritingMode.vertical)&&!ve){Ie(ke,Q);continue}ve=!1;const je=new o.pointGeometry(we.tileAnchorX,we.tileAnchorY);let{x:Tt,y:Ne,z:st}=R.projection.projectTilePoint(je.x,je.y,O.canonical);if(S){const[zi,Vt,zt]=S(je);Tt+=zi,Ne+=Vt,st+=zt}const He=[Tt,Ne,st,1];if(o.transformMat4$1(He,He,n),!Ui(He,Y)){Ie(ke,Q);continue}const mt=Bi(s.transform.cameraToCenterDistance,He[3]),Ve=o.evaluateSizeForFeature(U,$,we),Oe=b?Ve/mt:Ve*mt,Ze=At(Tt,Ne,st,p);if(Ze[3]<=0){Ie(ke,Q);continue}let ut={};const pt=b?null:S,Yt=H(we,Oe,!1,E,n,p,_,c.glyphOffsetArray,W,Q,ee,Ze,je,ut,oe,pt,R.projection,O,b);ve=Yt.useVertical,pt&&Yt.needsFlipping&&(ut={}),(Yt.notEnoughRoom||ve||Yt.needsFlipping&&H(we,Oe,!0,E,n,p,_,c.glyphOffsetArray,W,Q,ee,Ze,je,ut,oe,pt,R.projection,O,b).notEnoughRoom)&&Ie(ke,Q)}h?(c.text.dynamicLayoutVertexBuffer.updateData(Q),ee&&c.text.globeExtVertexBuffer.updateData(ee)):(c.icon.dynamicLayoutVertexBuffer.updateData(Q),ee&&c.icon.globeExtVertexBuffer.updateData(ee))}function T(c,n,s,h,p,_,b,E,S,O,R,U,$,J,Y,Q){const{lineStartIndex:ee,glyphStartIndex:W,segment:ae}=E,oe=W+E.numGlyphs,le=ee+E.lineLength,ve=n.getoffsetX(W),ge=n.getoffsetX(oe-1),we=Te(c*ve,s,h,p,_,b,ae,ee,le,S,O,R,U,$,!0,J,Y,Q);if(!we)return null;const ke=Te(c*ge,s,h,p,_,b,ae,ee,le,S,O,R,U,$,!0,J,Y,Q);return ke?{first:we,last:ke}:null}function C(c,n,s,h){return c===o.WritingMode.horizontal&&Math.abs(h)>Math.abs(s)?{useVertical:!0}:c===o.WritingMode.vertical?h>0?{needsFlipping:!0}:null:n!==0&&function(p,_){return p===0||Math.abs(_/p)>ss}(s,h)?n===1?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function H(c,n,s,h,p,_,b,E,S,O,R,U,$,J,Y,Q,ee,W,ae){const oe=n/24,le=c.lineOffsetX*oe,ve=c.lineOffsetY*oe,{lineStartIndex:ge,glyphStartIndex:we,numGlyphs:ke,segment:Be,writingMode:je,flipState:Tt}=c,Ne=ge+c.lineLength,st=He=>{if(R){const[Ze,ut,pt]=He.up,Yt=O.length;o.updateGlobeVertexNormal(R,Yt+0,Ze,ut,pt),o.updateGlobeVertexNormal(R,Yt+1,Ze,ut,pt),o.updateGlobeVertexNormal(R,Yt+2,Ze,ut,pt),o.updateGlobeVertexNormal(R,Yt+3,Ze,ut,pt)}const[mt,Ve,Oe]=He.point;o.addDynamicAttributes(O,mt,Ve,Oe,He.angle)};if(ke>1){const He=T(oe,E,le,ve,s,U,$,c,S,_,J,Q,!1,ee,W,ae);if(!He)return{notEnoughRoom:!0};if(h&&!s){let[mt,Ve,Oe]=He.first.point,[Ze,ut,pt]=He.last.point;[mt,Ve]=At(mt,Ve,Oe,b),[Ze,ut]=At(Ze,ut,pt,b);const Yt=C(je,Tt,(Ze-mt)*Y,ut-Ve);if(c.flipState=Yt&&Yt.needsFlipping?1:2,Yt)return Yt}st(He.first);for(let mt=we+1;mt<we+ke-1;mt++){const Ve=Te(oe*E.getoffsetX(mt),le,ve,s,U,$,Be,ge,Ne,S,_,J,Q,!1,!1,ee,W,ae);if(!Ve)return O.length-=4*(mt-we),{notEnoughRoom:!0};st(Ve)}st(He.last)}else{if(h&&!s){const mt=At($.x,$.y,0,p),Ve=ge+Be+1,Oe=new o.pointGeometry(S.getx(Ve),S.gety(Ve)),Ze=At(Oe.x,Oe.y,0,p),ut=Ze[3]>0?Ze:Ee($,Oe,mt,1,p,void 0,ee,W.canonical),pt=C(je,Tt,(ut[0]-mt[0])*Y,ut[1]-mt[1]);if(c.flipState=pt&&pt.needsFlipping?1:2,pt)return pt}const He=Te(oe*E.getoffsetX(we),le,ve,s,U,$,Be,ge,Ne,S,_,J,Q,!1,!1,ee,W,ae);if(!He)return{notEnoughRoom:!0};st(He)}return{}}function he(c,n,s,h,p){const{x:_,y:b,z:E}=h.projectTilePoint(c.x,c.y,n);if(!p)return At(_,b,E,s);const[S,O,R]=p(c);return At(_+S,b+O,E+R,s)}function Ee(c,n,s,h,p,_,b,E){const S=he(c.sub(n)._unit()._add(c),E,p,b,_);return o.sub(S,s,S),o.normalize(S,S),o.scaleAndAdd(S,s,S,h)}function Te(c,n,s,h,p,_,b,E,S,O,R,U,$,J,Y,Q,ee,W){const ae=h?c-n:c+n;let oe=ae>0?1:-1,le=0;h&&(oe*=-1,le=Math.PI),oe<0&&(le+=Math.PI);let ve=E+b+(oe>0?0:1)|0,ge=p,we=p,ke=0,Be=0;const je=Math.abs(ae),Tt=[],Ne=[];let st=_,He=st;const mt=()=>Ee(He,st,we,je-ke+1,R,$,Q,ee.canonical);for(;ke+Be<=je;){if(ve+=oe,ve<E||ve>=S)return null;if(we=ge,He=st,Tt.push(we),J&&Ne.push(He),st=new o.pointGeometry(O.getx(ve),O.gety(ve)),ge=U[ve],!ge){const zt=he(st,ee.canonical,R,Q,$);ge=zt[3]>0?U[ve]=zt:mt()}ke+=Be,Be=o.distance(we,ge)}Y&&$&&(U[ve]&&(ge=mt(),Be=o.distance(we,ge)),U[ve]=ge);const Ve=(je-ke)/Be,Oe=st.sub(He)._mult(Ve)._add(He),Ze=o.sub([],ge,we),ut=o.scaleAndAdd([],we,Ze,Ve);let pt=[0,0,1],Yt=Ze[0],zi=Ze[1];if(W&&(pt=Q.upVector(ee.canonical,Oe.x,Oe.y),pt[0]!==0||pt[1]!==0||pt[2]!==1)){const zt=[pt[2],0,-pt[0]],ei=o.cross([],pt,zt);o.normalize(zt,zt),o.normalize(ei,ei),Yt=o.dot(Ze,zt),zi=o.dot(Ze,ei)}if(s){const zt=o.cross([],pt,Ze);o.normalize(zt,zt),o.scaleAndAdd(ut,ut,zt,s*oe)}const Vt=le+Math.atan2(zi,Yt);return Tt.push(ut),J&&Ne.push(Oe),{point:ut,angle:Vt,path:Tt,tilePath:Ne,up:pt}}function Ie(c,n){const s=n.length,h=s+4*c;n.resize(h),n.float32.fill(-1/0,4*s,4*h)}function wt(c,n,s){const h=n[0],p=n[1];return c[0]=s[0]*h+s[4]*p+s[12],c[1]=s[1]*h+s[5]*p+s[13],c[3]=s[3]*h+s[7]*p+s[15],c}const xt=100;class Ft{constructor(n,s,h=new Bu(n.width+200,n.height+200,25),p=new Bu(n.width+200,n.height+200,25)){this.transform=n,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+xt,this.screenBottomBoundary=n.height+xt,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=s}placeCollisionBox(n,s,h,p,_,b,E,S){let O=h.projectedAnchorX,R=h.projectedAnchorY,U=h.projectedAnchorZ;const $=h.elevation,J=h.tileID,Y=n.getProjection();if($&&J){const[ge,we,ke]=Y.upVector(J.canonical,h.tileAnchorX,h.tileAnchorY),Be=Y.upVectorScale(J.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=ge*$*Be,R+=we*$*Be,U+=ke*$*Be}const Q=this.projectAndGetPerspectiveRatio(E,O,R,U,h.tileID,Y.name==="globe"||!!$||this.transform.pitch>0,Y),ee=b*Q.perspectiveRatio,W=(h.x1*s+p.x-h.padding)*ee+Q.point.x,ae=(h.y1*s+p.y-h.padding)*ee+Q.point.y,oe=(h.x2*s+p.x+h.padding)*ee+Q.point.x,le=(h.y2*s+p.y+h.padding)*ee+Q.point.y,ve=Q.perspectiveRatio<=.55||Q.occluded;return!this.isInsideGrid(W,ae,oe,le)||!_&&this.grid.hitTest(W,ae,oe,le,S)||ve?{box:[],offscreen:!1,occluded:Q.occluded}:{box:[W,ae,oe,le],offscreen:this.isOffscreen(W,ae,oe,le),occluded:!1}}placeCollisionCircles(n,s,h,p,_,b,E,S,O,R,U,$,J,Y,Q){const ee=[],W=this.transform.elevation,ae=n.getProjection(),oe=W?W.getAtTileOffsetFunc(Q,this.transform.center.lat,this.transform.worldSize,ae):null,le=new o.pointGeometry(h.tileAnchorX,h.tileAnchorY);let{x:ve,y:ge,z:we}=ae.projectTilePoint(le.x,le.y,Q.canonical);if(oe){const[Oe,Ze,ut]=oe(le);ve+=Oe,ge+=Ze,we+=ut}const ke=ae.name==="globe",Be=this.projectAndGetPerspectiveRatio(E,ve,ge,we,Q,ke||!!W||this.transform.pitch>0,ae),{perspectiveRatio:je}=Be,Tt=(U?b/je:b*je)/o.ONE_EM,Ne=At(ve,ge,we,S),st=Be.signedDistanceFromCamera>0?T(Tt,_,h.lineOffsetX*Tt,h.lineOffsetY*Tt,!1,Ne,le,h,p,S,{},W&&!U?oe:null,U&&!!W,ae,Q,U):null;let He=!1,mt=!1,Ve=!0;if(st&&!Be.occluded){const Oe=.5*J*je+Y,Ze=new o.pointGeometry(-100,-100),ut=new o.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),pt=new ua,{first:Yt,last:zi}=st,Vt=Yt.path.length;let zt=[];for(let si=Vt-1;si>=1;si--)zt.push(Yt.path[si]);for(let si=1;si<zi.path.length;si++)zt.push(zi.path[si]);const ei=2.5*Oe;O&&(zt=zt.map(([si,dn,xn],Fn)=>(oe&&!ke&&(xn=oe(Fn<Vt-1?Yt.tilePath[Vt-1-Fn]:zi.tilePath[Fn-Vt+2])[2]),At(si,dn,xn,O))),zt.some(si=>si[3]<=0)&&(zt=[]));let qi=[];if(zt.length>0){let si=1/0,dn=-1/0,xn=1/0,Fn=-1/0;for(const In of zt)si=Math.min(si,In[0]),xn=Math.min(xn,In[1]),dn=Math.max(dn,In[0]),Fn=Math.max(Fn,In[1]);dn>=Ze.x&&si<=ut.x&&Fn>=Ze.y&&xn<=ut.y&&(qi=[zt.map(In=>new o.pointGeometry(In[0],In[1]))],(si<Ze.x||dn>ut.x||xn<Ze.y||Fn>ut.y)&&(qi=o.clipLine(qi,Ze.x,Ze.y,ut.x,ut.y)))}for(const si of qi){pt.reset(si,.25*Oe);let dn=0;dn=pt.length<=.5*Oe?1:Math.ceil(pt.paddedLength/ei)+1;for(let xn=0;xn<dn;xn++){const Fn=xn/Math.max(dn-1,1),In=pt.lerp(Fn),Sr=In.x+xt,Oo=In.y+xt;ee.push(Sr,Oo,Oe,0);const bs=Sr-Oe,ws=Oo-Oe,$n=Sr+Oe,Ln=Oo+Oe;if(Ve=Ve&&this.isOffscreen(bs,ws,$n,Ln),mt=mt||this.isInsideGrid(bs,ws,$n,Ln),!s&&this.grid.hitTestCircle(Sr,Oo,Oe,$)&&(He=!0,!R))return{circles:[],offscreen:!1,collisionDetected:He,occluded:!1}}}}return{circles:!R&&He||!mt?[]:ee,offscreen:Ve,collisionDetected:He,occluded:Be.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,p=1/0,_=-1/0,b=-1/0;for(const R of n){const U=new o.pointGeometry(R.x+xt,R.y+xt);h=Math.min(h,U.x),p=Math.min(p,U.y),_=Math.max(_,U.x),b=Math.max(b,U.y),s.push(U)}const E=this.grid.query(h,p,_,b).concat(this.ignoredGrid.query(h,p,_,b)),S={},O={};for(const R of E){const U=R.key;if(S[U.bucketInstanceId]===void 0&&(S[U.bucketInstanceId]={}),S[U.bucketInstanceId][U.featureIndex])continue;const $=[new o.pointGeometry(R.x1,R.y1),new o.pointGeometry(R.x2,R.y1),new o.pointGeometry(R.x2,R.y2),new o.pointGeometry(R.x1,R.y2)];o.polygonIntersectsPolygon(s,$)&&(S[U.bucketInstanceId][U.featureIndex]=!0,O[U.bucketInstanceId]===void 0&&(O[U.bucketInstanceId]=[]),O[U.bucketInstanceId].push(U.featureIndex))}return O}insertCollisionBox(n,s,h,p,_){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:p,collisionGroupID:_},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,s,h,p,_){const b=s?this.ignoredGrid:this.grid,E={bucketInstanceId:h,featureIndex:p,collisionGroupID:_};for(let S=0;S<n.length;S+=4)b.insertCircle(E,n[S],n[S+1],n[S+2])}projectAndGetPerspectiveRatio(n,s,h,p,_,b,E){const S=[s,h,p,1];let O=!1;if(p||this.transform.pitch>0){o.transformMat4$1(S,S,n);const U=E.name==="globe";this.fogState&&_&&!U&&(O=function(J,Y,Q,ee,W,ae){const oe=ae.calculateFogTileMatrix(W),le=[Y,Q,ee];return o.transformMat4(le,le,oe),nn(J,le,ae.pitch,ae._fov)}(this.fogState,s,h,p,_.toUnwrapped(),this.transform)>.9)}else wt(S,S,n);const R=S[3];return{point:new o.pointGeometry((S[0]/R+1)/2*this.transform.width+xt,(-S[1]/R+1)/2*this.transform.height+xt),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/R*.5,1.5),signedDistanceFromCamera:R,occluded:b&&S[2]>R||O}}isOffscreen(n,s,h,p){return h<xt||n>=this.screenRightBoundary||p<xt||s>this.screenBottomBoundary}isInsideGrid(n,s,h,p){return h>=0&&n<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const n=o.identity([]);return o.translate(n,n,[-100,-100,0]),n}}function St(c,n,s){const h=n.createTileMatrix(c,c.worldSize,s.toUnwrapped());return o.multiply(new Float32Array(16),c.projMatrix,h)}function Lt(c,n,s){if(n.projection.name===s.projection.name)return c.projMatrix;const h=s.clone();return h.setProjection(n.projection),St(h,n.getProjection(),c)}function _i(c,n,s){return n.name===s.projection.name?c.projMatrix:St(s,n,c)}class kn{constructor(n,s,h,p){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?s:-s))):p&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class gi{constructor(n,s,h,p,_,b=!1){this.text=new kn(n?n.text:null,s,h,_),this.icon=new kn(n?n.icon:null,s,p,_),this.clipped=b}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Gn{constructor(n,s,h,p=!1){this.text=n,this.icon=s,this.skipFade=h,this.clipped=p}}class dt{constructor(){this.invProjMatrix=o.create(),this.viewportMatrix=o.create(),this.circles=[]}}class Nt{constructor(n,s,h,p,_){this.bucketInstanceId=n,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=p,this.tileID=_}}class bi{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const s=++this.maxGroupID;this.collisionGroups[n]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[n]}}function fr(c,n,s,h,p){const{horizontalAlign:_,verticalAlign:b}=o.getAnchorAlignment(c),E=-(_-.5)*n,S=-(b-.5)*s,O=o.evaluateVariableOffset(c,h);return new o.pointGeometry(E+O[0]*p,S+O[1]*p)}function er(c,n,s,h,p){const _=new o.pointGeometry(c,n);return s&&_._rotate(h?p:-p),_}class Zr{constructor(n,s,h,p,_){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Ft(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new bi(h),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,s,h,p){const _=h.getBucket(s),b=h.latestFeatureIndex;if(!_||!b||s.id!==_.layerIds[0])return;const E=_.layers[0].layout,S=h.collisionBoxArray,O=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),R=h.tileSize/o.EXTENT,U=h.tileID.toUnwrapped();this.transform.setProjection(_.projection);const $=(J=h.tileID,Y=_.getProjection(),Q=this.transform,Y.name===this.projection?Q.calculateProjMatrix(J.toUnwrapped()):St(Q,Y,J));var J,Y,Q;const ee=E.get("text-pitch-alignment")==="map",W=E.get("text-rotation-alignment")==="map";s.compileFilter();const ae=s.dynamicFilter(),oe=s.dynamicFilterNeedsFeature(),le=this.transform.calculatePixelsToTileUnitsMatrix(h),ve=Yc($,h.tileID.canonical,ee,W,this.transform,_.getProjection(),le);let ge=null;if(ee){const Be=ha($,h.tileID.canonical,ee,W,this.transform,_.getProjection(),le);ge=o.multiply([],this.transform.labelPlaneMatrix,Be)}let we=null;ae&&h.latestFeatureIndex&&(we={unwrappedTileID:U,dynamicFilter:ae,dynamicFilterNeedsFeature:oe,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new Nt(_.bucketInstanceId,b,_.sourceLayerIndex,_.index,h.tileID);const ke={bucket:_,layout:E,posMatrix:$,textLabelPlaneMatrix:ve,labelToScreenMatrix:ge,clippingData:we,scale:O,textPixelRatio:R,holdingForFade:h.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:o.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(p)for(const Be of _.sortKeyRanges){const{sortKey:je,symbolInstanceStart:Tt,symbolInstanceEnd:Ne}=Be;n.push({sortKey:je,symbolInstanceStart:Tt,symbolInstanceEnd:Ne,parameters:ke})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ke})}attemptAnchorPlacement(n,s,h,p,_,b,E,S,O,R,U,$,J,Y,Q,ee,W,ae){const{textOffset0:oe,textOffset1:le,crossTileID:ve}=$,ge=[oe,le],we=fr(n,h,p,ge,_),ke=this.collisionIndex.placeCollisionBox(Y,_,s,er(we.x,we.y,b,E,this.transform.angle),U,S,O,R.predicate);if(ee){const Be=Y.getSymbolInstanceIconSize(ae,this.transform.zoom,$.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,Be,ee,er(we.x,we.y,b,E,this.transform.angle),U,S,O,R.predicate).box.length===0)return}if(ke.box.length>0){let Be;return this.prevPlacement&&this.prevPlacement.variableOffsets[ve]&&this.prevPlacement.placements[ve]&&this.prevPlacement.placements[ve].text&&(Be=this.prevPlacement.variableOffsets[ve].anchor),this.variableOffsets[ve]={textOffset:ge,width:h,height:p,anchor:n,textScale:_,prevAnchor:Be},this.markUsedJustification(Y,n,$,Q),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,Q,$),this.placedOrientations[ve]=Q),{shift:we,placedGlyphBoxes:ke}}}placeLayerBucketPart(n,s,h,p){const{bucket:_,layout:b,posMatrix:E,textLabelPlaneMatrix:S,labelToScreenMatrix:O,clippingData:R,textPixelRatio:U,holdingForFade:$,collisionBoxArray:J,partiallyEvaluatedTextSize:Y,partiallyEvaluatedIconSize:Q,collisionGroup:ee}=n.parameters,W=b.get("text-optional"),ae=b.get("icon-optional"),oe=b.get("text-allow-overlap"),le=b.get("icon-allow-overlap"),ve=b.get("text-rotation-alignment")==="map",ge=b.get("text-pitch-alignment")==="map",we=b.get("icon-text-fit")!=="none",ke=b.get("symbol-z-order")==="viewport-y";this.transform.setProjection(_.projection);let Be=oe&&(le||!_.hasIconData()||ae),je=le&&(oe||!_.hasTextData()||W);!_.collisionArrays&&J&&_.deserializeCollisionBoxes(J),h&&p&&_.updateCollisionDebugBuffers(this.transform.zoom,J);const Tt=(Ne,st,He)=>{const{crossTileID:mt,numVerticalGlyphVertices:Ve}=Ne;if(R){const $n={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ln=null;if(R.dynamicFilterNeedsFeature){const sn=this.retainedQueryData[_.bucketInstanceId];Ln=R.featureIndex.loadFeature({featureIndex:Ne.featureIndex,bucketIndex:sn.bucketIndex,sourceLayerIndex:sn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)($n,Ln,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new o.pointGeometry(Ne.tileAnchorX,Ne.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[mt]=new Gn(!1,!1,!1,!0),void(s[mt]=!0)}if(s[mt])return;if($)return void(this.placements[mt]=new Gn(!1,!1,!1));let Oe=!1,Ze=!1,ut=!0,pt=!1,Yt=!1,zi=null,Vt={box:null,offscreen:null,occluded:null},zt={box:null,offscreen:null,occluded:null},ei=null,qi=null,si=null,dn=0,xn=0,Fn=0;He.textFeatureIndex?dn=He.textFeatureIndex:Ne.useRuntimeCollisionCircles&&(dn=Ne.featureIndex),He.verticalTextFeatureIndex&&(xn=He.verticalTextFeatureIndex);const In=$n=>{$n.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const Ln=this.transform.elevation;(Ln||$n.elevation)&&($n.elevation=Ln?Ln.getAtTileOffset($n.tileID,$n.tileAnchorX,$n.tileAnchorY):0)},Sr=He.textBox;if(Sr){In(Sr);const $n=sn=>{let mr=o.WritingMode.horizontal;if(_.allowVerticalPlacement&&!sn&&this.prevPlacement){const po=this.prevPlacement.placedOrientations[mt];po&&(this.placedOrientations[mt]=po,mr=po,this.markUsedOrientation(_,mr,Ne))}return mr},Ln=(sn,mr)=>{if(_.allowVerticalPlacement&&Ve>0&&He.verticalTextBox){for(const po of _.writingModes)if(po===o.WritingMode.vertical?(Vt=mr(),zt=Vt):Vt=sn(),Vt&&Vt.box&&Vt.box.length)break}else Vt=sn()};if(b.get("text-variable-anchor")){let sn=b.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[mt]){const Wn=this.prevPlacement.variableOffsets[mt];sn.indexOf(Wn.anchor)>0&&(sn=sn.filter(to=>to!==Wn.anchor),sn.unshift(Wn.anchor))}const mr=(Wn,to,mo)=>{const Ea=_.getSymbolInstanceTextSize(Y,Ne,this.transform.zoom,st),Pc=(Wn.x2-Wn.x1)*Ea+2*Wn.padding,Ro=(Wn.y2-Wn.y1)*Ea+2*Wn.padding,Si=we&&!le?to:null;Si&&In(Si);let Xa={box:[],offscreen:!1,occluded:!1};const Ml=oe?2*sn.length:sn.length;for(let Ts=0;Ts<Ml;++Ts){const Jl=this.attemptAnchorPlacement(sn[Ts%sn.length],Wn,Pc,Ro,Ea,ve,ge,U,E,ee,Ts>=sn.length,Ne,st,_,mo,Si,Y,Q);if(Jl&&(Xa=Jl.placedGlyphBoxes,Xa&&Xa.box&&Xa.box.length)){Oe=!0,zi=Jl.shift;break}}return Xa};Ln(()=>mr(Sr,He.iconBox,o.WritingMode.horizontal),()=>{const Wn=He.verticalTextBox;return Wn&&In(Wn),_.allowVerticalPlacement&&!(Vt&&Vt.box&&Vt.box.length)&&Ve>0&&Wn?mr(Wn,He.verticalIconBox,o.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Vt&&(Oe=Vt.box,ut=Vt.offscreen,pt=Vt.occluded);const po=$n(Vt&&Vt.box);if(!Oe&&this.prevPlacement){const Wn=this.prevPlacement.variableOffsets[mt];Wn&&(this.variableOffsets[mt]=Wn,this.markUsedJustification(_,Wn.anchor,Ne,po))}}else{const sn=(mr,po)=>{const Wn=_.getSymbolInstanceTextSize(Y,Ne,this.transform.zoom,st),to=this.collisionIndex.placeCollisionBox(_,Wn,mr,new o.pointGeometry(0,0),oe,U,E,ee.predicate);return to&&to.box&&to.box.length&&(this.markUsedOrientation(_,po,Ne),this.placedOrientations[mt]=po),to};Ln(()=>sn(Sr,o.WritingMode.horizontal),()=>{const mr=He.verticalTextBox;return _.allowVerticalPlacement&&Ve>0&&mr?(In(mr),sn(mr,o.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),$n(Vt&&Vt.box&&Vt.box.length)}}if(ei=Vt,Oe=ei&&ei.box&&ei.box.length>0,ut=ei&&ei.offscreen,pt=ei&&ei.occluded,Ne.useRuntimeCollisionCircles){const $n=_.text.placedSymbolArray.get(Ne.centerJustifiedTextSymbolIndex>=0?Ne.centerJustifiedTextSymbolIndex:Ne.verticalPlacedTextSymbolIndex),Ln=o.evaluateSizeForFeature(_.textSizeData,Y,$n),sn=b.get("text-padding");qi=this.collisionIndex.placeCollisionCircles(_,oe,$n,_.lineVertexArray,_.glyphOffsetArray,Ln,E,S,O,h,ge,ee.predicate,Ne.collisionCircleDiameter*Ln/o.ONE_EM,sn,this.retainedQueryData[_.bucketInstanceId].tileID),Oe=oe||qi.circles.length>0&&!qi.collisionDetected,ut=ut&&qi.offscreen,pt=qi.occluded}if(He.iconFeatureIndex&&(Fn=He.iconFeatureIndex),He.iconBox){const $n=Ln=>{In(Ln);const sn=we&&zi?er(zi.x,zi.y,ve,ge,this.transform.angle):new o.pointGeometry(0,0),mr=_.getSymbolInstanceIconSize(Q,this.transform.zoom,Ne.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,mr,Ln,sn,le,U,E,ee.predicate)};zt&&zt.box&&zt.box.length&&He.verticalIconBox?(si=$n(He.verticalIconBox),Ze=si.box.length>0):(si=$n(He.iconBox),Ze=si.box.length>0),ut=ut&&si.offscreen,Yt=si.occluded}const Oo=W||Ne.numHorizontalGlyphVertices===0&&Ve===0,bs=ae||Ne.numIconVertices===0;if(Oo||bs?bs?Oo||(Ze=Ze&&Oe):Oe=Ze&&Oe:Ze=Oe=Ze&&Oe,Oe&&ei&&ei.box&&this.collisionIndex.insertCollisionBox(ei.box,b.get("text-ignore-placement"),_.bucketInstanceId,zt&&zt.box&&xn?xn:dn,ee.ID),Ze&&si&&this.collisionIndex.insertCollisionBox(si.box,b.get("icon-ignore-placement"),_.bucketInstanceId,Fn,ee.ID),qi&&(Oe&&this.collisionIndex.insertCollisionCircles(qi.circles,b.get("text-ignore-placement"),_.bucketInstanceId,dn,ee.ID),h)){const $n=_.bucketInstanceId;let Ln=this.collisionCircleArrays[$n];Ln===void 0&&(Ln=this.collisionCircleArrays[$n]=new dt);for(let sn=0;sn<qi.circles.length;sn+=4)Ln.circles.push(qi.circles[sn+0]),Ln.circles.push(qi.circles[sn+1]),Ln.circles.push(qi.circles[sn+2]),Ln.circles.push(qi.collisionDetected?1:0)}const ws=_.projection.name!=="globe";Be=Be&&(ws||!pt),je=je&&(ws||!Yt),this.placements[mt]=new Gn(Oe||Be,Ze||je,ut||_.justReloaded),s[mt]=!0};if(ke){const Ne=_.getSortedSymbolIndexes(this.transform.angle);for(let st=Ne.length-1;st>=0;--st){const He=Ne[st];Tt(_.symbolInstances.get(He),He,_.collisionArrays[He])}}else for(let Ne=n.symbolInstanceStart;Ne<n.symbolInstanceEnd;Ne++)Tt(_.symbolInstances.get(Ne),Ne,_.collisionArrays[Ne]);if(h&&_.bucketInstanceId in this.collisionCircleArrays){const Ne=this.collisionCircleArrays[_.bucketInstanceId];o.invert(Ne.invProjMatrix,E),Ne.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(n,s,h,p){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:b,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:S,crossTileID:O}=h,R=o.getAnchorJustification(s),U=p===o.WritingMode.vertical?S:R==="left"?_:R==="center"?b:R==="right"?E:-1;_>=0&&(n.text.placedSymbolArray.get(_).crossTileID=U>=0&&_!==U?0:O),b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=U>=0&&b!==U?0:O),E>=0&&(n.text.placedSymbolArray.get(E).crossTileID=U>=0&&E!==U?0:O),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=U>=0&&S!==U?0:O)}markUsedOrientation(n,s,h){const p=s===o.WritingMode.horizontal||s===o.WritingMode.horizontalOnly?s:0,_=s===o.WritingMode.vertical?s:0,{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:O}=h,R=n.text.placedSymbolArray;b>=0&&(R.get(b).placedOrientation=p),E>=0&&(R.get(E).placedOrientation=p),S>=0&&(R.get(S).placedOrientation=p),O>=0&&(R.get(O).placedOrientation=_)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(n):1,_=s?s.opacities:{},b=s?s.variableOffsets:{},E=s?s.placedOrientations:{};for(const S in this.placements){const O=this.placements[S],R=_[S];R?(this.opacities[S]=new gi(R,p,O.text,O.icon,null,O.clipped),h=h||O.text!==R.text.placed||O.icon!==R.icon.placed):(this.opacities[S]=new gi(null,p,O.text,O.icon,O.skipFade,O.clipped),h=h||O.text||O.icon)}for(const S in _){const O=_[S];if(!this.opacities[S]){const R=new gi(O,p,!1,!1);R.isHidden()||(this.opacities[S]=R,h=h||O.text.placed||O.icon.placed)}}for(const S in b)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=b[S]);for(const S in E)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=E[S]);h?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:n)}updateLayerOpacities(n,s){const h={};for(const p of s){const _=p.getBucket(n);_&&p.latestFeatureIndex&&n.id===_.layerIds[0]&&this.updateBucketOpacities(_,h,p.collisionBoxArray)}}updateBucketOpacities(n,s,h){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const p=n.layers[0].layout,_=!!n.layers[0].dynamicFilter(),b=new gi(null,0,!1,!1,!0),E=p.get("text-allow-overlap"),S=p.get("icon-allow-overlap"),O=p.get("text-variable-anchor"),R=p.get("text-rotation-alignment")==="map",U=p.get("text-pitch-alignment")==="map",$=p.get("icon-text-fit")!=="none",J=new gi(null,0,E&&(S||!n.hasIconData()||p.get("icon-optional")),S&&(E||!n.hasTextData()||p.get("text-optional")),!0);!n.collisionArrays&&h&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(h);const Y=(ee,W,ae)=>{for(let oe=0;oe<W/4;oe++)ee.opacityVertexArray.emplaceBack(ae)};let Q=0;for(let ee=0;ee<n.symbolInstances.length;ee++){const W=n.symbolInstances.get(ee),{numHorizontalGlyphVertices:ae,numVerticalGlyphVertices:oe,crossTileID:le,numIconVertices:ve}=W;let ge=this.opacities[le];s[le]?ge=b:ge||(ge=J,this.opacities[le]=ge),s[le]=!0;const we=ae>0||oe>0,ke=ve>0,Be=this.placedOrientations[le],je=Be===o.WritingMode.vertical,Tt=Be===o.WritingMode.horizontal||Be===o.WritingMode.horizontalOnly;if(!we&&!ke||ge.isHidden()||Q++,we){const Ne=ul(ge.text);Y(n.text,ae,je?Ua:Ne),Y(n.text,oe,Tt?Ua:Ne);const st=ge.text.isHidden(),{leftJustifiedTextSymbolIndex:He,centerJustifiedTextSymbolIndex:mt,rightJustifiedTextSymbolIndex:Ve,verticalPlacedTextSymbolIndex:Oe}=W,Ze=n.text.placedSymbolArray,ut=st||je?1:0;He>=0&&(Ze.get(He).hidden=ut),mt>=0&&(Ze.get(mt).hidden=ut),Ve>=0&&(Ze.get(Ve).hidden=ut),Oe>=0&&(Ze.get(Oe).hidden=st||Tt?1:0);const pt=this.variableOffsets[le];pt&&this.markUsedJustification(n,pt.anchor,W,Be);const Yt=this.placedOrientations[le];Yt&&(this.markUsedJustification(n,"left",W,Yt),this.markUsedOrientation(n,Yt,W))}if(ke){const Ne=ul(ge.icon),{placedIconSymbolIndex:st,verticalPlacedIconSymbolIndex:He}=W,mt=n.icon.placedSymbolArray,Ve=ge.icon.isHidden()?1:0;st>=0&&(Y(n.icon,ve,je?Ua:Ne),mt.get(st).hidden=Ve),He>=0&&(Y(n.icon,W.numVerticalIconVertices,Tt?Ua:Ne),mt.get(He).hidden=Ve)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Ne=n.collisionArrays[ee];if(Ne){let st=new o.pointGeometry(0,0),He=!0;if(Ne.textBox||Ne.verticalTextBox){if(O){const Ve=this.variableOffsets[le];Ve?(st=fr(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textScale),R&&st._rotate(U?this.transform.angle:-this.transform.angle)):He=!1}_&&(He=!ge.clipped),Ne.textBox&&uo(n.textCollisionBox.collisionVertexArray,ge.text.placed,!He||je,st.x,st.y),Ne.verticalTextBox&&uo(n.textCollisionBox.collisionVertexArray,ge.text.placed,!He||Tt,st.x,st.y)}const mt=He&&!!(!Tt&&Ne.verticalIconBox);Ne.iconBox&&uo(n.iconCollisionBox.collisionVertexArray,ge.icon.placed,mt,$?st.x:0,$?st.y:0),Ne.verticalIconBox&&uo(n.iconCollisionBox.collisionVertexArray,ge.icon.placed,!mt,$?st.x:0,$?st.y:0)}}}if(n.fullyClipped=Q===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=ee.invProjMatrix,n.placementViewportMatrix=ee.viewportMatrix,n.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>n}setStale(){this.stale=!0}}function uo(c,n,s,h,p){c.emplaceBack(n?1:0,s?1:0,h||0,p||0),c.emplaceBack(n?1:0,s?1:0,h||0,p||0),c.emplaceBack(n?1:0,s?1:0,h||0,p||0),c.emplaceBack(n?1:0,s?1:0,h||0,p||0)}const jn=Math.pow(2,25),Ul=Math.pow(2,24),wr=Math.pow(2,17),ho=Math.pow(2,16),vc=Math.pow(2,9),cl=Math.pow(2,8),Fr=Math.pow(2,1);function ul(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const n=c.placed?1:0,s=Math.floor(127*c.opacity);return s*jn+n*Ul+s*wr+n*ho+s*vc+n*cl+s*Fr+n}const Ua=0;class ln{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,s,h,p,_){const b=this._bucketParts;for(;this._currentTileIndex<n.length;)if(s.getBucketParts(b,p,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((E,S)=>E.sortKey-S.sortKey));this._currentPartIndex<b.length;){const E=b[this._currentPartIndex];if(s.placeLayerBucketPart(E,this._seenCrossTileIDs,h,E.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class Sn{constructor(n,s,h,p,_,b,E,S){this.placement=new Zr(n,_,b,E,S),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(n,s,h){const p=o.exported.now(),_=()=>{const b=o.exported.now()-p;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=s[n[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=E)&&(!b.maxzoom||b.maxzoom>E)){if(this._inProgressLayer||(this._inProgressLayer=new ln(b)),this._inProgressLayer.continuePlacement(h[b.source],this.placement,this._showCollisionBoxes,b,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const xc=512/o.EXTENT/2;class dh{constructor(n,s,h){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let p=0;p<s.length;p++){const _=s.get(p),b=_.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,n)})}}getScaledCoordinates(n,s){const h=xc/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*o.EXTENT+n.tileAnchorX)*h),y:Math.floor((s.canonical.y*o.EXTENT+n.tileAnchorY)*h)}}findMatches(n,s,h){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let _=0;_<n.length;_++){const b=n.get(_);if(b.crossTileID)continue;const E=this.indexedSymbolInstances[b.key];if(!E)continue;const S=this.getScaledCoordinates(b,s);for(const O of E)if(Math.abs(O.coord.x-S.x)<=p&&Math.abs(O.coord.y-S.y)<=p&&!h[O.crossTileID]){h[O.crossTileID]=!0,b.crossTileID=O.crossTileID;break}}}}class bc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Va{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const s=Math.round((n-this.lng)/360);if(s!==0)for(const h in this.indexes){const p=this.indexes[h],_={};for(const b in p){const E=p[b];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+s),_[E.tileID.key]=E}this.indexes[h]=_}this.lng=n}addBucket(n,s,h){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const p=this.usedCrossTileIDs[n.overscaledZ];for(const _ in this.indexes){const b=this.indexes[_];if(Number(_)>n.overscaledZ)for(const E in b){const S=b[E];S.tileID.isChildOf(n)&&S.findMatches(s.symbolInstances,n,p)}else{const E=b[n.scaledTo(Number(_)).key];E&&E.findMatches(s.symbolInstances,n,p)}}for(let _=0;_<s.symbolInstances.length;_++){const b=s.symbolInstances.get(_);b.crossTileID||(b.crossTileID=h.generate(),p[b.crossTileID]=!0)}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new dh(n,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(n,s){for(const h in s.indexedSymbolInstances)for(const p of s.indexedSymbolInstances[h])delete this.usedCrossTileIDs[n][p.crossTileID]}removeStaleBuckets(n){let s=!1;for(const h in this.indexes){const p=this.indexes[h];for(const _ in p)n[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,p[_]),delete p[_],s=!0)}return s}}class Jc{constructor(){this.layerIndexes={},this.crossTileIDs=new bc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,s,h,p){let _=this.layerIndexes[n.id];_===void 0&&(_=this.layerIndexes[n.id]=new Va);let b=!1;const E={};p.name!=="globe"&&_.handleWrapJump(h);for(const S of s){const O=S.getBucket(n);O&&n.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(S.tileID,O,this.crossTileIDs)&&(b=!0),E[O.bucketInstanceId]=!0)}return _.removeStaleBuckets(E)&&(b=!0),b}pruneUnusedLayers(n){const s={};n.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const Vl=(c,n)=>o.emitValidationErrors(c,n&&n.filter(s=>s.identifier!=="source.canvas")),Ga=o.pick(li,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),as=o.pick(li,["setCenter","setZoom","setBearing","setPitch"]),ar={version:8,layers:[],sources:{}},ls={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Bn extends o.Evented{constructor(n,s={}){super(),this.map=n,this.dispatcher=new or(ai(),this),this.imageManager=new qt,this.imageManager.setEventedParent(this),this.glyphManager=new o.GlyphManager(n._requestManager,s.localFontFamily?o.LocalGlyphMode.all:s.localIdeographFontFamily?o.LocalGlyphMode.ideographs:o.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.crossTileSymbolIndex=new Jc,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.getReferrer());const h=this;this._rtlTextPluginCallback=Bn.registerForPluginStateChange(p=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(_,b)=>{if(o.triggerPluginCompletionEvent(_),b&&b.every(E=>E))for(const E in h._sourceCaches){const S=h._sourceCaches[E],O=S.getSource().type;O!=="vector"&&O!=="geojson"||S.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const _=this.getSource(p.sourceId);if(_&&_.vectorLayerIds)for(const b in this._layers){const E=this._layers[b];E.source===_.id&&this._validateLayer(E)}})}loadURL(n,s={}){this.fire(new o.Event("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!o.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,s.accessToken);const p=this.map._requestManager.transformRequest(n,o.ResourceType.Style);this._request=o.getJSON(p,(_,b)=>{this._request=null,_?this.fire(new o.ErrorEvent(_)):b&&this._load(b,h)})}loadJSON(n,s={}){this.fire(new o.Event("dataloading",{dataType:"style"})),this._request=o.exported.frame(()=>{this._request=null,this._load(n,s.validate!==!1)})}loadEmpty(){this.fire(new o.Event("dataloading",{dataType:"style"})),this._load(ar,!1)}_updateLayerCount(n,s){const h=s?1:-1;n.is3D()&&(this._num3DLayers+=h),n.type==="circle"&&(this._numCircleLayers+=h),n.type==="symbol"&&(this._numSymbolLayers+=h)}_load(n,s){if(s&&Vl(this,o.validateStyle(n)))return;this._loaded=!0,this.stylesheet=o.clone$1(n),this._updateMapProjection();for(const p in n.sources)this.addSource(p,n.sources[p],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const h=Hi(this.stylesheet.layers);this._order=h.map(p=>p.id),this._layers={},this._serializedLayers={};for(let p of h)p=o.createStyleLayer(p),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize(),this._updateLayerCount(p,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new fn(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new o.Event("data",{dataType:"style"})),this.fire(new o.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(s,h,p){let _,b,E;const S=o.exported.devicePixelRatio>1?"@2x":"";let O=o.getJSON(h.transformRequest(h.normalizeSpriteURL(s,S,".json"),o.ResourceType.SpriteJSON),($,J)=>{O=null,E||(E=$,_=J,U())}),R=o.getImage(h.transformRequest(h.normalizeSpriteURL(s,S,".png"),o.ResourceType.SpriteImage),($,J)=>{R=null,E||(E=$,b=J,U())});function U(){if(E)p(E);else if(_&&b){const $=o.exported.getImageData(b),J={};for(const Y in _){const{width:Q,height:ee,x:W,y:ae,sdf:oe,pixelRatio:le,stretchX:ve,stretchY:ge,content:we}=_[Y],ke=new o.RGBAImage({width:Q,height:ee});o.RGBAImage.copy($,ke,{x:W,y:ae},{x:0,y:0},{width:Q,height:ee}),J[Y]={data:ke,pixelRatio:le,sdf:oe,stretchX:ve,stretchY:ge,content:we}}p(null,J)}}return{cancel(){O&&(O.cancel(),O=null),R&&(R.cancel(),R=null)}}}(n,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new o.ErrorEvent(s));else if(h)for(const p in h)this.imageManager.addImage(p,h[p]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new o.Event("data",{dataType:"style"}))})}_validateLayer(n){const s=this.getSource(n.source);if(!s)return;const h=n.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new o.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const s=[];for(const h of n){const p=this._layers[h];p.type!=="custom"&&s.push(p.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped():ls[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const s=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(p.length||_.length)&&this._updateWorkerLayers(p,_);for(const b in this._updatedSources){const E=this._updatedSources[b];E==="reload"?this._reloadSource(b):E==="clear"&&this._clearSource(b)}this._updateTilesForChangedImages();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const h={};for(const p in this._sourceCaches){const _=this._sourceCaches[p];h[p]=_.used,_.used=!1}for(const p of this._order){const _=this._layers[p];if(_.recalculate(n,this._availableImages),!_.isHidden(n.zoom)){const E=this._getLayerSourceCache(_);E&&(E.used=!0)}const b=this.map.painter;if(b){const E=_.getProgramIds();if(!E)continue;const S=_.getProgramConfiguration(n.zoom);for(const O of E)b.useProgram(O,S)}}for(const p in h){const _=this._sourceCaches[p];h[p]!==_.used&&_.getSource().fire(new o.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new o.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Vl(this,o.validateStyle(n)))return!1;(n=o.clone$1(n)).layers=Hi(n.layers);const s=function(p,_){if(!p)return[{command:li.setStyle,args:[_]}];let b=[];try{if(!B(p.version,_.version))return[{command:li.setStyle,args:[_]}];B(p.center,_.center)||b.push({command:li.setCenter,args:[_.center]}),B(p.zoom,_.zoom)||b.push({command:li.setZoom,args:[_.zoom]}),B(p.bearing,_.bearing)||b.push({command:li.setBearing,args:[_.bearing]}),B(p.pitch,_.pitch)||b.push({command:li.setPitch,args:[_.pitch]}),B(p.sprite,_.sprite)||b.push({command:li.setSprite,args:[_.sprite]}),B(p.glyphs,_.glyphs)||b.push({command:li.setGlyphs,args:[_.glyphs]}),B(p.transition,_.transition)||b.push({command:li.setTransition,args:[_.transition]}),B(p.light,_.light)||b.push({command:li.setLight,args:[_.light]}),B(p.fog,_.fog)||b.push({command:li.setFog,args:[_.fog]}),B(p.projection,_.projection)||b.push({command:li.setProjection,args:[_.projection]});const E={},S=[];(function(U,$,J,Y){let Q;for(Q in $=$||{},U=U||{})U.hasOwnProperty(Q)&&($.hasOwnProperty(Q)||Wi(Q,J,Y));for(Q in $)$.hasOwnProperty(Q)&&(U.hasOwnProperty(Q)?B(U[Q],$[Q])||(U[Q].type==="geojson"&&$[Q].type==="geojson"&&co(U,$,Q)?J.push({command:li.setGeoJSONSourceData,args:[Q,$[Q].data]}):rs(Q,$,J,Y)):Vi(Q,$,J))})(p.sources,_.sources,S,E);const O=[];p.layers&&p.layers.forEach(U=>{U.source&&E[U.source]?b.push({command:li.removeLayer,args:[U.id]}):O.push(U)});let R=p.terrain;R&&E[R.source]&&(b.push({command:li.setTerrain,args:[void 0]}),R=void 0),b=b.concat(S),B(R,_.terrain)||b.push({command:li.setTerrain,args:[_.terrain]}),function(U,$,J){$=$||[];const Y=(U=U||[]).map(os),Q=$.map(os),ee=U.reduce(sr,{}),W=$.reduce(sr,{}),ae=Y.slice(),oe=Object.create(null);let le,ve,ge,we,ke,Be,je;for(le=0,ve=0;le<Y.length;le++)ge=Y[le],W.hasOwnProperty(ge)?ve++:(J.push({command:li.removeLayer,args:[ge]}),ae.splice(ae.indexOf(ge,ve),1));for(le=0,ve=0;le<Q.length;le++)ge=Q[Q.length-1-le],ae[ae.length-1-le]!==ge&&(ee.hasOwnProperty(ge)?(J.push({command:li.removeLayer,args:[ge]}),ae.splice(ae.lastIndexOf(ge,ae.length-ve),1)):ve++,Be=ae[ae.length-le],J.push({command:li.addLayer,args:[W[ge],Be]}),ae.splice(ae.length-le,0,ge),oe[ge]=!0);for(le=0;le<Q.length;le++)if(ge=Q[le],we=ee[ge],ke=W[ge],!oe[ge]&&!B(we,ke))if(B(we.source,ke.source)&&B(we["source-layer"],ke["source-layer"])&&B(we.type,ke.type)){for(je in Ye(we.layout,ke.layout,J,ge,null,li.setLayoutProperty),Ye(we.paint,ke.paint,J,ge,null,li.setPaintProperty),B(we.filter,ke.filter)||J.push({command:li.setFilter,args:[ge,ke.filter]}),B(we.minzoom,ke.minzoom)&&B(we.maxzoom,ke.maxzoom)||J.push({command:li.setLayerZoomRange,args:[ge,ke.minzoom,ke.maxzoom]}),we)we.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Ye(we[je],ke[je],J,ge,je.slice(6),li.setPaintProperty):B(we[je],ke[je])||J.push({command:li.setLayerProperty,args:[ge,je,ke[je]]}));for(je in ke)ke.hasOwnProperty(je)&&!we.hasOwnProperty(je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Ye(we[je],ke[je],J,ge,je.slice(6),li.setPaintProperty):B(we[je],ke[je])||J.push({command:li.setLayerProperty,args:[ge,je,ke[je]]}))}else J.push({command:li.removeLayer,args:[ge]}),Be=ae[ae.lastIndexOf(ge)+1],J.push({command:li.addLayer,args:[ke,Be]})}(O,_.layers,b)}catch(E){console.warn("Unable to compute style diff:",E),b=[{command:li.setStyle,args:[_]}]}return b}(this.serialize(),n).filter(p=>!(p.command in as));if(s.length===0)return!1;const h=s.filter(p=>!(p.command in Ga));if(h.length>0)throw new Error(`Unimplemented: ${h.map(p=>p.command).join(", ")}.`);return s.forEach(p=>{p.command!=="setTransition"&&p.command!=="setProjection"&&this[p.command].apply(this,p.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,s){return this.getImage(n)?this.fire(new o.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,s),this._afterImageUpdated(n),this)}updateImage(n,s){this.imageManager.updateImage(n,s)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new o.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,s,h={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(o.validateSource,`sources.${n}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=Me(n,s,this.dispatcher,this);p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:p.serialize(),sourceId:n}));const _=b=>{const E=(b?"symbol:":"other:")+n,S=this._sourceCaches[E]=new o.SourceCache(E,p,b);(b?this._symbolSourceCaches:this._otherSourceCaches)[n]=S,S.style=this,S.onAdd(this.map)};_(!1),s.type!=="vector"&&s.type!=="geojson"||_(!0),p.onAdd&&p.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const s=this.getSource(n);if(!s)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new o.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const h=this._getSourceCaches(n);for(const p of h)delete this._sourceCaches[p.id],delete this._updatedSources[p.id],p.fire(new o.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,s){this._checkLoaded(),this.getSource(n).setData(s),this._changed=!0}getSource(n){const s=this._getSourceCache(n);return s&&s.getSource()}_getSources(){const n=[];for(const s in this._otherSourceCaches){const h=this._getSourceCache(s);h&&n.push(h.getSource())}return n}addLayer(n,s,h={}){this._checkLoaded();const p=n.id;if(this.getLayer(p))return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${p}" already exists on this map`)));let _;if(n.type==="custom"){if(Vl(this,o.validateCustomStyleLayer(n)))return;_=o.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(p,n.source),n=o.clone$1(n),n=o.extend(n,{source:p})),this._validate(o.validateLayer,`layers.${p}`,n,{arrayIndex:-1},h))return;_=o.createStyleLayer(n),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const b=s?this._order.indexOf(s):this._order.length;if(s&&b===-1)return void this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(b,0,p),this._layerOrderChanged=!0,this._layers[p]=_;const E=this._getLayerSourceCache(_);if(this._removedLayers[p]&&_.source&&E&&_.type!=="custom"){const S=this._removedLayers[p];delete this._removedLayers[p],S.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",E.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,s){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===s)return;const h=this._order.indexOf(n);this._order.splice(h,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new o.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(p,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const s=this._layers[n];if(!s)return void this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const h=this._order.indexOf(n);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=s,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const s in this._layers)if(this._layers[s].type===n)return!0;return!1}setLayerZoomRange(n,s,h){this._checkLoaded();const p=this.getLayer(n);p?p.minzoom===s&&p.maxzoom===h||(s!=null&&(p.minzoom=s),h!=null&&(p.maxzoom=h),this._updateLayer(p)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,s,h={}){this._checkLoaded();const p=this.getLayer(n);if(p){if(!B(p.filter,s))return s==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(o.validateFilter,`layers.${p.id}.filter`,s,{layerType:p.type},h)||(p.filter=o.clone$1(s),this._updateLayer(p)))}else this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const s=this.getLayer(n);return s&&o.clone$1(s.filter)}setLayoutProperty(n,s,h,p={}){this._checkLoaded();const _=this.getLayer(n);_?B(_.getLayoutProperty(s),h)||(_.setLayoutProperty(s,h,p),this._updateLayer(_)):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,s){const h=this.getLayer(n);if(h)return h.getLayoutProperty(s);this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,s,h,p={}){this._checkLoaded();const _=this.getLayer(n);_?B(_.getPaintProperty(s),h)||(_.setPaintProperty(s,h,p)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new o.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,s){const h=this.getLayer(n);return h&&h.getPaintProperty(s)}setFeatureState(n,s){this._checkLoaded();const h=n.source,p=n.sourceLayer,_=this.getSource(h);if(!_)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const b=_.type;if(b==="geojson"&&p)return void this.fire(new o.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(b==="vector"&&!p)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided.")));const E=this._getSourceCaches(h);for(const S of E)S.setFeatureState(p,n.id,s)}removeFeatureState(n,s){this._checkLoaded();const h=n.source,p=this.getSource(h);if(!p)return void this.fire(new o.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const _=p.type,b=_==="vector"?n.sourceLayer:void 0;if(_==="vector"&&!b)return void this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new o.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const E=this._getSourceCaches(h);for(const S of E)S.removeFeatureState(b,n.id,s)}getFeatureState(n){this._checkLoaded();const s=n.source,h=n.sourceLayer,p=this.getSource(s);if(p){if(p.type!=="vector"||h)return n.id===void 0&&this.fire(new o.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(h,n.id);this.fire(new o.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new o.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return o.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();n[h.id]||(n[h.id]=h.serialize())}return o.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const s=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",s.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const s=b=>this._layers[b].type==="fill-extrusion",h={},p=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(s(E)){h[E]=b;for(const S of n){const O=S[E];if(O)for(const R of O)p.push(R)}}}p.sort((b,E)=>E.intersectionZ-b.intersectionZ);const _=[];for(let b=this._order.length-1;b>=0;b--){const E=this._order[b];if(s(E))for(let S=p.length-1;S>=0;S--){const O=p[S].feature;if(h[O.layer.id]<b)break;_.push(O),p.pop()}else for(const S of n){const O=S[E];if(O)for(const R of O)_.push(R.feature)}}return _}queryRenderedFeatures(n,s,h){s&&s.filter&&this._validate(o.validateFilter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const S of s.layers){const O=this._layers[S];if(!O)return this.fire(new o.ErrorEvent(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];p[O.source]=!0}}const _=[];s.availableImages=this._availableImages;const b=s&&s.layers?s.layers.some(S=>{const O=this.getLayer(S);return O&&O.is3D()}):this.has3DLayers(),E=no.createFromScreenPoints(n,h);for(const S in this._sourceCaches){const O=this._sourceCaches[S].getSource().id;s.layers&&!p[O]||_.push(Ue(this._sourceCaches[S],this._layers,this._serializedLayers,E,s,h,b,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(S,O,R,U,$,J,Y){const Q={},ee=J.queryRenderedSymbols(U),W=[];for(const ae of Object.keys(ee).map(Number))W.push(Y[ae]);W.sort(Dt);for(const ae of W){const oe=ae.featureIndex.lookupSymbolFeatures(ee[ae.bucketInstanceId],O,ae.bucketIndex,ae.sourceLayerIndex,$.filter,$.layers,$.availableImages,S);for(const le in oe){const ve=Q[le]=Q[le]||[],ge=oe[le];ge.sort((we,ke)=>{const Be=ae.featureSortOrder;if(Be){const je=Be.indexOf(we.featureIndex);return Be.indexOf(ke.featureIndex)-je}return ke.featureIndex-we.featureIndex});for(const we of ge)ve.push(we)}}for(const ae in Q)Q[ae].forEach(oe=>{const le=oe.feature,ve=R(S[ae]).getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=ve});return Q}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),E.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(n,s){s&&s.filter&&this._validate(o.validateFilter,"querySourceFeatures.filter",s.filter,null,s);const h=this._getSourceCaches(n);let p=[];for(const _ of h)p=p.concat(ht(_,s));return p}addSourceType(n,s,h){return Bn.getSourceType(n)?h(new Error(`A source type called "${n}" already exists.`)):(Bn.setSourceType(n,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:s.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(n,s={}){this._checkLoaded();const h=this.light.getLight();let p=!1;for(const b in n)if(!B(n[b],h[b])){p=!0;break}if(!p)return;const _=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,s),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,s=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(s===1){if(typeof n.source=="object"){const h="terrain-dem-src";this.addSource(h,n.source),n=o.clone$1(n),n=o.extend(n,{source:h})}if(this._validate(o.validateTerrain,"terrain",n))return}if(!this.terrain||this.terrain&&s!==this.terrain.drapeRenderMode)this._createTerrain(n,s);else{const h=this.terrain,p=h.get();for(const _ of Object.keys(o.spec.terrain))!n.hasOwnProperty(_)&&o.spec.terrain[_].default&&(n[_]=o.spec.terrain[_].default);for(const _ in n)if(!B(n[_],p[_])){h.set(n),this.stylesheet.terrain=n;const b=this._setTransitionParameters({duration:0});h.updateTransitions(b);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const s=this.fog=new Wr(n,this.map.transform);this.stylesheet.fog=n;const h=this._setTransitionParameters({duration:0});s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,h=s.get();Object.keys(n).length===0&&s.set(n);for(const p in n)if(!B(n[p],h[p])){s.set(n),this.stylesheet.fog=n;const _=this._setTransitionParameters({duration:0});s.updateTransitions(_);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:o.exported.now(),transition:o.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(h=>this.isLayerDraped(this._layers[h])),s=this._order.filter(h=>!this.isLayerDraped(this._layers[h]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...s)}_createTerrain(n,s){const h=this.terrain=new pn(n,s);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const p=this._setTransitionParameters({duration:0});h.updateTransitions(p)}_force3DLayerUpdate(){for(const n in this._layers){const s=this._layers[n];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const s=this._layers[n];s.type==="symbol"&&this._updateLayer(s)}}_validate(n,s,h,p,_={}){return(!_||_.validate!==!1)&&Vl(this,n.call(o.validateStyle,o.extend({key:s,style:this.serialize(),value:h,styleSpec:o.spec},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const s=this._getSourceCaches(n);for(const h of s)h.clearTiles()}_reloadSource(n){const s=this._getSourceCaches(n);for(const h of s)h.resume(),h.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const s in this._sourceCaches)this._sourceCaches[s].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const s=this._sourceCaches[n];s.resume(),s.reload()}}_updatePlacement(n,s,h,p,_=!1){let b=!1,E=!1;const S={};for(const O of this._order){const R=this._layers[O];if(R.type!=="symbol")continue;if(!S[R.source]){const $=this._getLayerSourceCache(R);if(!$)continue;S[R.source]=$.getRenderableIds(!0).map(J=>$.getTileByID(J)).sort((J,Y)=>Y.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(Y.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(R,S[R.source],n.center.lng,n.projection);b=b||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||h===0,this._layerOrderChanged&&this.fire(new o.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.exported.now(),n.zoom))&&(this.pauseablePlacement=new Sn(n,this._order,_,s,h,p,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.exported.now()),E=!0),b&&this.pauseablePlacement.placement.setStale()),E||b)for(const O of this._order){const R=this._layers[O];R.type==="symbol"&&this.placement.updateLayerOpacities(R,S[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,s,h){this.imageManager.getImages(s.icons,h),this._updateTilesForChangedImages();const p=_=>{_&&_.setDependencies(s.tileID.key,s.type,s.icons)};p(this._otherSourceCaches[s.source]),p(this._symbolSourceCaches[s.source])}getGlyphs(n,s,h){this.glyphManager.getGlyphs(s.stacks,h)}getResource(n,s,h){return o.makeRequest(s,h)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const s=[];return this._otherSourceCaches[n]&&s.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&s.push(this._symbolSourceCaches[n]),s}_isSourceCacheLoaded(n){const s=this._getSourceCaches(n);return s.length===0?(this.fire(new o.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Bn.getSourceType=function(c){return ze[c]},Bn.setSourceType=function(c,n){ze[c]=n},Bn.registerForPluginStateChange=o.registerForPluginStateChange;var ja=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Gl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Co=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,hl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,dl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let jl={},Wl={};const Wa=[];Vs(ja,Wa),Vs(Co,Wa),Vs(hl,Wa),Vs(dl,Wa),jl=$i("",Co),Wl=$i(dl,hl);const Us=$i(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Hr=ja,wc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var bo={background:$i(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:$i(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:$i(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:$i("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:$i(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:$i(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:$i("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:$i("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:$i("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:$i(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:$i(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:$i(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:$i(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:$i(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:$i(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:$i(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:$i(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:$i(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:$i(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:$i(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:$i(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:$i(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:$i(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:$i(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:$i(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:$i(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Gl),skyboxGradient:$i(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Gl),skyboxCapture:$i(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:$i(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:$i(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Vs(c,n){const s=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of s)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=h.split(" ");for(const _ of p)n.includes(_)||n.push(_)}}function $i(c,n){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),p={},_=[...Wa];return Vs(c,_),Vs(n,_),{fragmentSource:c=c.replace(s,(b,E,S,O,R)=>(p[R]=!0,E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
varying ${S} ${O} ${R};
#else
uniform ${S} ${O} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${S} ${O} ${R} = u_${R};
#endif
`)),vertexSource:n=n.replace(s,(b,E,S,O,R)=>{const U=O==="float"?"vec2":"vec4",$=R.match(/color/)?"color":U;return p[R]?E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${S} ${U} a_${R};
varying ${S} ${O} ${R};
#else
uniform ${S} ${O} u_${R};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${S} ${O} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${$}(a_${R}, u_${R}_t);
#else
    ${S} ${O} ${R} = u_${R};
#endif
`:E==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${S} ${U} a_${R};
#else
uniform ${S} ${O} u_${R};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${S} ${O} ${R} = a_${R};
#else
    ${S} ${O} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${S} ${O} ${R} = unpack_mix_${$}(a_${R}, u_${R}_t);
#else
    ${S} ${O} ${R} = u_${R};
#endif
`}),staticAttributes:h,usedDefines:_}}class wo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,s,h,p,_,b,E){this.context=n;let S=this.boundPaintVertexBuffers.length!==p.length;for(let R=0;!S&&R<p.length;R++)this.boundPaintVertexBuffers[R]!==p[R]&&(S=!0);let O=this.boundDynamicVertexBuffers.length!==E.length;for(let R=0;!O&&R<E.length;R++)this.boundDynamicVertexBuffers[R]!==E[R]&&(O=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||S||O||this.boundIndexBuffer!==_||this.boundVertexOffset!==b)this.freshBind(s,h,p,_,b,E);else{n.bindVertexArrayOES.set(this.vao);for(const R of E)R&&R.bind();_&&_.dynamicDraw&&_.bind()}}freshBind(n,s,h,p,_,b){let E;const S=n.numAttributes,O=this.context,R=O.gl;if(O.extVertexArrayObject)this.vao&&this.destroy(),this.vao=O.extVertexArrayObject.createVertexArrayOES(),O.bindVertexArrayOES.set(this.vao),E=0,this.boundProgram=n,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=b;else{E=O.currentNumAttributes||0;for(let U=S;U<E;U++)R.disableVertexAttribArray(U)}s.enableAttributes(R,n),s.bind(),s.setVertexAttribPointers(R,n,_);for(const U of h)U.enableAttributes(R,n),U.bind(),U.setVertexAttribPointers(R,n,_);for(const U of b)U&&(U.enableAttributes(R,n),U.bind(),U.setVertexAttribPointers(R,n,_));p&&p.bind(),O.currentNumAttributes=S}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function da(c,n){const s=Math.pow(2,n.canonical.z),h=n.canonical.y;return[new o.MercatorCoordinate(0,h/s).toLngLat().lat,new o.MercatorCoordinate(0,(h+1)/s).toLngLat().lat]}function Gs(c,n,s,h,p,_,b){const E=c.context,S=E.gl,O=s.fbo;if(!O)return;c.prepareDrawTile();const R=c.useProgram("hillshade");E.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,O.colorAttachment.get());const U=((Q,ee,W,ae)=>{const oe=W.paint.get("hillshade-shadow-color"),le=W.paint.get("hillshade-highlight-color"),ve=W.paint.get("hillshade-accent-color");let ge=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);W.paint.get("hillshade-illumination-anchor")==="viewport"&&(ge-=Q.transform.angle);const we=!Q.options.moving;return{u_matrix:ae||Q.transform.calculateProjMatrix(ee.tileID.toUnwrapped(),we),u_image:0,u_latrange:da(0,ee.tileID),u_light:[W.paint.get("hillshade-exaggeration"),ge],u_shadow:oe,u_highlight:le,u_accent:ve}})(c,s,h,c.terrain?n.projMatrix:null);c.prepareDrawProgram(E,R,n.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:J,tileBoundsSegments:Y}=c.getTileBoundsBuffers(s);R.draw(E,S.TRIANGLES,p,_,b,o.CullFaceMode.disabled,U,h.id,$,J,Y)}function mn(c,n,s){if(!n.needsDEMTextureUpload)return;const h=c.context,p=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||c.getTileTexture(s.stride);const _=s.getPixels();n.demTexture?n.demTexture.update(_,{premultiply:!1}):n.demTexture=new o.Texture(h,_,p.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function cs(c,n,s,h,p,_){const b=c.context,E=b.gl;if(!n.dem)return;const S=n.dem;if(b.activeTexture.set(E.TEXTURE1),mn(c,n,S),!n.demTexture)return;n.demTexture.bind(E.NEAREST,E.CLAMP_TO_EDGE);const O=S.dim;b.activeTexture.set(E.TEXTURE0);let R=n.fbo;if(!R){const Y=new o.Texture(b,{width:O,height:O,data:null},E.RGBA);Y.bind(E.LINEAR,E.CLAMP_TO_EDGE),R=n.fbo=b.createFramebuffer(O,O,!0),R.colorAttachment.set(Y.texture)}b.bindFramebuffer.set(R.framebuffer),b.viewport.set([0,0,O,O]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:$,tileBoundsSegments:J}=c.getMercatorTileBoundsBuffers();c.useProgram("hillshadePrepare").draw(b,E.TRIANGLES,h,p,_,o.CullFaceMode.disabled,((Y,Q)=>{const ee=Q.stride,W=o.create();return o.ortho(W,0,o.EXTENT,-o.EXTENT,0,0,1),o.translate(W,W,[0,-o.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[ee,ee],u_zoom:Y.overscaledZ,u_unpack:Q.unpackVector}})(n.tileID,S),s.id,U,$,J),n.needsHillshadePrepare=!1}const fl=c=>({u_matrix:new o.UniformMatrix4f(c),u_image0:new o.Uniform1i(c),u_skirt_height:new o.Uniform1f(c)}),Qc=(c,n)=>({u_matrix:c,u_image0:0,u_skirt_height:n}),pl=(c,n,s,h,p,_,b,E,S,O,R,U,$,J,Y)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:s,u_zoom_transition:p,u_merc_center:_,u_image0:0,u_frustum_tl:b,u_frustum_tr:E,u_frustum_br:S,u_frustum_bl:O,u_globe_pos:R,u_globe_radius:U,u_viewport:$,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:J});function eu(c,n){return c!=null&&n!=null&&!(!c.hasData()||!n.hasData())&&c.demTexture!=null&&n.demTexture!=null&&c.tileID.key!==n.tileID.key}const js=new class{constructor(){this.operations={}}newMorphing(c,n,s,h,p){if(c in this.operations){const _=this.operations[c];_.to.tileID.key!==s.tileID.key&&(_.queued=s)}else this.operations[c]={startTime:h,phase:0,duration:p,from:n,to:s,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const n=this.operations[c];return{from:n.from,to:n.to,phase:n.phase}}update(c){for(const n in this.operations){const s=this.operations[n];for(s.phase=(c-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,c)){delete this.operations[n];break}}}_nextOp(c,n){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=n,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},Ws={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function us(c){return 6*Math.pow(1.5,22-c)}function To(c,n){const s=1<<c.z;return!n&&(c.x===0||c.x===s-1)||c.y===0||c.y===s-1}const Ei=c=>({u_matrix:c});function fa(c,n,s,h,p){if(p>0){const _=o.exported.now(),b=(_-c.timeAdded)/p,E=n?(_-n.timeAdded)/p:-1,S=s.getSource(),O=h.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),R=!n||Math.abs(n.tileID.overscaledZ-O)>Math.abs(c.tileID.overscaledZ-O),U=R&&c.refreshedUponExpiration?1:o.clamp(R?b:1-E,0,1);return c.refreshedUponExpiration&&b>=1&&(c.refreshedUponExpiration=!1),n?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class _s extends o.SourceCache{constructor(n){const s={type:"raster-dem",maxzoom:n.transform.maxZoom},h=new or(ai(),null),p=Me("mock-dem",s,h,n.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,s){n.state="loaded",s(null)}}class tu extends o.SourceCache{constructor(n){const s=Me("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new or(ai(),null),n.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,s,h){if(n.freezeTileCoverage)return;this.transform=n;const p=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,b)=>{if(_[b.key]="",!this._tiles[b.key]){const E=new o.Tile(b,this._source.tileSize*b.overscaleFactor(),n.tileZoom);E.state="loaded",this._tiles[b.key]=E}return _},{});for(const _ in this._tiles)_ in p||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(n){const s=this.proxyCachedFBO[n];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class pa extends o.OverscaledTileID{constructor(n,s,h){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class qs extends o.Elevation{constructor(n,s){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,p,_]=function(S){const O=new o.StructArrayLayout2i4,R=new o.StructArrayLayout3ui6,U=131;O.reserve(17161),R.reserve(33800);const $=o.EXTENT/128,J=o.EXTENT+$/2,Y=J+$;for(let ee=-$;ee<Y;ee+=$)for(let W=-$;W<Y;W+=$){const ae=W<0||W>J||ee<0||ee>J?24575:0,oe=o.clamp(Math.round(W),0,o.EXTENT),le=o.clamp(Math.round(ee),0,o.EXTENT);O.emplaceBack(oe+ae,le)}const Q=(ee,W)=>{const ae=W*U+ee;R.emplaceBack(ae+1,ae,ae+U),R.emplaceBack(ae+U,ae+U+1,ae+1)};for(let ee=1;ee<129;ee++)for(let W=1;W<129;W++)Q(W,ee);return[0,129].forEach(ee=>{for(let W=0;W<130;W++)Q(W,ee),Q(ee,W)}),[O,R,32768]}(),b=n.context;this.gridBuffer=b.createVertexBuffer(h,o.posAttributes.members),this.gridIndexBuffer=b.createIndexBuffer(p),this.gridSegments=o.SegmentVector.simpleSegment(0,0,h.length,p.length),this.gridNoSkirtSegments=o.SegmentVector.simpleSegment(0,0,h.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new tu(s.map),this.orthoMatrix=o.create(),o.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.EXTENT,0,o.EXTENT,0,1);const E=b.gl;this._overlapStencilMode=new o.StencilMode({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new _s(s.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,s,h){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const p=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(p.get("source")),this._exaggeration=p.get("exaggeration");const _=()=>{this.sourceCache.used&&o.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const b=this.getScaledDemTileSize();this.sourceCache.update(s,b,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),s.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&o.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=s.getIds().map(S=>{const O=s.getTileByID(S).tileID;return O.projMatrix=h.calculateProjMatrix(O.toUnwrapped()),O});(function(S,O){const R=O.transform.pointCoordinate(O.transform.getCameraPoint()),U=new o.pointGeometry(R.x,R.y);S.sort(($,J)=>{if(J.overscaledZ-$.overscaledZ)return J.overscaledZ-$.overscaledZ;const Y=new o.pointGeometry($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),Q=new o.pointGeometry(J.canonical.x+(1<<J.canonical.z)*J.wrap,J.canonical.y),ee=U.mult(1<<$.canonical.z);return ee.x-=.5,ee.y-=.5,ee.distSqr(Y)-ee.distSqr(Q)})})(p,this.painter),this._previousZoom=h.zoom;const _=this.proxyToSource||{};this.proxyToSource={},p.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};const b=this._style._sourceCaches;for(const S in b){const O=b[S];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,n[S],_),O.usedForTerrain))continue;const R=n[S];O.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[s.id]=p.map(S=>new pa(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=o.exported.now();const E={};this._visibleDemTiles=[];for(const S of this.proxyCoords){const O=this.terrainTileForTile[S.key];if(!O)continue;const R=O.tileID.key;R in E||(this._visibleDemTiles.push(O),E[R]=R)}}_assignTerrainTiles(n){this._initializing||n.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const n=this.painter.context,s=n.gl;for(const h in this.terrainTileForTile){const p=this.terrainTileForTile[h],_=p.dem;!_||p.demTexture&&!p.needsDEMTextureUpload||(n.activeTexture.set(s.TEXTURE1),mn(this.painter,p,_))}}_prepareDemTileUniforms(n,s,h,p){if(!s||s.demTexture==null)return!1;const _=n.tileID.canonical,b=Math.pow(2,s.tileID.canonical.z-_.z),E=p||"";return h[`u_dem_tl${E}`]=[_.x*b%1,_.y*b%1],h[`u_dem_scale${E}`]=b,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,s=n.gl;if(!this._emptyDepthBufferTexture){const h=new o.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.Texture(n,h,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const s=this._visibleDemTiles.reduce((h,p)=>{if(!p.dem)return h;const _=p.dem.tree.minimums[0];return _>0&&n++,h+_},0);return n?s/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,s=n.gl;n.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),p=new o.RGBAImage({width:1,height:1},new Uint8Array(o.DEMData.pack(h,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(p,{premultiply:!1}):_=this._emptyDEMTexture=new o.Texture(n,p,s.RGBA,{premultiply:!1}),_}setupElevationDraw(n,s,h){const p=this.painter.context,_=p.gl,b=(E=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:o.DEMData.getUnpackVector(E),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var E;b.u_dem_size=this.sourceCache.getSource().tileSize,b.u_exaggeration=this.exaggeration();let S=null,O=null,R=1;if(h&&h.morphing&&this._useVertexMorphing){const U=h.morphing.srcDemTile,$=h.morphing.dstDemTile;R=h.morphing.phase,U&&$&&(this._prepareDemTileUniforms(n,U,b,"_prev")&&(O=U),this._prepareDemTileUniforms(n,$,b)&&(S=$))}if(O&&S?(p.activeTexture.set(_.TEXTURE2),S.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),p.activeTexture.set(_.TEXTURE4),O.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),b.u_dem_lerp=R):(S=this.terrainTileForTile[n.tileID.key],p.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(n,S,b)?S.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE)),p.activeTexture.set(_.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(b.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),b.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&S){const U=(1<<S.tileID.canonical.z)*o.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;b.u_meter_to_dem=U}if(h&&h.labelPlaneMatrixInv&&(b.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(p,b),this.painter.transform.projection.name==="globe"){const U=this.globeUniformValues(this.painter.transform,n.tileID.canonical,h&&h.useDenormalizedUpVectorScale);s.setGlobeUniformValues(p,U)}}globeUniformValues(n,s,h){const p=n.projection;return{u_tile_tl_up:p.upVector(s,0,0),u_tile_tr_up:p.upVector(s,o.EXTENT,0),u_tile_br_up:p.upVector(s,o.EXTENT,o.EXTENT),u_tile_bl_up:p.upVector(s,0,o.EXTENT),u_tile_up_scale:h?o.globeMetersToEcef(1):p.upVectorScale(s,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const s=this.painter,h=this.painter.context;n.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,_,b,E,S){if(p.transform.projection.name==="globe")(function(O,R,U,$,J){const Y=O.context,Q=Y.gl;let ee,W;const ae=O.options.showTerrainWireframe?2:0,oe=O.transform,le=o.globeUseCustomAntiAliasing(O,Y,oe),ve=(mt,Ve)=>{if(W===mt)return;const Oe=[Ws[mt],"PROJECTION_GLOBE_VIEW"];le&&Oe.push("CUSTOM_ANTIALIASING"),Ve&&Oe.push(Ws[ae]),ee=O.useProgram("globeRaster",null,Oe),W=mt},ge=O.colorModeForRenderPass(),we=new o.DepthMode(Q.LEQUAL,o.DepthMode.ReadWrite,O.depthRangeFor3D);js.update(J);const ke=o.calculateGlobeMercatorMatrix(oe),Be=[o.mercatorXfromLng(oe.center.lng),o.mercatorYfromLat(oe.center.lat)],je=ae?[!1,!0]:[!1],Tt=O.globeSharedBuffers,Ne=[oe.width*o.exported.devicePixelRatio,oe.height*o.exported.devicePixelRatio],st=Float32Array.from(oe.globeMatrix),He={useDenormalizedUpVectorScale:!0};if(je.forEach(mt=>{const Ve=O.transform,Oe=us(Ve.zoom)*R.exaggeration();W=-1;const Ze=mt?Q.LINES:Q.TRIANGLES;for(const ut of $){const pt=U.getTile(ut),Yt=o.StencilMode.disabled,zi=R.prevTerrainTileForTile[ut.key],Vt=R.terrainTileForTile[ut.key];eu(zi,Vt)&&js.newMorphing(ut.key,zi,Vt,J,250),Y.activeTexture.set(Q.TEXTURE0),pt.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const zt=js.getMorphValuesForProxy(ut.key),ei=zt?1:0;zt&&o.extend$1(He,{morphing:{srcDemTile:zt.from,dstDemTile:zt.to,phase:o.easeCubicInOut(zt.phase)}});const qi=o.tileCornersToBounds(ut.canonical),si=o.getLatitudinalLod(qi.getCenter().lat),dn=o.getGridMatrix(ut.canonical,qi,si,Ve.worldSize/Ve._pixelsPerMercatorPixel),xn=o.globeNormalizeECEF(o.globeTileBounds(ut.canonical)),Fn=pl(Ve.projMatrix,st,ke,xn,o.globeToMercatorTransition(Ve.zoom),Be,Ve.frustumCorners.TL,Ve.frustumCorners.TR,Ve.frustumCorners.BR,Ve.frustumCorners.BL,Ve.globeCenterInViewSpace,Ve.globeRadius,Ne,Oe,dn);if(ve(ei,mt),R.setupElevationDraw(pt,ee,He),O.prepareDrawProgram(Y,ee,ut.toUnwrapped()),Tt){const[In,Sr,Oo]=mt?Tt.getWirefameBuffers(O.context,si):Tt.getGridBuffers(si,Oe!==0);ee.draw(Y,Ze,we,Yt,ge,o.CullFaceMode.backCCW,Fn,"globe_raster",In,Sr,Oo)}}}),Tt){const mt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];le&&mt.push("CUSTOM_ANTIALIASING"),ee=O.useProgram("globeRaster",null,mt);for(const Ve of $){const{x:Oe,y:Ze,z:ut}=Ve.canonical,pt=Ze===0,Yt=Ze===(1<<ut)-1,[zi,Vt,zt,ei]=Tt.getPoleBuffers(ut);if(ei&&(pt||Yt)){const qi=U.getTile(Ve);Y.activeTexture.set(Q.TEXTURE0),qi.texture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);let si=o.globePoleMatrixForTile(ut,Oe,oe);const dn=o.globeNormalizeECEF(o.globeTileBounds(Ve.canonical)),xn=(Fn,In)=>Fn.draw(Y,Q.TRIANGLES,we,o.StencilMode.disabled,ge,o.CullFaceMode.disabled,pl(oe.projMatrix,si,si,dn,0,Be,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Ne,0),"globe_pole_raster",In,zt,ei);R.setupElevationDraw(qi,ee,He),O.prepareDrawProgram(Y,ee,Ve.toUnwrapped()),pt&&xn(ee,zi),Yt&&(si=o.scale(o.create(),si,[1,-1,1]),xn(ee,Vt))}}}})(p,_,b,E,S);else{const O=p.context,R=O.gl;let U,$;const J=p.options.showTerrainWireframe?2:0,Y=(oe,le)=>{if($===oe)return;const ve=[Ws[oe]];le&&ve.push(Ws[J]),U=p.useProgram("terrainRaster",null,ve),$=oe},Q=p.colorModeForRenderPass(),ee=new o.DepthMode(R.LEQUAL,o.DepthMode.ReadWrite,p.depthRangeFor3D);js.update(S);const W=p.transform,ae=us(W.zoom)*_.exaggeration();(J?[!1,!0]:[!1]).forEach(oe=>{$=-1;const le=oe?R.LINES:R.TRIANGLES,[ve,ge]=oe?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const we of E){const ke=b.getTile(we),Be=o.StencilMode.disabled,je=_.prevTerrainTileForTile[we.key],Tt=_.terrainTileForTile[we.key];eu(je,Tt)&&js.newMorphing(we.key,je,Tt,S,250),O.activeTexture.set(R.TEXTURE0),ke.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const Ne=js.getMorphValuesForProxy(we.key),st=Ne?1:0;let He;Ne&&(He={morphing:{srcDemTile:Ne.from,dstDemTile:Ne.to,phase:o.easeCubicInOut(Ne.phase)}});const mt=Qc(we.projMatrix,To(we.canonical,W.renderWorldCopies)?ae/10:ae);Y(st,oe),_.setupElevationDraw(ke,U,He),p.prepareDrawProgram(O,U,we.toUnwrapped()),U.draw(O,le,ee,Be,Q,o.CullFaceMode.backCCW,mt,"terrain_raster",_.gridBuffer,ve,ge)}})}}(s,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,p=this.proxySourceCache,_=this.proxiedCoords[p.id],b=this._drapedRenderBatches.shift(),E=[],S=s.style.order;let O=0;for(const R of _){const U=p.getTileByID(R.proxyTileKey),$=p.proxyCachedFBO[R.key]?p.proxyCachedFBO[R.key][n]:void 0,J=$!==void 0?p.renderCache[$]:this.pool[O++],Y=$!==void 0;if(U.texture=J.tex,Y&&!J.dirty){E.push(U.tileID);continue}let Q;h.bindFramebuffer.set(J.fb.framebuffer),this.renderedToTile=!1,J.dirty&&(h.clear({color:o.Color.transparent,stencil:0}),J.dirty=!1);for(let ee=b.start;ee<=b.end;++ee){const W=s.style._layers[S[ee]];if(W.isHidden(s.transform.zoom))continue;const ae=s.style._getLayerSourceCache(W),oe=ae?this.proxyToSource[R.key][ae.id]:[R];if(!oe)continue;const le=oe;h.viewport.set([0,0,J.fb.width,J.fb.height]),Q!==(ae?ae.id:null)&&(this._setupStencil(J,oe,W,ae),Q=ae?ae.id:null),s.renderLayer(s,ae,W,le)}this.renderedToTile?(J.dirty=!0,E.push(U.tileID)):Y||--O,O===5&&(O=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),b.end+1}postRender(){}renderCacheEfficiency(n){const s=n.order.length;if(s===0)return{efficiency:100};let h,p=0,_=0,b=!1;for(let E=0;E<s;++E){const S=n._layers[n.order[E]];this._style.isLayerDraped(S)?(b&&++p,++_):b||(b=!0,h=S.id)}return _===0?{efficiency:100}:{efficiency:100*(1-p/_),firstUndrapedLayer:h}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{n=Math.min(n,s.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,s,h){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const b=_.tileID,E=1<<b.overscaledZ,{x:S,y:O}=b.canonical,R=S/E,U=(S+1)/E,$=O/E,J=(O+1)/E;return{minx:R,miny:$,maxx:U,maxy:J,t:_.dem.tree.raycastRoot(R,$,U,J,n,s,h),tile:_}});p.sort((_,b)=>(_.t!==null?_.t:Number.MAX_VALUE)-(b.t!==null?b.t:Number.MAX_VALUE));for(const _ of p){if(_.t==null)return null;const b=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,n,s,h);if(b!=null)return b}return null}_createFBO(){const n=this.painter.context,s=n.gl,h=this.drapeBufferSize;n.activeTexture.set(s.TEXTURE0);const p=new o.Texture(n,{width:h[0],height:h[1],data:null},s.RGBA);p.bind(s.LINEAR,s.CLAMP_TO_EDGE);const _=n.createFramebuffer(h[0],h[1],!1);return _.colorAttachment.set(p.texture),_.depthAttachment=new lo(n,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:_,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const s=this._style._layers[n],h=s.isHidden(this.painter.transform.zoom);return s.type==="custom"?!h&&s.shouldRedrape():!h&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const h of this._style._getSources())if(h instanceof V){n=!0;break}if(!n)return;const s={};for(let h=0;h<this._style.order.length;++h){const p=this._style._layers[this._style.order[h]],_=this._style._getLayerSourceCache(p);if(_&&!s[_.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof o.ZoomDependentExpression){s[_.id]=!0;for(const b of this.proxyCoords){const E=this.proxyToSource[b.key][_.id];if(E)for(const S of E)this._clearRenderCacheForTile(_.id,S)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof j){n=!0;break}if(!n)return;const s={};for(let h=0;h<this._style.order.length;++h){const p=this._style._layers[this._style.order[h]],_=this._style._getLayerSourceCache(p);if(!_||s[_.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const b=p.paint.get("raster-fade-duration");for(const E of this.proxyCoords){const S=this.proxyToSource[E.key][_.id];if(S)for(const O of S){const R=fa(_.getTile(O),_.findLoadedParent(O,0),_,this.painter.transform,b);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(_.id,O)}}}}_setupDrapedRenderBatches(){const n=this._style.order,s=n.length;if(s===0)return;const h=[];let p,_=0,b=this._style._layers[n[_]];for(;!this._style.isLayerDraped(b)&&b.isHidden(this.painter.transform.zoom)&&++_<s;)b=this._style._layers[n[_]];for(;_<s;++_){const E=this._style._layers[n[_]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?p===void 0&&(p=_):p!==void 0&&(h.push({start:p,end:_-1}),p=void 0))}p!==void 0&&h.push({start:p,end:_-1}),this._drapedRenderBatches=h}_setupRenderCache(n){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const b=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let E=0;E<b.length;++E){const S=Object.values(b[E]);s.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,p=this._tilesDirty;for(let b=h.length-1;b>=0;b--){const E=h[b];if(s.getTileByID(E.key),s.proxyCachedFBO[E.key]!==void 0){const S=n[E.key],O=this.proxyToSource[E.key];let R=0;for(const U in O){const $=O[U],J=S[U];if(!J||J.length!==$.length||$.some((Y,Q)=>Y!==J[Q]||p[U]&&p[U].hasOwnProperty(Y.key))){R=-1;break}++R}for(const U in s.proxyCachedFBO[E.key])s.renderCache[s.proxyCachedFBO[E.key][U]].dirty=R<0||R!==Object.values(S).length}}const _=[...this._drapedRenderBatches];_.sort((b,E)=>E.end-E.start-(b.end-b.start));for(const b of _)for(const E of h){if(s.proxyCachedFBO[E.key])continue;let S=s.renderCachePool.pop();S===void 0&&s.renderCache.length<50&&(S=s.renderCache.length,s.renderCache.push(this._createFBO())),S!==void 0&&(s.proxyCachedFBO[E.key]={},s.proxyCachedFBO[E.key][b.start]=S,s.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(n,s,h,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,b=_.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let E;if(h.isTileClipped())E=s.length,this._overlapStencilMode.test={func:b.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:b.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):o.StencilMode.disabled}_renderTileClippingMasks(n,s){const h=this.painter,p=this.painter.context,_=p.gl;h._tileClippingMaskIDs={},p.setColorMode(o.ColorMode.disabled),p.setDepthMode(o.DepthMode.disabled);const b=h.useProgram("clippingMask");for(const E of n){const S=h._tileClippingMaskIDs[E.key]=--s;b.draw(p,_.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:_.ALWAYS,mask:0},S,255,_.KEEP,_.KEEP,_.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Ei(E.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(n){const s=this.painter.transform;if(n.x<0||n.x>s.width||n.y<0||n.y>s.height)return null;const h=[n.x,n.y,1,1];o.transformMat4$1(h,h,s.pixelMatrixInverse),o.scale$1(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const p=s._camera.position,_=o.mercatorZfromAltitude(1,s.center.lat),b=[p[0],p[1],p[2]/_,0],E=o.subtract([],h.slice(0,3),b);o.normalize(E,E);const S=this.raycast(b,E,this._exaggeration);return S!==null&&S?(o.scaleAndAdd(b,b,E,S),b[3]=b[2],b[2]*=_,b):null}drawDepth(){const n=this.painter,s=n.context,h=this.proxySourceCache,p=Math.ceil(n.width),_=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===p&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const b=s.gl,E=s.createFramebuffer(p,_,!0);s.activeTexture.set(b.TEXTURE0);const S=new o.Texture(s,{width:p,height:_,data:null},b.RGBA);S.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.colorAttachment.set(S.texture);const O=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,p,_);E.depthAttachment.set(O),this._depthFBO=E,this._depthTexture=S}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,p,_]),function(b,E,S,O){if(b.transform.projection.name==="globe")return;const R=b.context,U=R.gl;R.clear({depth:1});const $=b.useProgram("terrainDepth"),J=new o.DepthMode(U.LESS,o.DepthMode.ReadWrite,b.depthRangeFor3D);for(const Y of O){const Q=S.getTile(Y),ee=Qc(Y.projMatrix,0);E.setupElevationDraw(Q,$),$.draw(R,U.TRIANGLES,J,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.backCCW,ee,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(n,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,s,h){if(n.getSource()instanceof be)return this._setupProxiedCoordsForImageSource(n,s,h);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const p=this.proxiedCoords[n.id]=[],_=this.proxyCoords;for(let E=0;E<_.length;E++){const S=_[E],O=this._findTileCoveringTileID(S,n);if(O){const R=this._createProxiedId(S,O,h[S.key]&&h[S.key][n.id]);p.push(R),this.proxyToSource[S.key][n.id]=[R]}}let b=!1;for(let E=0;E<s.length;E++){const S=n.getTile(s[E]);if(!S||!S.hasData())continue;const O=this._findTileCoveringTileID(S.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==S.tileID.canonical.z){const R=this.proxyToSource[O.tileID.key][n.id],U=this._createProxiedId(O.tileID,S,h[O.tileID.key]&&h[O.tileID.key][n.id]);R?R.splice(R.length-1,0,U):this.proxyToSource[O.tileID.key][n.id]=[U],p.push(U),b=!0}}this._sourceTilesOverlap[n.id]=b}_setupProxiedCoordsForImageSource(n,s,h){if(!n.getSource().loaded())return;const p=this.proxiedCoords[n.id]=[],_=this.proxyCoords,b=n.getSource(),E=new o.pointGeometry(b.tileID.x,b.tileID.y)._div(1<<b.tileID.z),S=b.coordinates.map(o.MercatorCoordinate.fromLngLat).reduce((R,U)=>(R.min.x=Math.min(R.min.x,U.x-E.x),R.min.y=Math.min(R.min.y,U.y-E.y),R.max.x=Math.max(R.max.x,U.x-E.x),R.max.y=Math.max(R.max.y,U.y-E.y),R),{min:new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(R,U)=>{const $=R.wrap+R.canonical.x/(1<<R.canonical.z),J=R.canonical.y/(1<<R.canonical.z),Y=o.EXTENT/(1<<R.canonical.z),Q=U.wrap+U.canonical.x/(1<<U.canonical.z),ee=U.canonical.y/(1<<U.canonical.z);return $+Y<Q+S.min.x||$>Q+S.max.x||J+Y<ee+S.min.y||J>ee+S.max.y};for(let R=0;R<_.length;R++){const U=_[R];for(let $=0;$<s.length;$++){const J=n.getTile(s[$]);if(!J||!J.hasData()||O(U,J.tileID))continue;const Y=this._createProxiedId(U,J,h[U.key]&&h[U.key][n.id]),Q=this.proxyToSource[U.key][n.id];Q?Q.push(Y):this.proxyToSource[U.key][n.id]=[Y],p.push(Y)}}}_createProxiedId(n,s,h){let p=this.orthoMatrix;if(h){const _=h.find(b=>b.key===s.tileID.key);if(_)return _}if(s.tileID.key!==n.key){const _=n.canonical.z-s.tileID.canonical.z;let b,E,S;p=o.create();const O=s.tileID.wrap-n.wrap<<n.overscaledZ;_>0?(b=o.EXTENT>>_,E=b*((s.tileID.canonical.x<<_)-n.canonical.x+O),S=b*((s.tileID.canonical.y<<_)-n.canonical.y)):(b=o.EXTENT<<-_,E=o.EXTENT*(s.tileID.canonical.x-(n.canonical.x+O<<-_)),S=o.EXTENT*(s.tileID.canonical.y-(n.canonical.y<<-_))),o.ortho(p,0,b,0,b,0,1),o.translate(p,p,[E,S,0])}return new pa(s.tileID,n.key,p)}_findTileCoveringTileID(n,s){let h=s.getTile(n);if(h&&h.hasData())return h;const p=this._findCoveringTileCache[s.id],_=p[n.key];if(h=_?s.getTileByID(_):null,h&&h.hasData()||_===null)return h;let b=h?h.tileID:n,E=b.overscaledZ;const S=s.getSource().minzoom,O=[];if(!_){const U=s.getSource().maxzoom;if(n.canonical.z>=U){const $=n.canonical.z-U;s.getSource().reparseOverscaled?(E=Math.max(n.canonical.z+2,s.transform.tileZoom),b=new o.OverscaledTileID(E,n.wrap,U,n.canonical.x>>$,n.canonical.y>>$)):$!==0&&(E=U,b=new o.OverscaledTileID(E,n.wrap,U,n.canonical.x>>$,n.canonical.y>>$))}b.key!==n.key&&(O.push(b.key),h=s.getTile(b))}const R=U=>{O.forEach($=>{p[$]=U}),O.length=0};for(E-=1;E>=S&&(!h||!h.hasData());E--){h&&R(h.tileID.key);const U=b.calculateScaledKey(E);if(h=s.getTileByID(U),h&&h.hasData())break;const $=p[U];if($===null)break;$===void 0?O.push(U):h=s.getTileByID($)}return R(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,s){let h=this._tilesDirty[n];h||(h=this._tilesDirty[n]={}),h[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(s){let h=0;const p=new o.StructArrayLayout2ui4,_=131;for(let b=1;b<129;b++){for(let E=1;E<129;E++)h=b*_+E,p.emplaceBack(h,h+1),p.emplaceBack(h,h+_),p.emplaceBack(h+1,h+_),b===128&&p.emplaceBack(h+_,h+_+1);p.emplaceBack(h+1,h+1+_)}return p}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=o.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ql{static cacheKey(n,s,h,p){let _=`${s}${p?p.cacheKey:""}`;for(const b of h)n.usedDefines.includes(b)&&(_+=`/${b}`);return _}constructor(n,s,h,p,_,b){const E=n.gl;this.program=E.createProgram();const S=function(W){const ae=[];for(let oe=0;oe<W.length;oe++){if(W[oe]===null)continue;const le=W[oe].split(" ");ae.push(le.pop())}return ae}(h.staticAttributes),O=p?p.getBinderAttributes():[],R=S.concat(O);let U=p?p.defines():[];U=U.concat(b.map(W=>`#define ${W}`));const $=n.isWebGL2?`#version 300 es
`:"",J=$+U.concat(n.extStandardDerivatives&&$.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(wc):wc,wc,Hr,Us.fragmentSource,Wl.fragmentSource,h.fragmentSource).join(`
`),Y=$+U.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Hr,Us.vertexSource,Wl.vertexSource,jl.vertexSource,h.vertexSource).join(`
`),Q=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(Q,J),E.compileShader(Q),E.attachShader(this.program,Q);const ee=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(ee,Y),E.compileShader(ee),E.attachShader(this.program,ee),this.attributes={},this.numAttributes=R.length;for(let W=0;W<this.numAttributes;W++)R[W]&&(E.bindAttribLocation(this.program,W,R[W]),this.attributes[R[W]]=W);E.linkProgram(this.program),E.deleteShader(ee),E.deleteShader(Q),this.fixedUniforms=_(n),this.binderUniforms=p?p.getUniforms(n):[],b.includes("TERRAIN")&&(this.terrainUniforms=(W=>({u_dem:new o.Uniform1i(W),u_dem_prev:new o.Uniform1i(W),u_dem_unpack:new o.Uniform4f(W),u_dem_tl:new o.Uniform2f(W),u_dem_scale:new o.Uniform1f(W),u_dem_tl_prev:new o.Uniform2f(W),u_dem_scale_prev:new o.Uniform1f(W),u_dem_size:new o.Uniform1f(W),u_dem_lerp:new o.Uniform1f(W),u_exaggeration:new o.Uniform1f(W),u_depth:new o.Uniform1i(W),u_depth_size_inv:new o.Uniform2f(W),u_meter_to_dem:new o.Uniform1f(W),u_label_plane_matrix_inv:new o.UniformMatrix4f(W)}))(n)),b.includes("GLOBE")&&(this.globeUniforms=(W=>({u_tile_tl_up:new o.Uniform3f(W),u_tile_tr_up:new o.Uniform3f(W),u_tile_br_up:new o.Uniform3f(W),u_tile_bl_up:new o.Uniform3f(W),u_tile_up_scale:new o.Uniform1f(W)}))(n)),b.includes("FOG")&&(this.fogUniforms=(W=>({u_fog_matrix:new o.UniformMatrix4f(W),u_fog_range:new o.Uniform2f(W),u_fog_color:new o.Uniform4f(W),u_fog_horizon_blend:new o.Uniform1f(W),u_fog_temporal_offset:new o.Uniform1f(W),u_frustum_tl:new o.Uniform3f(W),u_frustum_tr:new o.Uniform3f(W),u_frustum_br:new o.Uniform3f(W),u_frustum_bl:new o.Uniform3f(W),u_globe_pos:new o.Uniform3f(W),u_globe_radius:new o.Uniform1f(W),u_globe_transition:new o.Uniform1f(W),u_is_globe:new o.Uniform1i(W),u_viewport:new o.Uniform2f(W)}))(n))}}setTerrainUniformValues(n,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const p in s)h[p]&&h[p].set(this.program,p,s[p])}}setGlobeUniformValues(n,s){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const p in s)h[p]&&h[p].set(this.program,p,s[p])}}setFogUniformValues(n,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const p in s)h[p].set(this.program,p,s[p])}}draw(n,s,h,p,_,b,E,S,O,R,U,$,J,Y,Q){const ee=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(h),n.setStencilMode(p),n.setColorMode(_),n.setCullFace(b);for(const ae of Object.keys(this.fixedUniforms))this.fixedUniforms[ae].set(this.program,ae,E[ae]);Y&&Y.setUniforms(this.program,n,this.binderUniforms,$,{zoom:J});const W={[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[s];for(const ae of U.get()){const oe=ae.vaos||(ae.vaos={});(oe[S]||(oe[S]=new wo)).bind(n,this,O,Y?Y.getPaintVertexBuffers():[],R,ae.vertexOffset,Q||[]),ee.drawElements(s,ae.primitiveLength*W,ee.UNSIGNED_SHORT,ae.primitiveOffset*W*2)}}}function iu(c,n){const s=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,c.transform.tileZoom)/s,p=h*(n.tileID.canonical.x+n.tileID.wrap*s),_=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/Zn(n,1,c.transform.tileZoom),u_pixel_coord_upper:[p>>16,_>>16],u_pixel_coord_lower:[65535&p,65535&_]}}const nu=o.create(),ml=(c,n,s,h,p,_,b,E,S,O,R)=>{const U=n.style.light,$=U.properties.get("position"),J=[$.x,$.y,$.z],Y=o.create$1();U.properties.get("anchor")==="viewport"&&(o.fromRotation(Y,-n.transform.angle),o.transformMat3(J,J,Y));const Q=U.properties.get("color"),ee=n.transform,W={u_matrix:c,u_lightpos:J,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[Q.r,Q.g,Q.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:nu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:p,u_edge_radius:_};return ee.projection.name==="globe"&&(W.u_tile_id=[b.canonical.x,b.canonical.y,1<<b.canonical.z],W.u_zoom_transition=S,W.u_inv_rot_matrix=R,W.u_merc_center=O,W.u_up_dir=ee.projection.upVector(new o.CanonicalTileID(0,0,0),O[0]*o.EXTENT,O[1]*o.EXTENT),W.u_height_lift=E),W},Tc=(c,n,s,h,p,_,b,E,S,O,R,U)=>{const $=ml(c,n,s,h,p,_,b,S,O,R,U),J={u_height_factor:-Math.pow(2,b.overscaledZ)/E.tileSize/8};return o.extend($,iu(n,E),J)},_l=c=>({u_matrix:c}),Mr=(c,n,s)=>o.extend(_l(c),iu(n,s)),Zs=(c,n)=>({u_matrix:c,u_world:n}),gl=(c,n,s,h)=>o.extend(Mr(c,n,s),{u_world:h}),Hs=o.create(),yl=(c,n,s,h,p,_)=>{const b=c.transform,E=b.projection.name==="globe";let S;if(_.paint.get("circle-pitch-alignment")==="map")if(E){const R=o.globePixelsToTileUnits(b.zoom,n.canonical)*b._pixelsPerMercatorPixel;S=Float32Array.from([R,0,0,R])}else S=b.calculatePixelsToTileUnitsMatrix(s);else S=new Float32Array([b.pixelsToGLUnits[0],0,0,b.pixelsToGLUnits[1]]);const O={u_camera_to_center_distance:b.cameraToCenterDistance,u_matrix:c.translatePosMatrix(n.projMatrix,s,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:o.exported.devicePixelRatio,u_extrude_scale:S,u_inv_rot_matrix:Hs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){O.u_inv_rot_matrix=h,O.u_merc_center=p,O.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],O.u_zoom_transition=o.globeToMercatorTransition(b.zoom);const R=p[0]*o.EXTENT,U=p[1]*o.EXTENT;O.u_up_dir=b.projection.upVector(new o.CanonicalTileID(0,0,0),R,U)}return O},hs=c=>{const n=[];return c.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},ru=(c,n,s,h)=>{const p=o.EXTENT/s.tileSize;return{u_matrix:c,u_camera_to_center_distance:n.getCameraToCenterDistance(h),u_extrude_scale:[n.pixelsToGLUnits[0]/p,n.pixelsToGLUnits[1]/p]}},Zl=(c,n,s=1)=>({u_matrix:c,u_color:n,u_overlay:0,u_overlay_scale:s}),vl=o.create(),Zo=(c,n,s,h,p,_,b)=>{const E=c.transform,S=E.projection.name==="globe",O=S?o.globePixelsToTileUnits(E.zoom,n.canonical)*E._pixelsPerMercatorPixel:Zn(s,1,_),R={u_matrix:n.projMatrix,u_extrude_scale:O,u_intensity:b,u_inv_rot_matrix:vl,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){R.u_inv_rot_matrix=h,R.u_merc_center=p,R.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],R.u_zoom_transition=o.globeToMercatorTransition(E.zoom);const U=p[0]*o.EXTENT,$=p[1]*o.EXTENT;R.u_up_dir=E.projection.upVector(new o.CanonicalTileID(0,0,0),U,$)}return R},$s=(c,n,s,h,p,_,b)=>{const E=c.transform,S=E.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:Xs(c,n,s,h),u_pixels_to_tile_units:S,u_device_pixel_ratio:_,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:p,u_texsize:xl(s)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Hl(n,c.transform),u_alpha_discard_threshold:0,u_trim_offset:b}},ou=(c,n,s,h,p)=>{const _=c.transform;return{u_matrix:Xs(c,n,s,h),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:p,u_image:0,u_tile_units_to_pixels:Hl(n,_),u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Hl(c,n){return 1/Zn(c,1,n.tileZoom)}function Xs(c,n,s,h){return c.translatePosMatrix(h||n.tileID.projMatrix,n,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}function xl(c){const n=c.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const ma=(c,n,s,h,p,_)=>{return{u_matrix:c,u_tl_parent:n,u_scale_parent:s,u_fade_t:h.mix,u_opacity:h.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(E=p.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(b=p.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Pe(p.paint.get("raster-hue-rotate")),u_perspective_transform:_};var b,E};function Pe(c){c*=Math.PI/180;const n=Math.sin(c),s=Math.cos(c);return[(2*s+1)/3,(-Math.sqrt(3)*n-s+1)/3,(Math.sqrt(3)*n-s+1)/3]}const it=o.create(),Pt=(c,n,s,h,p,_,b,E,S,O,R,U,$,J,Y,Q)=>{const ee=p.transform,W={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:ee.cameraToCenterDistance,u_rotate_symbol:+s,u_aspect_ratio:ee.width/ee.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:b,u_coord_matrix:E,u_is_text:+S,u_pitch_with_map:+h,u_texsize:O,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:it,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:it,u_up_vector:[0,-1,0]};return Q.name==="globe"&&(W.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],W.u_zoom_transition=U,W.u_inv_rot_matrix=J,W.u_merc_center=$,W.u_camera_forward=ee._camera.forward(),W.u_ecef_origin=o.globeECEFOrigin(ee.globeMatrix,R.toUnwrapped()),W.u_tile_matrix=Float32Array.from(ee.globeMatrix),W.u_up_vector=Y),W},ci=(c,n,s,h,p,_,b,E,S,O,R,U,$,J,Y,Q,ee)=>o.extend(Pt(c,n,s,h,p,_,b,E,S,O,U,$,J,Y,Q,ee),{u_gamma_scale:h?p.transform.cameraToCenterDistance*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:o.exported.devicePixelRatio,u_is_halo:+R}),_n=(c,n,s,h,p,_,b,E,S,O,R,U,$,J,Y,Q)=>o.extend(ci(c,n,s,h,p,_,b,E,!0,S,!0,R,U,$,J,Y,Q),{u_texsize_icon:O,u_texture_icon:1}),Di=(c,n,s)=>({u_matrix:c,u_opacity:n,u_color:s}),Hn=(c,n,s,h,p)=>o.extend(function(_,b,E){const S=b.imageManager.getPattern(_.toString()),{width:O,height:R}=b.imageManager.getPixelSize(),U=Math.pow(2,E.tileID.overscaledZ),$=E.tileSize*Math.pow(2,b.transform.tileZoom)/U,J=$*(E.tileID.canonical.x+E.tileID.wrap*U),Y=$*E.tileID.canonical.y;return{u_image:0,u_pattern_tl:S.tl,u_pattern_br:S.br,u_texsize:[O,R],u_pattern_size:S.displaySize,u_tile_units_to_pixels:1/Zn(E,1,b.transform.tileZoom),u_pixel_coord_upper:[J>>16,Y>>16],u_pixel_coord_lower:[65535&J,65535&Y]}}(h,s,p),{u_matrix:c,u_opacity:n}),Tr={fillExtrusion:c=>({u_matrix:new o.UniformMatrix4f(c),u_lightpos:new o.Uniform3f(c),u_lightintensity:new o.Uniform1f(c),u_lightcolor:new o.Uniform3f(c),u_vertical_gradient:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c),u_edge_radius:new o.Uniform1f(c),u_ao:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_up_dir:new o.Uniform3f(c),u_height_lift:new o.Uniform1f(c)}),fillExtrusionPattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_lightpos:new o.Uniform3f(c),u_lightintensity:new o.Uniform1f(c),u_lightcolor:new o.Uniform3f(c),u_vertical_gradient:new o.Uniform1f(c),u_height_factor:new o.Uniform1f(c),u_edge_radius:new o.Uniform1f(c),u_ao:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_up_dir:new o.Uniform3f(c),u_height_lift:new o.Uniform1f(c),u_image:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_tile_units_to_pixels:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c)}),fill:c=>({u_matrix:new o.UniformMatrix4f(c)}),fillPattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_image:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_tile_units_to_pixels:new o.Uniform1f(c)}),fillOutline:c=>({u_matrix:new o.UniformMatrix4f(c),u_world:new o.Uniform2f(c)}),fillOutlinePattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_world:new o.Uniform2f(c),u_image:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_tile_units_to_pixels:new o.Uniform1f(c)}),circle:c=>({u_camera_to_center_distance:new o.Uniform1f(c),u_extrude_scale:new o.UniformMatrix2f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_up_dir:new o.Uniform3f(c)}),collisionBox:c=>({u_matrix:new o.UniformMatrix4f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_extrude_scale:new o.Uniform2f(c)}),collisionCircle:c=>({u_matrix:new o.UniformMatrix4f(c),u_inv_matrix:new o.UniformMatrix4f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_viewport_size:new o.Uniform2f(c)}),debug:c=>({u_color:new o.UniformColor(c),u_matrix:new o.UniformMatrix4f(c),u_overlay:new o.Uniform1i(c),u_overlay_scale:new o.Uniform1f(c)}),clippingMask:c=>({u_matrix:new o.UniformMatrix4f(c)}),heatmap:c=>({u_extrude_scale:new o.Uniform1f(c),u_intensity:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_up_dir:new o.Uniform3f(c)}),heatmapTexture:c=>({u_image:new o.Uniform1i(c),u_color_ramp:new o.Uniform1i(c),u_opacity:new o.Uniform1f(c)}),hillshade:c=>({u_matrix:new o.UniformMatrix4f(c),u_image:new o.Uniform1i(c),u_latrange:new o.Uniform2f(c),u_light:new o.Uniform2f(c),u_shadow:new o.UniformColor(c),u_highlight:new o.UniformColor(c),u_accent:new o.UniformColor(c)}),hillshadePrepare:c=>({u_matrix:new o.UniformMatrix4f(c),u_image:new o.Uniform1i(c),u_dimension:new o.Uniform2f(c),u_zoom:new o.Uniform1f(c),u_unpack:new o.Uniform4f(c)}),line:c=>({u_matrix:new o.UniformMatrix4f(c),u_pixels_to_tile_units:new o.UniformMatrix2f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_units_to_pixels:new o.Uniform2f(c),u_dash_image:new o.Uniform1i(c),u_gradient_image:new o.Uniform1i(c),u_image_height:new o.Uniform1f(c),u_texsize:new o.Uniform2f(c),u_tile_units_to_pixels:new o.Uniform1f(c),u_alpha_discard_threshold:new o.Uniform1f(c),u_trim_offset:new o.Uniform2f(c)}),linePattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_texsize:new o.Uniform2f(c),u_pixels_to_tile_units:new o.UniformMatrix2f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_image:new o.Uniform1i(c),u_units_to_pixels:new o.Uniform2f(c),u_tile_units_to_pixels:new o.Uniform1f(c),u_alpha_discard_threshold:new o.Uniform1f(c)}),raster:c=>({u_matrix:new o.UniformMatrix4f(c),u_tl_parent:new o.Uniform2f(c),u_scale_parent:new o.Uniform1f(c),u_fade_t:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c),u_image0:new o.Uniform1i(c),u_image1:new o.Uniform1i(c),u_brightness_low:new o.Uniform1f(c),u_brightness_high:new o.Uniform1f(c),u_saturation_factor:new o.Uniform1f(c),u_contrast_factor:new o.Uniform1f(c),u_spin_weights:new o.Uniform3f(c),u_perspective_transform:new o.Uniform2f(c)}),symbolIcon:c=>({u_is_size_zoom_constant:new o.Uniform1i(c),u_is_size_feature_constant:new o.Uniform1i(c),u_size_t:new o.Uniform1f(c),u_size:new o.Uniform1f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_rotate_symbol:new o.Uniform1i(c),u_aspect_ratio:new o.Uniform1f(c),u_fade_change:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_label_plane_matrix:new o.UniformMatrix4f(c),u_coord_matrix:new o.UniformMatrix4f(c),u_is_text:new o.Uniform1i(c),u_pitch_with_map:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_camera_forward:new o.Uniform3f(c),u_tile_matrix:new o.UniformMatrix4f(c),u_up_vector:new o.Uniform3f(c),u_ecef_origin:new o.Uniform3f(c),u_texture:new o.Uniform1i(c)}),symbolSDF:c=>({u_is_size_zoom_constant:new o.Uniform1i(c),u_is_size_feature_constant:new o.Uniform1i(c),u_size_t:new o.Uniform1f(c),u_size:new o.Uniform1f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_rotate_symbol:new o.Uniform1i(c),u_aspect_ratio:new o.Uniform1f(c),u_fade_change:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_label_plane_matrix:new o.UniformMatrix4f(c),u_coord_matrix:new o.UniformMatrix4f(c),u_is_text:new o.Uniform1i(c),u_pitch_with_map:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_texture:new o.Uniform1i(c),u_gamma_scale:new o.Uniform1f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_tile_id:new o.Uniform3f(c),u_zoom_transition:new o.Uniform1f(c),u_inv_rot_matrix:new o.UniformMatrix4f(c),u_merc_center:new o.Uniform2f(c),u_camera_forward:new o.Uniform3f(c),u_tile_matrix:new o.UniformMatrix4f(c),u_up_vector:new o.Uniform3f(c),u_ecef_origin:new o.Uniform3f(c),u_is_halo:new o.Uniform1i(c)}),symbolTextAndIcon:c=>({u_is_size_zoom_constant:new o.Uniform1i(c),u_is_size_feature_constant:new o.Uniform1i(c),u_size_t:new o.Uniform1f(c),u_size:new o.Uniform1f(c),u_camera_to_center_distance:new o.Uniform1f(c),u_rotate_symbol:new o.Uniform1i(c),u_aspect_ratio:new o.Uniform1f(c),u_fade_change:new o.Uniform1f(c),u_matrix:new o.UniformMatrix4f(c),u_label_plane_matrix:new o.UniformMatrix4f(c),u_coord_matrix:new o.UniformMatrix4f(c),u_is_text:new o.Uniform1i(c),u_pitch_with_map:new o.Uniform1i(c),u_texsize:new o.Uniform2f(c),u_texsize_icon:new o.Uniform2f(c),u_texture:new o.Uniform1i(c),u_texture_icon:new o.Uniform1i(c),u_gamma_scale:new o.Uniform1f(c),u_device_pixel_ratio:new o.Uniform1f(c),u_is_halo:new o.Uniform1i(c)}),background:c=>({u_matrix:new o.UniformMatrix4f(c),u_opacity:new o.Uniform1f(c),u_color:new o.UniformColor(c)}),backgroundPattern:c=>({u_matrix:new o.UniformMatrix4f(c),u_opacity:new o.Uniform1f(c),u_image:new o.Uniform1i(c),u_pattern_tl:new o.Uniform2f(c),u_pattern_br:new o.Uniform2f(c),u_texsize:new o.Uniform2f(c),u_pattern_size:new o.Uniform2f(c),u_pixel_coord_upper:new o.Uniform2f(c),u_pixel_coord_lower:new o.Uniform2f(c),u_tile_units_to_pixels:new o.Uniform1f(c)}),terrainRaster:fl,terrainDepth:fl,skybox:c=>({u_matrix:new o.UniformMatrix4f(c),u_sun_direction:new o.Uniform3f(c),u_cubemap:new o.Uniform1i(c),u_opacity:new o.Uniform1f(c),u_temporal_offset:new o.Uniform1f(c)}),skyboxGradient:c=>({u_matrix:new o.UniformMatrix4f(c),u_color_ramp:new o.Uniform1i(c),u_center_direction:new o.Uniform3f(c),u_radius:new o.Uniform1f(c),u_opacity:new o.Uniform1f(c),u_temporal_offset:new o.Uniform1f(c)}),skyboxCapture:c=>({u_matrix_3f:new o.UniformMatrix3f(c),u_sun_direction:new o.Uniform3f(c),u_sun_intensity:new o.Uniform1f(c),u_color_tint_r:new o.Uniform4f(c),u_color_tint_m:new o.Uniform4f(c),u_luminance:new o.Uniform1f(c)}),globeRaster:c=>({u_proj_matrix:new o.UniformMatrix4f(c),u_globe_matrix:new o.UniformMatrix4f(c),u_normalize_matrix:new o.UniformMatrix4f(c),u_merc_matrix:new o.UniformMatrix4f(c),u_zoom_transition:new o.Uniform1f(c),u_merc_center:new o.Uniform2f(c),u_image0:new o.Uniform1i(c),u_grid_matrix:new o.UniformMatrix3f(c),u_skirt_height:new o.Uniform1f(c),u_frustum_tl:new o.Uniform3f(c),u_frustum_tr:new o.Uniform3f(c),u_frustum_br:new o.Uniform3f(c),u_frustum_bl:new o.Uniform3f(c),u_globe_pos:new o.Uniform3f(c),u_globe_radius:new o.Uniform1f(c),u_viewport:new o.Uniform2f(c)}),globeAtmosphere:c=>({u_frustum_tl:new o.Uniform3f(c),u_frustum_tr:new o.Uniform3f(c),u_frustum_br:new o.Uniform3f(c),u_frustum_bl:new o.Uniform3f(c),u_horizon:new o.Uniform1f(c),u_transition:new o.Uniform1f(c),u_fadeout_range:new o.Uniform1f(c),u_color:new o.Uniform4f(c),u_high_color:new o.Uniform4f(c),u_space_color:new o.Uniform4f(c),u_star_intensity:new o.Uniform1f(c),u_star_density:new o.Uniform1f(c),u_star_size:new o.Uniform1f(c),u_temporal_offset:new o.Uniform1f(c),u_horizon_angle:new o.Uniform1f(c),u_rotation_matrix:new o.UniformMatrix4f(c)})};let $r;function Er(c,n,s,h,p,_,b){const E=c.context,S=E.gl,O=c.transform,R=c.useProgram("collisionBox"),U=[];let $=0,J=0;for(let le=0;le<h.length;le++){const ve=h[le],ge=n.getTile(ve),we=ge.getBucket(s);if(!we)continue;const ke=Lt(ve,we,O);let Be=ke;p[0]===0&&p[1]===0||(Be=c.translatePosMatrix(ke,ge,p,_));const je=b?we.textCollisionBox:we.iconCollisionBox,Tt=we.collisionCircleArray;if(Tt.length>0){const Ne=o.create(),st=Be;o.mul(Ne,we.placementInvProjMatrix,O.glCoordMatrix),o.mul(Ne,Ne,we.placementViewportMatrix),U.push({circleArray:Tt,circleOffset:J,transform:st,invTransform:Ne,projection:we.getProjection()}),$+=Tt.length/4,J=$}je&&(c.terrain&&c.terrain.setupElevationDraw(ge,R),R.draw(E,S.LINES,o.DepthMode.disabled,o.StencilMode.disabled,c.colorModeForRenderPass(),o.CullFaceMode.disabled,ru(Be,O,ge,we.getProjection()),s.id,je.layoutVertexBuffer,je.indexBuffer,je.segments,null,O.zoom,null,[je.collisionVertexBuffer,je.collisionVertexBufferExt]))}if(!b||!U.length)return;const Y=c.useProgram("collisionCircle"),Q=new o.StructArrayLayout2f1f2i16;Q.resize(4*$),Q._trim();let ee=0;for(const le of U)for(let ve=0;ve<le.circleArray.length/4;ve++){const ge=4*ve,we=le.circleArray[ge+0],ke=le.circleArray[ge+1],Be=le.circleArray[ge+2],je=le.circleArray[ge+3];Q.emplace(ee++,we,ke,Be,je,0),Q.emplace(ee++,we,ke,Be,je,1),Q.emplace(ee++,we,ke,Be,je,2),Q.emplace(ee++,we,ke,Be,je,3)}(!$r||$r.length<2*$)&&($r=function(le){const ve=2*le,ge=new o.StructArrayLayout3ui6;ge.resize(ve),ge._trim();for(let we=0;we<ve;we++){const ke=6*we;ge.uint16[ke+0]=4*we+0,ge.uint16[ke+1]=4*we+1,ge.uint16[ke+2]=4*we+2,ge.uint16[ke+3]=4*we+2,ge.uint16[ke+4]=4*we+3,ge.uint16[ke+5]=4*we+0}return ge}($));const W=E.createIndexBuffer($r,!0),ae=E.createVertexBuffer(Q,o.collisionCircleLayout.members,!0);for(const le of U){const ve={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(oe=O).getCameraToCenterDistance(le.projection),u_viewport_size:[oe.width,oe.height]};Y.draw(E,S.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,c.colorModeForRenderPass(),o.CullFaceMode.disabled,ve,s.id,ae,W,o.SegmentVector.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,O.zoom)}var oe;ae.destroy(),W.destroy()}const pr=o.create();function ds({width:c,height:n,anchor:s,textOffset:h,textScale:p},_){const{horizontalAlign:b,verticalAlign:E}=o.getAnchorAlignment(s),S=-(b-.5)*c,O=-(E-.5)*n,R=o.evaluateVariableOffset(s,h);return new o.pointGeometry((S/p+R[0])*_,(O/p+R[1])*_)}function Dr(c,n,s,h,p,_,b,E,S,O,R){const U=c.text.placedSymbolArray,$=c.text.dynamicLayoutVertexArray,J=c.icon.dynamicLayoutVertexArray,Y={},Q=c.getProjection(),ee=_i(E,Q,_),W=_.elevation,ae=Q.upVectorScale(E.canonical,_.center.lat,_.worldSize).metersToTile;$.clear();for(let oe=0;oe<U.length;oe++){const le=U.get(oe),{tileAnchorX:ve,tileAnchorY:ge,numGlyphs:we}=le,ke=c.allowVerticalPlacement&&!le.placedOrientation,Be=le.hidden||!le.crossTileID||ke?null:h[le.crossTileID];if(Be){let je=0,Tt=0,Ne=0;if(W){const Yt=W?W.getAtTileOffset(E,ve,ge):0,[zi,Vt,zt]=Q.upVector(E.canonical,ve,ge);je=Yt*zi*ae,Tt=Yt*Vt*ae,Ne=Yt*zt*ae}let[st,He,mt,Ve]=At(le.projectedAnchorX+je,le.projectedAnchorY+Tt,le.projectedAnchorZ+Ne,s?ee:b);const Oe=Bi(_.getCameraToCenterDistance(Q),Ve);let Ze=p.evaluateSizeForFeature(c.textSizeData,O,le)*Oe/o.ONE_EM;s&&(Ze*=c.tilePixelRatio/S);const ut=ds(Be,Ze);s?({x:st,y:He,z:mt}=Q.projectTilePoint(ve+ut.x,ge+ut.y,E.canonical),[st,He,mt]=At(st+je,He+Tt,mt+Ne,b)):(n&&ut._rotate(-_.angle),st+=ut.x,He+=ut.y,mt=0);const pt=c.allowVerticalPlacement&&le.placedOrientation===o.WritingMode.vertical?Math.PI/2:0;for(let Yt=0;Yt<we;Yt++)o.addDynamicAttributes($,st,He,mt,pt);R&&le.associatedIconIndex>=0&&(Y[le.associatedIconIndex]={x:st,y:He,z:mt,angle:pt})}else Ie(we,$)}if(R){J.clear();const oe=c.icon.placedSymbolArray;for(let le=0;le<oe.length;le++){const ve=oe.get(le),{numGlyphs:ge}=ve,we=Y[le];if(ve.hidden||!we)Ie(ge,J);else{const{x:ke,y:Be,z:je,angle:Tt}=we;for(let Ne=0;Ne<ge;Ne++)o.addDynamicAttributes(J,ke,Be,je,Tt)}}c.icon.dynamicLayoutVertexBuffer.updateData(J)}c.text.dynamicLayoutVertexBuffer.updateData($)}function De(c,n,s){return s.iconsInText&&n?"symbolTextAndIcon":c?"symbolSDF":"symbolIcon"}function ot(c,n,s,h,p,_,b,E,S,O,R,U){const $=c.context,J=$.gl,Y=c.transform,Q=E==="map",ee=S==="map",W=Q&&s.layout.get("symbol-placement")!=="point",ae=Q&&!ee&&!W,oe=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let le=!1;const ve=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),ge=[o.mercatorXfromLng(Y.center.lng),o.mercatorYfromLat(Y.center.lat)],we=s.layout.get("text-variable-anchor"),ke=Y.projection.name==="globe",Be=[],je=[0,-1,0];let Tt=je;!ke&&!Y.mercatorFromTransition||Q||(Tt=function(Ne){const st=Ne._camera.getWorldToCamera(Ne.worldSize,1),He=o.multiply([],st,Ne.globeMatrix);o.invert(He,He);const mt=[0,0,0],Ve=[0,1,0,0];return o.transformMat4$1(Ve,Ve,He),mt[0]=Ve[0],mt[1]=Ve[1],mt[2]=Ve[2],o.normalize(mt,mt),mt}(Y));for(const Ne of h){const st=n.getTile(Ne),He=st.getBucket(s);if(!He||He.projection.name==="mercator"&&ke)continue;const mt=p?He.text:He.icon;if(!mt||He.fullyClipped||!mt.segments.get().length)continue;const Ve=mt.programConfigurations.get(s.id),Oe=p||He.sdfIcons,Ze=p?He.textSizeData:He.iconSizeData,ut=ee||Y.pitch!==0,pt=o.evaluateSizeForZoom(Ze,Y.zoom);let Yt,zi,Vt,zt,ei=[0,0],qi=null;if(p){if(zi=st.glyphAtlasTexture,Vt=J.LINEAR,Yt=st.glyphAtlasTexture.size,He.iconsInText){ei=st.imageAtlasTexture.size,qi=st.imageAtlasTexture;const Ro=Ze.kind==="composite"||Ze.kind==="camera";zt=ut||c.options.rotating||c.options.zooming||Ro?J.LINEAR:J.NEAREST}}else{const Ro=s.layout.get("icon-size").constantOr(0)!==1||He.iconsNeedLinear;zi=st.imageAtlasTexture,Vt=Oe||c.options.rotating||c.options.zooming||Ro||ut?J.LINEAR:J.NEAREST,Yt=st.imageAtlasTexture.size}const si=He.projection.name==="globe",dn=si?Tt:je,xn=si?o.globeToMercatorTransition(Y.zoom):0,Fn=_i(Ne,He.getProjection(),Y),In=Y.calculatePixelsToTileUnitsMatrix(st),Sr=Ns(Fn,st.tileID.canonical,ee,Q,Y,He.getProjection(),In),Oo=c.terrain&&ee&&W?o.invert(o.create(),Sr):pr,bs=ha(Fn,st.tileID.canonical,ee,Q,Y,He.getProjection(),In),ws=we&&He.hasTextData(),$n=s.layout.get("icon-text-fit")!=="none"&&ws&&He.hasIconData();if(W){const Ro=Y.elevation,Si=Ro?Ro.getAtTileOffsetFunc(Ne,Y.center.lat,Y.worldSize,He.getProjection()):null,Xa=Yc(Fn,st.tileID.canonical,ee,Q,Y,He.getProjection(),In);xo(He,Fn,c,p,Xa,bs,ee,O,Si,Ne)}const Ln=W||p&&we||$n,sn=c.translatePosMatrix(Fn,st,_,b),mr=Ln?pr:Sr,po=c.translatePosMatrix(bs,st,_,b,!0),Wn=He.getProjection().createInversionMatrix(Y,Ne.canonical),to=[];c.terrainRenderModeElevated()&&ee&&to.push("PITCH_WITH_MAP_TERRAIN"),si&&to.push("PROJECTION_GLOBE_VIEW"),Ln&&to.push("PROJECTED_POS_ON_VIEWPORT");const mo=Oe&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ea;Ea=Oe?He.iconsInText?_n(Ze.kind,pt,ae,ee,c,sn,mr,po,Yt,ei,Ne,xn,ge,Wn,dn,He.getProjection()):ci(Ze.kind,pt,ae,ee,c,sn,mr,po,p,Yt,!0,Ne,xn,ge,Wn,dn,He.getProjection()):Pt(Ze.kind,pt,ae,ee,c,sn,mr,po,p,Yt,Ne,xn,ge,Wn,dn,He.getProjection());const Pc={program:c.useProgram(De(Oe,p,He),Ve,to),buffers:mt,uniformValues:Ea,atlasTexture:zi,atlasTextureIcon:qi,atlasInterpolation:Vt,atlasInterpolationIcon:zt,isSDF:Oe,hasHalo:mo,tile:st,labelPlaneMatrixInv:Oo};if(oe&&He.canOverlap){le=!0;const Ro=mt.segments.get();for(const Si of Ro)Be.push({segments:new o.SegmentVector([Si]),sortKey:Si.sortKey,state:Pc})}else Be.push({segments:mt.segments,sortKey:0,state:Pc})}le&&Be.sort((Ne,st)=>Ne.sortKey-st.sortKey);for(const Ne of Be){const st=Ne.state;if(c.terrain&&c.terrain.setupElevationDraw(st.tile,st.program,{useDepthForOcclusion:!ke,labelPlaneMatrixInv:st.labelPlaneMatrixInv}),$.activeTexture.set(J.TEXTURE0),st.atlasTexture.bind(st.atlasInterpolation,J.CLAMP_TO_EDGE),st.atlasTextureIcon&&($.activeTexture.set(J.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,J.CLAMP_TO_EDGE)),st.isSDF){const He=st.uniformValues;st.hasHalo&&(He.u_is_halo=1,et(st.buffers,Ne.segments,s,c,st.program,ve,R,U,He)),He.u_is_halo=0}et(st.buffers,Ne.segments,s,c,st.program,ve,R,U,st.uniformValues)}}function et(c,n,s,h,p,_,b,E,S){const O=h.context,R=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.globeExtVertexBuffer];p.draw(O,O.gl.TRIANGLES,_,b,E,o.CullFaceMode.disabled,S,s.id,c.layoutVertexBuffer,c.indexBuffer,n,s.paint,h.transform.zoom,c.programConfigurations.get(s.id),R)}function Zt(c,n,s,h,p,_,b){const E=c.context.gl,S=s.paint.get("fill-pattern"),O=S&&S.constantOr(1);let R,U,$,J,Y;b?(U=O&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=E.LINES):(U=O?"fillPattern":"fill",R=E.TRIANGLES);for(const Q of h){const ee=n.getTile(Q);if(O&&!ee.patternsLoaded())continue;const W=ee.getBucket(s);if(!W)continue;c.prepareDrawTile();const ae=W.programConfigurations.get(s.id),oe=c.useProgram(U,ae);O&&(c.context.activeTexture.set(E.TEXTURE0),ee.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ae.updatePaintBuffers());const le=S.constantOr(null);if(le&&ee.imageAtlas){const ge=ee.imageAtlas.patternPositions[le.toString()];ge&&ae.setConstantPatternPositions(ge)}const ve=c.translatePosMatrix(Q.projMatrix,ee,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(b){J=W.indexBuffer2,Y=W.segments2;const ge=c.terrain&&c.terrain.renderingToTexture?c.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];$=U==="fillOutlinePattern"&&O?gl(ve,c,ee,ge):Zs(ve,ge)}else J=W.indexBuffer,Y=W.segments,$=O?Mr(ve,c,ee):_l(ve);c.prepareDrawProgram(c.context,oe,Q.toUnwrapped()),oe.draw(c.context,R,p,c.stencilModeForClipping(Q),_,o.CullFaceMode.disabled,$,s.id,W.layoutVertexBuffer,J,Y,s.paint,c.transform.zoom,ae)}}function yi(c,n,s,h,p,_,b){const E=c.context,S=E.gl,O=c.transform,R=s.paint.get("fill-extrusion-pattern"),U=R.constantOr(1),$=s.paint.get("fill-extrusion-opacity"),J=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),s.paint.get("fill-extrusion-ambient-occlusion-radius")],Y=s.layout.get("fill-extrusion-edge-radius"),Q=O.projection.name==="globe"?o.fillExtrusionHeightLift():0,ee=O.projection.name==="globe",W=ee?o.globeToMercatorTransition(O.zoom):0,ae=[o.mercatorXfromLng(O.center.lng),o.mercatorYfromLat(O.center.lat)],oe=[];ee&&oe.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&oe.push("FAUX_AO");for(const le of h){const ve=n.getTile(le),ge=ve.getBucket(s);if(!ge||ge.projection.name!==O.projection.name)continue;const we=ge.programConfigurations.get(s.id),ke=c.useProgram(U?"fillExtrusionPattern":"fillExtrusion",we,oe);if(c.terrain){const mt=c.terrain;if(c.style.terrainSetForDrapingOnly())mt.setupElevationDraw(ve,ke,{useMeterToDem:!0});else{if(!ge.enableTerrain)continue;if(mt.setupElevationDraw(ve,ke,{useMeterToDem:!0}),on(E,n,le,ge,s,mt),!ge.centroidVertexBuffer){const Ve=ke.attributes.a_centroid_pos;Ve!==void 0&&S.vertexAttrib2f(Ve,0,0)}}}U&&(c.context.activeTexture.set(S.TEXTURE0),ve.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),we.updatePaintBuffers());const Be=R.constantOr(null);if(Be&&ve.imageAtlas){const mt=ve.imageAtlas.patternPositions[Be.toString()];mt&&we.setConstantPatternPositions(mt)}const je=c.translatePosMatrix(le.projMatrix,ve,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Tt=O.projection.createInversionMatrix(O,le.canonical),Ne=s.paint.get("fill-extrusion-vertical-gradient"),st=U?Tc(je,c,Ne,$,J,Y,le,ve,Q,W,ae,Tt):ml(je,c,Ne,$,J,Y,le,Q,W,ae,Tt);c.prepareDrawProgram(E,ke,le.toUnwrapped());const He=[];c.terrain&&He.push(ge.centroidVertexBuffer),ee&&He.push(ge.layoutVertexExtBuffer),ke.draw(E,E.gl.TRIANGLES,p,_,b,o.CullFaceMode.backCCW,st,s.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,s.paint,c.transform.zoom,we,He)}}function on(c,n,s,h,p,_){const b=[W=>{let ae=W.canonical.x-1,oe=W.wrap;return ae<0&&(ae=(1<<W.canonical.z)-1,oe--),new o.OverscaledTileID(W.overscaledZ,oe,W.canonical.z,ae,W.canonical.y)},W=>{let ae=W.canonical.x+1,oe=W.wrap;return ae===1<<W.canonical.z&&(ae=0,oe++),new o.OverscaledTileID(W.overscaledZ,oe,W.canonical.z,ae,W.canonical.y)},W=>new o.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(W.canonical.y===0?1<<W.canonical.z:W.canonical.y)-1),W=>new o.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],E=W=>{const ae=n.getSource().minzoom,oe=ve=>{const ge=n.getTileByID(ve);if(ge&&ge.hasData())return ge.getBucket(p)},le=[0,-1,1];for(const ve of le){if(W.overscaledZ+ve<ae)continue;const ge=oe(W.calculateScaledKey(W.overscaledZ+ve));if(ge)return ge}},S=[0,0,0],O=(W,ae)=>(S[0]=Math.min(W.min.y,ae.min.y),S[1]=Math.max(W.max.y,ae.max.y),S[2]=o.EXTENT-ae.min.x>W.max.x?ae.min.x-o.EXTENT:W.max.x,S),R=(W,ae)=>(S[0]=Math.min(W.min.x,ae.min.x),S[1]=Math.max(W.max.x,ae.max.x),S[2]=o.EXTENT-ae.min.y>W.max.y?ae.min.y-o.EXTENT:W.max.y,S),U=[(W,ae)=>O(W,ae),(W,ae)=>O(ae,W),(W,ae)=>R(W,ae),(W,ae)=>R(ae,W)],$=new o.pointGeometry(0,0);let J,Y,Q;const ee=(W,ae,oe,le,ve)=>{const ge=[[le?oe:W,le?W:oe,0],[le?oe:ae,le?ae:oe,0]],we=ve<0?o.EXTENT+ve:ve,ke=[le?we:(W+ae)/2,le?(W+ae)/2:we,0];return oe===0&&ve<0||oe!==0&&ve>0?_.getForTilePoints(Q,[ke],!0,Y):ge.push(ke),_.getForTilePoints(s,ge,!0,J),Math.max(ge[0][2],ge[1][2],ke[2])/_.exaggeration()};for(let W=0;W<4;W++){const ae=(W<2?1:5)-W,oe=h.borders[W];if(oe.length===0)continue;const le=Q=b[W](s),ve=E(le);if(!(ve&&ve instanceof o.FillExtrusionBucket&&ve.enableTerrain)||h.borderDoneWithNeighborZ[W]===ve.canonical.z&&ve.borderDoneWithNeighborZ[ae]===h.canonical.z||(Y=_.findDEMTileFor(le),!Y||!Y.dem))continue;if(!J){const Be=_.findDEMTileFor(s);if(!Be||!Be.dem)return;J=Be}const ge=ve.borders[ae];let we=0;const ke=ve.borderDoneWithNeighborZ[ae]!==h.canonical.z;if(h.canonical.z===ve.canonical.z){for(let Be=0;Be<oe.length;Be++){const je=h.featuresOnBorder[oe[Be]],Tt=je.borders[W];let Ne;for(;we<ge.length&&(Ne=ve.featuresOnBorder[ge[we]],!(Ne.borders[ae][1]>Tt[0]+3));)ke&&ve.encodeCentroid(void 0,Ne,!1),we++;if(Ne&&we<ge.length){const st=we;let He=0;for(;!(Ne.borders[ae][0]>Tt[1]-3)&&(He++,++we!==ge.length);)Ne=ve.featuresOnBorder[ge[we]];if(Ne=ve.featuresOnBorder[ge[st]],je.intersectsCount()>1||Ne.intersectsCount()>1||He!==1){He!==1&&(we=st),h.encodeCentroid(void 0,je,!1),ke&&ve.encodeCentroid(void 0,Ne,!1);continue}const mt=U[W](je,Ne),Ve=W%2?o.EXTENT-1:0;$.x=ee(mt[0],Math.min(o.EXTENT-1,mt[1]),Ve,W<2,mt[2]),$.y=0,h.encodeCentroid($,je,!1),ke&&ve.encodeCentroid($,Ne,!1)}else h.encodeCentroid(void 0,je,!1)}h.borderDoneWithNeighborZ[W]=ve.canonical.z,h.needsCentroidUpdate=!0,ke&&(ve.borderDoneWithNeighborZ[ae]=h.canonical.z,ve.needsCentroidUpdate=!0)}else{for(const Be of oe)h.encodeCentroid(void 0,h.featuresOnBorder[Be],!1);if(ke){for(const Be of ge)ve.encodeCentroid(void 0,ve.featuresOnBorder[Be],!1);ve.borderDoneWithNeighborZ[ae]=h.canonical.z,ve.needsCentroidUpdate=!0}h.borderDoneWithNeighborZ[W]=ve.canonical.z,h.needsCentroidUpdate=!0}}(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(c)}const lr=new o.Color(1,0,0,1),Dn=new o.Color(0,1,0,1),Ec=new o.Color(0,0,1,1),On=new o.Color(1,0,1,1),Gi=new o.Color(0,1,1,1);function Ks(c,n,s){const h=c.context,p=c.transform,_=h.gl,b=p.projection.name==="globe",E=b?["PROJECTION_GLOBE_VIEW"]:null;let S=s.projMatrix;if(b&&o.globeToMercatorTransition(p.zoom)>0){const je=o.transitionTileAABBinECEF(s.canonical,p),Tt=o.globeDenormalizeECEF(je);S=o.multiply(new Float32Array(16),p.globeMatrix,Tt),o.multiply(S,p.projMatrix,S)}const O=c.useProgram("debug",null,E),R=n.getTileByID(s.key);c.terrain&&c.terrain.setupElevationDraw(R,O);const U=o.DepthMode.disabled,$=o.StencilMode.disabled,J=c.colorModeForRenderPass(),Y="$debug";h.activeTexture.set(_.TEXTURE0),c.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),b?R._makeGlobeTileDebugBuffers(c.context,p):R._makeDebugTileBoundsBuffers(c.context,p.projection);const Q=R._tileDebugBuffer||c.debugBuffer,ee=R._tileDebugIndexBuffer||c.debugIndexBuffer,W=R._tileDebugSegments||c.debugSegments;O.draw(h,_.LINE_STRIP,U,$,J,o.CullFaceMode.disabled,Zl(S,o.Color.red),Y,Q,ee,W,null,null,null,[R._globeTileDebugBorderBuffer]);const ae=R.latestRawTileData,oe=Math.floor((ae&&ae.byteLength||0)/1024),le=n.getTile(s).tileSize,ve=512/Math.min(le,512)*(s.overscaledZ/p.zoom)*.5;let ge=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(ge+=` => ${s.overscaledZ}`),ge+=` ${oe}kb`,function(je,Tt){je.initDebugOverlayCanvas();const Ne=je.debugOverlayCanvas,st=je.context.gl,He=je.debugOverlayCanvas.getContext("2d");He.clearRect(0,0,Ne.width,Ne.height),He.shadowColor="white",He.shadowBlur=2,He.lineWidth=1.5,He.strokeStyle="white",He.textBaseline="top",He.font="bold 36px Open Sans, sans-serif",He.fillText(Tt,5,5),He.strokeText(Tt,5,5),je.debugOverlayTexture.update(Ne),je.debugOverlayTexture.bind(st.LINEAR,st.CLAMP_TO_EDGE)}(c,ge);const we=R._tileDebugTextBuffer||c.debugBuffer,ke=R._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,Be=R._tileDebugTextSegments||c.debugSegments;O.draw(h,_.TRIANGLES,U,$,o.ColorMode.alphaBlended,o.CullFaceMode.disabled,Zl(S,o.Color.transparent,ve),Y,we,ke,Be,null,null,null,[R._globeTileDebugTextBuffer])}function fo(c,n,s,h){Lr(c,0,n+s/2,c.transform.width,s,h)}function Mo(c,n,s,h){Lr(c,n-s/2,0,s,c.transform.height,h)}function Lr(c,n,s,h,p,_){const b=c.context,E=b.gl;E.enable(E.SCISSOR_TEST),E.scissor(n*o.exported.devicePixelRatio,s*o.exported.devicePixelRatio,h*o.exported.devicePixelRatio,p*o.exported.devicePixelRatio),b.clear({color:_}),E.disable(E.SCISSOR_TEST)}const Xr=o.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ji}=Xr;function Do(c,n,s,h){c.emplaceBack(n,s,h)}class _a{constructor(n){this.vertexArray=new o.StructArrayLayout3f12,this.indices=new o.StructArrayLayout3ui6,Do(this.vertexArray,-1,-1,1),Do(this.vertexArray,1,-1,1),Do(this.vertexArray,-1,1,1),Do(this.vertexArray,1,1,1),Do(this.vertexArray,-1,-1,-1),Do(this.vertexArray,1,-1,-1),Do(this.vertexArray,-1,1,-1),Do(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,ji),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=o.SegmentVector.simpleSegment(0,0,36,12)}}function Ci(c,n,s,h,p,_){const b=c.gl,E=n.paint.get("sky-atmosphere-color"),S=n.paint.get("sky-atmosphere-halo-color"),O=n.paint.get("sky-atmosphere-sun-intensity"),R=((U,$,J,Y,Q)=>({u_matrix_3f:U,u_sun_direction:$,u_sun_intensity:J,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[Q.r,Q.g,Q.b,Q.a],u_luminance:5e-5}))(o.fromMat4(o.create$1(),h),p,O,E,S);b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_CUBE_MAP_POSITIVE_X+_,n.skyboxTexture,0),s.draw(c,b.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,o.ColorMode.unblended,o.CullFaceMode.frontCW,R,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const gs=o.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Fu{constructor(n){const s=new o.StructArrayLayout5f20;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const h=new o.StructArrayLayout3ui6;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(s,gs.members),this.indexBuffer=n.createIndexBuffer(h),this.segments=o.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const bl={symbol:function(c,n,s,h,p){if(c.renderPass!=="translucent")return;const _=o.StencilMode.disabled,b=c.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(E,S,O,R,U,$,J){const Y=S.transform,Q=U==="map",ee=$==="map";for(const W of E){const ae=R.getTile(W),oe=ae.getBucket(O);if(!oe||!oe.text||!oe.text.segments.get().length)continue;const le=o.evaluateSizeForZoom(oe.textSizeData,Y.zoom),ve=_i(W,oe.getProjection(),Y),ge=Y.calculatePixelsToTileUnitsMatrix(ae),we=Ns(ve,ae.tileID.canonical,ee,Q,Y,oe.getProjection(),ge),ke=O.layout.get("icon-text-fit")!=="none"&&oe.hasIconData();if(le){const Be=Math.pow(2,Y.zoom-ae.tileID.overscaledZ);Dr(oe,Q,ee,J,o.symbolSize,Y,we,W,Be,le,ke)}}}(h,c,s,n,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),p),s.paint.get("icon-opacity").constantOr(1)!==0&&ot(c,n,s,h,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),_,b),s.paint.get("text-opacity").constantOr(1)!==0&&ot(c,n,s,h,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),_,b),n.map.showCollisionBoxes&&(Er(c,n,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Er(c,n,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(c,n,s,h){if(c.renderPass!=="translucent")return;const p=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),b=s.paint.get("circle-stroke-opacity"),E=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(p.constantOr(1)===0&&(_.constantOr(1)===0||b.constantOr(1)===0))return;const S=c.context,O=S.gl,R=c.transform,U=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),$=o.StencilMode.disabled,J=c.colorModeForRenderPass(),Y=R.projection.name==="globe",Q=[o.mercatorXfromLng(R.center.lng),o.mercatorYfromLat(R.center.lat)],ee=[];for(let ae=0;ae<h.length;ae++){const oe=h[ae],le=n.getTile(oe),ve=le.getBucket(s);if(!ve||ve.projection.name!==R.projection.name)continue;const ge=ve.programConfigurations.get(s.id),we=hs(s);Y&&we.push("PROJECTION_GLOBE_VIEW");const ke=c.useProgram("circle",ge,we),Be=ve.layoutVertexBuffer,je=ve.globeExtVertexBuffer,Tt=ve.indexBuffer,Ne=R.projection.createInversionMatrix(R,oe.canonical),st={programConfiguration:ge,program:ke,layoutVertexBuffer:Be,globeExtVertexBuffer:je,indexBuffer:Tt,uniformValues:yl(c,oe,le,Ne,Q,s),tile:le};if(E){const He=ve.segments.get();for(const mt of He)ee.push({segments:new o.SegmentVector([mt]),sortKey:mt.sortKey,state:st})}else ee.push({segments:ve.segments,sortKey:0,state:st})}E&&ee.sort((ae,oe)=>ae.sortKey-oe.sortKey);const W={useDepthForOcclusion:!Y};for(const ae of ee){const{programConfiguration:oe,program:le,layoutVertexBuffer:ve,globeExtVertexBuffer:ge,indexBuffer:we,uniformValues:ke,tile:Be}=ae.state,je=ae.segments;c.terrain&&c.terrain.setupElevationDraw(Be,le,W),c.prepareDrawProgram(S,le,Be.tileID.toUnwrapped()),le.draw(S,O.TRIANGLES,U,$,J,o.CullFaceMode.disabled,ke,s.id,ve,we,je,s.paint,R.zoom,oe,[ge])}},heatmap:function(c,n,s,h){if(s.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const p=c.context,_=p.gl,b=o.StencilMode.disabled,E=new o.ColorMode([_.ONE,_.ONE],o.Color.transparent,[!0,!0,!0,!0]);(function(J,Y,Q,ee){const W=J.gl,ae=Y.width*ee,oe=Y.height*ee;J.activeTexture.set(W.TEXTURE1),J.viewport.set([0,0,ae,oe]);let le=Q.heatmapFbo;if(!le||le&&(le.width!==ae||le.height!==oe)){le&&le.destroy();const ve=W.createTexture();W.bindTexture(W.TEXTURE_2D,ve),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),le=Q.heatmapFbo=J.createFramebuffer(ae,oe,!1),function(ge,we,ke,Be,je,Tt){const Ne=ge.gl;Ne.texImage2D(Ne.TEXTURE_2D,0,ge.isWebGL2&&ge.extRenderToTextureHalfFloat?Ne.RGBA16F:Ne.RGBA,je,Tt,0,Ne.RGBA,ge.extRenderToTextureHalfFloat?ge.isWebGL2?Ne.HALF_FLOAT:ge.extTextureHalfFloat.HALF_FLOAT_OES:Ne.UNSIGNED_BYTE,null),Be.colorAttachment.set(ke)}(J,0,ve,le,ae,oe)}else W.bindTexture(W.TEXTURE_2D,le.colorAttachment.get()),J.bindFramebuffer.set(le.framebuffer)})(p,c,s,c.transform.projection.name==="globe"?.5:.25),p.clear({color:o.Color.transparent});const S=c.transform,O=S.projection.name==="globe",R=O?["PROJECTION_GLOBE_VIEW"]:null,U=O?o.CullFaceMode.frontCCW:o.CullFaceMode.disabled,$=[o.mercatorXfromLng(S.center.lng),o.mercatorYfromLat(S.center.lat)];for(let J=0;J<h.length;J++){const Y=h[J];if(n.hasRenderableParent(Y))continue;const Q=n.getTile(Y),ee=Q.getBucket(s);if(!ee||ee.projection.name!==S.projection.name)continue;const W=ee.programConfigurations.get(s.id),ae=c.useProgram("heatmap",W,R),{zoom:oe}=c.transform;c.terrain&&c.terrain.setupElevationDraw(Q,ae),c.prepareDrawProgram(p,ae,Y.toUnwrapped());const le=S.projection.createInversionMatrix(S,Y.canonical);ae.draw(p,_.TRIANGLES,o.DepthMode.disabled,b,E,U,Zo(c,Y,Q,le,$,oe,s.paint.get("heatmap-intensity")),s.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,s.paint,c.transform.zoom,W,O?[ee.globeExtVertexBuffer]:null)}p.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(p,_){const b=p.context,E=b.gl,S=_.heatmapFbo;if(!S)return;b.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,S.colorAttachment.get()),b.activeTexture.set(E.TEXTURE1);let O=_.colorRampTexture;O||(O=_.colorRampTexture=new o.Texture(b,_.colorRamp,E.RGBA)),O.bind(E.LINEAR,E.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(b,E.TRIANGLES,o.DepthMode.disabled,o.StencilMode.disabled,p.colorModeForRenderPass(),o.CullFaceMode.disabled,((R,U,$,J)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,_),_.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,_.paint,p.transform.zoom)}(c,s))},line:function(c,n,s,h){if(c.renderPass!=="translucent")return;const p=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(p.constantOr(1)===0||_.constantOr(1)===0)return;const b=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),E=c.colorModeForRenderPass(),S=c.terrain&&c.terrain.renderingToTexture?1:o.exported.devicePixelRatio,O=s.paint.get("line-dasharray"),R=O.constantOr(1),U=s.layout.get("line-cap"),$=s.paint.get("line-pattern"),J=$.constantOr(1),Y=s.paint.get("line-gradient"),Q=J?"linePattern":"line",ee=c.context,W=ee.gl,ae=(le=>{const ve=[];xl(le)&&ve.push("RENDER_LINE_DASH"),le.paint.get("line-gradient")&&ve.push("RENDER_LINE_GRADIENT");const ge=le.paint.get("line-trim-offset");ge[0]===0&&ge[1]===0||ve.push("RENDER_LINE_TRIM_OFFSET");const we=le.paint.get("line-pattern").constantOr(1),ke=le.paint.get("line-opacity").constantOr(1)!==1;return!we&&ke&&ve.push("RENDER_LINE_ALPHA_DISCARD"),ve})(s);let oe=ae.includes("RENDER_LINE_ALPHA_DISCARD");c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(oe=!1);for(const le of h){const ve=n.getTile(le);if(J&&!ve.patternsLoaded())continue;const ge=ve.getBucket(s);if(!ge)continue;c.prepareDrawTile();const we=ge.programConfigurations.get(s.id),ke=c.useProgram(Q,we,ae),Be=$.constantOr(null);if(Be&&ve.imageAtlas){const Oe=ve.imageAtlas.patternPositions[Be.toString()];Oe&&we.setConstantPatternPositions(Oe)}const je=O.constantOr(null),Tt=U.constantOr(null);if(!J&&je&&Tt&&ve.lineAtlas){const Oe=ve.lineAtlas.getDash(je,Tt);Oe&&we.setConstantPatternPositions(Oe)}let[Ne,st]=s.paint.get("line-trim-offset");(Tt==="round"||Tt==="square")&&Ne!==st&&(Ne===0&&(Ne-=1),st===1&&(st+=1));const He=c.terrain?le.projMatrix:null,mt=J?ou(c,ve,s,He,S):$s(c,ve,s,He,ge.lineClipsArray.length,S,[Ne,st]);if(Y){const Oe=ge.gradients[s.id];let Ze=Oe.texture;if(s.gradientVersion!==Oe.version){let ut=256;if(s.stepInterpolant){const pt=n.getSource().maxzoom,Yt=le.canonical.z===pt?Math.ceil(1<<c.transform.maxZoom-le.canonical.z):1;ut=o.clamp(o.nextPowerOfTwo(ge.maxLineLength/o.EXTENT*1024*Yt),256,ee.maxTextureSize)}Oe.gradient=o.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:ut,image:Oe.gradient||void 0,clips:ge.lineClipsArray}),Oe.texture?Oe.texture.update(Oe.gradient):Oe.texture=new o.Texture(ee,Oe.gradient,W.RGBA),Oe.version=s.gradientVersion,Ze=Oe.texture}ee.activeTexture.set(W.TEXTURE1),Ze.bind(s.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}R&&(ee.activeTexture.set(W.TEXTURE0),ve.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),we.updatePaintBuffers()),J&&(ee.activeTexture.set(W.TEXTURE0),ve.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),we.updatePaintBuffers()),c.prepareDrawProgram(ee,ke,le.toUnwrapped());const Ve=Oe=>{ke.draw(ee,W.TRIANGLES,b,Oe,E,o.CullFaceMode.disabled,mt,s.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,s.paint,c.transform.zoom,we,[ge.layoutVertexBuffer2])};if(oe){const Oe=c.stencilModeForClipping(le).ref;Oe===0&&c.terrain&&ee.clear({stencil:0});const Ze={func:W.EQUAL,mask:255};mt.u_alpha_discard_threshold=.8,Ve(new o.StencilMode(Ze,Oe,255,W.KEEP,W.KEEP,W.INVERT)),mt.u_alpha_discard_threshold=0,Ve(new o.StencilMode(Ze,Oe,255,W.KEEP,W.KEEP,W.KEEP))}else Ve(c.stencilModeForClipping(le))}oe&&(c.resetStencilClippingMasks(),c.terrain&&ee.clear({stencil:0}))},fill:function(c,n,s,h){const p=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const b=c.colorModeForRenderPass(),E=s.paint.get("fill-pattern"),S=c.opaquePassEnabledForLayer()&&!E.constantOr(1)&&p.constantOr(o.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(c.renderPass===S){const O=c.depthModeForSublayer(1,c.renderPass==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly);Zt(c,n,s,h,O,b,!1)}if(c.renderPass==="translucent"&&s.paint.get("fill-antialias")){const O=c.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,o.DepthMode.ReadOnly);Zt(c,n,s,h,O,b,!0)}},"fill-extrusion":function(c,n,s,h){const p=s.paint.get("fill-extrusion-opacity");if(p!==0&&c.renderPass==="translucent"){const _=new o.DepthMode(c.context.gl.LEQUAL,o.DepthMode.ReadWrite,c.depthRangeFor3D);if(p!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))yi(c,n,s,h,_,o.StencilMode.disabled,o.ColorMode.disabled),yi(c,n,s,h,_,c.stencilModeFor3D(),c.colorModeForRenderPass()),c.resetStencilClippingMasks();else{const b=c.colorModeForRenderPass();yi(c,n,s,h,_,o.StencilMode.disabled,b)}}},hillshade:function(c,n,s,h){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent")return;const p=c.context,_=c.depthModeForSublayer(0,o.DepthMode.ReadOnly),b=c.colorModeForRenderPass(),E=c.terrain&&c.terrain.renderingToTexture,[S,O]=c.renderPass!=="translucent"||E?[{},h]:c.stencilConfigForOverlap(h);for(const R of O){const U=n.getTile(R);if(U.needsHillshadePrepare&&c.renderPass==="offscreen")cs(c,U,s,_,o.StencilMode.disabled,b);else if(c.renderPass==="translucent"){const $=E&&c.terrain?c.terrain.stencilModeForRTTOverlap(R):S[R.overscaledZ];Gs(c,R,U,s,_,$,b)}}p.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,n,s,h,p,_){if(c.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!h.length)return;const b=c.context,E=b.gl,S=n.getSource(),O=c.useProgram("raster"),R=c.colorModeForRenderPass(),U=c.terrain&&c.terrain.renderingToTexture,[$,J]=S instanceof be||U?[{},h]:c.stencilConfigForOverlap(h),Y=J[J.length-1].overscaledZ,Q=!c.options.moving;for(const ee of J){const W=U?o.DepthMode.disabled:c.depthModeForSublayer(ee.overscaledZ-Y,s.paint.get("raster-opacity")===1?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly,E.LESS),ae=ee.toUnwrapped(),oe=n.getTile(ee);if(U&&(!oe||!oe.hasData()))continue;const le=U?ee.projMatrix:c.transform.calculateProjMatrix(ae,Q),ve=c.terrain&&U?c.terrain.stencilModeForRTTOverlap(ee):$[ee.overscaledZ],ge=_?0:s.paint.get("raster-fade-duration");oe.registerFadeDuration(ge);const we=n.findLoadedParent(ee,0),ke=fa(oe,we,n,c.transform,ge);let Be,je;c.terrain&&c.terrain.prepareDrawTile();const Tt=s.paint.get("raster-resampling")==="nearest"?E.NEAREST:E.LINEAR;b.activeTexture.set(E.TEXTURE0),oe.texture.bind(Tt,E.CLAMP_TO_EDGE),b.activeTexture.set(E.TEXTURE1),we?(we.texture.bind(Tt,E.CLAMP_TO_EDGE),Be=Math.pow(2,we.tileID.overscaledZ-oe.tileID.overscaledZ),je=[oe.tileID.canonical.x*Be%1,oe.tileID.canonical.y*Be%1]):oe.texture.bind(Tt,E.CLAMP_TO_EDGE);const Ne=ma(le,je||[0,0],Be||1,ke,s,S instanceof be?S.perspectiveTransform:[0,0]);if(c.prepareDrawProgram(b,O,ae),S instanceof be)S.boundsBuffer&&S.boundsSegments&&O.draw(b,E.TRIANGLES,W,o.StencilMode.disabled,R,o.CullFaceMode.disabled,Ne,s.id,S.boundsBuffer,c.quadTriangleIndexBuffer,S.boundsSegments);else{const{tileBoundsBuffer:st,tileBoundsIndexBuffer:He,tileBoundsSegments:mt}=c.getTileBoundsBuffers(oe);O.draw(b,E.TRIANGLES,W,ve,R,o.CullFaceMode.disabled,Ne,s.id,st,He,mt)}}c.resetStencilClippingMasks()},background:function(c,n,s,h){const p=s.paint.get("background-color"),_=s.paint.get("background-opacity");if(_===0)return;const b=c.context,E=b.gl,S=c.transform,O=S.tileSize,R=s.paint.get("background-pattern");if(c.isPatternMissing(R))return;const U=!R&&p.a===1&&_===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==U)return;const $=o.StencilMode.disabled,J=c.depthModeForSublayer(0,U==="opaque"?o.DepthMode.ReadWrite:o.DepthMode.ReadOnly),Y=c.colorModeForRenderPass(),Q=c.useProgram(R?"backgroundPattern":"background");let ee,W=h;W||(ee=c.getBackgroundTiles(),W=Object.values(ee).map(ae=>ae.tileID)),R&&(b.activeTexture.set(E.TEXTURE0),c.imageManager.bind(c.context));for(const ae of W){const oe=ae.toUnwrapped(),le=h?ae.projMatrix:c.transform.calculateProjMatrix(oe);c.prepareDrawTile();const ve=n?n.getTile(ae):ee?ee[ae.key]:new o.Tile(ae,O,S.zoom,c),ge=R?Hn(le,_,c,R,{tileID:ae,tileSize:O}):Di(le,_,p);c.prepareDrawProgram(b,Q,oe);const{tileBoundsBuffer:we,tileBoundsIndexBuffer:ke,tileBoundsSegments:Be}=c.getTileBoundsBuffers(ve);Q.draw(b,E.TRIANGLES,J,$,Y,o.CullFaceMode.disabled,ge,s.id,we,ke,Be)}},sky:function(c,n,s){const h=c.transform,p=h.projection.name==="mercator"||h.projection.name==="globe"?1:o.smoothstep(7,8,h.zoom),_=s.paint.get("sky-opacity")*p;if(_===0)return;const b=c.context,E=s.paint.get("sky-type"),S=new o.DepthMode(b.gl.LEQUAL,o.DepthMode.ReadOnly,[0,1]),O=c.frameCounter/1e3%1;E==="atmosphere"?c.renderPass==="offscreen"?s.needsSkyboxCapture(c)&&(function(R,U,$,J){const Y=R.context,Q=Y.gl;let ee=U.skyboxFbo;if(!ee){ee=U.skyboxFbo=Y.createFramebuffer(32,32,!1),U.skyboxGeometry=new _a(Y),U.skyboxTexture=Y.gl.createTexture(),Q.bindTexture(Q.TEXTURE_CUBE_MAP,U.skyboxTexture),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_CUBE_MAP,Q.TEXTURE_MAG_FILTER,Q.LINEAR);for(let le=0;le<6;++le)Q.texImage2D(Q.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,Q.RGBA,32,32,0,Q.RGBA,Q.UNSIGNED_BYTE,null)}Y.bindFramebuffer.set(ee.framebuffer),Y.viewport.set([0,0,32,32]);const W=U.getCenter(R,!0),ae=R.useProgram("skyboxCapture"),oe=new Float64Array(16);o.identity(oe),o.rotateY(oe,oe,.5*-Math.PI),Ci(Y,U,ae,oe,W,0),o.identity(oe),o.rotateY(oe,oe,.5*Math.PI),Ci(Y,U,ae,oe,W,1),o.identity(oe),o.rotateX(oe,oe,.5*-Math.PI),Ci(Y,U,ae,oe,W,2),o.identity(oe),o.rotateX(oe,oe,.5*Math.PI),Ci(Y,U,ae,oe,W,3),o.identity(oe),Ci(Y,U,ae,oe,W,4),o.identity(oe),o.rotateY(oe,oe,Math.PI),Ci(Y,U,ae,oe,W,5),Y.viewport.set([0,0,R.width,R.height])}(c,s),s.markSkyboxValid(c)):c.renderPass==="sky"&&function(R,U,$,J,Y){const Q=R.context,ee=Q.gl,W=R.transform,ae=R.useProgram("skybox");Q.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_CUBE_MAP,U.skyboxTexture);const oe=((le,ve,ge,we,ke)=>({u_matrix:le,u_sun_direction:ve,u_cubemap:0,u_opacity:we,u_temporal_offset:ke}))(W.skyboxMatrix,U.getCenter(R,!1),0,J,Y);R.prepareDrawProgram(Q,ae),ae.draw(Q,ee.TRIANGLES,$,o.StencilMode.disabled,R.colorModeForRenderPass(),o.CullFaceMode.backCW,oe,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(c,s,S,_,O):E==="gradient"&&c.renderPass==="sky"&&function(R,U,$,J,Y){const Q=R.context,ee=Q.gl,W=R.transform,ae=R.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new _a(Q)),Q.activeTexture.set(ee.TEXTURE0);let oe=U.colorRampTexture;oe||(oe=U.colorRampTexture=new o.Texture(Q,U.colorRamp,ee.RGBA)),oe.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const le=((ve,ge,we,ke,Be)=>({u_matrix:ve,u_color_ramp:0,u_center_direction:ge,u_radius:o.degToRad(we),u_opacity:ke,u_temporal_offset:Be}))(W.skyboxMatrix,U.getCenter(R,!1),U.paint.get("sky-gradient-radius"),J,Y);R.prepareDrawProgram(Q,ae),ae.draw(Q,ee.TRIANGLES,$,o.StencilMode.disabled,R.colorModeForRenderPass(),o.CullFaceMode.backCW,le,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(c,s,S,_,O)},debug:function(c,n,s){for(let h=0;h<s.length;h++)Ks(c,n,s[h])},custom:function(c,n,s,h){const p=c.context,_=s.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&s.isLayerDraped()){if(c.renderPass==="offscreen"){const b=_.prerender;if(b){if(c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const E=c.transform.pointMerc;b.call(_,p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(c.transform.zoom),[E.x,E.y],c.transform.pixelsPerMeterRatio)}else b.call(_,p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const E=_.renderToTile;if(E){const S=h[0].canonical,O=new o.MercatorCoordinate(S.x+h[0].wrap*(1<<S.z),S.y,S.z);p.setDepthMode(o.DepthMode.disabled),p.setStencilMode(o.StencilMode.disabled),p.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),E.call(_,p.gl,O),p.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),p.setStencilMode(o.StencilMode.disabled);const b=_.renderingMode==="3d"?new o.DepthMode(c.context.gl.LEQUAL,o.DepthMode.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,o.DepthMode.ReadOnly);if(p.setDepthMode(b),c.transform.projection.name==="globe"){const E=c.transform.pointMerc;_.render(p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),o.globeToMercatorTransition(c.transform.zoom),[E.x,E.y],c.transform.pixelsPerMeterRatio)}else _.render(p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState(),p.bindFramebuffer.set(null)}}else o.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class ys{constructor(n,s,h=!1){this.context=new ne(n,h),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=o.SourceCache.maxUnderzooming+o.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Jc,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,s){const h=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new qs(this,n));const p=this._terrain;this.transform.elevation=h?p:null,p.update(n,this.transform,s)}_updateFog(n){const s=n.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,p]=s.getFovAdjustedRange(this.transform._fov);if(h>p)return void(this.transform.fogCullDistSq=null);const _=h+.78*(p-h);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,s){if(this.width=n*o.exported.devicePixelRatio,this.height=s*o.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._layers[h].resize()}setup(){const n=this.context,s=new o.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(o.EXTENT,0),s.emplaceBack(0,o.EXTENT),s.emplaceBack(o.EXTENT,o.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(s,o.posAttributes.members),this.tileExtentSegments=o.SegmentVector.simpleSegment(0,0,4,2);const h=new o.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(o.EXTENT,0),h.emplaceBack(0,o.EXTENT),h.emplaceBack(o.EXTENT,o.EXTENT),this.debugBuffer=n.createVertexBuffer(h,o.posAttributes.members),this.debugSegments=o.SegmentVector.simpleSegment(0,0,4,5);const p=new o.StructArrayLayout2i4;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(p,o.posAttributes.members),this.viewportSegments=o.SegmentVector.simpleSegment(0,0,4,2);const _=new o.StructArrayLayout4i8;_.emplaceBack(0,0,0,0),_.emplaceBack(o.EXTENT,0,o.EXTENT,0),_.emplaceBack(0,o.EXTENT,0,o.EXTENT),_.emplaceBack(o.EXTENT,o.EXTENT,o.EXTENT,o.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(_,o.boundsAttributes.members),this.mercatorBoundsSegments=o.SegmentVector.simpleSegment(0,0,4,2);const b=new o.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(b);const E=new o.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])E.emplaceBack(O);this.debugIndexBuffer=n.createIndexBuffer(E),this.emptyTexture=new o.Texture(n,new o.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=o.create();const S=this.context.gl;this.stencilClearMode=new o.StencilMode({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(o.window.performance.now()),this.atmosphereBuffer=new Fu(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,s=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,s.TRIANGLES,o.DepthMode.disabled,this.stencilClearMode,o.ColorMode.disabled,o.CullFaceMode.disabled,Ei(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,s,h){if(!s||this.currentStencilSource===s.id||!n.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(const S of h)if(this._tileClippingMaskIDs[S.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=s.id;const p=this.context,_=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(o.ColorMode.disabled),p.setDepthMode(o.DepthMode.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const S=s.getTile(E),O=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:U,tileBoundsSegments:$}=this.getTileBoundsBuffers(S);b.draw(p,_.TRIANGLES,o.DepthMode.disabled,new o.StencilMode({func:_.ALWAYS,mask:0},O,255,_.KEEP,_.KEEP,_.REPLACE),o.ColorMode.disabled,o.CullFaceMode.disabled,Ei(E.projMatrix),"$clipping",R,U,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,s=this.context.gl;return new o.StencilMode({func:s.NOTEQUAL,mask:255},n,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const s=this.context.gl;return new o.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(n){const s=this.context.gl,h=n.sort((b,E)=>E.overscaledZ-b.overscaledZ),p=h[h.length-1].overscaledZ,_=h[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const b={};for(let E=0;E<_;E++)b[E+p]=new o.StencilMode({func:s.GEQUAL,mask:255},E+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[b,h]}return[{[p]:o.StencilMode.disabled},h]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new o.ColorMode([n.CONSTANT_COLOR,n.ONE],new o.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?o.ColorMode.unblended:o.ColorMode.alphaBlended}depthModeForSublayer(n,s,h){if(!this.opaquePassEnabledForLayer())return o.DepthMode.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new o.DepthMode(h||this.context.gl.LEQUAL,s,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,s){this.style=n,this.options=s,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(o.exported.now()),this.imageManager.beginFrame();const h=this.style.order,p=this.style._sourceCaches;for(const S in p){const O=p[S];O.used&&O.prepare(this.context)}const _={},b={},E={};for(const S in p){const O=p[S];_[S]=O.getVisibleCoordinates(),b[S]=_[S].slice().reverse(),E[S]=O.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let S=0;S<h.length;S++)if(this.style._layers[h[S]].is3D()){this.opaquePassCutoff=S;break}if(this.terrain&&(this.terrain.updateTileBinding(E),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.GlobeSharedBuffers(this.context)),o.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const S of h){const O=this.style._layers[S],R=n._getLayerSourceCache(O);if(!O.hasOffscreenPass()||O.isHidden(this.transform.zoom))continue;const U=R?b[R.id]:void 0;(O.type==="custom"||O.isSky()||U&&U.length)&&this.renderLayer(this,R,O,U)}if(this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:s.showOverdrawInspector?o.Color.black:o.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const S=this.style._layers[h[this.currentLayer]],O=n._getLayerSourceCache(S);if(S.isSky())continue;const R=O?b[O.id]:void 0;this._renderTileClippingMasks(S,O,R),this.renderLayer(this,O,S,R)}if(this.style.fog&&this.transform.projection.supportsFog&&function(S,O){const R=S.context,U=R.gl,$=S.transform,J=new o.DepthMode(U.LEQUAL,o.DepthMode.ReadOnly,[0,1]),Y=S.useProgram("globeAtmosphere",null,$.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Q=o.globeToMercatorTransition($.zoom),ee=O.properties.get("color").toArray01(),W=O.properties.get("high-color").toArray01(),ae=O.properties.get("space-color").toArray01PremultipliedAlpha(),oe=o.identity$1([]);o.rotateY$1(oe,oe,-o.degToRad($._center.lng)),o.rotateX$1(oe,oe,o.degToRad($._center.lat)),o.rotateZ$1(oe,oe,$.angle),o.rotateX$1(oe,oe,-$._pitch);const le=o.fromQuat(new Float32Array(16),oe),ve=o.mapValue(O.properties.get("star-intensity"),0,1,0,.25),ge=5e-4,we=o.mapValue(O.properties.get("horizon-blend"),0,1,ge,.25),ke=o.globeUseCustomAntiAliasing(S,R,$)&&we===ge?$.worldSize/(2*Math.PI*1.025)-1:$.globeRadius,Be=S.frameCounter/1e3%1,je=o.length($.globeCenterInViewSpace),Tt=Math.sqrt(Math.pow(je,2)-Math.pow(ke,2)),Ne=Math.acos(Tt/je),st=((mt,Ve,Oe,Ze,ut,pt,Yt,zi,Vt,zt,ei,qi,si,dn)=>({u_frustum_tl:mt,u_frustum_tr:Ve,u_frustum_br:Oe,u_frustum_bl:Ze,u_horizon:ut,u_transition:pt,u_fadeout_range:Yt,u_color:zi,u_high_color:Vt,u_space_color:zt,u_star_intensity:ei,u_star_size:5*o.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:qi,u_horizon_angle:si,u_rotation_matrix:dn}))($.frustumCorners.TL,$.frustumCorners.TR,$.frustumCorners.BR,$.frustumCorners.BL,$.frustumCorners.horizon,Q,we,ee,W,ae,ve,Be,Ne,le);S.prepareDrawProgram(R,Y);const He=S.atmosphereBuffer;He&&Y.draw(R,U.TRIANGLES,J,o.StencilMode.disabled,o.ColorMode.alphaBlended,o.CullFaceMode.backCW,st,"skybox",He.vertexBuffer,He.indexBuffer,He.segments)}(this,this.style.fog),this.renderPass="sky",(o.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const S=this.style._layers[h[this.currentLayer]],O=n._getLayerSourceCache(S);S.isSky()&&this.renderLayer(this,O,S,O?b[O.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;){const S=this.style._layers[h[this.currentLayer]],O=n._getLayerSourceCache(S);if(S.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(S)){if(S.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const R=O?(S.type==="symbol"?E:b)[O.id]:void 0;this._renderTileClippingMasks(S,O,O?_[O.id]:void 0),this.renderLayer(this,O,S,R),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let S=null;o.values(this.style._layers).forEach(O=>{const R=n._getLayerSourceCache(O);R&&!O.isHidden(this.transform.zoom)&&(!S||S.getSource().maxzoom<R.getSource().maxzoom)&&(S=R)}),S&&this.options.showTileBoundaries&&bl.debug(this,S,S.getVisibleCoordinates())}this.options.showPadding&&function(S){const O=S.transform.padding;fo(S,S.transform.height-(O.top||0),3,lr),fo(S,O.bottom||0,3,Dn),Mo(S,O.left||0,3,Ec),Mo(S,S.transform.width-(O.right||0),3,On);const R=S.transform.centerPoint;(function(U,$,J,Y){Lr(U,$-1,J-10,2,20,Y),Lr(U,$-10,J-1,20,2,Y)})(S,R.x,S.transform.height-R.y,Gi)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(o.window.performance.now()),this.saveCanvasCopy())}}renderLayer(n,s,h,p){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||p&&p.length)&&(this.id=h.id,this.gpuTimingStart(h),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(h.type)||n.terrain&&h.type==="custom")&&bl[h.type](n,s,h,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let h=this.gpuTimers[n.id];h||(h=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),h.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,h.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,s=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(s),n.beginQueryEXT(n.TIME_ELAPSED_EXT,s)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const s={};for(const h in n){const p=n[h],_=this.context.extTimerQuery,b=_.getQueryObjectEXT(p.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(p.query),s[h]=b}return s}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.extTimerQuery;let h=0;for(const p of n)h+=s.getQueryObjectEXT(p,s.QUERY_RESULT_EXT)/1e6,s.deleteQueryEXT(p);return h}translatePosMatrix(n,s,h,p,_){if(!h[0]&&!h[1])return n;const b=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(b){const O=Math.sin(b),R=Math.cos(b);h=[h[0]*R-h[1]*O,h[0]*O+h[1]*R]}const E=[_?h[0]:Zn(s,h[0],this.transform.zoom),_?h[1]:Zn(s,h[1],this.transform.zoom),0],S=new Float32Array(16);return o.translate(S,n,E),S}saveTileTexture(n){const s=this._tileTextures[n.size[0]];s?s.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const s=this._tileTextures[n];return s&&s.length>0?s.pop():null}isPatternMissing(n){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,s=this.terrain&&this.terrain.exaggeration()===0,h=this.style&&this.style.fog,p=[];return this.terrainRenderModeElevated()&&p.push("TERRAIN"),this.transform.projection.name==="globe"&&p.push("GLOBE"),s&&p.push("ZERO_EXAGGERATION"),h&&!n&&h.getOpacity(this.transform.pitch)!==0&&p.push("FOG"),n&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(n,s,h){this.cache=this.cache||{};const p=h||[],_=this.currentGlobalDefines().concat(p),b=ql.cacheKey(bo[n],n,_,s);return this.cache[b]||(this.cache[b]=new ql(this.context,n,bo[n],s,Tr[n],_)),this.cache[b]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=o.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,s,h){if(this.terrain&&this.terrain.renderingToTexture)return;const p=this.style.fog;if(p){const _=p.getOpacity(this.transform.pitch),b=((E,S,O,R,U,$,J,Y,Q,ee,W)=>{const ae=E.transform,oe=S.properties.get("color").toArray01();oe[3]=R;const le=E.frameCounter/1e3%1;return{u_fog_matrix:O?ae.calculateFogTileMatrix(O):E.identityMat,u_fog_range:S.getFovAdjustedRange(ae._fov),u_fog_color:oe,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:le,u_frustum_tl:U,u_frustum_tr:$,u_frustum_br:J,u_frustum_bl:Y,u_globe_pos:Q,u_globe_radius:ee,u_viewport:W,u_globe_transition:o.globeToMercatorTransition(ae.zoom),u_is_globe:+(ae.projection.name==="globe")}})(this,p,h,_,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.exported.devicePixelRatio,this.transform.height*o.exported.devicePixelRatio]);s.setFogUniformValues(n,b)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,s=n.createTexture();return n.bindTexture(n.TEXTURE_2D,s),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const p of h)s[p.key]=n[p.key]||new o.Tile(p,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}}class Lo{constructor(n=0,s=0,h=0,p=0){if(isNaN(n)||n<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=s,this.left=h,this.right=p}interpolate(n,s,h){return s.top!=null&&n.top!=null&&(this.top=o.number(n.top,s.top,h)),s.bottom!=null&&n.bottom!=null&&(this.bottom=o.number(n.bottom,s.bottom,h)),s.left!=null&&n.left!=null&&(this.left=o.number(n.left,s.left,h)),s.right!=null&&n.right!=null&&(this.right=o.number(n.right,s.right,h)),this}getCenter(n,s){const h=o.clamp((this.left+n-this.right)/2,0,n),p=o.clamp((this.top+s-this.bottom)/2,0,s);return new o.pointGeometry(h,p)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Lo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ga(c,n){const s=o.getColumn(c,3);o.fromQuat(c,n),o.setColumn(c,3,s)}function wl(c,n){const s=o.identity$1([]);return o.rotateZ$1(s,s,-n),o.rotateX$1(s,s,-c),s}function ya(c,n){const s=[c[0],c[1],0],h=[n[0],n[1],0];if(o.length(s)>=1e-15){const b=o.normalize([],s);o.scale$2(h,b,o.dot(h,b)),n[0]=h[0],n[1]=h[1]}const p=o.cross([],n,c);if(o.len(p)<1e-15)return null;const _=Math.atan2(-p[1],p[0]);return wl(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),_)}class va{constructor(n,s){this.position=n,this.orientation=s}get position(){return this._position}set position(n){if(n){const s=n instanceof o.MercatorCoordinate?n:new o.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(s.x=o.wrap(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(n,s){if(this.orientation=null,!this.position)return;const h=this._elevation?this._elevation.getAtPointOrZero(o.MercatorCoordinate.fromLngLat(n)):0,p=this.position,_=o.MercatorCoordinate.fromLngLat(n,h),b=[_.x-p.x,_.y-p.y,_.z-p.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=ya(b,s)}setPitchBearing(n,s){this.orientation=wl(o.degToRad(n),o.degToRad(-s))}}class $l{constructor(n,s){this._transform=o.identity([]),this.orientation=s,this.position=n}get mercatorPosition(){const n=this.position;return new o.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=o.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var s;n&&o.setColumn(this._transform,3,[(s=n)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||o.identity$1([]),n&&ga(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,s){this._orientation=wl(n,s),ga(this._transform,this._orientation)}forward(){const n=o.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=o.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=o.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,s){const h=new Float64Array(16);return o.invert(h,this.getWorldToCamera(n,s)),h}getWorldToCameraPosition(n,s,h){const p=this.position;o.scale$2(p,p,-n);const _=new Float64Array(16);return o.fromScaling(_,[h,h,h]),o.translate(_,_,p),_[10]*=s,_}getWorldToCamera(n,s){const h=new Float64Array(16),p=new Float64Array(4),_=this.position;return o.conjugate(p,this._orientation),o.scale$2(_,_,-n),o.fromQuat(h,p),o.translate(h,h,_),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(n,s,h,p){const _=new Float64Array(16);return o.perspective(_,n,s,h,p),_}getDistanceToElevation(n,s=!1){const h=n===0?0:o.mercatorZfromAltitude(n,s?o.latFromMercatorY(this.position[1]):this.position[1]),p=this.forward();return(h-this.position[2])/p[2]}clone(){return new $l([...this.position],[...this.orientation])}}function qa(c,n){const s=Ys(c.projection,c.zoom,c.width,c.height),h=function(_,b,E,S,O){const R=new o.LngLat(E.lng-180*fs,E.lat),U=new o.LngLat(E.lng+180*fs,E.lat),$=_.project(R.lng,R.lat),J=_.project(U.lng,U.lat),Y=-Math.atan2(J.y-$.y,J.x-$.x),Q=o.MercatorCoordinate.fromLngLat(E);Q.y=o.clamp(Q.y,-.999975,.999975);const ee=Q.toLngLat(),W=_.project(ee.lng,ee.lat),ae=o.MercatorCoordinate.fromLngLat(ee);ae.x+=fs;const oe=ae.toLngLat(),le=_.project(oe.lng,oe.lat),ve=au(le.x-W.x,le.y-W.y,Y),ge=o.MercatorCoordinate.fromLngLat(ee);ge.y+=fs;const we=ge.toLngLat(),ke=_.project(we.lng,we.lat),Be=au(ke.x-W.x,ke.y-W.y,Y),je=Math.abs(ve.x)/Math.abs(Be.y),Tt=o.identity([]);o.rotateZ(Tt,Tt,-Y*(1-(O?0:S)));const Ne=o.identity([]);return o.scale(Ne,Ne,[1,1-(1-je)*S,1]),Ne[4]=-Be.x/Be.y*S,o.rotateZ(Ne,Ne,Y),o.multiply(Ne,Tt,Ne),Ne}(c.projection,0,c.center,s,n),p=su(c);return o.scale(h,h,[p,p,1]),h}function su(c){const n=c.projection,s=Ys(c.projection,c.zoom,c.width,c.height),h=Tl(n,c.center),p=Tl(n,o.LngLat.convert(n.center));return Math.pow(2,h*s+(1-s)*p)}function Ys(c,n,s,h,p=1/0){const _=c.range;if(!_)return 0;const b=Math.min(p,Math.max(s,h)),E=Math.log(b/1024)/Math.LN2;return o.smoothstep(_[0]+E,_[1]+E,n)}const fs=1/4e4;function Tl(c,n){const s=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=new o.LngLat(n.lng-180*fs,s),p=new o.LngLat(n.lng+180*fs,s),_=c.project(h.lng,s),b=c.project(p.lng,s),E=o.MercatorCoordinate.fromLngLat(h),S=o.MercatorCoordinate.fromLngLat(p),O=b.x-_.x,R=b.y-_.y,U=S.x-E.x,$=S.y-E.y,J=Math.sqrt((U*U+$*$)/(O*O+R*R));return Math.log(J)/Math.LN2}function au(c,n,s){const h=Math.cos(s),p=Math.sin(s);return{x:c*h-n*p,y:c*p+n*h}}class Ot{constructor(n,s,h,p,_,b,E){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=n||0,this._maxZoom=s||22,this._minPitch=h??0,this._maxPitch=p??60,this.setProjection(b),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new o.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Lo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new $l,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new Ot(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,s=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(n||h)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return o.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.getProjection(this.projectionOptions);const h=!B(s,this.getProjection());return h&&this._calcMatrices(),this.mercatorFromTransition=!1,h}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.getProjection({name:"mercator"});const s=n!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.pointGeometry(this.width,this.height)}get bearing(){return o.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const s=-n*Math.PI/180;var h;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(h=new o.ARRAY_TYPE(4),o.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),function(p,_,b){var E=_[0],S=_[1],O=_[2],R=_[3],U=Math.sin(b),$=Math.cos(b);p[0]=E*$+O*U,p[1]=S*$+R*U,p[2]=E*-U+O*$,p[3]=S*-U+R*$}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const s=o.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=o.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const s=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let p=0,_=0;for(let b=0;b<s.length;b++){const E=new o.pointGeometry(s[b][0]*this.width,h+s[b][1]*(this.height-h)),S=n.pointCoordinate(E);if(!S)continue;const O=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);p+=S[3]*O,_+=O}return _===0?NaN:p/_}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,p=this._mercatorZfromZoom(n),_=this._mercatorZfromZoom(this._maxZoom),b=Math.max(p-h,_);this._setZoom(this._zoomFromMercatorZ(b))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let h;h=n.z<this._camera.position[2]?[s.x,s.y,s.z]:[n.x,n.y,n.z];const p=o.length(o.sub([],this._camera.position,h));return o.clamp(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let s=!1;if(n.orientation&&!o.exactEquals(n.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(n.orientation)),n.position){const h=[n.position.x,n.position.y,n.position.z];o.exactEquals$1(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,s=new va;return s.position=new o.MercatorCoordinate(n[0],n[1],n[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(n){if(!o.length$1(n))return!1;o.normalize$1(n,n);const s=o.transformQuat([],[0,0,-1],n),h=o.transformQuat([],[0,-1,0],n);if(h[2]<0)return!1;const p=ya(s,h);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(n){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;n[2]=o.clamp(n[2],p/h,p/s),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,s,h){this._unmodified=!1,this._edgeInsets.interpolate(n,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const s=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(n){const s=[new o.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const h=this.pointCoordinate(new o.pointGeometry(0,0)),p=this.pointCoordinate(new o.pointGeometry(this.width,0)),_=this.pointCoordinate(new o.pointGeometry(this.width,this.height)),b=this.pointCoordinate(new o.pointGeometry(0,this.height)),E=Math.floor(Math.min(h.x,p.x,_.x,b.x)),S=Math.floor(Math.max(h.x,p.x,_.x,b.x)),O=1;for(let R=E-O;R<=S+O;R++)R!==0&&s.push(new o.UnwrappedTileID(R,n))}return s}coveringTiles(n){let s=this.coveringZoomLevel(n);const h=s,p=this.elevation&&!n.isTerrainDEM,_=this.projection.name==="mercator";if(n.minzoom!==void 0&&s<n.minzoom)return[];n.maxzoom!==void 0&&s>n.maxzoom&&(s=n.maxzoom);const b=this.locationCoordinate(this.center),E=this.center.lat,S=1<<s,O=[S*b.x,S*b.y,0],R=this.projection.name==="globe",U=!R,$=o.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,U),J=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=S*o.mercatorZfromAltitude(1,this.center.lat),Q=this._camera.position[2]/o.mercatorZfromAltitude(1,this.center.lat),ee=[S*J.x,S*J.y,Q*(U?1:Y)],W=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ae=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?s:0,oe=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,le=n.isTerrainDEM?-oe:this._elevation?this._elevation.getMinElevationBelowMSL():0,ve=this.projection.isReprojectedInTileSpace?su(this):1,ge=Ve=>{const Ze=new o.MercatorCoordinate(Ve.x+25e-6,Ve.y,Ve.z),ut=new o.MercatorCoordinate(Ve.x,Ve.y+25e-6,Ve.z),pt=Ve.toLngLat(),Yt=Ze.toLngLat(),zi=ut.toLngLat(),Vt=this.locationCoordinate(pt),zt=this.locationCoordinate(Yt),ei=this.locationCoordinate(zi),qi=Math.hypot(zt.x-Vt.x,zt.y-Vt.y),si=Math.hypot(ei.x-Vt.x,ei.y-Vt.y);return Math.sqrt(qi*si)*ve/25e-6},we=Ve=>{const Oe=oe,Ze=le;return{aabb:o.tileAABB(this,S,0,0,0,Ve,Ze,Oe,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:Oe,wrap:Ve,fullyVisible:!1}},ke=[];let Be=[];const je=s,Tt=n.reparseOverscaled?h:s,Ne=Ve=>Ve*Ve,st=Ne((Q-this._centerAltitude)*Y),He=Ve=>{if(!this._elevation||!Ve.tileID||!_)return;const Oe=this._elevation.getMinMaxForTile(Ve.tileID),Ze=Ve.aabb;Oe?(Ze.min[2]=Oe.min,Ze.max[2]=Oe.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(Ve.shouldSplit=mt(Ve),Ve.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},mt=Ve=>{if(Ve.zoom<ae)return!0;if(Ve.zoom===je)return!1;if(Ve.shouldSplit!=null)return Ve.shouldSplit;const Oe=Ve.aabb.distanceX(ee),Ze=Ve.aabb.distanceY(ee);let ut=st,pt=1;if(R){ut=Ne(Ve.aabb.distanceZ(ee));const Vt=Math.pow(2,Ve.zoom),zt=o.latFromMercatorY((Ve.y+1)/Vt),ei=o.latFromMercatorY(Ve.y/Vt),qi=Math.min(Math.max(E,zt),ei),si=o.circumferenceAtLatitude(qi)/o.circumferenceAtLatitude(E);if(pt=qi===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,si/this._mercatorScaleRatio),this.zoom<=o.GLOBE_ZOOM_THRESHOLD_MIN&&Ve.zoom===je-1&&si>=.9)return!0}else if(p&&(ut=Ne(Ve.aabb.distanceZ(ee)*Y)),this.projection.isReprojectedInTileSpace&&h<=5){const Vt=Math.pow(2,Ve.zoom),zt=ge(new o.MercatorCoordinate((Ve.x+.5)/Vt,(Ve.y+.5)/Vt));pt=zt>.85?1:zt}const Yt=Oe*Oe+Ze*Ze+ut,zi=Ne((1<<je-Ve.zoom)*W*pt*((Vt,zt)=>{if(zt*Ne(.707)<Vt)return 1;const ei=Math.sqrt(zt/Vt);return ei/(1.4144271570014144+(Math.pow(1.1,ei-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ut,st),Yt));return Yt<zi};if(this.renderWorldCopies)for(let Ve=1;Ve<=3;Ve++)ke.push(we(-Ve)),ke.push(we(Ve));for(ke.push(we(0));ke.length>0;){const Ve=ke.pop(),Oe=Ve.x,Ze=Ve.y;let ut=Ve.fullyVisible;if(!ut){const pt=Ve.aabb.intersects($);if(pt===0)continue;ut=pt===2}if(Ve.zoom!==je&&mt(Ve))for(let pt=0;pt<4;pt++){const Yt=(Oe<<1)+pt%2,zi=(Ze<<1)+(pt>>1),Vt={aabb:_?Ve.aabb.quadrant(pt):o.tileAABB(this,S,Ve.zoom+1,Yt,zi,Ve.wrap,Ve.minZ,Ve.maxZ,this.projection),zoom:Ve.zoom+1,x:Yt,y:zi,wrap:Ve.wrap,fullyVisible:ut,tileID:void 0,shouldSplit:void 0,minZ:Ve.minZ,maxZ:Ve.maxZ};p&&!R&&(Vt.tileID=new o.OverscaledTileID(Ve.zoom+1===je?Tt:Ve.zoom+1,Ve.wrap,Ve.zoom+1,Yt,zi),He(Vt)),ke.push(Vt)}else{const pt=Ve.zoom===je?Tt:Ve.zoom;if(n.minzoom&&n.minzoom>pt)continue;const Yt=O[0]-(.5+Oe+(Ve.wrap<<Ve.zoom))*(1<<s-Ve.zoom),zi=O[1]-.5-Ze,Vt=Ve.tileID?Ve.tileID:new o.OverscaledTileID(pt,Ve.wrap,Ve.zoom,Oe,Ze);Be.push({tileID:Vt,distanceSq:Yt*Yt+zi*zi})}}if(this.fogCullDistSq){const Ve=this.fogCullDistSq,Oe=this.horizonLineFromTop();Be=Be.filter(Ze=>{const ut=[0,0,0,1],pt=[o.EXTENT,o.EXTENT,0,1],Yt=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());o.transformMat4$1(ut,ut,Yt),o.transformMat4$1(pt,pt,Yt);const zi=o.getAABBPointSquareDist(ut,pt);if(zi===0)return!0;let Vt=!1;const zt=this._elevation;if(zt&&zi>Ve&&Oe!==0){const ei=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let qi;n.isTerrainDEM||(qi=zt.getMinMaxForTile(Ze.tileID)),qi||(qi={min:le,max:oe});const si=o.furthestTileCorner(this.rotation),dn=[si[0]*o.EXTENT,si[1]*o.EXTENT,qi.max];o.transformMat4(dn,dn,ei),Vt=(1-dn[1])*this.height*.5<Oe}return zi<Ve||Vt})}return Be.sort((Ve,Oe)=>Ve.distanceSq-Oe.distanceSq).map(Ve=>Ve.tileID)}resize(n,s){this.width=n,this.height=s,this.pixelsToGLUnits=[2/n,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const s=o.clamp(n.lat,-o.MAX_MERCATOR_LATITUDE,o.MAX_MERCATOR_LATITUDE),h=this.projection.project(n.lng,s);return new o.pointGeometry(h.x*this.worldSize,h.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,s){let h,p;const _=this.centerPoint;if(this.projection.name==="globe"){const E=this.worldSize;h=(s.x-_.x)/E,p=(s.y-_.y)/E}else{const E=this.pointCoordinate(s),S=this.pointCoordinate(_);h=E.x-S.x,p=E.y-S.y}const b=this.locationCoordinate(n);this.setLocation(new o.MercatorCoordinate(b.x-h,b.y-p))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,s){const h=s?o.mercatorZfromAltitude(s,n.lat):void 0,p=this.projection.project(n.lng,n.lat);return new o.MercatorCoordinate(p.x,p.y,h)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,s){const h=s??this._centerAltitude,p=[n.x,n.y,0,1],_=[n.x,n.y,1,1];o.transformMat4$1(p,p,this.pixelMatrixInverse),o.transformMat4$1(_,_,this.pixelMatrixInverse);const b=_[3];o.scale$1(p,p,1/p[3]),o.scale$1(_,_,1/b);const E=p[2],S=_[2];return{p0:p,p1:_,t:E===S?0:(h-E)/(S-E)}}screenPointToMercatorRay(n){const s=[n.x,n.y,0,1],h=[n.x,n.y,1,1];return o.transformMat4$1(s,s,this.pixelMatrixInverse),o.transformMat4$1(h,h,this.pixelMatrixInverse),o.scale$1(s,s,1/s[3]),o.scale$1(h,h,1/h[3]),s[2]=o.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,h[2]=o.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,o.scale$1(s,s,1/this.worldSize),o.scale$1(h,h,1/this.worldSize),new o.Ray([s[0],s[1],s[2]],o.normalize([],o.sub([],h,s)))}rayIntersectionCoordinate(n){const{p0:s,p1:h,t:p}=n,_=o.mercatorZfromAltitude(s[2],this._center.lat),b=o.mercatorZfromAltitude(h[2],this._center.lat);return new o.MercatorCoordinate(o.number(s[0],h[0],p)/this.worldSize,o.number(s[1],h[1],p)/this.worldSize,o.number(_,b,p))}pointCoordinate(n,s=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,s)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let s=this.projection.pointCoordinate3D(this,n.x,n.y);if(s)return new o.MercatorCoordinate(s[0],s[1],s[2]);let h=0,p=this.horizonLineFromTop();if(n.y>p)return this.pointCoordinate(n);const _=.02*p,b=n.clone();for(let E=0;E<10&&p-h>_;E++){b.y=o.number(h,p,.66);const S=this.projection.pointCoordinate3D(this,b.x,b.y);S?(p=b.y,s=S):h=b.y}return s?new o.MercatorCoordinate(s[0],s[1],s[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}_coordinatePoint(n,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,p=[n.x*this.worldSize,n.y*this.worldSize,h+n.toAltitude(),1];return o.transformMat4$1(p,p,this.pixelMatrix),p[3]>0?new o.pointGeometry(p[0]/p[3],p[1]/p[3]):new o.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:s}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,_=this.pointLocation3D(new o.pointGeometry(s,n)),b=this.pointLocation3D(new o.pointGeometry(p,n)),E=this.pointLocation3D(new o.pointGeometry(p,h)),S=this.pointLocation3D(new o.pointGeometry(s,h));let O=Math.min(_.lng,b.lng,E.lng,S.lng),R=Math.max(_.lng,b.lng,E.lng,S.lng),U=Math.min(_.lat,b.lat,E.lat,S.lat),$=Math.max(_.lat,b.lat,E.lat,S.lat);const J=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,Q=(ee,W,ae,oe,le)=>{const ve=(ee+ae)/2,ge=(W+oe)/2,we=new o.pointGeometry(ve,ge),{lng:ke,lat:Be}=this.pointLocation3D(we),je=Math.max(0,O-ke,U-Be,ke-R,Be-$);O=Math.min(O,ke),R=Math.max(R,ke),U=Math.min(U,Be),$=Math.max($,Be),(le<Y||je>J)&&(Q(ee,W,ve,ge,le+1),Q(ve,ge,ae,oe,le+1))};if(Q(s,n,p,n,1),Q(p,n,p,h,1),Q(p,h,s,h,1),Q(s,h,s,n,1),this.projection.name==="globe"){const[ee,W]=o.polesInViewport(this);ee?($=90,R=180,O=-180):W&&(U=-90,R=180,O=-180)}return new o.LngLatBounds(new o.LngLat(O,U),new o.LngLat(R,$))}_getBoundsRectangular(n,s){const{top:h,left:p}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,E=new o.pointGeometry(p,h),S=new o.pointGeometry(b,h),O=new o.pointGeometry(b,_),R=new o.pointGeometry(p,_);let U=this.pointCoordinate(E,n),$=this.pointCoordinate(S,n);const J=this.pointCoordinate(O,s),Y=this.pointCoordinate(R,s),Q=(ee,W)=>(W.y-ee.y)/(W.x-ee.x);return U.y>1&&$.y>=0?U=new o.MercatorCoordinate((1-Y.y)/Q(Y,U)+Y.x,1):U.y<0&&$.y<=1&&(U=new o.MercatorCoordinate(-Y.y/Q(Y,U)+Y.x,0)),$.y>1&&U.y>=0?$=new o.MercatorCoordinate((1-J.y)/Q(J,$)+J.x,1):$.y<0&&U.y<=1&&($=new o.MercatorCoordinate(-J.y/Q(J,$)+J.x,0)),new o.LngLatBounds().extend(this.coordinateLocation(U)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(J))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=n.visibleDemTiles.reduce((h,p)=>{if(p.dem){const _=p.dem.tree;h.min=Math.min(h.min,_.minimums[0]),h.max=Math.max(h.max,_.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*n.exaggeration(),s.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return n?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-o.MAX_MERCATOR_LATITUDE,this.maxLat=o.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=o.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=o.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=o.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,s){return this.projection.createTileMatrix(this,s,n)}calculateDistanceTileData(n){const s=n.key,h=this._distanceTileDataCache;if(h[s])return h[s];const p=n.canonical,_=1/this.height,b=this.cameraWorldSize,E=b/this.zoomScale(p.z),S=(p.x+Math.pow(2,p.z)*n.wrap)*E,O=p.y*E,R=this.point;R.x*=b/this.worldSize,R.y*=b/this.worldSize;const U=this.angle,$=Math.sin(-U),J=-Math.cos(-U);return h[s]={bearing:[$,J],center:[(R.x-S)*_,(R.y-O)*_],scale:E/o.EXTENT*_},h[s]}calculateFogTileMatrix(n){const s=n.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return o.multiply(p,this.worldToFogMatrix,p),h[s]=new Float32Array(p),h[s]}calculateProjMatrix(n,s=!1){const h=n.key,p=s?this._alignedProjMatrixCache:this._projMatrixCache;if(p[h])return p[h];const _=this.calculatePosMatrix(n,this.worldSize);return o.multiply(_,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:s?this.alignedProjMatrix:this.projMatrix,_),p[h]=new Float32Array(_),p[h]}calculatePixelsToTileUnitsMatrix(n){const s=n.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const p=function(_,b){const{scale:E}=_.tileTransform,S=E*o.EXTENT/(_.tileSize*Math.pow(2,b.zoom-_.tileID.overscaledZ+_.tileID.canonical.z));return O=new Float32Array(4),$=(R=b.inverseAdjustmentMatrix)[1],J=R[2],Y=R[3],ee=(U=[S,S])[1],O[0]=R[0]*(Q=U[0]),O[1]=$*Q,O[2]=J*ee,O[3]=Y*ee,O;var O,R,U,$,J,Y,Q,ee}(n,this);return h[s]=p,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,s=o.fromScaling([],[n,n,n]);return o.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const s=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),p=this._camera.forward(),_=o.mercatorZfromAltitude(1,this._center.lat);h[2]/=_,p[2]/=_,o.normalize(p,p);const b=n.raycast(h,p,n.exaggeration());if(b){const E=o.scaleAndAdd([],h,p,b),S=new o.MercatorCoordinate(E[0],E[1],o.mercatorZfromAltitude(E[2],o.latFromMercatorY(E[1]))),O=(S.z+o.length([S.x-h[0],S.y-h[1],S.z-h[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(O),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const s=this._elevation,h=o.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(h),_=s.getAtPointOrZero(new o.MercatorCoordinate(...p)),b=this.pixelsPerMeter/this.worldSize*_,E=this._minimumHeightOverTerrain(),S=p[2]-b;if(S<=E)if(S<0||n){const O=this.locationCoordinate(this._center,this._centerAltitude),R=[p[0],p[1],O.z-p[2]],U=o.length(R);R[2]-=(E-S)/this._pixelsPerMercatorPixel;const $=o.length(R);if($===0)return;o.scale$2(R,R,U/$*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],O.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const $=this.center;return $.lat=o.clamp($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&($.lng=o.clamp($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:p}=this.point;let _=0,b=h,E=p;const S=this.width/2,O=this.height/2,R=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(p-O<R&&(E=R+O),p+O>U&&(E=U-O),U-R<this.height&&(_=Math.max(_,this.height/(U-R)),E=(U+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,J=this.worldMaxX*this.scale,Y=this.worldSize/2-($+J)/2;b=(h+Y+this.worldSize)%this.worldSize-Y,b-S<$&&(b=$+S),b+S>J&&(b=J-S),J-$<this.width&&(_=Math.max(_,this.width/(J-$)),b=(J+$)/2)}b===h&&E===p||(this.center=this.unproject(new o.pointGeometry(b,E))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,s=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.mercatorZfromAltitude(1,this.center.lat)/o.mercatorZfromAltitude(1,o.GLOBE_SCALE_MATCH_LATITUDE));const h=Ys(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,h),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const p=this.projection.zAxisUnit==="meters"?s:1,_=this._camera.getWorldToCamera(this.worldSize,p),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-n.x/this.width,b[9]=2*n.y/this.height;let E=o.mul([],b,_);if(this.projection.isReprojectedInTileSpace){const ge=this.locationCoordinate(this.center),we=o.identity([]);o.translate(we,we,[ge.x*this.worldSize,ge.y*this.worldSize,0]),o.multiply(we,we,qa(this)),o.translate(we,we,[-ge.x*this.worldSize,-ge.y*this.worldSize,0]),o.multiply(E,E,we),this.inverseAdjustmentMatrix=function(ke){const Be=qa(ke,!0);return Ht([],[Be[0],Be[1],Be[4],Be[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=o.scale([],E,[this.worldSize,this.worldSize,this.worldSize/p,1]),this.projMatrix=E,this.invProjMatrix=o.invert(new Float64Array(16),this.projMatrix);const S=o.invert([],b);this.frustumCorners=o.FrustumCorners.fromInvProjectionMatrix(S,this.horizonLineFromTop(),this.height);const O=new Float32Array(16);o.identity(O),o.scale(O,O,[1,-1,1]),o.rotateX(O,O,this._pitch),o.rotateZ(O,O,this.angle);const R=o.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;R[8]=2*-n.x/this.width,R[9]=2*(n.y+U)/this.height,this.skyboxMatrix=o.multiply(O,R,O);const $=this.point,J=$.x,Y=$.y,Q=this.width%2/2,ee=this.height%2/2,W=Math.cos(this.angle),ae=Math.sin(this.angle),oe=J-Math.round(J)+W*Q+ae*ee,le=Y-Math.round(Y)+W*ee+ae*Q,ve=new Float64Array(E);if(o.translate(ve,ve,[oe>.5?oe-1:oe,le>.5?le-1:le,0]),this.alignedProjMatrix=ve,E=o.create(),o.scale(E,E,[this.width/2,-this.height/2,1]),o.translate(E,E,[1,-1,0]),this.labelPlaneMatrix=E,E=o.create(),o.scale(E,E,[1,-1,1]),o.translate(E,E,[-1,-1,0]),o.scale(E,E,[2/this.width,2/this.height,1]),this.glCoordMatrix=E,this.pixelMatrix=o.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},E=o.invert(new Float64Array(16),this.pixelMatrix),!E)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=E,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.calculateGlobeMatrix(this);const ge=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.transformMat4(ge,ge,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=E;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,h=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,_=[n,n,s];o.scale$2(_,_,p),o.scale$2(h,h,-1),o.multiply$2(h,h,_);const b=o.create();o.translate(b,b,h),o.scale(b,b,_),this.mercatorFogMatrix=b,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,s,p)}_computeCameraPosition(n){const s=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),p=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-n/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-h[0]*_,p.y/this.worldSize-h[1]*_,n/this.worldSize*this._centerAltitude-h[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],p=n[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(_=Math.min((s-h)/p,1)),this._camera.position=o.scaleAndAdd([],this._camera.position,n,_),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:p}=this._camera.getPitchBearing(),_=o.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,b=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.degToRad(this._maxPitch)),E=Math.max((n[2]-_)/Math.cos(h),b),S=this._zoomFromMercatorZ(E);o.scaleAndAdd(n,n,s,E),this._pitch=o.clamp(h,o.degToRad(this.minPitch),o.degToRad(this.maxPitch)),this.angle=o.wrap(p,-Math.PI,Math.PI),this._setZoom(o.clamp(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let s=0,h=o.GLOBE_ZOOM_THRESHOLD_MAX,p=0,_=1/0;for(;h-s>1e-6&&h>s;){const b=s+.5*(h-s),E=this.tileSize*Math.pow(2,b),S=this.getCameraToCenterDistance(this.projection,b,E),O=this.scaleZoom(S/(n*this.tileSize)),R=Math.abs(b-O);R<_&&(_=R,p=b),b<O?s=b:h=b}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,s){const h=Math.min(n.x,s.x),p=Math.max(n.x,s.x),_=Math.min(n.y,s.y),b=Math.max(n.y,s.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const E=[new o.pointGeometry(h,_),new o.pointGeometry(p,b),new o.pointGeometry(h,b),new o.pointGeometry(p,_)],S=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const R of E){const U=this.pointRayIntersection(R);if(U.t<0)return!0;const $=this.rayIntersectionCoordinate(U);if($.x<S||$.y<0||$.x>O||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.pointGeometry(0,0),new o.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,s){const h=o.length(o.sub([],this._camera.position,n)),p=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([s,h,p],_){const b=[s,h,p,1];o.transformMat4$1(b,b,_);const E=b[3]=Math.max(b[3],1e-6);return b[0]/=E,b[1]/=E,b[2]/=E,b}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.pointGeometry(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.pointGeometry(0,n))}}getCameraToCenterDistance(n,s=this.zoom,h=this.worldSize){const p=Ys(n,s,this.width,this.height,1024),_=n.pixelSpaceConversion(this.center.lat,h,p);return .5/Math.tan(.5*this._fov)*this.height*_}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.multiply(n,n,this.globeMatrix),n}}function vs(c,n){let s=!1,h=null;const p=()=>{h=null,s&&(c(),h=setTimeout(p,n),s=!1)};return()=>(s=!0,h||p(),h)}class lu{constructor(n){this._hashName=n&&encodeURIComponent(n),o.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=vs(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,o.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),o.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const s=Ac(n);if(this._hashName){const h=this._hashName;let p=!1;const _=o.window.location.hash.slice(1).split("&").map(b=>{const E=b.split("=")[0];return E===h?(p=!0,`${E}=${s}`):b}).filter(b=>b);return p||_.push(`${h}=${s}`),`#${_.join("&")}`}return`#${s}`}_getCurrentHash(){const n=o.window.location.hash.replace("#","");if(this._hashName){let s;return n.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(s[3]||0):n.getBearing();return n.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=o.window.location.href.replace(/(#.+)?$/,this.getHashString());o.window.history.replaceState(o.window.history.state,null,n)}}function Ac(c,n){const s=c.getCenter(),h=Math.round(100*c.getZoom())/100,p=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),b=Math.round(s.lng*_)/_,E=Math.round(s.lat*_)/_,S=c.getBearing(),O=c.getPitch();let R=n?`/${b}/${E}/${h}`:`${h}/${E}/${b}`;return(S||O)&&(R+="/"+Math.round(10*S)/10),O&&(R+=`/${Math.round(O)}`),R}const Xl={linearity:.3,easing:o.bezier(0,0,.3,1)},Sc=o.extend({deceleration:2500,maxSpeed:1400},Xl),fh=o.extend({deceleration:20,maxSpeed:1400},Xl),Nu=o.extend({deceleration:1e3,maxSpeed:360},Xl),ph=o.extend({deceleration:1e3,maxSpeed:90},Xl);class Ar{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,s=o.exported.now();for(;n.length>0&&s-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new o.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const _=cu(s.pan.mag(),h,o.extend({},Sc,n||{}));p.offset=s.pan.mult(_.amount/s.pan.mag()),p.center=this._map.transform.center,Nr(p,_)}if(s.zoom){const _=cu(s.zoom,h,fh);p.zoom=this._map.transform.zoom+_.amount,Nr(p,_)}if(s.bearing){const _=cu(s.bearing,h,Nu);p.bearing=this._map.transform.bearing+o.clamp(_.amount,-179,179),Nr(p,_)}if(s.pitch){const _=cu(s.pitch,h,ph);p.pitch=this._map.transform.pitch+_.amount,Nr(p,_)}if(p.zoom||p.bearing){const _=s.pinchAround===void 0?s.around:s.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function Nr(c,n){(!c.duration||c.duration<n.duration)&&(c.duration=n.duration,c.easing=n.easing)}function cu(c,n,s){const{maxSpeed:h,linearity:p,deceleration:_}=s,b=o.clamp(c*p/(n/1e3),-h,h),E=Math.abs(b)/(_*p);return{easing:s.easing,duration:1e3*E,amount:b*(E/2)}}class eo extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,h,p={}){const _=$e(s.getCanvasContainer(),h),b=s.unproject(_);super(n,o.extend({point:_,lngLat:b,originalEvent:h},p)),this._defaultPrevented=!1,this.target=s}}class uu extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,h){const p=n==="touchend"?h.changedTouches:h.touches,_=Wt(s.getCanvasContainer(),p),b=_.map(S=>s.unproject(S)),E=_.reduce((S,O,R,U)=>S.add(O.div(U.length)),new o.pointGeometry(0,0));super(n,{points:_,point:E,lngLats:b,lngLat:s.unproject(E),originalEvent:h}),this._defaultPrevented=!1}}class bf extends o.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,s,h){super(n,{originalEvent:h}),this._defaultPrevented=!1}}class Uu{constructor(n,s){this._map=n,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new bf(n.type,this._map,n))}mousedown(n,s){return this._mousedownPos=s,this._firePreventable(new eo(n.type,this._map,n))}mouseup(n){this._map.fire(new eo(n.type,this._map,n))}preclick(n){const s=o.extend({},n);s.type="preclick",this._map.fire(new eo(s.type,this._map,s))}click(n,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(n),this._map.fire(new eo(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new eo(n.type,this._map,n))}mouseover(n){this._map.fire(new eo(n.type,this._map,n))}mouseout(n){this._map.fire(new eo(n.type,this._map,n))}touchstart(n){return this._firePreventable(new uu(n.type,this._map,n))}touchmove(n){this._map.fire(new uu(n.type,this._map,n))}touchend(n){this._map.fire(new uu(n.type,this._map,n))}touchcancel(n){this._map.fire(new uu(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class El{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new eo(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new eo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new eo(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hu{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,s){this.isEnabled()&&n.shiftKey&&n.button===0&&(Je(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(n,s){if(!this._active)return;const h=s,p=this._startPos,_=this._lastPos;if(!p||!_||_.equals(h)||!this._box&&h.dist(p)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=Re("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const b=Math.min(p.x,h.x),E=Math.max(p.x,h.x),S=Math.min(p.y,h.y),O=Math.max(p.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${S}px)`,this._box.style.width=E-b+"px",this._box.style.height=O-S+"px")})}mouseupWindow(n,s){if(!this._active)return;const h=this._startPos,p=s;if(h&&n.button===0){if(this.reset(),lt(),h.x!==p.x||h.y!==p.y)return this._map.fire(new o.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:_=>_.fitScreenCoordinates(h,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Qe(),delete this._startPos,delete this._lastPos}_fireEvent(n,s){return this._map.fire(new o.Event(n,{originalEvent:s}))}}function Za(c,n){const s={};for(let h=0;h<c.length;h++)s[c[h].identifier]=n[h];return s}class Ic{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),h.length===this.numTouches&&(this.centroid=function(p){const _=new o.pointGeometry(0,0);for(const b of p)_._add(b);return _.div(p.length)}(s),this.touches=Za(h,s)))}touchmove(n,s,h){if(this.aborted||!this.centroid)return;const p=Za(h,s);for(const _ in this.touches){const b=this.touches[_],E=p[_];(!E||E.dist(b)>30)&&(this.aborted=!0)}}touchend(n,s,h){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class xa{constructor(n){this.singleTap=new Ic(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,s,h){this.singleTap.touchstart(n,s,h)}touchmove(n,s,h){this.singleTap.touchmove(n,s,h)}touchend(n,s,h){const p=this.singleTap.touchend(n,s,h);if(p){const _=n.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(p)<30;if(_&&b||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Cc{constructor(){this._zoomIn=new xa({numTouches:1,numTaps:2}),this._zoomOut=new xa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,s,h){this._zoomIn.touchstart(n,s,h),this._zoomOut.touchstart(n,s,h)}touchmove(n,s,h){this._zoomIn.touchmove(n,s,h),this._zoomOut.touchmove(n,s,h)}touchend(n,s,h){const p=this._zoomIn.touchend(n,s,h),_=this._zoomOut.touchend(n,s,h);return p?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()+1,around:b.unproject(p)},{originalEvent:n})}):_?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:b.getZoom()-1,around:b.unproject(_)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Kl={0:1,2:2};class Vu{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,s){return!1}_move(n,s){return{}}mousedown(n,s){if(this._lastPoint)return;const h=ti(n);this._correctButton(n,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(n,s){const h=this._lastPoint;if(h){if(n.preventDefault(),this._eventButton!=null&&function(p,_){const b=Kl[_];return p.buttons===void 0||(p.buttons&b)!==b}(n,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(n){this._lastPoint&&ti(n)===this._eventButton&&(this._moved&&lt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sd extends Vu{mousedown(n,s){super.mousedown(n,s),this._lastPoint&&(this._active=!0)}_correctButton(n,s){return s===0&&!n.ctrlKey}_move(n,s){return{around:s,panDelta:s.sub(n)}}}class mh extends Vu{_correctButton(n,s){return s===0&&n.ctrlKey||s===2}_move(n,s){const h=.8*(s.x-n.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(n){n.preventDefault()}}class _h extends Vu{_correctButton(n,s){return s===0&&n.ctrlKey||s===2}_move(n,s){const h=-.5*(s.y-n.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(n){n.preventDefault()}}class Mc{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.pointGeometry(0,0)}touchstart(n,s,h){return this._calculateTransform(n,s,h)}touchmove(n,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!o.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,s,h)}}touchend(n,s,h){this._calculateTransform(n,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,s,h){h.length>0&&(this._active=!0);const p=Za(h,s),_=new o.pointGeometry(0,0),b=new o.pointGeometry(0,0);let E=0;for(const O in p){const R=p[O],U=this._touches[O];U&&(_._add(R),b._add(R.sub(U)),E++,p[O]=R)}if(this._touches=p,E<this._minTouches||!b.mag())return;const S=b.div(E);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(E),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Re("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Yl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,s,h){return{}}touchstart(n,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(n,s,h){const p=this._firstTwoTouches;if(!p)return;n.preventDefault();const[_,b]=p,E=Ha(h,s,_),S=Ha(h,s,b);if(!E||!S)return;const O=this._aroundCenter?null:E.add(S).div(2);return this._move([E,S],O,n)}touchend(n,s,h){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,b=Ha(h,s,p),E=Ha(h,s,_);b&&E||(this._active&&lt(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ha(c,n,s){for(let h=0;h<c.length;h++)if(c[h].identifier===s)return n[h]}function gh(c,n){return Math.log(c/n)/Math.LN2}class K extends Yl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,s){const h=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(gh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gh(this._distance,h),pinchAround:s}}}function Al(c,n){return 180*c.angleWith(n)/Math.PI}class du extends Yl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,s){const h=this._vector;if(this._vector=n[0].sub(n[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Al(this._vector,h),pinchAround:s}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const s=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const p=Al(n,h);return Math.abs(p)<s}}function Po(c){return Math.abs(c.y)>Math.abs(c.x)}class Ai extends Yl{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Po(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,s,h){const p=this._lastPoints;if(!p)return;const _=n[0].sub(p[0]),b=n[1].sub(p[1]);return this._map._cooperativeGestures&&!o.isFullscreen()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(_,b,h.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(_.y+b.y)/2*-.5})}gestureBeginsVertically(n,s,h){if(this._valid!==void 0)return this._valid;const p=n.mag()>=2,_=s.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const b=n.y>0==s.y>0;return Po(n)&&Po(s)&&b}}const wf={panStep:100,bearingStep:15,pitchStep:10};class ad{constructor(){const n=wf;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let s=0,h=0,p=0,_=0,b=0;switch(n.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),_=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),_=1);break;case 38:n.shiftKey?p=1:(n.preventDefault(),b=-1);break;case 40:n.shiftKey?p=-1:(n.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(h=0,p=0),{cameraAnimation:E=>{const S=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:Tf,zoom:s?Math.round(S)+s*(n.shiftKey?2:1):S,bearing:E.getBearing()+h*this._bearingStep,pitch:E.getPitch()+p*this._pitchStep,offset:[-_*this._panStep,-b*this._panStep],center:E.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tf(c){return c*(2-c)}const Sl=4.000244140625;class $a{constructor(n,s){this._map=n,this._el=n.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,o.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||o.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=n.deltaMode===o.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const h=o.exported.now(),p=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%Sl==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),n.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=n,this._delta-=s,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=$e(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Sl?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&O!==0&&(O=1/O);const R=s(),U=Math.pow(2,R),$=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom($*O))),this._type==="wheel"&&(this._startZoom=R,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),p=this._startZoom,_=this._easing;let b,E=!1;if(this._type==="wheel"&&p&&_){const S=Math.min((o.exported.now()-this._lastWheelEventTime)/200,1),O=_(S);b=o.number(p,h,O),S<1?this._frameId||(this._frameId=!0):E=!0}else b=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:b-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let s=o.ease;if(this._prevEase){const h=this._prevEase,p=(o.exported.now()-h.start)/h.duration,_=h.easing(p+.01)-h.easing(p),b=.27/Math.sqrt(_*_+1e-4)*.01,E=Math.sqrt(.0729-b*b);s=o.bezier(b,E,.25,1)}return this._prevEase={start:o.exported.now(),duration:n,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Re("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(o.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class ld{constructor(n,s){this._clickZoom=n,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Dc{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,s){return n.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(n.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ba{constructor(){this._tap=new xa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,s,h){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(n,s,h))}touchmove(n,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const p=s[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,n.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(n,s,h)}touchend(n,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(n,s,h)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gu{constructor(n,s,h){this._el=n,this._mousePan=s,this._touchPan=h}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Rt{constructor(n,s,h){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class cd{constructor(n,s,h,p){this._el=n,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const fu=c=>c.zoom||c.drag||c.pitch||c.rotate;class pu extends o.Event{}class mu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,s){const h=o.sub([],s,n);this.radius=o.length(h[2]<0?o.div([],h,this.constants):[h[0],h[1],0])}projectRay(n){o.div(n,n,this.constants),o.normalize(n,n),o.mul$1(n,n,this.constants);const s=o.scale$2([],n,this.radius);if(s[2]>0){const h=o.scale$2([],[0,0,1],o.dot(s,[0,0,1])),p=o.scale$2([],o.normalize([],[s[0],s[1],0]),this.radius),_=o.add([],s,o.scale$2([],o.sub([],o.add([],p,h),s),2));s[0]=_[0],s[1]=_[1]}return s}}function _u(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class wa{constructor(n,s){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ar(n),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new mu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[o.window.document,"mousemove",{capture:!0}],[o.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[o.window,"blur",void 0]];for(const[p,_,b]of this._listeners)p.addEventListener(_,p===o.window.document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[n,s,h]of this._listeners)n.removeEventListener(s,n===o.window.document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(n){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Uu(s,n));const p=s.boxZoom=new hu(s,n);this._add("boxZoom",p);const _=new Cc,b=new Dc;s.doubleClickZoom=new ld(b,_),this._add("tapZoom",_),this._add("clickZoom",b);const E=new ba;this._add("tapDragZoom",E);const S=s.touchPitch=new Ai(s);this._add("touchPitch",S);const O=new mh(n),R=new _h(n);s.dragRotate=new Rt(n,O,R),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const U=new sd(n),$=new Mc(s,n);s.dragPan=new Gu(h,U,$),this._add("mousePan",U),this._add("touchPan",$,["touchZoom","touchRotate"]);const J=new du,Y=new K;s.touchZoomRotate=new cd(h,Y,J,E),this._add("touchRotate",J,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new El(s));const Q=s.scrollZoom=new $a(s,this);this._add("scrollZoom",Q,["mousePan"]);const ee=s.keyboard=new ad;this._add("keyboard",ee);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[W]&&s[W].enable(n[W])}_add(n,s,h){this._handlers.push({handlerName:n,handler:s,allowed:h}),this._handlersById[n]=s}stop(n){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,s,h){for(const p in n)if(p!==h&&(!s||s.indexOf(p)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const s=[];for(const h of n)this._el.contains(h.target)&&s.push(h);return s}handleEvent(n,s){this._updatingCamera=!0;const h=n.type==="renderFrame",p=h?void 0:n,_={needsRenderFrame:!1},b={},E={},S=n.touches?this._getMapTouches(n.touches):void 0,O=S?Wt(this._el,S):h?void 0:$e(this._el,n);for(const{handlerName:$,handler:J,allowed:Y}of this._handlers){if(!J.isEnabled())continue;let Q;this._blockedByActive(E,Y,$)?J.reset():J[s||n.type]&&(Q=J[s||n.type](n,O,S),this.mergeHandlerResult(_,b,Q,$,p),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||J.isActive())&&(E[$]=J)}const R={};for(const $ in this._previousActiveHandlers)E[$]||(R[$]=p);this._previousActiveHandlers=E,(Object.keys(R).length||_u(_))&&(this._changes.push([_,b,R]),this._triggerRenderFrame()),(Object.keys(E).length||_u(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=_;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(n,s,h,p,_){if(!h)return;o.extend(n,h);const b={handlerName:p,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(s.zoom=b),h.panDelta!==void 0&&(s.drag=b),h.pitchDelta!==void 0&&(s.pitch=b),h.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){const n={},s={},h={};for(const[p,_,b]of this._changes)p.panDelta&&(n.panDelta=(n.panDelta||new o.pointGeometry(0,0))._add(p.panDelta)),p.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(n.around=p.around),p.aroundCoord!==void 0&&(n.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(n.pinchAround=p.pinchAround),p.noInertia&&(n.noInertia=p.noInertia),o.extend(s,_),o.extend(h,b);this._updateMapTransform(n,s,h),this._changes=[]}_updateMapTransform(n,s,h){const p=this._map,_=p.transform,b=ae=>[ae.x,ae.y,ae.z];if((ae=>{const oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!_u(n)){const ae=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",ae!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&p._stop(!0),!_u(n))return void this._fireEvents(s,h,!0);let{panDelta:E,zoomDelta:S,bearingDelta:O,pitchDelta:R,around:U,aroundCoord:$,pinchAround:J}=n;_._isCameraConstrained&&(S>0&&(S=0),_._isCameraConstrained=!1),J!==void 0&&(U=J),(S||(ae=>s.drag&&!this._eventsInProgress.drag)())&&U&&(this._dragOrigin=b(_.pointCoordinate3D(U)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",p._stop(!0),U=U||p.transform.centerPoint,O&&(_.bearing+=O),R&&(_.pitch+=R),_._updateCameraState();const Y=[0,0,0];if(E)if(_.projection.name==="mercator"){const ae=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(U).dir),oe=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(U.sub(E)).dir);Y[0]=oe[0]-ae[0],Y[1]=oe[1]-ae[1]}else{const ae=_.pointCoordinate(U);if(_.projection.name==="globe"){E=E.rotate(-_.angle);const oe=_._pixelsPerMercatorPixel/_.worldSize;Y[0]=-E.x*o.mercatorScale(o.latFromMercatorY(ae.y))*oe,Y[1]=-E.y*o.mercatorScale(_.center.lat)*oe}else{const oe=_.pointCoordinate(U.sub(E));ae&&oe&&(Y[0]=oe.x-ae.x,Y[1]=oe.y-ae.y)}}const Q=_.zoom,ee=[0,0,0];if(S){const ae=b($||_.pointCoordinate3D(U)),oe={dir:o.normalize([],o.sub([],ae,_._camera.position))};if(oe.dir[2]<0){const le=_.zoomDeltaToMovement(ae,S);o.scale$2(ee,oe.dir,le)}}const W=o.add(Y,Y,ee);_._translateCameraConstrained(W),S&&Math.abs(_.zoom-Q)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(s,h,!0)}_fireEvents(n,s,h){const p=fu(this._eventsInProgress),_=fu(n),b={};for(const R in n){const{originalEvent:U}=n[R];this._eventsInProgress[R]||(b[`${R}start`]=U),this._eventsInProgress[R]=n[R]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const R in b)this._fireEvent(R,b[R]);_&&this._fireEvent("move",_.originalEvent);for(const R in n){const{originalEvent:U}=n[R];this._fireEvent(R,U)}const E={};let S;for(const R in this._eventsInProgress){const{handlerName:U,originalEvent:$}=this._eventsInProgress[R];this._handlersById[U].isActive()||(delete this._eventsInProgress[R],S=s[U]||$,E[`${R}end`]=S)}for(const R in E)this._fireEvent(R,E[R]);const O=fu(this._eventsInProgress);if(h&&(p||_)&&!O){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;R?(U(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:S})):(this._map.fire(new o.Event("moveend",{originalEvent:S})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,s){this._map.fire(new o.Event(n,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new pu("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const yh="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ud extends o.Evented{constructor(n,s){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=s.bearingSnap,o.bindAll(["_renderFrameCallback"],this)}getCenter(){return new o.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,s){return this.jumpTo({center:n},s)}panBy(n,s,h){return n=o.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,o.extend({offset:n},s),h)}panTo(n,s,h){return this.easeTo(o.extend({center:n},s),h)}getZoom(){return this.transform.zoom}setZoom(n,s){return this.jumpTo({zoom:n},s),this}zoomTo(n,s,h){return this.easeTo(o.extend({zoom:n},s),h)}zoomIn(n,s){return this.zoomTo(this.getZoom()+1,n,s),this}zoomOut(n,s){return this.zoomTo(this.getZoom()-1,n,s),this}getBearing(){return this.transform.bearing}setBearing(n,s){return this.jumpTo({bearing:n},s),this}getPadding(){return this.transform.padding}setPadding(n,s){return this.jumpTo({padding:n},s),this}rotateTo(n,s,h){return this.easeTo(o.extend({bearing:n},s),h)}resetNorth(n,s){return this.rotateTo(0,o.extend({duration:1e3},n),s),this}resetNorthPitch(n,s){return this.easeTo(o.extend({bearing:0,pitch:0,duration:1e3},n),s),this}snapToNorth(n,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,s):this}getPitch(){return this.transform.pitch}setPitch(n,s){return this.jumpTo({pitch:n},s),this}cameraForBounds(n,s){n=o.LngLatBounds.convert(n);const h=s&&s.bearing||0,p=s&&s.pitch||0,_=n.getNorthWest(),b=n.getSouthEast();return this._cameraForBounds(this.transform,_,b,h,p,s)}_extendCameraOptions(n){const s={top:0,bottom:0,right:0,left:0};if(typeof(n=o.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const h=n.padding;n.padding={top:h,bottom:h,right:h,left:h}}return n.padding=o.extend(s,n.padding),n}_minimumAABBFrustumDistance(n,s){const h=s.max[0]-s.min[0],p=s.max[1]-s.min[1];return h/p>n.aspect?h/(2*Math.tan(.5*n.fovX)*n.aspect):p/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,s,h,p,_,b){const E=n.clone(),S=this._extendCameraOptions(b);E.bearing=p,E.pitch=_;const O=o.LngLat.convert(s),R=o.LngLat.convert(h),U=.5*(O.lat+R.lat),$=.5*(O.lng+R.lng),J=o.latLngToECEF(U,$),Y=o.normalize([],J),Q=o.normalize([],o.cross([],Y,[0,1,0])),ee=o.cross([],Q,Y),W=[Q[0],Q[1],Q[2],0,ee[0],ee[1],ee[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],ae=[J,o.latLngToECEF(O.lat,O.lng),o.latLngToECEF(R.lat,O.lng),o.latLngToECEF(R.lat,R.lng),o.latLngToECEF(O.lat,R.lng),o.latLngToECEF(U,O.lng),o.latLngToECEF(U,R.lng),o.latLngToECEF(O.lat,$),o.latLngToECEF(R.lat,$)];let oe=o.Aabb.fromPoints(ae.map(ut=>[o.dot(Q,ut),o.dot(ee,ut),o.dot(Y,ut)]));const le=o.transformMat4([],oe.center,W);o.squaredLength(le)===0&&o.set(le,0,0,1),o.normalize(le,le),o.scale$2(le,le,o.GLOBE_RADIUS),E.center=o.ecefToLatLng(le);const ve=E.getWorldToCameraMatrix(),ge=o.invert(new Float64Array(16),ve);oe=o.Aabb.applyTransform(oe,o.multiply([],ve,W)),o.transformMat4(le,le,ve);const we=.5*(oe.max[2]-oe.min[2]),ke=this._minimumAABBFrustumDistance(E,oe),Be=o.scale$2([],[0,0,1],we),je=o.add(Be,le,Be),Tt=ke+(E.pitch===0?0:o.distance(le,je)),Ne=E.globeCenterInViewSpace,st=o.sub([],le,[Ne[0],Ne[1],Ne[2]]);o.normalize(st,st),o.scale$2(st,st,Tt);const He=o.add([],le,st);o.transformMat4(He,He,ge);const mt=o.earthRadius/o.GLOBE_RADIUS,Ve=o.length(He),Oe=o.mercatorZfromAltitude(Math.max(Ve*mt-o.earthRadius,Number.EPSILON),0),Ze=Math.min(E.zoomFromMercatorZAdjusted(Oe),S.maxZoom);return Ze>.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(E.setProjection({name:"mercator"}),E.zoom=Ze,this._cameraForBounds(E,s,h,p,_,b)):{center:E.center,zoom:Ze,bearing:p,pitch:_}}queryTerrainElevation(n,s){const h=this.transform.elevation;return h?(s=o.extend({},{exaggerated:!0},s),h.getAtPoint(o.MercatorCoordinate.fromLngLat(n),null,s.exaggerated)):null}_cameraForBounds(n,s,h,p,_,b){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,s,h,p,_,b);const E=n.clone(),S=this._extendCameraOptions(b),O=E.padding;E.bearing=p,E.pitch=_;const R=o.LngLat.convert(s),U=o.LngLat.convert(h),$=new o.LngLat(R.lng,U.lat),J=new o.LngLat(U.lng,R.lat),Y=E.project(R),Q=E.project(U),ee=this.queryTerrainElevation(R),W=this.queryTerrainElevation(U),ae=this.queryTerrainElevation($),oe=this.queryTerrainElevation(J),le=[[Y.x,Y.y,Math.min(ee||0,W||0,ae||0,oe||0)],[Q.x,Q.y,Math.max(ee||0,W||0,ae||0,oe||0)]];let ve=o.Aabb.fromPoints(le);const ge=E.getWorldToCameraMatrix(),we=o.invert(new Float64Array(16),ge);ve=o.Aabb.applyTransform(ve,ge);const ke=o.sub([],ve.max,ve.min),Be=O.left||0,je=O.right||0,Tt=O.bottom||0,Ne=O.top||0,{left:st,right:He,top:mt,bottom:Ve}=S.padding,Oe=.5*(Be+je),Ze=.5*(Ne+Tt),ut=Math.min(E.scaleZoom(E.scale*Math.min((E.width-(Be+je+st+He))/ke[0],(E.height-(Tt+Ne+Ve+mt))/ke[1])),S.maxZoom),pt=E.scale/E.zoomScale(ut);ve=new o.Aabb([ve.min[0]-(st+Oe)*pt,ve.min[1]-(Ve+Ze)*pt,ve.min[2]],[ve.max[0]+(He+Oe)*pt,ve.max[1]+(mt+Ze)*pt,ve.max[2]]);const Yt=.5*ke[2],zi=this._minimumAABBFrustumDistance(E,ve),Vt=[0,0,1,0];o.transformMat4$1(Vt,Vt,ge),o.normalize$2(Vt,Vt);const zt=o.scale$2([],Vt,zi+Yt),ei=o.add([],ve.center,zt),qi=(typeof S.offset.x=="number"&&typeof S.offset.y=="number"?new o.pointGeometry(S.offset.x,S.offset.y):o.pointGeometry.convert(S.offset)).rotate(-o.degToRad(p));ve.center[0]-=qi.x*pt,ve.center[1]+=qi.y*pt,o.transformMat4(ve.center,ve.center,we),o.transformMat4(ei,ei,we);const si=[ve.center[0],ve.center[1],ei[2]*E.pixelsPerMeter];o.scale$2(si,si,1/E.worldSize);const dn=o.lngFromMercatorX(si[0]),xn=o.latFromMercatorY(si[1]),Fn=Math.min(E._zoomFromMercatorZ(si[2]),S.maxZoom),In=new o.LngLat(dn,xn);return E.mercatorFromTransition&&Fn<.5*(o.GLOBE_ZOOM_THRESHOLD_MIN+o.GLOBE_ZOOM_THRESHOLD_MAX)?(E.setProjection({name:"globe"}),E.zoom=Fn,this._cameraForBounds(E,s,h,p,_,b)):{center:In,zoom:Fn,bearing:p,pitch:_}}fitBounds(n,s,h){const p=this.cameraForBounds(n,s);return this._fitInternal(p,s,h)}fitScreenCoordinates(n,s,h,p,_){const b=o.pointGeometry.convert(n),E=o.pointGeometry.convert(s),S=new o.pointGeometry(Math.min(b.x,E.x),Math.min(b.y,E.y)),O=new o.pointGeometry(Math.max(b.x,E.x),Math.max(b.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(b,E))return this;const R=this.transform.pointLocation3D(S),U=this.transform.pointLocation3D(O),$=this.transform.pointLocation3D(new o.pointGeometry(S.x,O.y)),J=this.transform.pointLocation3D(new o.pointGeometry(O.x,S.y)),Y=[Math.min(R.lng,U.lng,$.lng,J.lng),Math.min(R.lat,U.lat,$.lat,J.lat)],Q=[Math.max(R.lng,U.lng,$.lng,J.lng),Math.max(R.lat,U.lat,$.lat,J.lat)],ee=p&&p.pitch?p.pitch:this.getPitch(),W=this._cameraForBounds(this.transform,Y,Q,h,ee,p);return this._fitInternal(W,p,_)}_fitInternal(n,s,h){return n?(delete(s=o.extend(n,s)).padding,s.linear?this.easeTo(s,h):this.flyTo(s,h)):this}jumpTo(n,s){this.stop();const h=n.preloadOnly?this.transform.clone():this.transform;let p=!1,_=!1,b=!1;return"zoom"in n&&h.zoom!==+n.zoom&&(p=!0,h.zoom=+n.zoom),n.center!==void 0&&(h.center=o.LngLat.convert(n.center)),"bearing"in n&&h.bearing!==+n.bearing&&(_=!0,h.bearing=+n.bearing),"pitch"in n&&h.pitch!==+n.pitch&&(b=!0,h.pitch=+n.pitch),n.padding==null||h.isPaddingEqual(n.padding)||(h.padding=n.padding),n.preloadOnly?(this._preloadTiles(h),this):(this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),p&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),_&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),b&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.warnOnce(yh),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return o.warnOnce(yh),this;this.stop();const p=h.zoom,_=h.pitch,b=h.bearing;h.setFreeCameraOptions(n);const E=p!==h.zoom,S=_!==h.pitch,O=b!==h.bearing;return this.fire(new o.Event("movestart",s)).fire(new o.Event("move",s)),E&&this.fire(new o.Event("zoomstart",s)).fire(new o.Event("zoom",s)).fire(new o.Event("zoomend",s)),O&&this.fire(new o.Event("rotatestart",s)).fire(new o.Event("rotate",s)).fire(new o.Event("rotateend",s)),S&&this.fire(new o.Event("pitchstart",s)).fire(new o.Event("pitch",s)).fire(new o.Event("pitchend",s)),this.fire(new o.Event("moveend",s)),this}easeTo(n,s){this._stop(!1,n.easeId),((n=o.extend({offset:[0,0],duration:500,easing:o.ease},n)).animate===!1||!n.essential&&o.exported.prefersReducedMotion)&&(n.duration=0);const h=this.transform,p=this.getZoom(),_=this.getBearing(),b=this.getPitch(),E=this.getPadding(),S="zoom"in n?+n.zoom:p,O="bearing"in n?this._normalizeBearing(n.bearing,_):_,R="pitch"in n?+n.pitch:b,U="padding"in n?n.padding:h.padding,$=o.pointGeometry.convert(n.offset);let J,Y,Q;if(h.projection.name==="globe"){const Be=o.MercatorCoordinate.fromLngLat(h.center),je=$.rotate(-h.angle);Be.x+=je.x/h.worldSize,Be.y+=je.y/h.worldSize;const Tt=Be.toLngLat(),Ne=o.LngLat.convert(n.center||Tt);this._normalizeCenter(Ne),J=h.centerPoint.add(je),Y=new o.pointGeometry(Be.x,Be.y).mult(h.worldSize),Q=new o.pointGeometry(o.mercatorXfromLng(Ne.lng),o.mercatorYfromLat(Ne.lat)).mult(h.worldSize).sub(Y)}else{J=h.centerPoint.add($);const Be=h.pointLocation(J),je=o.LngLat.convert(n.center||Be);this._normalizeCenter(je),Y=h.project(Be),Q=h.project(je).sub(Y)}const ee=h.zoomScale(S-p);let W,ae;n.around&&(W=o.LngLat.convert(n.around),ae=h.locationPoint(W));const oe=this._zooming||S!==p,le=this._rotating||_!==O,ve=this._pitching||R!==b,ge=!h.isPaddingEqual(U),we=Be=>je=>{if(oe&&(Be.zoom=o.number(p,S,je)),le&&(Be.bearing=o.number(_,O,je)),ve&&(Be.pitch=o.number(b,R,je)),ge&&(Be.interpolatePadding(E,U,je),J=Be.centerPoint.add($)),W)Be.setLocationAtPoint(W,ae);else{const Tt=Be.zoomScale(Be.zoom-p),Ne=S>p?Math.min(2,ee):Math.max(.5,ee),st=Math.pow(Ne,1-je),He=Be.unproject(Y.add(Q.mult(je*st)).mult(Tt));Be.setLocationAtPoint(Be.renderWorldCopies?He.wrap():He,J)}return n.preloadOnly||this._fireMoveEvents(s),Be};if(n.preloadOnly){const Be=this._emulate(we,n.duration,h);return this._preloadTiles(Be),this}const ke={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=le,this._pitching=ve,this._padding=ge,this._easeId=n.easeId,this._prepareEase(s,n.noMoveStart,ke),this._ease(we(h),Be=>{h.recenterOnTerrain(),this._afterEase(s,Be)},n),this}_prepareEase(n,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||h.moving||this.fire(new o.Event("movestart",n)),this._zooming&&!h.zooming&&this.fire(new o.Event("zoomstart",n)),this._rotating&&!h.rotating&&this.fire(new o.Event("rotatestart",n)),this._pitching&&!h.pitching&&this.fire(new o.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new o.Event("move",n)),this._zooming&&this.fire(new o.Event("zoom",n)),this._rotating&&this.fire(new o.Event("rotate",n)),this._pitching&&this.fire(new o.Event("pitch",n))}_afterEase(n,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new o.Event("zoomend",n)),p&&this.fire(new o.Event("rotateend",n)),_&&this.fire(new o.Event("pitchend",n)),this.fire(new o.Event("moveend",n))}flyTo(n,s){if(!n.essential&&o.exported.prefersReducedMotion){const ut=o.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ut,s)}this.stop(),n=o.extend({offset:[0,0],speed:1.2,curve:1.42,easing:o.ease},n);const h=this.transform,p=this.getZoom(),_=this.getBearing(),b=this.getPitch(),E=this.getPadding(),S="zoom"in n?o.clamp(+n.zoom,h.minZoom,h.maxZoom):p,O="bearing"in n?this._normalizeBearing(n.bearing,_):_,R="pitch"in n?+n.pitch:b,U="padding"in n?n.padding:h.padding,$=h.zoomScale(S-p),J=o.pointGeometry.convert(n.offset);let Y=h.centerPoint.add(J);const Q=h.pointLocation(Y),ee=o.LngLat.convert(n.center||Q);this._normalizeCenter(ee);const W=h.project(Q),ae=h.project(ee).sub(W);let oe=n.curve;const le=Math.max(h.width,h.height),ve=le/$,ge=ae.mag();if("minZoom"in n){const ut=o.clamp(Math.min(n.minZoom,p,S),h.minZoom,h.maxZoom),pt=le/h.zoomScale(ut-p);oe=Math.sqrt(pt/ge*2)}const we=oe*oe;function ke(ut){const pt=(ve*ve-le*le+(ut?-1:1)*we*we*ge*ge)/(2*(ut?ve:le)*we*ge);return Math.log(Math.sqrt(pt*pt+1)-pt)}function Be(ut){return(Math.exp(ut)-Math.exp(-ut))/2}function je(ut){return(Math.exp(ut)+Math.exp(-ut))/2}const Tt=ke(0);let Ne=function(ut){return je(Tt)/je(Tt+oe*ut)},st=function(ut){return le*((je(Tt)*(Be(pt=Tt+oe*ut)/je(pt))-Be(Tt))/we)/ge;var pt},He=(ke(1)-Tt)/oe;if(Math.abs(ge)<1e-6||!isFinite(He)){if(Math.abs(le-ve)<1e-6)return this.easeTo(n,s);const ut=ve<le?-1:1;He=Math.abs(Math.log(ve/le))/oe,st=function(){return 0},Ne=function(pt){return Math.exp(ut*oe*pt)}}n.duration="duration"in n?+n.duration:1e3*He/("screenSpeed"in n?+n.screenSpeed/oe:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const mt=_!==O,Ve=R!==b,Oe=!h.isPaddingEqual(U),Ze=ut=>pt=>{const Yt=pt*He,zi=1/Ne(Yt);ut.zoom=pt===1?S:p+ut.scaleZoom(zi),mt&&(ut.bearing=o.number(_,O,pt)),Ve&&(ut.pitch=o.number(b,R,pt)),Oe&&(ut.interpolatePadding(E,U,pt),Y=ut.centerPoint.add(J));const Vt=pt===1?ee:ut.unproject(W.add(ae.mult(st(Yt))).mult(zi));return ut.setLocationAtPoint(ut.renderWorldCopies?Vt.wrap():Vt,Y),ut._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(s),ut};if(n.preloadOnly){const ut=this._emulate(Ze,n.duration,h);return this._preloadTiles(ut),this}return this._zooming=!0,this._rotating=mt,this._pitching=Ve,this._padding=Oe,this._prepareEase(s,!1),this._ease(Ze(h),()=>this._afterEase(s),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!n){const h=this.handlers;h&&h.stop(!1)}return this}_ease(n,s,h){h.animate===!1||h.duration===0?(n(1),s()):(this._easeStart=o.exported.now(),this._easeOptions=h,this._onEaseFrame=n,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((o.exported.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,s){n=o.wrap(n,-180,180);const h=Math.abs(n-s);return Math.abs(n-360-s)<h&&(n-=360),Math.abs(n+360-s)<h&&(n+=360),n}_normalizeCenter(n){const s=this.transform;if(!s.renderWorldCopies||s.maxBounds)return;const h=n.lng-s.center.lng;n.lng+=h>180?-360:h<-180?360:0}_emulate(n,s,h){const p=Math.ceil(15*s/1e3),_=[],b=n(h.clone());for(let E=0;E<=p;E++){const S=b(E/p);_.push(S.clone())}return _}}class vh{constructor(n={}){this.options=n,o.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const s=this.options&&this.options.compact;return this._map=n,this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Re("button","mapboxgl-ctrl-attrib-button",this._container),Re("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Re("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,s){const h=this._map._getUIString(`AttributionControl.${s}`);n.setAttribute("aria-label",h),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.config.ACCESS_TOKEN}];if(n){const h=s.reduce((p,_,b)=>(_.value&&(p+=`${_.key}=${_.value}${b<s.length-1?"&":""}`),p),"?");n.href=`${o.config.FEEDBACK_URL}/${h}#${Ac(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style._sourceCaches;for(const p in s){const _=s[p];if(_.used){const b=_.getSource();b.attribution&&n.indexOf(b.attribution)<0&&n.push(b.attribution)}}n.sort((p,_)=>p.length-_.length),n=n.filter((p,_)=>{for(let b=_+1;b<n.length;b++)if(n[b].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const h=n.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,n.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class xh{constructor(){o.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=Re("div","mapboxgl-ctrl");const s=Re("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const s in n){const h=n[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const s=n[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class gu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const s=++this._id;return this._queue.push({callback:n,id:s,cancelled:!1}),s}remove(n){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const p of h)if(p.id===n)return void(p.cancelled=!0)}run(n=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Ta(c,n,s){if(c=new o.LngLat(c.lng,c.lat),n){const h=new o.LngLat(c.lng-360,c.lat),p=new o.LngLat(c.lng+360,c.lat),_=360*Math.ceil(Math.abs(c.lng-s.center.lng)/360),b=s.locationPoint(c).distSqr(n),E=n.x<0||n.y<0||n.x>s.width||n.y>s.height;s.locationPoint(h).distSqr(n)<b&&(E||Math.abs(h.lng-s.center.lng)<_)?c=h:s.locationPoint(p).distSqr(n)<b&&(E||Math.abs(p.lng-s.center.lng)<_)&&(c=p)}for(;Math.abs(c.lng-s.center.lng)>180;){const h=s.locationPoint(c);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;c.lng>s.center.lng?c.lng-=360:c.lng+=360}return c}const Lc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ju extends o.Evented{constructor(n,s){if(super(),(n instanceof o.window.HTMLElement||s)&&(n=o.extend({element:n},s)),o.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=o.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=Re("div");const p=41,_=27,b=tt("svg",{display:"block",height:p*this._scale+"px",width:_*this._scale+"px",viewBox:`0 0 ${_} ${p}`},this._element),E=tt("radialGradient",{id:"shadowGradient"},tt("defs",{},b));tt("stop",{offset:"10%","stop-opacity":.4},E),tt("stop",{offset:"100%","stop-opacity":.05},E),tt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},b),tt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},b),tt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},b),tt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},b),this._offset=o.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()});const h=this._element.classList;for(const p in Lc)h.remove(`mapboxgl-marker-anchor-${p}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=o.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const s=n.code,h=n.charCode||n.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(n){const s=n.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,s=this._pos;if(!n||!s)return!1;const h=n.unproject(s),p=n.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(h)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const s=this._pos;if(!s||s.x<0||s.x>n.transform.width||s.y<0||s.y>n.transform.height)return void this._clearFadeTimer();const h=n.unproject(s);let p;n._showingGlobe()&&o.isLngLatBehindGlobe(n.transform,this._lngLat)?p=0:(p=1-n._queryFogOpacity(h),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Lc[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const n=this._pos,s=this._map,h=this.getPitchAlignment();if(!s||!n||h!=="map")return"";if(!s._showingGlobe()){const S=s.getPitch();return S?`rotateX(${S}deg)`:""}const p=o.radToDeg(o.globeTiltAtLngLat(s.transform,this._lngLat)),_=n.sub(o.globeCenterToScreenPoint(s.transform)),b=Math.abs(_.x)+Math.abs(_.y);if(b===0)return"";const E=p/b;return`rotateX(${-_.y*E}deg) rotateY(${_.x*E}deg)`}_calculateZTransform(){const n=this._pos,s=this._map;if(!s||!n)return"";let h=0;const p=this.getRotationAlignment();if(p==="map")if(s._showingGlobe()){const _=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),b=s.project(new o.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);h=o.radToDeg(Math.atan2(b.y,b.x))-90}else h=-s.getBearing();else if(p==="horizon"){const _=o.smoothstep(4,6,s.getZoom()),b=o.globeCenterToScreenPoint(s.transform);b.y+=_*s.transform.height;const E=n.sub(b),S=o.radToDeg(Math.atan2(E.y,E.x));h=(S>90?S-270:S+90)*(1-_)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(n){o.window.cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=Ta(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),n===!0?this._updateFrameId=o.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=o.pointGeometry.convert(n),this._update(),this}_onMove(n){const s=this._map;if(!s)return;const h=this._pointerdownPos,p=this._positionDelta;if(h&&p){if(!this._isDragging){const _=this._clickTolerance||s._clickTolerance;if(n.point.dist(h)<_)return;this._isDragging=!0}this._pos=n.point.sub(p),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.Event("dragstart"))),this.fire(new o.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.Event("dragend")),this._state="inactive"}_addDragHandler(n){const s=this._map,h=this._pos;s&&h&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(h),this._pointerdownPos=n.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const s=this._map;return s&&(n?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const xs={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},hd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bh(c=new o.pointGeometry(0,0),n="bottom"){if(typeof c=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(n){case"top":return new o.pointGeometry(0,c);case"top-left":return new o.pointGeometry(s,s);case"top-right":return new o.pointGeometry(-s,s);case"bottom":return new o.pointGeometry(0,-c);case"bottom-left":return new o.pointGeometry(s,-s);case"bottom-right":return new o.pointGeometry(-s,-s);case"left":return new o.pointGeometry(c,0);case"right":return new o.pointGeometry(-c,0)}return new o.pointGeometry(0,0)}return c instanceof o.pointGeometry||Array.isArray(c)?o.pointGeometry.convert(c):o.pointGeometry.convert(c[n]||[0,0])}class dd{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const s=o.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,s,h){this._start=this.getValue(s),this._end=n,this._startTime=s,this._endTime=s+h}}const fd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},pd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Wu={showCompass:!0,showZoom:!0,visualizePitch:!1};class wh{constructor(n,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new mh({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,h&&(this.mousePitch=new _h({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),o.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(n,s){this.mouseRotate.mousedown(n,s),this.mousePitch&&this.mousePitch.mousedown(n,s),Je()}move(n,s){const h=this.map,p=this.mouseRotate.mousemoveWindow(n,s),_=p&&p.bearingDelta;if(_&&h.setBearing(h.getBearing()+_),this.mousePitch){const b=this.mousePitch.mousemoveWindow(n,s),E=b&&b.pitchDelta;E&&h.setPitch(h.getPitch()+E)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Qe(),o.window.removeEventListener("mousemove",this.mousemove),o.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(o.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),$e(this.element,n)),o.window.addEventListener("mousemove",this.mousemove),o.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,$e(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Wt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Wt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const md={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},_d={maxWidth:100,unit:"metric"};function qu(c,n,s){const h=Il(n),p=h/n,_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[s];this._map._requestDomTask(()=>{this._container.style.width=c*p+"px",this._container.innerHTML=`${h}&nbsp;${_}`})}function Il(c){const n=Math.pow(10,`${Math.floor(c)}`.length-1);let s=c/n;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:s>=1?1:function(h){const p=Math.pow(10,Math.ceil(-Math.log(h)/Math.LN10));return Math.round(h*p)/p}(s),n*s}const Cl={version:o.version,supported:ce,setRTLTextPlugin:o.setRTLTextPlugin,getRTLTextPluginStatus:o.getRTLTextPluginStatus,Map:class extends ud{constructor(c){if(o.LivePerformanceUtils.mark(o.PerformanceMarkers.create),(c=o.extend({},pd,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&o.isSafariWithAntialiasingBug(o.window)&&(c.antialias=!1,o.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ot(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),c),this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._useWebGL2=c.useWebGL2,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._optimizeForTerrain=c.optimizeForTerrain,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new gu,this._domRenderTaskQueue=new gu,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.uniqueId(),this._locale=o.extend({},fd,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new dd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.RequestManager(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,typeof c.container=="string"){if(this._container=o.window.document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof o.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&o.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),o.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),o.window!==void 0&&(o.window.addEventListener("online",this._onWindowOnline,!1),o.window.addEventListener("resize",this._onWindowResize,!1),o.window.addEventListener("orientationchange",this._onWindowResize,!1),o.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new wa(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,c.style&&this.setStyle(c.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this._hash=c.hash&&new lu(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.extend({},c.fitBoundsOptions,{duration:0})))),this.resize(),c.attributionControl&&this.addControl(new vh({customAttribution:c.customAttribution})),this._logoControl=new xh,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new o.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new o.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(c,n){if(n===void 0&&(n=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=c.onAdd(this);this._controls.push(c);const h=this._controlPositions[n];return n.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new o.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(c);return n>-1&&this._controls.splice(n,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new o.Event("movestart",c)).fire(new o.Event("move",c)),this.fire(new o.Event("resize",c)),n&&this.fire(new o.Event("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(o.LngLatBounds.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new o.Event("zoomstart")).fire(new o.Event("zoom")).fire(new o.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new o.Event("pitchstart")).fire(new o.Event("pitch")).fire(new o.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?o.window.navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(n=>n==="auto"?o.window.navigator.language:n):c}setLanguage(c){const n=this._parseLanguage(c);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,n=c.projection.name;let s;n==="globe"&&c.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?(c.setMercatorFromTransition(),s=!0):n==="mercator"&&c.zoom<o.GLOBE_ZOOM_THRESHOLD_MAX&&(c.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(c,n){return this._updateProjection(c||n||{name:"mercator"})}_updateProjection(c){let n;if(n=c.name==="globe"&&this.transform.zoom>=o.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const s in this.style._sourceCaches)this.style._sourceCaches[s].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(c){return this.transform.locationPoint3D(o.LngLat.convert(c))}unproject(c){return this.transform.pointLocation3D(o.pointGeometry.convert(c))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,n,s){if(c==="mouseenter"||c==="mouseover"){let h=!1;const p=b=>{const E=n.filter(O=>this.getLayer(O)),S=E.length?this.queryRenderedFeatures(b.point,{layers:E}):[];S.length?h||(h=!0,s.call(this,new eo(c,this,b.originalEvent,{features:S}))):h=!1},_=()=>{h=!1};return{layers:new Set(n),listener:s,delegates:{mousemove:p,mouseout:_}}}if(c==="mouseleave"||c==="mouseout"){let h=!1;const p=b=>{const E=n.filter(S=>this.getLayer(S));(E.length?this.queryRenderedFeatures(b.point,{layers:E}):[]).length?h=!0:h&&(h=!1,s.call(this,new eo(c,this,b.originalEvent)))},_=b=>{h&&(h=!1,s.call(this,new eo(c,this,b.originalEvent)))};return{layers:new Set(n),listener:s,delegates:{mousemove:p,mouseout:_}}}{const h=p=>{const _=n.filter(E=>this.getLayer(E)),b=_.length?this.queryRenderedFeatures(p.point,{layers:_}):[];b.length&&(p.features=b,s.call(this,p),delete p.features)};return{layers:new Set(n),listener:s,delegates:{[c]:h}}}}on(c,n,s){if(s===void 0)return super.on(c,n);Array.isArray(n)||(n=[n]);const h=this._createDelegatedListener(c,n,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(h);for(const p in h.delegates)this.on(p,h.delegates[p]);return this}once(c,n,s){if(s===void 0)return super.once(c,n);Array.isArray(n)||(n=[n]);const h=this._createDelegatedListener(c,n,s);for(const p in h.delegates)this.once(p,h.delegates[p]);return this}off(c,n,s){if(s===void 0)return super.off(c,n);n=new Set(Array.isArray(n)?n:[n]);const h=(_,b)=>{if(_.size!==b.size)return!1;for(const E of _)if(!b.has(E))return!1;return!0},p=this._delegatedListeners?this._delegatedListeners[c]:void 0;return p&&(_=>{for(let b=0;b<_.length;b++){const E=_[b];if(E.listener===s&&h(E.layers,n)){for(const S in E.delegates)this.off(S,E.delegates[S]);return _.splice(b,1),this}}})(p),this}queryRenderedFeatures(c,n){return this.style?(n!==void 0||c===void 0||c instanceof o.pointGeometry||Array.isArray(c)||(n=c,c=void 0),this.style.queryRenderedFeatures(c=c||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(c,n){return this.style.querySourceFeatures(c,n)}setStyle(c,n){return(n=o.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&c?(this._diffStyle(c,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(c,n))}_getUIString(c){const n=this._locale[c];if(n==null)throw new Error(`Missing UI string '${c}'`);return n}_updateStyle(c,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c&&(this.style=new Bn(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof c=="string"?this.style.loadURL(c):this.style.loadJSON(c)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Bn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(c,n){if(typeof c=="string"){const s=this._requestManager.normalizeStyleURL(c),h=this._requestManager.transformRequest(s,o.ResourceType.Style);o.getJSON(h,(p,_)=>{p?this.fire(new o.ErrorEvent(p)):_&&this._updateDiff(_,n)})}else typeof c=="object"&&this._updateDiff(c,n)}_updateDiff(c,n){try{this.style.setState(c)&&this._update(!0)}catch(s){o.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(c,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.warnOnce("There is no style added to the map."),!1)}addSource(c,n){return this._lazyInitEmptyStyle(),this.style.addSource(c,n),this._update(!0)}isSourceLoaded(c){return!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){const c=this.style&&this.style._sourceCaches;for(const n in c){const s=c[n]._tiles;for(const h in s){const p=s[h];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(c,n,s){this._lazyInitEmptyStyle(),this.style.addSourceType(c,n,s)}removeSource(c){return this.style.removeSource(c),this._updateTerrain(),this._update(!0)}getSource(c){return this.style.getSource(c)}addImage(c,n,{pixelRatio:s=1,sdf:h=!1,stretchX:p,stretchY:_,content:b}={}){if(this._lazyInitEmptyStyle(),n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap){const{width:E,height:S,data:O}=o.exported.getImageData(n);this.style.addImage(c,{data:new o.RGBAImage({width:E,height:S},O),pixelRatio:s,stretchX:p,stretchY:_,content:b,sdf:h,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:S}=n,O=n;this.style.addImage(c,{data:new o.RGBAImage({width:E,height:S},new Uint8Array(O.data)),pixelRatio:s,stretchX:p,stretchY:_,content:b,sdf:h,version:0,userImage:O}),O.onAdd&&O.onAdd(this,c)}}updateImage(c,n){const s=this.style.getImage(c);if(!s)return void this.fire(new o.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap?o.exported.getImageData(n):n,{width:p,height:_}=h;p!==void 0&&_!==void 0?p===s.data.width&&_===s.data.height?(s.data.replace(h.data,!(n instanceof o.window.HTMLImageElement||o.window.ImageBitmap&&n instanceof o.window.ImageBitmap)),this.style.updateImage(c,s)):this.fire(new o.ErrorEvent(new Error(`The width and height of the updated image (${p}, ${_})
                must be that same as the previous version of the image
                (${s.data.width}, ${s.data.height})`))):this.fire(new o.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(c){return c?!!this.style.getImage(c):(this.fire(new o.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(c)}loadImage(c,n){o.getImage(this._requestManager.transformRequest(c,o.ResourceType.Image),(s,h)=>{n(s,h instanceof o.window.HTMLImageElement?o.exported.getImageData(h):h)})}listImages(){return this.style.listImages()}addLayer(c,n){return this._lazyInitEmptyStyle(),this.style.addLayer(c,n),this._update(!0)}moveLayer(c,n){return this.style.moveLayer(c,n),this._update(!0)}removeLayer(c){return this.style.removeLayer(c),this._update(!0)}getLayer(c){return this.style.getLayer(c)}setLayerZoomRange(c,n,s){return this.style.setLayerZoomRange(c,n,s),this._update(!0)}setFilter(c,n,s={}){return this.style.setFilter(c,n,s),this._update(!0)}getFilter(c){return this.style.getFilter(c)}setPaintProperty(c,n,s,h={}){return this.style.setPaintProperty(c,n,s,h),this._update(!0)}getPaintProperty(c,n){return this.style.getPaintProperty(c,n)}setLayoutProperty(c,n,s,h={}){return this.style.setLayoutProperty(c,n,s,h),this._update(!0)}getLayoutProperty(c,n){return this.style.getLayoutProperty(c,n)}setLight(c,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(c,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.LngLat.convert(c),this.transform):0}setFeatureState(c,n){return this.style.setFeatureState(c,n),this._update()}removeFeatureState(c,n){return this.style.removeFeatureState(c,n),this._update()}getFeatureState(c){return this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let s,h,p,_=this._container;for(;_&&(!h||!p);){const b=o.window.getComputedStyle(_).transform;b&&b!=="none"&&(s=b.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(p=s[3])),_=_.parentElement}this._containerWidth=h?Math.abs(c/h):c,this._containerHeight=p?Math.abs(n/p):n}_detectMissingCSS(){o.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=Re("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=Re("div","mapboxgl-canvas-container",c);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=Re("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=Re("div","mapboxgl-control-container",c),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(p=>{h[p]=Re("div",`mapboxgl-ctrl-${p}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,n){const s=o.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(c),this._canvas.height=s*Math.ceil(n),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${n}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const n=this._markers.indexOf(c);n!==-1&&this._markers.splice(n,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const n=this._popups.indexOf(c);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const c=o.extend({},ce.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",c),s=n||this._canvas.getContext("webgl",c)||this._canvas.getContext("experimental-webgl",c);s?(this._useWebGL2&&!n&&o.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),o.storeAuthState(s,!0),this.painter=new ys(s,this.transform,!!n),this.on("data",h=>{h.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.exported$1.testSupport(s)):this.fire(new o.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.Event("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.resize(),this._update(),this.fire(new o.Event("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let n;const s=this.painter.context.extTimerQuery,h=o.exported.now();if(this.listens("gpu-timing-frame")&&(n=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],o.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],o.window.performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const p=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,S=this.transform.pitch,O=o.exported.now(),R=new o.EvaluationParameters(E,{now:O,fadeDuration:p,pitch:S,transition:this.style.getTransition()});this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(h),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,p,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:p,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const E=o.exported.now()-h;s.endQueryEXT(s.TIME_ELAPSED_EXT,n),setTimeout(()=>{const S=s.getQueryObjectEXT(n,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(n),this.fire(new o.Event("gpu-timing-frame",{cpuTime:E,gpuTime:S})),o.window.performance.mark("frame-gpu",{startTime:h,detail:{gpuTime:S}})},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const S=this.painter.queryGpuTimers(E);this.fire(new o.Event("gpu-timing-layer",{layerTimes:S}))},50)}if(this.listens("gpu-timing-deferred-render")){const E=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const S=this.painter.queryGpuTimeDeferredRender(E);this.fire(new o.Event("gpu-timing-deferred-render",{gpuTime:S}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(b||this._repaint)this.triggerRepaint();else{const E=!this.isMoving()&&this.loaded();if(E&&(_=this._updateAverageElevation(h,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),E&&(this.fire(new o.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const S=this._calculateSpeedIndex();this.fire(new o.Event("speedindexcompleted",{speedIndex:S})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,o.LivePerformanceUtils.mark(o.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&o.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const n of this._markers)c&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!c||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(c,n=!1){const s=h=>(this.transform.averageElevation=h,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((n||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const h=this.transform.averageElevation;let p=this.transform.sampleAverageElevation(),_=!1;this.transform.elevation&&(_=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(p)?p=0:this._averageElevationLastSampledAt=c;const b=Math.abs(h-p);if(b>1){if(this._isInitialLoad||_)return this._averageElevation.jumpTo(p),s(p);this._averageElevation.easeTo(p,c,300)}else if(b>1e-4)return this._averageElevation.jumpTo(p),s(p)}return!!this._averageElevation.isEasing(c)&&s(this._averageElevation.getValue(c))}_authenticate(){o.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===o.AUTH_ERR_MSG||c.status===401)){const n=this.painter.context.gl;o.storeAuthState(n,!1),this._logoControl instanceof xh&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function p(_){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,_,0);const b=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,b),b}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(p(c),n.canvasCopies.map(p),n.timeStamps)}_canvasPixelComparison(c,n,s){let h=s[1]-s[0];const p=c.length/4;for(let _=0;_<n.length;_++){const b=n[_];let E=0;for(let S=0;S<b.length;S+=4)b[S]===c[S]&&b[S+1]===c[S+1]&&b[S+2]===c[S+2]&&b[S+3]===c[S+3]&&(E+=1);h+=(s[_+2]-s[_+1])*(1-E/p)}return h}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),o.window!==void 0&&(o.window.removeEventListener("resize",this._onWindowResize,!1),o.window.removeEventListener("orientationchange",this._onWindowResize,!1),o.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),o.window.removeEventListener("online",this._onWindowOnline,!1),o.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new o.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=o.exported.frame(n=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(n)}))}_preloadTiles(c){const n=this.style?Object.values(this.style._sourceCaches):[];return o.asyncAll(n,(s,h)=>s._preloadTiles(c,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){o.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,c&&this._update())}_setCacheLimits(c,n){o.setCacheLimits(c,n)}get version(){return o.version}},NavigationControl:class{constructor(c){this.options=o.extend({},Wu,c),this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(o.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),Re("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),Re("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:n}):s.resetNorth({},{originalEvent:n}))}),this._compassIcon=Re("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const n=c.getZoom(),s=n===c.getMaxZoom(),h=n===c.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wh(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,n){const s=Re("button",c,this._container);return s.type="button",s.addEventListener("click",n),s}_setButtonTitle(c,n){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${n}`);c.setAttribute("aria-label",s),c.firstElementChild&&c.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.Evented{constructor(c){super(),this.options=o.extend({geolocation:o.window.navigator.geolocation},md,c),o.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=vs(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const n=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,c(s)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):o.window.navigator.permissions!==void 0?o.window.navigator.permissions.query({name:"geolocation"}).then(s=>n(s.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(c){const n=this._map.getMaxBounds(),s=c.coords;return!!n&&(s.longitude<n.getWest()||s.longitude>n.getEast()||s.latitude<n.getSouth()||s.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("geolocate",c)),this._finish()}}_updateCamera(c){const n=new o.LngLat(c.coords.longitude,c.coords.latitude),s=c.coords.accuracy,h=this._map.getBearing(),p=o.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(s),p,{geolocateSource:!0})}_updateMarker(c){if(c){const n=new o.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,n=o.mercatorZfromAltitude(1,c._center.lat)*c.worldSize,s=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new o.Event("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Re("button","mapboxgl-ctrl-geolocate",this._container),Re("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Re("div","mapboxgl-user-location"),this._dotElement.appendChild(Re("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Re("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ju({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Re("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ju({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.Event("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{o.window.addEventListener("ondeviceorientationabsolute"in o.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};o.window.DeviceMotionEvent!==void 0&&typeof o.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),o.window.removeEventListener("deviceorientation",this._onDeviceOrientation),o.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:vh,ScaleControl:class{constructor(c){this.options=o.extend({},_d,c),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=qu.bind(this)),o.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,n=this._map,s=n._containerHeight/2,h=n._containerWidth/2-c/2,p=n.unproject([h,s]),_=n.unproject([h+c,s]),b=p.distanceTo(_);if(this.options.unit==="imperial"){const E=3.2808*b;E>5280?this._setScale(c,E/5280,"mile"):this._setScale(c,E,"foot")}else this.options.unit==="nautical"?this._setScale(c,b/1852,"nautical-mile"):b>=1e3?this._setScale(c,b/1e3,"kilometer"):this._setScale(c,b,"meter")}_setScale(c,n,s){const h=Il(n),p=h/n;this._map._requestDomTask(()=>{this._container.style.width=c*p+"px",this._container.innerHTML=s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:s}).format(h):`${h}&nbsp;nm`})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=Re("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c){this._fullscreen=!1,c&&c.container&&(c.container instanceof o.window.HTMLElement?this._container=c.container:o.warnOnce("Full screen control 'container' must be a DOM element.")),o.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in o.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in o.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=Re("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,o.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!o.window.document.fullscreenEnabled&&!o.window.document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=Re("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Re("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),o.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(o.window.document.fullscreenElement||o.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?o.window.document.exitFullscreen?o.window.document.exitFullscreen():o.window.document.webkitCancelFullScreen&&o.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.Evented{constructor(c){super(),this.options=o.extend(Object.create(xs),c),o.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new o.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new o.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=o.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(o.window.document.createTextNode(c))}setHTML(c){const n=o.window.document.createDocumentFragment(),s=o.window.document.createElement("body");let h;for(s.innerHTML=c;h=s.firstChild,h;)n.appendChild(h);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=Re("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(c),this.options.closeButton){const s=this._closeButton=Re("button","mapboxgl-popup-close-button",n);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let n;return this._classList.delete(c)?n=!1:(this._classList.add(c),n=!0),this._updateClassList(),n}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const n=this._map,s=this._container,h=this._pos;if(!n||!s||!h)return"bottom";const p=s.offsetWidth,_=s.offsetHeight,b=h.x<p/2,E=h.x>n.transform.width-p/2;if(h.y+c<_)return b?"top-left":E?"top-right":"top";if(h.y>n.transform.height-_){if(b)return"bottom-left";if(E)return"bottom-right"}return b?"left":E?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),c.className=n.join(" ")}_update(c){const n=this._map,s=this._content;if(!n||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=Re("div","mapboxgl-popup",n.getContainer()),this._tip=Re("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ta(this._lngLat,this._pos,n.transform)),!this._trackPointer||c){const p=this._pos=this._trackPointer&&c?c:n.project(this._lngLat),_=bh(this.options.offset),b=this._anchor=this._getAnchor(_.y),E=bh(this.options.offset,b),S=p.add(E).round();n._requestDomTask(()=>{this._container&&b&&(this._container.style.transform=`${Lc[b]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&n._showingGlobe()){const p=o.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(hd);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:ju,Style:Bn,LngLat:o.LngLat,LngLatBounds:o.LngLatBounds,Point:o.pointGeometry,MercatorCoordinate:o.MercatorCoordinate,FreeCameraOptions:va,Evented:o.Evented,config:o.config,prewarm:function(){ai().acquire(ni)},clearPrewarmedResources:function(){const c=Qt;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(ni),Qt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return o.config.ACCESS_TOKEN},set accessToken(c){o.config.ACCESS_TOKEN=c},get baseApiUrl(){return o.config.API_URL},set baseApiUrl(c){o.config.API_URL=c},get workerCount(){return Jt.workerCount},set workerCount(c){Jt.workerCount=c},get maxParallelImageRequests(){return o.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){o.config.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){o.clearTileCache(c)},workerUrl:"",workerClass:null,setNow:o.exported.setNow,restoreNow:o.exported.restoreNow};return Cl});var Z=P;return Z})})(W0);const Yy=Sy;var Iy={},q0={get exports(){return Iy},set exports(D){Iy=D}};(function(D,x){(function(g,M){D.exports=M()})(cc,function(){var g=function(T,C){var H={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},he={on:function(Te,Ie,wt){if(H[Te]===void 0)throw new Error("Invalid event type: "+Te);H[Te].push({selector:Ie,fn:wt})},render:function(Te){C.store.featureChanged(Te)}},Ee=function(Te,Ie){for(var wt=H[Te],xt=wt.length;xt--;){var Ft=wt[xt];if(Ft.selector(Ie)){Ft.fn.call(he,Ie)||C.store.render(),C.ui.updateMapClasses();break}}};return T.start.call(he),{render:T.render,stop:function(){T.stop&&T.stop()},trash:function(){T.trash&&(T.trash(),C.store.render())},combineFeatures:function(){T.combineFeatures&&T.combineFeatures()},uncombineFeatures:function(){T.uncombineFeatures&&T.uncombineFeatures()},drag:function(Te){Ee("drag",Te)},click:function(Te){Ee("click",Te)},mousemove:function(Te){Ee("mousemove",Te)},mousedown:function(Te){Ee("mousedown",Te)},mouseup:function(Te){Ee("mouseup",Te)},mouseout:function(Te){Ee("mouseout",Te)},keydown:function(Te){Ee("keydown",Te)},keyup:function(Te){Ee("keyup",Te)},touchstart:function(Te){Ee("touchstart",Te)},touchmove:function(Te){Ee("touchmove",Te)},touchend:function(Te){Ee("touchend",Te)},tap:function(Te){Ee("tap",Te)}}};function M(T){if(T.__esModule)return T;var C=T.default;if(typeof C=="function"){var H=function he(){if(this instanceof he){var Ee=[null];Ee.push.apply(Ee,arguments);var Te=Function.bind.apply(C,Ee);return new Te}return C.apply(this,arguments)};H.prototype=C.prototype}else H={};return Object.defineProperty(H,"__esModule",{value:!0}),Object.keys(T).forEach(function(he){var Ee=Object.getOwnPropertyDescriptor(T,he);Object.defineProperty(H,he,Ee.get?Ee:{enumerable:!0,get:function(){return T[he]}})}),H}var P={},N={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},Z=N;function o(T){var C=0;if(T&&T.length>0){C+=Math.abs(B(T[0]));for(var H=1;H<T.length;H++)C-=Math.abs(B(T[H]))}return C}function B(T){var C,H,he,Ee,Te,Ie,wt=0,xt=T.length;if(xt>2){for(Ie=0;Ie<xt;Ie++)Ie===xt-2?(he=xt-2,Ee=xt-1,Te=0):Ie===xt-1?(he=xt-1,Ee=0,Te=1):(he=Ie,Ee=Ie+1,Te=Ie+2),C=T[he],H=T[Ee],wt+=(ce(T[Te][0])-ce(C[0]))*Math.sin(ce(H[1]));wt=wt*Z.RADIUS*Z.RADIUS/2}return wt}function ce(T){return T*Math.PI/180}P.geometry=function T(C){var H,he=0;switch(C.type){case"Polygon":return o(C.coordinates);case"MultiPolygon":for(H=0;H<C.coordinates.length;H++)he+=o(C.coordinates[H]);return he;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(H=0;H<C.geometries.length;H++)he+=T(C.geometries[H]);return he}},P.ring=B;var _e={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},de={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Re={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},tt={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Ce={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},qe={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},rt={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Je={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},Qe={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},Mt={ACTIVE:"true",INACTIVE:"false"},lt=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],$e=-85,Wt=Object.freeze({__proto__:null,classes:_e,sources:de,cursors:Re,types:tt,geojsonTypes:Ce,modes:qe,events:rt,updateActions:Je,meta:Qe,activeStates:Mt,interactions:lt,LAT_MIN:-90,LAT_RENDERED_MIN:$e,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),ti={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Pi(T,C){var H=ti[T.geometry.type]-ti[C.geometry.type];return H===0&&T.geometry.type===Ce.POLYGON?T.area-C.area:H}function Ht(T){return T.map(function(C){return C.geometry.type===Ce.POLYGON&&(C.area=P.geometry({type:Ce.FEATURE,property:{},geometry:C.geometry})),C}).sort(Pi).map(function(C){return delete C.area,C})}function Ut(T,C){return C===void 0&&(C=0),[[T.point.x-C,T.point.y-C],[T.point.x+C,T.point.y+C]]}function qt(T){if(this._items={},this._nums={},this._length=T?T.length:0,T)for(var C=0,H=T.length;C<H;C++)this.add(T[C]),T[C]!==void 0&&(typeof T[C]=="string"?this._items[T[C]]=C:this._nums[T[C]]=C)}qt.prototype.add=function(T){return this.has(T)||(this._length++,typeof T=="string"?this._items[T]=this._length:this._nums[T]=this._length),this},qt.prototype.delete=function(T){return this.has(T)===!1||(this._length--,delete this._items[T],delete this._nums[T]),this},qt.prototype.has=function(T){return(typeof T=="string"||typeof T=="number")&&(this._items[T]!==void 0||this._nums[T]!==void 0)},qt.prototype.values=function(){var T=this,C=[];return Object.keys(this._items).forEach(function(H){C.push({k:H,v:T._items[H]})}),Object.keys(this._nums).forEach(function(H){C.push({k:JSON.parse(H),v:T._nums[H]})}),C.sort(function(H,he){return H.v-he.v}).map(function(H){return H.k})},qt.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Ti=[Qe.FEATURE,Qe.MIDPOINT,Qe.VERTEX],ki={click:function(T,C,H){return fn(T,C,H,H.options.clickBuffer)},touch:function(T,C,H){return fn(T,C,H,H.options.touchBuffer)}};function fn(T,C,H,he){if(H.map===null)return[];var Ee=T?Ut(T,he):C,Te={};H.options.styles&&(Te.layers=H.options.styles.map(function(Ft){return Ft.id}));var Ie=H.map.queryRenderedFeatures(Ee,Te).filter(function(Ft){return Ti.indexOf(Ft.properties.meta)!==-1}),wt=new qt,xt=[];return Ie.forEach(function(Ft){var St=Ft.properties.id;wt.has(St)||(wt.add(St),xt.push(Ft))}),Ht(xt)}function ii(T,C){var H=ki.click(T,null,C),he={mouse:Re.NONE};return H[0]&&(he.mouse=H[0].properties.active===Mt.ACTIVE?Re.MOVE:Re.POINTER,he.feature=H[0].properties.meta),C.events.currentModeName().indexOf("draw")!==-1&&(he.mouse=Re.ADD),C.ui.queueMapClasses(he),C.ui.updateMapClasses(),H[0]}function Mn(T,C){var H=T.x-C.x,he=T.y-C.y;return Math.sqrt(H*H+he*he)}function pn(T,C,H){H===void 0&&(H={});var he=H.fineTolerance!=null?H.fineTolerance:4,Ee=H.grossTolerance!=null?H.grossTolerance:12,Te=H.interval!=null?H.interval:500;T.point=T.point||C.point,T.time=T.time||C.time;var Ie=Mn(T.point,C.point);return Ie<he||Ie<Ee&&C.time-T.time<Te}function nn(T,C,H){H===void 0&&(H={});var he=H.tolerance!=null?H.tolerance:25,Ee=H.interval!=null?H.interval:250;return T.point=T.point||C.point,T.time=T.time||C.time,Mn(T.point,C.point)<he&&C.time-T.time<Ee}var Kt={},rn={get exports(){return Kt},set exports(T){Kt=T}}.exports=function(T,C){if(C||(C=16),T===void 0&&(T=128),T<=0)return"0";for(var H=Math.log(Math.pow(2,T))/Math.log(C),he=2;H===1/0;he*=2)H=Math.log(Math.pow(2,T/he))/Math.log(C)*he;var Ee=H-Math.floor(H),Te="";for(he=0;he<Math.floor(H);he++)Te=Math.floor(Math.random()*C).toString(C)+Te;if(Ee){var Ie=Math.pow(C,Ee);Te=Math.floor(Math.random()*Ie).toString(C)+Te}var wt=parseInt(Te,C);return wt!==1/0&&wt>=Math.pow(2,T)?rn(T,C):Te};rn.rack=function(T,C,H){var he=function(Te){var Ie=0;do{if(Ie++>10){if(!H)throw new Error("too many ID collisions, use more bits");T+=H}var wt=rn(T,C)}while(Object.hasOwnProperty.call(Ee,wt));return Ee[wt]=Te,wt},Ee=he.hats={};return he.get=function(Te){return he.hats[Te]},he.set=function(Te,Ie){return he.hats[Te]=Ie,he},he.bits=T||128,he.base=C||16,he};var en=function(T,C){this.ctx=T,this.properties=C.properties||{},this.coordinates=C.geometry.coordinates,this.id=C.id||Kt(),this.type=C.geometry.type};en.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},en.prototype.incomingCoords=function(T){this.setCoordinates(T)},en.prototype.setCoordinates=function(T){this.coordinates=T,this.changed()},en.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},en.prototype.setProperty=function(T,C){this.properties[T]=C},en.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Ce.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},en.prototype.internal=function(T){var C={id:this.id,meta:Qe.FEATURE,"meta:type":this.type,active:Mt.INACTIVE,mode:T};if(this.ctx.options.userProperties)for(var H in this.properties)C["user_"+H]=this.properties[H];return{type:Ce.FEATURE,properties:C,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Wr=function(T,C){en.call(this,T,C)};(Wr.prototype=Object.create(en.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Wr.prototype.updateCoordinate=function(T,C,H){this.coordinates=arguments.length===3?[C,H]:[T,C],this.changed()},Wr.prototype.getCoordinate=function(){return this.getCoordinates()};var or=function(T,C){en.call(this,T,C)};(or.prototype=Object.create(en.prototype)).isValid=function(){return this.coordinates.length>1},or.prototype.addCoordinate=function(T,C,H){this.changed();var he=parseInt(T,10);this.coordinates.splice(he,0,[C,H])},or.prototype.getCoordinate=function(T){var C=parseInt(T,10);return JSON.parse(JSON.stringify(this.coordinates[C]))},or.prototype.removeCoordinate=function(T){this.changed(),this.coordinates.splice(parseInt(T,10),1)},or.prototype.updateCoordinate=function(T,C,H){var he=parseInt(T,10);this.coordinates[he]=[C,H],this.changed()};var Zn=function(T,C){en.call(this,T,C),this.coordinates=this.coordinates.map(function(H){return H.slice(0,-1)})};(Zn.prototype=Object.create(en.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(T){return T.length>2})},Zn.prototype.incomingCoords=function(T){this.coordinates=T.map(function(C){return C.slice(0,-1)}),this.changed()},Zn.prototype.setCoordinates=function(T){this.coordinates=T,this.changed()},Zn.prototype.addCoordinate=function(T,C,H){this.changed();var he=T.split(".").map(function(Ee){return parseInt(Ee,10)});this.coordinates[he[0]].splice(he[1],0,[C,H])},Zn.prototype.removeCoordinate=function(T){this.changed();var C=T.split(".").map(function(he){return parseInt(he,10)}),H=this.coordinates[C[0]];H&&(H.splice(C[1],1),H.length<3&&this.coordinates.splice(C[0],1))},Zn.prototype.getCoordinate=function(T){var C=T.split(".").map(function(he){return parseInt(he,10)}),H=this.coordinates[C[0]];return JSON.parse(JSON.stringify(H[C[1]]))},Zn.prototype.getCoordinates=function(){return this.coordinates.map(function(T){return T.concat([T[0]])})},Zn.prototype.updateCoordinate=function(T,C,H){this.changed();var he=T.split("."),Ee=parseInt(he[0],10),Te=parseInt(he[1],10);this.coordinates[Ee]===void 0&&(this.coordinates[Ee]=[]),this.coordinates[Ee][Te]=[C,H]};var no={MultiPoint:Wr,MultiLineString:or,MultiPolygon:Zn},Rr=function(T,C,H,he,Ee){var Te=H.split("."),Ie=parseInt(Te[0],10),wt=Te[1]?Te.slice(1).join("."):null;return T[Ie][C](wt,he,Ee)},hn=function(T,C){if(en.call(this,T,C),delete this.coordinates,this.model=no[C.geometry.type],this.model===void 0)throw new TypeError(C.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(C.geometry.coordinates)};function fi(T){this.map=T.map,this.drawConfig=JSON.parse(JSON.stringify(T.options||{})),this._ctx=T}(hn.prototype=Object.create(en.prototype))._coordinatesToFeatures=function(T){var C=this,H=this.model.bind(this);return T.map(function(he){return new H(C.ctx,{id:Kt(),type:Ce.FEATURE,properties:{},geometry:{coordinates:he,type:C.type.replace("Multi","")}})})},hn.prototype.isValid=function(){return this.features.every(function(T){return T.isValid()})},hn.prototype.setCoordinates=function(T){this.features=this._coordinatesToFeatures(T),this.changed()},hn.prototype.getCoordinate=function(T){return Rr(this.features,"getCoordinate",T)},hn.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(T){return T.type===Ce.POLYGON?T.getCoordinates():T.coordinates})))},hn.prototype.updateCoordinate=function(T,C,H){Rr(this.features,"updateCoordinate",T,C,H),this.changed()},hn.prototype.addCoordinate=function(T,C,H){Rr(this.features,"addCoordinate",T,C,H),this.changed()},hn.prototype.removeCoordinate=function(T){Rr(this.features,"removeCoordinate",T),this.changed()},hn.prototype.getFeatures=function(){return this.features},fi.prototype.setSelected=function(T){return this._ctx.store.setSelected(T)},fi.prototype.setSelectedCoordinates=function(T){var C=this;this._ctx.store.setSelectedCoordinates(T),T.reduce(function(H,he){return H[he.feature_id]===void 0&&(H[he.feature_id]=!0,C._ctx.store.get(he.feature_id).changed()),H},{})},fi.prototype.getSelected=function(){return this._ctx.store.getSelected()},fi.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},fi.prototype.isSelected=function(T){return this._ctx.store.isSelected(T)},fi.prototype.getFeature=function(T){return this._ctx.store.get(T)},fi.prototype.select=function(T){return this._ctx.store.select(T)},fi.prototype.deselect=function(T){return this._ctx.store.deselect(T)},fi.prototype.deleteFeature=function(T,C){return C===void 0&&(C={}),this._ctx.store.delete(T,C)},fi.prototype.addFeature=function(T){return this._ctx.store.add(T)},fi.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},fi.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},fi.prototype.setActionableState=function(T){T===void 0&&(T={});var C={trash:T.trash||!1,combineFeatures:T.combineFeatures||!1,uncombineFeatures:T.uncombineFeatures||!1};return this._ctx.events.actionable(C)},fi.prototype.changeMode=function(T,C,H){return C===void 0&&(C={}),H===void 0&&(H={}),this._ctx.events.changeMode(T,C,H)},fi.prototype.updateUIClasses=function(T){return this._ctx.ui.queueMapClasses(T)},fi.prototype.activateUIButton=function(T){return this._ctx.ui.setActiveButton(T)},fi.prototype.featuresAt=function(T,C,H){if(H===void 0&&(H="click"),H!=="click"&&H!=="touch")throw new Error("invalid buffer type");return ki[H](T,C,this._ctx)},fi.prototype.newFeature=function(T){var C=T.geometry.type;return C===Ce.POINT?new Wr(this._ctx,T):C===Ce.LINE_STRING?new or(this._ctx,T):C===Ce.POLYGON?new Zn(this._ctx,T):new hn(this._ctx,T)},fi.prototype.isInstanceOf=function(T,C){if(T===Ce.POINT)return C instanceof Wr;if(T===Ce.LINE_STRING)return C instanceof or;if(T===Ce.POLYGON)return C instanceof Zn;if(T==="MultiFeature")return C instanceof hn;throw new Error("Unknown feature class: "+T)},fi.prototype.doRender=function(T){return this._ctx.store.featureChanged(T)},fi.prototype.onSetup=function(){},fi.prototype.onDrag=function(){},fi.prototype.onClick=function(){},fi.prototype.onMouseMove=function(){},fi.prototype.onMouseDown=function(){},fi.prototype.onMouseUp=function(){},fi.prototype.onMouseOut=function(){},fi.prototype.onKeyUp=function(){},fi.prototype.onKeyDown=function(){},fi.prototype.onTouchStart=function(){},fi.prototype.onTouchMove=function(){},fi.prototype.onTouchEnd=function(){},fi.prototype.onTap=function(){},fi.prototype.onStop=function(){},fi.prototype.onTrash=function(){},fi.prototype.onCombineFeature=function(){},fi.prototype.onUncombineFeature=function(){},fi.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Yr={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},zr=Object.keys(Yr);function Bt(T){var C=Object.keys(T);return function(H,he){he===void 0&&(he={});var Ee={},Te=C.reduce(function(Ie,wt){return Ie[wt]=T[wt],Ie},new fi(H));return{start:function(){var Ie=this;Ee=Te.onSetup(he),zr.forEach(function(wt){var xt,Ft=Yr[wt],St=function(){return!1};T[Ft]&&(St=function(){return!0}),Ie.on(wt,St,(xt=Ft,function(Lt){return Te[xt](Ee,Lt)}))})},stop:function(){Te.onStop(Ee)},trash:function(){Te.onTrash(Ee)},combineFeatures:function(){Te.onCombineFeatures(Ee)},uncombineFeatures:function(){Te.onUncombineFeatures(Ee)},render:function(Ie,wt){Te.toDisplayFeatures(Ee,Ie,wt)}}}}function Oi(T){return[].concat(T).filter(function(C){return C!==void 0})}function ro(){var T=this;if(!(T.ctx.map&&T.ctx.map.getSource(de.HOT)!==void 0))return xt();var C=T.ctx.events.currentModeName();T.ctx.ui.queueMapClasses({mode:C});var H=[],he=[];T.isDirty?he=T.getAllIds():(H=T.getChangedIds().filter(function(Ft){return T.get(Ft)!==void 0}),he=T.sources.hot.filter(function(Ft){return Ft.properties.id&&H.indexOf(Ft.properties.id)===-1&&T.get(Ft.properties.id)!==void 0}).map(function(Ft){return Ft.properties.id})),T.sources.hot=[];var Ee=T.sources.cold.length;T.sources.cold=T.isDirty?[]:T.sources.cold.filter(function(Ft){var St=Ft.properties.id||Ft.properties.parent;return H.indexOf(St)===-1});var Te=Ee!==T.sources.cold.length||he.length>0;function Ie(Ft,St){var Lt=T.get(Ft).internal(C);T.ctx.events.currentModeRender(Lt,function(_i){T.sources[St].push(_i)})}if(H.forEach(function(Ft){return Ie(Ft,"hot")}),he.forEach(function(Ft){return Ie(Ft,"cold")}),Te&&T.ctx.map.getSource(de.COLD).setData({type:Ce.FEATURE_COLLECTION,features:T.sources.cold}),T.ctx.map.getSource(de.HOT).setData({type:Ce.FEATURE_COLLECTION,features:T.sources.hot}),T._emitSelectionChange&&(T.ctx.map.fire(rt.SELECTION_CHANGE,{features:T.getSelected().map(function(Ft){return Ft.toGeoJSON()}),points:T.getSelectedCoordinates().map(function(Ft){return{type:Ce.FEATURE,properties:{},geometry:{type:Ce.POINT,coordinates:Ft.coordinates}}})}),T._emitSelectionChange=!1),T._deletedFeaturesToEmit.length){var wt=T._deletedFeaturesToEmit.map(function(Ft){return Ft.toGeoJSON()});T._deletedFeaturesToEmit=[],T.ctx.map.fire(rt.DELETE,{features:wt})}function xt(){T.isDirty=!1,T.clearChangedIds()}xt(),T.ctx.map.fire(rt.RENDER,{})}function Gt(T){var C,H=this;this._features={},this._featureIds=new qt,this._selectedFeatureIds=new qt,this._selectedCoordinates=[],this._changedFeatureIds=new qt,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=T,this.sources={hot:[],cold:[]},this.render=function(){C||(C=requestAnimationFrame(function(){C=null,ro.call(H)}))},this.isDirty=!1}function Cr(T,C){var H=T._selectedCoordinates.filter(function(he){return T._selectedFeatureIds.has(he.feature_id)});T._selectedCoordinates.length===H.length||C.silent||(T._emitSelectionChange=!0),T._selectedCoordinates=H}Gt.prototype.createRenderBatch=function(){var T=this,C=this.render,H=0;return this.render=function(){H++},function(){T.render=C,H>0&&T.render()}},Gt.prototype.setDirty=function(){return this.isDirty=!0,this},Gt.prototype.featureChanged=function(T){return this._changedFeatureIds.add(T),this},Gt.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Gt.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Gt.prototype.getAllIds=function(){return this._featureIds.values()},Gt.prototype.add=function(T){return this.featureChanged(T.id),this._features[T.id]=T,this._featureIds.add(T.id),this},Gt.prototype.delete=function(T,C){var H=this;return C===void 0&&(C={}),Oi(T).forEach(function(he){H._featureIds.has(he)&&(H._featureIds.delete(he),H._selectedFeatureIds.delete(he),C.silent||H._deletedFeaturesToEmit.indexOf(H._features[he])===-1&&H._deletedFeaturesToEmit.push(H._features[he]),delete H._features[he],H.isDirty=!0)}),Cr(this,C),this},Gt.prototype.get=function(T){return this._features[T]},Gt.prototype.getAll=function(){var T=this;return Object.keys(this._features).map(function(C){return T._features[C]})},Gt.prototype.select=function(T,C){var H=this;return C===void 0&&(C={}),Oi(T).forEach(function(he){H._selectedFeatureIds.has(he)||(H._selectedFeatureIds.add(he),H._changedFeatureIds.add(he),C.silent||(H._emitSelectionChange=!0))}),this},Gt.prototype.deselect=function(T,C){var H=this;return C===void 0&&(C={}),Oi(T).forEach(function(he){H._selectedFeatureIds.has(he)&&(H._selectedFeatureIds.delete(he),H._changedFeatureIds.add(he),C.silent||(H._emitSelectionChange=!0))}),Cr(this,C),this},Gt.prototype.clearSelected=function(T){return T===void 0&&(T={}),this.deselect(this._selectedFeatureIds.values(),{silent:T.silent}),this},Gt.prototype.setSelected=function(T,C){var H=this;return C===void 0&&(C={}),T=Oi(T),this.deselect(this._selectedFeatureIds.values().filter(function(he){return T.indexOf(he)===-1}),{silent:C.silent}),this.select(T.filter(function(he){return!H._selectedFeatureIds.has(he)}),{silent:C.silent}),this},Gt.prototype.setSelectedCoordinates=function(T){return this._selectedCoordinates=T,this._emitSelectionChange=!0,this},Gt.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Gt.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Gt.prototype.getSelected=function(){var T=this;return this._selectedFeatureIds.values().map(function(C){return T.get(C)})},Gt.prototype.getSelectedCoordinates=function(){var T=this;return this._selectedCoordinates.map(function(C){return{coordinates:T.get(C.feature_id).getCoordinate(C.coord_path)}})},Gt.prototype.isSelected=function(T){return this._selectedFeatureIds.has(T)},Gt.prototype.setFeatureProperty=function(T,C,H){this.get(T).setProperty(C,H),this.featureChanged(T)},Gt.prototype.storeMapConfig=function(){var T=this;lt.forEach(function(C){T.ctx.map[C]&&(T._mapInitialConfig[C]=T.ctx.map[C].isEnabled())})},Gt.prototype.restoreMapConfig=function(){var T=this;Object.keys(this._mapInitialConfig).forEach(function(C){T._mapInitialConfig[C]?T.ctx.map[C].enable():T.ctx.map[C].disable()})},Gt.prototype.getInitialConfigValue=function(T){return this._mapInitialConfig[T]===void 0||this._mapInitialConfig[T]};var kr=function(){for(var T=arguments,C={},H=0;H<arguments.length;H++){var he=T[H];for(var Ee in he)oo.call(he,Ee)&&(C[Ee]=he[Ee])}return C},oo=Object.prototype.hasOwnProperty,Wo=["mode","feature","mouse"];function ka(T){var C=null,H=null,he={onRemove:function(){return T.map.off("load",he.connect),clearInterval(H),he.removeLayers(),T.store.restoreMapConfig(),T.ui.removeButtons(),T.events.removeEventListeners(),T.ui.clearMapClasses(),T.map=null,T.container=null,T.store=null,C&&C.parentNode&&C.parentNode.removeChild(C),C=null,this},connect:function(){T.map.off("load",he.connect),clearInterval(H),he.addLayers(),T.store.storeMapConfig(),T.events.addEventListeners()},onAdd:function(Ee){var Te=Ee.fire;return Ee.fire=function(Ie,wt){var xt=arguments;return Te.length===1&&arguments.length!==1&&(xt=[kr({},{type:Ie},wt)]),Te.apply(Ee,xt)},T.map=Ee,T.events=function(Ie){var wt=Object.keys(Ie.options.modes).reduce(function(dt,Nt){return dt[Nt]=Bt(Ie.options.modes[Nt]),dt},{}),xt={},Ft={},St={},Lt=null,_i=null;St.drag=function(dt,Nt){Nt({point:dt.point,time:new Date().getTime()})?(Ie.ui.queueMapClasses({mouse:Re.DRAG}),_i.drag(dt)):dt.originalEvent.stopPropagation()},St.mousedrag=function(dt){St.drag(dt,function(Nt){return!pn(xt,Nt)})},St.touchdrag=function(dt){St.drag(dt,function(Nt){return!nn(Ft,Nt)})},St.mousemove=function(dt){if((dt.originalEvent.buttons!==void 0?dt.originalEvent.buttons:dt.originalEvent.which)===1)return St.mousedrag(dt);var Nt=ii(dt,Ie);dt.featureTarget=Nt,_i.mousemove(dt)},St.mousedown=function(dt){xt={time:new Date().getTime(),point:dt.point};var Nt=ii(dt,Ie);dt.featureTarget=Nt,_i.mousedown(dt)},St.mouseup=function(dt){var Nt=ii(dt,Ie);dt.featureTarget=Nt,pn(xt,{point:dt.point,time:new Date().getTime()})?_i.click(dt):_i.mouseup(dt)},St.mouseout=function(dt){_i.mouseout(dt)},St.touchstart=function(dt){if(dt.originalEvent.preventDefault(),Ie.options.touchEnabled){Ft={time:new Date().getTime(),point:dt.point};var Nt=ki.touch(dt,null,Ie)[0];dt.featureTarget=Nt,_i.touchstart(dt)}},St.touchmove=function(dt){if(dt.originalEvent.preventDefault(),Ie.options.touchEnabled)return _i.touchmove(dt),St.touchdrag(dt)},St.touchend=function(dt){if(dt.originalEvent.preventDefault(),Ie.options.touchEnabled){var Nt=ki.touch(dt,null,Ie)[0];dt.featureTarget=Nt,nn(Ft,{time:new Date().getTime(),point:dt.point})?_i.tap(dt):_i.touchend(dt)}};var kn=function(dt){return!(dt===8||dt===46||dt>=48&&dt<=57)};function gi(dt,Nt,bi){bi===void 0&&(bi={}),_i.stop();var fr=wt[dt];if(fr===void 0)throw new Error(dt+" is not valid");Lt=dt;var er=fr(Ie,Nt);_i=g(er,Ie),bi.silent||Ie.map.fire(rt.MODE_CHANGE,{mode:dt}),Ie.store.setDirty(),Ie.store.render()}St.keydown=function(dt){(dt.srcElement||dt.target).classList[0]==="mapboxgl-canvas"&&(dt.keyCode!==8&&dt.keyCode!==46||!Ie.options.controls.trash?kn(dt.keyCode)?_i.keydown(dt):dt.keyCode===49&&Ie.options.controls.point?gi(qe.DRAW_POINT):dt.keyCode===50&&Ie.options.controls.line_string?gi(qe.DRAW_LINE_STRING):dt.keyCode===51&&Ie.options.controls.polygon&&gi(qe.DRAW_POLYGON):(dt.preventDefault(),_i.trash()))},St.keyup=function(dt){kn(dt.keyCode)&&_i.keyup(dt)},St.zoomend=function(){Ie.store.changeZoom()},St.data=function(dt){if(dt.dataType==="style"){var Nt=Ie.setup,bi=Ie.map,fr=Ie.options,er=Ie.store;fr.styles.some(function(Zr){return bi.getLayer(Zr.id)})||(Nt.addLayers(),er.setDirty(),er.render())}};var Gn={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Lt=Ie.options.defaultMode,_i=g(wt[Lt](Ie),Ie)},changeMode:gi,actionable:function(dt){var Nt=!1;Object.keys(dt).forEach(function(bi){if(Gn[bi]===void 0)throw new Error("Invalid action type");Gn[bi]!==dt[bi]&&(Nt=!0),Gn[bi]=dt[bi]}),Nt&&Ie.map.fire(rt.ACTIONABLE,{actions:Gn})},currentModeName:function(){return Lt},currentModeRender:function(dt,Nt){return _i.render(dt,Nt)},fire:function(dt,Nt){St[dt]&&St[dt](Nt)},addEventListeners:function(){Ie.map.on("mousemove",St.mousemove),Ie.map.on("mousedown",St.mousedown),Ie.map.on("mouseup",St.mouseup),Ie.map.on("data",St.data),Ie.map.on("touchmove",St.touchmove),Ie.map.on("touchstart",St.touchstart),Ie.map.on("touchend",St.touchend),Ie.container.addEventListener("mouseout",St.mouseout),Ie.options.keybindings&&(Ie.container.addEventListener("keydown",St.keydown),Ie.container.addEventListener("keyup",St.keyup))},removeEventListeners:function(){Ie.map.off("mousemove",St.mousemove),Ie.map.off("mousedown",St.mousedown),Ie.map.off("mouseup",St.mouseup),Ie.map.off("data",St.data),Ie.map.off("touchmove",St.touchmove),Ie.map.off("touchstart",St.touchstart),Ie.map.off("touchend",St.touchend),Ie.container.removeEventListener("mouseout",St.mouseout),Ie.options.keybindings&&(Ie.container.removeEventListener("keydown",St.keydown),Ie.container.removeEventListener("keyup",St.keyup))},trash:function(dt){_i.trash(dt)},combineFeatures:function(){_i.combineFeatures()},uncombineFeatures:function(){_i.uncombineFeatures()},getMode:function(){return Lt}}}(T),T.ui=function(Ie){var wt={},xt=null,Ft={mode:null,feature:null,mouse:null},St={mode:null,feature:null,mouse:null};function Lt(dt){St=kr(St,dt)}function _i(){var dt,Nt;if(Ie.container){var bi=[],fr=[];Wo.forEach(function(er){St[er]!==Ft[er]&&(bi.push(er+"-"+Ft[er]),St[er]!==null&&fr.push(er+"-"+St[er]))}),bi.length>0&&(dt=Ie.container.classList).remove.apply(dt,bi),fr.length>0&&(Nt=Ie.container.classList).add.apply(Nt,fr),Ft=kr(Ft,St)}}function kn(dt,Nt){Nt===void 0&&(Nt={});var bi=document.createElement("button");return bi.className=_e.CONTROL_BUTTON+" "+Nt.className,bi.setAttribute("title",Nt.title),Nt.container.appendChild(bi),bi.addEventListener("click",function(fr){if(fr.preventDefault(),fr.stopPropagation(),fr.target===xt)return gi(),void Nt.onDeactivate();Gn(dt),Nt.onActivate()},!0),bi}function gi(){xt&&(xt.classList.remove(_e.ACTIVE_BUTTON),xt=null)}function Gn(dt){gi();var Nt=wt[dt];Nt&&Nt&&dt!=="trash"&&(Nt.classList.add(_e.ACTIVE_BUTTON),xt=Nt)}return{setActiveButton:Gn,queueMapClasses:Lt,updateMapClasses:_i,clearMapClasses:function(){Lt({mode:null,feature:null,mouse:null}),_i()},addButtons:function(){var dt=Ie.options.controls,Nt=document.createElement("div");return Nt.className=_e.CONTROL_GROUP+" "+_e.CONTROL_BASE,dt&&(dt[tt.LINE]&&(wt[tt.LINE]=kn(tt.LINE,{container:Nt,className:_e.CONTROL_BUTTON_LINE,title:"LineString tool "+(Ie.options.keybindings?"(l)":""),onActivate:function(){return Ie.events.changeMode(qe.DRAW_LINE_STRING)},onDeactivate:function(){return Ie.events.trash()}})),dt[tt.POLYGON]&&(wt[tt.POLYGON]=kn(tt.POLYGON,{container:Nt,className:_e.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(Ie.options.keybindings?"(p)":""),onActivate:function(){return Ie.events.changeMode(qe.DRAW_POLYGON)},onDeactivate:function(){return Ie.events.trash()}})),dt[tt.POINT]&&(wt[tt.POINT]=kn(tt.POINT,{container:Nt,className:_e.CONTROL_BUTTON_POINT,title:"Marker tool "+(Ie.options.keybindings?"(m)":""),onActivate:function(){return Ie.events.changeMode(qe.DRAW_POINT)},onDeactivate:function(){return Ie.events.trash()}})),dt.trash&&(wt.trash=kn("trash",{container:Nt,className:_e.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){Ie.events.trash()}})),dt.combine_features&&(wt.combine_features=kn("combineFeatures",{container:Nt,className:_e.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){Ie.events.combineFeatures()}})),dt.uncombine_features&&(wt.uncombine_features=kn("uncombineFeatures",{container:Nt,className:_e.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){Ie.events.uncombineFeatures()}}))),Nt},removeButtons:function(){Object.keys(wt).forEach(function(dt){var Nt=wt[dt];Nt.parentNode&&Nt.parentNode.removeChild(Nt),delete wt[dt]})}}}(T),T.container=Ee.getContainer(),T.store=new Gt(T),C=T.ui.addButtons(),T.options.boxSelect&&(Ee.boxZoom.disable(),Ee.dragPan.disable(),Ee.dragPan.enable()),Ee.loaded()?he.connect():(Ee.on("load",he.connect),H=setInterval(function(){Ee.loaded()&&he.connect()},16)),T.events.start(),C},addLayers:function(){T.map.addSource(de.COLD,{data:{type:Ce.FEATURE_COLLECTION,features:[]},type:"geojson"}),T.map.addSource(de.HOT,{data:{type:Ce.FEATURE_COLLECTION,features:[]},type:"geojson"}),T.options.styles.forEach(function(Ee){T.map.addLayer(Ee)}),T.store.setDirty(!0),T.store.render()},removeLayers:function(){T.options.styles.forEach(function(Ee){T.map.getLayer(Ee.id)&&T.map.removeLayer(Ee.id)}),T.map.getSource(de.COLD)&&T.map.removeSource(de.COLD),T.map.getSource(de.HOT)&&T.map.removeSource(de.HOT)}};return T.setup=he,he}var tn=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function dr(T){return function(C){var H=C.featureTarget;return!!H&&!!H.properties&&H.properties.meta===T}}function Br(T){return!!T.originalEvent&&!!T.originalEvent.shiftKey&&T.originalEvent.button===0}function Le(T){return!!T.featureTarget&&!!T.featureTarget.properties&&T.featureTarget.properties.active===Mt.ACTIVE&&T.featureTarget.properties.meta===Qe.FEATURE}function ri(T){return!!T.featureTarget&&!!T.featureTarget.properties&&T.featureTarget.properties.active===Mt.INACTIVE&&T.featureTarget.properties.meta===Qe.FEATURE}function br(T){return T.featureTarget===void 0}function zs(T){return!!T.featureTarget&&!!T.featureTarget.properties&&T.featureTarget.properties.meta===Qe.FEATURE}function Jr(T){var C=T.featureTarget;return!!C&&!!C.properties&&C.properties.meta===Qe.VERTEX}function vo(T){return!!T.originalEvent&&T.originalEvent.shiftKey===!0}function es(T){return T.keyCode===27}function ts(T){return T.keyCode===13}var so=Object.freeze({__proto__:null,isOfMetaType:dr,isShiftMousedown:Br,isActiveFeature:Le,isInactiveFeature:ri,noTarget:br,isFeature:zs,isVertex:Jr,isShiftDown:vo,isEscapeKey:es,isEnterKey:ts,isTrue:function(){return!0}}),Ba=ao;function ao(T,C){this.x=T,this.y=C}function is(T,C){var H=C.getBoundingClientRect();return new Ba(T.clientX-H.left-(C.clientLeft||0),T.clientY-H.top-(C.clientTop||0))}function qo(T,C,H,he){return{type:Ce.FEATURE,properties:{meta:Qe.VERTEX,parent:T,coord_path:H,active:he?Mt.ACTIVE:Mt.INACTIVE},geometry:{type:Ce.POINT,coordinates:C}}}function ks(T,C,H){var he=C.geometry.coordinates,Ee=H.geometry.coordinates;if(he[1]>85||he[1]<$e||Ee[1]>85||Ee[1]<$e)return null;var Te={lng:(he[0]+Ee[0])/2,lat:(he[1]+Ee[1])/2};return{type:Ce.FEATURE,properties:{meta:Qe.MIDPOINT,parent:T,lng:Te.lng,lat:Te.lat,coord_path:H.properties.coord_path},geometry:{type:Ce.POINT,coordinates:[Te.lng,Te.lat]}}}function ns(T,C,H){C===void 0&&(C={}),H===void 0&&(H=null);var he,Ee=T.geometry,Te=Ee.type,Ie=Ee.coordinates,wt=T.properties&&T.properties.id,xt=[];function Ft(Lt,_i){var kn="",gi=null;Lt.forEach(function(Gn,dt){var Nt=_i!=null?_i+"."+dt:String(dt),bi=qo(wt,Gn,Nt,St(Nt));if(C.midpoints&&gi){var fr=ks(wt,gi,bi);fr&&xt.push(fr)}gi=bi;var er=JSON.stringify(Gn);kn!==er&&xt.push(bi),dt===0&&(kn=er)})}function St(Lt){return!!C.selectedPaths&&C.selectedPaths.indexOf(Lt)!==-1}return Te===Ce.POINT?xt.push(qo(wt,Ie,H,St(H))):Te===Ce.POLYGON?Ie.forEach(function(Lt,_i){Ft(Lt,H!==null?H+"."+_i:String(_i))}):Te===Ce.LINE_STRING?Ft(Ie,H):Te.indexOf(Ce.MULTI_PREFIX)===0&&(he=Te.replace(Ce.MULTI_PREFIX,""),Ie.forEach(function(Lt,_i){var kn={type:Ce.FEATURE,properties:T.properties,geometry:{type:he,coordinates:Lt}};xt=xt.concat(ns(kn,C,_i))})),xt}ao.prototype={clone:function(){return new ao(this.x,this.y)},add:function(T){return this.clone()._add(T)},sub:function(T){return this.clone()._sub(T)},multByPoint:function(T){return this.clone()._multByPoint(T)},divByPoint:function(T){return this.clone()._divByPoint(T)},mult:function(T){return this.clone()._mult(T)},div:function(T){return this.clone()._div(T)},rotate:function(T){return this.clone()._rotate(T)},rotateAround:function(T,C){return this.clone()._rotateAround(T,C)},matMult:function(T){return this.clone()._matMult(T)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(T){return this.x===T.x&&this.y===T.y},dist:function(T){return Math.sqrt(this.distSqr(T))},distSqr:function(T){var C=T.x-this.x,H=T.y-this.y;return C*C+H*H},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(T){return Math.atan2(this.y-T.y,this.x-T.x)},angleWith:function(T){return this.angleWithSep(T.x,T.y)},angleWithSep:function(T,C){return Math.atan2(this.x*C-this.y*T,this.x*T+this.y*C)},_matMult:function(T){var C=T[0]*this.x+T[1]*this.y,H=T[2]*this.x+T[3]*this.y;return this.x=C,this.y=H,this},_add:function(T){return this.x+=T.x,this.y+=T.y,this},_sub:function(T){return this.x-=T.x,this.y-=T.y,this},_mult:function(T){return this.x*=T,this.y*=T,this},_div:function(T){return this.x/=T,this.y/=T,this},_multByPoint:function(T){return this.x*=T.x,this.y*=T.y,this},_divByPoint:function(T){return this.x/=T.x,this.y/=T.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var T=this.y;return this.y=this.x,this.x=-T,this},_rotate:function(T){var C=Math.cos(T),H=Math.sin(T),he=C*this.x-H*this.y,Ee=H*this.x+C*this.y;return this.x=he,this.y=Ee,this},_rotateAround:function(T,C){var H=Math.cos(T),he=Math.sin(T),Ee=C.x+H*(this.x-C.x)-he*(this.y-C.y),Te=C.y+he*(this.x-C.x)+H*(this.y-C.y);return this.x=Ee,this.y=Te,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ao.convert=function(T){return T instanceof ao?T:Array.isArray(T)?new ao(T[0],T[1]):T};var qr={enable:function(T){setTimeout(function(){T.map&&T.map.doubleClickZoom&&T._ctx&&T._ctx.store&&T._ctx.store.getInitialConfigValue&&T._ctx.store.getInitialConfigValue("doubleClickZoom")&&T.map.doubleClickZoom.enable()},0)},disable:function(T){setTimeout(function(){T.map&&T.map.doubleClickZoom&&T.map.doubleClickZoom.disable()},0)}},Bs={},Fa={get exports(){return Bs},set exports(T){Bs=T}},Io=function(T){if(!T||!T.type)return null;var C=aa[T.type];if(!C)return null;if(C==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:T}]};if(C==="feature")return{type:"FeatureCollection",features:[T]};if(C==="featurecollection")return T},aa={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},gc=Object.freeze({__proto__:null,default:function T(C){switch(C&&C.type||null){case"FeatureCollection":return C.features=C.features.reduce(function(H,he){return H.concat(T(he))},[]),C;case"Feature":return C.geometry?T(C.geometry).map(function(H){var he={type:"Feature",properties:JSON.parse(JSON.stringify(C.properties)),geometry:H};return C.id!==void 0&&(he.id=C.id),he}):[C];case"MultiPoint":return C.coordinates.map(function(H){return{type:"Point",coordinates:H}});case"MultiPolygon":return C.coordinates.map(function(H){return{type:"Polygon",coordinates:H}});case"MultiLineString":return C.coordinates.map(function(H){return{type:"LineString",coordinates:H}});case"GeometryCollection":return C.geometries.map(T).reduce(function(H,he){return H.concat(he)},[]);case"Point":case"Polygon":case"LineString":return[C]}}}),yc=Io,Fs=M(gc),Na=function(T){return function C(H){return Array.isArray(H)&&H.length&&typeof H[0]=="number"?[H]:H.reduce(function(he,Ee){return Array.isArray(Ee)&&Array.isArray(Ee[0])?he.concat(C(Ee)):(he.push(Ee),he)},[])}(T)};Fs instanceof Function||(Fs=Fs.default);var Qr={},la={get exports(){return Qr},set exports(T){Qr=T}}.exports=function(T){return new lo(T)};function lo(T){this.value=T}function ca(T,C,H){var he=[],Ee=[],Te=!0;return function Ie(wt){var xt=H?ne(wt):wt,Ft={},St=!0,Lt={node:xt,node_:wt,path:[].concat(he),parent:Ee[Ee.length-1],parents:Ee,key:he.slice(-1)[0],isRoot:he.length===0,level:he.length,circular:null,update:function(gi,Gn){Lt.isRoot||(Lt.parent.node[Lt.key]=gi),Lt.node=gi,Gn&&(St=!1)},delete:function(gi){delete Lt.parent.node[Lt.key],gi&&(St=!1)},remove:function(gi){ie(Lt.parent.node)?Lt.parent.node.splice(Lt.key,1):delete Lt.parent.node[Lt.key],gi&&(St=!1)},keys:null,before:function(gi){Ft.before=gi},after:function(gi){Ft.after=gi},pre:function(gi){Ft.pre=gi},post:function(gi){Ft.post=gi},stop:function(){Te=!1},block:function(){St=!1}};if(!Te)return Lt;function _i(){if(typeof Lt.node=="object"&&Lt.node!==null){Lt.keys&&Lt.node_===Lt.node||(Lt.keys=V(Lt.node)),Lt.isLeaf=Lt.keys.length==0;for(var gi=0;gi<Ee.length;gi++)if(Ee[gi].node_===wt){Lt.circular=Ee[gi];break}}else Lt.isLeaf=!0,Lt.keys=null;Lt.notLeaf=!Lt.isLeaf,Lt.notRoot=!Lt.isRoot}_i();var kn=C.call(Lt,Lt.node);return kn!==void 0&&Lt.update&&Lt.update(kn),Ft.before&&Ft.before.call(Lt,Lt.node),St&&(typeof Lt.node!="object"||Lt.node===null||Lt.circular||(Ee.push(Lt),_i(),ue(Lt.keys,function(gi,Gn){he.push(gi),Ft.pre&&Ft.pre.call(Lt,Lt.node[gi],gi);var dt=Ie(Lt.node[gi]);H&&be.call(Lt.node,gi)&&(Lt.node[gi]=dt.node),dt.isLast=Gn==Lt.keys.length-1,dt.isFirst=Gn==0,Ft.post&&Ft.post.call(Lt,dt),he.pop()}),Ee.pop()),Ft.after&&Ft.after.call(Lt,Lt.node)),Lt}(T).node}function ne(T){if(typeof T=="object"&&T!==null){var C;if(ie(T))C=[];else if(j(T)==="[object Date]")C=new Date(T.getTime?T.getTime():T);else if(function(Ee){return j(Ee)==="[object RegExp]"}(T))C=new RegExp(T);else if(function(Ee){return j(Ee)==="[object Error]"}(T))C={message:T.message};else if(function(Ee){return j(Ee)==="[object Boolean]"}(T))C=new Boolean(T);else if(function(Ee){return j(Ee)==="[object Number]"}(T))C=new Number(T);else if(function(Ee){return j(Ee)==="[object String]"}(T))C=new String(T);else if(Object.create&&Object.getPrototypeOf)C=Object.create(Object.getPrototypeOf(T));else if(T.constructor===Object)C={};else{var H=T.constructor&&T.constructor.prototype||T.__proto__||{},he=function(){};he.prototype=H,C=new he}return ue(V(T),function(Ee){C[Ee]=T[Ee]}),C}return T}lo.prototype.get=function(T){for(var C=this.value,H=0;H<T.length;H++){var he=T[H];if(!C||!be.call(C,he)){C=void 0;break}C=C[he]}return C},lo.prototype.has=function(T){for(var C=this.value,H=0;H<T.length;H++){var he=T[H];if(!C||!be.call(C,he))return!1;C=C[he]}return!0},lo.prototype.set=function(T,C){for(var H=this.value,he=0;he<T.length-1;he++){var Ee=T[he];be.call(H,Ee)||(H[Ee]={}),H=H[Ee]}return H[T[he]]=C,C},lo.prototype.map=function(T){return ca(this.value,T,!0)},lo.prototype.forEach=function(T){return this.value=ca(this.value,T,!1),this.value},lo.prototype.reduce=function(T,C){var H=arguments.length===1,he=H?this.value:C;return this.forEach(function(Ee){this.isRoot&&H||(he=T.call(this,he,Ee))}),he},lo.prototype.paths=function(){var T=[];return this.forEach(function(C){T.push(this.path)}),T},lo.prototype.nodes=function(){var T=[];return this.forEach(function(C){T.push(this.node)}),T},lo.prototype.clone=function(){var T=[],C=[];return function H(he){for(var Ee=0;Ee<T.length;Ee++)if(T[Ee]===he)return C[Ee];if(typeof he=="object"&&he!==null){var Te=ne(he);return T.push(he),C.push(Te),ue(V(he),function(Ie){Te[Ie]=H(he[Ie])}),T.pop(),C.pop(),Te}return he}(this.value)};var V=Object.keys||function(T){var C=[];for(var H in T)C.push(H);return C};function j(T){return Object.prototype.toString.call(T)}var ie=Array.isArray||function(T){return Object.prototype.toString.call(T)==="[object Array]"},ue=function(T,C){if(T.forEach)return T.forEach(C);for(var H=0;H<T.length;H++)C(T[H],H,T)};ue(V(lo.prototype),function(T){la[T]=function(C){var H=[].slice.call(arguments,1),he=new lo(C);return he[T].apply(he,H)}});var be=Object.hasOwnProperty||function(T,C){return C in T},ze=Me;function Me(T){if(!(this instanceof Me))return new Me(T);this._bbox=T||[1/0,1/0,-1/0,-1/0],this._valid=!!T}Me.prototype.include=function(T){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],T[0]),this._bbox[1]=Math.min(this._bbox[1],T[1]),this._bbox[2]=Math.max(this._bbox[2],T[0]),this._bbox[3]=Math.max(this._bbox[3],T[1]),this},Me.prototype.equals=function(T){var C;return C=T instanceof Me?T.bbox():T,this._bbox[0]==C[0]&&this._bbox[1]==C[1]&&this._bbox[2]==C[2]&&this._bbox[3]==C[3]},Me.prototype.center=function(T){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Me.prototype.union=function(T){var C;return this._valid=!0,C=T instanceof Me?T.bbox():T,this._bbox[0]=Math.min(this._bbox[0],C[0]),this._bbox[1]=Math.min(this._bbox[1],C[1]),this._bbox[2]=Math.max(this._bbox[2],C[2]),this._bbox[3]=Math.max(this._bbox[3],C[3]),this},Me.prototype.bbox=function(){return this._valid?this._bbox:null},Me.prototype.contains=function(T){if(!T)return this._fastContains();if(!this._valid)return null;var C=T[0],H=T[1];return this._bbox[0]<=C&&this._bbox[1]<=H&&this._bbox[2]>=C&&this._bbox[3]>=H},Me.prototype.intersect=function(T){return this._valid?(C=T instanceof Me?T.bbox():T,!(this._bbox[0]>C[2]||this._bbox[2]<C[0]||this._bbox[3]<C[1]||this._bbox[1]>C[3])):null;var C},Me.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var T="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",T)},Me.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Ae=function(T){if(!T)return[];var C=Fs(yc(T)),H=[];return C.features.forEach(function(he){he.geometry&&(H=H.concat(Na(he.geometry.coordinates)))}),H},Ue=Qr,ht=ze,Dt={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},yt=Object.keys(Dt);function ni(T){for(var C=ht(),H=Ae(T),he=0;he<H.length;he++)C.include(H[he]);return C}Fa.exports=function(T){return ni(T).bbox()},Bs.polygon=function(T){return ni(T).polygon()},Bs.bboxify=function(T){return Ue(T).map(function(C){C&&yt.some(function(H){return!!C[H]&&Dt[H].indexOf(C.type)!==-1})&&(C.bbox=ni(C).bbox(),this.update(C))})};var Jt=-90;function Qt(T,C){var H=Jt,he=90,Ee=Jt,Te=90,Ie=270,wt=-270;T.forEach(function(Ft){var St=Bs(Ft),Lt=St[1],_i=St[3],kn=St[0],gi=St[2];Lt>H&&(H=Lt),_i<he&&(he=_i),_i>Ee&&(Ee=_i),Lt<Te&&(Te=Lt),kn<Ie&&(Ie=kn),gi>wt&&(wt=gi)});var xt=C;return H+xt.lat>85&&(xt.lat=85-H),Ee+xt.lat>90&&(xt.lat=90-Ee),he+xt.lat<-85&&(xt.lat=-85-he),Te+xt.lat<Jt&&(xt.lat=Jt-Te),Ie+xt.lng<=-270&&(xt.lng+=360*Math.ceil(Math.abs(xt.lng)/360)),wt+xt.lng>=270&&(xt.lng-=360*Math.ceil(Math.abs(xt.lng)/360)),xt}function ai(T,C){var H=Qt(T.map(function(he){return he.toGeoJSON()}),C);T.forEach(function(he){var Ee,Te=he.getCoordinates(),Ie=function(xt){var Ft={lng:xt[0]+H.lng,lat:xt[1]+H.lat};return[Ft.lng,Ft.lat]},wt=function(xt){return xt.map(function(Ft){return Ie(Ft)})};he.type===Ce.POINT?Ee=Ie(Te):he.type===Ce.LINE_STRING||he.type===Ce.MULTI_POINT?Ee=Te.map(Ie):he.type===Ce.POLYGON||he.type===Ce.MULTI_LINE_STRING?Ee=Te.map(wt):he.type===Ce.MULTI_POLYGON&&(Ee=Te.map(function(xt){return xt.map(function(Ft){return wt(Ft)})})),he.incomingCoords(Ee)})}var oi={onSetup:function(T){var C=this,H={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:T.featureIds||[]};return this.setSelected(H.initiallySelectedFeatureIds.filter(function(he){return C.getFeature(he)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),H},fireUpdate:function(){this.map.fire(rt.UPDATE,{action:Je.MOVE,features:this.getSelected().map(function(T){return T.toGeoJSON()})})},fireActionable:function(){var T=this,C=this.getSelected(),H=C.filter(function(wt){return T.isInstanceOf("MultiFeature",wt)}),he=!1;if(C.length>1){he=!0;var Ee=C[0].type.replace("Multi","");C.forEach(function(wt){wt.type.replace("Multi","")!==Ee&&(he=!1)})}var Te=H.length>0,Ie=C.length>0;this.setActionableState({combineFeatures:he,uncombineFeatures:Te,trash:Ie})},getUniqueIds:function(T){return T.length?T.map(function(C){return C.properties.id}).filter(function(C){return C!==void 0}).reduce(function(C,H){return C.add(H),C},new qt).values():[]},stopExtendedInteractions:function(T){T.boxSelectElement&&(T.boxSelectElement.parentNode&&T.boxSelectElement.parentNode.removeChild(T.boxSelectElement),T.boxSelectElement=null),this.map.dragPan.enable(),T.boxSelecting=!1,T.canBoxSelect=!1,T.dragMoving=!1,T.canDragMove=!1},onStop:function(){qr.enable(this)},onMouseMove:function(T){return this.stopExtendedInteractions(T),!0},onMouseOut:function(T){return!T.dragMoving||this.fireUpdate()}};oi.onTap=oi.onClick=function(T,C){return br(C)?this.clickAnywhere(T,C):dr(Qe.VERTEX)(C)?this.clickOnVertex(T,C):zs(C)?this.clickOnFeature(T,C):void 0},oi.clickAnywhere=function(T){var C=this,H=this.getSelectedIds();H.length&&(this.clearSelectedFeatures(),H.forEach(function(he){return C.doRender(he)})),qr.enable(this),this.stopExtendedInteractions(T)},oi.clickOnVertex=function(T,C){this.changeMode(qe.DIRECT_SELECT,{featureId:C.featureTarget.properties.parent,coordPath:C.featureTarget.properties.coord_path,startPos:C.lngLat}),this.updateUIClasses({mouse:Re.MOVE})},oi.startOnActiveFeature=function(T,C){this.stopExtendedInteractions(T),this.map.dragPan.disable(),this.doRender(C.featureTarget.properties.id),T.canDragMove=!0,T.dragMoveLocation=C.lngLat},oi.clickOnFeature=function(T,C){var H=this;qr.disable(this),this.stopExtendedInteractions(T);var he=vo(C),Ee=this.getSelectedIds(),Te=C.featureTarget.properties.id,Ie=this.isSelected(Te);if(!he&&Ie&&this.getFeature(Te).type!==Ce.POINT)return this.changeMode(qe.DIRECT_SELECT,{featureId:Te});Ie&&he?(this.deselect(Te),this.updateUIClasses({mouse:Re.POINTER}),Ee.length===1&&qr.enable(this)):!Ie&&he?(this.select(Te),this.updateUIClasses({mouse:Re.MOVE})):Ie||he||(Ee.forEach(function(wt){return H.doRender(wt)}),this.setSelected(Te),this.updateUIClasses({mouse:Re.MOVE})),this.doRender(Te)},oi.onMouseDown=function(T,C){return Le(C)?this.startOnActiveFeature(T,C):this.drawConfig.boxSelect&&Br(C)?this.startBoxSelect(T,C):void 0},oi.startBoxSelect=function(T,C){this.stopExtendedInteractions(T),this.map.dragPan.disable(),T.boxSelectStartLocation=is(C.originalEvent,this.map.getContainer()),T.canBoxSelect=!0},oi.onTouchStart=function(T,C){if(Le(C))return this.startOnActiveFeature(T,C)},oi.onDrag=function(T,C){return T.canDragMove?this.dragMove(T,C):this.drawConfig.boxSelect&&T.canBoxSelect?this.whileBoxSelect(T,C):void 0},oi.whileBoxSelect=function(T,C){T.boxSelecting=!0,this.updateUIClasses({mouse:Re.ADD}),T.boxSelectElement||(T.boxSelectElement=document.createElement("div"),T.boxSelectElement.classList.add(_e.BOX_SELECT),this.map.getContainer().appendChild(T.boxSelectElement));var H=is(C.originalEvent,this.map.getContainer()),he=Math.min(T.boxSelectStartLocation.x,H.x),Ee=Math.max(T.boxSelectStartLocation.x,H.x),Te=Math.min(T.boxSelectStartLocation.y,H.y),Ie=Math.max(T.boxSelectStartLocation.y,H.y),wt="translate("+he+"px, "+Te+"px)";T.boxSelectElement.style.transform=wt,T.boxSelectElement.style.WebkitTransform=wt,T.boxSelectElement.style.width=Ee-he+"px",T.boxSelectElement.style.height=Ie-Te+"px"},oi.dragMove=function(T,C){T.dragMoving=!0,C.originalEvent.stopPropagation();var H={lng:C.lngLat.lng-T.dragMoveLocation.lng,lat:C.lngLat.lat-T.dragMoveLocation.lat};ai(this.getSelected(),H),T.dragMoveLocation=C.lngLat},oi.onTouchEnd=oi.onMouseUp=function(T,C){var H=this;if(T.dragMoving)this.fireUpdate();else if(T.boxSelecting){var he=[T.boxSelectStartLocation,is(C.originalEvent,this.map.getContainer())],Ee=this.featuresAt(null,he,"click"),Te=this.getUniqueIds(Ee).filter(function(Ie){return!H.isSelected(Ie)});Te.length&&(this.select(Te),Te.forEach(function(Ie){return H.doRender(Ie)}),this.updateUIClasses({mouse:Re.MOVE}))}this.stopExtendedInteractions(T)},oi.toDisplayFeatures=function(T,C,H){C.properties.active=this.isSelected(C.properties.id)?Mt.ACTIVE:Mt.INACTIVE,H(C),this.fireActionable(),C.properties.active===Mt.ACTIVE&&C.geometry.type!==Ce.POINT&&ns(C).forEach(H)},oi.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},oi.onCombineFeatures=function(){var T=this.getSelected();if(!(T.length===0||T.length<2)){for(var C=[],H=[],he=T[0].type.replace("Multi",""),Ee=0;Ee<T.length;Ee++){var Te=T[Ee];if(Te.type.replace("Multi","")!==he)return;Te.type.includes("Multi")?Te.getCoordinates().forEach(function(wt){C.push(wt)}):C.push(Te.getCoordinates()),H.push(Te.toGeoJSON())}if(H.length>1){var Ie=this.newFeature({type:Ce.FEATURE,properties:H[0].properties,geometry:{type:"Multi"+he,coordinates:C}});this.addFeature(Ie),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Ie.id]),this.map.fire(rt.COMBINE_FEATURES,{createdFeatures:[Ie.toGeoJSON()],deletedFeatures:H})}this.fireActionable()}},oi.onUncombineFeatures=function(){var T=this,C=this.getSelected();if(C.length!==0){for(var H=[],he=[],Ee=function(Ie){var wt=C[Ie];T.isInstanceOf("MultiFeature",wt)&&(wt.getFeatures().forEach(function(xt){T.addFeature(xt),xt.properties=wt.properties,H.push(xt.toGeoJSON()),T.select([xt.id])}),T.deleteFeature(wt.id,{silent:!0}),he.push(wt.toGeoJSON()))},Te=0;Te<C.length;Te++)Ee(Te);H.length>1&&this.map.fire(rt.UNCOMBINE_FEATURES,{createdFeatures:H,deletedFeatures:he}),this.fireActionable()}};var Hi=dr(Qe.VERTEX),li=dr(Qe.MIDPOINT),Vi={fireUpdate:function(){this.map.fire(rt.UPDATE,{action:Je.CHANGE_COORDINATES,features:this.getSelected().map(function(T){return T.toGeoJSON()})})},fireActionable:function(T){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:T.selectedCoordPaths.length>0})},startDragging:function(T,C){this.map.dragPan.disable(),T.canDragMove=!0,T.dragMoveLocation=C.lngLat},stopDragging:function(T){this.map.dragPan.enable(),T.dragMoving=!1,T.canDragMove=!1,T.dragMoveLocation=null},onVertex:function(T,C){this.startDragging(T,C);var H=C.featureTarget.properties,he=T.selectedCoordPaths.indexOf(H.coord_path);vo(C)||he!==-1?vo(C)&&he===-1&&T.selectedCoordPaths.push(H.coord_path):T.selectedCoordPaths=[H.coord_path];var Ee=this.pathsToCoordinates(T.featureId,T.selectedCoordPaths);this.setSelectedCoordinates(Ee)},onMidpoint:function(T,C){this.startDragging(T,C);var H=C.featureTarget.properties;T.feature.addCoordinate(H.coord_path,H.lng,H.lat),this.fireUpdate(),T.selectedCoordPaths=[H.coord_path]},pathsToCoordinates:function(T,C){return C.map(function(H){return{feature_id:T,coord_path:H}})},onFeature:function(T,C){T.selectedCoordPaths.length===0?this.startDragging(T,C):this.stopDragging(T)},dragFeature:function(T,C,H){ai(this.getSelected(),H),T.dragMoveLocation=C.lngLat},dragVertex:function(T,C,H){for(var he=T.selectedCoordPaths.map(function(wt){return T.feature.getCoordinate(wt)}),Ee=Qt(he.map(function(wt){return{type:Ce.FEATURE,properties:{},geometry:{type:Ce.POINT,coordinates:wt}}}),H),Te=0;Te<he.length;Te++){var Ie=he[Te];T.feature.updateCoordinate(T.selectedCoordPaths[Te],Ie[0]+Ee.lng,Ie[1]+Ee.lat)}},clickNoTarget:function(){this.changeMode(qe.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(qe.SIMPLE_SELECT)},clickActiveFeature:function(T){T.selectedCoordPaths=[],this.clearSelectedCoordinates(),T.feature.changed()},onSetup:function(T){var C=T.featureId,H=this.getFeature(C);if(!H)throw new Error("You must provide a featureId to enter direct_select mode");if(H.type===Ce.POINT)throw new TypeError("direct_select mode doesn't handle point features");var he={featureId:C,feature:H,dragMoveLocation:T.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:T.coordPath?[T.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(C,he.selectedCoordPaths)),this.setSelected(C),qr.disable(this),this.setActionableState({trash:!0}),he},onStop:function(){qr.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(T,C,H){T.featureId===C.properties.id?(C.properties.active=Mt.ACTIVE,H(C),ns(C,{map:this.map,midpoints:!0,selectedPaths:T.selectedCoordPaths}).forEach(H)):(C.properties.active=Mt.INACTIVE,H(C)),this.fireActionable(T)},onTrash:function(T){T.selectedCoordPaths.sort(function(C,H){return H.localeCompare(C,"en",{numeric:!0})}).forEach(function(C){return T.feature.removeCoordinate(C)}),this.fireUpdate(),T.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(T),T.feature.isValid()===!1&&(this.deleteFeature([T.featureId]),this.changeMode(qe.SIMPLE_SELECT,{}))},onMouseMove:function(T,C){var H=Le(C),he=Hi(C),Ee=T.selectedCoordPaths.length===0;return H&&Ee||he&&!Ee?this.updateUIClasses({mouse:Re.MOVE}):this.updateUIClasses({mouse:Re.NONE}),this.stopDragging(T),!0},onMouseOut:function(T){return T.dragMoving&&this.fireUpdate(),!0}};Vi.onTouchStart=Vi.onMouseDown=function(T,C){return Hi(C)?this.onVertex(T,C):Le(C)?this.onFeature(T,C):li(C)?this.onMidpoint(T,C):void 0},Vi.onDrag=function(T,C){if(T.canDragMove===!0){T.dragMoving=!0,C.originalEvent.stopPropagation();var H={lng:C.lngLat.lng-T.dragMoveLocation.lng,lat:C.lngLat.lat-T.dragMoveLocation.lat};T.selectedCoordPaths.length>0?this.dragVertex(T,C,H):this.dragFeature(T,C,H),T.dragMoveLocation=C.lngLat}},Vi.onClick=function(T,C){return br(C)?this.clickNoTarget(T,C):Le(C)?this.clickActiveFeature(T,C):ri(C)?this.clickInactive(T,C):void this.stopDragging(T)},Vi.onTap=function(T,C){return br(C)?this.clickNoTarget(T,C):Le(C)?this.clickActiveFeature(T,C):ri(C)?this.clickInactive(T,C):void 0},Vi.onTouchEnd=Vi.onMouseUp=function(T){T.dragMoving&&this.fireUpdate(),this.stopDragging(T)};var Wi={};function rs(T,C){return!!T.lngLat&&T.lngLat.lng===C[0]&&T.lngLat.lat===C[1]}Wi.onSetup=function(){var T=this.newFeature({type:Ce.FEATURE,properties:{},geometry:{type:Ce.POINT,coordinates:[]}});return this.addFeature(T),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Re.ADD}),this.activateUIButton(tt.POINT),this.setActionableState({trash:!0}),{point:T}},Wi.stopDrawingAndRemove=function(T){this.deleteFeature([T.point.id],{silent:!0}),this.changeMode(qe.SIMPLE_SELECT)},Wi.onTap=Wi.onClick=function(T,C){this.updateUIClasses({mouse:Re.MOVE}),T.point.updateCoordinate("",C.lngLat.lng,C.lngLat.lat),this.map.fire(rt.CREATE,{features:[T.point.toGeoJSON()]}),this.changeMode(qe.SIMPLE_SELECT,{featureIds:[T.point.id]})},Wi.onStop=function(T){this.activateUIButton(),T.point.getCoordinate().length||this.deleteFeature([T.point.id],{silent:!0})},Wi.toDisplayFeatures=function(T,C,H){var he=C.properties.id===T.point.id;if(C.properties.active=he?Mt.ACTIVE:Mt.INACTIVE,!he)return H(C)},Wi.onTrash=Wi.stopDrawingAndRemove,Wi.onKeyUp=function(T,C){if(es(C)||ts(C))return this.stopDrawingAndRemove(T,C)};var co={onSetup:function(){var T=this.newFeature({type:Ce.FEATURE,properties:{},geometry:{type:Ce.POLYGON,coordinates:[[]]}});return this.addFeature(T),this.clearSelectedFeatures(),qr.disable(this),this.updateUIClasses({mouse:Re.ADD}),this.activateUIButton(tt.POLYGON),this.setActionableState({trash:!0}),{polygon:T,currentVertexPosition:0}},clickAnywhere:function(T,C){if(T.currentVertexPosition>0&&rs(C,T.polygon.coordinates[0][T.currentVertexPosition-1]))return this.changeMode(qe.SIMPLE_SELECT,{featureIds:[T.polygon.id]});this.updateUIClasses({mouse:Re.ADD}),T.polygon.updateCoordinate("0."+T.currentVertexPosition,C.lngLat.lng,C.lngLat.lat),T.currentVertexPosition++,T.polygon.updateCoordinate("0."+T.currentVertexPosition,C.lngLat.lng,C.lngLat.lat)},clickOnVertex:function(T){return this.changeMode(qe.SIMPLE_SELECT,{featureIds:[T.polygon.id]})},onMouseMove:function(T,C){T.polygon.updateCoordinate("0."+T.currentVertexPosition,C.lngLat.lng,C.lngLat.lat),Jr(C)&&this.updateUIClasses({mouse:Re.POINTER})}};co.onTap=co.onClick=function(T,C){return Jr(C)?this.clickOnVertex(T,C):this.clickAnywhere(T,C)},co.onKeyUp=function(T,C){es(C)?(this.deleteFeature([T.polygon.id],{silent:!0}),this.changeMode(qe.SIMPLE_SELECT)):ts(C)&&this.changeMode(qe.SIMPLE_SELECT,{featureIds:[T.polygon.id]})},co.onStop=function(T){this.updateUIClasses({mouse:Re.NONE}),qr.enable(this),this.activateUIButton(),this.getFeature(T.polygon.id)!==void 0&&(T.polygon.removeCoordinate("0."+T.currentVertexPosition),T.polygon.isValid()?this.map.fire(rt.CREATE,{features:[T.polygon.toGeoJSON()]}):(this.deleteFeature([T.polygon.id],{silent:!0}),this.changeMode(qe.SIMPLE_SELECT,{},{silent:!0})))},co.toDisplayFeatures=function(T,C,H){var he=C.properties.id===T.polygon.id;if(C.properties.active=he?Mt.ACTIVE:Mt.INACTIVE,!he)return H(C);if(C.geometry.coordinates.length!==0){var Ee=C.geometry.coordinates[0].length;if(!(Ee<3)){if(C.properties.meta=Qe.FEATURE,H(qo(T.polygon.id,C.geometry.coordinates[0][0],"0.0",!1)),Ee>3){var Te=C.geometry.coordinates[0].length-3;H(qo(T.polygon.id,C.geometry.coordinates[0][Te],"0."+Te,!1))}if(Ee<=4){var Ie=[[C.geometry.coordinates[0][0][0],C.geometry.coordinates[0][0][1]],[C.geometry.coordinates[0][1][0],C.geometry.coordinates[0][1][1]]];if(H({type:Ce.FEATURE,properties:C.properties,geometry:{coordinates:Ie,type:Ce.LINE_STRING}}),Ee===3)return}return H(C)}}},co.onTrash=function(T){this.deleteFeature([T.polygon.id],{silent:!0}),this.changeMode(qe.SIMPLE_SELECT)};var Ye={onSetup:function(T){var C,H,he=(T=T||{}).featureId,Ee="forward";if(he){if(!(C=this.getFeature(he)))throw new Error("Could not find a feature with the provided featureId");var Te=T.from;if(Te&&Te.type==="Feature"&&Te.geometry&&Te.geometry.type==="Point"&&(Te=Te.geometry),Te&&Te.type==="Point"&&Te.coordinates&&Te.coordinates.length===2&&(Te=Te.coordinates),!Te||!Array.isArray(Te))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Ie=C.coordinates.length-1;if(C.coordinates[Ie][0]===Te[0]&&C.coordinates[Ie][1]===Te[1])H=Ie+1,C.addCoordinate.apply(C,[H].concat(C.coordinates[Ie]));else{if(C.coordinates[0][0]!==Te[0]||C.coordinates[0][1]!==Te[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");Ee="backwards",H=0,C.addCoordinate.apply(C,[H].concat(C.coordinates[0]))}}else C=this.newFeature({type:Ce.FEATURE,properties:{},geometry:{type:Ce.LINE_STRING,coordinates:[]}}),H=0,this.addFeature(C);return this.clearSelectedFeatures(),qr.disable(this),this.updateUIClasses({mouse:Re.ADD}),this.activateUIButton(tt.LINE),this.setActionableState({trash:!0}),{line:C,currentVertexPosition:H,direction:Ee}},clickAnywhere:function(T,C){if(T.currentVertexPosition>0&&rs(C,T.line.coordinates[T.currentVertexPosition-1])||T.direction==="backwards"&&rs(C,T.line.coordinates[T.currentVertexPosition+1]))return this.changeMode(qe.SIMPLE_SELECT,{featureIds:[T.line.id]});this.updateUIClasses({mouse:Re.ADD}),T.line.updateCoordinate(T.currentVertexPosition,C.lngLat.lng,C.lngLat.lat),T.direction==="forward"?(T.currentVertexPosition++,T.line.updateCoordinate(T.currentVertexPosition,C.lngLat.lng,C.lngLat.lat)):T.line.addCoordinate(0,C.lngLat.lng,C.lngLat.lat)},clickOnVertex:function(T){return this.changeMode(qe.SIMPLE_SELECT,{featureIds:[T.line.id]})},onMouseMove:function(T,C){T.line.updateCoordinate(T.currentVertexPosition,C.lngLat.lng,C.lngLat.lat),Jr(C)&&this.updateUIClasses({mouse:Re.POINTER})}};Ye.onTap=Ye.onClick=function(T,C){if(Jr(C))return this.clickOnVertex(T,C);this.clickAnywhere(T,C)},Ye.onKeyUp=function(T,C){ts(C)?this.changeMode(qe.SIMPLE_SELECT,{featureIds:[T.line.id]}):es(C)&&(this.deleteFeature([T.line.id],{silent:!0}),this.changeMode(qe.SIMPLE_SELECT))},Ye.onStop=function(T){qr.enable(this),this.activateUIButton(),this.getFeature(T.line.id)!==void 0&&(T.line.removeCoordinate(""+T.currentVertexPosition),T.line.isValid()?this.map.fire(rt.CREATE,{features:[T.line.toGeoJSON()]}):(this.deleteFeature([T.line.id],{silent:!0}),this.changeMode(qe.SIMPLE_SELECT,{},{silent:!0})))},Ye.onTrash=function(T){this.deleteFeature([T.line.id],{silent:!0}),this.changeMode(qe.SIMPLE_SELECT)},Ye.toDisplayFeatures=function(T,C,H){var he=C.properties.id===T.line.id;if(C.properties.active=he?Mt.ACTIVE:Mt.INACTIVE,!he)return H(C);C.geometry.coordinates.length<2||(C.properties.meta=Qe.FEATURE,H(qo(T.line.id,C.geometry.coordinates[T.direction==="forward"?C.geometry.coordinates.length-2:1],""+(T.direction==="forward"?C.geometry.coordinates.length-2:1),!1)),H(C))};var os={simple_select:oi,direct_select:Vi,draw_point:Wi,draw_polygon:co,draw_line_string:Ye},sr={defaultMode:qe.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:tn,modes:os,controls:{},userProperties:!1},ua={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Bu={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function ss(T,C){return T.map(function(H){return H.source?H:kr(H,{id:H.id+"."+C,source:C==="hot"?de.HOT:de.COLD})})}var Ns={};(function(T,C){var H="__lodash_hash_undefined__",he=9007199254740991,Ee="[object Arguments]",Te="[object Array]",Ie="[object Boolean]",wt="[object Date]",xt="[object Error]",Ft="[object Function]",St="[object Map]",Lt="[object Number]",_i="[object Object]",kn="[object Promise]",gi="[object RegExp]",Gn="[object Set]",dt="[object String]",Nt="[object Symbol]",bi="[object WeakMap]",fr="[object ArrayBuffer]",er="[object DataView]",Zr=/^\[object .+?Constructor\]$/,uo=/^(?:0|[1-9]\d*)$/,jn={};jn["[object Float32Array]"]=jn["[object Float64Array]"]=jn["[object Int8Array]"]=jn["[object Int16Array]"]=jn["[object Int32Array]"]=jn["[object Uint8Array]"]=jn["[object Uint8ClampedArray]"]=jn["[object Uint16Array]"]=jn["[object Uint32Array]"]=!0,jn[Ee]=jn[Te]=jn[fr]=jn[Ie]=jn[er]=jn[wt]=jn[xt]=jn[Ft]=jn[St]=jn[Lt]=jn[_i]=jn[gi]=jn[Gn]=jn[dt]=jn[bi]=!1;var Ul=typeof cc=="object"&&cc&&cc.Object===Object&&cc,wr=typeof self=="object"&&self&&self.Object===Object&&self,ho=Ul||wr||Function("return this")(),vc=C&&!C.nodeType&&C,cl=vc&&T&&!T.nodeType&&T,Fr=cl&&cl.exports===vc,ul=Fr&&Ul.process,Ua=function(){try{return ul&&ul.binding&&ul.binding("util")}catch{}}(),ln=Ua&&Ua.isTypedArray;function Sn(Pe,it){for(var Pt=-1,ci=Pe==null?0:Pe.length;++Pt<ci;)if(it(Pe[Pt],Pt,Pe))return!0;return!1}function xc(Pe){var it=-1,Pt=Array(Pe.size);return Pe.forEach(function(ci,_n){Pt[++it]=[_n,ci]}),Pt}function dh(Pe){var it=-1,Pt=Array(Pe.size);return Pe.forEach(function(ci){Pt[++it]=ci}),Pt}var bc,Va,Jc,Vl=Array.prototype,Ga=Function.prototype,as=Object.prototype,ar=ho["__core-js_shared__"],ls=Ga.toString,Bn=as.hasOwnProperty,ja=(bc=/[^.]+$/.exec(ar&&ar.keys&&ar.keys.IE_PROTO||""))?"Symbol(src)_1."+bc:"",Gl=as.toString,Co=RegExp("^"+ls.call(Bn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),hl=Fr?ho.Buffer:void 0,dl=ho.Symbol,jl=ho.Uint8Array,Wl=as.propertyIsEnumerable,Wa=Vl.splice,Us=dl?dl.toStringTag:void 0,Hr=Object.getOwnPropertySymbols,wc=hl?hl.isBuffer:void 0,bo=(Va=Object.keys,Jc=Object,function(Pe){return Va(Jc(Pe))}),Vs=Zs(ho,"DataView"),$i=Zs(ho,"Map"),wo=Zs(ho,"Promise"),da=Zs(ho,"Set"),Gs=Zs(ho,"WeakMap"),mn=Zs(Object,"create"),cs=hs(Vs),fl=hs($i),Qc=hs(wo),pl=hs(da),eu=hs(Gs),js=dl?dl.prototype:void 0,Ws=js?js.valueOf:void 0;function us(Pe){var it=-1,Pt=Pe==null?0:Pe.length;for(this.clear();++it<Pt;){var ci=Pe[it];this.set(ci[0],ci[1])}}function To(Pe){var it=-1,Pt=Pe==null?0:Pe.length;for(this.clear();++it<Pt;){var ci=Pe[it];this.set(ci[0],ci[1])}}function Ei(Pe){var it=-1,Pt=Pe==null?0:Pe.length;for(this.clear();++it<Pt;){var ci=Pe[it];this.set(ci[0],ci[1])}}function fa(Pe){var it=-1,Pt=Pe==null?0:Pe.length;for(this.__data__=new Ei;++it<Pt;)this.add(Pe[it])}function _s(Pe){var it=this.__data__=new To(Pe);this.size=it.size}function tu(Pe,it){var Pt=vl(Pe),ci=!Pt&&Zl(Pe),_n=!Pt&&!ci&&Zo(Pe),Di=!Pt&&!ci&&!_n&&xl(Pe),Hn=Pt||ci||_n||Di,Tr=Hn?function(pr,ds){for(var Dr=-1,De=Array(pr);++Dr<pr;)De[Dr]=ds(Dr);return De}(Pe.length,String):[],$r=Tr.length;for(var Er in Pe)!it&&!Bn.call(Pe,Er)||Hn&&(Er=="length"||_n&&(Er=="offset"||Er=="parent")||Di&&(Er=="buffer"||Er=="byteLength"||Er=="byteOffset")||yl(Er,$r))||Tr.push(Er);return Tr}function pa(Pe,it){for(var Pt=Pe.length;Pt--;)if(ru(Pe[Pt][0],it))return Pt;return-1}function qs(Pe){return Pe==null?Pe===void 0?"[object Undefined]":"[object Null]":Us&&Us in Object(Pe)?function(it){var Pt=Bn.call(it,Us),ci=it[Us];try{it[Us]=void 0;var _n=!0}catch{}var Di=Gl.call(it);return _n&&(Pt?it[Us]=ci:delete it[Us]),Di}(Pe):function(it){return Gl.call(it)}(Pe)}function ql(Pe){return Xs(Pe)&&qs(Pe)==Ee}function iu(Pe,it,Pt,ci,_n){return Pe===it||(Pe==null||it==null||!Xs(Pe)&&!Xs(it)?Pe!=Pe&&it!=it:function(Di,Hn,Tr,$r,Er,pr){var ds=vl(Di),Dr=vl(Hn),De=ds?Te:Hs(Di),ot=Dr?Te:Hs(Hn),et=(De=De==Ee?_i:De)==_i,Zt=(ot=ot==Ee?_i:ot)==_i,yi=De==ot;if(yi&&Zo(Di)){if(!Zo(Hn))return!1;ds=!0,et=!1}if(yi&&!et)return pr||(pr=new _s),ds||xl(Di)?Tc(Di,Hn,Tr,$r,Er,pr):function(On,Gi,Ks,fo,Mo,Lr,Xr){switch(Ks){case er:if(On.byteLength!=Gi.byteLength||On.byteOffset!=Gi.byteOffset)return!1;On=On.buffer,Gi=Gi.buffer;case fr:return!(On.byteLength!=Gi.byteLength||!Lr(new jl(On),new jl(Gi)));case Ie:case wt:case Lt:return ru(+On,+Gi);case xt:return On.name==Gi.name&&On.message==Gi.message;case gi:case dt:return On==Gi+"";case St:var ji=xc;case Gn:var Do=1&fo;if(ji||(ji=dh),On.size!=Gi.size&&!Do)return!1;var _a=Xr.get(On);if(_a)return _a==Gi;fo|=2,Xr.set(On,Gi);var Ci=Tc(ji(On),ji(Gi),fo,Mo,Lr,Xr);return Xr.delete(On),Ci;case Nt:if(Ws)return Ws.call(On)==Ws.call(Gi)}return!1}(Di,Hn,De,Tr,$r,Er,pr);if(!(1&Tr)){var on=et&&Bn.call(Di,"__wrapped__"),lr=Zt&&Bn.call(Hn,"__wrapped__");if(on||lr){var Dn=on?Di.value():Di,Ec=lr?Hn.value():Hn;return pr||(pr=new _s),Er(Dn,Ec,Tr,$r,pr)}}return yi?(pr||(pr=new _s),function(On,Gi,Ks,fo,Mo,Lr){var Xr=1&Ks,ji=_l(On),Do=ji.length,_a=_l(Gi).length;if(Do!=_a&&!Xr)return!1;for(var Ci=Do;Ci--;){var gs=ji[Ci];if(!(Xr?gs in Gi:Bn.call(Gi,gs)))return!1}var Fu=Lr.get(On);if(Fu&&Lr.get(Gi))return Fu==Gi;var bl=!0;Lr.set(On,Gi),Lr.set(Gi,On);for(var ys=Xr;++Ci<Do;){var Lo=On[gs=ji[Ci]],ga=Gi[gs];if(fo)var wl=Xr?fo(ga,Lo,gs,Gi,On,Lr):fo(Lo,ga,gs,On,Gi,Lr);if(!(wl===void 0?Lo===ga||Mo(Lo,ga,Ks,fo,Lr):wl)){bl=!1;break}ys||(ys=gs=="constructor")}if(bl&&!ys){var ya=On.constructor,va=Gi.constructor;ya==va||!("constructor"in On)||!("constructor"in Gi)||typeof ya=="function"&&ya instanceof ya&&typeof va=="function"&&va instanceof va||(bl=!1)}return Lr.delete(On),Lr.delete(Gi),bl}(Di,Hn,Tr,$r,Er,pr)):!1}(Pe,it,Pt,ci,iu,_n))}function nu(Pe){return!(!Hl(Pe)||function(it){return!!ja&&ja in it}(Pe))&&($s(Pe)?Co:Zr).test(hs(Pe))}function ml(Pe){if(Pt=(it=Pe)&&it.constructor,ci=typeof Pt=="function"&&Pt.prototype||as,it!==ci)return bo(Pe);var it,Pt,ci,_n=[];for(var Di in Object(Pe))Bn.call(Pe,Di)&&Di!="constructor"&&_n.push(Di);return _n}function Tc(Pe,it,Pt,ci,_n,Di){var Hn=1&Pt,Tr=Pe.length,$r=it.length;if(Tr!=$r&&!(Hn&&$r>Tr))return!1;var Er=Di.get(Pe);if(Er&&Di.get(it))return Er==it;var pr=-1,ds=!0,Dr=2&Pt?new fa:void 0;for(Di.set(Pe,it),Di.set(it,Pe);++pr<Tr;){var De=Pe[pr],ot=it[pr];if(ci)var et=Hn?ci(ot,De,pr,it,Pe,Di):ci(De,ot,pr,Pe,it,Di);if(et!==void 0){if(et)continue;ds=!1;break}if(Dr){if(!Sn(it,function(Zt,yi){if(on=yi,!Dr.has(on)&&(De===Zt||_n(De,Zt,Pt,ci,Di)))return Dr.push(yi);var on})){ds=!1;break}}else if(De!==ot&&!_n(De,ot,Pt,ci,Di)){ds=!1;break}}return Di.delete(Pe),Di.delete(it),ds}function _l(Pe){return function(it,Pt,ci){var _n=Pt(it);return vl(it)?_n:function(Di,Hn){for(var Tr=-1,$r=Hn.length,Er=Di.length;++Tr<$r;)Di[Er+Tr]=Hn[Tr];return Di}(_n,ci(it))}(Pe,ma,gl)}function Mr(Pe,it){var Pt,ci,_n=Pe.__data__;return((ci=typeof(Pt=it))=="string"||ci=="number"||ci=="symbol"||ci=="boolean"?Pt!=="__proto__":Pt===null)?_n[typeof it=="string"?"string":"hash"]:_n.map}function Zs(Pe,it){var Pt=function(ci,_n){return ci==null?void 0:ci[_n]}(Pe,it);return nu(Pt)?Pt:void 0}us.prototype.clear=function(){this.__data__=mn?mn(null):{},this.size=0},us.prototype.delete=function(Pe){var it=this.has(Pe)&&delete this.__data__[Pe];return this.size-=it?1:0,it},us.prototype.get=function(Pe){var it=this.__data__;if(mn){var Pt=it[Pe];return Pt===H?void 0:Pt}return Bn.call(it,Pe)?it[Pe]:void 0},us.prototype.has=function(Pe){var it=this.__data__;return mn?it[Pe]!==void 0:Bn.call(it,Pe)},us.prototype.set=function(Pe,it){var Pt=this.__data__;return this.size+=this.has(Pe)?0:1,Pt[Pe]=mn&&it===void 0?H:it,this},To.prototype.clear=function(){this.__data__=[],this.size=0},To.prototype.delete=function(Pe){var it=this.__data__,Pt=pa(it,Pe);return!(Pt<0)&&(Pt==it.length-1?it.pop():Wa.call(it,Pt,1),--this.size,!0)},To.prototype.get=function(Pe){var it=this.__data__,Pt=pa(it,Pe);return Pt<0?void 0:it[Pt][1]},To.prototype.has=function(Pe){return pa(this.__data__,Pe)>-1},To.prototype.set=function(Pe,it){var Pt=this.__data__,ci=pa(Pt,Pe);return ci<0?(++this.size,Pt.push([Pe,it])):Pt[ci][1]=it,this},Ei.prototype.clear=function(){this.size=0,this.__data__={hash:new us,map:new($i||To),string:new us}},Ei.prototype.delete=function(Pe){var it=Mr(this,Pe).delete(Pe);return this.size-=it?1:0,it},Ei.prototype.get=function(Pe){return Mr(this,Pe).get(Pe)},Ei.prototype.has=function(Pe){return Mr(this,Pe).has(Pe)},Ei.prototype.set=function(Pe,it){var Pt=Mr(this,Pe),ci=Pt.size;return Pt.set(Pe,it),this.size+=Pt.size==ci?0:1,this},fa.prototype.add=fa.prototype.push=function(Pe){return this.__data__.set(Pe,H),this},fa.prototype.has=function(Pe){return this.__data__.has(Pe)},_s.prototype.clear=function(){this.__data__=new To,this.size=0},_s.prototype.delete=function(Pe){var it=this.__data__,Pt=it.delete(Pe);return this.size=it.size,Pt},_s.prototype.get=function(Pe){return this.__data__.get(Pe)},_s.prototype.has=function(Pe){return this.__data__.has(Pe)},_s.prototype.set=function(Pe,it){var Pt=this.__data__;if(Pt instanceof To){var ci=Pt.__data__;if(!$i||ci.length<199)return ci.push([Pe,it]),this.size=++Pt.size,this;Pt=this.__data__=new Ei(ci)}return Pt.set(Pe,it),this.size=Pt.size,this};var gl=Hr?function(Pe){return Pe==null?[]:(Pe=Object(Pe),function(it,Pt){for(var ci=-1,_n=it==null?0:it.length,Di=0,Hn=[];++ci<_n;){var Tr=it[ci];Pt(Tr,ci,it)&&(Hn[Di++]=Tr)}return Hn}(Hr(Pe),function(it){return Wl.call(Pe,it)}))}:function(){return[]},Hs=qs;function yl(Pe,it){return!!(it=it??he)&&(typeof Pe=="number"||uo.test(Pe))&&Pe>-1&&Pe%1==0&&Pe<it}function hs(Pe){if(Pe!=null){try{return ls.call(Pe)}catch{}try{return Pe+""}catch{}}return""}function ru(Pe,it){return Pe===it||Pe!=Pe&&it!=it}(Vs&&Hs(new Vs(new ArrayBuffer(1)))!=er||$i&&Hs(new $i)!=St||wo&&Hs(wo.resolve())!=kn||da&&Hs(new da)!=Gn||Gs&&Hs(new Gs)!=bi)&&(Hs=function(Pe){var it=qs(Pe),Pt=it==_i?Pe.constructor:void 0,ci=Pt?hs(Pt):"";if(ci)switch(ci){case cs:return er;case fl:return St;case Qc:return kn;case pl:return Gn;case eu:return bi}return it});var Zl=ql(function(){return arguments}())?ql:function(Pe){return Xs(Pe)&&Bn.call(Pe,"callee")&&!Wl.call(Pe,"callee")},vl=Array.isArray,Zo=wc||function(){return!1};function $s(Pe){if(!Hl(Pe))return!1;var it=qs(Pe);return it==Ft||it=="[object GeneratorFunction]"||it=="[object AsyncFunction]"||it=="[object Proxy]"}function ou(Pe){return typeof Pe=="number"&&Pe>-1&&Pe%1==0&&Pe<=he}function Hl(Pe){var it=typeof Pe;return Pe!=null&&(it=="object"||it=="function")}function Xs(Pe){return Pe!=null&&typeof Pe=="object"}var xl=ln?function(Pe){return function(it){return Pe(it)}}(ln):function(Pe){return Xs(Pe)&&ou(Pe.length)&&!!jn[qs(Pe)]};function ma(Pe){return(it=Pe)!=null&&ou(it.length)&&!$s(it)?tu(Pe):ml(Pe);var it}T.exports=function(Pe,it){return iu(Pe,it)}})({get exports(){return Ns},set exports(T){Ns=T}},Ns);var Yc=Ns;function ha(T,C){return T.length===C.length&&JSON.stringify(T.map(function(H){return H}).sort())===JSON.stringify(C.map(function(H){return H}).sort())}var At={Polygon:Zn,LineString:or,Point:Wr,MultiPolygon:hn,MultiLineString:hn,MultiPoint:hn},Bi=Object.freeze({__proto__:null,CommonSelectors:so,constrainFeatureMovement:Qt,createMidPoint:ks,createSupplementaryPoints:ns,createVertex:qo,doubleClickZoom:qr,euclideanDistance:Mn,featuresAt:ki,getFeatureAtAndSetCursors:ii,isClick:pn,isEventAtCoordinates:rs,isTap:nn,mapEventToBoundingBox:Ut,ModeHandler:g,moveFeatures:ai,sortFeatures:Ht,stringSetsAreEqual:ha,StringSet:qt,theme:tn,toDenseArray:Oi}),Ui=function(T,C){var H={options:T=function(Ee){Ee===void 0&&(Ee={});var Te=kr(Ee);return Ee.controls||(Te.controls={}),Ee.displayControlsDefault===!1?Te.controls=kr(Bu,Ee.controls):Te.controls=kr(ua,Ee.controls),(Te=kr(sr,Te)).styles=ss(Te.styles,"cold").concat(ss(Te.styles,"hot")),Te}(T)};C=function(Ee,Te){return Te.modes=qe,Te.getFeatureIdsAt=function(Ie){return ki.click({point:Ie},null,Ee).map(function(wt){return wt.properties.id})},Te.getSelectedIds=function(){return Ee.store.getSelectedIds()},Te.getSelected=function(){return{type:Ce.FEATURE_COLLECTION,features:Ee.store.getSelectedIds().map(function(Ie){return Ee.store.get(Ie)}).map(function(Ie){return Ie.toGeoJSON()})}},Te.getSelectedPoints=function(){return{type:Ce.FEATURE_COLLECTION,features:Ee.store.getSelectedCoordinates().map(function(Ie){return{type:Ce.FEATURE,properties:{},geometry:{type:Ce.POINT,coordinates:Ie.coordinates}}})}},Te.set=function(Ie){if(Ie.type===void 0||Ie.type!==Ce.FEATURE_COLLECTION||!Array.isArray(Ie.features))throw new Error("Invalid FeatureCollection");var wt=Ee.store.createRenderBatch(),xt=Ee.store.getAllIds().slice(),Ft=Te.add(Ie),St=new qt(Ft);return(xt=xt.filter(function(Lt){return!St.has(Lt)})).length&&Te.delete(xt),wt(),Ft},Te.add=function(Ie){var wt=JSON.parse(JSON.stringify(Io(Ie))).features.map(function(xt){if(xt.id=xt.id||Kt(),xt.geometry===null)throw new Error("Invalid geometry: null");if(Ee.store.get(xt.id)===void 0||Ee.store.get(xt.id).type!==xt.geometry.type){var Ft=At[xt.geometry.type];if(Ft===void 0)throw new Error("Invalid geometry type: "+xt.geometry.type+".");var St=new Ft(Ee,xt);Ee.store.add(St)}else{var Lt=Ee.store.get(xt.id);Lt.properties=xt.properties,Yc(Lt.getCoordinates(),xt.geometry.coordinates)||Lt.incomingCoords(xt.geometry.coordinates)}return xt.id});return Ee.store.render(),wt},Te.get=function(Ie){var wt=Ee.store.get(Ie);if(wt)return wt.toGeoJSON()},Te.getAll=function(){return{type:Ce.FEATURE_COLLECTION,features:Ee.store.getAll().map(function(Ie){return Ie.toGeoJSON()})}},Te.delete=function(Ie){return Ee.store.delete(Ie,{silent:!0}),Te.getMode()!==qe.DIRECT_SELECT||Ee.store.getSelectedIds().length?Ee.store.render():Ee.events.changeMode(qe.SIMPLE_SELECT,void 0,{silent:!0}),Te},Te.deleteAll=function(){return Ee.store.delete(Ee.store.getAllIds(),{silent:!0}),Te.getMode()===qe.DIRECT_SELECT?Ee.events.changeMode(qe.SIMPLE_SELECT,void 0,{silent:!0}):Ee.store.render(),Te},Te.changeMode=function(Ie,wt){return wt===void 0&&(wt={}),Ie===qe.SIMPLE_SELECT&&Te.getMode()===qe.SIMPLE_SELECT?(ha(wt.featureIds||[],Ee.store.getSelectedIds())||(Ee.store.setSelected(wt.featureIds,{silent:!0}),Ee.store.render()),Te):(Ie===qe.DIRECT_SELECT&&Te.getMode()===qe.DIRECT_SELECT&&wt.featureId===Ee.store.getSelectedIds()[0]||Ee.events.changeMode(Ie,wt,{silent:!0}),Te)},Te.getMode=function(){return Ee.events.getMode()},Te.trash=function(){return Ee.events.trash({silent:!0}),Te},Te.combineFeatures=function(){return Ee.events.combineFeatures({silent:!0}),Te},Te.uncombineFeatures=function(){return Ee.events.uncombineFeatures({silent:!0}),Te},Te.setFeatureProperty=function(Ie,wt,xt){return Ee.store.setFeatureProperty(Ie,wt,xt),Te},Te}(H,C),H.api=C;var he=ka(H);return C.onAdd=he.onAdd,C.onRemove=he.onRemove,C.types=tt,C.options=T,C};function xo(T){Ui(T,this)}return xo.modes=os,xo.constants=Wt,xo.lib=Bi,xo})})(q0);const Z0=j0(Iy);const T_=Ay([]);function H0(D){let x;return{c(){x=Yn("div"),this.h()},l(g){x=Jn(g,"DIV",{id:!0,class:!0}),xr(x).forEach(Xt),this.h()},h(){wn(x,"id","map"),wn(x,"class","svelte-1g6q6m2")},m(g,M){Ni(g,x,M)},p:Nl,i:Nl,o:Nl,d(g){g&&Xt(x)}}}function $0(D){let x;const g=["#FF5733","#F2BE22","#17BEBB","#7B68EE","#FF8C00","#00BFFF","#9932CC","#2E8B57","#FF1493","#8B4513"];return Dy(()=>{Yy.accessToken="pk.eyJ1Ijoia29ob2xtIiwiYSI6ImNremUzM2tsMzJmZWsybm54d20xazFicWQifQ.uZRVptXit_O5hkkSFBKXug",x=new Yy.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[10.395053,63.430515],zoom:11});const M=new Z0({displayControlsDefault:!1,controls:{point:!0,line_string:!0,polygon:!0,trash:!0},defaultMode:"draw_polygon"});x.addControl(M,"top-left")}),T_.subscribe(M=>{M.forEach(P=>{x.getSource(P.name)||(x.addSource(P.name,{type:"geojson",data:P.data}),x.addLayer({id:P.name,type:"fill",source:P.name,paint:{"fill-color":g[M.length%g.length]}}))})}),y0(),[]}let X0=class extends Os{constructor(x){super(),Rs(this,x,$0,H0,Qo,{})}};var Cy=function(D,x){return Cy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,M){g.__proto__=M}||function(g,M){for(var P in M)Object.prototype.hasOwnProperty.call(M,P)&&(g[P]=M[P])},Cy(D,x)};function Oy(D,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");Cy(D,x);function g(){this.constructor=D}D.prototype=x===null?Object.create(x):(g.prototype=x.prototype,new g)}var Pu=function(){return Pu=Object.assign||function(x){for(var g,M=1,P=arguments.length;M<P;M++){g=arguments[M];for(var N in g)Object.prototype.hasOwnProperty.call(g,N)&&(x[N]=g[N])}return x},Pu.apply(this,arguments)};function Fl(D){var x=typeof Symbol=="function"&&Symbol.iterator,g=x&&D[x],M=0;if(g)return g.call(D);if(D&&typeof D.length=="number")return{next:function(){return D&&M>=D.length&&(D=void 0),{value:D&&D[M++],done:!D}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")}/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Ry=function(){function D(x){x===void 0&&(x={}),this.adapter=x}return Object.defineProperty(D,"cssClasses",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(D,"strings",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(D,"numbers",{get:function(){return{}},enumerable:!1,configurable:!0}),Object.defineProperty(D,"defaultAdapter",{get:function(){return{}},enumerable:!1,configurable:!0}),D.prototype.init=function(){},D.prototype.destroy=function(){},D}();/**
 * @license
 * Copyright 2020 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Pa;(function(D){D.RICH="mdc-tooltip--rich",D.SHOWN="mdc-tooltip--shown",D.SHOWING="mdc-tooltip--showing",D.SHOWING_TRANSITION="mdc-tooltip--showing-transition",D.HIDE="mdc-tooltip--hide",D.HIDE_TRANSITION="mdc-tooltip--hide-transition",D.MULTILINE_TOOLTIP="mdc-tooltip--multiline",D.SURFACE="mdc-tooltip__surface",D.SURFACE_ANIMATION="mdc-tooltip__surface-animation",D.TOOLTIP_CARET_TOP="mdc-tooltip__caret-surface-top",D.TOOLTIP_CARET_BOTTOM="mdc-tooltip__caret-surface-bottom"})(Pa||(Pa={}));var ra={BOUNDED_ANCHOR_GAP:4,UNBOUNDED_ANCHOR_GAP:8,MIN_VIEWPORT_TOOLTIP_THRESHOLD:8,HIDE_DELAY_MS:600,SHOW_DELAY_MS:500,MIN_HEIGHT:24,MAX_WIDTH:200,CARET_INDENTATION:24,ANIMATION_SCALE:.8},__={ARIA_EXPANDED:"aria-expanded",ARIA_HASPOPUP:"aria-haspopup",PERSISTENT:"data-mdc-tooltip-persistent",SCROLLABLE_ANCESTOR:"tooltip-scrollable-ancestor",HAS_CARET:"data-mdc-tooltip-has-caret"},nd;(function(D){D[D.DETECTED=0]="DETECTED",D[D.START=1]="START",D[D.CENTER=2]="CENTER",D[D.END=3]="END"})(nd||(nd={}));var yf;(function(D){D[D.DETECTED=0]="DETECTED",D[D.ABOVE=1]="ABOVE",D[D.BELOW=2]="BELOW"})(yf||(yf={}));var S_;(function(D){D[D.BOUNDED=0]="BOUNDED",D[D.UNBOUNDED=1]="UNBOUNDED"})(S_||(S_={}));var Ri={LEFT:"left",RIGHT:"right",CENTER:"center",TOP:"top",BOTTOM:"bottom"},un;(function(D){D[D.DETECTED=0]="DETECTED",D[D.ABOVE_START=1]="ABOVE_START",D[D.ABOVE_CENTER=2]="ABOVE_CENTER",D[D.ABOVE_END=3]="ABOVE_END",D[D.TOP_SIDE_START=4]="TOP_SIDE_START",D[D.CENTER_SIDE_START=5]="CENTER_SIDE_START",D[D.BOTTOM_SIDE_START=6]="BOTTOM_SIDE_START",D[D.TOP_SIDE_END=7]="TOP_SIDE_END",D[D.CENTER_SIDE_END=8]="CENTER_SIDE_END",D[D.BOTTOM_SIDE_END=9]="BOTTOM_SIDE_END",D[D.BELOW_START=10]="BELOW_START",D[D.BELOW_CENTER=11]="BELOW_CENTER",D[D.BELOW_END=12]="BELOW_END"})(un||(un={}));var jo;(function(D){D[D.ABOVE=1]="ABOVE",D[D.BELOW=2]="BELOW",D[D.SIDE_TOP=3]="SIDE_TOP",D[D.SIDE_CENTER=4]="SIDE_CENTER",D[D.SIDE_BOTTOM=5]="SIDE_BOTTOM"})(jo||(jo={}));var Pn;(function(D){D[D.START=1]="START",D[D.CENTER=2]="CENTER",D[D.END=3]="END",D[D.SIDE_START=4]="SIDE_START",D[D.SIDE_END=5]="SIDE_END"})(Pn||(Pn={}));/**
 * @license
 * Copyright 2020 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var K0=function(){function D(){this.rafIDs=new Map}return D.prototype.request=function(x,g){var M=this;this.cancel(x);var P=requestAnimationFrame(function(N){M.rafIDs.delete(x),g(N)});this.rafIDs.set(x,P)},D.prototype.cancel=function(x){var g=this.rafIDs.get(x);g&&(cancelAnimationFrame(g),this.rafIDs.delete(x))},D.prototype.cancelAll=function(){var x=this;this.rafIDs.forEach(function(g,M){x.cancel(M)})},D.prototype.getQueue=function(){var x=[];return this.rafIDs.forEach(function(g,M){x.push(M)}),x},D}();/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Jy={animation:{prefixed:"-webkit-animation",standard:"animation"},transform:{prefixed:"-webkit-transform",standard:"transform"},transition:{prefixed:"-webkit-transition",standard:"transition"}};function Y0(D){return!!D.document&&typeof D.document.createElement=="function"}function Qy(D,x){if(Y0(D)&&x in Jy){var g=D.document.createElement("div"),M=Jy[x],P=M.standard,N=M.prefixed,Z=P in g.style;return Z?P:N}return x}/**
 * @license
 * Copyright 2020 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var vn={UNKNOWN:"Unknown",BACKSPACE:"Backspace",ENTER:"Enter",SPACEBAR:"Spacebar",PAGE_UP:"PageUp",PAGE_DOWN:"PageDown",END:"End",HOME:"Home",ARROW_LEFT:"ArrowLeft",ARROW_UP:"ArrowUp",ARROW_RIGHT:"ArrowRight",ARROW_DOWN:"ArrowDown",DELETE:"Delete",ESCAPE:"Escape",TAB:"Tab"},oa=new Set;oa.add(vn.BACKSPACE);oa.add(vn.ENTER);oa.add(vn.SPACEBAR);oa.add(vn.PAGE_UP);oa.add(vn.PAGE_DOWN);oa.add(vn.END);oa.add(vn.HOME);oa.add(vn.ARROW_LEFT);oa.add(vn.ARROW_UP);oa.add(vn.ARROW_RIGHT);oa.add(vn.ARROW_DOWN);oa.add(vn.DELETE);oa.add(vn.ESCAPE);oa.add(vn.TAB);var za={BACKSPACE:8,ENTER:13,SPACEBAR:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46,ESCAPE:27,TAB:9},sa=new Map;sa.set(za.BACKSPACE,vn.BACKSPACE);sa.set(za.ENTER,vn.ENTER);sa.set(za.SPACEBAR,vn.SPACEBAR);sa.set(za.PAGE_UP,vn.PAGE_UP);sa.set(za.PAGE_DOWN,vn.PAGE_DOWN);sa.set(za.END,vn.END);sa.set(za.HOME,vn.HOME);sa.set(za.ARROW_LEFT,vn.ARROW_LEFT);sa.set(za.ARROW_UP,vn.ARROW_UP);sa.set(za.ARROW_RIGHT,vn.ARROW_RIGHT);sa.set(za.ARROW_DOWN,vn.ARROW_DOWN);sa.set(za.DELETE,vn.DELETE);sa.set(za.ESCAPE,vn.ESCAPE);sa.set(za.TAB,vn.TAB);var hh=new Set;hh.add(vn.PAGE_UP);hh.add(vn.PAGE_DOWN);hh.add(vn.END);hh.add(vn.HOME);hh.add(vn.ARROW_LEFT);hh.add(vn.ARROW_UP);hh.add(vn.ARROW_RIGHT);hh.add(vn.ARROW_DOWN);function J0(D){var x=D.key;if(oa.has(x))return x;var g=sa.get(D.keyCode);return g||vn.UNKNOWN}/**
 * @license
 * Copyright 2020 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Q0=Pa.RICH,xy=Pa.SHOWN,by=Pa.SHOWING,g_=Pa.SHOWING_TRANSITION,Ip=Pa.HIDE,y_=Pa.HIDE_TRANSITION,ev=Pa.MULTILINE_TOOLTIP,My;(function(D){D.POLL_ANCHOR="poll_anchor"})(My||(My={}));var e0=typeof window<"u",tv=function(D){Oy(x,D);function x(g){var M=D.call(this,Pu(Pu({},x.defaultAdapter),g))||this;return M.tooltipShown=!1,M.anchorGap=ra.BOUNDED_ANCHOR_GAP,M.xTooltipPos=nd.DETECTED,M.yTooltipPos=yf.DETECTED,M.tooltipPositionWithCaret=un.DETECTED,M.minViewportTooltipThreshold=ra.MIN_VIEWPORT_TOOLTIP_THRESHOLD,M.hideDelayMs=ra.HIDE_DELAY_MS,M.showDelayMs=ra.SHOW_DELAY_MS,M.anchorRect=null,M.parentRect=null,M.frameId=null,M.hideTimeout=null,M.showTimeout=null,M.addAncestorScrollEventListeners=new Array,M.removeAncestorScrollEventListeners=new Array,M.animFrame=new K0,M.anchorBlurHandler=function(P){M.handleAnchorBlur(P)},M.documentClickHandler=function(P){M.handleDocumentClick(P)},M.documentKeydownHandler=function(P){M.handleKeydown(P)},M.tooltipMouseEnterHandler=function(){M.handleTooltipMouseEnter()},M.tooltipMouseLeaveHandler=function(){M.handleTooltipMouseLeave()},M.richTooltipFocusOutHandler=function(P){M.handleRichTooltipFocusOut(P)},M.windowScrollHandler=function(){M.handleWindowScrollEvent()},M.windowResizeHandler=function(){M.handleWindowChangeEvent()},M}return Object.defineProperty(x,"defaultAdapter",{get:function(){return{getAttribute:function(){return null},setAttribute:function(){},removeAttribute:function(){},addClass:function(){},hasClass:function(){return!1},removeClass:function(){},getComputedStyleProperty:function(){return""},setStyleProperty:function(){},setSurfaceAnimationStyleProperty:function(){},getViewportWidth:function(){return 0},getViewportHeight:function(){return 0},getTooltipSize:function(){return{width:0,height:0}},getAnchorBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},getParentBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},getAnchorAttribute:function(){return null},setAnchorAttribute:function(){return null},isRTL:function(){return!1},anchorContainsElement:function(){return!1},tooltipContainsElement:function(){return!1},focusAnchorElement:function(){},registerEventHandler:function(){},deregisterEventHandler:function(){},registerAnchorEventHandler:function(){},deregisterAnchorEventHandler:function(){},registerDocumentEventHandler:function(){},deregisterDocumentEventHandler:function(){},registerWindowEventHandler:function(){},deregisterWindowEventHandler:function(){},notifyHidden:function(){},getTooltipCaretBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},setTooltipCaretStyle:function(){},clearTooltipCaretStyles:function(){},getActiveElement:function(){return null}}},enumerable:!1,configurable:!0}),x.prototype.init=function(){this.richTooltip=this.adapter.hasClass(Q0),this.persistentTooltip=this.adapter.getAttribute(__.PERSISTENT)==="true",this.interactiveTooltip=!!this.adapter.getAnchorAttribute(__.ARIA_EXPANDED)&&this.adapter.getAnchorAttribute(__.ARIA_HASPOPUP)==="dialog",this.hasCaret=this.richTooltip&&this.adapter.getAttribute(__.HAS_CARET)==="true"},x.prototype.isShown=function(){return this.tooltipShown},x.prototype.isRich=function(){return this.richTooltip},x.prototype.isPersistent=function(){return this.persistentTooltip},x.prototype.handleAnchorMouseEnter=function(){var g=this;this.tooltipShown?this.show():(this.clearHideTimeout(),this.showTimeout=setTimeout(function(){g.show()},this.showDelayMs))},x.prototype.handleAnchorTouchstart=function(){var g=this;this.showTimeout=setTimeout(function(){g.show()},this.showDelayMs),this.adapter.registerWindowEventHandler("contextmenu",this.preventContextMenuOnLongTouch)},x.prototype.preventContextMenuOnLongTouch=function(g){g.preventDefault()},x.prototype.handleAnchorTouchend=function(){this.clearShowTimeout(),this.isShown()||this.adapter.deregisterWindowEventHandler("contextmenu",this.preventContextMenuOnLongTouch)},x.prototype.handleAnchorFocus=function(g){var M=this,P=g.relatedTarget,N=P instanceof HTMLElement&&this.adapter.tooltipContainsElement(P);N||(this.showTimeout=setTimeout(function(){M.show()},this.showDelayMs))},x.prototype.handleAnchorMouseLeave=function(){var g=this;this.clearShowTimeout(),this.hideTimeout=setTimeout(function(){g.hide()},this.hideDelayMs)},x.prototype.handleAnchorClick=function(){this.tooltipShown?this.hide():this.show()},x.prototype.handleDocumentClick=function(g){var M=g.target instanceof HTMLElement&&(this.adapter.anchorContainsElement(g.target)||this.adapter.tooltipContainsElement(g.target));this.richTooltip&&this.persistentTooltip&&M||this.hide()},x.prototype.handleKeydown=function(g){var M=J0(g);if(M===vn.ESCAPE){var P=this.adapter.getActiveElement(),N=P instanceof HTMLElement&&this.adapter.tooltipContainsElement(P);N&&this.adapter.focusAnchorElement(),this.hide()}},x.prototype.handleAnchorBlur=function(g){if(this.richTooltip){var M=g.relatedTarget instanceof HTMLElement&&this.adapter.tooltipContainsElement(g.relatedTarget);if(M||g.relatedTarget===null&&this.interactiveTooltip)return}this.hide()},x.prototype.handleTooltipMouseEnter=function(){this.show()},x.prototype.handleTooltipMouseLeave=function(){var g=this;this.clearShowTimeout(),this.hideTimeout=setTimeout(function(){g.hide()},this.hideDelayMs)},x.prototype.handleRichTooltipFocusOut=function(g){var M=g.relatedTarget instanceof HTMLElement&&(this.adapter.anchorContainsElement(g.relatedTarget)||this.adapter.tooltipContainsElement(g.relatedTarget));M||g.relatedTarget===null&&this.interactiveTooltip||this.hide()},x.prototype.handleWindowScrollEvent=function(){if(this.persistentTooltip){this.handleWindowChangeEvent();return}this.hide()},x.prototype.handleWindowChangeEvent=function(){var g=this;this.animFrame.request(My.POLL_ANCHOR,function(){g.repositionTooltipOnAnchorMove()})},x.prototype.show=function(){var g,M,P=this;if(this.clearHideTimeout(),this.clearShowTimeout(),!this.tooltipShown){this.tooltipShown=!0,this.adapter.removeAttribute("aria-hidden"),this.richTooltip&&(this.interactiveTooltip&&this.adapter.setAnchorAttribute("aria-expanded","true"),this.adapter.registerEventHandler("focusout",this.richTooltipFocusOutHandler)),this.persistentTooltip||(this.adapter.registerEventHandler("mouseenter",this.tooltipMouseEnterHandler),this.adapter.registerEventHandler("mouseleave",this.tooltipMouseLeaveHandler)),this.adapter.removeClass(Ip),this.adapter.addClass(by),this.isTooltipMultiline()&&!this.richTooltip&&this.adapter.addClass(ev),this.anchorRect=this.adapter.getAnchorBoundingRect(),this.parentRect=this.adapter.getParentBoundingRect(),this.richTooltip?this.positionRichTooltip():this.positionPlainTooltip(),this.adapter.registerAnchorEventHandler("blur",this.anchorBlurHandler),this.adapter.registerDocumentEventHandler("click",this.documentClickHandler),this.adapter.registerDocumentEventHandler("keydown",this.documentKeydownHandler),this.adapter.registerWindowEventHandler("scroll",this.windowScrollHandler),this.adapter.registerWindowEventHandler("resize",this.windowResizeHandler);try{for(var N=Fl(this.addAncestorScrollEventListeners),Z=N.next();!Z.done;Z=N.next()){var o=Z.value;o()}}catch(B){g={error:B}}finally{try{Z&&!Z.done&&(M=N.return)&&M.call(N)}finally{if(g)throw g.error}}this.frameId=requestAnimationFrame(function(){P.clearAllAnimationClasses(),P.adapter.addClass(xy),P.adapter.addClass(g_)})}},x.prototype.hide=function(){var g,M;if(this.clearHideTimeout(),this.clearShowTimeout(),!!this.tooltipShown){this.frameId&&cancelAnimationFrame(this.frameId),this.tooltipShown=!1,this.adapter.setAttribute("aria-hidden","true"),this.adapter.deregisterEventHandler("focusout",this.richTooltipFocusOutHandler),this.richTooltip&&this.interactiveTooltip&&this.adapter.setAnchorAttribute("aria-expanded","false"),this.persistentTooltip||(this.adapter.deregisterEventHandler("mouseenter",this.tooltipMouseEnterHandler),this.adapter.deregisterEventHandler("mouseleave",this.tooltipMouseLeaveHandler)),this.clearAllAnimationClasses(),this.adapter.addClass(Ip),this.adapter.addClass(y_),this.adapter.removeClass(xy),this.adapter.deregisterAnchorEventHandler("blur",this.anchorBlurHandler),this.adapter.deregisterDocumentEventHandler("click",this.documentClickHandler),this.adapter.deregisterDocumentEventHandler("keydown",this.documentKeydownHandler),this.adapter.deregisterWindowEventHandler("scroll",this.windowScrollHandler),this.adapter.deregisterWindowEventHandler("resize",this.windowResizeHandler),this.adapter.deregisterWindowEventHandler("contextmenu",this.preventContextMenuOnLongTouch);try{for(var P=Fl(this.removeAncestorScrollEventListeners),N=P.next();!N.done;N=P.next()){var Z=N.value;Z()}}catch(o){g={error:o}}finally{try{N&&!N.done&&(M=P.return)&&M.call(P)}finally{if(g)throw g.error}}}},x.prototype.handleTransitionEnd=function(){var g=this.adapter.hasClass(Ip);this.adapter.removeClass(by),this.adapter.removeClass(g_),this.adapter.removeClass(Ip),this.adapter.removeClass(y_),g&&this.showTimeout===null&&this.adapter.notifyHidden()},x.prototype.clearAllAnimationClasses=function(){this.adapter.removeClass(g_),this.adapter.removeClass(y_)},x.prototype.setTooltipPosition=function(g){var M=g.xPos,P=g.yPos,N=g.withCaretPos;if(this.hasCaret&&N){this.tooltipPositionWithCaret=N;return}M&&(this.xTooltipPos=M),P&&(this.yTooltipPos=P)},x.prototype.setAnchorBoundaryType=function(g){g===S_.UNBOUNDED?this.anchorGap=ra.UNBOUNDED_ANCHOR_GAP:this.anchorGap=ra.BOUNDED_ANCHOR_GAP},x.prototype.setShowDelay=function(g){this.showDelayMs=g},x.prototype.setHideDelay=function(g){this.hideDelayMs=g},x.prototype.isTooltipMultiline=function(){var g=this.adapter.getTooltipSize();return g.height>ra.MIN_HEIGHT&&g.width>=ra.MAX_WIDTH},x.prototype.positionPlainTooltip=function(){var g=this.calculateTooltipStyles(this.anchorRect),M=g.top,P=g.yTransformOrigin,N=g.left,Z=g.xTransformOrigin,o=e0?Qy(window,"transform"):"transform";this.adapter.setSurfaceAnimationStyleProperty(o+"-origin",Z+" "+P),this.adapter.setStyleProperty("top",M+"px"),this.adapter.setStyleProperty("left",N+"px")},x.prototype.positionRichTooltip=function(){var g,M,P,N,Z=this.adapter.getComputedStyleProperty("width");this.adapter.setStyleProperty("width",Z);var o=this.hasCaret?this.calculateTooltipWithCaretStyles(this.anchorRect):this.calculateTooltipStyles(this.anchorRect),B=o.top,ce=o.yTransformOrigin,_e=o.left,de=o.xTransformOrigin,Re=e0?Qy(window,"transform"):"transform";this.adapter.setSurfaceAnimationStyleProperty(Re+"-origin",de+" "+ce);var tt=_e-((M=(g=this.parentRect)===null||g===void 0?void 0:g.left)!==null&&M!==void 0?M:0),Ce=B-((N=(P=this.parentRect)===null||P===void 0?void 0:P.top)!==null&&N!==void 0?N:0);this.adapter.setStyleProperty("top",Ce+"px"),this.adapter.setStyleProperty("left",tt+"px")},x.prototype.calculateTooltipStyles=function(g){if(!g)return{top:0,left:0};var M=this.adapter.getTooltipSize(),P=this.calculateYTooltipDistance(g,M.height),N=this.calculateXTooltipDistance(g,M.width);return{top:P.distance,yTransformOrigin:P.yTransformOrigin,left:N.distance,xTransformOrigin:N.xTransformOrigin}},x.prototype.calculateXTooltipDistance=function(g,M){var P=!this.adapter.isRTL(),N,Z,o,B,ce;this.richTooltip?(N=P?g.left-M:g.right,Z=P?g.right:g.left-M,B=P?Ri.RIGHT:Ri.LEFT,ce=P?Ri.LEFT:Ri.RIGHT):(N=P?g.left:g.right-M,Z=P?g.right-M:g.left,o=g.left+(g.width-M)/2,B=P?Ri.LEFT:Ri.RIGHT,ce=P?Ri.RIGHT:Ri.LEFT);var _e=this.richTooltip?this.determineValidPositionOptions(N,Z):this.determineValidPositionOptions(o,N,Z);if(this.xTooltipPos===nd.START&&_e.has(N))return{distance:N,xTransformOrigin:B};if(this.xTooltipPos===nd.END&&_e.has(Z))return{distance:Z,xTransformOrigin:ce};if(this.xTooltipPos===nd.CENTER&&_e.has(o))return{distance:o,xTransformOrigin:Ri.CENTER};var de=this.richTooltip?[{distance:Z,xTransformOrigin:ce},{distance:N,xTransformOrigin:B}]:[{distance:o,xTransformOrigin:Ri.CENTER},{distance:N,xTransformOrigin:B},{distance:Z,xTransformOrigin:ce}],Re=de.find(function(qe){var rt=qe.distance;return _e.has(rt)});if(Re)return Re;if(g.left<0)return{distance:this.minViewportTooltipThreshold,xTransformOrigin:Ri.LEFT};var tt=this.adapter.getViewportWidth(),Ce=tt-(M+this.minViewportTooltipThreshold);return{distance:Ce,xTransformOrigin:Ri.RIGHT}},x.prototype.determineValidPositionOptions=function(){for(var g,M,P=[],N=0;N<arguments.length;N++)P[N]=arguments[N];var Z=new Set,o=new Set;try{for(var B=Fl(P),ce=B.next();!ce.done;ce=B.next()){var _e=ce.value;this.positionHonorsViewportThreshold(_e)?Z.add(_e):this.positionDoesntCollideWithViewport(_e)&&o.add(_e)}}catch(de){g={error:de}}finally{try{ce&&!ce.done&&(M=B.return)&&M.call(B)}finally{if(g)throw g.error}}return Z.size?Z:o},x.prototype.positionHonorsViewportThreshold=function(g){var M=this.adapter.getViewportWidth(),P=this.adapter.getTooltipSize().width;return g+P<=M-this.minViewportTooltipThreshold&&g>=this.minViewportTooltipThreshold},x.prototype.positionDoesntCollideWithViewport=function(g){var M=this.adapter.getViewportWidth(),P=this.adapter.getTooltipSize().width;return g+P<=M&&g>=0},x.prototype.calculateYTooltipDistance=function(g,M){var P=g.bottom+this.anchorGap,N=g.top-(this.anchorGap+M),Z=this.determineValidYPositionOptions(N,P);return this.yTooltipPos===yf.ABOVE&&Z.has(N)?{distance:N,yTransformOrigin:Ri.BOTTOM}:this.yTooltipPos===yf.BELOW&&Z.has(P)?{distance:P,yTransformOrigin:Ri.TOP}:Z.has(P)?{distance:P,yTransformOrigin:Ri.TOP}:Z.has(N)?{distance:N,yTransformOrigin:Ri.BOTTOM}:{distance:P,yTransformOrigin:Ri.TOP}},x.prototype.determineValidYPositionOptions=function(g,M){var P=new Set,N=new Set;return this.yPositionHonorsViewportThreshold(g)?P.add(g):this.yPositionDoesntCollideWithViewport(g)&&N.add(g),this.yPositionHonorsViewportThreshold(M)?P.add(M):this.yPositionDoesntCollideWithViewport(M)&&N.add(M),P.size?P:N},x.prototype.yPositionHonorsViewportThreshold=function(g){var M=this.adapter.getViewportHeight(),P=this.adapter.getTooltipSize().height;return g+P+this.minViewportTooltipThreshold<=M&&g>=this.minViewportTooltipThreshold},x.prototype.yPositionDoesntCollideWithViewport=function(g){var M=this.adapter.getViewportHeight(),P=this.adapter.getTooltipSize().height;return g+P<=M&&g>=0},x.prototype.calculateTooltipWithCaretStyles=function(g){this.adapter.clearTooltipCaretStyles();var M=this.adapter.getTooltipCaretBoundingRect();if(!g||!M)return{position:un.DETECTED,top:0,left:0};var P=M.width/ra.ANIMATION_SCALE,N=M.height/ra.ANIMATION_SCALE/2,Z=this.adapter.getTooltipSize(),o=this.calculateYWithCaretDistanceOptions(g,Z.height,{caretWidth:P,caretHeight:N}),B=this.calculateXWithCaretDistanceOptions(g,Z.width,{caretWidth:P,caretHeight:N}),ce=this.validateTooltipWithCaretDistances(o,B);ce.size<1&&(ce=this.generateBackupPositionOption(g,Z,{caretWidth:P,caretHeight:N}));var _e=this.determineTooltipWithCaretDistance(ce),de=_e.position,Re=_e.xDistance,tt=_e.yDistance,Ce=this.setCaretPositionStyles(de,{caretWidth:P,caretHeight:N}),qe=Ce.yTransformOrigin,rt=Ce.xTransformOrigin;return{yTransformOrigin:qe,xTransformOrigin:rt,top:tt,left:Re}},x.prototype.calculateXWithCaretDistanceOptions=function(g,M,P){var N=P.caretWidth,Z=P.caretHeight,o=!this.adapter.isRTL(),B=g.left+g.width/2,ce=g.left-(M+this.anchorGap+Z),_e=g.right+this.anchorGap+Z,de=o?ce:_e,Re=o?_e:ce,tt=B-(ra.CARET_INDENTATION+N/2),Ce=B-(M-ra.CARET_INDENTATION-N/2),qe=o?tt:Ce,rt=o?Ce:tt,Je=B-M/2,Qe=new Map([[Pn.START,qe],[Pn.CENTER,Je],[Pn.END,rt],[Pn.SIDE_END,Re],[Pn.SIDE_START,de]]);return Qe},x.prototype.calculateYWithCaretDistanceOptions=function(g,M,P){var N=P.caretWidth,Z=P.caretHeight,o=g.top+g.height/2,B=g.bottom+this.anchorGap+Z,ce=g.top-(this.anchorGap+M+Z),_e=o-(ra.CARET_INDENTATION+N/2),de=o-M/2,Re=o-(M-ra.CARET_INDENTATION-N/2),tt=new Map([[jo.ABOVE,ce],[jo.BELOW,B],[jo.SIDE_TOP,_e],[jo.SIDE_CENTER,de],[jo.SIDE_BOTTOM,Re]]);return tt},x.prototype.repositionTooltipOnAnchorMove=function(){var g=this.adapter.getAnchorBoundingRect();!g||!this.anchorRect||(g.top!==this.anchorRect.top||g.left!==this.anchorRect.left||g.height!==this.anchorRect.height||g.width!==this.anchorRect.width)&&(this.anchorRect=g,this.parentRect=this.adapter.getParentBoundingRect(),this.richTooltip?this.positionRichTooltip():this.positionPlainTooltip())},x.prototype.validateTooltipWithCaretDistances=function(g,M){var P,N,Z,o,B,ce,_e=new Map,de=new Map,Re=new Map([[jo.ABOVE,[Pn.START,Pn.CENTER,Pn.END]],[jo.BELOW,[Pn.START,Pn.CENTER,Pn.END]],[jo.SIDE_TOP,[Pn.SIDE_START,Pn.SIDE_END]],[jo.SIDE_CENTER,[Pn.SIDE_START,Pn.SIDE_END]],[jo.SIDE_BOTTOM,[Pn.SIDE_START,Pn.SIDE_END]]]);try{for(var tt=Fl(Re.keys()),Ce=tt.next();!Ce.done;Ce=tt.next()){var qe=Ce.value,rt=g.get(qe);if(this.yPositionHonorsViewportThreshold(rt))try{for(var Je=(Z=void 0,Fl(Re.get(qe))),Qe=Je.next();!Qe.done;Qe=Je.next()){var Mt=Qe.value,lt=M.get(Mt);if(this.positionHonorsViewportThreshold(lt)){var $e=this.caretPositionOptionsMapping(Mt,qe);_e.set($e,{xDistance:lt,yDistance:rt})}}}catch(Pi){Z={error:Pi}}finally{try{Qe&&!Qe.done&&(o=Je.return)&&o.call(Je)}finally{if(Z)throw Z.error}}if(this.yPositionDoesntCollideWithViewport(rt))try{for(var Wt=(B=void 0,Fl(Re.get(qe))),ti=Wt.next();!ti.done;ti=Wt.next()){var Mt=ti.value,lt=M.get(Mt);if(this.positionDoesntCollideWithViewport(lt)){var $e=this.caretPositionOptionsMapping(Mt,qe);de.set($e,{xDistance:lt,yDistance:rt})}}}catch(Pi){B={error:Pi}}finally{try{ti&&!ti.done&&(ce=Wt.return)&&ce.call(Wt)}finally{if(B)throw B.error}}}}catch(Pi){P={error:Pi}}finally{try{Ce&&!Ce.done&&(N=tt.return)&&N.call(tt)}finally{if(P)throw P.error}}return _e.size?_e:de},x.prototype.generateBackupPositionOption=function(g,M,P){var N=!this.adapter.isRTL(),Z,o;if(g.left<0)Z=this.minViewportTooltipThreshold+P.caretHeight,o=N?Pn.END:Pn.START;else{var B=this.adapter.getViewportWidth();Z=B-(M.width+this.minViewportTooltipThreshold+P.caretHeight),o=N?Pn.START:Pn.END}var ce,_e;if(g.top<0)ce=this.minViewportTooltipThreshold+P.caretHeight,_e=jo.BELOW;else{var de=this.adapter.getViewportHeight();ce=de-(M.height+this.minViewportTooltipThreshold+P.caretHeight),_e=jo.ABOVE}var Re=this.caretPositionOptionsMapping(o,_e);return new Map([[Re,{xDistance:Z,yDistance:ce}]])},x.prototype.determineTooltipWithCaretDistance=function(g){if(g.has(this.tooltipPositionWithCaret)){var M=g.get(this.tooltipPositionWithCaret);return{position:this.tooltipPositionWithCaret,xDistance:M.xDistance,yDistance:M.yDistance}}var P=[un.ABOVE_START,un.ABOVE_CENTER,un.ABOVE_END,un.TOP_SIDE_START,un.CENTER_SIDE_START,un.BOTTOM_SIDE_START,un.TOP_SIDE_END,un.CENTER_SIDE_END,un.BOTTOM_SIDE_END,un.BELOW_START,un.BELOW_CENTER,un.BELOW_END],N=P.find(function(o){return g.has(o)}),Z=g.get(N);return{position:N,xDistance:Z.xDistance,yDistance:Z.yDistance}},x.prototype.caretPositionOptionsMapping=function(g,M){switch(M){case jo.ABOVE:if(g===Pn.START)return un.ABOVE_START;if(g===Pn.CENTER)return un.ABOVE_CENTER;if(g===Pn.END)return un.ABOVE_END;break;case jo.BELOW:if(g===Pn.START)return un.BELOW_START;if(g===Pn.CENTER)return un.BELOW_CENTER;if(g===Pn.END)return un.BELOW_END;break;case jo.SIDE_TOP:if(g===Pn.SIDE_START)return un.TOP_SIDE_START;if(g===Pn.SIDE_END)return un.TOP_SIDE_END;break;case jo.SIDE_CENTER:if(g===Pn.SIDE_START)return un.CENTER_SIDE_START;if(g===Pn.SIDE_END)return un.CENTER_SIDE_END;break;case jo.SIDE_BOTTOM:if(g===Pn.SIDE_START)return un.BOTTOM_SIDE_START;if(g===Pn.SIDE_END)return un.BOTTOM_SIDE_END;break}throw new Error("MDCTooltipFoundation: Invalid caret position of "+g+", "+M)},x.prototype.setCaretPositionStyles=function(g,M){var P,N,Z=this.calculateCaretPositionOnTooltip(g,M);if(!Z)return{yTransformOrigin:0,xTransformOrigin:0};this.adapter.clearTooltipCaretStyles(),this.adapter.setTooltipCaretStyle(Z.yAlignment,Z.yAxisPx),this.adapter.setTooltipCaretStyle(Z.xAlignment,Z.xAxisPx);var o=Z.skew*(Math.PI/180),B=Math.cos(o);this.adapter.setTooltipCaretStyle("transform","rotate("+Z.rotation+"deg) skewY("+Z.skew+"deg) scaleX("+B+")"),this.adapter.setTooltipCaretStyle("transform-origin",Z.xAlignment+" "+Z.yAlignment);try{for(var ce=Fl(Z.caretCorners),_e=ce.next();!_e.done;_e=ce.next()){var de=_e.value;this.adapter.setTooltipCaretStyle(de,"0")}}catch(Re){P={error:Re}}finally{try{_e&&!_e.done&&(N=ce.return)&&N.call(ce)}finally{if(P)throw P.error}}return{yTransformOrigin:Z.yTransformOrigin,xTransformOrigin:Z.xTransformOrigin}},x.prototype.calculateCaretPositionOnTooltip=function(g,M){var P=!this.adapter.isRTL(),N=this.adapter.getComputedStyleProperty("width"),Z=this.adapter.getComputedStyleProperty("height");if(!(!N||!Z||!M)){var o="calc(("+N+" - "+M.caretWidth+"px) / 2)",B="calc(("+Z+" - "+M.caretWidth+"px) / 2)",ce="0",_e=ra.CARET_INDENTATION+"px",de="calc("+N+" - "+_e+")",Re="calc("+Z+" - "+_e+")",tt=35,Ce=Math.abs(90-tt),qe=["border-bottom-right-radius","border-top-left-radius"],rt=["border-bottom-left-radius","border-top-right-radius"],Je=20;switch(g){case un.BELOW_CENTER:return{yAlignment:Ri.TOP,xAlignment:Ri.LEFT,yAxisPx:ce,xAxisPx:o,rotation:-1*tt,skew:-1*Je,xTransformOrigin:o,yTransformOrigin:ce,caretCorners:qe};case un.BELOW_END:return{yAlignment:Ri.TOP,xAlignment:P?Ri.RIGHT:Ri.LEFT,yAxisPx:ce,xAxisPx:_e,rotation:P?tt:-1*tt,skew:P?Je:-1*Je,xTransformOrigin:P?de:_e,yTransformOrigin:ce,caretCorners:P?rt:qe};case un.BELOW_START:return{yAlignment:Ri.TOP,xAlignment:P?Ri.LEFT:Ri.RIGHT,yAxisPx:ce,xAxisPx:_e,rotation:P?-1*tt:tt,skew:P?-1*Je:Je,xTransformOrigin:P?_e:de,yTransformOrigin:ce,caretCorners:P?qe:rt};case un.TOP_SIDE_END:return{yAlignment:Ri.TOP,xAlignment:P?Ri.LEFT:Ri.RIGHT,yAxisPx:_e,xAxisPx:ce,rotation:P?Ce:-1*Ce,skew:P?-1*Je:Je,xTransformOrigin:P?ce:N,yTransformOrigin:_e,caretCorners:P?qe:rt};case un.CENTER_SIDE_END:return{yAlignment:Ri.TOP,xAlignment:P?Ri.LEFT:Ri.RIGHT,yAxisPx:B,xAxisPx:ce,rotation:P?Ce:-1*Ce,skew:P?-1*Je:Je,xTransformOrigin:P?ce:N,yTransformOrigin:B,caretCorners:P?qe:rt};case un.BOTTOM_SIDE_END:return{yAlignment:Ri.BOTTOM,xAlignment:P?Ri.LEFT:Ri.RIGHT,yAxisPx:_e,xAxisPx:ce,rotation:P?-1*Ce:Ce,skew:P?Je:-1*Je,xTransformOrigin:P?ce:N,yTransformOrigin:Re,caretCorners:P?rt:qe};case un.TOP_SIDE_START:return{yAlignment:Ri.TOP,xAlignment:P?Ri.RIGHT:Ri.LEFT,yAxisPx:_e,xAxisPx:ce,rotation:P?-1*Ce:Ce,skew:P?Je:-1*Je,xTransformOrigin:P?N:ce,yTransformOrigin:_e,caretCorners:P?rt:qe};case un.CENTER_SIDE_START:return{yAlignment:Ri.TOP,xAlignment:P?Ri.RIGHT:Ri.LEFT,yAxisPx:B,xAxisPx:ce,rotation:P?-1*Ce:Ce,skew:P?Je:-1*Je,xTransformOrigin:P?N:ce,yTransformOrigin:B,caretCorners:P?rt:qe};case un.BOTTOM_SIDE_START:return{yAlignment:Ri.BOTTOM,xAlignment:P?Ri.RIGHT:Ri.LEFT,yAxisPx:_e,xAxisPx:ce,rotation:P?Ce:-1*Ce,skew:P?-1*Je:Je,xTransformOrigin:P?N:ce,yTransformOrigin:Re,caretCorners:P?qe:rt};case un.ABOVE_CENTER:return{yAlignment:Ri.BOTTOM,xAlignment:Ri.LEFT,yAxisPx:ce,xAxisPx:o,rotation:tt,skew:Je,xTransformOrigin:o,yTransformOrigin:Z,caretCorners:rt};case un.ABOVE_END:return{yAlignment:Ri.BOTTOM,xAlignment:P?Ri.RIGHT:Ri.LEFT,yAxisPx:ce,xAxisPx:_e,rotation:P?-1*tt:tt,skew:P?-1*Je:Je,xTransformOrigin:P?de:_e,yTransformOrigin:Z,caretCorners:P?qe:rt};default:case un.ABOVE_START:return{yAlignment:Ri.BOTTOM,xAlignment:P?Ri.LEFT:Ri.RIGHT,yAxisPx:ce,xAxisPx:_e,rotation:P?tt:-1*tt,skew:P?Je:-1*Je,xTransformOrigin:P?_e:de,yTransformOrigin:Z,caretCorners:P?rt:qe}}}},x.prototype.clearShowTimeout=function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)},x.prototype.clearHideTimeout=function(){this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)},x.prototype.attachScrollHandler=function(g){var M=this;this.addAncestorScrollEventListeners.push(function(){g("scroll",M.windowScrollHandler)})},x.prototype.removeScrollHandler=function(g){var M=this;this.removeAncestorScrollEventListeners.push(function(){g("scroll",M.windowScrollHandler)})},x.prototype.destroy=function(){var g,M;this.frameId&&(cancelAnimationFrame(this.frameId),this.frameId=null),this.clearHideTimeout(),this.clearShowTimeout(),this.adapter.removeClass(xy),this.adapter.removeClass(g_),this.adapter.removeClass(by),this.adapter.removeClass(Ip),this.adapter.removeClass(y_),this.richTooltip&&this.adapter.deregisterEventHandler("focusout",this.richTooltipFocusOutHandler),this.persistentTooltip||(this.adapter.deregisterEventHandler("mouseenter",this.tooltipMouseEnterHandler),this.adapter.deregisterEventHandler("mouseleave",this.tooltipMouseLeaveHandler)),this.adapter.deregisterAnchorEventHandler("blur",this.anchorBlurHandler),this.adapter.deregisterDocumentEventHandler("click",this.documentClickHandler),this.adapter.deregisterDocumentEventHandler("keydown",this.documentKeydownHandler),this.adapter.deregisterWindowEventHandler("scroll",this.windowScrollHandler),this.adapter.deregisterWindowEventHandler("resize",this.windowResizeHandler);try{for(var P=Fl(this.removeAncestorScrollEventListeners),N=P.next();!N.done;N=P.next()){var Z=N.value;Z()}}catch(o){g={error:o}}finally{try{N&&!N.done&&(M=P.return)&&M.call(P)}finally{if(g)throw g.error}}this.animFrame.cancelAll()},x}(Ry);function Ps(D){return Object.entries(D).filter(([x,g])=>x!==""&&g).map(([x])=>x).join(" ")}function I_(D,x,g,M={bubbles:!0},P=!1){if(typeof Event>"u")throw new Error("Event not defined.");if(!D)throw new Error("Tried to dipatch event without element.");const N=new CustomEvent(x,Object.assign(Object.assign({},M),{detail:g}));if(D==null||D.dispatchEvent(N),P&&x.startsWith("SMUI")){const Z=new CustomEvent(x.replace(/^SMUI/g,()=>"MDC"),Object.assign(Object.assign({},M),{detail:g}));D==null||D.dispatchEvent(Z),Z.defaultPrevented&&N.preventDefault()}return N}function t0(D,x){let g=Object.getOwnPropertyNames(D);const M={};for(let P=0;P<g.length;P++){const N=g[P],Z=N.indexOf("$");Z!==-1&&x.indexOf(N.substring(0,Z+1))!==-1||x.indexOf(N)===-1&&(M[N]=D[N])}return M}const i0=/^[a-z]+(?::(?:preventDefault|stopPropagation|passive|nonpassive|capture|once|self))+$/,iv=/^[^$]+(?:\$(?:preventDefault|stopPropagation|passive|nonpassive|capture|once|self))+$/;function ku(D){let x,g=[];D.$on=(P,N)=>{let Z=P,o=()=>{};return x?o=x(Z,N):g.push([Z,N]),Z.match(i0)&&console&&console.warn('Event modifiers in SMUI now use "$" instead of ":", so that all events can be bound with modifiers. Please update your event binding: ',Z),()=>{o()}};function M(P){v0(D,P)}return P=>{const N=[],Z={};x=(o,B)=>{let ce=o,_e=B,de=!1;const Re=ce.match(i0),tt=ce.match(iv),Ce=Re||tt;if(ce.match(/^SMUI:\w+:/)){const Je=ce.split(":");let Qe="";for(let Mt=0;Mt<Je.length;Mt++)Qe+=Mt===Je.length-1?":"+Je[Mt]:Je[Mt].split("-").map(lt=>lt.slice(0,1).toUpperCase()+lt.slice(1)).join("");console.warn(`The event ${ce.split("$")[0]} has been renamed to ${Qe.split("$")[0]}.`),ce=Qe}if(Ce){const Je=ce.split(Re?":":"$");ce=Je[0];const Qe=Je.slice(1).reduce((Mt,lt)=>(Mt[lt]=!0,Mt),{});Qe.passive&&(de=de||{},de.passive=!0),Qe.nonpassive&&(de=de||{},de.passive=!1),Qe.capture&&(de=de||{},de.capture=!0),Qe.once&&(de=de||{},de.once=!0),Qe.preventDefault&&(_e=L0(_e)),Qe.stopPropagation&&(_e=P0(_e))}const qe=id(P,ce,_e,de),rt=()=>{qe();const Je=N.indexOf(rt);Je>-1&&N.splice(Je,1)};return N.push(rt),ce in Z||(Z[ce]=id(P,ce,M)),rt};for(let o=0;o<g.length;o++)x(g[o][0],g[o][1]);return{destroy:()=>{for(let o=0;o<N.length;o++)N[o]();for(let o of Object.entries(Z))o[1]()}}}}function n0(D,x){let g=Object.getOwnPropertyNames(D);const M={};for(let P=0;P<g.length;P++){const N=g[P];N.substring(0,x.length)===x&&(M[N.substring(x.length)]=D[N])}return M}function Mp(D,x){let g=[];if(x)for(let M=0;M<x.length;M++){const P=x[M],N=Array.isArray(P)?P[0]:P;Array.isArray(P)&&P.length>1?g.push(N(D,P[1])):g.push(N(D))}return{update(M){if((M&&M.length||0)!=g.length)throw new Error("You must not change the length of an actions array.");if(M)for(let P=0;P<M.length;P++){const N=g[P];if(N&&N.update){const Z=M[P];Array.isArray(Z)&&Z.length>1?N.update(Z[1]):N.update()}}},destroy(){for(let M=0;M<g.length;M++){const P=g[M];P&&P.destroy&&P.destroy()}}}}function nv(D){let x,g,M,P,N,Z,o,B,ce,_e,de,Re,tt;const Ce=D[32].default,qe=fc(Ce,D,D[31],null);let rt=[{class:M=Ps({[D[6]]:!0,"mdc-tooltip__surface":!0,"mdc-tooltip__surface-animation":!0})},{style:P=Object.entries(D[13]).map(r0).concat([D[7]]).join(" ")},n0(D[19],"surface$")],Je={};for(let lt=0;lt<rt.length;lt+=1)Je=Qn(Je,rt[lt]);let Qe=[{class:N=Ps({[D[1]]:!0,"mdc-tooltip":!0,"mdc-tooltip--rich":D[18],...D[10]})},{style:Z=Object.entries(D[11]).map(o0).concat([D[2]]).join(" ")},{"aria-hidden":"true"},{id:D[3]},{"data-mdc-tooltip-persist":o=D[18]&&D[4]?"true":void 0},{"data-mdc-tooltip-persistent":B=D[18]&&D[4]?"true":void 0},{"data-mdc-tooltip-has-caret":void 0},{"data-hide-tooltip-from-screenreader":ce=D[5]?"true":void 0},D[14],D[12],t0(D[19],["surface$"])],Mt={};for(let lt=0;lt<Qe.length;lt+=1)Mt=Qn(Mt,Qe[lt]);return{c(){x=Yn("div"),g=Yn("div"),qe&&qe.c(),this.h()},l(lt){x=Jn(lt,"DIV",{class:!0,style:!0,"aria-hidden":!0,id:!0,"data-mdc-tooltip-persist":!0,"data-mdc-tooltip-persistent":!0,"data-mdc-tooltip-has-caret":!0,"data-hide-tooltip-from-screenreader":!0});var $e=xr(x);g=Jn($e,"DIV",{class:!0,style:!0});var Wt=xr(g);qe&&qe.l(Wt),Wt.forEach(Xt),$e.forEach(Xt),this.h()},h(){gf(g,Je),gf(x,Mt)},m(lt,$e){Ni(lt,x,$e),bn(x,g),qe&&qe.m(g,null),D[33](x),de=!0,Re||(tt=[Hc(_e=Mp.call(null,x,D[0])),Hc(D[15].call(null,x)),id(x,"transitionend",D[34])],Re=!0)},p(lt,$e){qe&&qe.p&&(!de||$e[1]&1)&&pc(qe,Ce,lt,lt[31],de?_c(Ce,lt[31],$e,null):mc(lt[31]),null),gf(g,Je=hc(rt,[(!de||$e[0]&64&&M!==(M=Ps({[lt[6]]:!0,"mdc-tooltip__surface":!0,"mdc-tooltip__surface-animation":!0})))&&{class:M},(!de||$e[0]&8320&&P!==(P=Object.entries(lt[13]).map(r0).concat([lt[7]]).join(" ")))&&{style:P},$e[0]&524288&&n0(lt[19],"surface$")])),gf(x,Mt=hc(Qe,[(!de||$e[0]&1026&&N!==(N=Ps({[lt[1]]:!0,"mdc-tooltip":!0,"mdc-tooltip--rich":lt[18],...lt[10]})))&&{class:N},(!de||$e[0]&2052&&Z!==(Z=Object.entries(lt[11]).map(o0).concat([lt[2]]).join(" ")))&&{style:Z},{"aria-hidden":"true"},(!de||$e[0]&8)&&{id:lt[3]},(!de||$e[0]&16&&o!==(o=lt[18]&&lt[4]?"true":void 0))&&{"data-mdc-tooltip-persist":o},(!de||$e[0]&16&&B!==(B=lt[18]&&lt[4]?"true":void 0))&&{"data-mdc-tooltip-persistent":B},{"data-mdc-tooltip-has-caret":void 0},(!de||$e[0]&32&&ce!==(ce=lt[5]?"true":void 0))&&{"data-hide-tooltip-from-screenreader":ce},$e[0]&16384&&lt[14],$e[0]&4096&&lt[12],$e[0]&524288&&t0(lt[19],["surface$"])])),_e&&od(_e.update)&&$e[0]&1&&_e.update.call(null,lt[0])},i(lt){de||(xi(qe,lt),de=!0)},o(lt){wi(qe,lt),de=!1},d(lt){lt&&Xt(x),qe&&qe.d(lt),D[33](null),Re=!1,xf(tt)}}}let rv=0;const r0=([D,x])=>`${D}: ${x};`,o0=([D,x])=>`${D}: ${x};`;function ov(D,x,g){let M;const P=["use","class","style","id","unbounded","xPos","yPos","persistent","interactive","hideFromScreenreader","showDelay","hideDelay","surface$class","surface$style","attachScrollHandler","removeScrollHandler","getElement"];let N=Jo(x,P),Z,o,{$$slots:B={},$$scope:ce}=x;const _e=ku(Ou());let{use:de=[]}=x,{class:Re=""}=x,{style:tt=""}=x,{id:Ce="SMUI-tooltip-"+rv++}=x,{unbounded:qe=!1}=x,{xPos:rt="detected"}=x,{yPos:Je="detected"}=x,{persistent:Qe=!1}=x,{interactive:Mt=Qe}=x,{hideFromScreenreader:lt=!1}=x,{showDelay:$e=void 0}=x,{hideDelay:Wt=void 0}=x,{surface$class:ti=""}=x,{surface$style:Pi=""}=x,Ht,Ut,qt={setParent(Le){Object.defineProperty(this,"parent",{value:Le})},setNextSibling(Le){Object.defineProperty(this,"nextSibling",{value:Le})}},Ti={},ki={},fn={},ii={},Mn=uc("SMUI:tooltip:wrapper:anchor");Cp(D,Mn,Le=>g(30,Z=Le));let pn=uc("SMUI:tooltip:wrapper:tooltip");Cp(D,pn,Le=>g(35,o=Le));const nn=uc("SMUI:tooltip:rich");let Kt;Dy(()=>(g(8,Ut=new tv({getAttribute:hn,setAttribute:fi,removeAttribute:Yr,addClass:or,hasClass:Wr,removeClass:Zn,getComputedStyleProperty:Le=>{const ri=tn();let br=getComputedStyle(ri).getPropertyValue(Le);return br==="auto"&&(ri.classList.add("smui-banner--force-show"),br=getComputedStyle(ri).getPropertyValue(Le),ri.classList.remove("smui-banner--force-show")),br},setStyleProperty:no,setSurfaceAnimationStyleProperty:Rr,getViewportWidth:()=>window.innerWidth,getViewportHeight:()=>window.innerHeight,getTooltipSize:()=>{const Le=tn();let ri={width:Le.offsetWidth,height:Le.offsetHeight};return(ri.width===0||ri.height===0)&&(Le.classList.add("smui-banner--force-show"),ri={width:Le.offsetWidth,height:Le.offsetHeight},Le.classList.remove("smui-banner--force-show")),ri},getAnchorBoundingRect:()=>Z?Z.getBoundingClientRect():null,getParentBoundingRect:()=>{let Le=tn().parentElement;return nn||(Le=document.body),(Le==null?void 0:Le.getBoundingClientRect())||null},getAnchorAttribute:Le=>Z?Z.getAttribute(Le):null,setAnchorAttribute:(Le,ri)=>{Z&&Z.setAttribute(Le,ri)},isRTL:()=>getComputedStyle(tn()).direction==="rtl",anchorContainsElement:Le=>!!(Z&&Z.contains(Le)),tooltipContainsElement:Le=>tn().contains(Le),focusAnchorElement:()=>{Z&&Z.focus()},registerEventHandler:(Le,ri)=>{tn().addEventListener(Le,ri)},deregisterEventHandler:(Le,ri)=>{tn().removeEventListener(Le,ri)},registerAnchorEventHandler:(Le,ri)=>{Z&&Z.addEventListener(Le,ri)},deregisterAnchorEventHandler:(Le,ri)=>{Z&&Z.removeEventListener(Le,ri)},registerDocumentEventHandler:(Le,ri)=>{document.body.addEventListener(Le,ri)},deregisterDocumentEventHandler:(Le,ri)=>{document.body.removeEventListener(Le,ri)},registerWindowEventHandler:(Le,ri)=>{window.addEventListener(Le,ri,Le==="scroll"&&{capture:!0,passive:!0})},deregisterWindowEventHandler:(Le,ri)=>{window.removeEventListener(Le,ri,Le==="scroll"&&{capture:!0,passive:!0})},notifyHidden:()=>{I_(tn(),"SMUITooltip:hidden",void 0,void 0,!0)},getTooltipCaretBoundingRect:()=>{const Le=tn().querySelector(`.${Pa.TOOLTIP_CARET_TOP}`);return Le?Le.getBoundingClientRect():null},setTooltipCaretStyle:(Le,ri)=>{const br=tn().querySelector(`.${Pa.TOOLTIP_CARET_TOP}`),zs=tn().querySelector(`.${Pa.TOOLTIP_CARET_BOTTOM}`);!br||!zs||(br.style.setProperty(Le,ri),zs.style.setProperty(Le,ri))},clearTooltipCaretStyles:()=>{const Le=tn().querySelector(`.${Pa.TOOLTIP_CARET_TOP}`),ri=tn().querySelector(`.${Pa.TOOLTIP_CARET_BOTTOM}`);!Le||!ri||(Le.removeAttribute("style"),ri.removeAttribute("style"))},getActiveElement:()=>document.activeElement})),x0(pn,o=Ht,o),()=>{Z&&rn(Z)})),Ly(()=>{var Le;!nn&&typeof document<"u"&&document.body===tn().parentElement&&qt.parent!==tn().parentElement&&(!((Le=qt.parent)===null||Le===void 0)&&Le.insertBefore)&&qt.nextSibling&&qt.parent.insertBefore(tn(),qt.nextSibling)});function rn(Le){Le.removeEventListener("focusout",zr),nn&&Qe?(Le.removeEventListener("click",Bt),Le.removeEventListener("keydown",Bt)):(Le.removeEventListener("mouseenter",Oi),Le.removeEventListener("focusin",ro),Le.removeEventListener("mouseleave",Gt),Le.removeEventListener("touchstart",Cr),Le.removeEventListener("touchend",kr)),nn&&Mt?(Le.removeAttribute("aria-haspopup"),Le.removeAttribute("aria-expanded"),Le.removeAttribute("data-tooltip-id")):Le.removeAttribute("aria-describedby"),Ut.destroy()}function en(Le){Le.addEventListener("focusout",zr),nn&&Qe?(Le.addEventListener("click",Bt),Le.addEventListener("keydown",Bt)):(Le.addEventListener("mouseenter",Oi),Le.addEventListener("focusin",ro),Le.addEventListener("mouseleave",Gt),Le.addEventListener("touchstart",Cr),Le.addEventListener("touchend",kr)),nn&&Mt?(Le.setAttribute("aria-haspopup","dialog"),Le.setAttribute("aria-expanded","false"),Le.setAttribute("data-tooltip-id",Ce)):Le.setAttribute("aria-describedby",Ce),nn||oo(),Ut.init()}function Wr(Le){return Le in Ti?Ti[Le]:tn().classList.contains(Le)}function or(Le){Ti[Le]||g(10,Ti[Le]=!0,Ti)}function Zn(Le){(!(Le in Ti)||Ti[Le])&&g(10,Ti[Le]=!1,Ti)}function no(Le,ri){ki[Le]!=ri&&(ri===""||ri==null?(delete ki[Le],g(11,ki)):g(11,ki[Le]=ri,ki))}function Rr(Le,ri){ii[Le]!=ri&&(ri===""||ri==null?(delete ii[Le],g(13,ii)):g(13,ii[Le]=ri,ii))}function hn(Le){var ri;return Le in fn?(ri=fn[Le])!==null&&ri!==void 0?ri:null:tn().getAttribute(Le)}function fi(Le,ri){fn[Le]!==ri&&g(12,fn[Le]=ri,fn)}function Yr(Le){(!(Le in fn)||fn[Le]!=null)&&g(12,fn[Le]=void 0,fn)}function zr(Le){Ht.contains(Le.relatedTarget)||Ut&&Ut.hide()}function Bt(Le){Le.type==="keydown"&&Le.key!=="Enter"&&Le.key!==" "||Ut&&Ut.handleAnchorClick()}function Oi(){Ut&&Ut.handleAnchorMouseEnter()}function ro(Le){Ut&&Ut.handleAnchorFocus(Le)}function Gt(){Ut&&Ut.handleAnchorMouseLeave()}function Cr(){Ut&&Ut.handleAnchorTouchstart()}function kr(){Ut&&Ut.handleAnchorTouchend()}function oo(){var Le,ri;Z&&document.body!==tn().parentNode&&(qt.setParent((Le=tn().parentElement)!==null&&Le!==void 0?Le:void 0),qt.setNextSibling((ri=tn().nextElementSibling)!==null&&ri!==void 0?ri:void 0),document.body.appendChild(tn()))}function Wo(Le){Ut&&Ut.attachScrollHandler(Le)}function ka(Le){Ut&&Ut.removeScrollHandler(Le)}function tn(){return Ht}function dr(Le){dc[Le?"unshift":"push"](()=>{Ht=Le,g(9,Ht)})}const Br=()=>Ut&&Ut.handleTransitionEnd();return D.$$set=Le=>{x=Qn(Qn({},x),$c(Le)),g(19,N=Jo(x,P)),"use"in Le&&g(0,de=Le.use),"class"in Le&&g(1,Re=Le.class),"style"in Le&&g(2,tt=Le.style),"id"in Le&&g(3,Ce=Le.id),"unbounded"in Le&&g(20,qe=Le.unbounded),"xPos"in Le&&g(21,rt=Le.xPos),"yPos"in Le&&g(22,Je=Le.yPos),"persistent"in Le&&g(4,Qe=Le.persistent),"interactive"in Le&&g(23,Mt=Le.interactive),"hideFromScreenreader"in Le&&g(5,lt=Le.hideFromScreenreader),"showDelay"in Le&&g(24,$e=Le.showDelay),"hideDelay"in Le&&g(25,Wt=Le.hideDelay),"surface$class"in Le&&g(6,ti=Le.surface$class),"surface$style"in Le&&g(7,Pi=Le.surface$style),"$$scope"in Le&&g(31,ce=Le.$$scope)},D.$$.update=()=>{D.$$.dirty[0]&8388624&&g(14,M={role:nn&&Mt?"dialog":"tooltip",tabindex:nn&&Qe?-1:void 0}),D.$$.dirty[0]&1610612992&&Ut&&Kt!==Z&&(Kt&&rn(Kt),Z&&en(Z),g(29,Kt=Z)),D.$$.dirty[0]&1048832&&Ut&&Ut.setAnchorBoundaryType(S_[qe?"UNBOUNDED":"BOUNDED"]),D.$$.dirty[0]&6291712&&Ut&&Ut.setTooltipPosition({xPos:nd[rt.toUpperCase()],yPos:yf[Je.toUpperCase()]}),D.$$.dirty[0]&16777472&&Ut&&$e!=null&&Ut.setShowDelay($e),D.$$.dirty[0]&33554688&&Ut&&Wt!=null&&Ut.setHideDelay(Wt)},[de,Re,tt,Ce,Qe,lt,ti,Pi,Ut,Ht,Ti,ki,fn,ii,M,_e,Mn,pn,nn,N,qe,rt,Je,Mt,$e,Wt,Wo,ka,tn,Kt,Z,ce,B,dr,Br]}class M_ extends Os{constructor(x){super(),Rs(this,x,ov,nv,Qo,{use:0,class:1,style:2,id:3,unbounded:20,xPos:21,yPos:22,persistent:4,interactive:23,hideFromScreenreader:5,showDelay:24,hideDelay:25,surface$class:6,surface$style:7,attachScrollHandler:26,removeScrollHandler:27,getElement:28},null,[-1,-1])}get attachScrollHandler(){return this.$$.ctx[26]}get removeScrollHandler(){return this.$$.ctx[27]}get getElement(){return this.$$.ctx[28]}}function sv(D){let x;const g=D[12].default,M=fc(g,D,D[11],null);return{c(){M&&M.c()},l(P){M&&M.l(P)},m(P,N){M&&M.m(P,N),x=!0},p(P,N){M&&M.p&&(!x||N&2048)&&pc(M,g,P,P[11],x?_c(g,P[11],N,null):mc(P[11]),null)},i(P){x||(xi(M,P),x=!0)},o(P){wi(M,P),x=!1},d(P){M&&M.d(P)}}}function av(D){let x,g,M,P,N,Z;const o=D[12].default,B=fc(o,D,D[11],null);let ce=[{class:g=Ps({[D[1]]:!0,"mdc-tooltip-wrapper--rich":!0})},D[7]],_e={};for(let de=0;de<ce.length;de+=1)_e=Qn(_e,ce[de]);return{c(){x=Yn("div"),B&&B.c(),this.h()},l(de){x=Jn(de,"DIV",{class:!0});var Re=xr(x);B&&B.l(Re),Re.forEach(Xt),this.h()},h(){gf(x,_e)},m(de,Re){Ni(de,x,Re),B&&B.m(x,null),D[13](x),P=!0,N||(Z=[Hc(M=Mp.call(null,x,D[0])),Hc(D[4].call(null,x))],N=!0)},p(de,Re){B&&B.p&&(!P||Re&2048)&&pc(B,o,de,de[11],P?_c(o,de[11],Re,null):mc(de[11]),null),gf(x,_e=hc(ce,[(!P||Re&2&&g!==(g=Ps({[de[1]]:!0,"mdc-tooltip-wrapper--rich":!0})))&&{class:g},Re&128&&de[7]])),M&&od(M.update)&&Re&1&&M.update.call(null,de[0])},i(de){P||(xi(B,de),P=!0)},o(de){wi(B,de),P=!1},d(de){de&&Xt(x),B&&B.d(de),D[13](null),N=!1,xf(Z)}}}function lv(D){let x,g,M,P;const N=[av,sv],Z=[];function o(B,ce){return B[2]?0:1}return x=o(D),g=Z[x]=N[x](D),{c(){g.c(),M=Ir()},l(B){g.l(B),M=Ir()},m(B,ce){Z[x].m(B,ce),Ni(B,M,ce),P=!0},p(B,[ce]){let _e=x;x=o(B),x===_e?Z[x].p(B,ce):(Ru(),wi(Z[_e],1,1,()=>{Z[_e]=null}),zu(),g=Z[x],g?g.p(B,ce):(g=Z[x]=N[x](B),g.c()),xi(g,1),g.m(M.parentNode,M))},i(B){P||(xi(g),P=!0)},o(B){wi(g),P=!1},d(B){Z[x].d(B),B&&Xt(M)}}}function cv(D,x,g){const M=["use","class","rich","getElement"];let P=Jo(x,M),N,Z,{$$slots:o={},$$scope:B}=x;const ce=ku(Ou());let{use:_e=[]}=x,{class:de=""}=x,{rich:Re=!1}=x,tt;const Ce=Ay(void 0);Cp(D,Ce,Qe=>g(10,Z=Qe));const qe=Ay(void 0);Cp(D,qe,Qe=>g(9,N=Qe)),rd("SMUI:tooltip:wrapper:anchor",Ce),rd("SMUI:tooltip:wrapper:tooltip",qe),rd("SMUI:tooltip:rich",Re);function rt(){return tt}function Je(Qe){dc[Qe?"unshift":"push"](()=>{tt=Qe,g(3,tt)})}return D.$$set=Qe=>{x=Qn(Qn({},x),$c(Qe)),g(7,P=Jo(x,M)),"use"in Qe&&g(0,_e=Qe.use),"class"in Qe&&g(1,de=Qe.class),"rich"in Qe&&g(2,Re=Qe.rich),"$$scope"in Qe&&g(11,B=Qe.$$scope)},D.$$.update=()=>{D.$$.dirty&1536&&N&&!Z&&x0(Ce,Z=N.previousElementSibling,Z)},[_e,de,Re,tt,ce,Ce,qe,P,rt,N,Z,B,o,Je]}class E_ extends Os{constructor(x){super(),Rs(this,x,cv,lv,Qo,{use:0,class:1,rich:2,getElement:8})}get getElement(){return this.$$.ctx[8]}}function uv(D){let x;const g=D[10].default,M=fc(g,D,D[12],null);return{c(){M&&M.c()},l(P){M&&M.l(P)},m(P,N){M&&M.m(P,N),x=!0},p(P,N){M&&M.p&&(!x||N&4096)&&pc(M,g,P,P[12],x?_c(g,P[12],N,null):mc(P[12]),null)},i(P){x||(xi(M,P),x=!0)},o(P){wi(M,P),x=!1},d(P){M&&M.d(P)}}}function hv(D){let x,g,M;const P=[{tag:D[3]},{use:[D[5],...D[0]]},{class:Ps({[D[1]]:!0,"mdc-button__label":D[6]==="button","mdc-fab__label":D[6]==="fab","mdc-tab__text-label":D[6]==="tab","mdc-image-list__label":D[6]==="image-list","mdc-snackbar__label":D[6]==="snackbar","mdc-banner__text":D[6]==="banner","mdc-segmented-button__label":D[6]==="segmented-button","mdc-data-table__pagination-rows-per-page-label":D[6]==="data-table:pagination","mdc-data-table__header-cell-label":D[6]==="data-table:sortable-header-cell"})},D[6]==="snackbar"?{"aria-atomic":"false"}:{},{tabindex:D[7]},D[8]];var N=D[2];function Z(o){let B={$$slots:{default:[uv]},$$scope:{ctx:o}};for(let ce=0;ce<P.length;ce+=1)B=Qn(B,P[ce]);return{props:B}}return N&&(x=Xc(N,Z(D)),D[11](x)),{c(){x&&Tn(x.$$.fragment),g=Ir()},l(o){x&&qn(x.$$.fragment,o),g=Ir()},m(o,B){x&&En(x,o,B),Ni(o,g,B),M=!0},p(o,[B]){const ce=B&491?hc(P,[B&8&&{tag:o[3]},B&33&&{use:[o[5],...o[0]]},B&66&&{class:Ps({[o[1]]:!0,"mdc-button__label":o[6]==="button","mdc-fab__label":o[6]==="fab","mdc-tab__text-label":o[6]==="tab","mdc-image-list__label":o[6]==="image-list","mdc-snackbar__label":o[6]==="snackbar","mdc-banner__text":o[6]==="banner","mdc-segmented-button__label":o[6]==="segmented-button","mdc-data-table__pagination-rows-per-page-label":o[6]==="data-table:pagination","mdc-data-table__header-cell-label":o[6]==="data-table:sortable-header-cell"})},B&64&&ll(o[6]==="snackbar"?{"aria-atomic":"false"}:{}),B&128&&{tabindex:o[7]},B&256&&ll(o[8])]):{};if(B&4096&&(ce.$$scope={dirty:B,ctx:o}),B&4&&N!==(N=o[2])){if(x){Ru();const _e=x;wi(_e.$$.fragment,1,0,()=>{An(_e,1)}),zu()}N?(x=Xc(N,Z(o)),o[11](x),Tn(x.$$.fragment),xi(x.$$.fragment,1),En(x,g.parentNode,g)):x=null}else N&&x.$set(ce)},i(o){M||(x&&xi(x.$$.fragment,o),M=!0)},o(o){x&&wi(x.$$.fragment,o),M=!1},d(o){D[11](null),o&&Xt(g),x&&An(x,o)}}}function dv(D,x,g){const M=["use","class","component","tag","getElement"];let P=Jo(x,M),{$$slots:N={},$$scope:Z}=x;const o=ku(Ou());let{use:B=[]}=x,{class:ce=""}=x,_e,{component:de=Kc}=x,{tag:Re=de===Kc?"span":void 0}=x;const tt=uc("SMUI:label:context"),Ce=uc("SMUI:label:tabindex");function qe(){return _e.getElement()}function rt(Je){dc[Je?"unshift":"push"](()=>{_e=Je,g(4,_e)})}return D.$$set=Je=>{x=Qn(Qn({},x),$c(Je)),g(8,P=Jo(x,M)),"use"in Je&&g(0,B=Je.use),"class"in Je&&g(1,ce=Je.class),"component"in Je&&g(2,de=Je.component),"tag"in Je&&g(3,Re=Je.tag),"$$scope"in Je&&g(12,Z=Je.$$scope)},[B,ce,de,Re,_e,o,tt,Ce,P,qe,N,rt,Z]}class fv extends Os{constructor(x){super(),Rs(this,x,dv,hv,Qo,{use:0,class:1,component:2,tag:3,getElement:9})}get getElement(){return this.$$.ctx[9]}}function pv(D){let x;const g=D[11].default,M=fc(g,D,D[13],null);return{c(){M&&M.c()},l(P){M&&M.l(P)},m(P,N){M&&M.m(P,N),x=!0},p(P,N){M&&M.p&&(!x||N&8192)&&pc(M,g,P,P[13],x?_c(g,P[13],N,null):mc(P[13]),null)},i(P){x||(xi(M,P),x=!0)},o(P){wi(M,P),x=!1},d(P){M&&M.d(P)}}}function mv(D){let x,g,M;const P=[{tag:D[4]},{use:[D[6],...D[0]]},{class:Ps({[D[1]]:!0,"mdc-button__icon":D[8]==="button","mdc-fab__icon":D[8]==="fab","mdc-icon-button__icon":D[8]==="icon-button","mdc-icon-button__icon--on":D[8]==="icon-button"&&D[2],"mdc-tab__icon":D[8]==="tab","mdc-banner__icon":D[8]==="banner","mdc-segmented-button__icon":D[8]==="segmented-button"})},{"aria-hidden":"true"},D[7]?{focusable:"false",tabindex:"-1"}:{},D[9]];var N=D[3];function Z(o){let B={$$slots:{default:[pv]},$$scope:{ctx:o}};for(let ce=0;ce<P.length;ce+=1)B=Qn(B,P[ce]);return{props:B}}return N&&(x=Xc(N,Z(D)),D[12](x)),{c(){x&&Tn(x.$$.fragment),g=Ir()},l(o){x&&qn(x.$$.fragment,o),g=Ir()},m(o,B){x&&En(x,o,B),Ni(o,g,B),M=!0},p(o,[B]){const ce=B&983?hc(P,[B&16&&{tag:o[4]},B&65&&{use:[o[6],...o[0]]},B&262&&{class:Ps({[o[1]]:!0,"mdc-button__icon":o[8]==="button","mdc-fab__icon":o[8]==="fab","mdc-icon-button__icon":o[8]==="icon-button","mdc-icon-button__icon--on":o[8]==="icon-button"&&o[2],"mdc-tab__icon":o[8]==="tab","mdc-banner__icon":o[8]==="banner","mdc-segmented-button__icon":o[8]==="segmented-button"})},P[3],B&128&&ll(o[7]?{focusable:"false",tabindex:"-1"}:{}),B&512&&ll(o[9])]):{};if(B&8192&&(ce.$$scope={dirty:B,ctx:o}),B&8&&N!==(N=o[3])){if(x){Ru();const _e=x;wi(_e.$$.fragment,1,0,()=>{An(_e,1)}),zu()}N?(x=Xc(N,Z(o)),o[12](x),Tn(x.$$.fragment),xi(x.$$.fragment,1),En(x,g.parentNode,g)):x=null}else N&&x.$set(ce)},i(o){M||(x&&xi(x.$$.fragment,o),M=!0)},o(o){x&&wi(x.$$.fragment,o),M=!1},d(o){D[12](null),o&&Xt(g),x&&An(x,o)}}}function _v(D,x,g){const M=["use","class","on","component","tag","getElement"];let P=Jo(x,M),{$$slots:N={},$$scope:Z}=x;const o=ku(Ou());let{use:B=[]}=x,{class:ce=""}=x,{on:_e=!1}=x,de,{component:Re=Kc}=x,{tag:tt=Re===Kc?"i":void 0}=x;const Ce=Re===Ev,qe=uc("SMUI:icon:context");function rt(){return de.getElement()}function Je(Qe){dc[Qe?"unshift":"push"](()=>{de=Qe,g(5,de)})}return D.$$set=Qe=>{x=Qn(Qn({},x),$c(Qe)),g(9,P=Jo(x,M)),"use"in Qe&&g(0,B=Qe.use),"class"in Qe&&g(1,ce=Qe.class),"on"in Qe&&g(2,_e=Qe.on),"component"in Qe&&g(3,Re=Qe.component),"tag"in Qe&&g(4,tt=Qe.tag),"$$scope"in Qe&&g(13,Z=Qe.$$scope)},[B,ce,_e,Re,tt,de,o,Ce,qe,P,rt,N,Je,Z]}class gv extends Os{constructor(x){super(),Rs(this,x,_v,mv,Qo,{use:0,class:1,on:2,component:3,tag:4,getElement:10})}get getElement(){return this.$$.ctx[10]}}function yv(D){let x=D[1],g,M,P=D[1]&&wy(D);return{c(){P&&P.c(),g=Ir()},l(N){P&&P.l(N),g=Ir()},m(N,Z){P&&P.m(N,Z),Ni(N,g,Z),M=!0},p(N,Z){N[1]?x?Qo(x,N[1])?(P.d(1),P=wy(N),x=N[1],P.c(),P.m(g.parentNode,g)):P.p(N,Z):(P=wy(N),x=N[1],P.c(),P.m(g.parentNode,g)):x&&(P.d(1),P=null,x=N[1])},i(N){M||(xi(P),M=!0)},o(N){wi(P),M=!1},d(N){N&&Xt(g),P&&P.d(N)}}}function vv(D){let x=D[1],g,M=D[1]&&Ty(D);return{c(){M&&M.c(),g=Ir()},l(P){M&&M.l(P),g=Ir()},m(P,N){M&&M.m(P,N),Ni(P,g,N)},p(P,N){P[1]?x?Qo(x,P[1])?(M.d(1),M=Ty(P),x=P[1],M.c(),M.m(g.parentNode,g)):M.p(P,N):(M=Ty(P),x=P[1],M.c(),M.m(g.parentNode,g)):x&&(M.d(1),M=null,x=P[1])},i:Nl,o:Nl,d(P){P&&Xt(g),M&&M.d(P)}}}function wy(D){let x,g,M,P,N;const Z=D[8].default,o=fc(Z,D,D[7],null);let B=[D[5]],ce={};for(let _e=0;_e<B.length;_e+=1)ce=Qn(ce,B[_e]);return{c(){x=Yn(D[1]),o&&o.c(),this.h()},l(_e){x=Jn(_e,(D[1]||"null").toUpperCase(),{});var de=xr(x);o&&o.l(de),de.forEach(Xt),this.h()},h(){A_(D[1])(x,ce)},m(_e,de){Ni(_e,x,de),o&&o.m(x,null),D[10](x),M=!0,P||(N=[Hc(g=Mp.call(null,x,D[0])),Hc(D[4].call(null,x))],P=!0)},p(_e,de){o&&o.p&&(!M||de&128)&&pc(o,Z,_e,_e[7],M?_c(Z,_e[7],de,null):mc(_e[7]),null),A_(_e[1])(x,ce=hc(B,[de&32&&_e[5]])),g&&od(g.update)&&de&1&&g.update.call(null,_e[0])},i(_e){M||(xi(o,_e),M=!0)},o(_e){wi(o,_e),M=!1},d(_e){_e&&Xt(x),o&&o.d(_e),D[10](null),P=!1,xf(N)}}}function Ty(D){let x,g,M,P,N=[D[5]],Z={};for(let o=0;o<N.length;o+=1)Z=Qn(Z,N[o]);return{c(){x=Yn(D[1]),this.h()},l(o){x=Jn(o,(D[1]||"null").toUpperCase(),{}),xr(x).forEach(Xt),this.h()},h(){A_(D[1])(x,Z)},m(o,B){Ni(o,x,B),D[9](x),M||(P=[Hc(g=Mp.call(null,x,D[0])),Hc(D[4].call(null,x))],M=!0)},p(o,B){A_(o[1])(x,Z=hc(N,[B&32&&o[5]])),g&&od(g.update)&&B&1&&g.update.call(null,o[0])},d(o){o&&Xt(x),D[9](null),M=!1,xf(P)}}}function xv(D){let x,g,M,P;const N=[vv,yv],Z=[];function o(B,ce){return B[3]?0:1}return x=o(D),g=Z[x]=N[x](D),{c(){g.c(),M=Ir()},l(B){g.l(B),M=Ir()},m(B,ce){Z[x].m(B,ce),Ni(B,M,ce),P=!0},p(B,[ce]){let _e=x;x=o(B),x===_e?Z[x].p(B,ce):(Ru(),wi(Z[_e],1,1,()=>{Z[_e]=null}),zu(),g=Z[x],g?g.p(B,ce):(g=Z[x]=N[x](B),g.c()),xi(g,1),g.m(M.parentNode,M))},i(B){P||(xi(g),P=!0)},o(B){wi(g),P=!1},d(B){Z[x].d(B),B&&Xt(M)}}}function bv(D,x,g){let M;const P=["use","tag","getElement"];let N=Jo(x,P),{$$slots:Z={},$$scope:o}=x,{use:B=[]}=x,{tag:ce}=x;const _e=ku(Ou());let de;function Re(){return de}function tt(qe){dc[qe?"unshift":"push"](()=>{de=qe,g(2,de)})}function Ce(qe){dc[qe?"unshift":"push"](()=>{de=qe,g(2,de)})}return D.$$set=qe=>{x=Qn(Qn({},x),$c(qe)),g(5,N=Jo(x,P)),"use"in qe&&g(0,B=qe.use),"tag"in qe&&g(1,ce=qe.tag),"$$scope"in qe&&g(7,o=qe.$$scope)},D.$$.update=()=>{D.$$.dirty&2&&g(3,M=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"].indexOf(ce)>-1)},[B,ce,de,M,_e,N,Re,o,Z,tt,Ce]}class Kc extends Os{constructor(x){super(),Rs(this,x,bv,xv,Qo,{use:0,tag:1,getElement:6})}get getElement(){return this.$$.ctx[6]}}function wv(D){let x,g,M,P,N;const Z=D[6].default,o=fc(Z,D,D[5],null);let B=[D[3]],ce={};for(let _e=0;_e<B.length;_e+=1)ce=Qn(ce,B[_e]);return{c(){x=O0("svg"),o&&o.c(),this.h()},l(_e){x=R0(_e,"svg",{});var de=xr(x);o&&o.l(de),de.forEach(Xt),this.h()},h(){Xy(x,ce)},m(_e,de){Ni(_e,x,de),o&&o.m(x,null),D[7](x),M=!0,P||(N=[Hc(g=Mp.call(null,x,D[0])),Hc(D[2].call(null,x))],P=!0)},p(_e,[de]){o&&o.p&&(!M||de&32)&&pc(o,Z,_e,_e[5],M?_c(Z,_e[5],de,null):mc(_e[5]),null),Xy(x,ce=hc(B,[de&8&&_e[3]])),g&&od(g.update)&&de&1&&g.update.call(null,_e[0])},i(_e){M||(xi(o,_e),M=!0)},o(_e){wi(o,_e),M=!1},d(_e){_e&&Xt(x),o&&o.d(_e),D[7](null),P=!1,xf(N)}}}function Tv(D,x,g){const M=["use","getElement"];let P=Jo(x,M),{$$slots:N={},$$scope:Z}=x,{use:o=[]}=x;const B=ku(Ou());let ce;function _e(){return ce}function de(Re){dc[Re?"unshift":"push"](()=>{ce=Re,g(1,ce)})}return D.$$set=Re=>{x=Qn(Qn({},x),$c(Re)),g(3,P=Jo(x,M)),"use"in Re&&g(0,o=Re.use),"$$scope"in Re&&g(5,Z=Re.$$scope)},[o,ce,B,P,_e,Z,N,de]}class Ev extends Os{constructor(x){super(),Rs(this,x,Tv,wv,Qo,{use:0,getElement:4})}get getElement(){return this.$$.ctx[4]}}function Av(D){let x;const g=D[11].default,M=fc(g,D,D[13],null);return{c(){M&&M.c()},l(P){M&&M.l(P)},m(P,N){M&&M.m(P,N),x=!0},p(P,N){M&&M.p&&(!x||N&8192)&&pc(M,g,P,P[13],x?_c(g,P[13],N,null):mc(P[13]),null)},i(P){x||(xi(M,P),x=!0)},o(P){wi(M,P),x=!1},d(P){M&&M.d(P)}}}function Sv(D){let x,g,M;const P=[{tag:D[3]},{use:[D[8],...D[0]]},{class:Ps({[D[1]]:!0,[D[6]]:!0,...D[5]})},D[7],D[9]];var N=D[2];function Z(o){let B={$$slots:{default:[Av]},$$scope:{ctx:o}};for(let ce=0;ce<P.length;ce+=1)B=Qn(B,P[ce]);return{props:B}}return N&&(x=Xc(N,Z(D)),D[12](x)),{c(){x&&Tn(x.$$.fragment),g=Ir()},l(o){x&&qn(x.$$.fragment,o),g=Ir()},m(o,B){x&&En(x,o,B),Ni(o,g,B),M=!0},p(o,[B]){const ce=B&1003?hc(P,[B&8&&{tag:o[3]},B&257&&{use:[o[8],...o[0]]},B&98&&{class:Ps({[o[1]]:!0,[o[6]]:!0,...o[5]})},B&128&&ll(o[7]),B&512&&ll(o[9])]):{};if(B&8192&&(ce.$$scope={dirty:B,ctx:o}),B&4&&N!==(N=o[2])){if(x){Ru();const _e=x;wi(_e.$$.fragment,1,0,()=>{An(_e,1)}),zu()}N?(x=Xc(N,Z(o)),o[12](x),Tn(x.$$.fragment),xi(x.$$.fragment,1),En(x,g.parentNode,g)):x=null}else N&&x.$set(ce)},i(o){M||(x&&xi(x.$$.fragment,o),M=!0)},o(o){x&&wi(x.$$.fragment,o),M=!1},d(o){D[12](null),o&&Xt(g),x&&An(x,o)}}}const Lu={component:Kc,tag:"div",class:"",classMap:{},contexts:{},props:{}};function Iv(D,x,g){const M=["use","class","component","tag","getElement"];let P=Jo(x,M),{$$slots:N={},$$scope:Z}=x,{use:o=[]}=x,{class:B=""}=x,ce;const _e=Lu.class,de={},Re=[],tt=Lu.contexts,Ce=Lu.props;let{component:qe=Lu.component}=x,{tag:rt=qe===Kc?Lu.tag:void 0}=x;Object.entries(Lu.classMap).forEach(([lt,$e])=>{const Wt=uc($e);Wt&&"subscribe"in Wt&&Re.push(Wt.subscribe(ti=>{g(5,de[lt]=ti,de)}))});const Je=ku(Ou());for(let lt in tt)tt.hasOwnProperty(lt)&&rd(lt,tt[lt]);Ly(()=>{for(const lt of Re)lt()});function Qe(){return ce.getElement()}function Mt(lt){dc[lt?"unshift":"push"](()=>{ce=lt,g(4,ce)})}return D.$$set=lt=>{x=Qn(Qn({},x),$c(lt)),g(9,P=Jo(x,M)),"use"in lt&&g(0,o=lt.use),"class"in lt&&g(1,B=lt.class),"component"in lt&&g(2,qe=lt.component),"tag"in lt&&g(3,rt=lt.tag),"$$scope"in lt&&g(13,Z=lt.$$scope)},[o,B,qe,rt,ce,de,_e,Ce,Je,P,Qe,N,Mt,Z]}class Cv extends Os{constructor(x){super(),Rs(this,x,Iv,Sv,Qo,{use:0,class:1,component:2,tag:3,getElement:10})}get getElement(){return this.$$.ctx[10]}}const s0=Object.assign({},Lu);function D_(D){return new Proxy(Cv,{construct:function(x,g){return Object.assign(Lu,s0,D),new x(...g)},get:function(x,g){return Object.assign(Lu,s0,D),x[g]}})}D_({class:"mdc-tooltip__title",tag:"h2"});D_({class:"mdc-tooltip__content",tag:"div"});D_({class:"mdc-tooltip__content-link",tag:"a"});D_({class:"mdc-tooltip--rich-actions",tag:"div",contexts:{"SMUI:button:context":"tooltip:rich-actions"}});/**
 * @license
 * Copyright 2019 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */function Mv(D){return D===void 0&&(D=window),Dv(D)?{passive:!0}:!1}function Dv(D){D===void 0&&(D=window);var x=!1;try{var g={get passive(){return x=!0,!1}},M=function(){};D.document.addEventListener("test",M,g),D.document.removeEventListener("test",M,g)}catch{x=!1}return x}const Lv=Object.freeze(Object.defineProperty({__proto__:null,applyPassive:Mv},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */function Pv(D,x){if(D.closest)return D.closest(x);for(var g=D;g;){if(w0(g,x))return g;g=g.parentElement}return null}function w0(D,x){var g=D.matches||D.webkitMatchesSelector||D.msMatchesSelector;return g.call(D,x)}function Ov(D){var x=D;if(x.offsetParent!==null)return x.scrollWidth;var g=x.cloneNode(!0);g.style.setProperty("position","absolute"),g.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(g);var M=g.scrollWidth;return document.documentElement.removeChild(g),M}const Rv=Object.freeze(Object.defineProperty({__proto__:null,closest:Pv,estimateScrollWidth:Ov,matches:w0},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var zv={BG_FOCUSED:"mdc-ripple-upgraded--background-focused",FG_ACTIVATION:"mdc-ripple-upgraded--foreground-activation",FG_DEACTIVATION:"mdc-ripple-upgraded--foreground-deactivation",ROOT:"mdc-ripple-upgraded",UNBOUNDED:"mdc-ripple-upgraded--unbounded"},kv={VAR_FG_SCALE:"--mdc-ripple-fg-scale",VAR_FG_SIZE:"--mdc-ripple-fg-size",VAR_FG_TRANSLATE_END:"--mdc-ripple-fg-translate-end",VAR_FG_TRANSLATE_START:"--mdc-ripple-fg-translate-start",VAR_LEFT:"--mdc-ripple-left",VAR_TOP:"--mdc-ripple-top"},a0={DEACTIVATION_TIMEOUT_MS:225,FG_DEACTIVATION_MS:150,INITIAL_ORIGIN_SCALE:.6,PADDING:10,TAP_DELAY_MS:300},v_;function Bv(D,x){x===void 0&&(x=!1);var g=D.CSS,M=v_;if(typeof v_=="boolean"&&!x)return v_;var P=g&&typeof g.supports=="function";if(!P)return!1;var N=g.supports("--css-vars","yes"),Z=g.supports("(--css-vars: yes)")&&g.supports("color","#00000000");return M=N||Z,x||(v_=M),M}function Fv(D,x,g){if(!D)return{x:0,y:0};var M=x.x,P=x.y,N=M+g.left,Z=P+g.top,o,B;if(D.type==="touchstart"){var ce=D;o=ce.changedTouches[0].pageX-N,B=ce.changedTouches[0].pageY-Z}else{var _e=D;o=_e.pageX-N,B=_e.pageY-Z}return{x:o,y:B}}/**
 * @license
 * Copyright 2016 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var l0=["touchstart","pointerdown","mousedown","keydown"],c0=["touchend","pointerup","mouseup","contextmenu"],x_=[],Nv=function(D){Oy(x,D);function x(g){var M=D.call(this,Pu(Pu({},x.defaultAdapter),g))||this;return M.activationAnimationHasEnded=!1,M.activationTimer=0,M.fgDeactivationRemovalTimer=0,M.fgScale="0",M.frame={width:0,height:0},M.initialSize=0,M.layoutFrame=0,M.maxRadius=0,M.unboundedCoords={left:0,top:0},M.activationState=M.defaultActivationState(),M.activationTimerCallback=function(){M.activationAnimationHasEnded=!0,M.runDeactivationUXLogicIfReady()},M.activateHandler=function(P){M.activateImpl(P)},M.deactivateHandler=function(){M.deactivateImpl()},M.focusHandler=function(){M.handleFocus()},M.blurHandler=function(){M.handleBlur()},M.resizeHandler=function(){M.layout()},M}return Object.defineProperty(x,"cssClasses",{get:function(){return zv},enumerable:!1,configurable:!0}),Object.defineProperty(x,"strings",{get:function(){return kv},enumerable:!1,configurable:!0}),Object.defineProperty(x,"numbers",{get:function(){return a0},enumerable:!1,configurable:!0}),Object.defineProperty(x,"defaultAdapter",{get:function(){return{addClass:function(){},browserSupportsCssVars:function(){return!0},computeBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},containsEventTarget:function(){return!0},deregisterDocumentInteractionHandler:function(){},deregisterInteractionHandler:function(){},deregisterResizeHandler:function(){},getWindowPageOffset:function(){return{x:0,y:0}},isSurfaceActive:function(){return!0},isSurfaceDisabled:function(){return!0},isUnbounded:function(){return!0},registerDocumentInteractionHandler:function(){},registerInteractionHandler:function(){},registerResizeHandler:function(){},removeClass:function(){},updateCssVariable:function(){}}},enumerable:!1,configurable:!0}),x.prototype.init=function(){var g=this,M=this.supportsPressRipple();if(this.registerRootHandlers(M),M){var P=x.cssClasses,N=P.ROOT,Z=P.UNBOUNDED;requestAnimationFrame(function(){g.adapter.addClass(N),g.adapter.isUnbounded()&&(g.adapter.addClass(Z),g.layoutInternal())})}},x.prototype.destroy=function(){var g=this;if(this.supportsPressRipple()){this.activationTimer&&(clearTimeout(this.activationTimer),this.activationTimer=0,this.adapter.removeClass(x.cssClasses.FG_ACTIVATION)),this.fgDeactivationRemovalTimer&&(clearTimeout(this.fgDeactivationRemovalTimer),this.fgDeactivationRemovalTimer=0,this.adapter.removeClass(x.cssClasses.FG_DEACTIVATION));var M=x.cssClasses,P=M.ROOT,N=M.UNBOUNDED;requestAnimationFrame(function(){g.adapter.removeClass(P),g.adapter.removeClass(N),g.removeCssVars()})}this.deregisterRootHandlers(),this.deregisterDeactivationHandlers()},x.prototype.activate=function(g){this.activateImpl(g)},x.prototype.deactivate=function(){this.deactivateImpl()},x.prototype.layout=function(){var g=this;this.layoutFrame&&cancelAnimationFrame(this.layoutFrame),this.layoutFrame=requestAnimationFrame(function(){g.layoutInternal(),g.layoutFrame=0})},x.prototype.setUnbounded=function(g){var M=x.cssClasses.UNBOUNDED;g?this.adapter.addClass(M):this.adapter.removeClass(M)},x.prototype.handleFocus=function(){var g=this;requestAnimationFrame(function(){return g.adapter.addClass(x.cssClasses.BG_FOCUSED)})},x.prototype.handleBlur=function(){var g=this;requestAnimationFrame(function(){return g.adapter.removeClass(x.cssClasses.BG_FOCUSED)})},x.prototype.supportsPressRipple=function(){return this.adapter.browserSupportsCssVars()},x.prototype.defaultActivationState=function(){return{activationEvent:void 0,hasDeactivationUXRun:!1,isActivated:!1,isProgrammatic:!1,wasActivatedByPointer:!1,wasElementMadeActive:!1}},x.prototype.registerRootHandlers=function(g){var M,P;if(g){try{for(var N=Fl(l0),Z=N.next();!Z.done;Z=N.next()){var o=Z.value;this.adapter.registerInteractionHandler(o,this.activateHandler)}}catch(B){M={error:B}}finally{try{Z&&!Z.done&&(P=N.return)&&P.call(N)}finally{if(M)throw M.error}}this.adapter.isUnbounded()&&this.adapter.registerResizeHandler(this.resizeHandler)}this.adapter.registerInteractionHandler("focus",this.focusHandler),this.adapter.registerInteractionHandler("blur",this.blurHandler)},x.prototype.registerDeactivationHandlers=function(g){var M,P;if(g.type==="keydown")this.adapter.registerInteractionHandler("keyup",this.deactivateHandler);else try{for(var N=Fl(c0),Z=N.next();!Z.done;Z=N.next()){var o=Z.value;this.adapter.registerDocumentInteractionHandler(o,this.deactivateHandler)}}catch(B){M={error:B}}finally{try{Z&&!Z.done&&(P=N.return)&&P.call(N)}finally{if(M)throw M.error}}},x.prototype.deregisterRootHandlers=function(){var g,M;try{for(var P=Fl(l0),N=P.next();!N.done;N=P.next()){var Z=N.value;this.adapter.deregisterInteractionHandler(Z,this.activateHandler)}}catch(o){g={error:o}}finally{try{N&&!N.done&&(M=P.return)&&M.call(P)}finally{if(g)throw g.error}}this.adapter.deregisterInteractionHandler("focus",this.focusHandler),this.adapter.deregisterInteractionHandler("blur",this.blurHandler),this.adapter.isUnbounded()&&this.adapter.deregisterResizeHandler(this.resizeHandler)},x.prototype.deregisterDeactivationHandlers=function(){var g,M;this.adapter.deregisterInteractionHandler("keyup",this.deactivateHandler);try{for(var P=Fl(c0),N=P.next();!N.done;N=P.next()){var Z=N.value;this.adapter.deregisterDocumentInteractionHandler(Z,this.deactivateHandler)}}catch(o){g={error:o}}finally{try{N&&!N.done&&(M=P.return)&&M.call(P)}finally{if(g)throw g.error}}},x.prototype.removeCssVars=function(){var g=this,M=x.strings,P=Object.keys(M);P.forEach(function(N){N.indexOf("VAR_")===0&&g.adapter.updateCssVariable(M[N],null)})},x.prototype.activateImpl=function(g){var M=this;if(!this.adapter.isSurfaceDisabled()){var P=this.activationState;if(!P.isActivated){var N=this.previousActivationEvent,Z=N&&g!==void 0&&N.type!==g.type;if(!Z){P.isActivated=!0,P.isProgrammatic=g===void 0,P.activationEvent=g,P.wasActivatedByPointer=P.isProgrammatic?!1:g!==void 0&&(g.type==="mousedown"||g.type==="touchstart"||g.type==="pointerdown");var o=g!==void 0&&x_.length>0&&x_.some(function(B){return M.adapter.containsEventTarget(B)});if(o){this.resetActivationState();return}g!==void 0&&(x_.push(g.target),this.registerDeactivationHandlers(g)),P.wasElementMadeActive=this.checkElementMadeActive(g),P.wasElementMadeActive&&this.animateActivation(),requestAnimationFrame(function(){x_=[],!P.wasElementMadeActive&&g!==void 0&&(g.key===" "||g.keyCode===32)&&(P.wasElementMadeActive=M.checkElementMadeActive(g),P.wasElementMadeActive&&M.animateActivation()),P.wasElementMadeActive||(M.activationState=M.defaultActivationState())})}}}},x.prototype.checkElementMadeActive=function(g){return g!==void 0&&g.type==="keydown"?this.adapter.isSurfaceActive():!0},x.prototype.animateActivation=function(){var g=this,M=x.strings,P=M.VAR_FG_TRANSLATE_START,N=M.VAR_FG_TRANSLATE_END,Z=x.cssClasses,o=Z.FG_DEACTIVATION,B=Z.FG_ACTIVATION,ce=x.numbers.DEACTIVATION_TIMEOUT_MS;this.layoutInternal();var _e="",de="";if(!this.adapter.isUnbounded()){var Re=this.getFgTranslationCoordinates(),tt=Re.startPoint,Ce=Re.endPoint;_e=tt.x+"px, "+tt.y+"px",de=Ce.x+"px, "+Ce.y+"px"}this.adapter.updateCssVariable(P,_e),this.adapter.updateCssVariable(N,de),clearTimeout(this.activationTimer),clearTimeout(this.fgDeactivationRemovalTimer),this.rmBoundedActivationClasses(),this.adapter.removeClass(o),this.adapter.computeBoundingRect(),this.adapter.addClass(B),this.activationTimer=setTimeout(function(){g.activationTimerCallback()},ce)},x.prototype.getFgTranslationCoordinates=function(){var g=this.activationState,M=g.activationEvent,P=g.wasActivatedByPointer,N;P?N=Fv(M,this.adapter.getWindowPageOffset(),this.adapter.computeBoundingRect()):N={x:this.frame.width/2,y:this.frame.height/2},N={x:N.x-this.initialSize/2,y:N.y-this.initialSize/2};var Z={x:this.frame.width/2-this.initialSize/2,y:this.frame.height/2-this.initialSize/2};return{startPoint:N,endPoint:Z}},x.prototype.runDeactivationUXLogicIfReady=function(){var g=this,M=x.cssClasses.FG_DEACTIVATION,P=this.activationState,N=P.hasDeactivationUXRun,Z=P.isActivated,o=N||!Z;o&&this.activationAnimationHasEnded&&(this.rmBoundedActivationClasses(),this.adapter.addClass(M),this.fgDeactivationRemovalTimer=setTimeout(function(){g.adapter.removeClass(M)},a0.FG_DEACTIVATION_MS))},x.prototype.rmBoundedActivationClasses=function(){var g=x.cssClasses.FG_ACTIVATION;this.adapter.removeClass(g),this.activationAnimationHasEnded=!1,this.adapter.computeBoundingRect()},x.prototype.resetActivationState=function(){var g=this;this.previousActivationEvent=this.activationState.activationEvent,this.activationState=this.defaultActivationState(),setTimeout(function(){return g.previousActivationEvent=void 0},x.numbers.TAP_DELAY_MS)},x.prototype.deactivateImpl=function(){var g=this,M=this.activationState;if(M.isActivated){var P=Pu({},M);M.isProgrammatic?(requestAnimationFrame(function(){g.animateDeactivation(P)}),this.resetActivationState()):(this.deregisterDeactivationHandlers(),requestAnimationFrame(function(){g.activationState.hasDeactivationUXRun=!0,g.animateDeactivation(P),g.resetActivationState()}))}},x.prototype.animateDeactivation=function(g){var M=g.wasActivatedByPointer,P=g.wasElementMadeActive;(M||P)&&this.runDeactivationUXLogicIfReady()},x.prototype.layoutInternal=function(){var g=this;this.frame=this.adapter.computeBoundingRect();var M=Math.max(this.frame.height,this.frame.width),P=function(){var Z=Math.sqrt(Math.pow(g.frame.width,2)+Math.pow(g.frame.height,2));return Z+x.numbers.PADDING};this.maxRadius=this.adapter.isUnbounded()?M:P();var N=Math.floor(M*x.numbers.INITIAL_ORIGIN_SCALE);this.adapter.isUnbounded()&&N%2!==0?this.initialSize=N-1:this.initialSize=N,this.fgScale=""+this.maxRadius/this.initialSize,this.updateLayoutCssVars()},x.prototype.updateLayoutCssVars=function(){var g=x.strings,M=g.VAR_FG_SIZE,P=g.VAR_LEFT,N=g.VAR_TOP,Z=g.VAR_FG_SCALE;this.adapter.updateCssVariable(M,this.initialSize+"px"),this.adapter.updateCssVariable(Z,this.fgScale),this.adapter.isUnbounded()&&(this.unboundedCoords={left:Math.round(this.frame.width/2-this.initialSize/2),top:Math.round(this.frame.height/2-this.initialSize/2)},this.adapter.updateCssVariable(P,this.unboundedCoords.left+"px"),this.adapter.updateCssVariable(N,this.unboundedCoords.top+"px"))},x}(Ry);/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var b_={ICON_BUTTON_ON:"mdc-icon-button--on",ROOT:"mdc-icon-button"},Du={ARIA_LABEL:"aria-label",ARIA_PRESSED:"aria-pressed",DATA_ARIA_LABEL_OFF:"data-aria-label-off",DATA_ARIA_LABEL_ON:"data-aria-label-on",CHANGE_EVENT:"MDCIconButtonToggle:change"};/**
 * @license
 * Copyright 2018 Google Inc.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */var Uv=function(D){Oy(x,D);function x(g){var M=D.call(this,Pu(Pu({},x.defaultAdapter),g))||this;return M.hasToggledAriaLabel=!1,M}return Object.defineProperty(x,"cssClasses",{get:function(){return b_},enumerable:!1,configurable:!0}),Object.defineProperty(x,"strings",{get:function(){return Du},enumerable:!1,configurable:!0}),Object.defineProperty(x,"defaultAdapter",{get:function(){return{addClass:function(){},hasClass:function(){return!1},notifyChange:function(){},removeClass:function(){},getAttr:function(){return null},setAttr:function(){}}},enumerable:!1,configurable:!0}),x.prototype.init=function(){var g=this.adapter.getAttr(Du.DATA_ARIA_LABEL_ON),M=this.adapter.getAttr(Du.DATA_ARIA_LABEL_OFF);if(g&&M){if(this.adapter.getAttr(Du.ARIA_PRESSED)!==null)throw new Error("MDCIconButtonToggleFoundation: Button should not set `aria-pressed` if it has a toggled aria label.");this.hasToggledAriaLabel=!0}else this.adapter.setAttr(Du.ARIA_PRESSED,String(this.isOn()))},x.prototype.handleClick=function(){this.toggle(),this.adapter.notifyChange({isOn:this.isOn()})},x.prototype.isOn=function(){return this.adapter.hasClass(b_.ICON_BUTTON_ON)},x.prototype.toggle=function(g){if(g===void 0&&(g=!this.isOn()),g?this.adapter.addClass(b_.ICON_BUTTON_ON):this.adapter.removeClass(b_.ICON_BUTTON_ON),this.hasToggledAriaLabel){var M=g?this.adapter.getAttr(Du.DATA_ARIA_LABEL_ON):this.adapter.getAttr(Du.DATA_ARIA_LABEL_OFF);this.adapter.setAttr(Du.ARIA_LABEL,M||"")}else this.adapter.setAttr(Du.ARIA_PRESSED,""+g)},x}(Ry);const{applyPassive:w_}=Lv,{matches:Vv}=Rv;function C_(D,{ripple:x=!0,surface:g=!1,unbounded:M=!1,disabled:P=!1,color:N,active:Z,rippleElement:o,eventTarget:B,activeTarget:ce,addClass:_e=Ce=>D.classList.add(Ce),removeClass:de=Ce=>D.classList.remove(Ce),addStyle:Re=(Ce,qe)=>D.style.setProperty(Ce,qe),initPromise:tt=Promise.resolve()}={}){let Ce,qe=uc("SMUI:addLayoutListener"),rt,Je=Z,Qe=B,Mt=ce;function lt(){g?(_e("mdc-ripple-surface"),N==="primary"?(_e("smui-ripple-surface--primary"),de("smui-ripple-surface--secondary")):N==="secondary"?(de("smui-ripple-surface--primary"),_e("smui-ripple-surface--secondary")):(de("smui-ripple-surface--primary"),de("smui-ripple-surface--secondary"))):(de("mdc-ripple-surface"),de("smui-ripple-surface--primary"),de("smui-ripple-surface--secondary")),Ce&&Je!==Z&&(Je=Z,Z?Ce.activate():Z===!1&&Ce.deactivate()),x&&!Ce?(Ce=new Nv({addClass:_e,browserSupportsCssVars:()=>Bv(window),computeBoundingRect:()=>(o||D).getBoundingClientRect(),containsEventTarget:Wt=>D.contains(Wt),deregisterDocumentInteractionHandler:(Wt,ti)=>document.documentElement.removeEventListener(Wt,ti,w_()),deregisterInteractionHandler:(Wt,ti)=>(B||D).removeEventListener(Wt,ti,w_()),deregisterResizeHandler:Wt=>window.removeEventListener("resize",Wt),getWindowPageOffset:()=>({x:window.pageXOffset,y:window.pageYOffset}),isSurfaceActive:()=>Z??Vv(ce||D,":active"),isSurfaceDisabled:()=>!!P,isUnbounded:()=>!!M,registerDocumentInteractionHandler:(Wt,ti)=>document.documentElement.addEventListener(Wt,ti,w_()),registerInteractionHandler:(Wt,ti)=>(B||D).addEventListener(Wt,ti,w_()),registerResizeHandler:Wt=>window.addEventListener("resize",Wt),removeClass:de,updateCssVariable:Re}),tt.then(()=>{Ce&&(Ce.init(),Ce.setUnbounded(M))})):Ce&&!x&&tt.then(()=>{Ce&&(Ce.destroy(),Ce=void 0)}),Ce&&(Qe!==B||Mt!==ce)&&(Qe=B,Mt=ce,Ce.destroy(),requestAnimationFrame(()=>{Ce&&(Ce.init(),Ce.setUnbounded(M))})),!x&&M&&_e("mdc-ripple-upgraded--unbounded")}lt(),qe&&(rt=qe($e));function $e(){Ce&&Ce.layout()}return{update(Wt){({ripple:x,surface:g,unbounded:M,disabled:P,color:N,active:Z,rippleElement:o,eventTarget:B,activeTarget:ce,addClass:_e,removeClass:de,addStyle:Re,initPromise:tt}=Object.assign({ripple:!0,surface:!1,unbounded:!1,disabled:!1,color:void 0,active:void 0,rippleElement:void 0,eventTarget:void 0,activeTarget:void 0,addClass:ti=>D.classList.add(ti),removeClass:ti=>D.classList.remove(ti),addStyle:(ti,Pi)=>D.style.setProperty(ti,Pi),initPromise:Promise.resolve()},Wt)),lt()},destroy(){Ce&&(Ce.destroy(),Ce=void 0,de("mdc-ripple-surface"),de("smui-ripple-surface--primary"),de("smui-ripple-surface--secondary")),rt&&rt()}}}function u0(D){let x;return{c(){x=Yn("div"),this.h()},l(g){x=Jn(g,"DIV",{class:!0}),xr(x).forEach(Xt),this.h()},h(){wn(x,"class","mdc-icon-button__touch")},m(g,M){Ni(g,x,M)},d(g){g&&Xt(x)}}}function Gv(D){let x,g,M,P;const N=D[33].default,Z=fc(N,D,D[37],null);let o=D[8]&&u0();return{c(){x=Yn("div"),g=yr(),Z&&Z.c(),o&&o.c(),M=Ir(),this.h()},l(B){x=Jn(B,"DIV",{class:!0}),xr(x).forEach(Xt),g=vr(B),Z&&Z.l(B),o&&o.l(B),M=Ir(),this.h()},h(){wn(x,"class","mdc-icon-button__ripple")},m(B,ce){Ni(B,x,ce),Ni(B,g,ce),Z&&Z.m(B,ce),o&&o.m(B,ce),Ni(B,M,ce),P=!0},p(B,ce){Z&&Z.p&&(!P||ce[1]&64)&&pc(Z,N,B,B[37],P?_c(N,B[37],ce,null):mc(B[37]),null),B[8]?o||(o=u0(),o.c(),o.m(M.parentNode,M)):o&&(o.d(1),o=null)},i(B){P||(xi(Z,B),P=!0)},o(B){wi(Z,B),P=!1},d(B){B&&Xt(x),B&&Xt(g),Z&&Z.d(B),o&&o.d(B),B&&Xt(M)}}}function jv(D){let x,g,M;const P=[{tag:D[14]},{use:[[C_,{ripple:D[4],unbounded:!0,color:D[5],disabled:!!D[29].disabled,addClass:D[26],removeClass:D[27],addStyle:D[28]}],D[22],...D[1]]},{class:Ps({[D[2]]:!0,"mdc-icon-button":!0,"mdc-icon-button--on":!D[23](D[0])&&D[0],"mdc-icon-button--touch":D[8],"mdc-icon-button--display-flex":D[9],"smui-icon-button--size-button":D[10]==="button","smui-icon-button--size-mini":D[10]==="mini","mdc-icon-button--reduced-size":D[10]==="mini"||D[10]==="button","mdc-card__action":D[24]==="card:action","mdc-card__action--icon":D[24]==="card:action","mdc-top-app-bar__navigation-icon":D[24]==="top-app-bar:navigation","mdc-top-app-bar__action-item":D[24]==="top-app-bar:action","mdc-snackbar__dismiss":D[24]==="snackbar:actions","mdc-data-table__pagination-button":D[24]==="data-table:pagination","mdc-data-table__sort-icon-button":D[24]==="data-table:sortable-header-cell","mdc-dialog__close":(D[24]==="dialog:header"||D[24]==="dialog:sheet")&&D[12]==="close",...D[18]})},{style:Object.entries(D[19]).map(h0).concat([D[3]]).join(" ")},{"aria-pressed":D[23](D[0])?null:D[0]?"true":"false"},{"aria-label":D[0]?D[6]:D[7]},{"data-aria-label-on":D[6]},{"data-aria-label-off":D[7]},{"aria-describedby":D[25]},{href:D[11]},D[21],D[20],D[29]];var N=D[13];function Z(o){let B={$$slots:{default:[Gv]},$$scope:{ctx:o}};for(let ce=0;ce<P.length;ce+=1)B=Qn(B,P[ce]);return{props:B}}return N&&(x=Xc(N,Z(D)),D[34](x),x.$on("click",D[35]),x.$on("click",D[36])),{c(){x&&Tn(x.$$.fragment),g=Ir()},l(o){x&&qn(x.$$.fragment,o),g=Ir()},m(o,B){x&&En(x,o,B),Ni(o,g,B),M=!0},p(o,B){const ce=B[0]&1073504255?hc(P,[B[0]&16384&&{tag:o[14]},B[0]&1010827314&&{use:[[C_,{ripple:o[4],unbounded:!0,color:o[5],disabled:!!o[29].disabled,addClass:o[26],removeClass:o[27],addStyle:o[28]}],o[22],...o[1]]},B[0]&25433861&&{class:Ps({[o[2]]:!0,"mdc-icon-button":!0,"mdc-icon-button--on":!o[23](o[0])&&o[0],"mdc-icon-button--touch":o[8],"mdc-icon-button--display-flex":o[9],"smui-icon-button--size-button":o[10]==="button","smui-icon-button--size-mini":o[10]==="mini","mdc-icon-button--reduced-size":o[10]==="mini"||o[10]==="button","mdc-card__action":o[24]==="card:action","mdc-card__action--icon":o[24]==="card:action","mdc-top-app-bar__navigation-icon":o[24]==="top-app-bar:navigation","mdc-top-app-bar__action-item":o[24]==="top-app-bar:action","mdc-snackbar__dismiss":o[24]==="snackbar:actions","mdc-data-table__pagination-button":o[24]==="data-table:pagination","mdc-data-table__sort-icon-button":o[24]==="data-table:sortable-header-cell","mdc-dialog__close":(o[24]==="dialog:header"||o[24]==="dialog:sheet")&&o[12]==="close",...o[18]})},B[0]&524296&&{style:Object.entries(o[19]).map(h0).concat([o[3]]).join(" ")},B[0]&8388609&&{"aria-pressed":o[23](o[0])?null:o[0]?"true":"false"},B[0]&193&&{"aria-label":o[0]?o[6]:o[7]},B[0]&64&&{"data-aria-label-on":o[6]},B[0]&128&&{"data-aria-label-off":o[7]},B[0]&33554432&&{"aria-describedby":o[25]},B[0]&2048&&{href:o[11]},B[0]&2097152&&ll(o[21]),B[0]&1048576&&ll(o[20]),B[0]&536870912&&ll(o[29])]):{};if(B[0]&256|B[1]&64&&(ce.$$scope={dirty:B,ctx:o}),B[0]&8192&&N!==(N=o[13])){if(x){Ru();const _e=x;wi(_e.$$.fragment,1,0,()=>{An(_e,1)}),zu()}N?(x=Xc(N,Z(o)),o[34](x),x.$on("click",o[35]),x.$on("click",o[36]),Tn(x.$$.fragment),xi(x.$$.fragment,1),En(x,g.parentNode,g)):x=null}else N&&x.$set(ce)},i(o){M||(x&&xi(x.$$.fragment,o),M=!0)},o(o){x&&wi(x.$$.fragment,o),M=!1},d(o){D[34](null),o&&Xt(g),x&&An(x,o)}}}const h0=([D,x])=>`${D}: ${x};`;function Wv(D,x,g){let M;const P=["use","class","style","ripple","color","toggle","pressed","ariaLabelOn","ariaLabelOff","touch","displayFlex","size","href","action","component","tag","getElement"];let N=Jo(x,P),{$$slots:Z={},$$scope:o}=x;const B=ku(Ou());let ce=()=>{};function _e(Bt){return Bt===ce}let{use:de=[]}=x,{class:Re=""}=x,{style:tt=""}=x,{ripple:Ce=!0}=x,{color:qe=void 0}=x,{toggle:rt=!1}=x,{pressed:Je=ce}=x,{ariaLabelOn:Qe=void 0}=x,{ariaLabelOff:Mt=void 0}=x,{touch:lt=!1}=x,{displayFlex:$e=!0}=x,{size:Wt="normal"}=x,{href:ti=void 0}=x,{action:Pi=void 0}=x,Ht,Ut,qt={},Ti={},ki={},fn=uc("SMUI:icon-button:context"),ii=uc("SMUI:icon-button:aria-describedby"),{component:Mn=Kc}=x,{tag:pn=Mn===Kc?ti==null?"button":"a":void 0}=x,nn=N.disabled;rd("SMUI:icon:context","icon-button");let Kt=null;Ly(()=>{Ut&&Ut.destroy()});function rn(Bt){return Bt in qt?qt[Bt]:hn().classList.contains(Bt)}function en(Bt){qt[Bt]||g(18,qt[Bt]=!0,qt)}function Wr(Bt){(!(Bt in qt)||qt[Bt])&&g(18,qt[Bt]=!1,qt)}function or(Bt,Oi){Ti[Bt]!=Oi&&(Oi===""||Oi==null?(delete Ti[Bt],g(19,Ti)):g(19,Ti[Bt]=Oi,Ti))}function Zn(Bt){var Oi;return Bt in ki?(Oi=ki[Bt])!==null&&Oi!==void 0?Oi:null:hn().getAttribute(Bt)}function no(Bt,Oi){ki[Bt]!==Oi&&g(20,ki[Bt]=Oi,ki)}function Rr(Bt){g(0,Je=Bt.isOn)}function hn(){return Ht.getElement()}function fi(Bt){dc[Bt?"unshift":"push"](()=>{Ht=Bt,g(16,Ht)})}const Yr=()=>Ut&&Ut.handleClick(),zr=()=>fn==="top-app-bar:navigation"&&I_(hn(),"SMUITopAppBarIconButton:nav");return D.$$set=Bt=>{x=Qn(Qn({},x),$c(Bt)),g(29,N=Jo(x,P)),"use"in Bt&&g(1,de=Bt.use),"class"in Bt&&g(2,Re=Bt.class),"style"in Bt&&g(3,tt=Bt.style),"ripple"in Bt&&g(4,Ce=Bt.ripple),"color"in Bt&&g(5,qe=Bt.color),"toggle"in Bt&&g(30,rt=Bt.toggle),"pressed"in Bt&&g(0,Je=Bt.pressed),"ariaLabelOn"in Bt&&g(6,Qe=Bt.ariaLabelOn),"ariaLabelOff"in Bt&&g(7,Mt=Bt.ariaLabelOff),"touch"in Bt&&g(8,lt=Bt.touch),"displayFlex"in Bt&&g(9,$e=Bt.displayFlex),"size"in Bt&&g(10,Wt=Bt.size),"href"in Bt&&g(11,ti=Bt.href),"action"in Bt&&g(12,Pi=Bt.action),"component"in Bt&&g(13,Mn=Bt.component),"tag"in Bt&&g(14,pn=Bt.tag),"$$scope"in Bt&&g(37,o=Bt.$$scope)},D.$$.update=()=>{if(D.$$.dirty[0]&4096&&g(21,M=(()=>{if(fn==="data-table:pagination")switch(Pi){case"first-page":return{"data-first-page":"true"};case"prev-page":return{"data-prev-page":"true"};case"next-page":return{"data-next-page":"true"};case"last-page":return{"data-last-page":"true"};default:return{"data-action":"true"}}else return fn==="dialog:header"||fn==="dialog:sheet"?{"data-mdc-dialog-action":Pi}:{action:Pi}})()),nn!==N.disabled){const Bt=hn();"blur"in Bt&&Bt.blur(),g(31,nn=N.disabled)}D.$$.dirty[0]&1073938432|D.$$.dirty[1]&2&&Ht&&hn()&&rt!==Kt&&(rt&&!Ut?(g(17,Ut=new Uv({addClass:en,hasClass:rn,notifyChange:Bt=>{Rr(Bt),I_(hn(),"SMUIIconButtonToggle:change",Bt,void 0,!0)},removeClass:Wr,getAttr:Zn,setAttr:no})),Ut.init()):!rt&&Ut&&(Ut.destroy(),g(17,Ut=void 0),g(18,qt={}),g(20,ki={})),g(32,Kt=rt)),D.$$.dirty[0]&131073&&Ut&&!_e(Je)&&Ut.isOn()!==Je&&Ut.toggle(Je)},[Je,de,Re,tt,Ce,qe,Qe,Mt,lt,$e,Wt,ti,Pi,Mn,pn,hn,Ht,Ut,qt,Ti,ki,M,B,_e,fn,ii,en,Wr,or,N,rt,nn,Kt,Z,fi,Yr,zr,o]}class L_ extends Os{constructor(x){super(),Rs(this,x,Wv,jv,Qo,{use:1,class:2,style:3,ripple:4,color:5,toggle:30,pressed:0,ariaLabelOn:6,ariaLabelOff:7,touch:8,displayFlex:9,size:10,href:11,action:12,component:13,tag:14,getElement:15},null,[-1,-1])}get getElement(){return this.$$.ctx[15]}}function T0(D){const x=D-1;return x*x*x+1}function qv(D){return--D*D*D*D*D+1}function Zv(D,x){var g={};for(var M in D)Object.prototype.hasOwnProperty.call(D,M)&&x.indexOf(M)<0&&(g[M]=D[M]);if(D!=null&&typeof Object.getOwnPropertySymbols=="function")for(var P=0,M=Object.getOwnPropertySymbols(D);P<M.length;P++)x.indexOf(M[P])<0&&Object.prototype.propertyIsEnumerable.call(D,M[P])&&(g[M[P]]=D[M[P]]);return g}function Hv(D){var{fallback:x}=D,g=Zv(D,["fallback"]);const M=new Map,P=new Map;function N(o,B,ce){const{delay:_e=0,duration:de=ti=>Math.sqrt(ti)*30,easing:Re=T0}=Qn(Qn({},g),ce),tt=o.getBoundingClientRect(),Ce=B.getBoundingClientRect(),qe=tt.left-Ce.left,rt=tt.top-Ce.top,Je=tt.width/Ce.width,Qe=tt.height/Ce.height,Mt=Math.sqrt(qe*qe+rt*rt),lt=getComputedStyle(B),$e=lt.transform==="none"?"":lt.transform,Wt=+lt.opacity;return{delay:_e,duration:od(de)?de(Mt):de,easing:Re,css:(ti,Pi)=>`
				opacity: ${ti*Wt};
				transform-origin: top left;
				transform: ${$e} translate(${Pi*qe}px,${Pi*rt}px) scale(${ti+(1-ti)*Je}, ${ti+(1-ti)*Qe});
			`}}function Z(o,B,ce){return(_e,de)=>(o.set(de.key,_e),()=>{if(B.has(de.key)){const Re=B.get(de.key);return B.delete(de.key),N(Re,_e,de)}return o.delete(de.key),x&&x(_e,de,ce)})}return[Z(P,M,!1),Z(M,P,!0)]}function $v(D,{from:x,to:g},M={}){const P=getComputedStyle(D),N=P.transform==="none"?"":P.transform,[Z,o]=P.transformOrigin.split(" ").map(parseFloat),B=x.left+x.width*Z/g.width-(g.left+Z),ce=x.top+x.height*o/g.height-(g.top+o),{delay:_e=0,duration:de=tt=>Math.sqrt(tt)*120,easing:Re=T0}=M;return{delay:_e,duration:od(de)?de(Math.sqrt(B*B+ce*ce)):de,easing:Re,css:(tt,Ce)=>{const qe=Ce*B,rt=Ce*ce,Je=tt+Ce*x.width/g.width,Qe=tt+Ce*x.height/g.height;return`transform: ${N} translate(${qe}px, ${rt}px) scale(${Je}, ${Qe});`}}}function d0(D,x,g){const M=D.slice();return M[15]=x[g],M[17]=g,M}const Xv=D=>({item:D&1,index:D&1}),f0=D=>({item:D[15],index:D[17]});function p0(D){let x,g=[],M=new Map,P,N=D[0];const Z=o=>o[8](o[15]);for(let o=0;o<N.length;o+=1){let B=d0(D,N,o),ce=Z(B);M.set(ce,g[o]=m0(ce,B))}return{c(){x=Yn("ul");for(let o=0;o<g.length;o+=1)g[o].c();this.h()},l(o){x=Jn(o,"UL",{class:!0});var B=xr(x);for(let ce=0;ce<g.length;ce+=1)g[ce].l(B);B.forEach(Xt),this.h()},h(){wn(x,"class","svelte-s1iyrp")},m(o,B){Ni(o,x,B);for(let ce=0;ce<g.length;ce+=1)g[ce]&&g[ce].m(x,null);P=!0},p(o,B){if(B&1523){N=o[0],Ru();for(let ce=0;ce<g.length;ce+=1)g[ce].r();g=z0(g,B,Z,1,o,N,M,x,G0,m0,null,d0);for(let ce=0;ce<g.length;ce+=1)g[ce].a();zu()}},i(o){if(!P){for(let B=0;B<N.length;B+=1)xi(g[B]);P=!0}},o(o){for(let B=0;B<g.length;B+=1)wi(g[B]);P=!1},d(o){o&&Xt(x);for(let B=0;B<g.length;B+=1)g[B].d()}}}function Kv(D){let x,g=D[8](D[15])+"",M;return{c(){x=Yn("p"),M=Oa(g)},l(P){x=Jn(P,"P",{});var N=xr(x);M=Ra(N,g),N.forEach(Xt)},m(P,N){Ni(P,x,N),bn(x,M)},p(P,N){N&1&&g!==(g=P[8](P[15])+"")&&Py(M,g)},d(P){P&&Xt(x)}}}function m0(D,x){let g,M,P,N,Z,o,B,ce=Nl,_e,de,Re;const tt=x[11].default,Ce=fc(tt,x,x[10],f0),qe=Ce||Kv(x);return{key:D,first:null,c(){g=Yn("li"),qe&&qe.c(),M=yr(),this.h()},l(rt){g=Jn(rt,"LI",{"data-index":!0,"data-id":!0,draggable:!0,class:!0});var Je=xr(g);qe&&qe.l(Je),M=vr(Je),Je.forEach(Xt),this.h()},h(){wn(g,"data-index",P=x[17]),wn(g,"data-id",N=JSON.stringify(x[8](x[15]))),wn(g,"draggable","true"),wn(g,"class","svelte-s1iyrp"),Ky(g,"over",x[8](x[15])===x[1]),this.first=g},m(rt,Je){Ni(rt,g,Je),qe&&qe.m(g,null),bn(g,M),_e=!0,de||(Re=[id(g,"dragstart",x[4]),id(g,"dragover",x[5]),id(g,"dragleave",x[6]),id(g,"drop",x[7])],de=!0)},p(rt,Je){x=rt,Ce?Ce.p&&(!_e||Je&1025)&&pc(Ce,tt,x,x[10],_e?_c(tt,x[10],Je,Xv):mc(x[10]),f0):qe&&qe.p&&(!_e||Je&1)&&qe.p(x,_e?Je:-1),(!_e||Je&1&&P!==(P=x[17]))&&wn(g,"data-index",P),(!_e||Je&1&&N!==(N=JSON.stringify(x[8](x[15]))))&&wn(g,"data-id",N),(!_e||Je&259)&&Ky(g,"over",x[8](x[15])===x[1])},r(){B=g.getBoundingClientRect()},f(){k0(g),ce(),B0(g,B)},a(){ce(),ce=F0(g,B,$v,{duration:300})},i(rt){_e||(xi(qe,rt),N0(()=>{_e&&(o&&o.end(1),Z=U0(g,x[3],{key:x[8](x[15])}),Z.start())}),_e=!0)},o(rt){wi(qe,rt),Z&&Z.invalidate(),o=V0(g,x[2],{key:x[8](x[15])}),_e=!1},d(rt){rt&&Xt(g),qe&&qe.d(rt),rt&&o&&o.end(),de=!1,xf(Re)}}}function Yv(D){let x,g,M=D[0]&&D[0].length&&p0(D);return{c(){M&&M.c(),x=Ir()},l(P){M&&M.l(P),x=Ir()},m(P,N){M&&M.m(P,N),Ni(P,x,N),g=!0},p(P,[N]){P[0]&&P[0].length?M?(M.p(P,N),N&1&&xi(M,1)):(M=p0(P),M.c(),xi(M,1),M.m(x.parentNode,x)):M&&(Ru(),wi(M,1,1,()=>{M=null}),zu())},i(P){g||(xi(M),g=!0)},o(P){wi(M),g=!1},d(P){M&&M.d(P),P&&Xt(x)}}}function Jv(D,x,g){let{$$slots:M={},$$scope:P}=x;const[N,Z]=Hv({duration:Qe=>Math.sqrt(Qe*200),fallback(Qe,Mt){const lt=getComputedStyle(Qe),$e=lt.transform==="none"?"":lt.transform;return{duration:600,easing:qv,css:Wt=>`
					transform: ${$e} scale(${Wt});
					opacity: ${Wt}
				`}}});let o=!1;const B=Qe=>Qe.dataset.index&&Qe.dataset||B(Qe.parentNode),ce=Qe=>{Qe.dataTransfer.setData("source",Qe.target.dataset.index)},_e=Qe=>{Qe.preventDefault();let Mt=B(Qe.target);o!==Mt.id&&g(1,o=JSON.parse(Mt.id))},de=Qe=>{let Mt=B(Qe.target);o===Mt.id&&g(1,o=!1)},Re=Qe=>{g(1,o=!1),Qe.preventDefault();let Mt=B(Qe.target),lt=Qe.dataTransfer.getData("source"),$e=Mt.index;Ce({from:lt,to:$e})},tt=y0(),Ce=({from:Qe,to:Mt})=>{let lt=[...rt];lt[Qe]=[lt[Mt],lt[Mt]=lt[Qe]][0],tt("sort",lt)},qe=Qe=>Je?Qe[Je]:Qe;let{list:rt}=x,{key:Je}=x;return D.$$set=Qe=>{"list"in Qe&&g(0,rt=Qe.list),"key"in Qe&&g(9,Je=Qe.key),"$$scope"in Qe&&g(10,P=Qe.$$scope)},[rt,o,N,Z,ce,_e,de,Re,qe,Je,P,M]}class Qv extends Os{constructor(x){super(),Rs(this,x,Jv,Yv,Qo,{list:0,key:9})}}var vf={},ex={get exports(){return vf},set exports(D){vf=D}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(D,x){(function(){var g,M="4.17.21",P=200,N="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",Z="Expected a function",o="Invalid `variable` option passed into `_.template`",B="__lodash_hash_undefined__",ce=500,_e="__lodash_placeholder__",de=1,Re=2,tt=4,Ce=1,qe=2,rt=1,Je=2,Qe=4,Mt=8,lt=16,$e=32,Wt=64,ti=128,Pi=256,Ht=512,Ut=30,qt="...",Ti=800,ki=16,fn=1,ii=2,Mn=3,pn=1/0,nn=9007199254740991,Kt=17976931348623157e292,rn=0/0,en=4294967295,Wr=en-1,or=en>>>1,Zn=[["ary",ti],["bind",rt],["bindKey",Je],["curry",Mt],["curryRight",lt],["flip",Ht],["partial",$e],["partialRight",Wt],["rearg",Pi]],no="[object Arguments]",Rr="[object Array]",hn="[object AsyncFunction]",fi="[object Boolean]",Yr="[object Date]",zr="[object DOMException]",Bt="[object Error]",Oi="[object Function]",ro="[object GeneratorFunction]",Gt="[object Map]",Cr="[object Number]",kr="[object Null]",oo="[object Object]",Wo="[object Promise]",ka="[object Proxy]",tn="[object RegExp]",dr="[object Set]",Br="[object String]",Le="[object Symbol]",ri="[object Undefined]",br="[object WeakMap]",zs="[object WeakSet]",Jr="[object ArrayBuffer]",vo="[object DataView]",es="[object Float32Array]",ts="[object Float64Array]",so="[object Int8Array]",Ba="[object Int16Array]",ao="[object Int32Array]",is="[object Uint8Array]",qo="[object Uint8ClampedArray]",ks="[object Uint16Array]",ns="[object Uint32Array]",qr=/\b__p \+= '';/g,Bs=/\b(__p \+=) '' \+/g,Fa=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Io=/&(?:amp|lt|gt|quot|#39);/g,aa=/[&<>"']/g,gc=RegExp(Io.source),yc=RegExp(aa.source),Fs=/<%-([\s\S]+?)%>/g,Na=/<%([\s\S]+?)%>/g,Qr=/<%=([\s\S]+?)%>/g,la=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,lo=/^\w*$/,ca=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ne=/[\\^$.*+?()[\]{}|]/g,V=RegExp(ne.source),j=/^\s+/,ie=/\s/,ue=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,be=/\{\n\/\* \[wrapped with (.+)\] \*/,ze=/,? & /,Me=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ae=/[()=,{}\[\]\/\s]/,Ue=/\\(\\)?/g,ht=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Dt=/\w*$/,yt=/^[-+]0x[0-9a-f]+$/i,ni=/^0b[01]+$/i,Jt=/^\[object .+?Constructor\]$/,Qt=/^0o[0-7]+$/i,ai=/^(?:0|[1-9]\d*)$/,oi=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Hi=/($^)/,li=/['\n\r\u2028\u2029\\]/g,Vi="\\ud800-\\udfff",Wi="\\u0300-\\u036f",rs="\\ufe20-\\ufe2f",co="\\u20d0-\\u20ff",Ye=Wi+rs+co,os="\\u2700-\\u27bf",sr="a-z\\xdf-\\xf6\\xf8-\\xff",ua="\\xac\\xb1\\xd7\\xf7",Bu="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ss="\\u2000-\\u206f",Ns=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Yc="A-Z\\xc0-\\xd6\\xd8-\\xde",ha="\\ufe0e\\ufe0f",At=ua+Bu+ss+Ns,Bi="[']",Ui="["+Vi+"]",xo="["+At+"]",T="["+Ye+"]",C="\\d+",H="["+os+"]",he="["+sr+"]",Ee="[^"+Vi+At+C+os+sr+Yc+"]",Te="\\ud83c[\\udffb-\\udfff]",Ie="(?:"+T+"|"+Te+")",wt="[^"+Vi+"]",xt="(?:\\ud83c[\\udde6-\\uddff]){2}",Ft="[\\ud800-\\udbff][\\udc00-\\udfff]",St="["+Yc+"]",Lt="\\u200d",_i="(?:"+he+"|"+Ee+")",kn="(?:"+St+"|"+Ee+")",gi="(?:"+Bi+"(?:d|ll|m|re|s|t|ve))?",Gn="(?:"+Bi+"(?:D|LL|M|RE|S|T|VE))?",dt=Ie+"?",Nt="["+ha+"]?",bi="(?:"+Lt+"(?:"+[wt,xt,Ft].join("|")+")"+Nt+dt+")*",fr="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",er="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Zr=Nt+dt+bi,uo="(?:"+[H,xt,Ft].join("|")+")"+Zr,jn="(?:"+[wt+T+"?",T,xt,Ft,Ui].join("|")+")",Ul=RegExp(Bi,"g"),wr=RegExp(T,"g"),ho=RegExp(Te+"(?="+Te+")|"+jn+Zr,"g"),vc=RegExp([St+"?"+he+"+"+gi+"(?="+[xo,St,"$"].join("|")+")",kn+"+"+Gn+"(?="+[xo,St+_i,"$"].join("|")+")",St+"?"+_i+"+"+gi,St+"+"+Gn,er,fr,C,uo].join("|"),"g"),cl=RegExp("["+Lt+Vi+Ye+ha+"]"),Fr=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ul=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ua=-1,ln={};ln[es]=ln[ts]=ln[so]=ln[Ba]=ln[ao]=ln[is]=ln[qo]=ln[ks]=ln[ns]=!0,ln[no]=ln[Rr]=ln[Jr]=ln[fi]=ln[vo]=ln[Yr]=ln[Bt]=ln[Oi]=ln[Gt]=ln[Cr]=ln[oo]=ln[tn]=ln[dr]=ln[Br]=ln[br]=!1;var Sn={};Sn[no]=Sn[Rr]=Sn[Jr]=Sn[vo]=Sn[fi]=Sn[Yr]=Sn[es]=Sn[ts]=Sn[so]=Sn[Ba]=Sn[ao]=Sn[Gt]=Sn[Cr]=Sn[oo]=Sn[tn]=Sn[dr]=Sn[Br]=Sn[Le]=Sn[is]=Sn[qo]=Sn[ks]=Sn[ns]=!0,Sn[Bt]=Sn[Oi]=Sn[br]=!1;var xc={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},dh={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},bc={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},Va={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Jc=parseFloat,Vl=parseInt,Ga=typeof cc=="object"&&cc&&cc.Object===Object&&cc,as=typeof self=="object"&&self&&self.Object===Object&&self,ar=Ga||as||Function("return this")(),ls=x&&!x.nodeType&&x,Bn=ls&&!0&&D&&!D.nodeType&&D,ja=Bn&&Bn.exports===ls,Gl=ja&&Ga.process,Co=function(){try{var De=Bn&&Bn.require&&Bn.require("util").types;return De||Gl&&Gl.binding&&Gl.binding("util")}catch{}}(),hl=Co&&Co.isArrayBuffer,dl=Co&&Co.isDate,jl=Co&&Co.isMap,Wl=Co&&Co.isRegExp,Wa=Co&&Co.isSet,Us=Co&&Co.isTypedArray;function Hr(De,ot,et){switch(et.length){case 0:return De.call(ot);case 1:return De.call(ot,et[0]);case 2:return De.call(ot,et[0],et[1]);case 3:return De.call(ot,et[0],et[1],et[2])}return De.apply(ot,et)}function wc(De,ot,et,Zt){for(var yi=-1,on=De==null?0:De.length;++yi<on;){var lr=De[yi];ot(Zt,lr,et(lr),De)}return Zt}function bo(De,ot){for(var et=-1,Zt=De==null?0:De.length;++et<Zt&&ot(De[et],et,De)!==!1;);return De}function Vs(De,ot){for(var et=De==null?0:De.length;et--&&ot(De[et],et,De)!==!1;);return De}function $i(De,ot){for(var et=-1,Zt=De==null?0:De.length;++et<Zt;)if(!ot(De[et],et,De))return!1;return!0}function wo(De,ot){for(var et=-1,Zt=De==null?0:De.length,yi=0,on=[];++et<Zt;){var lr=De[et];ot(lr,et,De)&&(on[yi++]=lr)}return on}function da(De,ot){var et=De==null?0:De.length;return!!et&&Ei(De,ot,0)>-1}function Gs(De,ot,et){for(var Zt=-1,yi=De==null?0:De.length;++Zt<yi;)if(et(ot,De[Zt]))return!0;return!1}function mn(De,ot){for(var et=-1,Zt=De==null?0:De.length,yi=Array(Zt);++et<Zt;)yi[et]=ot(De[et],et,De);return yi}function cs(De,ot){for(var et=-1,Zt=ot.length,yi=De.length;++et<Zt;)De[yi+et]=ot[et];return De}function fl(De,ot,et,Zt){var yi=-1,on=De==null?0:De.length;for(Zt&&on&&(et=De[++yi]);++yi<on;)et=ot(et,De[yi],yi,De);return et}function Qc(De,ot,et,Zt){var yi=De==null?0:De.length;for(Zt&&yi&&(et=De[--yi]);yi--;)et=ot(et,De[yi],yi,De);return et}function pl(De,ot){for(var et=-1,Zt=De==null?0:De.length;++et<Zt;)if(ot(De[et],et,De))return!0;return!1}var eu=pa("length");function js(De){return De.split("")}function Ws(De){return De.match(Me)||[]}function us(De,ot,et){var Zt;return et(De,function(yi,on,lr){if(ot(yi,on,lr))return Zt=on,!1}),Zt}function To(De,ot,et,Zt){for(var yi=De.length,on=et+(Zt?1:-1);Zt?on--:++on<yi;)if(ot(De[on],on,De))return on;return-1}function Ei(De,ot,et){return ot===ot?Pt(De,ot,et):To(De,_s,et)}function fa(De,ot,et,Zt){for(var yi=et-1,on=De.length;++yi<on;)if(Zt(De[yi],ot))return yi;return-1}function _s(De){return De!==De}function tu(De,ot){var et=De==null?0:De.length;return et?nu(De,ot)/et:rn}function pa(De){return function(ot){return ot==null?g:ot[De]}}function qs(De){return function(ot){return De==null?g:De[ot]}}function ql(De,ot,et,Zt,yi){return yi(De,function(on,lr,Dn){et=Zt?(Zt=!1,on):ot(et,on,lr,Dn)}),et}function iu(De,ot){var et=De.length;for(De.sort(ot);et--;)De[et]=De[et].value;return De}function nu(De,ot){for(var et,Zt=-1,yi=De.length;++Zt<yi;){var on=ot(De[Zt]);on!==g&&(et=et===g?on:et+on)}return et}function ml(De,ot){for(var et=-1,Zt=Array(De);++et<De;)Zt[et]=ot(et);return Zt}function Tc(De,ot){return mn(ot,function(et){return[et,De[et]]})}function _l(De){return De&&De.slice(0,Hn(De)+1).replace(j,"")}function Mr(De){return function(ot){return De(ot)}}function Zs(De,ot){return mn(ot,function(et){return De[et]})}function gl(De,ot){return De.has(ot)}function Hs(De,ot){for(var et=-1,Zt=De.length;++et<Zt&&Ei(ot,De[et],0)>-1;);return et}function yl(De,ot){for(var et=De.length;et--&&Ei(ot,De[et],0)>-1;);return et}function hs(De,ot){for(var et=De.length,Zt=0;et--;)De[et]===ot&&++Zt;return Zt}var ru=qs(xc),Zl=qs(dh);function vl(De){return"\\"+Va[De]}function Zo(De,ot){return De==null?g:De[ot]}function $s(De){return cl.test(De)}function ou(De){return Fr.test(De)}function Hl(De){for(var ot,et=[];!(ot=De.next()).done;)et.push(ot.value);return et}function Xs(De){var ot=-1,et=Array(De.size);return De.forEach(function(Zt,yi){et[++ot]=[yi,Zt]}),et}function xl(De,ot){return function(et){return De(ot(et))}}function ma(De,ot){for(var et=-1,Zt=De.length,yi=0,on=[];++et<Zt;){var lr=De[et];(lr===ot||lr===_e)&&(De[et]=_e,on[yi++]=et)}return on}function Pe(De){var ot=-1,et=Array(De.size);return De.forEach(function(Zt){et[++ot]=Zt}),et}function it(De){var ot=-1,et=Array(De.size);return De.forEach(function(Zt){et[++ot]=[Zt,Zt]}),et}function Pt(De,ot,et){for(var Zt=et-1,yi=De.length;++Zt<yi;)if(De[Zt]===ot)return Zt;return-1}function ci(De,ot,et){for(var Zt=et+1;Zt--;)if(De[Zt]===ot)return Zt;return Zt}function _n(De){return $s(De)?$r(De):eu(De)}function Di(De){return $s(De)?Er(De):js(De)}function Hn(De){for(var ot=De.length;ot--&&ie.test(De.charAt(ot)););return ot}var Tr=qs(bc);function $r(De){for(var ot=ho.lastIndex=0;ho.test(De);)++ot;return ot}function Er(De){return De.match(ho)||[]}function pr(De){return De.match(vc)||[]}var ds=function De(ot){ot=ot==null?ar:Dr.defaults(ar.Object(),ot,Dr.pick(ar,ul));var et=ot.Array,Zt=ot.Date,yi=ot.Error,on=ot.Function,lr=ot.Math,Dn=ot.Object,Ec=ot.RegExp,On=ot.String,Gi=ot.TypeError,Ks=et.prototype,fo=on.prototype,Mo=Dn.prototype,Lr=ot["__core-js_shared__"],Xr=fo.toString,ji=Mo.hasOwnProperty,Do=0,_a=function(){var l=/[^.]+$/.exec(Lr&&Lr.keys&&Lr.keys.IE_PROTO||"");return l?"Symbol(src)_1."+l:""}(),Ci=Mo.toString,gs=Xr.call(Dn),Fu=ar._,bl=Ec("^"+Xr.call(ji).replace(ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ys=ja?ot.Buffer:g,Lo=ot.Symbol,ga=ot.Uint8Array,wl=ys?ys.allocUnsafe:g,ya=xl(Dn.getPrototypeOf,Dn),va=Dn.create,$l=Mo.propertyIsEnumerable,qa=Ks.splice,su=Lo?Lo.isConcatSpreadable:g,Ys=Lo?Lo.iterator:g,fs=Lo?Lo.toStringTag:g,Tl=function(){try{var l=Ur(Dn,"defineProperty");return l({},"",{}),l}catch{}}(),au=ot.clearTimeout!==ar.clearTimeout&&ot.clearTimeout,Ot=Zt&&Zt.now!==ar.Date.now&&Zt.now,vs=ot.setTimeout!==ar.setTimeout&&ot.setTimeout,lu=lr.ceil,Ac=lr.floor,Xl=Dn.getOwnPropertySymbols,Sc=ys?ys.isBuffer:g,fh=ot.isFinite,Nu=Ks.join,ph=xl(Dn.keys,Dn),Ar=lr.max,Nr=lr.min,cu=Zt.now,eo=ot.parseInt,uu=lr.random,bf=Ks.reverse,Uu=Ur(ot,"DataView"),El=Ur(ot,"Map"),hu=Ur(ot,"Promise"),Za=Ur(ot,"Set"),Ic=Ur(ot,"WeakMap"),xa=Ur(Dn,"create"),Cc=Ic&&new Ic,Kl={},Vu=wu(Uu),sd=wu(El),mh=wu(hu),_h=wu(Za),Mc=wu(Ic),Yl=Lo?Lo.prototype:g,Ha=Yl?Yl.valueOf:g,gh=Yl?Yl.toString:g;function K(l){if(hr(l)&&!Fi(l)&&!(l instanceof Ai)){if(l instanceof Po)return l;if(ji.call(l,"__wrapped__"))return Pd(l)}return new Po(l)}var Al=function(){function l(){}return function(f){if(!tr(f))return{};if(va)return va(f);l.prototype=f;var w=new l;return l.prototype=g,w}}();function du(){}function Po(l,f){this.__wrapped__=l,this.__actions__=[],this.__chain__=!!f,this.__index__=0,this.__values__=g}K.templateSettings={escape:Fs,evaluate:Na,interpolate:Qr,variable:"",imports:{_:K}},K.prototype=du.prototype,K.prototype.constructor=K,Po.prototype=Al(du.prototype),Po.prototype.constructor=Po;function Ai(l){this.__wrapped__=l,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=en,this.__views__=[]}function wf(){var l=new Ai(this.__wrapped__);return l.__actions__=_o(this.__actions__),l.__dir__=this.__dir__,l.__filtered__=this.__filtered__,l.__iteratees__=_o(this.__iteratees__),l.__takeCount__=this.__takeCount__,l.__views__=_o(this.__views__),l}function ad(){if(this.__filtered__){var l=new Ai(this);l.__dir__=-1,l.__filtered__=!0}else l=this.clone(),l.__dir__*=-1;return l}function Tf(){var l=this.__wrapped__.value(),f=this.__dir__,w=Fi(l),z=f<0,q=w?l.length:0,te=Lh(0,q,this.__views__),me=te.start,Se=te.end,Fe=Se-me,ft=z?Se:me-1,_t=this.__iteratees__,Et=_t.length,jt=0,ui=Nr(Fe,this.__takeCount__);if(!w||!z&&q==Fe&&ui==Fe)return Oc(l,this.__actions__);var Mi=[];e:for(;Fe--&&jt<ui;){ft+=f;for(var Yi=-1,Li=l[ft];++Yi<Et;){var cn=_t[Yi],gn=cn.iteratee,Ms=cn.type,Ko=gn(Li);if(Ms==ii)Li=Ko;else if(!Ko){if(Ms==fn)continue e;break e}}Mi[jt++]=Li}return Mi}Ai.prototype=Al(du.prototype),Ai.prototype.constructor=Ai;function Sl(l){var f=-1,w=l==null?0:l.length;for(this.clear();++f<w;){var z=l[f];this.set(z[0],z[1])}}function $a(){this.__data__=xa?xa(null):{},this.size=0}function ld(l){var f=this.has(l)&&delete this.__data__[l];return this.size-=f?1:0,f}function Dc(l){var f=this.__data__;if(xa){var w=f[l];return w===B?g:w}return ji.call(f,l)?f[l]:g}function ba(l){var f=this.__data__;return xa?f[l]!==g:ji.call(f,l)}function Gu(l,f){var w=this.__data__;return this.size+=this.has(l)?0:1,w[l]=xa&&f===g?B:f,this}Sl.prototype.clear=$a,Sl.prototype.delete=ld,Sl.prototype.get=Dc,Sl.prototype.has=ba,Sl.prototype.set=Gu;function Rt(l){var f=-1,w=l==null?0:l.length;for(this.clear();++f<w;){var z=l[f];this.set(z[0],z[1])}}function cd(){this.__data__=[],this.size=0}function fu(l){var f=this.__data__,w=Cl(f,l);if(w<0)return!1;var z=f.length-1;return w==z?f.pop():qa.call(f,w,1),--this.size,!0}function pu(l){var f=this.__data__,w=Cl(f,l);return w<0?g:f[w][1]}function mu(l){return Cl(this.__data__,l)>-1}function _u(l,f){var w=this.__data__,z=Cl(w,l);return z<0?(++this.size,w.push([l,f])):w[z][1]=f,this}Rt.prototype.clear=cd,Rt.prototype.delete=fu,Rt.prototype.get=pu,Rt.prototype.has=mu,Rt.prototype.set=_u;function wa(l){var f=-1,w=l==null?0:l.length;for(this.clear();++f<w;){var z=l[f];this.set(z[0],z[1])}}function yh(){this.size=0,this.__data__={hash:new Sl,map:new(El||Rt),string:new Sl}}function ud(l){var f=Ho(this,l).delete(l);return this.size-=f?1:0,f}function vh(l){return Ho(this,l).get(l)}function xh(l){return Ho(this,l).has(l)}function gu(l,f){var w=Ho(this,l),z=w.size;return w.set(l,f),this.size+=w.size==z?0:1,this}wa.prototype.clear=yh,wa.prototype.delete=ud,wa.prototype.get=vh,wa.prototype.has=xh,wa.prototype.set=gu;function Ta(l){var f=-1,w=l==null?0:l.length;for(this.__data__=new wa;++f<w;)this.add(l[f])}function Lc(l){return this.__data__.set(l,B),this}function ju(l){return this.__data__.has(l)}Ta.prototype.add=Ta.prototype.push=Lc,Ta.prototype.has=ju;function xs(l){var f=this.__data__=new Rt(l);this.size=f.size}function hd(){this.__data__=new Rt,this.size=0}function bh(l){var f=this.__data__,w=f.delete(l);return this.size=f.size,w}function dd(l){return this.__data__.get(l)}function fd(l){return this.__data__.has(l)}function pd(l,f){var w=this.__data__;if(w instanceof Rt){var z=w.__data__;if(!El||z.length<P-1)return z.push([l,f]),this.size=++w.size,this;w=this.__data__=new wa(z)}return w.set(l,f),this.size=w.size,this}xs.prototype.clear=hd,xs.prototype.delete=bh,xs.prototype.get=dd,xs.prototype.has=fd,xs.prototype.set=pd;function Wu(l,f){var w=Fi(l),z=!w&&Nc(l),q=!w&&!z&&rc(l),te=!w&&!z&&!q&&nh(l),me=w||z||q||te,Se=me?ml(l.length,On):[],Fe=Se.length;for(var ft in l)(f||ji.call(l,ft))&&!(me&&(ft=="length"||q&&(ft=="offset"||ft=="parent")||te&&(ft=="buffer"||ft=="byteLength"||ft=="byteOffset")||Ll(ft,Fe)))&&Se.push(ft);return Se}function wh(l){var f=l.length;return f?l[Ea(0,f-1)]:g}function md(l,f){return Ol(_o(l),_(f,0,l.length))}function _d(l){return Ol(_o(l))}function qu(l,f,w){(w!==g&&!al(l[f],w)||w===g&&!(f in l))&&h(l,f,w)}function Il(l,f,w){var z=l[f];(!(ji.call(l,f)&&al(z,w))||w===g&&!(f in l))&&h(l,f,w)}function Cl(l,f){for(var w=l.length;w--;)if(al(l[w][0],f))return w;return-1}function c(l,f,w,z){return U(l,function(q,te,me){f(z,q,w(q),me)}),z}function n(l,f){return l&&Eo(f,Pr(f),l)}function s(l,f){return l&&Eo(f,ps(f),l)}function h(l,f,w){f=="__proto__"&&Tl?Tl(l,f,{configurable:!0,enumerable:!0,value:w,writable:!0}):l[f]=w}function p(l,f){for(var w=-1,z=f.length,q=et(z),te=l==null;++w<z;)q[w]=te?g:sp(l,f[w]);return q}function _(l,f,w){return l===l&&(w!==g&&(l=l<=w?l:w),f!==g&&(l=l>=f?l:f)),l}function b(l,f,w,z,q,te){var me,Se=f&de,Fe=f&Re,ft=f&tt;if(w&&(me=q?w(l,z,q,te):w(l)),me!==g)return me;if(!tr(l))return l;var _t=Fi(l);if(_t){if(me=R_(l),!Se)return _o(l,me)}else{var Et=ko(l),jt=Et==Oi||Et==ro;if(rc(l))return Ah(l,Se);if(Et==oo||Et==no||jt&&!q){if(me=Fe||jt?{}:Lf(l),!Se)return Fe?zc(l,s(me,l)):Ya(l,n(me,l))}else{if(!Sn[Et])return q?l:{};me=Hp(l,Et,Se)}}te||(te=new xs);var ui=te.get(l);if(ui)return ui;te.set(l,me),rp(l)?l.forEach(function(Li){me.add(b(Li,f,w,Li,l,te))}):ip(l)&&l.forEach(function(Li,cn){me.set(cn,b(Li,f,w,cn,l,te))});var Mi=ft?Fe?il:Fc:Fe?ps:Pr,Yi=_t?g:Mi(l);return bo(Yi||l,function(Li,cn){Yi&&(cn=Li,Li=l[cn]),Il(me,cn,b(Li,f,w,cn,l,te))}),me}function E(l){var f=Pr(l);return function(w){return S(w,l,f)}}function S(l,f,w){var z=w.length;if(l==null)return!z;for(l=Dn(l);z--;){var q=w[z],te=f[q],me=l[q];if(me===g&&!(q in l)||!te(me))return!1}return!0}function O(l,f,w){if(typeof l!="function")throw new Gi(Z);return Xu(function(){l.apply(g,w)},f)}function R(l,f,w,z){var q=-1,te=da,me=!0,Se=l.length,Fe=[],ft=f.length;if(!Se)return Fe;w&&(f=mn(f,Mr(w))),z?(te=Gs,me=!1):f.length>=P&&(te=gl,me=!1,f=new Ta(f));e:for(;++q<Se;){var _t=l[q],Et=w==null?_t:w(_t);if(_t=z||_t!==0?_t:0,me&&Et===Et){for(var jt=ft;jt--;)if(f[jt]===Et)continue e;Fe.push(_t)}else te(f,Et,z)||Fe.push(_t)}return Fe}var U=Bp(le),$=Bp(ve,!0);function J(l,f){var w=!0;return U(l,function(z,q,te){return w=!!f(z,q,te),w}),w}function Y(l,f,w){for(var z=-1,q=l.length;++z<q;){var te=l[z],me=f(te);if(me!=null&&(Se===g?me===me&&!ia(me):w(me,Se)))var Se=me,Fe=te}return Fe}function Q(l,f,w,z){var q=l.length;for(w=Xi(w),w<0&&(w=-w>q?0:q+w),z=z===g||z>q?q:Xi(z),z<0&&(z+=q),z=w>z?0:qh(z);w<z;)l[w++]=f;return l}function ee(l,f){var w=[];return U(l,function(z,q,te){f(z,q,te)&&w.push(z)}),w}function W(l,f,w,z,q){var te=-1,me=l.length;for(w||(w=$p),q||(q=[]);++te<me;){var Se=l[te];f>0&&w(Se)?f>1?W(Se,f-1,w,z,q):cs(q,Se):z||(q[q.length]=Se)}return q}var ae=Fp(),oe=Fp(!0);function le(l,f){return l&&ae(l,f,Pr)}function ve(l,f){return l&&oe(l,f,Pr)}function ge(l,f){return wo(f,function(w){return kl(l[w])})}function we(l,f){f=Rc(f,l);for(var w=0,z=f.length;l!=null&&w<z;)l=l[ol(f[w++])];return w&&w==z?l:g}function ke(l,f,w){var z=f(l);return Fi(l)?z:cs(z,w(l))}function Be(l){return l==null?l===g?ri:kr:fs&&fs in Dn(l)?Sa(l):bu(l)}function je(l,f){return l>f}function Tt(l,f){return l!=null&&ji.call(l,f)}function Ne(l,f){return l!=null&&f in Dn(l)}function st(l,f,w){return l>=Nr(f,w)&&l<Ar(f,w)}function He(l,f,w){for(var z=w?Gs:da,q=l[0].length,te=l.length,me=te,Se=et(te),Fe=1/0,ft=[];me--;){var _t=l[me];me&&f&&(_t=mn(_t,Mr(f))),Fe=Nr(_t.length,Fe),Se[me]=!w&&(f||q>=120&&_t.length>=120)?new Ta(me&&_t):g}_t=l[0];var Et=-1,jt=Se[0];e:for(;++Et<q&&ft.length<Fe;){var ui=_t[Et],Mi=f?f(ui):ui;if(ui=w||ui!==0?ui:0,!(jt?gl(jt,Mi):z(ft,Mi,w))){for(me=te;--me;){var Yi=Se[me];if(!(Yi?gl(Yi,Mi):z(l[me],Mi,w)))continue e}jt&&jt.push(Mi),ft.push(ui)}}return ft}function mt(l,f,w,z){return le(l,function(q,te,me){f(z,w(q),te,me)}),z}function Ve(l,f,w){f=Rc(f,l),l=ea(l,f);var z=l==null?l:l[ol(Xn(f))];return z==null?g:Hr(z,l,w)}function Oe(l){return hr(l)&&Be(l)==no}function Ze(l){return hr(l)&&Be(l)==Jr}function ut(l){return hr(l)&&Be(l)==Yr}function pt(l,f,w,z,q){return l===f?!0:l==null||f==null||!hr(l)&&!hr(f)?l!==l&&f!==f:Yt(l,f,w,z,pt,q)}function Yt(l,f,w,z,q,te){var me=Fi(l),Se=Fi(f),Fe=me?Rr:ko(l),ft=Se?Rr:ko(f);Fe=Fe==no?oo:Fe,ft=ft==no?oo:ft;var _t=Fe==oo,Et=ft==oo,jt=Fe==ft;if(jt&&rc(l)){if(!rc(f))return!1;me=!0,_t=!1}if(jt&&!_t)return te||(te=new xs),me||nh(l)?Wp(l,f,w,z,q,te):Df(l,f,Fe,w,z,q,te);if(!(w&Ce)){var ui=_t&&ji.call(l,"__wrapped__"),Mi=Et&&ji.call(f,"__wrapped__");if(ui||Mi){var Yi=ui?l.value():l,Li=Mi?f.value():f;return te||(te=new xs),q(Yi,Li,w,z,te)}}return jt?(te||(te=new xs),qp(l,f,w,z,q,te)):!1}function zi(l){return hr(l)&&ko(l)==Gt}function Vt(l,f,w,z){var q=w.length,te=q,me=!z;if(l==null)return!te;for(l=Dn(l);q--;){var Se=w[q];if(me&&Se[2]?Se[1]!==l[Se[0]]:!(Se[0]in l))return!1}for(;++q<te;){Se=w[q];var Fe=Se[0],ft=l[Fe],_t=Se[1];if(me&&Se[2]){if(ft===g&&!(Fe in l))return!1}else{var Et=new xs;if(z)var jt=z(ft,_t,Fe,l,f,Et);if(!(jt===g?pt(_t,ft,Ce|qe,z,Et):jt))return!1}}return!0}function zt(l){if(!tr(l)||Xp(l))return!1;var f=kl(l)?bl:Jt;return f.test(wu(l))}function ei(l){return hr(l)&&Be(l)==tn}function qi(l){return hr(l)&&ko(l)==dr}function si(l){return hr(l)&&Uc(l.length)&&!!ln[Be(l)]}function dn(l){return typeof l=="function"?l:l==null?Cs:typeof l=="object"?Fi(l)?bs(l[0],l[1]):Oo(l):_p(l)}function xn(l){if(!ic(l))return ph(l);var f=[];for(var w in Dn(l))ji.call(l,w)&&w!="constructor"&&f.push(w);return f}function Fn(l){if(!tr(l))return Pl(l);var f=ic(l),w=[];for(var z in l)z=="constructor"&&(f||!ji.call(l,z))||w.push(z);return w}function In(l,f){return l<f}function Sr(l,f){var w=-1,z=Is(l)?et(l.length):[];return U(l,function(q,te,me){z[++w]=f(q,te,me)}),z}function Oo(l){var f=vu(l);return f.length==1&&f[0][2]?Md(f[0][0],f[0][1]):function(w){return w===l||Vt(w,l,f)}}function bs(l,f){return Id(l)&&Cd(f)?Md(ol(l),f):function(w){var z=sp(w,l);return z===g&&z===f?ap(w,l):pt(f,z,Ce|qe)}}function ws(l,f,w,z,q){l!==f&&ae(f,function(te,me){if(q||(q=new xs),tr(te))$n(l,f,me,w,ws,z,q);else{var Se=z?z(Rf(l,me),te,me+"",l,f,q):g;Se===g&&(Se=te),qu(l,me,Se)}},ps)}function $n(l,f,w,z,q,te,me){var Se=Rf(l,w),Fe=Rf(f,w),ft=me.get(Fe);if(ft){qu(l,w,ft);return}var _t=te?te(Se,Fe,w+"",l,f,me):g,Et=_t===g;if(Et){var jt=Fi(Fe),ui=!jt&&rc(Fe),Mi=!jt&&!ui&&nh(Fe);_t=Fe,jt||ui||Mi?Fi(Se)?_t=Se:Vr(Se)?_t=_o(Se):ui?(Et=!1,_t=Ah(Fe,!0)):Mi?(Et=!1,_t=zp(Fe,!0)):_t=[]:Vc(Fe)||Nc(Fe)?(_t=Se,Nc(Se)?_t=km(Se):(!tr(Se)||kl(Se))&&(_t=Lf(Fe))):Et=!1}Et&&(me.set(Fe,_t),q(_t,Fe,z,te,me),me.delete(Fe)),qu(l,w,_t)}function Ln(l,f){var w=l.length;if(w)return f+=f<0?w:0,Ll(f,w)?l[f]:g}function sn(l,f,w){f.length?f=mn(f,function(te){return Fi(te)?function(me){return we(me,te.length===1?te[0]:te)}:te}):f=[Cs];var z=-1;f=mn(f,Mr(vi()));var q=Sr(l,function(te,me,Se){var Fe=mn(f,function(ft){return ft(te)});return{criteria:Fe,index:++z,value:te}});return iu(q,function(te,me){return P_(te,me,w)})}function mr(l,f){return po(l,f,function(w,z){return ap(l,z)})}function po(l,f,w){for(var z=-1,q=f.length,te={};++z<q;){var me=f[z],Se=we(l,me);w(Se,me)&&Ts(te,Rc(me,l),Se)}return te}function Wn(l){return function(f){return we(f,l)}}function to(l,f,w,z){var q=z?fa:Ei,te=-1,me=f.length,Se=l;for(l===f&&(f=_o(f)),w&&(Se=mn(l,Mr(w)));++te<me;)for(var Fe=0,ft=f[te],_t=w?w(ft):ft;(Fe=q(Se,_t,Fe,z))>-1;)Se!==l&&qa.call(Se,Fe,1),qa.call(l,Fe,1);return l}function mo(l,f){for(var w=l?f.length:0,z=w-1;w--;){var q=f[w];if(w==z||q!==te){var te=q;Ll(q)?qa.call(l,q,1):yd(l,q)}}return l}function Ea(l,f){return l+Ac(uu()*(f-l+1))}function Pc(l,f,w,z){for(var q=-1,te=Ar(lu((f-l)/(w||1)),0),me=et(te);te--;)me[z?te:++q]=l,l+=w;return me}function Ro(l,f){var w="";if(!l||f<1||f>nn)return w;do f%2&&(w+=l),f=Ac(f/2),f&&(l+=l);while(f);return w}function Si(l,f){return zf($u(l,f,Cs),l+"")}function Xa(l){return wh(jc(l))}function Ml(l,f){var w=jc(l);return Ol(w,_(f,0,w.length))}function Ts(l,f,w,z){if(!tr(l))return l;f=Rc(f,l);for(var q=-1,te=f.length,me=te-1,Se=l;Se!=null&&++q<te;){var Fe=ol(f[q]),ft=w;if(Fe==="__proto__"||Fe==="constructor"||Fe==="prototype")return l;if(q!=me){var _t=Se[Fe];ft=z?z(_t,Fe,Se):g,ft===g&&(ft=tr(_t)?_t:Ll(f[q+1])?[]:{})}Il(Se,Fe,ft),Se=Se[Fe]}return l}var Jl=Cc?function(l,f){return Cc.set(l,f),l}:Cs,Dp=Tl?function(l,f){return Tl(l,"toString",{configurable:!0,enumerable:!1,value:$h(f),writable:!0})}:Cs;function Ef(l){return Ol(jc(l))}function Js(l,f,w){var z=-1,q=l.length;f<0&&(f=-f>q?0:q+f),w=w>q?q:w,w<0&&(w+=q),q=f>w?0:w-f>>>0,f>>>=0;for(var te=et(q);++z<q;)te[z]=l[z+f];return te}function Lp(l,f){var w;return U(l,function(z,q,te){return w=f(z,q,te),!w}),!!w}function Th(l,f,w){var z=0,q=l==null?z:l.length;if(typeof f=="number"&&f===f&&q<=or){for(;z<q;){var te=z+q>>>1,me=l[te];me!==null&&!ia(me)&&(w?me<=f:me<f)?z=te+1:q=te}return q}return gd(l,f,Cs,w)}function gd(l,f,w,z){var q=0,te=l==null?0:l.length;if(te===0)return 0;f=w(f);for(var me=f!==f,Se=f===null,Fe=ia(f),ft=f===g;q<te;){var _t=Ac((q+te)/2),Et=w(l[_t]),jt=Et!==g,ui=Et===null,Mi=Et===Et,Yi=ia(Et);if(me)var Li=z||Mi;else ft?Li=Mi&&(z||jt):Se?Li=Mi&&jt&&(z||!ui):Fe?Li=Mi&&jt&&!ui&&(z||!Yi):ui||Yi?Li=!1:Li=z?Et<=f:Et<f;Li?q=_t+1:te=_t}return Nr(te,Wr)}function Af(l,f){for(var w=-1,z=l.length,q=0,te=[];++w<z;){var me=l[w],Se=f?f(me):me;if(!w||!al(Se,Fe)){var Fe=Se;te[q++]=me===0?0:me}}return te}function Sf(l){return typeof l=="number"?l:ia(l)?rn:+l}function Es(l){if(typeof l=="string")return l;if(Fi(l))return mn(l,Es)+"";if(ia(l))return gh?gh.call(l):"";var f=l+"";return f=="0"&&1/l==-pn?"-0":f}function Ql(l,f,w){var z=-1,q=da,te=l.length,me=!0,Se=[],Fe=Se;if(w)me=!1,q=Gs;else if(te>=P){var ft=f?null:Sh(l);if(ft)return Pe(ft);me=!1,q=gl,Fe=new Ta}else Fe=f?[]:Se;e:for(;++z<te;){var _t=l[z],Et=f?f(_t):_t;if(_t=w||_t!==0?_t:0,me&&Et===Et){for(var jt=Fe.length;jt--;)if(Fe[jt]===Et)continue e;f&&Fe.push(Et),Se.push(_t)}else q(Fe,Et,w)||(Fe!==Se&&Fe.push(Et),Se.push(_t))}return Se}function yd(l,f){return f=Rc(f,l),l=ea(l,f),l==null||delete l[ol(Xn(f))]}function Pp(l,f,w,z){return Ts(l,f,w(we(l,f)),z)}function vd(l,f,w,z){for(var q=l.length,te=z?q:-1;(z?te--:++te<q)&&f(l[te],te,l););return w?Js(l,z?0:te,z?te+1:q):Js(l,z?te+1:0,z?q:te)}function Oc(l,f){var w=l;return w instanceof Ai&&(w=w.value()),fl(f,function(z,q){return q.func.apply(q.thisArg,cs([z],q.args))},w)}function If(l,f,w){var z=l.length;if(z<2)return z?Ql(l[0]):[];for(var q=-1,te=et(z);++q<z;)for(var me=l[q],Se=-1;++Se<z;)Se!=q&&(te[q]=R(te[q]||me,l[Se],f,w));return Ql(W(te,1),f,w)}function xd(l,f,w){for(var z=-1,q=l.length,te=f.length,me={};++z<q;){var Se=z<te?f[z]:g;w(me,l[z],Se)}return me}function Eh(l){return Vr(l)?l:[]}function bd(l){return typeof l=="function"?l:Cs}function Rc(l,f){return Fi(l)?l:Id(l,f)?[l]:kf(Cn(l))}var wd=Si;function ec(l,f,w){var z=l.length;return w=w===g?z:w,!f&&w>=z?l:Js(l,f,w)}var Td=au||function(l){return ar.clearTimeout(l)};function Ah(l,f){if(f)return l.slice();var w=l.length,z=wl?wl(w):new l.constructor(w);return l.copy(z),z}function Ka(l){var f=new l.constructor(l.byteLength);return new ga(f).set(new ga(l)),f}function Ed(l,f){var w=f?Ka(l.buffer):l.buffer;return new l.constructor(w,l.byteOffset,l.byteLength)}function Op(l){var f=new l.constructor(l.source,Dt.exec(l));return f.lastIndex=l.lastIndex,f}function Rp(l){return Ha?Dn(Ha.call(l)):{}}function zp(l,f){var w=f?Ka(l.buffer):l.buffer;return new l.constructor(w,l.byteOffset,l.length)}function kp(l,f){if(l!==f){var w=l!==g,z=l===null,q=l===l,te=ia(l),me=f!==g,Se=f===null,Fe=f===f,ft=ia(f);if(!Se&&!ft&&!te&&l>f||te&&me&&Fe&&!Se&&!ft||z&&me&&Fe||!w&&Fe||!q)return 1;if(!z&&!te&&!ft&&l<f||ft&&w&&q&&!z&&!te||Se&&w&&q||!me&&q||!Fe)return-1}return 0}function P_(l,f,w){for(var z=-1,q=l.criteria,te=f.criteria,me=q.length,Se=w.length;++z<me;){var Fe=kp(q[z],te[z]);if(Fe){if(z>=Se)return Fe;var ft=w[z];return Fe*(ft=="desc"?-1:1)}}return l.index-f.index}function Ad(l,f,w,z){for(var q=-1,te=l.length,me=w.length,Se=-1,Fe=f.length,ft=Ar(te-me,0),_t=et(Fe+ft),Et=!z;++Se<Fe;)_t[Se]=f[Se];for(;++q<me;)(Et||q<te)&&(_t[w[q]]=l[q]);for(;ft--;)_t[Se++]=l[q++];return _t}function Zu(l,f,w,z){for(var q=-1,te=l.length,me=-1,Se=w.length,Fe=-1,ft=f.length,_t=Ar(te-Se,0),Et=et(_t+ft),jt=!z;++q<_t;)Et[q]=l[q];for(var ui=q;++Fe<ft;)Et[ui+Fe]=f[Fe];for(;++me<Se;)(jt||q<te)&&(Et[ui+w[me]]=l[q++]);return Et}function _o(l,f){var w=-1,z=l.length;for(f||(f=et(z));++w<z;)f[w]=l[w];return f}function Eo(l,f,w,z){var q=!w;w||(w={});for(var te=-1,me=f.length;++te<me;){var Se=f[te],Fe=z?z(w[Se],l[Se],Se,w,l):g;Fe===g&&(Fe=l[Se]),q?h(w,Se,Fe):Il(w,Se,Fe)}return w}function Ya(l,f){return Eo(l,Dh(l),f)}function zc(l,f){return Eo(l,_r(l),f)}function Ja(l,f){return function(w,z){var q=Fi(w)?wc:c,te=f?f():{};return q(w,l,vi(z,2),te)}}function Aa(l){return Si(function(f,w){var z=-1,q=w.length,te=q>1?w[q-1]:g,me=q>2?w[2]:g;for(te=l.length>3&&typeof te=="function"?(q--,te):g,me&&$o(w[0],w[1],me)&&(te=q<3?g:te,q=1),f=Dn(f);++z<q;){var Se=w[z];Se&&l(f,Se,z,te)}return f})}function Bp(l,f){return function(w,z){if(w==null)return w;if(!Is(w))return l(w,z);for(var q=w.length,te=f?q:-1,me=Dn(w);(f?te--:++te<q)&&z(me[te],te,me)!==!1;);return w}}function Fp(l){return function(f,w,z){for(var q=-1,te=Dn(f),me=z(f),Se=me.length;Se--;){var Fe=me[l?Se:++q];if(w(te[Fe],Fe,te)===!1)break}return f}}function O_(l,f,w){var z=f&rt,q=kc(l);function te(){var me=this&&this!==ar&&this instanceof te?q:l;return me.apply(z?w:this,arguments)}return te}function Np(l){return function(f){f=Cn(f);var w=$s(f)?Di(f):g,z=w?w[0]:f.charAt(0),q=w?ec(w,1).join(""):f.slice(1);return z[l]()+q}}function yu(l){return function(f){return fl(o_(dp(f).replace(Ul,"")),l,"")}}function kc(l){return function(){var f=arguments;switch(f.length){case 0:return new l;case 1:return new l(f[0]);case 2:return new l(f[0],f[1]);case 3:return new l(f[0],f[1],f[2]);case 4:return new l(f[0],f[1],f[2],f[3]);case 5:return new l(f[0],f[1],f[2],f[3],f[4]);case 6:return new l(f[0],f[1],f[2],f[3],f[4],f[5]);case 7:return new l(f[0],f[1],f[2],f[3],f[4],f[5],f[6])}var w=Al(l.prototype),z=l.apply(w,f);return tr(z)?z:w}}function Qa(l,f,w){var z=kc(l);function q(){for(var te=arguments.length,me=et(te),Se=te,Fe=Dl(q);Se--;)me[Se]=arguments[Se];var ft=te<3&&me[0]!==Fe&&me[te-1]!==Fe?[]:ma(me,Fe);if(te-=ft.length,te<w)return Sd(l,f,cr,q.placeholder,g,me,ft,g,g,w-te);var _t=this&&this!==ar&&this instanceof q?z:l;return Hr(_t,this,me)}return q}function Up(l){return function(f,w,z){var q=Dn(f);if(!Is(f)){var te=vi(w,3);f=Pr(f),w=function(Se){return te(q[Se],Se,q)}}var me=l(f,w,z);return me>-1?q[te?f[me]:me]:g}}function Vp(l){return Qs(function(f){var w=f.length,z=w,q=Po.prototype.thru;for(l&&f.reverse();z--;){var te=f[z];if(typeof te!="function")throw new Gi(Z);if(q&&!me&&Mh(te)=="wrapper")var me=new Po([],!0)}for(z=me?z:w;++z<w;){te=f[z];var Se=Mh(te),Fe=Se=="wrapper"?Ch(te):g;Fe&&Pf(Fe[0])&&Fe[1]==(ti|Mt|$e|Pi)&&!Fe[4].length&&Fe[9]==1?me=me[Mh(Fe[0])].apply(me,Fe[3]):me=te.length==1&&Pf(te)?me[Se]():me.thru(te)}return function(){var ft=arguments,_t=ft[0];if(me&&ft.length==1&&Fi(_t))return me.plant(_t).value();for(var Et=0,jt=w?f[Et].apply(this,ft):_t;++Et<w;)jt=f[Et].call(this,jt);return jt}})}function cr(l,f,w,z,q,te,me,Se,Fe,ft){var _t=f&ti,Et=f&rt,jt=f&Je,ui=f&(Mt|lt),Mi=f&Ht,Yi=jt?g:kc(l);function Li(){for(var cn=arguments.length,gn=et(cn),Ms=cn;Ms--;)gn[Ms]=arguments[Ms];if(ui)var Ko=Dl(Li),Ds=hs(gn,Ko);if(z&&(gn=Ad(gn,z,q,ui)),te&&(gn=Zu(gn,te,me,ui)),cn-=Ds,ui&&cn<ft){var Gr=ma(gn,Ko);return Sd(l,f,cr,Li.placeholder,w,gn,Gr,Se,Fe,ft-cn)}var Ma=Et?w:this,Yo=jt?Ma[l]:l;return cn=gn.length,Se?gn=Ia(gn,Se):Mi&&cn>1&&gn.reverse(),_t&&Fe<cn&&(gn.length=Fe),this&&this!==ar&&this instanceof Li&&(Yo=Yi||kc(Yo)),Yo.apply(Ma,gn)}return Li}function di(l,f){return function(w,z){return mt(w,l,f(z),{})}}function el(l,f){return function(w,z){var q;if(w===g&&z===g)return f;if(w!==g&&(q=w),z!==g){if(q===g)return z;typeof w=="string"||typeof z=="string"?(w=Es(w),z=Es(z)):(w=Sf(w),z=Sf(z)),q=l(w,z)}return q}}function Hu(l){return Qs(function(f){return f=mn(f,Mr(vi())),Si(function(w){var z=this;return l(f,function(q){return Hr(q,z,w)})})})}function zo(l,f){f=f===g?" ":Es(f);var w=f.length;if(w<2)return w?Ro(f,l):f;var z=Ro(f,lu(l/_n(f)));return $s(f)?ec(Di(z),0,l).join(""):z.slice(0,l)}function Gp(l,f,w,z){var q=f&rt,te=kc(l);function me(){for(var Se=-1,Fe=arguments.length,ft=-1,_t=z.length,Et=et(_t+Fe),jt=this&&this!==ar&&this instanceof me?te:l;++ft<_t;)Et[ft]=z[ft];for(;Fe--;)Et[ft++]=arguments[++Se];return Hr(jt,q?w:this,Et)}return me}function Cf(l){return function(f,w,z){return z&&typeof z!="number"&&$o(f,w,z)&&(w=z=g),f=So(f),w===g?(w=f,f=0):w=So(w),z=z===g?f<w?1:-1:So(z),Pc(f,w,z,l)}}function As(l){return function(f,w){return typeof f=="string"&&typeof w=="string"||(f=Fo(f),w=Fo(w)),l(f,w)}}function Sd(l,f,w,z,q,te,me,Se,Fe,ft){var _t=f&Mt,Et=_t?me:g,jt=_t?g:me,ui=_t?te:g,Mi=_t?g:te;f|=_t?$e:Wt,f&=~(_t?Wt:$e),f&Qe||(f&=~(rt|Je));var Yi=[l,f,q,ui,Et,Mi,jt,Se,Fe,ft],Li=w.apply(g,Yi);return Pf(l)&&Ph(Li,Yi),Li.placeholder=z,Dd(Li,l,f)}function tc(l){var f=lr[l];return function(w,z){if(w=Fo(w),z=z==null?0:Nr(Xi(z),292),z&&fh(w)){var q=(Cn(w)+"e").split("e"),te=f(q[0]+"e"+(+q[1]+z));return q=(Cn(te)+"e").split("e"),+(q[0]+"e"+(+q[1]-z))}return f(w)}}var Sh=Za&&1/Pe(new Za([,-0]))[1]==pn?function(l){return new Za(l)}:mp;function Bc(l){return function(f){var w=ko(f);return w==Gt?Xs(f):w==dr?it(f):Tc(f,l(f))}}function tl(l,f,w,z,q,te,me,Se){var Fe=f&Je;if(!Fe&&typeof l!="function")throw new Gi(Z);var ft=z?z.length:0;if(ft||(f&=~($e|Wt),z=q=g),me=me===g?me:Ar(Xi(me),0),Se=Se===g?Se:Xi(Se),ft-=q?q.length:0,f&Wt){var _t=z,Et=q;z=q=g}var jt=Fe?g:Ch(l),ui=[l,f,w,z,q,_t,Et,te,me,Se];if(jt&&Xo(ui,jt),l=ui[0],f=ui[1],w=ui[2],z=ui[3],q=ui[4],Se=ui[9]=ui[9]===g?Fe?0:l.length:Ar(ui[9]-ft,0),!Se&&f&(Mt|lt)&&(f&=~(Mt|lt)),!f||f==rt)var Mi=O_(l,f,w);else f==Mt||f==lt?Mi=Qa(l,f,Se):(f==$e||f==(rt|$e))&&!q.length?Mi=Gp(l,f,w,z):Mi=cr.apply(g,ui);var Yi=jt?Jl:Ph;return Dd(Yi(Mi,ui),l,f)}function Ih(l,f,w,z){return l===g||al(l,Mo[w])&&!ji.call(z,w)?f:l}function Mf(l,f,w,z,q,te){return tr(l)&&tr(f)&&(te.set(f,l),ws(l,f,g,Mf,te),te.delete(f)),l}function jp(l){return Vc(l)?g:l}function Wp(l,f,w,z,q,te){var me=w&Ce,Se=l.length,Fe=f.length;if(Se!=Fe&&!(me&&Fe>Se))return!1;var ft=te.get(l),_t=te.get(f);if(ft&&_t)return ft==f&&_t==l;var Et=-1,jt=!0,ui=w&qe?new Ta:g;for(te.set(l,f),te.set(f,l);++Et<Se;){var Mi=l[Et],Yi=f[Et];if(z)var Li=me?z(Yi,Mi,Et,f,l,te):z(Mi,Yi,Et,l,f,te);if(Li!==g){if(Li)continue;jt=!1;break}if(ui){if(!pl(f,function(cn,gn){if(!gl(ui,gn)&&(Mi===cn||q(Mi,cn,w,z,te)))return ui.push(gn)})){jt=!1;break}}else if(!(Mi===Yi||q(Mi,Yi,w,z,te))){jt=!1;break}}return te.delete(l),te.delete(f),jt}function Df(l,f,w,z,q,te,me){switch(w){case vo:if(l.byteLength!=f.byteLength||l.byteOffset!=f.byteOffset)return!1;l=l.buffer,f=f.buffer;case Jr:return!(l.byteLength!=f.byteLength||!te(new ga(l),new ga(f)));case fi:case Yr:case Cr:return al(+l,+f);case Bt:return l.name==f.name&&l.message==f.message;case tn:case Br:return l==f+"";case Gt:var Se=Xs;case dr:var Fe=z&Ce;if(Se||(Se=Pe),l.size!=f.size&&!Fe)return!1;var ft=me.get(l);if(ft)return ft==f;z|=qe,me.set(l,f);var _t=Wp(Se(l),Se(f),z,q,te,me);return me.delete(l),_t;case Le:if(Ha)return Ha.call(l)==Ha.call(f)}return!1}function qp(l,f,w,z,q,te){var me=w&Ce,Se=Fc(l),Fe=Se.length,ft=Fc(f),_t=ft.length;if(Fe!=_t&&!me)return!1;for(var Et=Fe;Et--;){var jt=Se[Et];if(!(me?jt in f:ji.call(f,jt)))return!1}var ui=te.get(l),Mi=te.get(f);if(ui&&Mi)return ui==f&&Mi==l;var Yi=!0;te.set(l,f),te.set(f,l);for(var Li=me;++Et<Fe;){jt=Se[Et];var cn=l[jt],gn=f[jt];if(z)var Ms=me?z(gn,cn,jt,f,l,te):z(cn,gn,jt,l,f,te);if(!(Ms===g?cn===gn||q(cn,gn,w,z,te):Ms)){Yi=!1;break}Li||(Li=jt=="constructor")}if(Yi&&!Li){var Ko=l.constructor,Ds=f.constructor;Ko!=Ds&&"constructor"in l&&"constructor"in f&&!(typeof Ko=="function"&&Ko instanceof Ko&&typeof Ds=="function"&&Ds instanceof Ds)&&(Yi=!1)}return te.delete(l),te.delete(f),Yi}function Qs(l){return zf($u(l,g,tm),l+"")}function Fc(l){return ke(l,Pr,Dh)}function il(l){return ke(l,ps,_r)}var Ch=Cc?function(l){return Cc.get(l)}:mp;function Mh(l){for(var f=l.name+"",w=Kl[f],z=ji.call(Kl,f)?w.length:0;z--;){var q=w[z],te=q.func;if(te==null||te==l)return q.name}return f}function Dl(l){var f=ji.call(K,"placeholder")?K:l;return f.placeholder}function vi(){var l=K.iteratee||Bl;return l=l===Bl?dn:l,arguments.length?l(arguments[0],arguments[1]):l}function Ho(l,f){var w=l.__data__;return z_(f)?w[typeof f=="string"?"string":"hash"]:w.map}function vu(l){for(var f=Pr(l),w=f.length;w--;){var z=f[w],q=l[z];f[w]=[z,q,Cd(q)]}return f}function Ur(l,f){var w=Zo(l,f);return zt(w)?w:g}function Sa(l){var f=ji.call(l,fs),w=l[fs];try{l[fs]=g;var z=!0}catch{}var q=Ci.call(l);return z&&(f?l[fs]=w:delete l[fs]),q}var Dh=Xl?function(l){return l==null?[]:(l=Dn(l),wo(Xl(l),function(f){return $l.call(l,f)}))}:gp,_r=Xl?function(l){for(var f=[];l;)cs(f,Dh(l)),l=ya(l);return f}:gp,ko=Be;(Uu&&ko(new Uu(new ArrayBuffer(1)))!=vo||El&&ko(new El)!=Gt||hu&&ko(hu.resolve())!=Wo||Za&&ko(new Za)!=dr||Ic&&ko(new Ic)!=br)&&(ko=function(l){var f=Be(l),w=f==oo?l.constructor:g,z=w?wu(w):"";if(z)switch(z){case Vu:return vo;case sd:return Gt;case mh:return Wo;case _h:return dr;case Mc:return br}return f});function Lh(l,f,w){for(var z=-1,q=w.length;++z<q;){var te=w[z],me=te.size;switch(te.type){case"drop":l+=me;break;case"dropRight":f-=me;break;case"take":f=Nr(f,l+me);break;case"takeRight":l=Ar(l,f-me);break}}return{start:l,end:f}}function nl(l){var f=l.match(be);return f?f[1].split(ze):[]}function Zp(l,f,w){f=Rc(f,l);for(var z=-1,q=f.length,te=!1;++z<q;){var me=ol(f[z]);if(!(te=l!=null&&w(l,me)))break;l=l[me]}return te||++z!=q?te:(q=l==null?0:l.length,!!q&&Uc(q)&&Ll(me,q)&&(Fi(l)||Nc(l)))}function R_(l){var f=l.length,w=new l.constructor(f);return f&&typeof l[0]=="string"&&ji.call(l,"index")&&(w.index=l.index,w.input=l.input),w}function Lf(l){return typeof l.constructor=="function"&&!ic(l)?Al(ya(l)):{}}function Hp(l,f,w){var z=l.constructor;switch(f){case Jr:return Ka(l);case fi:case Yr:return new z(+l);case vo:return Ed(l,w);case es:case ts:case so:case Ba:case ao:case is:case qo:case ks:case ns:return zp(l,w);case Gt:return new z;case Cr:case Br:return new z(l);case tn:return Op(l);case dr:return new z;case Le:return Rp(l)}}function xu(l,f){var w=f.length;if(!w)return l;var z=w-1;return f[z]=(w>1?"& ":"")+f[z],f=f.join(w>2?", ":" "),l.replace(ue,`{
/* [wrapped with `+f+`] */
`)}function $p(l){return Fi(l)||Nc(l)||!!(su&&l&&l[su])}function Ll(l,f){var w=typeof l;return f=f??nn,!!f&&(w=="number"||w!="symbol"&&ai.test(l))&&l>-1&&l%1==0&&l<f}function $o(l,f,w){if(!tr(w))return!1;var z=typeof f;return(z=="number"?Is(w)&&Ll(f,w.length):z=="string"&&f in w)?al(w[f],l):!1}function Id(l,f){if(Fi(l))return!1;var w=typeof l;return w=="number"||w=="symbol"||w=="boolean"||l==null||ia(l)?!0:lo.test(l)||!la.test(l)||f!=null&&l in Dn(f)}function z_(l){var f=typeof l;return f=="string"||f=="number"||f=="symbol"||f=="boolean"?l!=="__proto__":l===null}function Pf(l){var f=Mh(l),w=K[f];if(typeof w!="function"||!(f in Ai.prototype))return!1;if(l===w)return!0;var z=Ch(w);return!!z&&l===z[0]}function Xp(l){return!!_a&&_a in l}var Kp=Lr?kl:uf;function ic(l){var f=l&&l.constructor,w=typeof f=="function"&&f.prototype||Mo;return l===w}function Cd(l){return l===l&&!tr(l)}function Md(l,f){return function(w){return w==null?!1:w[l]===f&&(f!==g||l in Dn(w))}}function Of(l){var f=Zd(l,function(z){return w.size===ce&&w.clear(),z}),w=f.cache;return f}function Xo(l,f){var w=l[1],z=f[1],q=w|z,te=q<(rt|Je|ti),me=z==ti&&w==Mt||z==ti&&w==Pi&&l[7].length<=f[8]||z==(ti|Pi)&&f[7].length<=f[8]&&w==Mt;if(!(te||me))return l;z&rt&&(l[2]=f[2],q|=w&rt?0:Qe);var Se=f[3];if(Se){var Fe=l[3];l[3]=Fe?Ad(Fe,Se,f[4]):Se,l[4]=Fe?ma(l[3],_e):f[4]}return Se=f[5],Se&&(Fe=l[5],l[5]=Fe?Zu(Fe,Se,f[6]):Se,l[6]=Fe?ma(l[5],_e):f[6]),Se=f[7],Se&&(l[7]=Se),z&ti&&(l[8]=l[8]==null?f[8]:Nr(l[8],f[8])),l[9]==null&&(l[9]=f[9]),l[0]=f[0],l[1]=q,l}function Pl(l){var f=[];if(l!=null)for(var w in Dn(l))f.push(w);return f}function bu(l){return Ci.call(l)}function $u(l,f,w){return f=Ar(f===g?l.length-1:f,0),function(){for(var z=arguments,q=-1,te=Ar(z.length-f,0),me=et(te);++q<te;)me[q]=z[f+q];q=-1;for(var Se=et(f+1);++q<f;)Se[q]=z[q];return Se[f]=w(me),Hr(l,this,Se)}}function ea(l,f){return f.length<2?l:we(l,Js(f,0,-1))}function Ia(l,f){for(var w=l.length,z=Nr(f.length,w),q=_o(l);z--;){var te=f[z];l[z]=Ll(te,w)?q[te]:g}return l}function Rf(l,f){if(!(f==="constructor"&&typeof l[f]=="function")&&f!="__proto__")return l[f]}var Ph=rl(Jl),Xu=vs||function(l,f){return ar.setTimeout(l,f)},zf=rl(Dp);function Dd(l,f,w){var z=f+"";return zf(l,xu(z,Ld(nl(z),w)))}function rl(l){var f=0,w=0;return function(){var z=cu(),q=ki-(z-w);if(w=z,q>0){if(++f>=Ti)return arguments[0]}else f=0;return l.apply(g,arguments)}}function Ol(l,f){var w=-1,z=l.length,q=z-1;for(f=f===g?z:f;++w<f;){var te=Ea(w,q),me=l[te];l[te]=l[w],l[w]=me}return l.length=f,l}var kf=Of(function(l){var f=[];return l.charCodeAt(0)===46&&f.push(""),l.replace(ca,function(w,z,q,te){f.push(q?te.replace(Ue,"$1"):z||w)}),f});function ol(l){if(typeof l=="string"||ia(l))return l;var f=l+"";return f=="0"&&1/l==-pn?"-0":f}function wu(l){if(l!=null){try{return Xr.call(l)}catch{}try{return l+""}catch{}}return""}function Ld(l,f){return bo(Zn,function(w){var z="_."+w[0];f&w[1]&&!da(l,z)&&l.push(z)}),l.sort()}function Pd(l){if(l instanceof Ai)return l.clone();var f=new Po(l.__wrapped__,l.__chain__);return f.__actions__=_o(l.__actions__),f.__index__=l.__index__,f.__values__=l.__values__,f}function Ku(l,f,w){(w?$o(l,f,w):f===g)?f=1:f=Ar(Xi(f),0);var z=l==null?0:l.length;if(!z||f<1)return[];for(var q=0,te=0,me=et(lu(z/f));q<z;)me[te++]=Js(l,q,q+=f);return me}function Yu(l){for(var f=-1,w=l==null?0:l.length,z=0,q=[];++f<w;){var te=l[f];te&&(q[z++]=te)}return q}function Oh(){var l=arguments.length;if(!l)return[];for(var f=et(l-1),w=arguments[0],z=l;z--;)f[z-1]=arguments[z];return cs(Fi(w)?_o(w):[w],W(f,1))}var Od=Si(function(l,f){return Vr(l)?R(l,W(f,1,Vr,!0)):[]}),Yp=Si(function(l,f){var w=Xn(f);return Vr(w)&&(w=g),Vr(l)?R(l,W(f,1,Vr,!0),vi(w,2)):[]}),Rh=Si(function(l,f){var w=Xn(f);return Vr(w)&&(w=g),Vr(l)?R(l,W(f,1,Vr,!0),g,w):[]});function Bf(l,f,w){var z=l==null?0:l.length;return z?(f=w||f===g?1:Xi(f),Js(l,f<0?0:f,z)):[]}function Jp(l,f,w){var z=l==null?0:l.length;return z?(f=w||f===g?1:Xi(f),f=z-f,Js(l,0,f<0?0:f)):[]}function Ju(l,f){return l&&l.length?vd(l,vi(f,3),!0,!0):[]}function Qp(l,f){return l&&l.length?vd(l,vi(f,3),!0):[]}function Ff(l,f,w,z){var q=l==null?0:l.length;return q?(w&&typeof w!="number"&&$o(l,f,w)&&(w=0,z=q),Q(l,f,w,z)):[]}function Nf(l,f,w){var z=l==null?0:l.length;if(!z)return-1;var q=w==null?0:Xi(w);return q<0&&(q=Ar(z+q,0)),To(l,vi(f,3),q)}function em(l,f,w){var z=l==null?0:l.length;if(!z)return-1;var q=z-1;return w!==g&&(q=Xi(w),q=w<0?Ar(z+q,0):Nr(q,z-1)),To(l,vi(f,3),q,!0)}function tm(l){var f=l==null?0:l.length;return f?W(l,1):[]}function zh(l){var f=l==null?0:l.length;return f?W(l,pn):[]}function im(l,f){var w=l==null?0:l.length;return w?(f=f===g?1:Xi(f),W(l,f)):[]}function an(l){for(var f=-1,w=l==null?0:l.length,z={};++f<w;){var q=l[f];z[q[0]]=q[1]}return z}function Rd(l){return l&&l.length?l[0]:g}function Rl(l,f,w){var z=l==null?0:l.length;if(!z)return-1;var q=w==null?0:Xi(w);return q<0&&(q=Ar(z+q,0)),Ei(l,f,q)}function zl(l){var f=l==null?0:l.length;return f?Js(l,0,-1):[]}var sl=Si(function(l){var f=mn(l,Eh);return f.length&&f[0]===l[0]?He(f):[]}),ta=Si(function(l){var f=Xn(l),w=mn(l,Eh);return f===Xn(w)?f=g:w.pop(),w.length&&w[0]===l[0]?He(w,vi(f,2)):[]}),Ao=Si(function(l){var f=Xn(l),w=mn(l,Eh);return f=typeof f=="function"?f:g,f&&w.pop(),w.length&&w[0]===l[0]?He(w,g,f):[]});function nm(l,f){return l==null?"":Nu.call(l,f)}function Xn(l){var f=l==null?0:l.length;return f?l[f-1]:g}function rm(l,f,w){var z=l==null?0:l.length;if(!z)return-1;var q=z;return w!==g&&(q=Xi(w),q=q<0?Ar(z+q,0):Nr(q,z-1)),f===f?ci(l,f,q):To(l,_s,q,!0)}function Qu(l,f){return l&&l.length?Ln(l,Xi(f)):g}var Uf=Si(Vf);function Vf(l,f){return l&&l.length&&f&&f.length?to(l,f):l}function Gf(l,f,w){return l&&l.length&&f&&f.length?to(l,f,vi(w,2)):l}function k_(l,f,w){return l&&l.length&&f&&f.length?to(l,f,g,w):l}var jf=Qs(function(l,f){var w=l==null?0:l.length,z=p(l,f);return mo(l,mn(f,function(q){return Ll(q,w)?+q:q}).sort(kp)),z});function om(l,f){var w=[];if(!(l&&l.length))return w;var z=-1,q=[],te=l.length;for(f=vi(f,3);++z<te;){var me=l[z];f(me,z,l)&&(w.push(me),q.push(z))}return mo(l,q),w}function Wf(l){return l==null?l:bf.call(l)}function nc(l,f,w){var z=l==null?0:l.length;return z?(w&&typeof w!="number"&&$o(l,f,w)?(f=0,w=z):(f=f==null?0:Xi(f),w=w===g?z:Xi(w)),Js(l,f,w)):[]}function Tu(l,f){return Th(l,f)}function zd(l,f,w){return gd(l,f,vi(w,2))}function kd(l,f){var w=l==null?0:l.length;if(w){var z=Th(l,f);if(z<w&&al(l[z],f))return z}return-1}function qf(l,f){return Th(l,f,!0)}function sm(l,f,w){return gd(l,f,vi(w,2),!0)}function B_(l,f){var w=l==null?0:l.length;if(w){var z=Th(l,f,!0)-1;if(al(l[z],f))return z}return-1}function am(l){return l&&l.length?Af(l):[]}function F_(l,f){return l&&l.length?Af(l,vi(f,2)):[]}function Zf(l){var f=l==null?0:l.length;return f?Js(l,1,f):[]}function N_(l,f,w){return l&&l.length?(f=w||f===g?1:Xi(f),Js(l,0,f<0?0:f)):[]}function Hf(l,f,w){var z=l==null?0:l.length;return z?(f=w||f===g?1:Xi(f),f=z-f,Js(l,f<0?0:f,z)):[]}function lm(l,f){return l&&l.length?vd(l,vi(f,3),!1,!0):[]}function cm(l,f){return l&&l.length?vd(l,vi(f,3)):[]}var Eu=Si(function(l){return Ql(W(l,1,Vr,!0))}),um=Si(function(l){var f=Xn(l);return Vr(f)&&(f=g),Ql(W(l,1,Vr,!0),vi(f,2))}),U_=Si(function(l){var f=Xn(l);return f=typeof f=="function"?f:g,Ql(W(l,1,Vr,!0),g,f)});function eh(l){return l&&l.length?Ql(l):[]}function Bd(l,f){return l&&l.length?Ql(l,vi(f,2)):[]}function hm(l,f){return f=typeof f=="function"?f:g,l&&l.length?Ql(l,g,f):[]}function Fd(l){if(!(l&&l.length))return[];var f=0;return l=wo(l,function(w){if(Vr(w))return f=Ar(w.length,f),!0}),ml(f,function(w){return mn(l,pa(w))})}function dm(l,f){if(!(l&&l.length))return[];var w=Fd(l);return f==null?w:mn(w,function(z){return Hr(f,g,z)})}var V_=Si(function(l,f){return Vr(l)?R(l,f):[]}),fm=Si(function(l){return If(wo(l,Vr))}),G_=Si(function(l){var f=Xn(l);return Vr(f)&&(f=g),If(wo(l,Vr),vi(f,2))}),pm=Si(function(l){var f=Xn(l);return f=typeof f=="function"?f:g,If(wo(l,Vr),g,f)}),j_=Si(Fd);function W_(l,f){return xd(l||[],f||[],Il)}function mm(l,f){return xd(l||[],f||[],Ts)}var _m=Si(function(l){var f=l.length,w=f>1?l[f-1]:g;return w=typeof w=="function"?(l.pop(),w):g,dm(l,w)});function $f(l){var f=K(l);return f.__chain__=!0,f}function Xf(l,f){return f(l),l}function Ca(l,f){return f(l)}var Ss=Qs(function(l){var f=l.length,w=f?l[0]:0,z=this.__wrapped__,q=function(te){return p(te,l)};return f>1||this.__actions__.length||!(z instanceof Ai)||!Ll(w)?this.thru(q):(z=z.slice(w,+w+(f?1:0)),z.__actions__.push({func:Ca,args:[q],thisArg:g}),new Po(z,this.__chain__).thru(function(te){return f&&!te.length&&te.push(g),te}))});function q_(){return $f(this)}function Kf(){return new Po(this.value(),this.__chain__)}function Z_(){this.__values__===g&&(this.__values__=go(this.value()));var l=this.__index__>=this.__values__.length,f=l?g:this.__values__[this.__index__++];return{done:l,value:f}}function H_(){return this}function $_(l){for(var f,w=this;w instanceof du;){var z=Pd(w);z.__index__=0,z.__values__=g,f?q.__wrapped__=z:f=z;var q=z;w=w.__wrapped__}return q.__wrapped__=l,f}function th(){var l=this.__wrapped__;if(l instanceof Ai){var f=l;return this.__actions__.length&&(f=new Ai(this)),f=f.reverse(),f.__actions__.push({func:Ca,args:[Wf],thisArg:g}),new Po(f,this.__chain__)}return this.thru(Wf)}function Nd(){return Oc(this.__wrapped__,this.__actions__)}var gm=Ja(function(l,f,w){ji.call(l,w)?++l[w]:h(l,w,1)});function Au(l,f,w){var z=Fi(l)?$i:J;return w&&$o(l,f,w)&&(f=g),z(l,vi(f,3))}function kh(l,f){var w=Fi(l)?wo:ee;return w(l,vi(f,3))}var X_=Up(Nf),K_=Up(em);function Y_(l,f){return W(ur(l,f),1)}function J_(l,f){return W(ur(l,f),pn)}function Q_(l,f,w){return w=w===g?1:Xi(w),W(ur(l,f),w)}function ym(l,f){var w=Fi(l)?bo:U;return w(l,vi(f,3))}function vm(l,f){var w=Fi(l)?Vs:$;return w(l,vi(f,3))}var Yf=Ja(function(l,f,w){ji.call(l,w)?l[w].push(f):h(l,w,[f])});function eg(l,f,w,z){l=Is(l)?l:jc(l),w=w&&!z?Xi(w):0;var q=l.length;return w<0&&(w=Ar(q+w,0)),Wh(l)?w<=q&&l.indexOf(f,w)>-1:!!q&&Ei(l,f,w)>-1}var ih=Si(function(l,f,w){var z=-1,q=typeof f=="function",te=Is(l)?et(l.length):[];return U(l,function(me){te[++z]=q?Hr(f,me,w):Ve(me,f,w)}),te}),tg=Ja(function(l,f,w){h(l,w,f)});function ur(l,f){var w=Fi(l)?mn:Sr;return w(l,vi(f,3))}function Ud(l,f,w,z){return l==null?[]:(Fi(f)||(f=f==null?[]:[f]),w=z?g:w,Fi(w)||(w=w==null?[]:[w]),sn(l,f,w))}var xm=Ja(function(l,f,w){l[w?0:1].push(f)},function(){return[[],[]]});function Vd(l,f,w){var z=Fi(l)?fl:ql,q=arguments.length<3;return z(l,vi(f,4),w,q,U)}function Gd(l,f,w){var z=Fi(l)?Qc:ql,q=arguments.length<3;return z(l,vi(f,4),w,q,$)}function Bh(l,f){var w=Fi(l)?wo:ee;return w(l,Hd(vi(f,3)))}function bm(l){var f=Fi(l)?wh:Xa;return f(l)}function wm(l,f,w){(w?$o(l,f,w):f===g)?f=1:f=Xi(f);var z=Fi(l)?md:Ml;return z(l,f)}function Fh(l){var f=Fi(l)?_d:Ef;return f(l)}function Jf(l){if(l==null)return 0;if(Is(l))return Wh(l)?_n(l):l.length;var f=ko(l);return f==Gt||f==dr?l.size:xn(l).length}function Qf(l,f,w){var z=Fi(l)?pl:Lp;return w&&$o(l,f,w)&&(f=g),z(l,vi(f,3))}var ig=Si(function(l,f){if(l==null)return[];var w=f.length;return w>1&&$o(l,f[0],f[1])?f=[]:w>2&&$o(f[0],f[1],f[2])&&(f=[f[0]]),sn(l,W(f,1),[])}),Nh=Ot||function(){return ar.Date.now()};function Uh(l,f){if(typeof f!="function")throw new Gi(Z);return l=Xi(l),function(){if(--l<1)return f.apply(this,arguments)}}function Tm(l,f,w){return f=w?g:f,f=l&&f==null?l.length:f,tl(l,ti,g,g,g,g,f)}function jd(l,f){var w;if(typeof f!="function")throw new Gi(Z);return l=Xi(l),function(){return--l>0&&(w=f.apply(this,arguments)),l<=1&&(f=g),w}}var ep=Si(function(l,f,w){var z=rt;if(w.length){var q=ma(w,Dl(ep));z|=$e}return tl(l,z,f,w,q)}),Wd=Si(function(l,f,w){var z=rt|Je;if(w.length){var q=ma(w,Dl(Wd));z|=$e}return tl(f,z,l,w,q)});function qd(l,f,w){f=w?g:f;var z=tl(l,Mt,g,g,g,g,g,f);return z.placeholder=qd.placeholder,z}function Vh(l,f,w){f=w?g:f;var z=tl(l,lt,g,g,g,g,g,f);return z.placeholder=Vh.placeholder,z}function Em(l,f,w){var z,q,te,me,Se,Fe,ft=0,_t=!1,Et=!1,jt=!0;if(typeof l!="function")throw new Gi(Z);f=Fo(f)||0,tr(w)&&(_t=!!w.leading,Et="maxWait"in w,te=Et?Ar(Fo(w.maxWait)||0,f):te,jt="trailing"in w?!!w.trailing:jt);function ui(Gr){var Ma=z,Yo=q;return z=q=g,ft=Gr,me=l.apply(Yo,Ma),me}function Mi(Gr){return ft=Gr,Se=Xu(cn,f),_t?ui(Gr):me}function Yi(Gr){var Ma=Gr-Fe,Yo=Gr-ft,wp=f-Ma;return Et?Nr(wp,te-Yo):wp}function Li(Gr){var Ma=Gr-Fe,Yo=Gr-ft;return Fe===g||Ma>=f||Ma<0||Et&&Yo>=te}function cn(){var Gr=Nh();if(Li(Gr))return gn(Gr);Se=Xu(cn,Yi(Gr))}function gn(Gr){return Se=g,jt&&z?ui(Gr):(z=q=g,me)}function Ms(){Se!==g&&Td(Se),ft=0,z=Fe=q=Se=g}function Ko(){return Se===g?me:gn(Nh())}function Ds(){var Gr=Nh(),Ma=Li(Gr);if(z=arguments,q=this,Fe=Gr,Ma){if(Se===g)return Mi(Fe);if(Et)return Td(Se),Se=Xu(cn,f),ui(Fe)}return Se===g&&(Se=Xu(cn,f)),me}return Ds.cancel=Ms,Ds.flush=Ko,Ds}var ng=Si(function(l,f){return O(l,1,f)}),rg=Si(function(l,f,w){return O(l,Fo(f)||0,w)});function og(l){return tl(l,Ht)}function Zd(l,f){if(typeof l!="function"||f!=null&&typeof f!="function")throw new Gi(Z);var w=function(){var z=arguments,q=f?f.apply(this,z):z[0],te=w.cache;if(te.has(q))return te.get(q);var me=l.apply(this,z);return w.cache=te.set(q,me)||te,me};return w.cache=new(Zd.Cache||wa),w}Zd.Cache=wa;function Hd(l){if(typeof l!="function")throw new Gi(Z);return function(){var f=arguments;switch(f.length){case 0:return!l.call(this);case 1:return!l.call(this,f[0]);case 2:return!l.call(this,f[0],f[1]);case 3:return!l.call(this,f[0],f[1],f[2])}return!l.apply(this,f)}}function $d(l){return jd(2,l)}var sg=wd(function(l,f){f=f.length==1&&Fi(f[0])?mn(f[0],Mr(vi())):mn(W(f,1),Mr(vi()));var w=f.length;return Si(function(z){for(var q=-1,te=Nr(z.length,w);++q<te;)z[q]=f[q].call(this,z[q]);return Hr(l,this,z)})}),Xd=Si(function(l,f){var w=ma(f,Dl(Xd));return tl(l,$e,g,f,w)}),Su=Si(function(l,f){var w=ma(f,Dl(Su));return tl(l,Wt,g,f,w)}),ag=Qs(function(l,f){return tl(l,Pi,g,g,g,f)});function lg(l,f){if(typeof l!="function")throw new Gi(Z);return f=f===g?f:Xi(f),Si(l,f)}function cg(l,f){if(typeof l!="function")throw new Gi(Z);return f=f==null?0:Ar(Xi(f),0),Si(function(w){var z=w[f],q=ec(w,0,f);return z&&cs(q,z),Hr(l,this,q)})}function Am(l,f,w){var z=!0,q=!0;if(typeof l!="function")throw new Gi(Z);return tr(w)&&(z="leading"in w?!!w.leading:z,q="trailing"in w?!!w.trailing:q),Em(l,f,{leading:z,maxWait:f,trailing:q})}function Sm(l){return Tm(l,1)}function ug(l,f){return Xd(bd(f),l)}function hg(){if(!arguments.length)return[];var l=arguments[0];return Fi(l)?l:[l]}function dg(l){return b(l,tt)}function tp(l,f){return f=typeof f=="function"?f:g,b(l,tt,f)}function Kd(l){return b(l,de|tt)}function Yd(l,f){return f=typeof f=="function"?f:g,b(l,de|tt,f)}function fg(l,f){return f==null||S(l,f,Pr(f))}function al(l,f){return l===f||l!==l&&f!==f}var Gh=As(je),jh=As(function(l,f){return l>=f}),Nc=Oe(function(){return arguments}())?Oe:function(l){return hr(l)&&ji.call(l,"callee")&&!$l.call(l,"callee")},Fi=et.isArray,Im=hl?Mr(hl):Ze;function Is(l){return l!=null&&Uc(l.length)&&!kl(l)}function Vr(l){return hr(l)&&Is(l)}function Cm(l){return l===!0||l===!1||hr(l)&&Be(l)==fi}var rc=Sc||uf,Mm=dl?Mr(dl):ut;function Dm(l){return hr(l)&&l.nodeType===1&&!Vc(l)}function Lm(l){if(l==null)return!0;if(Is(l)&&(Fi(l)||typeof l=="string"||typeof l.splice=="function"||rc(l)||nh(l)||Nc(l)))return!l.length;var f=ko(l);if(f==Gt||f==dr)return!l.size;if(ic(l))return!xn(l).length;for(var w in l)if(ji.call(l,w))return!1;return!0}function pg(l,f){return pt(l,f)}function mg(l,f,w){w=typeof w=="function"?w:g;var z=w?w(l,f):g;return z===g?pt(l,f,g,w):!!z}function Jd(l){if(!hr(l))return!1;var f=Be(l);return f==Bt||f==zr||typeof l.message=="string"&&typeof l.name=="string"&&!Vc(l)}function Qd(l){return typeof l=="number"&&fh(l)}function kl(l){if(!tr(l))return!1;var f=Be(l);return f==Oi||f==ro||f==hn||f==ka}function Bo(l){return typeof l=="number"&&l==Xi(l)}function Uc(l){return typeof l=="number"&&l>-1&&l%1==0&&l<=nn}function tr(l){var f=typeof l;return l!=null&&(f=="object"||f=="function")}function hr(l){return l!=null&&typeof l=="object"}var ip=jl?Mr(jl):zi;function Pm(l,f){return l===f||Vt(l,f,vu(f))}function _g(l,f,w){return w=typeof w=="function"?w:g,Vt(l,f,vu(f),w)}function gg(l){return Om(l)&&l!=+l}function yg(l){if(Kp(l))throw new yi(N);return zt(l)}function vg(l){return l===null}function xg(l){return l==null}function Om(l){return typeof l=="number"||hr(l)&&Be(l)==Cr}function Vc(l){if(!hr(l)||Be(l)!=oo)return!1;var f=ya(l);if(f===null)return!0;var w=ji.call(f,"constructor")&&f.constructor;return typeof w=="function"&&w instanceof w&&Xr.call(w)==gs}var np=Wl?Mr(Wl):ei;function Rm(l){return Bo(l)&&l>=-nn&&l<=nn}var rp=Wa?Mr(Wa):qi;function Wh(l){return typeof l=="string"||!Fi(l)&&hr(l)&&Be(l)==Br}function ia(l){return typeof l=="symbol"||hr(l)&&Be(l)==Le}var nh=Us?Mr(Us):si;function bg(l){return l===g}function wg(l){return hr(l)&&ko(l)==br}function Tg(l){return hr(l)&&Be(l)==zs}var zm=As(In),Eg=As(function(l,f){return l<=f});function go(l){if(!l)return[];if(Is(l))return Wh(l)?Di(l):_o(l);if(Ys&&l[Ys])return Hl(l[Ys]());var f=ko(l),w=f==Gt?Xs:f==dr?Pe:jc;return w(l)}function So(l){if(!l)return l===0?l:0;if(l=Fo(l),l===pn||l===-pn){var f=l<0?-1:1;return f*Kt}return l===l?l:0}function Xi(l){var f=So(l),w=f%1;return f===f?w?f-w:f:0}function qh(l){return l?_(Xi(l),0,en):0}function Fo(l){if(typeof l=="number")return l;if(ia(l))return rn;if(tr(l)){var f=typeof l.valueOf=="function"?l.valueOf():l;l=tr(f)?f+"":f}if(typeof l!="string")return l===0?l:+l;l=_l(l);var w=ni.test(l);return w||Qt.test(l)?Vl(l.slice(2),w?2:8):yt.test(l)?rn:+l}function km(l){return Eo(l,ps(l))}function Ag(l){return l?_(Xi(l),-nn,nn):l===0?l:0}function Cn(l){return l==null?"":Es(l)}var Sg=Aa(function(l,f){if(ic(f)||Is(f)){Eo(f,Pr(f),l);return}for(var w in f)ji.call(f,w)&&Il(l,w,f[w])}),Bm=Aa(function(l,f){Eo(f,ps(f),l)}),Gc=Aa(function(l,f,w,z){Eo(f,ps(f),l,z)}),Fm=Aa(function(l,f,w,z){Eo(f,Pr(f),l,z)}),Nm=Qs(p);function Nn(l,f){var w=Al(l);return f==null?w:n(w,f)}var op=Si(function(l,f){l=Dn(l);var w=-1,z=f.length,q=z>2?f[2]:g;for(q&&$o(f[0],f[1],q)&&(z=1);++w<z;)for(var te=f[w],me=ps(te),Se=-1,Fe=me.length;++Se<Fe;){var ft=me[Se],_t=l[ft];(_t===g||al(_t,Mo[ft])&&!ji.call(l,ft))&&(l[ft]=te[ft])}return l}),Um=Si(function(l){return l.push(g,Mf),Hr(tf,g,l)});function Vm(l,f){return us(l,vi(f,3),le)}function oc(l,f){return us(l,vi(f,3),ve)}function rh(l,f){return l==null?l:ae(l,vi(f,3),ps)}function Gm(l,f){return l==null?l:oe(l,vi(f,3),ps)}function Ig(l,f){return l&&le(l,vi(f,3))}function Cg(l,f){return l&&ve(l,vi(f,3))}function Mg(l){return l==null?[]:ge(l,Pr(l))}function Dg(l){return l==null?[]:ge(l,ps(l))}function sp(l,f,w){var z=l==null?g:we(l,f);return z===g?w:z}function Lg(l,f){return l!=null&&Zp(l,f,Tt)}function ap(l,f){return l!=null&&Zp(l,f,Ne)}var Pg=di(function(l,f,w){f!=null&&typeof f.toString!="function"&&(f=Ci.call(f)),l[f]=w},$h(Cs)),Og=di(function(l,f,w){f!=null&&typeof f.toString!="function"&&(f=Ci.call(f)),ji.call(l,f)?l[f].push(w):l[f]=[w]},vi),ef=Si(Ve);function Pr(l){return Is(l)?Wu(l):xn(l)}function ps(l){return Is(l)?Wu(l,!0):Fn(l)}function Rg(l,f){var w={};return f=vi(f,3),le(l,function(z,q,te){h(w,f(z,q,te),z)}),w}function zg(l,f){var w={};return f=vi(f,3),le(l,function(z,q,te){h(w,q,f(z,q,te))}),w}var kg=Aa(function(l,f,w){ws(l,f,w)}),tf=Aa(function(l,f,w,z){ws(l,f,w,z)}),lp=Qs(function(l,f){var w={};if(l==null)return w;var z=!1;f=mn(f,function(te){return te=Rc(te,l),z||(z=te.length>1),te}),Eo(l,il(l),w),z&&(w=b(w,de|Re|tt,jp));for(var q=f.length;q--;)yd(w,f[q]);return w});function jm(l,f){return oh(l,Hd(vi(f)))}var na=Qs(function(l,f){return l==null?{}:mr(l,f)});function oh(l,f){if(l==null)return{};var w=mn(il(l),function(z){return[z]});return f=vi(f),po(l,w,function(z,q){return f(z,q[0])})}function sh(l,f,w){f=Rc(f,l);var z=-1,q=f.length;for(q||(q=1,l=g);++z<q;){var te=l==null?g:l[ol(f[z])];te===g&&(z=q,te=w),l=kl(te)?te.call(l):te}return l}function cp(l,f,w){return l==null?l:Ts(l,f,w)}function nf(l,f,w,z){return z=typeof z=="function"?z:g,l==null?l:Ts(l,f,w,z)}var Wm=Bc(Pr),up=Bc(ps);function qm(l,f,w){var z=Fi(l),q=z||rc(l)||nh(l);if(f=vi(f,4),w==null){var te=l&&l.constructor;q?w=z?new te:[]:tr(l)?w=kl(te)?Al(ya(l)):{}:w={}}return(q?bo:le)(l,function(me,Se,Fe){return f(w,me,Se,Fe)}),w}function Bg(l,f){return l==null?!0:yd(l,f)}function Zm(l,f,w){return l==null?l:Pp(l,f,bd(w))}function Hm(l,f,w,z){return z=typeof z=="function"?z:g,l==null?l:Pp(l,f,bd(w),z)}function jc(l){return l==null?[]:Zs(l,Pr(l))}function $m(l){return l==null?[]:Zs(l,ps(l))}function Fg(l,f,w){return w===g&&(w=f,f=g),w!==g&&(w=Fo(w),w=w===w?w:0),f!==g&&(f=Fo(f),f=f===f?f:0),_(Fo(l),f,w)}function Xm(l,f,w){return f=So(f),w===g?(w=f,f=0):w=So(w),l=Fo(l),st(l,f,w)}function sc(l,f,w){if(w&&typeof w!="boolean"&&$o(l,f,w)&&(f=w=g),w===g&&(typeof f=="boolean"?(w=f,f=g):typeof l=="boolean"&&(w=l,l=g)),l===g&&f===g?(l=0,f=1):(l=So(l),f===g?(f=l,l=0):f=So(f)),l>f){var z=l;l=f,f=z}if(w||l%1||f%1){var q=uu();return Nr(l+q*(f-l+Jc("1e-"+((q+"").length-1))),f)}return Ea(l,f)}var Km=yu(function(l,f,w){return f=f.toLowerCase(),l+(w?hp(f):f)});function hp(l){return Hh(Cn(l).toLowerCase())}function dp(l){return l=Cn(l),l&&l.replace(oi,ru).replace(wr,"")}function Ym(l,f,w){l=Cn(l),f=Es(f);var z=l.length;w=w===g?z:_(Xi(w),0,z);var q=w;return w-=f.length,w>=0&&l.slice(w,q)==f}function Ng(l){return l=Cn(l),l&&yc.test(l)?l.replace(aa,Zl):l}function Ug(l){return l=Cn(l),l&&V.test(l)?l.replace(ne,"\\$&"):l}var Jm=yu(function(l,f,w){return l+(w?"-":"")+f.toLowerCase()}),Qm=yu(function(l,f,w){return l+(w?" ":"")+f.toLowerCase()}),Zh=Np("toLowerCase");function e_(l,f,w){l=Cn(l),f=Xi(f);var z=f?_n(l):0;if(!f||z>=f)return l;var q=(f-z)/2;return zo(Ac(q),w)+l+zo(lu(q),w)}function t_(l,f,w){l=Cn(l),f=Xi(f);var z=f?_n(l):0;return f&&z<f?l+zo(f-z,w):l}function fp(l,f,w){l=Cn(l),f=Xi(f);var z=f?_n(l):0;return f&&z<f?zo(f-z,w)+l:l}function ah(l,f,w){return w||f==null?f=0:f&&(f=+f),eo(Cn(l).replace(j,""),f||0)}function i_(l,f,w){return(w?$o(l,f,w):f===g)?f=1:f=Xi(f),Ro(Cn(l),f)}function rf(){var l=arguments,f=Cn(l[0]);return l.length<3?f:f.replace(l[1],l[2])}var n_=yu(function(l,f,w){return l+(w?"_":"")+f.toLowerCase()});function of(l,f,w){return w&&typeof w!="number"&&$o(l,f,w)&&(f=w=g),w=w===g?en:w>>>0,w?(l=Cn(l),l&&(typeof f=="string"||f!=null&&!np(f))&&(f=Es(f),!f&&$s(l))?ec(Di(l),0,w):l.split(f,w)):[]}var sf=yu(function(l,f,w){return l+(w?" ":"")+Hh(f)});function Vg(l,f,w){return l=Cn(l),w=w==null?0:_(Xi(w),0,l.length),f=Es(f),l.slice(w,w+f.length)==f}function Gg(l,f,w){var z=K.templateSettings;w&&$o(l,f,w)&&(f=g),l=Cn(l),f=Gc({},f,z,Ih);var q=Gc({},f.imports,z.imports,Ih),te=Pr(q),me=Zs(q,te),Se,Fe,ft=0,_t=f.interpolate||Hi,Et="__p += '",jt=Ec((f.escape||Hi).source+"|"+_t.source+"|"+(_t===Qr?ht:Hi).source+"|"+(f.evaluate||Hi).source+"|$","g"),ui="//# sourceURL="+(ji.call(f,"sourceURL")?(f.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ua+"]")+`
`;l.replace(jt,function(Li,cn,gn,Ms,Ko,Ds){return gn||(gn=Ms),Et+=l.slice(ft,Ds).replace(li,vl),cn&&(Se=!0,Et+=`' +
__e(`+cn+`) +
'`),Ko&&(Fe=!0,Et+=`';
`+Ko+`;
__p += '`),gn&&(Et+=`' +
((__t = (`+gn+`)) == null ? '' : __t) +
'`),ft=Ds+Li.length,Li}),Et+=`';
`;var Mi=ji.call(f,"variable")&&f.variable;if(!Mi)Et=`with (obj) {
`+Et+`
}
`;else if(Ae.test(Mi))throw new yi(o);Et=(Fe?Et.replace(qr,""):Et).replace(Bs,"$1").replace(Fa,"$1;"),Et="function("+(Mi||"obj")+`) {
`+(Mi?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Se?", __e = _.escape":"")+(Fe?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Et+`return __p
}`;var Yi=ac(function(){return on(te,ui+"return "+Et).apply(g,me)});if(Yi.source=Et,Jd(Yi))throw Yi;return Yi}function jg(l){return Cn(l).toLowerCase()}function Wg(l){return Cn(l).toUpperCase()}function qg(l,f,w){if(l=Cn(l),l&&(w||f===g))return _l(l);if(!l||!(f=Es(f)))return l;var z=Di(l),q=Di(f),te=Hs(z,q),me=yl(z,q)+1;return ec(z,te,me).join("")}function lh(l,f,w){if(l=Cn(l),l&&(w||f===g))return l.slice(0,Hn(l)+1);if(!l||!(f=Es(f)))return l;var z=Di(l),q=yl(z,Di(f))+1;return ec(z,0,q).join("")}function pp(l,f,w){if(l=Cn(l),l&&(w||f===g))return l.replace(j,"");if(!l||!(f=Es(f)))return l;var z=Di(l),q=Hs(z,Di(f));return ec(z,q).join("")}function Zg(l,f){var w=Ut,z=qt;if(tr(f)){var q="separator"in f?f.separator:q;w="length"in f?Xi(f.length):w,z="omission"in f?Es(f.omission):z}l=Cn(l);var te=l.length;if($s(l)){var me=Di(l);te=me.length}if(w>=te)return l;var Se=w-_n(z);if(Se<1)return z;var Fe=me?ec(me,0,Se).join(""):l.slice(0,Se);if(q===g)return Fe+z;if(me&&(Se+=Fe.length-Se),np(q)){if(l.slice(Se).search(q)){var ft,_t=Fe;for(q.global||(q=Ec(q.source,Cn(Dt.exec(q))+"g")),q.lastIndex=0;ft=q.exec(_t);)var Et=ft.index;Fe=Fe.slice(0,Et===g?Se:Et)}}else if(l.indexOf(Es(q),Se)!=Se){var jt=Fe.lastIndexOf(q);jt>-1&&(Fe=Fe.slice(0,jt))}return Fe+z}function r_(l){return l=Cn(l),l&&gc.test(l)?l.replace(Io,Tr):l}var Hg=yu(function(l,f,w){return l+(w?" ":"")+f.toUpperCase()}),Hh=Np("toUpperCase");function o_(l,f,w){return l=Cn(l),f=w?g:f,f===g?ou(l)?pr(l):Ws(l):l.match(f)||[]}var ac=Si(function(l,f){try{return Hr(l,g,f)}catch(w){return Jd(w)?w:new yi(w)}}),s_=Qs(function(l,f){return bo(f,function(w){w=ol(w),h(l,w,ep(l[w],l))}),l});function a_(l){var f=l==null?0:l.length,w=vi();return l=f?mn(l,function(z){if(typeof z[1]!="function")throw new Gi(Z);return[w(z[0]),z[1]]}):[],Si(function(z){for(var q=-1;++q<f;){var te=l[q];if(Hr(te[0],this,z))return Hr(te[1],this,z)}})}function af(l){return E(b(l,de))}function $h(l){return function(){return l}}function $g(l,f){return l==null||l!==l?f:l}var l_=Vp(),Iu=Vp(!0);function Cs(l){return l}function Bl(l){return dn(typeof l=="function"?l:b(l,de))}function Xg(l){return Oo(b(l,de))}function Xh(l,f){return bs(l,b(f,de))}var Kh=Si(function(l,f){return function(w){return Ve(w,l,f)}}),Yh=Si(function(l,f){return function(w){return Ve(l,w,f)}});function Cu(l,f,w){var z=Pr(f),q=ge(f,z);w==null&&!(tr(f)&&(q.length||!z.length))&&(w=f,f=l,l=this,q=ge(f,Pr(f)));var te=!(tr(w)&&"chain"in w)||!!w.chain,me=kl(l);return bo(q,function(Se){var Fe=f[Se];l[Se]=Fe,me&&(l.prototype[Se]=function(){var ft=this.__chain__;if(te||ft){var _t=l(this.__wrapped__),Et=_t.__actions__=_o(this.__actions__);return Et.push({func:Fe,args:arguments,thisArg:l}),_t.__chain__=ft,_t}return Fe.apply(l,cs([this.value()],arguments))})}),l}function lf(){return ar._===this&&(ar._=Fu),this}function mp(){}function Kg(l){return l=Xi(l),Si(function(f){return Ln(f,l)})}var ch=Hu(mn),cf=Hu($i),Yg=Hu(pl);function _p(l){return Id(l)?pa(ol(l)):Wn(l)}function c_(l){return function(f){return l==null?g:we(l,f)}}var Jg=Cf(),u_=Cf(!0);function gp(){return[]}function uf(){return!1}function Qg(){return{}}function h_(){return""}function ey(){return!0}function ty(l,f){if(l=Xi(l),l<1||l>nn)return[];var w=en,z=Nr(l,en);f=vi(f),l-=en;for(var q=ml(z,f);++w<l;)f(w);return q}function hf(l){return Fi(l)?mn(l,ol):ia(l)?[l]:_o(kf(Cn(l)))}function df(l){var f=++Do;return Cn(l)+f}var ff=el(function(l,f){return l+f},0),iy=tc("ceil"),yp=el(function(l,f){return l/f},1),vp=tc("floor");function Wc(l){return l&&l.length?Y(l,Cs,je):g}function ny(l,f){return l&&l.length?Y(l,vi(f,2),je):g}function xp(l){return tu(l,Cs)}function d_(l,f){return tu(l,vi(f,2))}function pf(l){return l&&l.length?Y(l,Cs,In):g}function ry(l,f){return l&&l.length?Y(l,vi(f,2),In):g}var oy=el(function(l,f){return l*f},1),sy=tc("round"),ay=el(function(l,f){return l-f},0);function bp(l){return l&&l.length?nu(l,Cs):0}function ly(l,f){return l&&l.length?nu(l,vi(f,2)):0}return K.after=Uh,K.ary=Tm,K.assign=Sg,K.assignIn=Bm,K.assignInWith=Gc,K.assignWith=Fm,K.at=Nm,K.before=jd,K.bind=ep,K.bindAll=s_,K.bindKey=Wd,K.castArray=hg,K.chain=$f,K.chunk=Ku,K.compact=Yu,K.concat=Oh,K.cond=a_,K.conforms=af,K.constant=$h,K.countBy=gm,K.create=Nn,K.curry=qd,K.curryRight=Vh,K.debounce=Em,K.defaults=op,K.defaultsDeep=Um,K.defer=ng,K.delay=rg,K.difference=Od,K.differenceBy=Yp,K.differenceWith=Rh,K.drop=Bf,K.dropRight=Jp,K.dropRightWhile=Ju,K.dropWhile=Qp,K.fill=Ff,K.filter=kh,K.flatMap=Y_,K.flatMapDeep=J_,K.flatMapDepth=Q_,K.flatten=tm,K.flattenDeep=zh,K.flattenDepth=im,K.flip=og,K.flow=l_,K.flowRight=Iu,K.fromPairs=an,K.functions=Mg,K.functionsIn=Dg,K.groupBy=Yf,K.initial=zl,K.intersection=sl,K.intersectionBy=ta,K.intersectionWith=Ao,K.invert=Pg,K.invertBy=Og,K.invokeMap=ih,K.iteratee=Bl,K.keyBy=tg,K.keys=Pr,K.keysIn=ps,K.map=ur,K.mapKeys=Rg,K.mapValues=zg,K.matches=Xg,K.matchesProperty=Xh,K.memoize=Zd,K.merge=kg,K.mergeWith=tf,K.method=Kh,K.methodOf=Yh,K.mixin=Cu,K.negate=Hd,K.nthArg=Kg,K.omit=lp,K.omitBy=jm,K.once=$d,K.orderBy=Ud,K.over=ch,K.overArgs=sg,K.overEvery=cf,K.overSome=Yg,K.partial=Xd,K.partialRight=Su,K.partition=xm,K.pick=na,K.pickBy=oh,K.property=_p,K.propertyOf=c_,K.pull=Uf,K.pullAll=Vf,K.pullAllBy=Gf,K.pullAllWith=k_,K.pullAt=jf,K.range=Jg,K.rangeRight=u_,K.rearg=ag,K.reject=Bh,K.remove=om,K.rest=lg,K.reverse=Wf,K.sampleSize=wm,K.set=cp,K.setWith=nf,K.shuffle=Fh,K.slice=nc,K.sortBy=ig,K.sortedUniq=am,K.sortedUniqBy=F_,K.split=of,K.spread=cg,K.tail=Zf,K.take=N_,K.takeRight=Hf,K.takeRightWhile=lm,K.takeWhile=cm,K.tap=Xf,K.throttle=Am,K.thru=Ca,K.toArray=go,K.toPairs=Wm,K.toPairsIn=up,K.toPath=hf,K.toPlainObject=km,K.transform=qm,K.unary=Sm,K.union=Eu,K.unionBy=um,K.unionWith=U_,K.uniq=eh,K.uniqBy=Bd,K.uniqWith=hm,K.unset=Bg,K.unzip=Fd,K.unzipWith=dm,K.update=Zm,K.updateWith=Hm,K.values=jc,K.valuesIn=$m,K.without=V_,K.words=o_,K.wrap=ug,K.xor=fm,K.xorBy=G_,K.xorWith=pm,K.zip=j_,K.zipObject=W_,K.zipObjectDeep=mm,K.zipWith=_m,K.entries=Wm,K.entriesIn=up,K.extend=Bm,K.extendWith=Gc,Cu(K,K),K.add=ff,K.attempt=ac,K.camelCase=Km,K.capitalize=hp,K.ceil=iy,K.clamp=Fg,K.clone=dg,K.cloneDeep=Kd,K.cloneDeepWith=Yd,K.cloneWith=tp,K.conformsTo=fg,K.deburr=dp,K.defaultTo=$g,K.divide=yp,K.endsWith=Ym,K.eq=al,K.escape=Ng,K.escapeRegExp=Ug,K.every=Au,K.find=X_,K.findIndex=Nf,K.findKey=Vm,K.findLast=K_,K.findLastIndex=em,K.findLastKey=oc,K.floor=vp,K.forEach=ym,K.forEachRight=vm,K.forIn=rh,K.forInRight=Gm,K.forOwn=Ig,K.forOwnRight=Cg,K.get=sp,K.gt=Gh,K.gte=jh,K.has=Lg,K.hasIn=ap,K.head=Rd,K.identity=Cs,K.includes=eg,K.indexOf=Rl,K.inRange=Xm,K.invoke=ef,K.isArguments=Nc,K.isArray=Fi,K.isArrayBuffer=Im,K.isArrayLike=Is,K.isArrayLikeObject=Vr,K.isBoolean=Cm,K.isBuffer=rc,K.isDate=Mm,K.isElement=Dm,K.isEmpty=Lm,K.isEqual=pg,K.isEqualWith=mg,K.isError=Jd,K.isFinite=Qd,K.isFunction=kl,K.isInteger=Bo,K.isLength=Uc,K.isMap=ip,K.isMatch=Pm,K.isMatchWith=_g,K.isNaN=gg,K.isNative=yg,K.isNil=xg,K.isNull=vg,K.isNumber=Om,K.isObject=tr,K.isObjectLike=hr,K.isPlainObject=Vc,K.isRegExp=np,K.isSafeInteger=Rm,K.isSet=rp,K.isString=Wh,K.isSymbol=ia,K.isTypedArray=nh,K.isUndefined=bg,K.isWeakMap=wg,K.isWeakSet=Tg,K.join=nm,K.kebabCase=Jm,K.last=Xn,K.lastIndexOf=rm,K.lowerCase=Qm,K.lowerFirst=Zh,K.lt=zm,K.lte=Eg,K.max=Wc,K.maxBy=ny,K.mean=xp,K.meanBy=d_,K.min=pf,K.minBy=ry,K.stubArray=gp,K.stubFalse=uf,K.stubObject=Qg,K.stubString=h_,K.stubTrue=ey,K.multiply=oy,K.nth=Qu,K.noConflict=lf,K.noop=mp,K.now=Nh,K.pad=e_,K.padEnd=t_,K.padStart=fp,K.parseInt=ah,K.random=sc,K.reduce=Vd,K.reduceRight=Gd,K.repeat=i_,K.replace=rf,K.result=sh,K.round=sy,K.runInContext=De,K.sample=bm,K.size=Jf,K.snakeCase=n_,K.some=Qf,K.sortedIndex=Tu,K.sortedIndexBy=zd,K.sortedIndexOf=kd,K.sortedLastIndex=qf,K.sortedLastIndexBy=sm,K.sortedLastIndexOf=B_,K.startCase=sf,K.startsWith=Vg,K.subtract=ay,K.sum=bp,K.sumBy=ly,K.template=Gg,K.times=ty,K.toFinite=So,K.toInteger=Xi,K.toLength=qh,K.toLower=jg,K.toNumber=Fo,K.toSafeInteger=Ag,K.toString=Cn,K.toUpper=Wg,K.trim=qg,K.trimEnd=lh,K.trimStart=pp,K.truncate=Zg,K.unescape=r_,K.uniqueId=df,K.upperCase=Hg,K.upperFirst=Hh,K.each=ym,K.eachRight=vm,K.first=Rd,Cu(K,function(){var l={};return le(K,function(f,w){ji.call(K.prototype,w)||(l[w]=f)}),l}(),{chain:!1}),K.VERSION=M,bo(["bind","bindKey","curry","curryRight","partial","partialRight"],function(l){K[l].placeholder=K}),bo(["drop","take"],function(l,f){Ai.prototype[l]=function(w){w=w===g?1:Ar(Xi(w),0);var z=this.__filtered__&&!f?new Ai(this):this.clone();return z.__filtered__?z.__takeCount__=Nr(w,z.__takeCount__):z.__views__.push({size:Nr(w,en),type:l+(z.__dir__<0?"Right":"")}),z},Ai.prototype[l+"Right"]=function(w){return this.reverse()[l](w).reverse()}}),bo(["filter","map","takeWhile"],function(l,f){var w=f+1,z=w==fn||w==Mn;Ai.prototype[l]=function(q){var te=this.clone();return te.__iteratees__.push({iteratee:vi(q,3),type:w}),te.__filtered__=te.__filtered__||z,te}}),bo(["head","last"],function(l,f){var w="take"+(f?"Right":"");Ai.prototype[l]=function(){return this[w](1).value()[0]}}),bo(["initial","tail"],function(l,f){var w="drop"+(f?"":"Right");Ai.prototype[l]=function(){return this.__filtered__?new Ai(this):this[w](1)}}),Ai.prototype.compact=function(){return this.filter(Cs)},Ai.prototype.find=function(l){return this.filter(l).head()},Ai.prototype.findLast=function(l){return this.reverse().find(l)},Ai.prototype.invokeMap=Si(function(l,f){return typeof l=="function"?new Ai(this):this.map(function(w){return Ve(w,l,f)})}),Ai.prototype.reject=function(l){return this.filter(Hd(vi(l)))},Ai.prototype.slice=function(l,f){l=Xi(l);var w=this;return w.__filtered__&&(l>0||f<0)?new Ai(w):(l<0?w=w.takeRight(-l):l&&(w=w.drop(l)),f!==g&&(f=Xi(f),w=f<0?w.dropRight(-f):w.take(f-l)),w)},Ai.prototype.takeRightWhile=function(l){return this.reverse().takeWhile(l).reverse()},Ai.prototype.toArray=function(){return this.take(en)},le(Ai.prototype,function(l,f){var w=/^(?:filter|find|map|reject)|While$/.test(f),z=/^(?:head|last)$/.test(f),q=K[z?"take"+(f=="last"?"Right":""):f],te=z||/^find/.test(f);q&&(K.prototype[f]=function(){var me=this.__wrapped__,Se=z?[1]:arguments,Fe=me instanceof Ai,ft=Se[0],_t=Fe||Fi(me),Et=function(cn){var gn=q.apply(K,cs([cn],Se));return z&&jt?gn[0]:gn};_t&&w&&typeof ft=="function"&&ft.length!=1&&(Fe=_t=!1);var jt=this.__chain__,ui=!!this.__actions__.length,Mi=te&&!jt,Yi=Fe&&!ui;if(!te&&_t){me=Yi?me:new Ai(this);var Li=l.apply(me,Se);return Li.__actions__.push({func:Ca,args:[Et],thisArg:g}),new Po(Li,jt)}return Mi&&Yi?l.apply(this,Se):(Li=this.thru(Et),Mi?z?Li.value()[0]:Li.value():Li)})}),bo(["pop","push","shift","sort","splice","unshift"],function(l){var f=Ks[l],w=/^(?:push|sort|unshift)$/.test(l)?"tap":"thru",z=/^(?:pop|shift)$/.test(l);K.prototype[l]=function(){var q=arguments;if(z&&!this.__chain__){var te=this.value();return f.apply(Fi(te)?te:[],q)}return this[w](function(me){return f.apply(Fi(me)?me:[],q)})}}),le(Ai.prototype,function(l,f){var w=K[f];if(w){var z=w.name+"";ji.call(Kl,z)||(Kl[z]=[]),Kl[z].push({name:f,func:w})}}),Kl[cr(g,Je).name]=[{name:"wrapper",func:g}],Ai.prototype.clone=wf,Ai.prototype.reverse=ad,Ai.prototype.value=Tf,K.prototype.at=Ss,K.prototype.chain=q_,K.prototype.commit=Kf,K.prototype.next=Z_,K.prototype.plant=$_,K.prototype.reverse=th,K.prototype.toJSON=K.prototype.valueOf=K.prototype.value=Nd,K.prototype.first=K.prototype.head,Ys&&(K.prototype[Ys]=H_),K},Dr=ds();Bn?((Bn.exports=Dr)._=Dr,ls._=Dr):ar._=Dr}).call(cc)})(ex,vf);function tx(D){return D.type!==void 0}function ix(D){return D.type==="Feature"}function E0(D){return D.type==="FeatureCollection"}function nx(D){if(D&&typeof D=="object"){if(D.type==="FeatureCollection"&&Array.isArray(D.features))return D.features.every(x=>x&&typeof x=="object"&&x.type==="Feature"&&x.geometry&&typeof x.geometry=="object");if(D.type==="Feature"&&D.geometry&&typeof D.geometry=="object")return!0;if(D.type&&typeof D.type=="string"&&D.geometry&&typeof D.geometry=="object")return!0}return!1}function rx(D){let x;return{c(){x=Oa("check")},l(g){x=Ra(g,"check")},m(g,M){Ni(g,x,M)},d(g){g&&Xt(x)}}}function ox(D){let x;function g(N,Z){return rx}let M=g(),P=M&&M(D);return{c(){P&&P.c(),x=Ir()},l(N){P&&P.l(N),x=Ir()},m(N,Z){P&&P.m(N,Z),Ni(N,x,Z)},p:Nl,d(N){P&&P.d(N),N&&Xt(x)}}}function sx(D){let x=D[1].get(cx)+"",g;return{c(){g=Oa(x)},l(M){g=Ra(M,x)},m(M,P){Ni(M,g,P)},p:Nl,d(M){M&&Xt(g)}}}function ax(D){let x,g,M,P,N;return g=new L_({props:{class:"material-icons",$$slots:{default:[ox]},$$scope:{ctx:D}}}),P=new M_({props:{$$slots:{default:[sx]},$$scope:{ctx:D}}}),{c(){x=Yn("span"),Tn(g.$$.fragment),M=yr(),Tn(P.$$.fragment),this.h()},l(Z){x=Jn(Z,"SPAN",{class:!0});var o=xr(x);qn(g.$$.fragment,o),o.forEach(Xt),M=vr(Z),qn(P.$$.fragment,Z),this.h()},h(){wn(x,"class","remove-btn svelte-1rtasbz")},m(Z,o){Ni(Z,x,o),En(g,x,null),Ni(Z,M,o),En(P,Z,o),N=!0},p(Z,o){const B={};o&16&&(B.$$scope={dirty:o,ctx:Z}),g.$set(B);const ce={};o&16&&(ce.$$scope={dirty:o,ctx:Z}),P.$set(ce)},i(Z){N||(xi(g.$$.fragment,Z),xi(P.$$.fragment,Z),N=!0)},o(Z){wi(g.$$.fragment,Z),wi(P.$$.fragment,Z),N=!1},d(Z){Z&&Xt(x),An(g),Z&&Xt(M),An(P,Z)}}}function lx(D){let x,g,M,P,N,Z,o=D[0].name+"",B,ce,_e,de;return _e=new E_({props:{$$slots:{default:[ax]},$$scope:{ctx:D}}}),{c(){x=Yn("div"),g=Yn("img"),N=yr(),Z=Yn("p"),B=Oa(o),ce=yr(),Tn(_e.$$.fragment),this.h()},l(Re){x=Jn(Re,"DIV",{class:!0});var tt=xr(x);g=Jn(tt,"IMG",{class:!0,src:!0,alt:!0}),N=vr(tt),Z=Jn(tt,"P",{class:!0});var Ce=xr(Z);B=Ra(Ce,o),Ce.forEach(Xt),ce=vr(tt),qn(_e.$$.fragment,tt),tt.forEach(Xt),this.h()},h(){wn(g,"class","icon svelte-1rtasbz"),Ey(g.src,M="button-icons/polygon.png")||wn(g,"src",M),wn(g,"alt",P=D[0].name),wn(Z,"class","description"),wn(x,"class","item svelte-1rtasbz")},m(Re,tt){Ni(Re,x,tt),bn(x,g),bn(x,N),bn(x,Z),bn(Z,B),bn(x,ce),En(_e,x,null),de=!0},p(Re,[tt]){(!de||tt&1&&P!==(P=Re[0].name))&&wn(g,"alt",P),(!de||tt&1)&&o!==(o=Re[0].name+"")&&Py(B,o);const Ce={};tt&16&&(Ce.$$scope={dirty:tt,ctx:Re}),_e.$set(Ce)},i(Re){de||(xi(_e.$$.fragment,Re),de=!0)},o(Re){wi(_e.$$.fragment,Re),de=!1},d(Re){Re&&Xt(x),An(_e)}}}let cx="acceptEdit";function ux(D,x,g){let{item:M}=x,{index:P}=x;tx(M.data)?M.data:ix(M.data)?M.data.geometry:E0(M.data)&&vf.map(M.data.features,Z=>Z.geometry);const N=new Map([["remove","Remove layer"],["acceptEdit","Accept layer edit"],["cancelEdit","Exit edit mode"]]);return D.$$set=Z=>{"item"in Z&&g(0,M=Z.item),"index"in Z&&g(2,P=Z.index)},[M,N,P]}class hx extends Os{constructor(x){super(),Rs(this,x,ux,lx,Qo,{item:0,index:2})}}class dx{constructor(x){$y(this,"cb");this.cb=x}setupReader(x,g){x.onload=M=>{if(M.target&&M.target.result){const P=M.target.result,N=JSON.parse(P);if(console.log(N),!nx(N)){console.error("Not a geojson file!");return}if(E0(N)){const Z=vf.groupBy(N.features,o=>o.geometry.type);console.log(Z)}this.cb(g.replace(".json",""),N)}}}readFile(x){if(x.type!=="application/json"){console.error("Not a json file!");return}const g=new FileReader;this.setupReader(g,x.name),g.readAsText(x)}readFiles(x){const g=vf.map(x,M=>new Promise(()=>this.readFile(M)));Promise.all(g).then(()=>console.log("Done reading files"))}}function _0(D){let x;return{c(){x=Yn("div"),this.h()},l(g){x=Jn(g,"DIV",{class:!0}),xr(x).forEach(Xt),this.h()},h(){wn(x,"class","mdc-button__touch")},m(g,M){Ni(g,x,M)},d(g){g&&Xt(x)}}}function fx(D){let x,g,M,P;const N=D[28].default,Z=fc(N,D,D[30],null);let o=D[6]&&_0();return{c(){x=Yn("div"),g=yr(),Z&&Z.c(),o&&o.c(),M=Ir(),this.h()},l(B){x=Jn(B,"DIV",{class:!0}),xr(x).forEach(Xt),g=vr(B),Z&&Z.l(B),o&&o.l(B),M=Ir(),this.h()},h(){wn(x,"class","mdc-button__ripple")},m(B,ce){Ni(B,x,ce),Ni(B,g,ce),Z&&Z.m(B,ce),o&&o.m(B,ce),Ni(B,M,ce),P=!0},p(B,ce){Z&&Z.p&&(!P||ce[0]&1073741824)&&pc(Z,N,B,B[30],P?_c(N,B[30],ce,null):mc(B[30]),null),B[6]?o||(o=_0(),o.c(),o.m(M.parentNode,M)):o&&(o.d(1),o=null)},i(B){P||(xi(Z,B),P=!0)},o(B){wi(Z,B),P=!1},d(B){B&&Xt(x),B&&Xt(g),Z&&Z.d(B),o&&o.d(B),B&&Xt(M)}}}function px(D){let x,g,M;const P=[{tag:D[10]},{use:[[C_,{ripple:D[3],unbounded:!1,color:D[4],disabled:!!D[23].disabled,addClass:D[19],removeClass:D[20],addStyle:D[21]}],D[17],...D[0]]},{class:Ps({[D[1]]:!0,"mdc-button":!0,"mdc-button--raised":D[5]==="raised","mdc-button--unelevated":D[5]==="unelevated","mdc-button--outlined":D[5]==="outlined","smui-button--color-secondary":D[4]==="secondary","mdc-button--touch":D[6],"mdc-card__action":D[18]==="card:action","mdc-card__action--button":D[18]==="card:action","mdc-dialog__button":D[18]==="dialog:action","mdc-top-app-bar__navigation-icon":D[18]==="top-app-bar:navigation","mdc-top-app-bar__action-item":D[18]==="top-app-bar:action","mdc-snackbar__action":D[18]==="snackbar:actions","mdc-banner__secondary-action":D[18]==="banner"&&D[8],"mdc-banner__primary-action":D[18]==="banner"&&!D[8],"mdc-tooltip__action":D[18]==="tooltip:rich-actions",...D[12]})},{style:Object.entries(D[13]).map(g0).concat([D[2]]).join(" ")},D[16],D[15],D[14],{href:D[7]},D[23]];var N=D[9];function Z(o){let B={$$slots:{default:[fx]},$$scope:{ctx:o}};for(let ce=0;ce<P.length;ce+=1)B=Qn(B,P[ce]);return{props:B}}return N&&(x=Xc(N,Z(D)),D[29](x),x.$on("click",D[22])),{c(){x&&Tn(x.$$.fragment),g=Ir()},l(o){x&&qn(x.$$.fragment,o),g=Ir()},m(o,B){x&&En(x,o,B),Ni(o,g,B),M=!0},p(o,B){const ce=B[0]&12580351?hc(P,[B[0]&1024&&{tag:o[10]},B[0]&12189721&&{use:[[C_,{ripple:o[3],unbounded:!1,color:o[4],disabled:!!o[23].disabled,addClass:o[19],removeClass:o[20],addStyle:o[21]}],o[17],...o[0]]},B[0]&266610&&{class:Ps({[o[1]]:!0,"mdc-button":!0,"mdc-button--raised":o[5]==="raised","mdc-button--unelevated":o[5]==="unelevated","mdc-button--outlined":o[5]==="outlined","smui-button--color-secondary":o[4]==="secondary","mdc-button--touch":o[6],"mdc-card__action":o[18]==="card:action","mdc-card__action--button":o[18]==="card:action","mdc-dialog__button":o[18]==="dialog:action","mdc-top-app-bar__navigation-icon":o[18]==="top-app-bar:navigation","mdc-top-app-bar__action-item":o[18]==="top-app-bar:action","mdc-snackbar__action":o[18]==="snackbar:actions","mdc-banner__secondary-action":o[18]==="banner"&&o[8],"mdc-banner__primary-action":o[18]==="banner"&&!o[8],"mdc-tooltip__action":o[18]==="tooltip:rich-actions",...o[12]})},B[0]&8196&&{style:Object.entries(o[13]).map(g0).concat([o[2]]).join(" ")},B[0]&65536&&ll(o[16]),B[0]&32768&&ll(o[15]),B[0]&16384&&ll(o[14]),B[0]&128&&{href:o[7]},B[0]&8388608&&ll(o[23])]):{};if(B[0]&1073741888&&(ce.$$scope={dirty:B,ctx:o}),B[0]&512&&N!==(N=o[9])){if(x){Ru();const _e=x;wi(_e.$$.fragment,1,0,()=>{An(_e,1)}),zu()}N?(x=Xc(N,Z(o)),o[29](x),x.$on("click",o[22]),Tn(x.$$.fragment),xi(x.$$.fragment,1),En(x,g.parentNode,g)):x=null}else N&&x.$set(ce)},i(o){M||(x&&xi(x.$$.fragment,o),M=!0)},o(o){x&&wi(x.$$.fragment,o),M=!1},d(o){D[29](null),o&&Xt(g),x&&An(x,o)}}}const g0=([D,x])=>`${D}: ${x};`;function mx(D,x,g){let M,P,N;const Z=["use","class","style","ripple","color","variant","touch","href","action","defaultAction","secondary","component","tag","getElement"];let o=Jo(x,Z),{$$slots:B={},$$scope:ce}=x;const _e=ku(Ou());let{use:de=[]}=x,{class:Re=""}=x,{style:tt=""}=x,{ripple:Ce=!0}=x,{color:qe="primary"}=x,{variant:rt="text"}=x,{touch:Je=!1}=x,{href:Qe=void 0}=x,{action:Mt="close"}=x,{defaultAction:lt=!1}=x,{secondary:$e=!1}=x,Wt,ti={},Pi={},Ht=uc("SMUI:button:context"),{component:Ut=Kc}=x,{tag:qt=Ut===Kc?Qe==null?"button":"a":void 0}=x,Ti=o.disabled;rd("SMUI:label:context","button"),rd("SMUI:icon:context","button");function ki(Kt){ti[Kt]||g(12,ti[Kt]=!0,ti)}function fn(Kt){(!(Kt in ti)||ti[Kt])&&g(12,ti[Kt]=!1,ti)}function ii(Kt,rn){Pi[Kt]!=rn&&(rn===""||rn==null?(delete Pi[Kt],g(13,Pi)):g(13,Pi[Kt]=rn,Pi))}function Mn(){Ht==="banner"&&I_(pn(),$e?"SMUIBannerButton:secondaryActionClick":"SMUIBannerButton:primaryActionClick")}function pn(){return Wt.getElement()}function nn(Kt){dc[Kt?"unshift":"push"](()=>{Wt=Kt,g(11,Wt)})}return D.$$set=Kt=>{g(31,x=Qn(Qn({},x),$c(Kt))),g(23,o=Jo(x,Z)),"use"in Kt&&g(0,de=Kt.use),"class"in Kt&&g(1,Re=Kt.class),"style"in Kt&&g(2,tt=Kt.style),"ripple"in Kt&&g(3,Ce=Kt.ripple),"color"in Kt&&g(4,qe=Kt.color),"variant"in Kt&&g(5,rt=Kt.variant),"touch"in Kt&&g(6,Je=Kt.touch),"href"in Kt&&g(7,Qe=Kt.href),"action"in Kt&&g(24,Mt=Kt.action),"defaultAction"in Kt&&g(25,lt=Kt.defaultAction),"secondary"in Kt&&g(8,$e=Kt.secondary),"component"in Kt&&g(9,Ut=Kt.component),"tag"in Kt&&g(10,qt=Kt.tag),"$$scope"in Kt&&g(30,ce=Kt.$$scope)},D.$$.update=()=>{if(g(16,M=Ht==="dialog:action"&&Mt!=null?{"data-mdc-dialog-action":Mt}:{action:x.action}),g(15,P=Ht==="dialog:action"&&lt?{"data-mdc-dialog-button-default":""}:{default:x.default}),g(14,N=Ht==="banner"?{}:{secondary:x.secondary}),Ti!==o.disabled){const Kt=pn();"blur"in Kt&&Kt.blur(),g(27,Ti=o.disabled)}},x=$c(x),[de,Re,tt,Ce,qe,rt,Je,Qe,$e,Ut,qt,Wt,ti,Pi,N,P,M,_e,Ht,ki,fn,ii,Mn,o,Mt,lt,pn,Ti,B,nn,ce]}class _x extends Os{constructor(x){super(),Rs(this,x,mx,px,Qo,{use:0,class:1,style:2,ripple:3,color:4,variant:5,touch:6,href:7,action:24,defaultAction:25,secondary:8,component:9,tag:10,getElement:26},null,[-1,-1])}get getElement(){return this.$$.ctx[26]}}function gx(D){let x;return{c(){x=Oa("layers")},l(g){x=Ra(g,"layers")},m(g,M){Ni(g,x,M)},d(g){g&&Xt(x)}}}function yx(D){let x;return{c(){x=Oa("Default")},l(g){x=Ra(g,"Default")},m(g,M){Ni(g,x,M)},d(g){g&&Xt(x)}}}function vx(D){let x,g;return x=new fv({props:{$$slots:{default:[yx]},$$scope:{ctx:D}}}),{c(){Tn(x.$$.fragment)},l(M){qn(x.$$.fragment,M)},m(M,P){En(x,M,P),g=!0},p(M,P){const N={};P&1024&&(N.$$scope={dirty:P,ctx:M}),x.$set(N)},i(M){g||(xi(x.$$.fragment,M),g=!0)},o(M){wi(x.$$.fragment,M),g=!1},d(M){An(x,M)}}}function xx(D){let x,g;return x=new hx({props:{item:D[8],index:D[9]}}),{c(){Tn(x.$$.fragment)},l(M){qn(x.$$.fragment,M)},m(M,P){En(x,M,P),g=!0},p(M,P){const N={};P&256&&(N.item=M[8]),P&512&&(N.index=M[9]),x.$set(N)},i(M){g||(xi(x.$$.fragment,M),g=!0)},o(M){wi(x.$$.fragment,M),g=!1},d(M){An(x,M)}}}function bx(D){let x;return{c(){x=Oa("upload_file")},l(g){x=Ra(g,"upload_file")},m(g,M){Ni(g,x,M)},d(g){g&&Xt(x)}}}function wx(D){let x;return{c(){x=Oa("Upload layers")},l(g){x=Ra(g,"Upload layers")},m(g,M){Ni(g,x,M)},d(g){g&&Xt(x)}}}function Tx(D){let x,g,M,P;return x=new L_({props:{class:"material-icons",$$slots:{default:[bx]},$$scope:{ctx:D}}}),x.$on("click",D[3]),M=new M_({props:{$$slots:{default:[wx]},$$scope:{ctx:D}}}),{c(){Tn(x.$$.fragment),g=yr(),Tn(M.$$.fragment)},l(N){qn(x.$$.fragment,N),g=vr(N),qn(M.$$.fragment,N)},m(N,Z){En(x,N,Z),Ni(N,g,Z),En(M,N,Z),P=!0},p(N,Z){const o={};Z&1024&&(o.$$scope={dirty:Z,ctx:N}),x.$set(o);const B={};Z&1024&&(B.$$scope={dirty:Z,ctx:N}),M.$set(B)},i(N){P||(xi(x.$$.fragment,N),xi(M.$$.fragment,N),P=!0)},o(N){wi(x.$$.fragment,N),wi(M.$$.fragment,N),P=!1},d(N){An(x,N),N&&Xt(g),An(M,N)}}}function Ex(D){let x;return{c(){x=Oa("download")},l(g){x=Ra(g,"download")},m(g,M){Ni(g,x,M)},d(g){g&&Xt(x)}}}function Ax(D){let x;return{c(){x=Oa("Download layer(s)")},l(g){x=Ra(g,"Download layer(s)")},m(g,M){Ni(g,x,M)},d(g){g&&Xt(x)}}}function Sx(D){let x,g,M,P;return x=new L_({props:{class:"material-icons",$$slots:{default:[Ex]},$$scope:{ctx:D}}}),M=new M_({props:{$$slots:{default:[Ax]},$$scope:{ctx:D}}}),{c(){Tn(x.$$.fragment),g=yr(),Tn(M.$$.fragment)},l(N){qn(x.$$.fragment,N),g=vr(N),qn(M.$$.fragment,N)},m(N,Z){En(x,N,Z),Ni(N,g,Z),En(M,N,Z),P=!0},p(N,Z){const o={};Z&1024&&(o.$$scope={dirty:Z,ctx:N}),x.$set(o);const B={};Z&1024&&(B.$$scope={dirty:Z,ctx:N}),M.$set(B)},i(N){P||(xi(x.$$.fragment,N),xi(M.$$.fragment,N),P=!0)},o(N){wi(x.$$.fragment,N),wi(M.$$.fragment,N),P=!1},d(N){An(x,N),N&&Xt(g),An(M,N)}}}function Ix(D){let x;return{c(){x=Oa("rule")},l(g){x=Ra(g,"rule")},m(g,M){Ni(g,x,M)},d(g){g&&Xt(x)}}}function Cx(D){let x;return{c(){x=Oa("Select layers")},l(g){x=Ra(g,"Select layers")},m(g,M){Ni(g,x,M)},d(g){g&&Xt(x)}}}function Mx(D){let x,g,M,P;return x=new L_({props:{class:"material-icons",$$slots:{default:[Ix]},$$scope:{ctx:D}}}),M=new M_({props:{$$slots:{default:[Cx]},$$scope:{ctx:D}}}),{c(){Tn(x.$$.fragment),g=yr(),Tn(M.$$.fragment)},l(N){qn(x.$$.fragment,N),g=vr(N),qn(M.$$.fragment,N)},m(N,Z){En(x,N,Z),Ni(N,g,Z),En(M,N,Z),P=!0},p(N,Z){const o={};Z&1024&&(o.$$scope={dirty:Z,ctx:N}),x.$set(o);const B={};Z&1024&&(B.$$scope={dirty:Z,ctx:N}),M.$set(B)},i(N){P||(xi(x.$$.fragment,N),xi(M.$$.fragment,N),P=!0)},o(N){wi(x.$$.fragment,N),wi(M.$$.fragment,N),P=!1},d(N){An(x,N),N&&Xt(g),An(M,N)}}}function Dx(D){let x,g,M,P,N,Z,o,B,ce,_e,de,Re,tt,Ce,qe,rt,Je,Qe,Mt,lt,$e,Wt,ti,Pi,Ht,Ut;return o=new gv({props:{class:"material-icons",$$slots:{default:[gx]},$$scope:{ctx:D}}}),de=new _x({props:{$$slots:{default:[vx]},$$scope:{ctx:D}}}),tt=new Qv({props:{list:D[1],key:null,$$slots:{default:[xx,({item:qt,index:Ti})=>({8:qt,9:Ti}),({item:qt,index:Ti})=>(qt?256:0)|(Ti?512:0)]},$$scope:{ctx:D}}}),tt.$on("sort",D[2]),Qe=new E_({props:{$$slots:{default:[Tx]},$$scope:{ctx:D}}}),Wt=new E_({props:{$$slots:{default:[Sx]},$$scope:{ctx:D}}}),Ht=new E_({props:{$$slots:{default:[Mx]},$$scope:{ctx:D}}}),{c(){x=Yn("div"),g=Yn("div"),M=Yn("span"),P=Yn("h2"),N=Oa("Layers"),Z=yr(),Tn(o.$$.fragment),B=yr(),ce=Yn("hr"),_e=yr(),Tn(de.$$.fragment),Re=yr(),Tn(tt.$$.fragment),Ce=yr(),qe=Yn("hr"),rt=yr(),Je=Yn("span"),Tn(Qe.$$.fragment),Mt=yr(),lt=Yn("input"),$e=yr(),Tn(Wt.$$.fragment),ti=yr(),Pi=Yn("span"),Tn(Ht.$$.fragment),this.h()},l(qt){x=Jn(qt,"DIV",{class:!0});var Ti=xr(x);g=Jn(Ti,"DIV",{class:!0});var ki=xr(g);M=Jn(ki,"SPAN",{class:!0});var fn=xr(M);P=Jn(fn,"H2",{style:!0});var ii=xr(P);N=Ra(ii,"Layers"),ii.forEach(Xt),Z=vr(fn),qn(o.$$.fragment,fn),fn.forEach(Xt),B=vr(ki),ce=Jn(ki,"HR",{class:!0}),_e=vr(ki),qn(de.$$.fragment,ki),Re=vr(ki),qn(tt.$$.fragment,ki),Ce=vr(ki),qe=Jn(ki,"HR",{style:!0,class:!0}),rt=vr(ki),Je=Jn(ki,"SPAN",{class:!0});var Mn=xr(Je);qn(Qe.$$.fragment,Mn),Mt=vr(Mn),lt=Jn(Mn,"INPUT",{id:!0,type:!0,style:!0}),$e=vr(Mn),qn(Wt.$$.fragment,Mn),ti=vr(Mn),Pi=Jn(Mn,"SPAN",{style:!0});var pn=xr(Pi);qn(Ht.$$.fragment,pn),pn.forEach(Xt),Mn.forEach(Xt),ki.forEach(Xt),Ti.forEach(Xt),this.h()},h(){m_(P,"margin","0"),wn(M,"class","layer-title svelte-uv3ytm"),wn(ce,"class","svelte-uv3ytm"),m_(qe,"margin-top","auto"),wn(qe,"class","svelte-uv3ytm"),wn(lt,"id","file-upload"),lt.multiple=!0,wn(lt,"type","file"),m_(lt,"display","none"),m_(Pi,"margin-left","auto"),wn(Je,"class","file-action-row svelte-uv3ytm"),wn(g,"class","content svelte-uv3ytm"),wn(x,"class","container svelte-uv3ytm")},m(qt,Ti){Ni(qt,x,Ti),bn(x,g),bn(g,M),bn(M,P),bn(P,N),bn(M,Z),En(o,M,null),bn(g,B),bn(g,ce),bn(g,_e),En(de,g,null),bn(g,Re),En(tt,g,null),bn(g,Ce),bn(g,qe),bn(g,rt),bn(g,Je),En(Qe,Je,null),bn(Je,Mt),bn(Je,lt),D[4](lt),bn(Je,$e),En(Wt,Je,null),bn(Je,ti),bn(Je,Pi),En(Ht,Pi,null),Ut=!0},p(qt,[Ti]){const ki={};Ti&1024&&(ki.$$scope={dirty:Ti,ctx:qt}),o.$set(ki);const fn={};Ti&1024&&(fn.$$scope={dirty:Ti,ctx:qt}),de.$set(fn);const ii={};Ti&2&&(ii.list=qt[1]),Ti&1792&&(ii.$$scope={dirty:Ti,ctx:qt}),tt.$set(ii);const Mn={};Ti&1025&&(Mn.$$scope={dirty:Ti,ctx:qt}),Qe.$set(Mn);const pn={};Ti&1024&&(pn.$$scope={dirty:Ti,ctx:qt}),Wt.$set(pn);const nn={};Ti&1024&&(nn.$$scope={dirty:Ti,ctx:qt}),Ht.$set(nn)},i(qt){Ut||(xi(o.$$.fragment,qt),xi(de.$$.fragment,qt),xi(tt.$$.fragment,qt),xi(Qe.$$.fragment,qt),xi(Wt.$$.fragment,qt),xi(Ht.$$.fragment,qt),Ut=!0)},o(qt){wi(o.$$.fragment,qt),wi(de.$$.fragment,qt),wi(tt.$$.fragment,qt),wi(Qe.$$.fragment,qt),wi(Wt.$$.fragment,qt),wi(Ht.$$.fragment,qt),Ut=!1},d(qt){qt&&Xt(x),An(o),An(de),An(tt),An(Qe),D[4](null),An(Wt),An(Ht)}}}function Lx(D,x,g){let M;Cp(D,T_,de=>g(1,M=de));const P=de=>{T_.set(de.detail)},N=new dx((de,Re)=>T_.update(tt=>[...tt,{name:de,data:Re}]));let Z,o;function B(de){const Re=de.target;Re.files&&Re.files.length>0&&(o=Re.files,console.log(o[0].text),N.readFiles(o))}Dy(()=>{Z.addEventListener("change",B)});const ce=()=>Z.click();function _e(de){dc[de?"unshift":"push"](()=>{Z=de,g(0,Z)})}return[Z,M,P,ce,_e]}class Px extends Os{constructor(x){super(),Rs(this,x,Lx,Dx,Qo,{})}}function Ox(D){let x,g,M,P,N,Z;return{c(){x=Yn("button"),g=Yn("img"),P=yr(),N=Yn("p"),Z=Oa(D[0]),this.h()},l(o){x=Jn(o,"BUTTON",{class:!0});var B=xr(x);g=Jn(B,"IMG",{class:!0,alt:!0,src:!0}),P=vr(B),N=Jn(B,"P",{class:!0});var ce=xr(N);Z=Ra(ce,D[0]),ce.forEach(Xt),B.forEach(Xt),this.h()},h(){wn(g,"class","button-icon svelte-15255n0"),wn(g,"alt","button"),Ey(g.src,M=D[1]||"button-icons/intersection.png")||wn(g,"src",M),wn(N,"class","svelte-15255n0"),wn(x,"class","svelte-15255n0")},m(o,B){Ni(o,x,B),bn(x,g),bn(x,P),bn(x,N),bn(N,Z)},p(o,[B]){B&2&&!Ey(g.src,M=o[1]||"button-icons/intersection.png")&&wn(g,"src",M),B&1&&Py(Z,o[0])},i:Nl,o:Nl,d(o){o&&Xt(x)}}}function Rx(D,x,g){let{name:M}=x,{iconPath:P}=x;return D.$$set=N=>{"name"in N&&g(0,M=N.name),"iconPath"in N&&g(1,P=N.iconPath)},[M,P]}class td extends Os{constructor(x){super(),Rs(this,x,Rx,Ox,Qo,{name:0,iconPath:1})}}function zx(D){let x,g,M,P,N,Z,o,B,ce,_e,de,Re,tt,Ce,qe;return g=new td({props:{name:"BBOX",iconPath:"button-icons/bbox.png"}}),P=new td({props:{name:"BUFFER",iconPath:"button-icons/buffer.png"}}),Z=new td({props:{name:"CLIP",iconPath:"button-icons/clip.png"}}),B=new td({props:{name:"DIFFERENCE",iconPath:"button-icons/difference.png"}}),_e=new td({props:{name:"INTERSECT",iconPath:"button-icons/intersection.png"}}),Re=new td({props:{name:"UNION",iconPath:"button-icons/union.png"}}),Ce=new td({props:{name:"VORNOI",iconPath:"button-icons/vornoi.png"}}),{c(){x=Yn("div"),Tn(g.$$.fragment),M=yr(),Tn(P.$$.fragment),N=yr(),Tn(Z.$$.fragment),o=yr(),Tn(B.$$.fragment),ce=yr(),Tn(_e.$$.fragment),de=yr(),Tn(Re.$$.fragment),tt=yr(),Tn(Ce.$$.fragment),this.h()},l(rt){x=Jn(rt,"DIV",{class:!0});var Je=xr(x);qn(g.$$.fragment,Je),M=vr(Je),qn(P.$$.fragment,Je),N=vr(Je),qn(Z.$$.fragment,Je),o=vr(Je),qn(B.$$.fragment,Je),ce=vr(Je),qn(_e.$$.fragment,Je),de=vr(Je),qn(Re.$$.fragment,Je),tt=vr(Je),qn(Ce.$$.fragment,Je),Je.forEach(Xt),this.h()},h(){wn(x,"class","container svelte-1x1k95d")},m(rt,Je){Ni(rt,x,Je),En(g,x,null),bn(x,M),En(P,x,null),bn(x,N),En(Z,x,null),bn(x,o),En(B,x,null),bn(x,ce),En(_e,x,null),bn(x,de),En(Re,x,null),bn(x,tt),En(Ce,x,null),qe=!0},p:Nl,i(rt){qe||(xi(g.$$.fragment,rt),xi(P.$$.fragment,rt),xi(Z.$$.fragment,rt),xi(B.$$.fragment,rt),xi(_e.$$.fragment,rt),xi(Re.$$.fragment,rt),xi(Ce.$$.fragment,rt),qe=!0)},o(rt){wi(g.$$.fragment,rt),wi(P.$$.fragment,rt),wi(Z.$$.fragment,rt),wi(B.$$.fragment,rt),wi(_e.$$.fragment,rt),wi(Re.$$.fragment,rt),wi(Ce.$$.fragment,rt),qe=!1},d(rt){rt&&Xt(x),An(g),An(P),An(Z),An(B),An(_e),An(Re),An(Ce)}}}class kx extends Os{constructor(x){super(),Rs(this,x,null,zx,Qo,{})}}function Bx(D){let x,g,M,P,N,Z,o;return x=new X0({}),x.$on("variableUpdated",D[0]),P=new Px({}),Z=new kx({}),{c(){Tn(x.$$.fragment),g=yr(),M=Yn("div"),Tn(P.$$.fragment),N=yr(),Tn(Z.$$.fragment),this.h()},l(B){qn(x.$$.fragment,B),g=vr(B),M=Jn(B,"DIV",{id:!0,class:!0});var ce=xr(M);qn(P.$$.fragment,ce),N=vr(ce),qn(Z.$$.fragment,ce),ce.forEach(Xt),this.h()},h(){wn(M,"id","overlay"),wn(M,"class","svelte-50ztgf")},m(B,ce){En(x,B,ce),Ni(B,g,ce),Ni(B,M,ce),En(P,M,null),bn(M,N),En(Z,M,null),o=!0},p:Nl,i(B){o||(xi(x.$$.fragment,B),xi(P.$$.fragment,B),xi(Z.$$.fragment,B),o=!0)},o(B){wi(x.$$.fragment,B),wi(P.$$.fragment,B),wi(Z.$$.fragment,B),o=!1},d(B){An(x,B),B&&Xt(g),B&&Xt(M),An(P),An(Z)}}}function Fx(D){function x(g){v0.call(this,D,g)}return[x]}class jx extends Os{constructor(x){super(),Rs(this,x,Fx,Bx,Qo,{})}}export{jx as component};
